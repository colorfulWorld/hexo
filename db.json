{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/android-chrome-192x192.png","path":"android-chrome-192x192.png","modified":0,"renderable":0},{"_id":"source/android-chrome-192x192.webp","path":"android-chrome-192x192.webp","modified":0,"renderable":0},{"_id":"source/android-chrome-256x256.png","path":"android-chrome-256x256.png","modified":0,"renderable":0},{"_id":"source/android-chrome-256x256.webp","path":"android-chrome-256x256.webp","modified":0,"renderable":0},{"_id":"source/apple-touch-icon.png","path":"apple-touch-icon.png","modified":0,"renderable":0},{"_id":"source/apple-touch-icon.webp","path":"apple-touch-icon.webp","modified":0,"renderable":0},{"_id":"source/browserconfig.xml","path":"browserconfig.xml","modified":0,"renderable":0},{"_id":"source/failure.ico","path":"failure.ico","modified":0,"renderable":0},{"_id":"source/favico.ico","path":"favico.ico","modified":0,"renderable":0},{"_id":"source/favicon-16x16.png","path":"favicon-16x16.png","modified":0,"renderable":0},{"_id":"source/favicon-16x16.webp","path":"favicon-16x16.webp","modified":0,"renderable":0},{"_id":"source/favicon-32x32.png","path":"favicon-32x32.png","modified":0,"renderable":0},{"_id":"source/favicon-32x32.webp","path":"favicon-32x32.webp","modified":0,"renderable":0},{"_id":"source/favicon.ico","path":"favicon.ico","modified":0,"renderable":0},{"_id":"source/mstile-150x150.png","path":"mstile-150x150.png","modified":0,"renderable":0},{"_id":"source/mstile-150x150.webp","path":"mstile-150x150.webp","modified":0,"renderable":0},{"_id":"source/safari-pinned-tab.svg","path":"safari-pinned-tab.svg","modified":0,"renderable":0},{"_id":"source/images/1000.jpg","path":"images/1000.jpg","modified":0,"renderable":0},{"_id":"source/images/1000.webp","path":"images/1000.webp","modified":0,"renderable":0},{"_id":"source/images/2016-08-25_wxd.png","path":"images/2016-08-25_wxd.png","modified":0,"renderable":0},{"_id":"source/images/2016-08-25_wxd.webp","path":"images/2016-08-25_wxd.webp","modified":0,"renderable":0},{"_id":"source/images/2016-08-25_zfbd.png","path":"images/2016-08-25_zfbd.png","modified":0,"renderable":0},{"_id":"source/images/2016-08-25_zfbd.webp","path":"images/2016-08-25_zfbd.webp","modified":0,"renderable":0},{"_id":"source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":0},{"_id":"source/images/wxwlive1.jpg","path":"images/wxwlive1.jpg","modified":0,"renderable":0},{"_id":"source/images/wxwlive1.webp","path":"images/wxwlive1.webp","modified":0,"renderable":0},{"_id":"source/images/cli/第三方库支持.png","path":"images/cli/第三方库支持.png","modified":0,"renderable":0},{"_id":"source/images/cli/脚手架构建流程.png","path":"images/cli/脚手架构建流程.png","modified":0,"renderable":0},{"_id":"source/images/common/bff-1.jpeg","path":"images/common/bff-1.jpeg","modified":0,"renderable":0},{"_id":"source/images/common/bff-2.jpeg","path":"images/common/bff-2.jpeg","modified":0,"renderable":0},{"_id":"source/images/common/bff.png","path":"images/common/bff.png","modified":0,"renderable":0},{"_id":"source/images/common/box.png","path":"images/common/box.png","modified":0,"renderable":0},{"_id":"source/images/common/http2_1.jpg","path":"images/common/http2_1.jpg","modified":0,"renderable":0},{"_id":"source/images/common/kuaipai.png","path":"images/common/kuaipai.png","modified":0,"renderable":0},{"_id":"source/images/common/linked-list.jpg","path":"images/common/linked-list.jpg","modified":0,"renderable":0},{"_id":"source/images/common/render.png","path":"images/common/render.png","modified":0,"renderable":0},{"_id":"source/images/prototype/1.png","path":"images/prototype/1.png","modified":0,"renderable":0},{"_id":"source/images/prototype/2.png","path":"images/prototype/2.png","modified":0,"renderable":0},{"_id":"source/images/prototype/instanceof.image","path":"images/prototype/instanceof.image","modified":0,"renderable":0},{"_id":"source/images/prototype/constructor.png","path":"images/prototype/constructor.png","modified":0,"renderable":0},{"_id":"source/images/prototype/prototype.image","path":"images/prototype/prototype.image","modified":0,"renderable":0},{"_id":"source/images/problem/1.png","path":"images/problem/1.png","modified":0,"renderable":0},{"_id":"source/images/problem/2.png","path":"images/problem/2.png","modified":0,"renderable":0},{"_id":"themes/sagiri/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/sagiri/source/fonts/Candyshop.otf","path":"fonts/Candyshop.otf","modified":0,"renderable":1},{"_id":"themes/sagiri/source/fonts/sigmarone1.woff2","path":"fonts/sigmarone1.woff2","modified":0,"renderable":1},{"_id":"themes/sagiri/source/fonts/sigmarone2.woff2","path":"fonts/sigmarone2.woff2","modified":0,"renderable":1},{"_id":"themes/sagiri/source/fonts/sigmarone3.woff2","path":"fonts/sigmarone3.woff2","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/DIYgod-avatar.jpg","path":"images/DIYgod-avatar.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/DIYgod-avatar.webp","path":"images/DIYgod-avatar.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/DIYgod.jpg","path":"images/DIYgod.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/DIYgod.webp","path":"images/DIYgod.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/alipay.png","path":"images/alipay.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/alipay.webp","path":"images/alipay.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/apple-touch-icon-next.webp","path":"images/apple-touch-icon-next.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/card-avatar.jpg","path":"images/card-avatar.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/card-avatar.webp","path":"images/card-avatar.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/card.jpg","path":"images/card.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/card.webp","path":"images/card.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-nc-nd.png","path":"images/cc-by-nc-nd.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-nc-nd.webp","path":"images/cc-by-nc-nd.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-nc-sa.png","path":"images/cc-by-nc-sa.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-nc-sa.webp","path":"images/cc-by-nc-sa.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-nc.png","path":"images/cc-by-nc.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-nc.webp","path":"images/cc-by-nc.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-nd.png","path":"images/cc-by-nd.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-nd.webp","path":"images/cc-by-nd.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-sa.png","path":"images/cc-by-sa.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by-sa.webp","path":"images/cc-by-sa.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by.png","path":"images/cc-by.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-by.webp","path":"images/cc-by.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-zero.png","path":"images/cc-zero.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cc-zero.webp","path":"images/cc-zero.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/cursor.ico","path":"images/cursor.ico","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/footer.png","path":"images/footer.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/footer.webp","path":"images/footer.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darling.jpg","path":"images/header-darling.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darling.webp","path":"images/header-darling.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darling2.jpg","path":"images/header-darling2.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darling2.webp","path":"images/header-darling2.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darling3.jpg","path":"images/header-darling3.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darling3.webp","path":"images/header-darling3.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darling4.jpg","path":"images/header-darling4.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darling4.webp","path":"images/header-darling4.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darlings.jpg","path":"images/header-darlings.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-darlings.webp","path":"images/header-darlings.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-gyx-s.png","path":"images/header-gyx-s.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-gyx-s.webp","path":"images/header-gyx-s.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-gyx.png","path":"images/header-gyx.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-gyx.webp","path":"images/header-gyx.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-leg.jpg","path":"images/header-leg.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-leg.webp","path":"images/header-leg.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-mai.jpg","path":"images/header-mai.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-mai.webp","path":"images/header-mai.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-sagiri.jpg","path":"images/header-sagiri.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header-sagiri.webp","path":"images/header-sagiri.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header.jpg","path":"images/header.jpg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/header.webp","path":"images/header.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/scroll.png","path":"images/scroll.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/scroll.webp","path":"images/scroll.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/searchicon.webp","path":"images/searchicon.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/wechatpay.png","path":"images/wechatpay.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/wechatpay.webp","path":"images/wechatpay.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/js/sagiri.min.js","path":"js/sagiri.min.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/js/sagiri.min.js.LICENSE.txt","path":"js/sagiri.min.js.LICENSE.txt","modified":0,"renderable":1},{"_id":"themes/sagiri/source/js/sagiri.min.js.map","path":"js/sagiri.min.js.map","modified":0,"renderable":1},{"_id":"themes/sagiri/source/js/video-report.html","path":"js/video-report.html","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/needsharebutton/font-embedded.css","path":"lib/needsharebutton/font-embedded.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/needsharebutton/needsharebutton.css","path":"lib/needsharebutton/needsharebutton.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/needsharebutton/needsharebutton.js","path":"lib/needsharebutton/needsharebutton.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/sw-toolbox/sw-toolbox.js","path":"lib/sw-toolbox/sw-toolbox.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/velocity-animate/LICENSE.md","path":"lib/velocity-animate/LICENSE.md","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/velocity-animate/package.json","path":"lib/velocity-animate/package.json","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/velocity-animate/README.md","path":"lib/velocity-animate/README.md","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/velocity-animate/velocity.js","path":"lib/velocity-animate/velocity.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/velocity-animate/velocity.min.js","path":"lib/velocity-animate/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/velocity-animate/velocity.ui.js","path":"lib/velocity-animate/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/velocity-animate/velocity.ui.min.js","path":"lib/velocity-animate/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/live2d/22/22.moc","path":"images/live2d/22/22.moc","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/live2d/22/22.model.json","path":"images/live2d/22/22.model.json","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/live2d/33/33.moc","path":"images/live2d/33/33.moc","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/live2d/33/33.model.json","path":"images/live2d/33/33.model.json","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/social-share.js/css/share.min.css","path":"lib/social-share.js/css/share.min.css","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/social-share.js/fonts/iconfont.eot","path":"lib/social-share.js/fonts/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/social-share.js/fonts/iconfont.svg","path":"lib/social-share.js/fonts/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/social-share.js/fonts/iconfont.ttf","path":"lib/social-share.js/fonts/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/social-share.js/fonts/iconfont.woff","path":"lib/social-share.js/fonts/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/social-share.js/js/jquery.share.min.js","path":"lib/social-share.js/js/jquery.share.min.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/social-share.js/js/social-share.min.js","path":"lib/social-share.js/js/social-share.min.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/live2d/33/33.2048/texture_00.png","path":"images/live2d/33/33.2048/texture_00.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/live2d/33/33.2048/texture_00.webp","path":"images/live2d/33/33.2048/texture_00.webp","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/live2d/22/22.2048/texture_00.png","path":"images/live2d/22/22.2048/texture_00.png","modified":0,"renderable":1},{"_id":"themes/sagiri/source/images/live2d/22/22.2048/texture_00.webp","path":"images/live2d/22/22.2048/texture_00.webp","modified":0,"renderable":1},{"_id":"source/images/common/https_1.jpeg","path":"images/common/https_1.jpeg","modified":0,"renderable":0},{"_id":"source/images/common/https_2.png","path":"images/common/https_2.png","modified":0,"renderable":0}],"Cache":[{"_id":"source/.DS_Store","hash":"532c74a930f28c82db7527c100cebac19a3e4898","modified":1616770870532},{"_id":"source/CNAME","hash":"1f2b8e1d37bc03c80a3d53a586651e71ef38f19d","modified":1614775978135},{"_id":"source/android-chrome-192x192.png","hash":"271e0371f46fbd5720d8761e1d68253a91fa1c95","modified":1614434967836},{"_id":"source/android-chrome-192x192.webp","hash":"f61b1615c82acf52aacac07038ecc4fbf130fc9f","modified":1614434967837},{"_id":"source/android-chrome-256x256.webp","hash":"1f05572eb58ddd35c0b3885f3e906c523c886df3","modified":1614434967838},{"_id":"source/apple-touch-icon.png","hash":"6e89a84032262cbf1ebe5aee23edccf29081d1f2","modified":1614434967838},{"_id":"source/android-chrome-256x256.png","hash":"f20d08929cb840cb5148227cdbe9c219b887d95f","modified":1614434967837},{"_id":"source/apple-touch-icon.webp","hash":"ee326b691b0b2c7997d75cb7caa6487f6d2828bf","modified":1614434967839},{"_id":"source/browserconfig.xml","hash":"99abe926a04d43f5373f119b633b269e5a15a901","modified":1614434967839},{"_id":"source/favico.ico","hash":"2d7ec086b029d8a224a4dae1a428c6a3f6209d92","modified":1614434967840},{"_id":"source/favicon-16x16.png","hash":"20b70672bc4a70231e68fb24b9cf7a55b4e684a5","modified":1614434967840},{"_id":"source/favicon-16x16.webp","hash":"df3f7e40344a5b37e73e8783c6a9caa2d2c01acf","modified":1614434967841},{"_id":"source/favicon-32x32.png","hash":"c1d0ec90c13b3cacc1e75d71658111e0af178912","modified":1614434967841},{"_id":"source/favicon-32x32.webp","hash":"078619032ccb0894c9828659216e039b44d2c1de","modified":1614434967841},{"_id":"source/favicon.ico","hash":"2d7ec086b029d8a224a4dae1a428c6a3f6209d92","modified":1614434967842},{"_id":"source/manifest.json","hash":"0da6509b3d6d6650bdcb5fa2b2b3e2c9fcfc5fea","modified":1614434968145},{"_id":"source/failure.ico","hash":"5eec5c163400d8ece74286da49130da1ead3f6f6","modified":1612724551000},{"_id":"source/mstile-150x150.webp","hash":"81b89e1acbf4c35f220289bb507e13353a28d4de","modified":1614434968146},{"_id":"source/mstile-150x150.png","hash":"f632b2a90a15c0024db2fd912010e87f210b5669","modified":1614434968146},{"_id":"source/safari-pinned-tab.svg","hash":"6fb3379bfd582862c03d0695b4e767421e6a1b61","modified":1614434968147},{"_id":"source/404/index.md","hash":"23939d77871ee364f7aed150113d73299a2686c6","modified":1614775978135},{"_id":"source/sw.js","hash":"bca0dd34d113d72aad774c12d018b386e1acc4ce","modified":1619278696560},{"_id":"source/_posts/BFC详解.md","hash":"f0737b6157b5057cc596c1b8df60e054bca5faad","modified":1618323167133},{"_id":"source/_posts/Event-loop-JS.md","hash":"bb7173bbfd5e195ffda1af4ee1ae172a4138603a","modified":1619278696545},{"_id":"source/_posts/HTTPS.md","hash":"a5dcd3c8752097468685c4c160a4d1ddaa190a9f","modified":1621820673532},{"_id":"source/_posts/HTTP2.md","hash":"7748fd8ed80bc3492944046fba85b645db58c279","modified":1621783392708},{"_id":"source/_posts/JS代码片段.md","hash":"fa3e24e65f29e93bbadc2cf67e144f851f2f3728","modified":1614956279439},{"_id":"source/_posts/JS基础-ES5.md","hash":"7bc02068f79f02ab9440ebb42bd355fd899b70ab","modified":1617799224792},{"_id":"source/_posts/JavaScript动态规划和贪心算法.md","hash":"0aaa55602da9a58c163e74044e2f4e805a630d8c","modified":1620303729894},{"_id":"source/_posts/JS原生-ES6.md","hash":"465d414addfe0ffa953b20ceab636d98eeace124","modified":1617974692977},{"_id":"source/_posts/Javascript链表数据结构.md","hash":"0b99ef3a2ccdfa873234a991f83c9942a31564a0","modified":1617799267206},{"_id":"source/_posts/JS的number类型最大值.md","hash":"8d2f2bbe119e142b06e89cb02d45cc20025c275f","modified":1614428678482},{"_id":"source/_posts/Observable.md","hash":"d6dc6d8481fb4551a7fe75f149175fcd3da85986","modified":1619278696548},{"_id":"source/_posts/Jenkins对前端应用做自动化构建.md","hash":"a475e25ba0be8d66cf7f63f9f634572007f3f163","modified":1617030563072},{"_id":"source/_posts/Object-defineProperty.md","hash":"b60b387916953b551530972fe1ff40ff0f280f17","modified":1617033885936},{"_id":"source/_posts/PWA-offline.md","hash":"7aca2653b802f87f3ff66bfc6528083b9edfda46","modified":1622042009994},{"_id":"source/_posts/PWA-pushMessage.md","hash":"bfeb8128a6257fdc2dbc4f6b8db8e79d87e512c9","modified":1617420734552},{"_id":"source/_posts/Vue-js内部运行机制.md","hash":"9724c62a7d4b9b54bccf215e2023d7f7d1b59037","modified":1614428678484},{"_id":"source/_posts/angular基础.md","hash":"030b6ff412e8bdb25d19835e81f26192e1d17137","modified":1614500222479},{"_id":"source/_posts/Vue小知识点运用.md","hash":"cda16470cfcaf609e1e4f980f01e54fb68d48463","modified":1619278713649},{"_id":"source/_posts/css-小知识.md","hash":"6b5be99db322419665b8ac83c3481819f7b9dc5f","modified":1620303729894},{"_id":"source/_posts/call、applay、bind.md","hash":"7543a3e3cc0f947fa7bc91c6776dcca6f9cf2ec1","modified":1617420494384},{"_id":"source/_posts/jQuery-源码学习（一）.md","hash":"dd69b53189be3a5190a129dd5632bea496280192","modified":1614428678485},{"_id":"source/_posts/innerHTML与createElement.md","hash":"ba918e156260dcd8ec2f944f6aa4e87e886b4a32","modified":1614428678485},{"_id":"source/_posts/jQuery-组件封装.md","hash":"9ea5da0626185155d8382a4f9865d3ba2448977a","modified":1614428678485},{"_id":"source/_posts/keep-alive小知识.md","hash":"e78135a4fc6c6e33c89a1b5fb43692f49caaf681","modified":1614428678486},{"_id":"source/_posts/require与import-的区别.md","hash":"fc301c9a24e01e2caa31b37e78570b8534cf91f2","modified":1620303729895},{"_id":"source/_posts/node中间层及简单api编写.md","hash":"58efcd6bc4ece74e0ec4bbbe9259a9c148675b6f","modified":1619278696548},{"_id":"source/_posts/this指向.md","hash":"bdc4ac6cd2093d30f27ed554323862f11aedf06f","modified":1620303729895},{"_id":"source/_posts/webWorkers.md","hash":"12d38948d91b976e9d560ef68d1ca8325e80dba5","modified":1619278696549},{"_id":"source/_posts/webpack优化之preload和prefetch.md","hash":"56cd4747e1aafcc14dc727fa2ec3f983720bfd7b","modified":1617420557968},{"_id":"source/_posts/webpack简介.md","hash":"bae92394dd5d278e100a381a142dac05727149d0","modified":1620303729896},{"_id":"source/_posts/vue懒加载与分组打包.md","hash":"2dd3d264eeb72f195bb1f170df3ca5ac6946b14a","modified":1617420594527},{"_id":"source/_posts/优化.md","hash":"38bce07e765935e1801f4c38e40095c0040f31d3","modified":1617420722525},{"_id":"source/_posts/webpack打包优化.md","hash":"32aa4593b6b90b07b39b0b9a8157ea1edbf06edb","modified":1618318382916},{"_id":"source/_posts/了解Fetch-api.md","hash":"3f3ce569e9f0f665e7571eff61b6302a0126285d","modified":1619278696550},{"_id":"source/_posts/一篇弄懂继承.md","hash":"eafc07b71ce3761254472f54664015f155deaa40","modified":1619347572519},{"_id":"source/_posts/作用域.md","hash":"4e48a0f797205fdded944dc13bb3692119275428","modified":1614428678488},{"_id":"source/_posts/字符串操作方法.md","hash":"d1a30bca9776ecda7336b44d276ce94b3e01124b","modified":1614428678489},{"_id":"source/_posts/如何实现双向数据绑定-mvvm.md","hash":"2f482a9b2199d70ff1953d0906f19740e468f845","modified":1614500050603},{"_id":"source/_posts/堆与栈.md","hash":"4907c11e39b48eaa56f0468b5188f79b93f1f3b5","modified":1619278713650},{"_id":"source/_posts/函数柯里化.md","hash":"92167cd287d61cb5c0fc599f706d7a8a60dc5243","modified":1617438492054},{"_id":"source/_posts/彻底贯通原型链.md","hash":"724e76b4dc7a26ec0f838e9f9f72b618ee786dc1","modified":1622037547447},{"_id":"source/_posts/小知识点积累.md","hash":"887182899cb865a0135a43774a4346f0839943e0","modified":1620303729897},{"_id":"source/_posts/工作中所遇到的问题.md","hash":"7d598d539a3e0b00ec1b6029386db5fb28c9c21a","modified":1614428678489},{"_id":"source/_posts/常见的四种post方式.md","hash":"fd07912a900a11fe8db4b0f3b7a44fdf1c7e0d65","modified":1617420649129},{"_id":"source/_posts/数组操作方法.md","hash":"dfb6945d3e6faf568351546f929fe7a43854322b","modified":1617435704889},{"_id":"source/_posts/有趣JS题.md","hash":"aba0d73eb20acea5cef005b18cbe55ea64f38b10","modified":1614500136225},{"_id":"source/_posts/浏览器存储机制.md","hash":"faed497b72f4f7e7ba39c2e823605c30f1418c47","modified":1618318433873},{"_id":"source/_posts/正则表达式.md","hash":"7bedfdee534cc4f1fd130be171fbabf2a09bd4b2","modified":1614500140333},{"_id":"source/_posts/移动端监听返回键.md","hash":"49d4e11146a4233be66aea3548bd6a73be4dbb9a","modified":1619278696550},{"_id":"source/_posts/脚手架集成.md","hash":"e4b0937022b4a9528a5ffcb4755c296914f6e5cf","modified":1620914764234},{"_id":"source/_posts/浏览器渲染与解析.md","hash":"64b93c16f7e9777767fa3ba282ffcb0745352a49","modified":1618230513658},{"_id":"source/_posts/疑难杂问整理（原生JS）.md","hash":"2b7ea595bd3eaf2831ee3b72d92162d9a9c8f8b0","modified":1614431065417},{"_id":"source/archives/index.md","hash":"852b00a3cd15caae3cb35d19de7cf8753f630872","modified":1614434967839},{"_id":"source/_posts/跨域-解决方案.md","hash":"8f0b21cbaad8480d0441d71d1fd48ce19822e68c","modified":1622039776233},{"_id":"source/categories/index.md","hash":"d7ef72b21495ca2a07db024bf0d6d471da51ddc2","modified":1614434967840},{"_id":"source/donate/index.md","hash":"ce34626fc5e3531050aea624ca2b1eee133b6fd5","modified":1612724551000},{"_id":"source/images/.DS_Store","hash":"977eed8fa397ae10ee34e1132ce4bc5ef74a68c6","modified":1614436214430},{"_id":"source/_posts/闭包.md","hash":"9d46b344b875deaf5f94d51e33d95509b031010f","modified":1614428678493},{"_id":"source/images/2016-08-25_wxd.webp","hash":"d69056969d3e7101ebb9f4d3a382722093fff86c","modified":1612724551000},{"_id":"source/images/2016-08-25_wxd.png","hash":"0c730f3963f3042d0dfcc78837d9a4cf2f05f8fc","modified":1612724551000},{"_id":"source/images/2016-08-25_zfbd.png","hash":"bc3750d18e6bf1d5f1e24c25455b00d26c3ff447","modified":1612724551000},{"_id":"source/images/2016-08-25_zfbd.webp","hash":"e4b890a58f4fa1448a0a2d5c9a6c9a747ab5cae5","modified":1612724551000},{"_id":"source/images/1000.webp","hash":"5cc5f6f4d35bbfed3dec56621e253af380523668","modified":1612724551000},{"_id":"source/images/avatar.jpg","hash":"663809c02cd10187b8903189eb4c6aed35e61a90","modified":1614505609909},{"_id":"source/tags/index.md","hash":"0c67558aa30e2a1d47de32e41ed9395f179da6b8","modified":1614434968147},{"_id":"source/images/cli/第三方库支持.png","hash":"fdb3b347aadd4e71d0397eed3cfa1509b3ad507c","modified":1614505833413},{"_id":"source/images/cli/脚手架构建流程.png","hash":"58a1fcb2b0a77810a9ee4749cc543f80f4917c43","modified":1614505755244},{"_id":"source/message/index.md","hash":"40aeec751069bfcb45e482a475a571d7c7b6f484","modified":1612724551000},{"_id":"source/images/wxwlive1.jpg","hash":"2eb21b491632f9d5b548c21efdffc6ef70e0c48b","modified":1612724551000},{"_id":"source/images/wxwlive1.webp","hash":"b70192112f45b5fd5ad3cb0dcb872284a3776479","modified":1612724551000},{"_id":"source/images/common/bff-1.jpeg","hash":"6a7568c3438ff5b4e2c6e882396c9e2dcea830b8","modified":1619278696555},{"_id":"source/images/common/bff-2.jpeg","hash":"2c6424dc565ecf31754a9e6089915a59d1b7ed40","modified":1619278696556},{"_id":"source/images/common/http2_1.jpg","hash":"8d8a0845f7cac1afc7aeafb7b3d47b86be6a6bc3","modified":1614505621992},{"_id":"source/images/common/linked-list.jpg","hash":"cb1825a3d3099c45a7788da2ab3535e11be445bd","modified":1617799267206},{"_id":"source/images/prototype/2.png","hash":"fc3a6c80a4d80fb8b5889c506e2ad7592b544134","modified":1614956279447},{"_id":"source/images/prototype/1.png","hash":"b56d7ed5068f6f314ba1d48a694f3917111fa659","modified":1614956279447},{"_id":"source/images/prototype/constructor.png","hash":"da1cb28b40a898ed26815dd151e350e4efb790bd","modified":1617284840166},{"_id":"source/images/problem/1.png","hash":"a566f9497bb5755ded08e82a615eabba2b2b668b","modified":1614956279446},{"_id":"source/images/problem/2.png","hash":"37ce91da9e0bf6fd101d1025be458d3ca9f09da7","modified":1614956279446},{"_id":"source/images/1000.jpg","hash":"0076f1999f8d448e3afbca0bda5ed4638b4888b6","modified":1612724551000},{"_id":"source/images/common/box.png","hash":"00295511106844b064a28315310a0f19ba23cc0a","modified":1618230513659},{"_id":"source/images/prototype/prototype.image","hash":"e782d4c95a5cde5271f895d6acd26f9e0c663a71","modified":1617284840169},{"_id":"source/images/common/kuaipai.png","hash":"84a90e636ed5bbb0f93aca7834426987e65bf438","modified":1614505637490},{"_id":"source/images/common/render.png","hash":"9ae4965461435b8ac930315c4ef9669225d64ee1","modified":1618230513660},{"_id":"source/images/common/bff.png","hash":"fe95a28756836f21c39786ba3e9cd187ca726adb","modified":1619278696560},{"_id":"source/images/prototype/instanceof.image","hash":"0c119f2c36a84aa9e28052f19550e100ac19a28e","modified":1617284840168},{"_id":"themes/sagiri/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1614434968248},{"_id":"themes/sagiri/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1612724551000},{"_id":"themes/sagiri/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1612724551000},{"_id":"themes/sagiri/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1614434968236},{"_id":"themes/sagiri/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1614434968236},{"_id":"themes/sagiri/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1614434968237},{"_id":"themes/sagiri/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1614434968247},{"_id":"themes/sagiri/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1614434968248},{"_id":"themes/sagiri/.gitignore","hash":"1a24cffb713c184861bf805cb674ebfc70125517","modified":1614434968148},{"_id":"themes/sagiri/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1614434968148},{"_id":"themes/sagiri/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1614434968148},{"_id":"themes/sagiri/.javascript_ignore","hash":"8a224b381155f10e6eb132a4d815c5b52962a9d1","modified":1614434968149},{"_id":"themes/sagiri/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1614434968148},{"_id":"themes/sagiri/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1614434968149},{"_id":"themes/sagiri/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1614434968150},{"_id":"themes/sagiri/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1614434968149},{"_id":"themes/sagiri/package.json","hash":"8daccda596384cb5a6e8d3ca97c66d0c2878f6b0","modified":1616739608218},{"_id":"themes/sagiri/README.md","hash":"08fb29b413f3fbcb318bef061cb67dd34216a0f6","modified":1614434968150},{"_id":"themes/sagiri/LICENSE","hash":"62b5465275003c2adf97276fb06fd80662e01a8e","modified":1614434968150},{"_id":"themes/sagiri/_config.yml","hash":"e39d44cd339c7bea5f183eae49c4976cce750267","modified":1618230895209},{"_id":"themes/sagiri/.DS_Store","hash":"d3d6ef9b4d1973d5500f244f828426f2ba51361e","modified":1614436289256},{"_id":"themes/sagiri/languages/de.yml","hash":"057e7df11ddeb1c8c15a5d7c5ff29430d725ec6b","modified":1614434968151},{"_id":"themes/sagiri/webpack.config.js","hash":"db46368ff4e6a48fc54f7e805ce6d2cba4a8057c","modified":1614434968354},{"_id":"themes/sagiri/languages/default.yml","hash":"44ef3f26917f467459326c2c8be2f73e4d947f35","modified":1614434968152},{"_id":"themes/sagiri/languages/fr-FR.yml","hash":"7e4eb7011b8feee641cfb11c6e73180b0ded1c0f","modified":1614434968152},{"_id":"themes/sagiri/languages/id.yml","hash":"b5de1ea66dd9ef54cac9a1440eaa4e3f5fc011f5","modified":1614434968153},{"_id":"themes/sagiri/languages/en.yml","hash":"7e680d9bb8f3a3a9d1ba1c9d312b3d257183dded","modified":1614434968152},{"_id":"themes/sagiri/languages/ko.yml","hash":"ea5b46056e73ebcee121d5551627af35cbffc900","modified":1614434968154},{"_id":"themes/sagiri/languages/ja.yml","hash":"3c76e16fd19b262864475faa6854b718bc08c4d8","modified":1614434968153},{"_id":"themes/sagiri/languages/nl-NL.yml","hash":"edca4f3598857dbc3cbf19ed412213329b6edd47","modified":1614434968154},{"_id":"themes/sagiri/languages/it.yml","hash":"aa595f2bda029f73ef7bfa104b4c55c3f4e9fb4c","modified":1614434968153},{"_id":"themes/sagiri/languages/pt-BR.yml","hash":"b1694ae766ed90277bcc4daca4b1cfa19cdcb72b","modified":1614434968154},{"_id":"themes/sagiri/languages/pt.yml","hash":"44b61f2d085b827b507909a0b8f8ce31c6ef5d04","modified":1614434968155},{"_id":"themes/sagiri/languages/ru.yml","hash":"98ec6f0b7183282e11cffc7ff586ceb82400dd75","modified":1614434968155},{"_id":"themes/sagiri/languages/zh-hk.yml","hash":"9396f41ae76e4fef99b257c93c7354e661f6e0fa","modified":1614434968155},{"_id":"themes/sagiri/languages/zh-Hans.yml","hash":"224b8c6ab8f32e9bb10bab31d4c37a8afdc23e85","modified":1614434968155},{"_id":"themes/sagiri/languages/zh-tw.yml","hash":"50b71abb3ecc0686f9739e179e2f829cd074ecd9","modified":1614434968156},{"_id":"themes/sagiri/layout/_layout.swig","hash":"21e89344acec90167b5bf0180770f079c9d570db","modified":1618230513662},{"_id":"themes/sagiri/layout/archive.swig","hash":"27bd98045659238a6b306464a66e1356abcf80ca","modified":1614438487064},{"_id":"themes/sagiri/layout/category.swig","hash":"da739ffd35ffbdd8e63b33d728e763b8e4d498a5","modified":1612724551000},{"_id":"themes/sagiri/layout/index.swig","hash":"783611349c941848a0e26ee2f1dc44dd14879bd1","modified":1612724551000},{"_id":"themes/sagiri/layout/post.swig","hash":"b3589a8e46288a10d20e41c7a5985d2493725aec","modified":1612724551000},{"_id":"themes/sagiri/layout/page.swig","hash":"9e40fa4d47530df9eafee5ac3dd4901a138c6c44","modified":1612724551000},{"_id":"themes/sagiri/scripts/img.js","hash":"4eb9bd2289f57f9399f5db8e05e399dfb383dfb9","modified":1614504721415},{"_id":"themes/sagiri/scripts/merge-configs.js","hash":"cb617ddf692f56e6b6129564d52e302f50b28243","modified":1614434968198},{"_id":"themes/sagiri/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1614434968199},{"_id":"themes/sagiri/layout/schedule.swig","hash":"d86f8de4e118f8c4d778b285c140474084a271db","modified":1612724551000},{"_id":"themes/sagiri/layout/tag.swig","hash":"7d245d5b96637bcd36dfcdc949eda9602298e080","modified":1612724551000},{"_id":"themes/sagiri/src/cursor-effects.js","hash":"a491af0c1524347ed1a2be27818491f6107fddc3","modified":1614434968345},{"_id":"themes/sagiri/src/bootstrap.js","hash":"4a349374644672dccd942156404e42a58f8eb330","modified":1614434968343},{"_id":"themes/sagiri/src/clipboard.js","hash":"dae4b2997460f6240bb0ae7cbd1c1b27f4055ded","modified":1614434968344},{"_id":"themes/sagiri/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1614434968343},{"_id":"themes/sagiri/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1614434968342},{"_id":"themes/sagiri/src/evanyou.js","hash":"81ab1c799306576b8781c919e11a99e99b8aa1d6","modified":1614434968345},{"_id":"themes/sagiri/src/kanban.js","hash":"7f9b88e84e9524b8b9bd271fd5071bed7ca85564","modified":1614434968346},{"_id":"themes/sagiri/src/mix.js","hash":"414544b64637c7f609ea8a9842bd6e37ab1f9ea5","modified":1614434968349},{"_id":"themes/sagiri/src/index.js","hash":"a4b1a73c0fb30d439365bdf04f2a4b726963cacf","modified":1616739608229},{"_id":"themes/sagiri/src/leancloud.js","hash":"48fec535a150f7a96432326a5480a046585fbfa0","modified":1614434968347},{"_id":"themes/sagiri/src/motion.js","hash":"1bfa2ee9e10be39a32dde24c10304386172b7626","modified":1614434968349},{"_id":"themes/sagiri/src/pisces.js","hash":"d402d28b9e91924f92e77f30914e69b5f05cdbde","modified":1614434968350},{"_id":"themes/sagiri/src/post-details.js","hash":"7cfe2a26933a2b30ff1f5db17915d9e01343310d","modified":1614434968350},{"_id":"themes/sagiri/src/scroll.js","hash":"f680972df311bb46e077d51f2ad8e5b29f27723f","modified":1614434968351},{"_id":"themes/sagiri/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1614434968351},{"_id":"themes/sagiri/src/search.js","hash":"7150c60d66c1b244f197d3cfa92dcb74537a5a32","modified":1614434968351},{"_id":"themes/sagiri/src/since.js","hash":"d43bcb68fa53764362b49da6e9898f3741aa024b","modified":1614434968352},{"_id":"themes/sagiri/src/pjax.js","hash":"6f74dddc345527f2edaf2cec7c9e8b4a597ed3f6","modified":1616739608229},{"_id":"themes/sagiri/src/share.js","hash":"4c280b5efff5d0e75a87923e78310487d0ef6801","modified":1614434968351},{"_id":"themes/sagiri/src/title.js","hash":"a44e80a47f8820a087367c8a6d3472c0738c2d49","modified":1614434968352},{"_id":"themes/sagiri/src/type.js","hash":"5ca8a856e9f192c41da0367082a893f9dda9d093","modified":1614434968353},{"_id":"themes/sagiri/src/zoom.js","hash":"046e2d66453415b6c53632ecaba2f0e00e8e75db","modified":1614434968354},{"_id":"themes/sagiri/src/utils.js","hash":"f545a102cde0d2914e7d6d03c38e46e95a55949c","modified":1614775978161},{"_id":"themes/sagiri/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1612724551000},{"_id":"themes/sagiri/layout/_macro/post-collapse.swig","hash":"d3af6e5c6bb979d1506086e231be5bc9b27758ef","modified":1612724551000},{"_id":"themes/sagiri/layout/_macro/post-copyright.swig","hash":"665a928604f99d2ba7dc4a4a9150178229568cc6","modified":1612724551000},{"_id":"themes/sagiri/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1612724551000},{"_id":"themes/sagiri/layout/_macro/post.swig","hash":"13c013a75ed40b42cf04cc71ce46701888c832e6","modified":1612724551000},{"_id":"themes/sagiri/layout/_macro/reward.swig","hash":"a88a74ba21e98223d937525c0b366e1ffdd9be01","modified":1614500902157},{"_id":"themes/sagiri/layout/_macro/wechat-subscriber.swig","hash":"39852700e4084ecccffa6d4669168e5cc0514c9e","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/comments.swig","hash":"76707ac2699c8a349e72bbb8dd2daac5b8ed090a","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/footer.swig","hash":"57e27a87e165851a02c136ded8fbf5d7229617e9","modified":1612724551000},{"_id":"themes/sagiri/layout/_macro/sidebar.swig","hash":"5b83c8d4af467f65d5ffaf9eea931d513a4c8cf2","modified":1614606910397},{"_id":"themes/sagiri/layout/_partials/page-header.swig","hash":"1efd925d34a5d4ba2dc0838d9c86ba911e705fc9","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/pagination.swig","hash":"17e6f65e81ffd339bfa342603a76c8f72bdea312","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/header.swig","hash":"3af4198d7e994b717aafdfe7cde2dfc635adc48e","modified":1618230513662},{"_id":"themes/sagiri/layout/_partials/search.swig","hash":"9dbd378e94abfcb3f864a5b8dbbf18d212ca2ee0","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/head.swig","hash":"14ce7f59896f70d06b07b5db1e21b338a7f97638","modified":1616739608218},{"_id":"themes/sagiri/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1612724551000},{"_id":"themes/sagiri/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1612724551000},{"_id":"themes/sagiri/layout/_scripts/vendors.swig","hash":"2e80fffb559eb253596bef181ead9dd547790ca4","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/exturl.swig","hash":"7c04a42319d728be356746363aff8ea247791d24","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/rating.swig","hash":"fc93b1a7e6aed0dddb1f3910142b48d8ab61174e","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/mathjax.swig","hash":"6d25596d6a7c57700d37b607f8d9a62d89708683","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/needsharebutton.swig","hash":"5fe0447cc88a5a63b530cf0426f93c4634811876","modified":1612724551000},{"_id":"themes/sagiri/scripts/tags/button.js","hash":"d023f10a00077f47082b0517e2ad666e6e994f60","modified":1614434968200},{"_id":"themes/sagiri/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1614434968200},{"_id":"themes/sagiri/scripts/tags/full-image.js","hash":"8eeb3fb89540299bdbb799edfdfdac3743b50596","modified":1614434968201},{"_id":"themes/sagiri/scripts/tags/exturl.js","hash":"8d7e60f60779bde050d20fd76f6fdc36fc85e06d","modified":1614434968200},{"_id":"themes/sagiri/scripts/tags/label.js","hash":"2f8f41a7316372f0d1ed6b51190dc4acd3e16fff","modified":1614434968202},{"_id":"themes/sagiri/scripts/tags/lazy-image.js","hash":"eeeabede68cf263de9e6593ecf682f620da16f0a","modified":1614434968202},{"_id":"themes/sagiri/scripts/tags/note.js","hash":"64de4e9d01cf3b491ffc7d53afdf148ee5ad9779","modified":1614434968202},{"_id":"themes/sagiri/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1614434968201},{"_id":"themes/sagiri/scripts/tags/tabs.js","hash":"5786545d51c38e8ca38d1bfc7dd9e946fc70a316","modified":1614434968203},{"_id":"themes/sagiri/layout/_third-party/scroll-cookie.swig","hash":"1ddb2336a1a19b47af3017047012c01ec5f54529","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/schedule.swig","hash":"22369026c87fc23893c35a7f250b42f3bb1b60f1","modified":1612724551000},{"_id":"themes/sagiri/source/css/main.styl","hash":"625ec72b0ff8653040ebcd2b25b4a7fe77a5a82c","modified":1616739608219},{"_id":"themes/sagiri/source/fonts/Candyshop.otf","hash":"2d4fffc6d278cc8010f75422246bf368a764c125","modified":1614434968249},{"_id":"themes/sagiri/source/fonts/sigmarone3.woff2","hash":"5f62e2560d08e71274fac25c49825113a09776c7","modified":1614434968251},{"_id":"themes/sagiri/source/fonts/sigmarone1.woff2","hash":"35d4f8be95cbf9ced2c3eae1bfe63d5ce8ee7214","modified":1614434968249},{"_id":"themes/sagiri/source/fonts/sigmarone2.woff2","hash":"feaa47ccbf19dfb2812fa8306f421b88e90af723","modified":1614434968250},{"_id":"themes/sagiri/source/images/DIYgod-avatar.jpg","hash":"81d0b371df55b5a1bb0c9b258046754dd2c0729d","modified":1614434968251},{"_id":"themes/sagiri/source/images/DIYgod-avatar.webp","hash":"a7200fad65f069ca3f3256b4dd573d9d2e36c829","modified":1614434968251},{"_id":"themes/sagiri/source/images/DIYgod.jpg","hash":"81d0b371df55b5a1bb0c9b258046754dd2c0729d","modified":1614434968251},{"_id":"themes/sagiri/source/images/alipay.png","hash":"bc3750d18e6bf1d5f1e24c25455b00d26c3ff447","modified":1614434968253},{"_id":"themes/sagiri/source/images/DIYgod.webp","hash":"a7200fad65f069ca3f3256b4dd573d9d2e36c829","modified":1614434968252},{"_id":"themes/sagiri/source/images/alipay.webp","hash":"e4b890a58f4fa1448a0a2d5c9a6c9a747ab5cae5","modified":1614434968253},{"_id":"themes/sagiri/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1614434968253},{"_id":"themes/sagiri/source/images/apple-touch-icon-next.webp","hash":"a67fcf955e00f160cf687335673a8cbdc587d456","modified":1614434968254},{"_id":"themes/sagiri/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1614434968254},{"_id":"themes/sagiri/source/images/card-avatar.webp","hash":"980ebd262b2c68baa784a58be7afaa55edd60f28","modified":1614434968255},{"_id":"themes/sagiri/source/images/card-avatar.jpg","hash":"f2bb19ea1343999976c0b817c1f35949eac7a709","modified":1614434968254},{"_id":"themes/sagiri/source/images/card.jpg","hash":"f2bb19ea1343999976c0b817c1f35949eac7a709","modified":1614434968256},{"_id":"themes/sagiri/source/images/card.webp","hash":"980ebd262b2c68baa784a58be7afaa55edd60f28","modified":1614434968256},{"_id":"themes/sagiri/source/images/cc-by-nc-nd.png","hash":"f7839bdd799c452a4e807a2365849acc0748b3fd","modified":1614434968256},{"_id":"themes/sagiri/source/images/cc-by-nc-nd.webp","hash":"a9da48b761a7586f899f826170bc86d26c2ec08a","modified":1614434968257},{"_id":"themes/sagiri/source/images/cc-by-nc-sa.webp","hash":"5fde7a2f79adc7d200cac995df45a84d64b2494c","modified":1614434968258},{"_id":"themes/sagiri/source/images/cc-by-nc-sa.png","hash":"cb36e36c3e3959a54ac289e309a4a89a016107bc","modified":1614434968257},{"_id":"themes/sagiri/source/images/cc-by-nc.png","hash":"eaf656bdd1ff61c345a7d42b94ac6f25435f5c42","modified":1614434968258},{"_id":"themes/sagiri/source/images/cc-by-nc.webp","hash":"5c8a54299712f843d290fed413925a2c3c3318c4","modified":1614434968258},{"_id":"themes/sagiri/source/images/cc-by-nd.webp","hash":"2a5cc8580f7aadb947e558360bda5dd663eeecc1","modified":1614434968260},{"_id":"themes/sagiri/source/images/cc-by-nd.png","hash":"6420f0e99cb3e90d3c37e0e8513d16ada14fed37","modified":1614434968259},{"_id":"themes/sagiri/source/images/cc-by-sa.webp","hash":"9afcad8c2cb3f4170b2a8bb5fd6fcc4c34616c19","modified":1614434968261},{"_id":"themes/sagiri/source/images/cc-by-sa.png","hash":"d62ae0fd7204bf889b3f2cbe89eae5865a71c056","modified":1614434968261},{"_id":"themes/sagiri/source/images/cc-by.png","hash":"63f01c43cb5d03cb83d3c867c5ecb768cd89d9df","modified":1614434968262},{"_id":"themes/sagiri/source/images/cc-by.webp","hash":"9a364fca486147d5fe120487edbcc5617d4a1759","modified":1614434968262},{"_id":"themes/sagiri/source/images/cursor.ico","hash":"cd8349fb9cef6c217fc364cf35eae6819cebf5d6","modified":1614434968263},{"_id":"themes/sagiri/source/images/cc-zero.webp","hash":"bbe5c624b52986f383c0bc0aed4e4c93b1f3b680","modified":1614434968263},{"_id":"themes/sagiri/source/images/cc-zero.png","hash":"fd4ce5a5851ef47c3b525652cc3ae8128d405c8f","modified":1614434968263},{"_id":"themes/sagiri/source/images/footer.png","hash":"5f27807ccb8beeed9a909571783797901c52c3b7","modified":1614434968264},{"_id":"themes/sagiri/source/images/footer.webp","hash":"d5b03e8d76bcfc4f966ea3408bdc0b90874ca0e8","modified":1614434968264},{"_id":"themes/sagiri/source/images/header-darling.jpg","hash":"428d430fd9086c207a4a18d6c55308a74441bfe5","modified":1614434968265},{"_id":"themes/sagiri/source/images/header-darling.webp","hash":"84ea4042c5e4a57e9b1832fdf4db536aa9d2e040","modified":1614434968267},{"_id":"themes/sagiri/source/images/header-gyx-s.webp","hash":"d16a445dadc05c1976ffbf3ab88de618d1db360a","modified":1614434968290},{"_id":"themes/sagiri/source/images/header-sagiri.webp","hash":"8ffc6ce60e2171c0528bef7a2a5692fd873f9a42","modified":1614434968312},{"_id":"themes/sagiri/source/images/header.webp","hash":"8ffc6ce60e2171c0528bef7a2a5692fd873f9a42","modified":1614434968313},{"_id":"themes/sagiri/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1614434968320},{"_id":"themes/sagiri/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1614434968320},{"_id":"themes/sagiri/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1614434968321},{"_id":"themes/sagiri/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1614434968321},{"_id":"themes/sagiri/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1614434968321},{"_id":"themes/sagiri/source/images/scroll.png","hash":"443930af0ee54778babad7724291bfed9b431dd5","modified":1614434968322},{"_id":"themes/sagiri/source/images/scroll.webp","hash":"f5e9b67b639f03e0a1ccf171b17d1b5ee811765d","modified":1614434968322},{"_id":"themes/sagiri/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1614434968322},{"_id":"themes/sagiri/source/images/searchicon.webp","hash":"4dc91243df4ec53a3a98fd0ec9a4abaa15606dd3","modified":1614434968323},{"_id":"themes/sagiri/source/images/wechatpay.png","hash":"0c730f3963f3042d0dfcc78837d9a4cf2f05f8fc","modified":1614434968323},{"_id":"themes/sagiri/source/images/wechatpay.webp","hash":"d69056969d3e7101ebb9f4d3a382722093fff86c","modified":1614434968323},{"_id":"themes/sagiri/layout/_partials/head/custom-head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/head/external-fonts.swig","hash":"60b7136d9986823ccccee236fbae3c4f36e5f884","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/share/jiathis.swig","hash":"048fd5e98149469f8c28c21ba3561a7a67952c9b","modified":1612724551000},{"_id":"themes/sagiri/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1612724551000},{"_id":"themes/sagiri/layout/_scripts/schemes/gemini.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1612724551000},{"_id":"themes/sagiri/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1612724551000},{"_id":"themes/sagiri/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/analytics-with-widget.swig","hash":"98df9d72e37dd071e882f2d5623c9d817815b139","modified":1612724551000},{"_id":"themes/sagiri/source/js/sagiri.min.js.LICENSE.txt","hash":"8bdbc2c891e7510d120c7c7bbb42623edf9129c6","modified":1614612785125},{"_id":"themes/sagiri/layout/_third-party/analytics/application-insights.swig","hash":"60426bf73f8a89ba61fb1be2df3ad5398e32c4ef","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/baidu-analytics.swig","hash":"deda6a814ed48debc694c4e0c466f06c127163d0","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/cnzz-analytics.swig","hash":"8160b27bee0aa372c7dc7c8476c05bae57f58d0f","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/busuanzi-counter.swig","hash":"18e7bef8923d83ea42df6c97405e515a876cede4","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/facebook-sdk.swig","hash":"a234c5cd1f75ca5731e814d0dbb92fdcf9240d1b","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/index.swig","hash":"5e9bb24c750b49513d9a65799e832f07410002ac","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/lean-analytics.swig","hash":"e6b0a37125798d6215c258a359e97ba222b36b73","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/vkontakte-api.swig","hash":"c3971fd154d781088e1cc665035f8561a4098f4c","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/tencent-mta.swig","hash":"0ddc94ed4ba0c19627765fdf1abc4d8efbe53d5a","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/comments/changyan.swig","hash":"0e3378f7c39b2b0f69638290873ede6b6b6825c0","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/comments/disqus.swig","hash":"ca2ebb2b0da29f69426d76b68e1c3844fdd9587c","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/comments/duoshuo.swig","hash":"a356b2185d40914447fde817eb3d358ab6b3e4c3","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/comments/gitment.swig","hash":"10160daceaa6f1ecf632323d422ebe2caae49ddf","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/comments/hypercomments.swig","hash":"3e8dc5c6c912628a37e3b5f886bec7b2e5ed14ea","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/comments/index.swig","hash":"aa0629277d751c55c6d973e7691bf84af9b17a60","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/comments/livere.swig","hash":"8a2e393d2e49f7bf560766d8a07cd461bf3fce4f","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/comments/valine.swig","hash":"f780973e0f8c2e52a70ac5e927af845d7b547b71","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/analytics/google-analytics.swig","hash":"5d9943d74cc2e0a91badcf4f755c6de77eab193a","modified":1614439499497},{"_id":"themes/sagiri/layout/_third-party/comments/youyan.swig","hash":"8b6650f77fe0a824c8075b2659e0403e0c78a705","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/search/localsearch.swig","hash":"385c066af96bee30be2459dbec8aae1f15d382f5","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/seo/baidu-push.swig","hash":"c057b17f79e8261680fbae8dc4e81317a127c799","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1612724551000},{"_id":"themes/sagiri/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1614434968236},{"_id":"themes/sagiri/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1614434968236},{"_id":"themes/sagiri/source/css/_mixins/Pisces.styl","hash":"a230c91c248a9d8e0295078f435727e8470a95aa","modified":1614434968237},{"_id":"themes/sagiri/source/css/_mixins/base.styl","hash":"878e3200841a25dd7e098dab5436fcba08e42856","modified":1614434968237},{"_id":"themes/sagiri/source/css/_variables/Pisces.styl","hash":"07ec3b5dbe639762983cc88be5630aba2f08e186","modified":1614434968248},{"_id":"themes/sagiri/source/css/_variables/base.styl","hash":"ad21c4fbffee6930e775db8d74f39e9ef6bb2dc3","modified":1614434968248},{"_id":"themes/sagiri/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1614434968324},{"_id":"themes/sagiri/source/lib/needsharebutton/font-embedded.css","hash":"c39d37278c1e178838732af21bd26cd0baeddfe0","modified":1614434968328},{"_id":"themes/sagiri/source/lib/needsharebutton/needsharebutton.css","hash":"3ef0020a1815ca6151ea4886cd0d37421ae3695c","modified":1614434968329},{"_id":"themes/sagiri/source/css/_variables/Gemini.styl","hash":"99fbb4686ea9a3e03a4726ed7cf4d8f529034452","modified":1614434968247},{"_id":"themes/sagiri/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1614434968330},{"_id":"themes/sagiri/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1614434968330},{"_id":"themes/sagiri/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1614434968330},{"_id":"themes/sagiri/source/css/_variables/Mist.styl","hash":"be087dcc060e8179f7e7f60ab4feb65817bd3d9f","modified":1614434968247},{"_id":"themes/sagiri/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1614434968330},{"_id":"themes/sagiri/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1614434968331},{"_id":"themes/sagiri/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1614434968332},{"_id":"themes/sagiri/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1614434968331},{"_id":"themes/sagiri/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1614434968332},{"_id":"themes/sagiri/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1614434968332},{"_id":"themes/sagiri/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1614434968332},{"_id":"themes/sagiri/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1614434968333},{"_id":"themes/sagiri/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1614434968334},{"_id":"themes/sagiri/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1614434968333},{"_id":"themes/sagiri/source/lib/needsharebutton/needsharebutton.js","hash":"9885fd9bea5e7ebafc5b1de9d17be5e106248d96","modified":1614434968329},{"_id":"themes/sagiri/source/lib/velocity-animate/package.json","hash":"56fecfbc58b207b3592320a5d0e74b9814275bea","modified":1614434968338},{"_id":"themes/sagiri/source/lib/velocity-animate/LICENSE.md","hash":"69b8b84e79ff16de8972798eb6a783a2379b6f13","modified":1614434968338},{"_id":"themes/sagiri/source/lib/sw-toolbox/sw-toolbox.js","hash":"7e2fd42a8ddb17450970c30a9bc5274f720e602c","modified":1614434968336},{"_id":"themes/sagiri/source/lib/velocity-animate/README.md","hash":"dad58a21332a3177b229fa97af6f35309def2bca","modified":1614434968338},{"_id":"themes/sagiri/source/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1614434968334},{"_id":"themes/sagiri/source/lib/velocity-animate/velocity.ui.js","hash":"7731c1bc444855b9b18bfb265cd1c4a169e6be37","modified":1614434968342},{"_id":"themes/sagiri/source/lib/velocity-animate/velocity.ui.min.js","hash":"d8124c091d19fa4072616a44a8897fabc6599fce","modified":1614434968342},{"_id":"themes/sagiri/source/lib/velocity-animate/velocity.min.js","hash":"69c85b9d6a931a7d3a5b0657e60112c31fb3b286","modified":1614434968341},{"_id":"themes/sagiri/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1612724551000},{"_id":"themes/sagiri/layout/_third-party/search/algolia-search/assets.swig","hash":"28ff4ed6714c59124569ffcbd10f1173d53ca923","modified":1612724551000},{"_id":"themes/sagiri/source/css/_common/components/back-to-top-sidebar.styl","hash":"4719ce717962663c5c33ef97b1119a0b3a4ecdc3","modified":1614434968204},{"_id":"themes/sagiri/source/css/_common/components/back-to-top.styl","hash":"52122a64b882bc214d2e50bc97108921c9f4a1db","modified":1614434968204},{"_id":"themes/sagiri/source/css/_common/components/buttons.styl","hash":"7e509c7c28c59f905b847304dd3d14d94b6f3b8e","modified":1614434968205},{"_id":"themes/sagiri/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1614434968205},{"_id":"themes/sagiri/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1614434968206},{"_id":"themes/sagiri/source/css/_common/scaffolding/base.styl","hash":"d98d3dbddc30324c2acd18f189edceba5eef3a23","modified":1614434968233},{"_id":"themes/sagiri/source/css/_common/outline/outline.styl","hash":"5cf872eefc1b8a863d0bc1ddd725997515596eb6","modified":1614434968233},{"_id":"themes/sagiri/source/css/_common/components/pagination.styl","hash":"2dbe80c75271cbe0913c13f3b1a6adbbca5fb503","modified":1614434968212},{"_id":"themes/sagiri/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1614434968222},{"_id":"themes/sagiri/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1614434968233},{"_id":"themes/sagiri/source/css/_common/scaffolding/mobile.styl","hash":"47a46583a1f3731157a3f53f80ed1ed5e2753e8e","modified":1614434968234},{"_id":"themes/sagiri/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1614434968234},{"_id":"themes/sagiri/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1614434968234},{"_id":"themes/sagiri/source/css/_common/scaffolding/tables.styl","hash":"64f5d56c08d74a338813df1265580ca0cbf0190b","modified":1614434968235},{"_id":"themes/sagiri/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1614434968242},{"_id":"themes/sagiri/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1614434968241},{"_id":"themes/sagiri/source/css/_schemes/Gemini/index.styl","hash":"18c3336ee3d09bd2da6a876e1336539f03d5a973","modified":1614434968238},{"_id":"themes/sagiri/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1614434968242},{"_id":"themes/sagiri/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1614434968243},{"_id":"themes/sagiri/source/css/_schemes/Muse/_menu.styl","hash":"02fb8fa6b6c252b6bed469539cd057716606a787","modified":1614434968242},{"_id":"themes/sagiri/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1614434968238},{"_id":"themes/sagiri/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1614434968238},{"_id":"themes/sagiri/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1614434968239},{"_id":"themes/sagiri/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1614434968239},{"_id":"themes/sagiri/source/css/_schemes/Mist/_posts-expanded.styl","hash":"3b25edfa187d1bbbd0d38b50dd013cef54758abf","modified":1614434968239},{"_id":"themes/sagiri/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1614434968240},{"_id":"themes/sagiri/source/css/_schemes/Mist/index.styl","hash":"9a5581a770af8964064fef7afd3e16963e45547f","modified":1614434968240},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_archive.styl","hash":"9878caf6ffb3b2278b19cf01edd8c65621c4fe01","modified":1614434968243},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_darling.styl","hash":"8f6367b5739f7a7be78c5373586e39ad9363cf78","modified":1614434968244},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_links.styl","hash":"fbadd7d35c1ae1fb328ae9e9e988e78cb5378783","modified":1614434968245},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_mai.styl","hash":"68696712685c803cee0629159cb8108f189142ad","modified":1614434968246},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_brand.styl","hash":"02d6fc3ce9c4965271cfc1056d1ffbca91f30f4b","modified":1614775978143},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_posts.styl","hash":"40400bff63d80ff1387938504403c4ebe109bfea","modified":1614434968246},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_layout.styl","hash":"19fa910e51ea97847b0a2b3d9e7fc87f24738e66","modified":1616739608218},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_footer.styl","hash":"c33ca8ea887a303f280033e1ab690885b1ab0178","modified":1614775978144},{"_id":"themes/sagiri/source/css/_schemes/Pisces/index.styl","hash":"f6612396af48c5035e858dda44f88c3c92321a16","modified":1614434968247},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_menu.styl","hash":"c2935db9d9af55ddf8c6ede093679da703418a97","modified":1615558013662},{"_id":"themes/sagiri/source/css/_schemes/Pisces/_sidebar.styl","hash":"ffb4245fbc40af32811db3baff2794fe5ffa74d4","modified":1615557955396},{"_id":"themes/sagiri/source/images/live2d/22/22.model.json","hash":"d543e88cfa6d7bdf5edb57f022e35b3c8461cafa","modified":1612724551000},{"_id":"themes/sagiri/source/lib/social-share.js/css/share.min.css","hash":"8a778a86f3ce9a042df6be63a9f1039631e351a5","modified":1614434968334},{"_id":"themes/sagiri/source/images/live2d/33/33.model.json","hash":"2dd3adc334c6e1684731e06fe6d943b800470fee","modified":1612724551000},{"_id":"themes/sagiri/source/lib/social-share.js/fonts/iconfont.eot","hash":"00ff749c8e202401190cc98d56087cdda716abe4","modified":1614434968335},{"_id":"themes/sagiri/source/lib/social-share.js/fonts/iconfont.svg","hash":"f0a1b849868a6bf351ff98dc3924a4e7254eb88b","modified":1614434968335},{"_id":"themes/sagiri/source/lib/social-share.js/fonts/iconfont.ttf","hash":"afd898f59d363887418669520b24d175f966a083","modified":1614434968335},{"_id":"themes/sagiri/source/lib/social-share.js/fonts/iconfont.woff","hash":"2e3fce1dcfbd6e2114e7bfbeaf72d3c62e15a1bd","modified":1614434968336},{"_id":"themes/sagiri/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1614434968337},{"_id":"themes/sagiri/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1614434968337},{"_id":"themes/sagiri/source/css/_common/components/footer/footer.styl","hash":"7905a7f625702b45645d8be1268cb8af3f698c70","modified":1614434968206},{"_id":"themes/sagiri/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1614434968209},{"_id":"themes/sagiri/source/css/_common/components/highlight/highlight.styl","hash":"25dc25f61a232f03ca72472b7852f882448ec185","modified":1614434968209},{"_id":"themes/sagiri/source/lib/social-share.js/js/jquery.share.min.js","hash":"7d3a7135cee30a5ccc38e2818a5bf8c03f7028a0","modified":1612724551000},{"_id":"themes/sagiri/source/lib/social-share.js/js/social-share.min.js","hash":"4798c0fe6c75506eebbbb3cab8cf01dcb7f59908","modified":1612724551000},{"_id":"themes/sagiri/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1614434968207},{"_id":"themes/sagiri/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1614434968209},{"_id":"themes/sagiri/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1614434968207},{"_id":"themes/sagiri/source/css/_common/components/header/menu.styl","hash":"a52a36a7f55970d6de05269d6087aa655a1dc240","modified":1614434968207},{"_id":"themes/sagiri/source/css/_common/components/header/site-meta.styl","hash":"e6f1b0389230df11fb8ece5a49b77a1f3f28f1c0","modified":1614434968208},{"_id":"themes/sagiri/source/css/_common/components/header/site-nav.styl","hash":"bf6a69b90c3530e6b528660c065a002225018333","modified":1614434968208},{"_id":"themes/sagiri/source/css/_common/components/pages/archive.styl","hash":"f5aa2ba3bfffc15475e7e72a55b5c9d18609fdf5","modified":1614434968210},{"_id":"themes/sagiri/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1614434968210},{"_id":"themes/sagiri/source/css/_common/components/pages/pages.styl","hash":"2039590632bba3943c39319d80ef630af7928185","modified":1614434968211},{"_id":"themes/sagiri/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1614434968211},{"_id":"themes/sagiri/source/css/_common/components/pages/schedule.styl","hash":"a82afbb72d83ee394aedc7b37ac0008a9823b4f4","modified":1614434968212},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"0a6c0efffdf18bddbc1d1238feaed282b09cd0fe","modified":1614434968219},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"89dd4f8b1f1cce3ad46cf2256038472712387d02","modified":1614434968219},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar-author.styl","hash":"920343e41c124221a17f050bbb989494d44f7a24","modified":1614434968219},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1614434968220},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"fb6728d916bc7f8314e9e24464c25598522f9197","modified":1614434968220},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"131f871a9a8a043df2209aef153aa7d1b6ba99b6","modified":1614434968220},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"77c92a449ce84d558d26d052681f2e0dd77c70c9","modified":1614434968220},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"f7784aba0c1cd20d824c918c120012d57a5eaa2a","modified":1614434968221},{"_id":"themes/sagiri/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1614434968222},{"_id":"themes/sagiri/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1614434968228},{"_id":"themes/sagiri/source/css/_common/components/third-party/algolia-search.styl","hash":"fd42777b9125fd8969dc39d4f15473e2b91b4142","modified":1614434968228},{"_id":"themes/sagiri/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1614434968229},{"_id":"themes/sagiri/source/css/_common/components/third-party/balloon.styl","hash":"8224eee9b5fa3cb5549855c1bec369a7540e78b4","modified":1614434968229},{"_id":"themes/sagiri/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1614434968230},{"_id":"themes/sagiri/source/css/_common/components/sidebar/sidebar.styl","hash":"4d26e51d674119d86108c442c08092a4eee1663a","modified":1614606845221},{"_id":"themes/sagiri/source/css/_common/components/third-party/gitment.styl","hash":"34935b40237c074be5f5e8818c14ccfd802b7439","modified":1614434968230},{"_id":"themes/sagiri/source/css/_common/components/third-party/headroom.styl","hash":"fb2a58ddd46401718682297b72d6e584cf484676","modified":1614434968231},{"_id":"themes/sagiri/source/css/_common/components/third-party/han.styl","hash":"cce6772e2cdb4db85d35486ae4c6c59367fbdd40","modified":1614434968230},{"_id":"themes/sagiri/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1614434968232},{"_id":"themes/sagiri/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1614434968232},{"_id":"themes/sagiri/source/css/_common/components/third-party/needsharebutton.styl","hash":"a5e3e6b4b4b814a9fe40b34d784fed67d6d977fa","modified":1614434968232},{"_id":"themes/sagiri/source/css/_common/components/third-party/third-party.styl","hash":"bf4b08934b490d8629811c02823f22b04ca9a15b","modified":1614434968233},{"_id":"themes/sagiri/source/css/_common/components/post/post-collapse.styl","hash":"72816be5de30ccb77aba4b2ae9cd4458d1570e4d","modified":1614434968214},{"_id":"themes/sagiri/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1614434968214},{"_id":"themes/sagiri/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1614434968215},{"_id":"themes/sagiri/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1614434968213},{"_id":"themes/sagiri/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1614434968215},{"_id":"themes/sagiri/source/css/_common/components/post/post-meta.styl","hash":"aea21141015ca8c409d8b33e3e34ec505f464e93","modified":1614434968216},{"_id":"themes/sagiri/source/css/_common/components/post/post-nav.styl","hash":"fa84a9673288c6b0e3bea4415f9092089ba171dc","modified":1614434968216},{"_id":"themes/sagiri/source/css/_common/components/post/post-reward.styl","hash":"36332c8a91f089f545f3c3e8ea90d08aa4d6e60c","modified":1614434968216},{"_id":"themes/sagiri/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1614434968217},{"_id":"themes/sagiri/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1614434968216},{"_id":"themes/sagiri/source/css/_common/components/post/post-title.styl","hash":"e874debecedd35618d83519deaf0fb38c112a932","modified":1614434968217},{"_id":"themes/sagiri/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1614434968217},{"_id":"themes/sagiri/source/css/_common/components/post/post-widgets.styl","hash":"e4055a0d2cd2b0ad9dc55928e2f3e7bd4e499da3","modified":1614434968218},{"_id":"themes/sagiri/source/css/_common/components/post/post-expand.styl","hash":"404405a9a4564c43904322c25199ab8c8d106271","modified":1617030563073},{"_id":"themes/sagiri/source/css/_common/components/post/post.styl","hash":"7493f375ff6a0d152417308bbb3e8d9edfba7454","modified":1614434968218},{"_id":"themes/sagiri/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1614434968223},{"_id":"themes/sagiri/source/css/_common/components/tags/exturl.styl","hash":"1b3cc9f4e5a7f6e05b4100e9990b37b20d4a2005","modified":1614434968223},{"_id":"themes/sagiri/source/css/_common/components/tags/full-image.styl","hash":"b8969e1654eec89a0fd10d88b337fee9cb03cd44","modified":1614434968223},{"_id":"themes/sagiri/source/css/_common/components/tags/group-pictures.styl","hash":"3f7e609546e342dc8307b8c054cdcfc39a52b0bb","modified":1614434968224},{"_id":"themes/sagiri/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1614434968224},{"_id":"themes/sagiri/source/css/_common/components/tags/note.styl","hash":"32c9156bea5bac9e9ad0b4c08ffbca8b3d9aac4b","modified":1614434968225},{"_id":"themes/sagiri/source/css/_common/components/tags/note-modern.styl","hash":"ee7528900578ef4753effe05b346381c40de5499","modified":1614434968224},{"_id":"themes/sagiri/source/css/_common/components/tags/tags.styl","hash":"ead0d0f2321dc71505788c7f689f92257cf14947","modified":1614434968227},{"_id":"themes/sagiri/source/css/_common/components/tags/tabs.styl","hash":"4ab5deed8c3b0c338212380f678f8382672e1bcb","modified":1614434968227},{"_id":"themes/sagiri/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1614434968243},{"_id":"themes/sagiri/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1614434968240},{"_id":"themes/sagiri/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1614434968241},{"_id":"themes/sagiri/source/images/header-darling2.webp","hash":"9f283b3656471833c7f768e97852140dfe12742f","modified":1614434968271},{"_id":"themes/sagiri/source/images/header-sagiri.jpg","hash":"abe0402f182eb0580a284924cb0b738ab644a0d3","modified":1614434968312},{"_id":"themes/sagiri/source/images/header.jpg","hash":"abe0402f182eb0580a284924cb0b738ab644a0d3","modified":1614434968313},{"_id":"themes/sagiri/source/images/live2d/33/33.2048/texture_00.webp","hash":"ea15326bcbb692a272dbd793163e55c030fedda8","modified":1614434968319},{"_id":"themes/sagiri/source/images/live2d/22/22.2048/texture_00.webp","hash":"e5dafe1d0eb1859c5be3643fc0723e4d0b10f7f8","modified":1614434968316},{"_id":"themes/sagiri/yarn.lock","hash":"9a87d603c6cf99197db50f94b744b4a106504dde","modified":1614434968355},{"_id":"themes/sagiri/src/live2d.js","hash":"d7209920a942eed58a9b12f92e50236e6feaccd2","modified":1614434968348},{"_id":"themes/sagiri/source/images/header-gyx.webp","hash":"194c54813297f72538dd2ae62ae538ce9ba4245d","modified":1614434968300},{"_id":"themes/sagiri/source/images/header-mai.webp","hash":"a5aa4f650bf5a998fd792d035b76171e908d9c32","modified":1614434968311},{"_id":"themes/sagiri/source/images/live2d/22/22.moc","hash":"63a7992de8c4658ee432822b5710565481610f0e","modified":1612724551000},{"_id":"themes/sagiri/source/images/live2d/33/33.moc","hash":"80a030342ac1b6a7cd8acb441bcb207d8803b76b","modified":1612724551000},{"_id":"themes/sagiri/source/images/live2d/22/22.2048/texture_00.png","hash":"b002297b31421137a64fad594f7593133cea3cbf","modified":1612724551000},{"_id":"themes/sagiri/source/images/header-darling2.jpg","hash":"e2ae6c5df17411838955d231e9a76321b2001c5c","modified":1614434968269},{"_id":"themes/sagiri/source/images/header-gyx-s.png","hash":"2b6b2f9904f0bbd35715adae276e7d8fc20572f2","modified":1614434968289},{"_id":"themes/sagiri/source/images/header-mai.jpg","hash":"b9890a3d76f62437462475a2c51c6b8442898379","modified":1614434968310},{"_id":"themes/sagiri/source/lib/velocity-animate/velocity.js","hash":"44ae2520aa8ad47cf56b67bdba64e18d542c8618","modified":1614434968340},{"_id":"themes/sagiri/source/images/header-darlings.webp","hash":"0d3e794a5a402d615ec4a36fb525fedc3487a026","modified":1614434968286},{"_id":"themes/sagiri/source/js/video-report.html","hash":"e4e30b0222ebba441ccfe81b29cbc1cc4bcde9d1","modified":1614612785480},{"_id":"themes/sagiri/source/js/sagiri.min.js","hash":"074197c73194e503f1d173e27b042dc79cbd91a2","modified":1616739608221},{"_id":"themes/sagiri/source/images/header-darlings.jpg","hash":"20156313f1e9b02f28da3f5ca7b7ac607c6ea4f0","modified":1614434968285},{"_id":"themes/sagiri/source/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1614434968327},{"_id":"themes/sagiri/source/images/header-darling4.webp","hash":"cd9c479ef8c5d0e1d5d6d77259ca5e1522db9b8f","modified":1614434968283},{"_id":"themes/sagiri/source/images/header-darling3.jpg","hash":"da8965efff676a86af6ed61451c3c13fe8a30bf3","modified":1614434968274},{"_id":"themes/sagiri/source/images/header-leg.jpg","hash":"426445281820258e0859b78e3b5e8279546dc3f5","modified":1614434968304},{"_id":"themes/sagiri/source/images/header-leg.webp","hash":"fd1692cd000bc739cc478785f2fbb2daa759ca5f","modified":1614434968308},{"_id":"themes/sagiri/source/images/header-darling3.webp","hash":"d8cdee7124b0a0e21fa9cc82bbb64134d3778061","modified":1614434968275},{"_id":"themes/sagiri/source/images/live2d/33/33.2048/texture_00.png","hash":"6d710da6056de69bfe0c33ac1b9e837b327b2f7b","modified":1612724551000},{"_id":"themes/sagiri/source/images/header-darling4.jpg","hash":"e64b1131d266f98e81d68ca36dcf5324cb901e50","modified":1614434968282},{"_id":"themes/sagiri/source/images/header-gyx.png","hash":"c72a623d4407c90df6cfb6ca22b1337ded8d831f","modified":1614434968299},{"_id":"themes/sagiri/source/js/sagiri.min.js.map","hash":"7b45a4d64e093a54775c99411e708349904f29dc","modified":1616739608228},{"_id":"public/manifest.json","hash":"d2076ca47934539b6d09ef0c8de71bfdfb967928","modified":1620919254614},{"_id":"public/sw.js","hash":"bca0dd34d113d72aad774c12d018b386e1acc4ce","modified":1620919254614},{"_id":"public/atom.xml","hash":"17435affb0f1cbf469fbfbac33264a09be0af6c9","modified":1620919254614},{"_id":"public/sitemap.xml","hash":"23ffcebf422e0b638fa09d286b4caeb30e32cb1c","modified":1620919254614},{"_id":"public/404.html","hash":"85021dfbe174e00da67e5a699030df3313930b97","modified":1620919254614},{"_id":"public/archives/index.html","hash":"fe11c9bbadf3982b93cdb80f1a7dc0f411a0a9de","modified":1620919254614},{"_id":"public/categories/index.html","hash":"c430807d67624637382eb8141a8a695da41103a5","modified":1620919254614},{"_id":"public/donate/index.html","hash":"0a36e13b845bcdac35b3029d305c1c17fc95159a","modified":1620919254614},{"_id":"public/message/index.html","hash":"b66fd8a9dcd328a7442fdf76d9ea597fbebba259","modified":1620919254614},{"_id":"public/tags/index.html","hash":"f5521564aeba474b4505da073c3d31a051ed3981","modified":1620919254614},{"_id":"public/node中间层及简单api编写/index.html","hash":"c38e34930ac7d1996caf69f2cb8f4f815117cd33","modified":1620919254614},{"_id":"public/堆与栈/index.html","hash":"baac36a0b3999274742627803f2c9efaa3ce63a8","modified":1620919254614},{"_id":"public/Javascript链表数据结构/index.html","hash":"ad48147308c9ad6e2ff7f72d47351b45d5c7988d","modified":1620919254614},{"_id":"public/了解Fetch-api/index.html","hash":"181670be8dabbcca4c977963bcfd53e9461e5a6f","modified":1620919254614},{"_id":"public/vue懒加载与分组打包/index.html","hash":"5fa374de4360ea0459aa60c51940edd9756ec638","modified":1620919254614},{"_id":"public/keep-alive小知识/index.html","hash":"c15771e1c5e93244dfcbabf41830a53bad608b03","modified":1620919254614},{"_id":"public/移动端监听返回键/index.html","hash":"db4e5ecb4c7bffab61c76b1b64ce9752195aa1c0","modified":1620919254614},{"_id":"public/Jenkins对前端应用做自动化构建/index.html","hash":"19a7b09bacf43d083f8c01b8aa30def91d8ecb06","modified":1620919254614},{"_id":"public/正则表达式/index.html","hash":"cf708d6429cb09924d1725eb78602a9754216d1f","modified":1620919254614},{"_id":"public/webpack优化之preload和prefetch/index.html","hash":"6ca82e8336a63d0723c62c01992ac56ba67b5807","modified":1620919254614},{"_id":"public/脚手架集成/index.html","hash":"5a92a74f55113dc28b46610a18af26e17bd6e51b","modified":1620919254614},{"_id":"public/JS的number类型最大值/index.html","hash":"291bd79038249a57bc485ceebdccb9a590341171","modified":1620919254614},{"_id":"public/JavaScript动态规划和贪心算法/index.html","hash":"ac86a821d12ba7450dde2cc28ac12ddcbcb2588f","modified":1620919254614},{"_id":"public/webpack打包优化/index.html","hash":"6d5370673e7bd181ca02e70abd5141635e7d48cb","modified":1620919254614},{"_id":"public/常见的四种post方式/index.html","hash":"b2d91f920c276abf8ad461c42475958491041d30","modified":1620919254614},{"_id":"public/Vue小知识点运用/index.html","hash":"66d122a4e8a35773c04f778aa8425dc3d940779c","modified":1620919254614},{"_id":"public/webWorkers/index.html","hash":"4220f06d7ce33d3d0d9c975bd9d77dee3afeaa17","modified":1620919254614},{"_id":"public/jQuery-组件封装/index.html","hash":"9a79196b04160b33526f40f3e273439a942e688f","modified":1620919254614},{"_id":"public/call、applay、bind/index.html","hash":"df4d18186920d81fdb8b76744431d5b978657c82","modified":1620919254614},{"_id":"public/闭包/index.html","hash":"77b95c5156c55aac87de8d9c1d9ecea15daa9a45","modified":1620919254614},{"_id":"public/BFC详解/index.html","hash":"c62ea7b3302aabe019d7dd6b7fcc88ce13efa1ba","modified":1620919254614},{"_id":"public/css-小知识/index.html","hash":"828df6b9b8be2a76607004b4b46a6e83f3eb7dec","modified":1620919254614},{"_id":"public/工作中所遇到的问题/index.html","hash":"3dade3243029f7d7d35b3939a1969f9ee1b5d05c","modified":1620919254614},{"_id":"public/Vue-js内部运行机制/index.html","hash":"2281a4fc4ea02475c1dcc5bf2cb81fb05e456233","modified":1620919254614},{"_id":"public/jQuery-源码学习（一）/index.html","hash":"08b7dc69025be1f87d6e78fda5dbc4ad967b61e9","modified":1620919254614},{"_id":"public/函数柯里化/index.html","hash":"ef790a04a4c7e3bd07a2cb734809e03cabafdde6","modified":1620919254614},{"_id":"public/浏览器渲染与解析/index.html","hash":"19d3ae419baf8f15b9d062af56e5faa30daa8874","modified":1620919254614},{"_id":"public/innerHTML与createElement/index.html","hash":"28a737242d0c8c0cbef15ac3e0be8b4d1b6fc9d7","modified":1620919254614},{"_id":"public/Event-loop-JS/index.html","hash":"c2ea227e4c2430f16ae0d694c15f283ac1d35e19","modified":1620919254614},{"_id":"public/浏览器存储机制/index.html","hash":"582fc670e09ca8cf79b5a0514f3eb0c5f6267ea7","modified":1620919254614},{"_id":"public/跨域-解决方案/index.html","hash":"2eedb531853f1a4a01204f79df62316dbb916df1","modified":1620919254614},{"_id":"public/require与import-的区别/index.html","hash":"4b5085d4307ab3890c7e894f3d852ae8ee4fe1cf","modified":1620919254614},{"_id":"public/HTTP2/index.html","hash":"89c7c40c9f807189287620ea4e6c65ff6cfd0a32","modified":1620919254614},{"_id":"public/小知识点积累/index.html","hash":"d449fe6c496f56f576dff6398bba46cd94c44d3e","modified":1620919254614},{"_id":"public/优化/index.html","hash":"31041054bdb864e46cdc81322166a9454a9d9b42","modified":1620919254614},{"_id":"public/有趣JS题/index.html","hash":"bc9db5349759b32f8212782b0fd4aa937c1859c4","modified":1620919254614},{"_id":"public/webpack简介/index.html","hash":"1d5a78b55d255086a239b1662771ca5930a47039","modified":1620919254614},{"_id":"public/JS原生-ES6/index.html","hash":"1c989d82441245a542d28b4ce00dcb0a92473424","modified":1620919254614},{"_id":"public/this指向/index.html","hash":"686da29a88d02dab5221b0392eab904373b0bca1","modified":1620919254614},{"_id":"public/作用域/index.html","hash":"125b4cb9fbc76d9bcf3e74c42ad4fb2a55397752","modified":1620919254614},{"_id":"public/疑难杂问整理（原生JS）/index.html","hash":"3c0614c375107663186cda5f34f2bbfa7b394d40","modified":1620919254614},{"_id":"public/一篇弄懂继承/index.html","hash":"c937e7cf5b1f5f42624fb8387445d6ae81ba9b3c","modified":1620919254614},{"_id":"public/彻底贯通原型链/index.html","hash":"df9a9f9e399320eefb843eb9ed6a72284f9ebe38","modified":1620919254614},{"_id":"public/JS基础-ES5/index.html","hash":"8b80052b5289589837f0ab9652c2587bd3c86993","modified":1620919254614},{"_id":"public/字符串操作方法/index.html","hash":"8803ffa29a4d71f87dc32db6b161cee9d7fa5756","modified":1620919254614},{"_id":"public/JS代码片段/index.html","hash":"abe38232f3cce221ff1b59ec5ed61923c83f5808","modified":1620919254614},{"_id":"public/如何实现双向数据绑定-mvvm/index.html","hash":"fe66d947c4e85a27396b0b266d6fda533a421ee2","modified":1620919254614},{"_id":"public/Object-defineProperty/index.html","hash":"1228ccc97c25e2730aa51fa3029ab739caef05ba","modified":1620919254614},{"_id":"public/数组操作方法/index.html","hash":"c099f7f960e533327fb89e678ca52e686c89094c","modified":1620919254614},{"_id":"public/PWA-offline/index.html","hash":"9eb91728d8b01c15366db48dcfbcffcdc45eca3c","modified":1620919254614},{"_id":"public/angular基础/index.html","hash":"25bcc2154f6bec1762fc15f3b4055683e573fa16","modified":1620919254614},{"_id":"public/Observable/index.html","hash":"e806231875499f79ff34b6cb1061ee4e8ba1a314","modified":1620919254614},{"_id":"public/PWA-pushMessage/index.html","hash":"14798689a6cd63c046f6d384023a832ec0c611c5","modified":1620919254614},{"_id":"public/HTTPS/index.html","hash":"3584f28901fa971f5c60e949149008d365134743","modified":1620919254614},{"_id":"public/archives/2017/index.html","hash":"f543a0e3c5bba4e55187890745817f3b6182559d","modified":1620919254614},{"_id":"public/archives/2017/07/index.html","hash":"a774835964ecbcfc93bfebcbd483a6fae2f5d527","modified":1620919254614},{"_id":"public/archives/2017/09/index.html","hash":"2e8612a7ab24341b0db8907814453a8234d62ebd","modified":1620919254614},{"_id":"public/archives/2017/11/index.html","hash":"b1755401581d10610a77f871b805fe74b5c2f7ec","modified":1620919254614},{"_id":"public/archives/2018/index.html","hash":"0013811cfa8436c858e9a95572fe6724fc935b8f","modified":1620919254614},{"_id":"public/archives/2018/01/index.html","hash":"ec1922b3c46b2541e7e39933af3afb711540d7d4","modified":1620919254614},{"_id":"public/archives/2018/03/index.html","hash":"394e12b46cb1d9ff0d81447174a48a97485741a0","modified":1620919254614},{"_id":"public/archives/2018/05/index.html","hash":"25f1b5932d8ebec6c7a57ab555a595f3a05d87c5","modified":1620919254614},{"_id":"public/archives/2018/04/index.html","hash":"b9e1cb13384d4d10176b867fc6daa1de836f8de3","modified":1620919254614},{"_id":"public/archives/2018/06/index.html","hash":"9902504c5e3b4bb7c4b62d31eb0f4d972d664384","modified":1620919254614},{"_id":"public/archives/2018/11/index.html","hash":"8b9d1462ca06b22222616753f75ffec5eca86522","modified":1620919254614},{"_id":"public/archives/2019/index.html","hash":"0623eee18a14e617e2b3763703bd2757d5b082ea","modified":1620919254614},{"_id":"public/archives/2019/03/index.html","hash":"9c111739596231d09b1f20280382da9e510ff076","modified":1620919254614},{"_id":"public/archives/2019/04/index.html","hash":"77f18360e436bcb5389c436fea579342bc81eb10","modified":1620919254614},{"_id":"public/archives/2019/07/index.html","hash":"fbaa0f77e07df2f6cb3d44c05ebd59bbf4c64cfe","modified":1620919254614},{"_id":"public/archives/2019/08/index.html","hash":"72713f9a5a45f59a610cfee19d9dbac3cc4f2079","modified":1620919254614},{"_id":"public/archives/2019/09/index.html","hash":"83638a064985059edc3f022cf19043fc9943f364","modified":1620919254614},{"_id":"public/archives/2019/12/index.html","hash":"a8dedfa21f65cfdd461fc5fe663f83fd038fa83c","modified":1620919254614},{"_id":"public/archives/2020/index.html","hash":"5c90dd323756e5fd644db8ef9e424b9acc994b7e","modified":1620919254614},{"_id":"public/archives/2020/03/index.html","hash":"46647fd59a2f13fa84eaa07d2d82fdafb7a51379","modified":1620919254614},{"_id":"public/archives/2020/04/index.html","hash":"5cfceea90408b37d6fc50ff223b2f641bfd14886","modified":1620919254614},{"_id":"public/archives/2020/09/index.html","hash":"19c936b4192a084c8fe9b2e6b5c5aa55c720876e","modified":1620919254614},{"_id":"public/archives/2021/index.html","hash":"42ec44c4ebd8b4eb1571a5c9086dae469e4a5d7c","modified":1620919254614},{"_id":"public/archives/2021/04/index.html","hash":"ed4497546c2de2bbf43cbcf9b57296de6c047985","modified":1620919254614},{"_id":"public/categories/css/index.html","hash":"0e348e8e6ebfc745894dc5fab720a48cb30430c5","modified":1620919254614},{"_id":"public/categories/JavaScript/index.html","hash":"618f89d4c18c07f2a643d2af8a80b8caa2be89e8","modified":1620919254614},{"_id":"public/categories/Web/index.html","hash":"71931684397afa61a89d95dda2aaa83190a02700","modified":1620919254614},{"_id":"public/categories/工具/index.html","hash":"8587970807617bc5e878cb848996cebbce6adcd9","modified":1620919254614},{"_id":"public/categories/rx-js/index.html","hash":"e99c9b2851cb17f9564500e4608741daf88666dc","modified":1620919254614},{"_id":"public/categories/Vue/index.html","hash":"64284113333bfb678ee46a088d806e78530a8291","modified":1620919254614},{"_id":"public/categories/angular/index.html","hash":"3cc1563761c88a6d427a541801046fe2b6817240","modified":1620919254614},{"_id":"public/categories/jQuery/index.html","hash":"1cb854bbeac69262057146150964ba2078cf3b28","modified":1620919254614},{"_id":"public/categories/webpack/index.html","hash":"0f25c2edf18e984a7e27f85aa10bb55b88c95ab7","modified":1620919254614},{"_id":"public/categories/Node/index.html","hash":"1da8abcc382eed19e9b85c12a957fd4e21965d00","modified":1620919254614},{"_id":"public/index.html","hash":"1aa5d72b1c1c9cb6441ddbac897e04771c4945bc","modified":1620919254614},{"_id":"public/page/2/index.html","hash":"ce8eaa49887025dfe7355de397656aa4de810a8d","modified":1620919254614},{"_id":"public/page/3/index.html","hash":"96e0301761ce94cf3c7a50ca7ed003422a8b70d2","modified":1620919254614},{"_id":"public/page/4/index.html","hash":"f986efac3893db0720febb75e42e06d9f8dcb56a","modified":1620919254614},{"_id":"public/page/5/index.html","hash":"0ea50d1ba96fa751f740fd6794fb78cab097a1b0","modified":1620919254614},{"_id":"public/page/6/index.html","hash":"6b95669bbbb8267d522f56cccb83d60b3cfac820","modified":1620919254614},{"_id":"public/tags/Vue/index.html","hash":"5a8f965e2c2b47d59e7156e8fd336f81e550323e","modified":1620919254614},{"_id":"public/CNAME","hash":"1f2b8e1d37bc03c80a3d53a586651e71ef38f19d","modified":1620919254614},{"_id":"public/android-chrome-192x192.webp","hash":"f61b1615c82acf52aacac07038ecc4fbf130fc9f","modified":1620919254614},{"_id":"public/android-chrome-192x192.png","hash":"271e0371f46fbd5720d8761e1d68253a91fa1c95","modified":1620919254614},{"_id":"public/apple-touch-icon.webp","hash":"ee326b691b0b2c7997d75cb7caa6487f6d2828bf","modified":1620919254614},{"_id":"public/android-chrome-256x256.webp","hash":"1f05572eb58ddd35c0b3885f3e906c523c886df3","modified":1620919254614},{"_id":"public/browserconfig.xml","hash":"99abe926a04d43f5373f119b633b269e5a15a901","modified":1620919254614},{"_id":"public/apple-touch-icon.png","hash":"6e89a84032262cbf1ebe5aee23edccf29081d1f2","modified":1620919254614},{"_id":"public/android-chrome-256x256.png","hash":"f20d08929cb840cb5148227cdbe9c219b887d95f","modified":1620919254614},{"_id":"public/failure.ico","hash":"5eec5c163400d8ece74286da49130da1ead3f6f6","modified":1620919254614},{"_id":"public/favicon-16x16.png","hash":"20b70672bc4a70231e68fb24b9cf7a55b4e684a5","modified":1620919254614},{"_id":"public/favico.ico","hash":"2d7ec086b029d8a224a4dae1a428c6a3f6209d92","modified":1620919254614},{"_id":"public/favicon-16x16.webp","hash":"df3f7e40344a5b37e73e8783c6a9caa2d2c01acf","modified":1620919254614},{"_id":"public/favicon-32x32.png","hash":"c1d0ec90c13b3cacc1e75d71658111e0af178912","modified":1620919254614},{"_id":"public/favicon-32x32.webp","hash":"078619032ccb0894c9828659216e039b44d2c1de","modified":1620919254614},{"_id":"public/favicon.ico","hash":"2d7ec086b029d8a224a4dae1a428c6a3f6209d92","modified":1620919254614},{"_id":"public/mstile-150x150.png","hash":"f632b2a90a15c0024db2fd912010e87f210b5669","modified":1620919254614},{"_id":"public/mstile-150x150.webp","hash":"81b89e1acbf4c35f220289bb507e13353a28d4de","modified":1620919254614},{"_id":"public/safari-pinned-tab.svg","hash":"6fb3379bfd582862c03d0695b4e767421e6a1b61","modified":1620919254614},{"_id":"public/images/2016-08-25_wxd.png","hash":"0c730f3963f3042d0dfcc78837d9a4cf2f05f8fc","modified":1620919254614},{"_id":"public/images/2016-08-25_wxd.webp","hash":"d69056969d3e7101ebb9f4d3a382722093fff86c","modified":1620919254614},{"_id":"public/images/1000.webp","hash":"5cc5f6f4d35bbfed3dec56621e253af380523668","modified":1620919254614},{"_id":"public/images/2016-08-25_zfbd.png","hash":"bc3750d18e6bf1d5f1e24c25455b00d26c3ff447","modified":1620919254614},{"_id":"public/images/2016-08-25_zfbd.webp","hash":"e4b890a58f4fa1448a0a2d5c9a6c9a747ab5cae5","modified":1620919254614},{"_id":"public/images/avatar.jpg","hash":"663809c02cd10187b8903189eb4c6aed35e61a90","modified":1620919254614},{"_id":"public/images/wxwlive1.jpg","hash":"2eb21b491632f9d5b548c21efdffc6ef70e0c48b","modified":1620919254614},{"_id":"public/images/wxwlive1.webp","hash":"b70192112f45b5fd5ad3cb0dcb872284a3776479","modified":1620919254614},{"_id":"public/images/cli/脚手架构建流程.png","hash":"58a1fcb2b0a77810a9ee4749cc543f80f4917c43","modified":1620919254614},{"_id":"public/images/common/bff-1.jpeg","hash":"6a7568c3438ff5b4e2c6e882396c9e2dcea830b8","modified":1620919254614},{"_id":"public/images/common/bff-2.jpeg","hash":"2c6424dc565ecf31754a9e6089915a59d1b7ed40","modified":1620919254614},{"_id":"public/images/cli/第三方库支持.png","hash":"fdb3b347aadd4e71d0397eed3cfa1509b3ad507c","modified":1620919254614},{"_id":"public/images/common/linked-list.jpg","hash":"cb1825a3d3099c45a7788da2ab3535e11be445bd","modified":1620919254614},{"_id":"public/images/common/http2_1.jpg","hash":"8d8a0845f7cac1afc7aeafb7b3d47b86be6a6bc3","modified":1620919254614},{"_id":"public/images/prototype/1.png","hash":"b56d7ed5068f6f314ba1d48a694f3917111fa659","modified":1620919254614},{"_id":"public/images/prototype/2.png","hash":"fc3a6c80a4d80fb8b5889c506e2ad7592b544134","modified":1620919254614},{"_id":"public/images/problem/2.png","hash":"37ce91da9e0bf6fd101d1025be458d3ca9f09da7","modified":1620919254614},{"_id":"public/fonts/Candyshop.otf","hash":"2d4fffc6d278cc8010f75422246bf368a764c125","modified":1620919254614},{"_id":"public/fonts/sigmarone1.woff2","hash":"35d4f8be95cbf9ced2c3eae1bfe63d5ce8ee7214","modified":1620919254614},{"_id":"public/fonts/sigmarone2.woff2","hash":"feaa47ccbf19dfb2812fa8306f421b88e90af723","modified":1620919254614},{"_id":"public/fonts/sigmarone3.woff2","hash":"5f62e2560d08e71274fac25c49825113a09776c7","modified":1620919254614},{"_id":"public/images/DIYgod-avatar.jpg","hash":"81d0b371df55b5a1bb0c9b258046754dd2c0729d","modified":1620919254614},{"_id":"public/images/DIYgod-avatar.webp","hash":"a7200fad65f069ca3f3256b4dd573d9d2e36c829","modified":1620919254614},{"_id":"public/images/DIYgod.jpg","hash":"81d0b371df55b5a1bb0c9b258046754dd2c0729d","modified":1620919254614},{"_id":"public/images/alipay.png","hash":"bc3750d18e6bf1d5f1e24c25455b00d26c3ff447","modified":1620919254614},{"_id":"public/images/DIYgod.webp","hash":"a7200fad65f069ca3f3256b4dd573d9d2e36c829","modified":1620919254614},{"_id":"public/images/alipay.webp","hash":"e4b890a58f4fa1448a0a2d5c9a6c9a747ab5cae5","modified":1620919254614},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1620919254614},{"_id":"public/images/apple-touch-icon-next.webp","hash":"a67fcf955e00f160cf687335673a8cbdc587d456","modified":1620919254614},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1620919254614},{"_id":"public/images/card-avatar.webp","hash":"980ebd262b2c68baa784a58be7afaa55edd60f28","modified":1620919254614},{"_id":"public/images/cc-by-nc-sa.png","hash":"cb36e36c3e3959a54ac289e309a4a89a016107bc","modified":1620919254614},{"_id":"public/images/cc-by-nc-nd.png","hash":"f7839bdd799c452a4e807a2365849acc0748b3fd","modified":1620919254614},{"_id":"public/images/cc-by-nc-nd.webp","hash":"a9da48b761a7586f899f826170bc86d26c2ec08a","modified":1620919254614},{"_id":"public/images/cc-by-nc-sa.webp","hash":"5fde7a2f79adc7d200cac995df45a84d64b2494c","modified":1620919254614},{"_id":"public/images/cc-by-nc.png","hash":"eaf656bdd1ff61c345a7d42b94ac6f25435f5c42","modified":1620919254614},{"_id":"public/images/card.webp","hash":"980ebd262b2c68baa784a58be7afaa55edd60f28","modified":1620919254614},{"_id":"public/images/cc-by-nc.webp","hash":"5c8a54299712f843d290fed413925a2c3c3318c4","modified":1620919254614},{"_id":"public/images/cc-by-nd.png","hash":"6420f0e99cb3e90d3c37e0e8513d16ada14fed37","modified":1620919254614},{"_id":"public/images/cc-by-nd.webp","hash":"2a5cc8580f7aadb947e558360bda5dd663eeecc1","modified":1620919254614},{"_id":"public/images/card.jpg","hash":"f2bb19ea1343999976c0b817c1f35949eac7a709","modified":1620919254614},{"_id":"public/images/cc-by-sa.png","hash":"d62ae0fd7204bf889b3f2cbe89eae5865a71c056","modified":1620919254614},{"_id":"public/images/cc-by-sa.webp","hash":"9afcad8c2cb3f4170b2a8bb5fd6fcc4c34616c19","modified":1620919254614},{"_id":"public/images/cc-by.png","hash":"63f01c43cb5d03cb83d3c867c5ecb768cd89d9df","modified":1620919254614},{"_id":"public/images/cc-by.webp","hash":"9a364fca486147d5fe120487edbcc5617d4a1759","modified":1620919254614},{"_id":"public/images/cc-zero.png","hash":"fd4ce5a5851ef47c3b525652cc3ae8128d405c8f","modified":1620919254614},{"_id":"public/images/cc-zero.webp","hash":"bbe5c624b52986f383c0bc0aed4e4c93b1f3b680","modified":1620919254614},{"_id":"public/images/cursor.ico","hash":"cd8349fb9cef6c217fc364cf35eae6819cebf5d6","modified":1620919254614},{"_id":"public/images/footer.png","hash":"5f27807ccb8beeed9a909571783797901c52c3b7","modified":1620919254614},{"_id":"public/images/footer.webp","hash":"d5b03e8d76bcfc4f966ea3408bdc0b90874ca0e8","modified":1620919254614},{"_id":"public/images/header-darling.webp","hash":"84ea4042c5e4a57e9b1832fdf4db536aa9d2e040","modified":1620919254614},{"_id":"public/images/header-gyx-s.webp","hash":"d16a445dadc05c1976ffbf3ab88de618d1db360a","modified":1620919254614},{"_id":"public/images/header-sagiri.webp","hash":"8ffc6ce60e2171c0528bef7a2a5692fd873f9a42","modified":1620919254614},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1620919254614},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1620919254614},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1620919254614},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1620919254614},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1620919254614},{"_id":"public/images/header.webp","hash":"8ffc6ce60e2171c0528bef7a2a5692fd873f9a42","modified":1620919254614},{"_id":"public/images/scroll.webp","hash":"f5e9b67b639f03e0a1ccf171b17d1b5ee811765d","modified":1620919254614},{"_id":"public/images/scroll.png","hash":"443930af0ee54778babad7724291bfed9b431dd5","modified":1620919254614},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1620919254614},{"_id":"public/images/searchicon.webp","hash":"4dc91243df4ec53a3a98fd0ec9a4abaa15606dd3","modified":1620919254614},{"_id":"public/images/wechatpay.png","hash":"0c730f3963f3042d0dfcc78837d9a4cf2f05f8fc","modified":1620919254614},{"_id":"public/js/sagiri.min.js.LICENSE.txt","hash":"8bdbc2c891e7510d120c7c7bbb42623edf9129c6","modified":1620919254614},{"_id":"public/images/wechatpay.webp","hash":"d69056969d3e7101ebb9f4d3a382722093fff86c","modified":1620919254614},{"_id":"public/lib/social-share.js/fonts/iconfont.eot","hash":"00ff749c8e202401190cc98d56087cdda716abe4","modified":1620919254614},{"_id":"public/lib/social-share.js/fonts/iconfont.svg","hash":"f0a1b849868a6bf351ff98dc3924a4e7254eb88b","modified":1620919254614},{"_id":"public/lib/social-share.js/fonts/iconfont.ttf","hash":"afd898f59d363887418669520b24d175f966a083","modified":1620919254614},{"_id":"public/lib/social-share.js/fonts/iconfont.woff","hash":"2e3fce1dcfbd6e2114e7bfbeaf72d3c62e15a1bd","modified":1620919254614},{"_id":"public/images/1000.jpg","hash":"0076f1999f8d448e3afbca0bda5ed4638b4888b6","modified":1620919254614},{"_id":"public/images/common/box.png","hash":"00295511106844b064a28315310a0f19ba23cc0a","modified":1620919254614},{"_id":"public/images/prototype/constructor.png","hash":"da1cb28b40a898ed26815dd151e350e4efb790bd","modified":1620919254614},{"_id":"public/images/prototype/prototype.image","hash":"e782d4c95a5cde5271f895d6acd26f9e0c663a71","modified":1620919254614},{"_id":"public/images/problem/1.png","hash":"a566f9497bb5755ded08e82a615eabba2b2b668b","modified":1620919254614},{"_id":"public/images/card-avatar.jpg","hash":"f2bb19ea1343999976c0b817c1f35949eac7a709","modified":1620919254614},{"_id":"public/images/header-darling2.webp","hash":"9f283b3656471833c7f768e97852140dfe12742f","modified":1620919254614},{"_id":"public/images/header-darling.jpg","hash":"428d430fd9086c207a4a18d6c55308a74441bfe5","modified":1620919254614},{"_id":"public/images/header-sagiri.jpg","hash":"abe0402f182eb0580a284924cb0b738ab644a0d3","modified":1620919254614},{"_id":"public/images/header.jpg","hash":"abe0402f182eb0580a284924cb0b738ab644a0d3","modified":1620919254614},{"_id":"public/images/common/bff.png","hash":"fe95a28756836f21c39786ba3e9cd187ca726adb","modified":1620919254614},{"_id":"public/images/header-mai.webp","hash":"a5aa4f650bf5a998fd792d035b76171e908d9c32","modified":1620919254614},{"_id":"public/images/live2d/22/22.moc","hash":"63a7992de8c4658ee432822b5710565481610f0e","modified":1620919254614},{"_id":"public/images/live2d/22/22.2048/texture_00.webp","hash":"e5dafe1d0eb1859c5be3643fc0723e4d0b10f7f8","modified":1620919254614},{"_id":"public/css/main.css","hash":"920da17de73edcff0e6660c227683fdd805ca204","modified":1620919254614},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1620919254614},{"_id":"public/lib/needsharebutton/needsharebutton.css","hash":"3ef0020a1815ca6151ea4886cd0d37421ae3695c","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1620919254614},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1620919254614},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1620919254614},{"_id":"public/lib/velocity-animate/LICENSE.html","hash":"516383f7a076681d4d3a0e8e67e09c76059a75b8","modified":1620919254614},{"_id":"public/lib/sw-toolbox/sw-toolbox.js","hash":"7e2fd42a8ddb17450970c30a9bc5274f720e602c","modified":1620919254614},{"_id":"public/lib/velocity-animate/package.json","hash":"9bc53f857417d3e025f784f408a6472065c4d139","modified":1620919254614},{"_id":"public/lib/velocity-animate/README.html","hash":"e06a59498dab29f89a37c399b36a26658a2c3ce3","modified":1620919254614},{"_id":"public/lib/velocity-animate/velocity.ui.min.js","hash":"d8124c091d19fa4072616a44a8897fabc6599fce","modified":1620919254614},{"_id":"public/images/live2d/22/22.model.json","hash":"c16b957438809a40df4c187ac285aaee0671e816","modified":1620919254614},{"_id":"public/images/live2d/33/33.model.json","hash":"1927910d9b88eff5d6ab1c6a604374efe8aed88e","modified":1620919254614},{"_id":"public/lib/social-share.js/css/share.min.css","hash":"8a778a86f3ce9a042df6be63a9f1039631e351a5","modified":1620919254614},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1620919254614},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1620919254614},{"_id":"public/images/common/render.png","hash":"9ae4965461435b8ac930315c4ef9669225d64ee1","modified":1620919254614},{"_id":"public/images/header-darling2.jpg","hash":"e2ae6c5df17411838955d231e9a76321b2001c5c","modified":1620919254614},{"_id":"public/images/header-gyx-s.png","hash":"2b6b2f9904f0bbd35715adae276e7d8fc20572f2","modified":1620919254614},{"_id":"public/images/header-mai.jpg","hash":"b9890a3d76f62437462475a2c51c6b8442898379","modified":1620919254614},{"_id":"public/images/live2d/33/33.moc","hash":"80a030342ac1b6a7cd8acb441bcb207d8803b76b","modified":1620919254614},{"_id":"public/images/live2d/33/33.2048/texture_00.webp","hash":"ea15326bcbb692a272dbd793163e55c030fedda8","modified":1620919254614},{"_id":"public/images/live2d/22/22.2048/texture_00.png","hash":"b002297b31421137a64fad594f7593133cea3cbf","modified":1620919254614},{"_id":"public/lib/needsharebutton/needsharebutton.js","hash":"9885fd9bea5e7ebafc5b1de9d17be5e106248d96","modified":1620919254614},{"_id":"public/lib/velocity-animate/velocity.ui.js","hash":"7731c1bc444855b9b18bfb265cd1c4a169e6be37","modified":1620919254614},{"_id":"public/lib/social-share.js/js/jquery.share.min.js","hash":"7d3a7135cee30a5ccc38e2818a5bf8c03f7028a0","modified":1620919254614},{"_id":"public/lib/social-share.js/js/social-share.min.js","hash":"4798c0fe6c75506eebbbb3cab8cf01dcb7f59908","modified":1620919254614},{"_id":"public/images/common/kuaipai.png","hash":"84a90e636ed5bbb0f93aca7834426987e65bf438","modified":1620919254614},{"_id":"public/images/header-darlings.webp","hash":"0d3e794a5a402d615ec4a36fb525fedc3487a026","modified":1620919254614},{"_id":"public/lib/needsharebutton/font-embedded.css","hash":"c39d37278c1e178838732af21bd26cd0baeddfe0","modified":1620919254614},{"_id":"public/lib/velocity-animate/velocity.min.js","hash":"69c85b9d6a931a7d3a5b0657e60112c31fb3b286","modified":1620919254614},{"_id":"public/images/header-gyx.webp","hash":"194c54813297f72538dd2ae62ae538ce9ba4245d","modified":1620919254614},{"_id":"public/images/prototype/instanceof.image","hash":"0c119f2c36a84aa9e28052f19550e100ac19a28e","modified":1620919254614},{"_id":"public/images/header-darlings.jpg","hash":"20156313f1e9b02f28da3f5ca7b7ac607c6ea4f0","modified":1620919254614},{"_id":"public/images/header-darling4.webp","hash":"cd9c479ef8c5d0e1d5d6d77259ca5e1522db9b8f","modified":1620919254614},{"_id":"public/images/header-leg.jpg","hash":"426445281820258e0859b78e3b5e8279546dc3f5","modified":1620919254614},{"_id":"public/images/header-darling3.webp","hash":"d8cdee7124b0a0e21fa9cc82bbb64134d3778061","modified":1620919254614},{"_id":"public/images/header-leg.webp","hash":"fd1692cd000bc739cc478785f2fbb2daa759ca5f","modified":1620919254614},{"_id":"public/images/header-darling3.jpg","hash":"da8965efff676a86af6ed61451c3c13fe8a30bf3","modified":1620919254614},{"_id":"public/images/live2d/33/33.2048/texture_00.png","hash":"6d710da6056de69bfe0c33ac1b9e837b327b2f7b","modified":1620919254614},{"_id":"public/images/header-darling4.jpg","hash":"e64b1131d266f98e81d68ca36dcf5324cb901e50","modified":1620919254614},{"_id":"public/lib/velocity-animate/velocity.js","hash":"44ae2520aa8ad47cf56b67bdba64e18d542c8618","modified":1620919254614},{"_id":"public/js/video-report.html","hash":"e4e30b0222ebba441ccfe81b29cbc1cc4bcde9d1","modified":1620919254614},{"_id":"public/images/header-gyx.png","hash":"c72a623d4407c90df6cfb6ca22b1337ded8d831f","modified":1620919254614},{"_id":"public/js/sagiri.min.js","hash":"074197c73194e503f1d173e27b042dc79cbd91a2","modified":1620919254614},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1620919254614},{"_id":"public/js/sagiri.min.js.map","hash":"7b45a4d64e093a54775c99411e708349904f29dc","modified":1620919254614},{"_id":"source/_posts/CommonJS、AMD、CMD、ES6.md","hash":"fc301c9a24e01e2caa31b37e78570b8534cf91f2","modified":1621770432125},{"_id":"source/_posts/运营商劫持.md","hash":"c67d393db6c0e629af611040552edf564f9a2f51","modified":1621783307740},{"_id":"source/images/common/https_1.jpeg","hash":"00b50113bd8a813ec25566f859d574e57055f77f","modified":1621785057960},{"_id":"source/images/common/https_2.png","hash":"3c34370806a0e2770be2fc115857fd13cd0a8cd1","modified":1621787493014},{"_id":"source/_posts/常用JS工具方法.md","hash":"f66e59eb0ecea886f868afb53becc45b2db12496","modified":1622037189329}],"Category":[{"name":"css","_id":"ckon1h1wd0004l5v0f2ls94a8"},{"name":"JavaScript","_id":"ckon1h1wi000bl5v02bkog3fb"},{"name":"Web","_id":"ckon1h1wl000hl5v0g9sa0j8d"},{"name":"工具","_id":"ckon1h1wt000wl5v08cwmfxjf"},{"name":"rx.js","_id":"ckon1h1ww0011l5v0dbf0by1x"},{"name":"Vue","_id":"ckon1h1wz0019l5v0d4n22tzu"},{"name":"angular","_id":"ckon1h1x1001fl5v00xk8a7pw"},{"name":"jQuery","_id":"ckon1h1x3001kl5v0ee3uejd3"},{"name":"webpack","_id":"ckon1h1x8001yl5v06lfoa8j9"},{"name":"Node","_id":"ckon1h1xs003fl5v03oyudoft"},{"name":"网络&安全","_id":"ckp1d2qcn00009jv00brx42rt"}],"Data":[],"Page":[{"_content":"{\n    \"name\": \"Hi, colorfulWorld\",\n    \"short_name\": \"Hi, colorfulWorld\",\n    \"icons\": [\n        {\n            \"src\": \"/android-chrome-192x192.png\",\n            \"sizes\": \"192x192\",\n            \"type\": \"image/png\"\n        },\n        {\n            \"src\": \"/android-chrome-256x256.png\",\n            \"sizes\": \"256x256\",\n            \"type\": \"image/png\"\n        }\n    ],\n    \"theme_color\": \"#fff\",\n    \"background_color\": \"#fff\",\n    \"display\": \"standalone\",\n    \"start_url\": \"/\"\n}\n","source":"manifest.json","raw":"{\n    \"name\": \"Hi, colorfulWorld\",\n    \"short_name\": \"Hi, colorfulWorld\",\n    \"icons\": [\n        {\n            \"src\": \"/android-chrome-192x192.png\",\n            \"sizes\": \"192x192\",\n            \"type\": \"image/png\"\n        },\n        {\n            \"src\": \"/android-chrome-256x256.png\",\n            \"sizes\": \"256x256\",\n            \"type\": \"image/png\"\n        }\n    ],\n    \"theme_color\": \"#fff\",\n    \"background_color\": \"#fff\",\n    \"display\": \"standalone\",\n    \"start_url\": \"/\"\n}\n","date":"2021-02-27T14:09:28.145Z","updated":"2021-02-27T14:09:28.145Z","path":"manifest.json","layout":"false","title":"","comments":1,"_id":"ckon1h1w40000l5v0e61d0uwi","content":"{\"name\":\"Hi, colorfulWorld\",\"short_name\":\"Hi, colorfulWorld\",\"icons\":[{\"src\":\"/android-chrome-192x192.png\",\"sizes\":\"192x192\",\"type\":\"image/png\"},{\"src\":\"/android-chrome-256x256.png\",\"sizes\":\"256x256\",\"type\":\"image/png\"}],\"theme_color\":\"#fff\",\"background_color\":\"#fff\",\"display\":\"standalone\",\"start_url\":\"/\"}","site":{"data":{}},"excerpt":"","more":"{\"name\":\"Hi, colorfulWorld\",\"short_name\":\"Hi, colorfulWorld\",\"icons\":[{\"src\":\"/android-chrome-192x192.png\",\"sizes\":\"192x192\",\"type\":\"image/png\"},{\"src\":\"/android-chrome-256x256.png\",\"sizes\":\"256x256\",\"type\":\"image/png\"}],\"theme_color\":\"#fff\",\"background_color\":\"#fff\",\"display\":\"standalone\",\"start_url\":\"/\"}"},{"_content":"importScripts(\n  'https://cdn.jsdelivr.net/npm/workbox-cdn@5.1.3/workbox/workbox-sw.js'\n)\n\nworkbox.setConfig({\n  modulePathPrefix: 'https://cdn.jsdelivr.net/npm/workbox-cdn@5.1.3/workbox/'\n})\n\nconst {\n  core,\n  precaching,\n  routing,\n  strategies,\n  expiration,\n  cacheableResponse,\n  backgroundSync\n} = workbox\nconst {\n  CacheFirst,\n  NetworkFirst,\n  NetworkOnly,\n  StaleWhileRevalidate\n} = strategies\nconst { ExpirationPlugin } = expiration\nconst { CacheableResponsePlugin } = cacheableResponse\n\nconst cacheSuffixVersion = '-200629',\n  // precacheCacheName = core.cacheNames.precache,\n  // runtimeCacheName = core.cacheNames.runtime,\n  maxEntries = 100\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((keys) => {\n      return Promise.all(\n        keys.map((key) => {\n          if (!key.includes(cacheSuffixVersion)) return caches.delete(key)\n        })\n      )\n    })\n  )\n})\n\ncore.setCacheNameDetails({\n  prefix: 'colorfulWorld',\n  suffix: cacheSuffixVersion\n})\n\ncore.skipWaiting()\ncore.clientsClaim()\nprecaching.cleanupOutdatedCaches()\n\n/*\n * Precache\n * - Static Assets\n */\nprecaching.precacheAndRoute([\n  {\n    url: 'https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js',\n    revision: null\n  }\n])\n\n/*\n * Cache File From jsDelivr\n * cdn.jsdelivr.net | shadow.elemecdn.com\n *\n * Method: CacheFirst\n * cacheName: static-immutable\n * cacheTime: 30d\n */\n\n// cdn.jsdelivr.net - cors enabled\nrouting.registerRoute(\n  /(.*cdn\\.jsdelivr\\.net)(.*[^mp3]$)/,\n  new CacheFirst({\n    cacheName: 'static-immutable' + cacheSuffixVersion,\n    fetchOptions: {\n      mode: 'cors',\n      credentials: 'omit'\n    },\n    plugins: [\n      new ExpirationPlugin({\n        maxAgeSeconds: 30 * 24 * 60 * 60,\n        purgeOnQuotaError: true\n      })\n    ]\n  })\n)\n\n/*\n * Google Analytics Async - No Cache\n *\n * Mathod: networkOnly\n */\n\n// routing.registerRoute(\n//     /.*\\.google-analytics\\.com/,\n//     new NetworkOnly({\n//         plugins: [\n//             new backgroundSync.BackgroundSyncPlugin('Optical_Collect', {\n//                 maxRetentionTime: 12 * 60 // Retry for max of 12 Hours (specified in minutes)\n//             }),\n//         ]\n//     })\n// );\n\n/*\n * API - No Cache\n *\n * Method: networkOnly\n */\n// routing.registerRoute(\n//     new RegExp('https://api\\.i-meto\\.com'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://ip\\.diygod\\.me'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://leancloud\\.diygod\\.me'),\n//     new NetworkFirst({\n//         cacheName: 'api' + cacheSuffixVersion,\n//         fetchOptions: {\n//             mode: 'cors',\n//             credentials: 'omit'\n//         },\n//         networkTimeoutSeconds: 3\n//     })\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://disqus\\.diygod\\.me'),\n//     new NetworkFirst({\n//         cacheName: 'api' + cacheSuffixVersion,\n//         fetchOptions: {\n//             mode: 'cors',\n//             credentials: 'omit'\n//         },\n//         networkTimeoutSeconds: 3\n//     })\n// );\n\n/*\n * Disqus Related - No cache\n * disqus.com\n * *.disquscdn.com\n *\n * Method: NetworkOnly\n */\n// routing.registerRoute(\n//     new RegExp('^https://(.*)disqus\\.com'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('^https://(.*)disquscdn\\.com(.*)'),\n//     new NetworkOnly()\n// );\n\n/*\n * Others img\n * Method: staleWhileRevalidate\n * cacheName: img-cache\n */\nrouting.registerRoute(\n  // Cache image files\n  /.*\\.(?:png|jpg|jpeg|svg|gif|webp)/,\n  new StaleWhileRevalidate()\n)\n\n/*\n * Static Assets\n * Method: staleWhileRevalidate\n * cacheName: static-assets-cache\n */\nrouting.registerRoute(\n  // Cache CSS files\n  /.*\\.(css|js)/,\n  // Use cache but update in the background ASAP\n  new StaleWhileRevalidate()\n)\n\n/*\n * sw.js - Revalidate every time\n * staleWhileRevalidate\n */\nrouting.registerRoute('/js/sw.js', new StaleWhileRevalidate())\n\n/*\n * Default - Serve as it is\n * networkFirst\n */\nrouting.setDefaultHandler(\n  new NetworkFirst({\n    networkTimeoutSeconds: 3\n  })\n)\n","source":"sw.js","raw":"importScripts(\n  'https://cdn.jsdelivr.net/npm/workbox-cdn@5.1.3/workbox/workbox-sw.js'\n)\n\nworkbox.setConfig({\n  modulePathPrefix: 'https://cdn.jsdelivr.net/npm/workbox-cdn@5.1.3/workbox/'\n})\n\nconst {\n  core,\n  precaching,\n  routing,\n  strategies,\n  expiration,\n  cacheableResponse,\n  backgroundSync\n} = workbox\nconst {\n  CacheFirst,\n  NetworkFirst,\n  NetworkOnly,\n  StaleWhileRevalidate\n} = strategies\nconst { ExpirationPlugin } = expiration\nconst { CacheableResponsePlugin } = cacheableResponse\n\nconst cacheSuffixVersion = '-200629',\n  // precacheCacheName = core.cacheNames.precache,\n  // runtimeCacheName = core.cacheNames.runtime,\n  maxEntries = 100\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((keys) => {\n      return Promise.all(\n        keys.map((key) => {\n          if (!key.includes(cacheSuffixVersion)) return caches.delete(key)\n        })\n      )\n    })\n  )\n})\n\ncore.setCacheNameDetails({\n  prefix: 'colorfulWorld',\n  suffix: cacheSuffixVersion\n})\n\ncore.skipWaiting()\ncore.clientsClaim()\nprecaching.cleanupOutdatedCaches()\n\n/*\n * Precache\n * - Static Assets\n */\nprecaching.precacheAndRoute([\n  {\n    url: 'https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js',\n    revision: null\n  }\n])\n\n/*\n * Cache File From jsDelivr\n * cdn.jsdelivr.net | shadow.elemecdn.com\n *\n * Method: CacheFirst\n * cacheName: static-immutable\n * cacheTime: 30d\n */\n\n// cdn.jsdelivr.net - cors enabled\nrouting.registerRoute(\n  /(.*cdn\\.jsdelivr\\.net)(.*[^mp3]$)/,\n  new CacheFirst({\n    cacheName: 'static-immutable' + cacheSuffixVersion,\n    fetchOptions: {\n      mode: 'cors',\n      credentials: 'omit'\n    },\n    plugins: [\n      new ExpirationPlugin({\n        maxAgeSeconds: 30 * 24 * 60 * 60,\n        purgeOnQuotaError: true\n      })\n    ]\n  })\n)\n\n/*\n * Google Analytics Async - No Cache\n *\n * Mathod: networkOnly\n */\n\n// routing.registerRoute(\n//     /.*\\.google-analytics\\.com/,\n//     new NetworkOnly({\n//         plugins: [\n//             new backgroundSync.BackgroundSyncPlugin('Optical_Collect', {\n//                 maxRetentionTime: 12 * 60 // Retry for max of 12 Hours (specified in minutes)\n//             }),\n//         ]\n//     })\n// );\n\n/*\n * API - No Cache\n *\n * Method: networkOnly\n */\n// routing.registerRoute(\n//     new RegExp('https://api\\.i-meto\\.com'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://ip\\.diygod\\.me'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://leancloud\\.diygod\\.me'),\n//     new NetworkFirst({\n//         cacheName: 'api' + cacheSuffixVersion,\n//         fetchOptions: {\n//             mode: 'cors',\n//             credentials: 'omit'\n//         },\n//         networkTimeoutSeconds: 3\n//     })\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://disqus\\.diygod\\.me'),\n//     new NetworkFirst({\n//         cacheName: 'api' + cacheSuffixVersion,\n//         fetchOptions: {\n//             mode: 'cors',\n//             credentials: 'omit'\n//         },\n//         networkTimeoutSeconds: 3\n//     })\n// );\n\n/*\n * Disqus Related - No cache\n * disqus.com\n * *.disquscdn.com\n *\n * Method: NetworkOnly\n */\n// routing.registerRoute(\n//     new RegExp('^https://(.*)disqus\\.com'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('^https://(.*)disquscdn\\.com(.*)'),\n//     new NetworkOnly()\n// );\n\n/*\n * Others img\n * Method: staleWhileRevalidate\n * cacheName: img-cache\n */\nrouting.registerRoute(\n  // Cache image files\n  /.*\\.(?:png|jpg|jpeg|svg|gif|webp)/,\n  new StaleWhileRevalidate()\n)\n\n/*\n * Static Assets\n * Method: staleWhileRevalidate\n * cacheName: static-assets-cache\n */\nrouting.registerRoute(\n  // Cache CSS files\n  /.*\\.(css|js)/,\n  // Use cache but update in the background ASAP\n  new StaleWhileRevalidate()\n)\n\n/*\n * sw.js - Revalidate every time\n * staleWhileRevalidate\n */\nrouting.registerRoute('/js/sw.js', new StaleWhileRevalidate())\n\n/*\n * Default - Serve as it is\n * networkFirst\n */\nrouting.setDefaultHandler(\n  new NetworkFirst({\n    networkTimeoutSeconds: 3\n  })\n)\n","date":"2021-04-24T15:38:16.560Z","updated":"2021-04-24T15:38:16.560Z","path":"sw.js","layout":"false","title":"","comments":1,"_id":"ckon1h1wb0002l5v0bfv3aj2v","content":"importScripts(\n  'https://cdn.jsdelivr.net/npm/workbox-cdn@5.1.3/workbox/workbox-sw.js'\n)\n\nworkbox.setConfig({\n  modulePathPrefix: 'https://cdn.jsdelivr.net/npm/workbox-cdn@5.1.3/workbox/'\n})\n\nconst {\n  core,\n  precaching,\n  routing,\n  strategies,\n  expiration,\n  cacheableResponse,\n  backgroundSync\n} = workbox\nconst {\n  CacheFirst,\n  NetworkFirst,\n  NetworkOnly,\n  StaleWhileRevalidate\n} = strategies\nconst { ExpirationPlugin } = expiration\nconst { CacheableResponsePlugin } = cacheableResponse\n\nconst cacheSuffixVersion = '-200629',\n  // precacheCacheName = core.cacheNames.precache,\n  // runtimeCacheName = core.cacheNames.runtime,\n  maxEntries = 100\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((keys) => {\n      return Promise.all(\n        keys.map((key) => {\n          if (!key.includes(cacheSuffixVersion)) return caches.delete(key)\n        })\n      )\n    })\n  )\n})\n\ncore.setCacheNameDetails({\n  prefix: 'colorfulWorld',\n  suffix: cacheSuffixVersion\n})\n\ncore.skipWaiting()\ncore.clientsClaim()\nprecaching.cleanupOutdatedCaches()\n\n/*\n * Precache\n * - Static Assets\n */\nprecaching.precacheAndRoute([\n  {\n    url: 'https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js',\n    revision: null\n  }\n])\n\n/*\n * Cache File From jsDelivr\n * cdn.jsdelivr.net | shadow.elemecdn.com\n *\n * Method: CacheFirst\n * cacheName: static-immutable\n * cacheTime: 30d\n */\n\n// cdn.jsdelivr.net - cors enabled\nrouting.registerRoute(\n  /(.*cdn\\.jsdelivr\\.net)(.*[^mp3]$)/,\n  new CacheFirst({\n    cacheName: 'static-immutable' + cacheSuffixVersion,\n    fetchOptions: {\n      mode: 'cors',\n      credentials: 'omit'\n    },\n    plugins: [\n      new ExpirationPlugin({\n        maxAgeSeconds: 30 * 24 * 60 * 60,\n        purgeOnQuotaError: true\n      })\n    ]\n  })\n)\n\n/*\n * Google Analytics Async - No Cache\n *\n * Mathod: networkOnly\n */\n\n// routing.registerRoute(\n//     /.*\\.google-analytics\\.com/,\n//     new NetworkOnly({\n//         plugins: [\n//             new backgroundSync.BackgroundSyncPlugin('Optical_Collect', {\n//                 maxRetentionTime: 12 * 60 // Retry for max of 12 Hours (specified in minutes)\n//             }),\n//         ]\n//     })\n// );\n\n/*\n * API - No Cache\n *\n * Method: networkOnly\n */\n// routing.registerRoute(\n//     new RegExp('https://api\\.i-meto\\.com'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://ip\\.diygod\\.me'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://leancloud\\.diygod\\.me'),\n//     new NetworkFirst({\n//         cacheName: 'api' + cacheSuffixVersion,\n//         fetchOptions: {\n//             mode: 'cors',\n//             credentials: 'omit'\n//         },\n//         networkTimeoutSeconds: 3\n//     })\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://disqus\\.diygod\\.me'),\n//     new NetworkFirst({\n//         cacheName: 'api' + cacheSuffixVersion,\n//         fetchOptions: {\n//             mode: 'cors',\n//             credentials: 'omit'\n//         },\n//         networkTimeoutSeconds: 3\n//     })\n// );\n\n/*\n * Disqus Related - No cache\n * disqus.com\n * *.disquscdn.com\n *\n * Method: NetworkOnly\n */\n// routing.registerRoute(\n//     new RegExp('^https://(.*)disqus\\.com'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('^https://(.*)disquscdn\\.com(.*)'),\n//     new NetworkOnly()\n// );\n\n/*\n * Others img\n * Method: staleWhileRevalidate\n * cacheName: img-cache\n */\nrouting.registerRoute(\n  // Cache image files\n  /.*\\.(?:png|jpg|jpeg|svg|gif|webp)/,\n  new StaleWhileRevalidate()\n)\n\n/*\n * Static Assets\n * Method: staleWhileRevalidate\n * cacheName: static-assets-cache\n */\nrouting.registerRoute(\n  // Cache CSS files\n  /.*\\.(css|js)/,\n  // Use cache but update in the background ASAP\n  new StaleWhileRevalidate()\n)\n\n/*\n * sw.js - Revalidate every time\n * staleWhileRevalidate\n */\nrouting.registerRoute('/js/sw.js', new StaleWhileRevalidate())\n\n/*\n * Default - Serve as it is\n * networkFirst\n */\nrouting.setDefaultHandler(\n  new NetworkFirst({\n    networkTimeoutSeconds: 3\n  })\n)\n","site":{"data":{}},"excerpt":"","more":"importScripts(\n  'https://cdn.jsdelivr.net/npm/workbox-cdn@5.1.3/workbox/workbox-sw.js'\n)\n\nworkbox.setConfig({\n  modulePathPrefix: 'https://cdn.jsdelivr.net/npm/workbox-cdn@5.1.3/workbox/'\n})\n\nconst {\n  core,\n  precaching,\n  routing,\n  strategies,\n  expiration,\n  cacheableResponse,\n  backgroundSync\n} = workbox\nconst {\n  CacheFirst,\n  NetworkFirst,\n  NetworkOnly,\n  StaleWhileRevalidate\n} = strategies\nconst { ExpirationPlugin } = expiration\nconst { CacheableResponsePlugin } = cacheableResponse\n\nconst cacheSuffixVersion = '-200629',\n  // precacheCacheName = core.cacheNames.precache,\n  // runtimeCacheName = core.cacheNames.runtime,\n  maxEntries = 100\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((keys) => {\n      return Promise.all(\n        keys.map((key) => {\n          if (!key.includes(cacheSuffixVersion)) return caches.delete(key)\n        })\n      )\n    })\n  )\n})\n\ncore.setCacheNameDetails({\n  prefix: 'colorfulWorld',\n  suffix: cacheSuffixVersion\n})\n\ncore.skipWaiting()\ncore.clientsClaim()\nprecaching.cleanupOutdatedCaches()\n\n/*\n * Precache\n * - Static Assets\n */\nprecaching.precacheAndRoute([\n  {\n    url: 'https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js',\n    revision: null\n  }\n])\n\n/*\n * Cache File From jsDelivr\n * cdn.jsdelivr.net | shadow.elemecdn.com\n *\n * Method: CacheFirst\n * cacheName: static-immutable\n * cacheTime: 30d\n */\n\n// cdn.jsdelivr.net - cors enabled\nrouting.registerRoute(\n  /(.*cdn\\.jsdelivr\\.net)(.*[^mp3]$)/,\n  new CacheFirst({\n    cacheName: 'static-immutable' + cacheSuffixVersion,\n    fetchOptions: {\n      mode: 'cors',\n      credentials: 'omit'\n    },\n    plugins: [\n      new ExpirationPlugin({\n        maxAgeSeconds: 30 * 24 * 60 * 60,\n        purgeOnQuotaError: true\n      })\n    ]\n  })\n)\n\n/*\n * Google Analytics Async - No Cache\n *\n * Mathod: networkOnly\n */\n\n// routing.registerRoute(\n//     /.*\\.google-analytics\\.com/,\n//     new NetworkOnly({\n//         plugins: [\n//             new backgroundSync.BackgroundSyncPlugin('Optical_Collect', {\n//                 maxRetentionTime: 12 * 60 // Retry for max of 12 Hours (specified in minutes)\n//             }),\n//         ]\n//     })\n// );\n\n/*\n * API - No Cache\n *\n * Method: networkOnly\n */\n// routing.registerRoute(\n//     new RegExp('https://api\\.i-meto\\.com'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://ip\\.diygod\\.me'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://leancloud\\.diygod\\.me'),\n//     new NetworkFirst({\n//         cacheName: 'api' + cacheSuffixVersion,\n//         fetchOptions: {\n//             mode: 'cors',\n//             credentials: 'omit'\n//         },\n//         networkTimeoutSeconds: 3\n//     })\n// );\n\n// routing.registerRoute(\n//     new RegExp('https://disqus\\.diygod\\.me'),\n//     new NetworkFirst({\n//         cacheName: 'api' + cacheSuffixVersion,\n//         fetchOptions: {\n//             mode: 'cors',\n//             credentials: 'omit'\n//         },\n//         networkTimeoutSeconds: 3\n//     })\n// );\n\n/*\n * Disqus Related - No cache\n * disqus.com\n * *.disquscdn.com\n *\n * Method: NetworkOnly\n */\n// routing.registerRoute(\n//     new RegExp('^https://(.*)disqus\\.com'),\n//     new NetworkOnly()\n// );\n\n// routing.registerRoute(\n//     new RegExp('^https://(.*)disquscdn\\.com(.*)'),\n//     new NetworkOnly()\n// );\n\n/*\n * Others img\n * Method: staleWhileRevalidate\n * cacheName: img-cache\n */\nrouting.registerRoute(\n  // Cache image files\n  /.*\\.(?:png|jpg|jpeg|svg|gif|webp)/,\n  new StaleWhileRevalidate()\n)\n\n/*\n * Static Assets\n * Method: staleWhileRevalidate\n * cacheName: static-assets-cache\n */\nrouting.registerRoute(\n  // Cache CSS files\n  /.*\\.(css|js)/,\n  // Use cache but update in the background ASAP\n  new StaleWhileRevalidate()\n)\n\n/*\n * sw.js - Revalidate every time\n * staleWhileRevalidate\n */\nrouting.registerRoute('/js/sw.js', new StaleWhileRevalidate())\n\n/*\n * Default - Serve as it is\n * networkFirst\n */\nrouting.setDefaultHandler(\n  new NetworkFirst({\n    networkTimeoutSeconds: 3\n  })\n)\n"},{"title":"404 — 你似乎来到了没有知识存在的荒原...","date":"2017-11-25T19:36:02.000Z","comments":0,"_content":"\n你可能需要：\n\n- [返回首页](https://colorfulworld.github.io/)\n\n- [所有文章](https://colorfulworld.github.io/archives/)\n\n- [分类](https://colorfulworld.github.io/categories/)\n\n- 搜索文章：右上角","source":"404/index.md","raw":"---\ntitle: 404 — 你似乎来到了没有知识存在的荒原...\ndate: 2017-11-26 03:36:02\npermalink: '404'\ncomments: false\n---\n\n你可能需要：\n\n- [返回首页](https://colorfulworld.github.io/)\n\n- [所有文章](https://colorfulworld.github.io/archives/)\n\n- [分类](https://colorfulworld.github.io/categories/)\n\n- 搜索文章：右上角","updated":"2021-03-03T12:52:58.135Z","path":"404.html","layout":"page","_id":"ckon1h1we0005l5v0aubp7w3s","content":"<p>你可能需要：</p>\n<ul>\n<li><p><a href=\"https://colorfulworld.github.io/\">返回首页</a></p>\n</li>\n<li><p><a href=\"https://colorfulworld.github.io/archives/\">所有文章</a></p>\n</li>\n<li><p><a href=\"https://colorfulworld.github.io/categories/\">分类</a></p>\n</li>\n<li><p>搜索文章：右上角</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>你可能需要：</p>\n<ul>\n<li><p><a href=\"https://colorfulworld.github.io/\">返回首页</a></p>\n</li>\n<li><p><a href=\"https://colorfulworld.github.io/archives/\">所有文章</a></p>\n</li>\n<li><p><a href=\"https://colorfulworld.github.io/categories/\">分类</a></p>\n</li>\n<li><p>搜索文章：右上角</p>\n</li>\n</ul>\n"},{"title":"archives","date":"2017-11-09T15:47:39.000Z","type":"archives","comments":0,"_content":"","source":"archives/index.md","raw":"---\ntitle: archives\ndate: 2017-11-09 23:47:39\ntype: \"archives\"\ncomments: false\n---\n","updated":"2021-02-27T14:09:27.839Z","path":"archives/index.html","layout":"page","_id":"ckon1h1wg0007l5v07c1r0i5a","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ntype: \"categories\"\ncomments: false\n---\n","date":"2021-02-27T14:09:27.840Z","updated":"2021-02-27T14:09:27.840Z","path":"categories/index.html","layout":"page","_id":"ckon1h1wh0009l5v04gj6b8ow","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"赞赏","id":173,"date":"2014-02-15T15:11:10.000Z","_content":"\n![](/images/donate.jpg)\n\n如果我给你带来过欢乐，或者对你有所帮助，欢迎赞赏支持（/∇＼）\n\n## 周期性赞助\n\n周期性赞助可以获得额外的回报.\n\n-   通过 [Patreon](https://www.patreon.com/DIYgod) 赞助\n-   通过 [爱发电](https://afdian.net/@diygod) 赞助\n-   给我们发邮件联系赞助事宜: i@diygod.me\n\n## 一次性赞助\n\n我们通过以下方式接受赞助:\n\n-   [微信支付](https://diygod.me/images/wx.jpg)\n-   [支付宝](https://diygod.me/images/zfb.jpg)\n-   [Paypal](https://www.paypal.me/DIYgod)\n\n{% raw %}\n<script data-ad-client=\"ca-pub-5433699470727157\" async src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"></script>\n<!-- 博客投喂页展示demo -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-5433699470727157\"\n     data-ad-slot=\"6239237343\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n     (adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n{% endraw %}","source":"donate/index.md","raw":"---\ntitle: 赞赏\nid: 173\ndate: 2014-02-15 23:11:10\n---\n\n![](/images/donate.jpg)\n\n如果我给你带来过欢乐，或者对你有所帮助，欢迎赞赏支持（/∇＼）\n\n## 周期性赞助\n\n周期性赞助可以获得额外的回报.\n\n-   通过 [Patreon](https://www.patreon.com/DIYgod) 赞助\n-   通过 [爱发电](https://afdian.net/@diygod) 赞助\n-   给我们发邮件联系赞助事宜: i@diygod.me\n\n## 一次性赞助\n\n我们通过以下方式接受赞助:\n\n-   [微信支付](https://diygod.me/images/wx.jpg)\n-   [支付宝](https://diygod.me/images/zfb.jpg)\n-   [Paypal](https://www.paypal.me/DIYgod)\n\n{% raw %}\n<script data-ad-client=\"ca-pub-5433699470727157\" async src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"></script>\n<!-- 博客投喂页展示demo -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-5433699470727157\"\n     data-ad-slot=\"6239237343\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n     (adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n{% endraw %}","updated":"2021-02-07T19:02:31.000Z","path":"donate/index.html","comments":1,"layout":"page","_id":"ckon1h1wi000cl5v07kt05g32","content":"<p><img src=\"/images/donate.jpg\"></p>\n<p>如果我给你带来过欢乐，或者对你有所帮助，欢迎赞赏支持（/∇＼）</p>\n<h2 id=\"周期性赞助\"><a href=\"#周期性赞助\" class=\"headerlink\" title=\"周期性赞助\"></a>周期性赞助</h2><p>周期性赞助可以获得额外的回报.</p>\n<ul>\n<li>  通过 <a href=\"https://www.patreon.com/DIYgod\">Patreon</a> 赞助</li>\n<li>  通过 <a href=\"https://afdian.net/@diygod\">爱发电</a> 赞助</li>\n<li>  给我们发邮件联系赞助事宜: <a href=\"mailto:&#x69;&#64;&#x64;&#105;&#121;&#103;&#111;&#x64;&#46;&#x6d;&#x65;\">&#x69;&#64;&#x64;&#105;&#121;&#103;&#111;&#x64;&#46;&#x6d;&#x65;</a></li>\n</ul>\n<h2 id=\"一次性赞助\"><a href=\"#一次性赞助\" class=\"headerlink\" title=\"一次性赞助\"></a>一次性赞助</h2><p>我们通过以下方式接受赞助:</p>\n<ul>\n<li>  <a href=\"https://diygod.me/images/wx.jpg\">微信支付</a></li>\n<li>  <a href=\"https://diygod.me/images/zfb.jpg\">支付宝</a></li>\n<li>  <a href=\"https://www.paypal.me/DIYgod\">Paypal</a></li>\n</ul>\n\n<script data-ad-client=\"ca-pub-5433699470727157\" async src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"></script>\n<!-- 博客投喂页展示demo -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-5433699470727157\"\n     data-ad-slot=\"6239237343\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n     (adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/images/donate.jpg\"></p>\n<p>如果我给你带来过欢乐，或者对你有所帮助，欢迎赞赏支持（/∇＼）</p>\n<h2 id=\"周期性赞助\"><a href=\"#周期性赞助\" class=\"headerlink\" title=\"周期性赞助\"></a>周期性赞助</h2><p>周期性赞助可以获得额外的回报.</p>\n<ul>\n<li>  通过 <a href=\"https://www.patreon.com/DIYgod\">Patreon</a> 赞助</li>\n<li>  通过 <a href=\"https://afdian.net/@diygod\">爱发电</a> 赞助</li>\n<li>  给我们发邮件联系赞助事宜: <a href=\"mailto:&#x69;&#64;&#x64;&#105;&#121;&#103;&#111;&#x64;&#46;&#x6d;&#x65;\">&#x69;&#64;&#x64;&#105;&#121;&#103;&#111;&#x64;&#46;&#x6d;&#x65;</a></li>\n</ul>\n<h2 id=\"一次性赞助\"><a href=\"#一次性赞助\" class=\"headerlink\" title=\"一次性赞助\"></a>一次性赞助</h2><p>我们通过以下方式接受赞助:</p>\n<ul>\n<li>  <a href=\"https://diygod.me/images/wx.jpg\">微信支付</a></li>\n<li>  <a href=\"https://diygod.me/images/zfb.jpg\">支付宝</a></li>\n<li>  <a href=\"https://www.paypal.me/DIYgod\">Paypal</a></li>\n</ul>\n\n<script data-ad-client=\"ca-pub-5433699470727157\" async src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"></script>\n<!-- 博客投喂页展示demo -->\n<ins class=\"adsbygoogle\"\n     style=\"display:block\"\n     data-ad-client=\"ca-pub-5433699470727157\"\n     data-ad-slot=\"6239237343\"\n     data-ad-format=\"auto\"\n     data-full-width-responsive=\"true\"></ins>\n<script>\n     (adsbygoogle = window.adsbygoogle || []).push({});\n</script>\n"},{"title":"留言板","id":84,"date":"2014-02-10T06:49:01.000Z","_content":"\n**有什么话要对我说吗？这里是你畅所欲言的地方，可以咨询，可以交流，可以感叹，可以发飙，但不可以订外卖。**\n\n![](/images/message0.jpg)","source":"message/index.md","raw":"---\ntitle: 留言板\nid: 84\ndate: 2014-02-10 14:49:01\n---\n\n**有什么话要对我说吗？这里是你畅所欲言的地方，可以咨询，可以交流，可以感叹，可以发飙，但不可以订外卖。**\n\n![](/images/message0.jpg)","updated":"2021-02-07T19:02:31.000Z","path":"message/index.html","comments":1,"layout":"page","_id":"ckon1h1wj000el5v06wj5hftv","content":"<p><strong>有什么话要对我说吗？这里是你畅所欲言的地方，可以咨询，可以交流，可以感叹，可以发飙，但不可以订外卖。</strong></p>\n<p><img src=\"/images/message0.jpg\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>有什么话要对我说吗？这里是你畅所欲言的地方，可以咨询，可以交流，可以感叹，可以发飙，但不可以订外卖。</strong></p>\n<p><img src=\"/images/message0.jpg\"></p>\n"},{"title":"标签","type":"tag","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ntype: \"tag\"\ncomments: false\n---\n","date":"2021-02-27T14:09:28.147Z","updated":"2021-02-27T14:09:28.147Z","path":"tags/index.html","layout":"page","_id":"ckon1h1wl000il5v0frcfb632","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"BFC详解","date":"2019-04-03T03:30:11.000Z","_content":"\n它决定了元素如何对其内容进行定位，以及与其他元素的关系的相互作用。当涉及到可视化布局时，BFC 提供了一个环境，HTML 元素在这个环境中按照一定规则进行布局。一个环境元素不会影响到其他环境中的布局。\n\n<!--more-->\n\n## BFC 的作用\n\n- 可以包含浮动元素\n- 不被浮动元素覆盖\n- 阻止父子元素的 margin 折叠\n\n## BFC 的特征\n\n- 内部的 BOX 会在垂直方向，一个接一个地放置。\n- BOX 垂直方向的距离由 margin 决定。属于同一个 BFC 的两个 BOX 的 margin 会发生重叠。\n- BFC 的区域不会与 float BOX 重叠。\n- BFC 就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也是如此。\n- 计算 BFC 的高度时，float 元素也会参与计算。\n\n## 如何触发 BFC？\n\n- display:inline-block(也能和 overflow 一样解决高度塌陷的问题)\n- float 的值不为 none。\n- position 的值不为 static 或者是 relative。\n- display 的值为 table-cell,table-caption,inline-block,flex,或者 inline-flex 中的一个。\n- overflow 的值不为 visible。\n\n## BFC 解决了什么问题\n\n1. 使用 float 脱离文档流，高度塌陷\n2. Margin 边距重叠(两个盒子的 margin 外边距都设置为 10px，但实际上两个盒子之间的边距只有 10px)\n3. 两栏布局\n","source":"_posts/BFC详解.md","raw":"---\ntitle: BFC详解\ndate: 2019-04-03 11:30:11\ncategories: css\n---\n\n它决定了元素如何对其内容进行定位，以及与其他元素的关系的相互作用。当涉及到可视化布局时，BFC 提供了一个环境，HTML 元素在这个环境中按照一定规则进行布局。一个环境元素不会影响到其他环境中的布局。\n\n<!--more-->\n\n## BFC 的作用\n\n- 可以包含浮动元素\n- 不被浮动元素覆盖\n- 阻止父子元素的 margin 折叠\n\n## BFC 的特征\n\n- 内部的 BOX 会在垂直方向，一个接一个地放置。\n- BOX 垂直方向的距离由 margin 决定。属于同一个 BFC 的两个 BOX 的 margin 会发生重叠。\n- BFC 的区域不会与 float BOX 重叠。\n- BFC 就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也是如此。\n- 计算 BFC 的高度时，float 元素也会参与计算。\n\n## 如何触发 BFC？\n\n- display:inline-block(也能和 overflow 一样解决高度塌陷的问题)\n- float 的值不为 none。\n- position 的值不为 static 或者是 relative。\n- display 的值为 table-cell,table-caption,inline-block,flex,或者 inline-flex 中的一个。\n- overflow 的值不为 visible。\n\n## BFC 解决了什么问题\n\n1. 使用 float 脱离文档流，高度塌陷\n2. Margin 边距重叠(两个盒子的 margin 外边距都设置为 10px，但实际上两个盒子之间的边距只有 10px)\n3. 两栏布局\n","slug":"BFC详解","published":1,"updated":"2021-04-13T14:12:47.133Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1w80001l5v02vhy5mks","content":"<p>它决定了元素如何对其内容进行定位，以及与其他元素的关系的相互作用。当涉及到可视化布局时，BFC 提供了一个环境，HTML 元素在这个环境中按照一定规则进行布局。一个环境元素不会影响到其他环境中的布局。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"BFC-的作用\"><a href=\"#BFC-的作用\" class=\"headerlink\" title=\"BFC 的作用\"></a>BFC 的作用</h2><ul>\n<li>可以包含浮动元素</li>\n<li>不被浮动元素覆盖</li>\n<li>阻止父子元素的 margin 折叠</li>\n</ul>\n<h2 id=\"BFC-的特征\"><a href=\"#BFC-的特征\" class=\"headerlink\" title=\"BFC 的特征\"></a>BFC 的特征</h2><ul>\n<li>内部的 BOX 会在垂直方向，一个接一个地放置。</li>\n<li>BOX 垂直方向的距离由 margin 决定。属于同一个 BFC 的两个 BOX 的 margin 会发生重叠。</li>\n<li>BFC 的区域不会与 float BOX 重叠。</li>\n<li>BFC 就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也是如此。</li>\n<li>计算 BFC 的高度时，float 元素也会参与计算。</li>\n</ul>\n<h2 id=\"如何触发-BFC？\"><a href=\"#如何触发-BFC？\" class=\"headerlink\" title=\"如何触发 BFC？\"></a>如何触发 BFC？</h2><ul>\n<li>display:inline-block(也能和 overflow 一样解决高度塌陷的问题)</li>\n<li>float 的值不为 none。</li>\n<li>position 的值不为 static 或者是 relative。</li>\n<li>display 的值为 table-cell,table-caption,inline-block,flex,或者 inline-flex 中的一个。</li>\n<li>overflow 的值不为 visible。</li>\n</ul>\n<h2 id=\"BFC-解决了什么问题\"><a href=\"#BFC-解决了什么问题\" class=\"headerlink\" title=\"BFC 解决了什么问题\"></a>BFC 解决了什么问题</h2><ol>\n<li>使用 float 脱离文档流，高度塌陷</li>\n<li>Margin 边距重叠(两个盒子的 margin 外边距都设置为 10px，但实际上两个盒子之间的边距只有 10px)</li>\n<li>两栏布局</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>它决定了元素如何对其内容进行定位，以及与其他元素的关系的相互作用。当涉及到可视化布局时，BFC 提供了一个环境，HTML 元素在这个环境中按照一定规则进行布局。一个环境元素不会影响到其他环境中的布局。</p>","more":"<h2 id=\"BFC-的作用\"><a href=\"#BFC-的作用\" class=\"headerlink\" title=\"BFC 的作用\"></a>BFC 的作用</h2><ul>\n<li>可以包含浮动元素</li>\n<li>不被浮动元素覆盖</li>\n<li>阻止父子元素的 margin 折叠</li>\n</ul>\n<h2 id=\"BFC-的特征\"><a href=\"#BFC-的特征\" class=\"headerlink\" title=\"BFC 的特征\"></a>BFC 的特征</h2><ul>\n<li>内部的 BOX 会在垂直方向，一个接一个地放置。</li>\n<li>BOX 垂直方向的距离由 margin 决定。属于同一个 BFC 的两个 BOX 的 margin 会发生重叠。</li>\n<li>BFC 的区域不会与 float BOX 重叠。</li>\n<li>BFC 就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也是如此。</li>\n<li>计算 BFC 的高度时，float 元素也会参与计算。</li>\n</ul>\n<h2 id=\"如何触发-BFC？\"><a href=\"#如何触发-BFC？\" class=\"headerlink\" title=\"如何触发 BFC？\"></a>如何触发 BFC？</h2><ul>\n<li>display:inline-block(也能和 overflow 一样解决高度塌陷的问题)</li>\n<li>float 的值不为 none。</li>\n<li>position 的值不为 static 或者是 relative。</li>\n<li>display 的值为 table-cell,table-caption,inline-block,flex,或者 inline-flex 中的一个。</li>\n<li>overflow 的值不为 visible。</li>\n</ul>\n<h2 id=\"BFC-解决了什么问题\"><a href=\"#BFC-解决了什么问题\" class=\"headerlink\" title=\"BFC 解决了什么问题\"></a>BFC 解决了什么问题</h2><ol>\n<li>使用 float 脱离文档流，高度塌陷</li>\n<li>Margin 边距重叠(两个盒子的 margin 外边距都设置为 10px，但实际上两个盒子之间的边距只有 10px)</li>\n<li>两栏布局</li>\n</ol>"},{"title":"事件循环（Event loop）","date":"2018-04-28T03:19:52.000Z","_content":"\n[主线程从任务队列中读取事件，这个过程是循环不断的，所以整个种运行机制又称为 Event Loop(事件循环)](https://www.ruanyifeng.com/blog/2014/10/event-loop.html)\n\n<!--more-->\n\nJS 是一门非阻塞单线程语言。\n\nJS 在执行过程中会产生执行环境，这些执行环境会被顺序的加入到执行栈中。如果遇到异步的代码，会被挂起并加入搭配 Task（有多种 Task）队列中。一旦执行栈为空，Event Loop 就会从 Task 队列中拿出需要执行的代码放入到执行栈中执行。\n\n运行机制如下：\n\n1. 所有同步任务都在主线程上执行，形成一个执行栈（execution context stack)\n2. 主线程之外，还存在一个“任务队列（task quue）”。只要异步任务有了运行结果，就在任务队列中放置一个结果\n3. 一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列，那些对应的异步任务，结束等待状态，进入执行栈开始执行\n4. 主线程不断重复上面的第三步\n\n`宏任务（mscro-task）和微任务（micro-task）表示异步任务的两种分类。在挂起任务时，JS引擎会将所有任务按照类别分到这两个队列中，首先在macrotask的队列取出第一个任务，执行完毕后取出microtask队列中的所有任务顺序执行；之后再取macrotask任务，周而复始，直至两个队列的任务都取完`\n\n```javascript\nconsole.log('script start')\n\nsetTimeout(function () {\n  console.log('setTimeout')\n}, 0)\nsetInterval(myFunction,60000) //每隔6秒执行一次\nfuncition myFunction(){\n   alert('myFunction()');\n}\nconsole.log('script end')\n```\n\n以上代码虽然 setTimeout 延时为 0，其实还是异步。这是因为 HTML5 标准规定这个函数第二个参数不得小于 4 毫秒，不足会自动增加。所以 setTimeout 还是会在 script end 之后打印。\n\n## 任务队列\n\nJS 中有两类任务队列：宏任务队列(macro task) 和 微任务队列(micro task)。宏任务队列可以有多个，微任务队列只有一个。\n不同的任务源会被分配到不同的 Task 队列中，任务源可以分为 微任务（microtask） 和 宏任务（macrotask）。在 ES6 规范中，microtask 称为 jobs，macrotask 称为 task。\n\n- (macro)task 宏任务:\n  (macro)task 主要包括：script(整体代码)，setTimeout、setInterval、I/O、UI 交互事件、setImmediate(Node.js 环境)\n- (micro)task 微任务：\n  (micro)task 主要包括：Promise、MutaionObserver、process.nextTick(Node.js 环境)\n\n代码开始执行都是从 script（全局任务）开始，所以，一旦我们的全局任务（`<script>`属于宏任务）执行完，就马上执行完整个微任务队列。\n\n## Promise 哪些 API 涉及了微任务？\n\nPromise 中只有涉及到状态变更后才需要被执行的回调才算是微任务，比如说 then、catch、finally,其他所有的代码执行都是宏任务（同步执行）\n\n### 1\n\n```javascript\nconsole.log('script start');\n\nPromise.resolve().then(() => {\n    console.log('p 1');\n});\n\nsetTimeout(() => {\n    console.log('setTimeout');\n}, 0);\n\nvar s = new Date();\nwhile(new Date() - s < 50); // 阻塞50ms\n\nPromise.resolve().then(() => {\n    console.log('p 2');\n});\n\nconsole.log('script ent');\n\n\n/*** output ***/\n\n// one macro task\nscript start\nscript ent\n\n// all micro tasks\np 1\np 2\n\n// one macro task again\nsetTimeout\n```\n\n### 2\n\n```javascript\nconsole.log('script start')\n\nsetTimeout(function () {\n  console.log('setTimeout')\n}, 0)\n\nnew Promise((resolve) => {\n  console.log('Promise')\n  resolve()\n})\n  .then(function () {\n    console.log('promise1')\n  })\n  .then(function () {\n    console.log('promise2')\n  })\n\nconsole.log('script end')\n// script start => Promise => script end => promise1 => promise2 => setTimeout\n```\n\n### 3\n\n```javascript\nPromise.resolve()\n  .then(() => {\n    console.log('then1')\n    Promise.resolve().then(() => {\n      console.log('then1-1')\n    })\n  })\n  .then(() => {\n    console.log('then2')\n  })\n```\n\n### 4\n\n```javascript\nlet p = Promise.resolve()\n\np.then(() => {\n  console.log('then1')\n  Promise.resolve().then(() => {\n    console.log('then1-1')\n  })\n}).then(() => {\n  console.log('then1-2')\n})\n\np.then(() => {\n  console.log('then2')\n})\n```\n\n### 5\n\n```javascript\nlet p = Promise.resolve()\n  .then(() => {\n    console.log('then1')\n    Promise.resolve().then(() => {\n      console.log('then1-1')\n    })\n  })\n  .then(() => {\n    console.log('then2')\n  })\n\np.then(() => {\n  console.log('then3')\n})\n```\n\n### 6\n\n```javascript\nPromise.resolve()\n  .then(() => {\n    console.log('then1')\n    Promise.resolve()\n      .then(() => {\n        console.log('then1-1')\n        return Promise.resolve()\n      })\n      .then(() => {\n        console.log('then1-2')\n      })\n  })\n  .then(() => {\n    console.log('then2')\n  })\n  .then(() => {\n    console.log('then3')\n  })\n  .then(() => {\n    console.log('then4')\n  })\n```\n\n### 7\n\n```javascript\npromise2 = new Promise()\npromise2\n  .then(() => {\n    //then new Promise=>a\n    console.log(1111)\n    Promise.resolve()\n      .then(() => {\n        //then new promise b\n        console.log('1111-1')\n      })\n      .then(() => {\n        // then new promise e\n        console.log('1111-2')\n      })\n  })\n  .then(() => {\n    // then new promise c\n    console.log(2222)\n  })\n\npromise2\n  .then(() => {\n    //同一个promise a\n    console.log(3333)\n  })\n  .then(() => {\n    // then new promise d\n    console.log(44444)\n  })\n//1111\n//3333\n//1111-1\n//2222\n//44444\n//1111-2\n```\n\n## Promise 与 asap 异步执行原理\n\nPromise 异步执行是通过[asap](https://github.com/kriskowal/asap)这个库来实现的\n\n### asap 概述\n\nasap 是 as soon as possible 的简称，在 Node 和浏览器环境下，能讲回调函数以高优先级任务来执行（下一个时间循环之前），即把任务放在微队列中执行。\n用法：\n\n```javascirpt\nasap(function () {\n    // ...\n});\n```\n\n### asap 源码分析-Node 版\n\nasap 源码库包含了支持 Node 和浏览器的两个版本，这里主要分析 Node 版\n主要包含两个源码文件\n\n- [asap.js](https://github.com/kriskowal/asap/blob/master/asap.js)\n- [raw.js](https://github.com/kriskowal/asap/blob/master/raw.js)\n\n这两个文件分别导出了 asap 和 rawAsap 这两个方法，而 asap 可以看作是对 rawAsap 的进一步封装，通过缓存的 domain（可以捕捉处理 try catch 无法捕捉的异常，针对异步代码的异常处理）和 try/finally 实现了即使某个任务抛出异常也可以恢复任务栈的继续执行，另外也做了一点缓存优化（具体见源码）。\n\n因此这里主要分析 raw.js 里面的代码即可：\n\n#### 首先是对外导出的 rawAsap 方法\n\n```javascript\nvar queue = []\nvar flushing = false\nfunction rawAsap(task) {\n  if (!queue.length) {\n    requestFlush()\n    flushing = true\n  }\n  queue[queue.length] = task\n}\n```\n\n源码分析：如果任务栈 queue 为空，则触发 requestFlush 方法，并将 flushing 标志为 true，并且始终会将要执行的 task 添加到任务栈 queue 的末尾。这里需要注意的是由于 requestFlush 是异步去触发任务栈的执行的，所以即使 queue[queue.length]=task 在 requestFlush 调用之后执行，也能保证在任务栈 queue 真正执行前，任务 task 已经被添加到了任务栈 queue 的末尾。（如果任务栈 queue 不为空。所以 requestFlush 已经触发了，此时任务栈正在被循环依次执行，执行完毕会清空任务栈）\n\n#### 其次是异步触发 flush 方法执行的 requestFlush 方法\n\n```javascript\nvar domain\nvar hasSetImmediate = typeof setImmediate === 'function'\n\n// 设置为 rawAsap 的属性，方便在任务执行异常时再次触发 requestFlush\nrawAsap.requestFlush = requestFlush\nfunction requestFlush() {\n  // 确保 flushing 未绑定到任何域\n  var parentDomain = process.domain\n  if (parentDomain) {\n    if (!domain) {\n      // 惰性加载执行 domain 模块\n      domain = require('domain')\n    }\n    domain.active = process.domain = null\n  }\n\n  if (flushing && hasSetImmediate) {\n    setImmediate(flush)\n  } else {\n    process.nextTick(flush)\n  }\n\n  if (parentDomain) {\n    domain.active = process.domain = parentDomain\n  }\n}\n```\n\n源码解析：核心代码其实就一句：setImmediate(flush)，通过 setImmediate 异步执行 flush 方法。而判断 parentDomain 以及设置和恢复 domain 都只是为了当前的 flush 方法不绑定任何域执行。而这里还有一个 hasSetImmediate 判断，是为了做兼容降级处理，如果不存在 setImmediate 方法，则使用 process.nextTick 方法触发异步执行。但使用 process.nextTick 方法有一个缺陷，就是它不能够处理递归。\n\n#### 最后是执行任务栈的 flush 方法\n\n```javascript\n// 下一个任务在任务队列中执行的位置\nvar index = 0\nvar capacity = 1024\n\nfunction flush() {\n  while (index < queue.length) {\n    var currentIndex = index\n    // 在调用任务之前先设置下一个任务的索引，可以确保再次触发 flush 方法时，跳过异常任务\n    index = index + 1\n    queue[currentIndex].call()\n\n    // 防止内存泄露\n    if (index > capacity) {\n      for (\n        var scan = 0, newLength = queue.length - index;\n        scan < newLength;\n        scan++\n      ) {\n        queue[scan] = queue[scan + index]\n      }\n      queue.length -= index\n      index = 0\n    }\n  }\n  queue.length = 0\n  index = 0\n  flushing = false\n}\n```\n\n源码解析：通过 while 循环依次去执行任务栈 queue 中的每一个任务，这里需要注意一点，index + 1 表示下一个要执行的任务下标，而其放在 queue[currentIndex].call() 之前，是为了保证当当前任务执行发生异常了，再次触发 requestFlush 方法时，能够跳过发生异常的任务，从下一个任务开始执行。而判断 if (index > capacity) 是为了防止内存泄露，当任务栈 queue 的长度超过了指定的阈值 capacity 时，对任务栈 queue 中的任务进行移动，将所有剩余的未执行的任务置前，并重置任务栈 queue 的长度。当所有任务执行完毕后，重置任务栈以及相应状态。\n\n#### 总结\n\nrawAsap 方法是通过 setImmediate 或 process.nextTick 来实现异步执行的任务栈，而 asap 方法是对 rawAsap 方法的进一步封装，通过缓存的 domain 和 try/finally 实现了即使某个任务抛出异常也可以恢复任务栈的继续执行（再次调用 rawAsap.requestFlush）。\n\n## Node.js 的 Event Loop\n\n```javascript\nconsole.log(1)\nsetTimeout(function () {\n  console.log(2)\n  new Promise(function (resolve, reject) {\n    console.log('promise')\n    resolve()\n  }).then((res) => {\n    console.log('promise.then')\n  })\n})\nsetTimeout(function () {\n  console.log(4)\n})\nconsole.log(5)\n//1 5 2 promise 4 promise.then\n```\n\nNode.js 也是单线程的 Event Loop，但是它的运行机制不同于浏览器。\n\n除了 settimeout 和 setInverval 这两个方法，Node.js 还提供了另外两种与任务队列有关的方法：process.nextTick 和 setImmediate。\n\nprocess.nextTick 方法可以在当前\"执行栈\"的尾部----下一次 Event Loop（主线程读取\"任务队列\"）之前----触发回调函数。也就是说，它指定的任务总是发生在所有异步任务之前。setImmediate 方法则是在当前\"任务队列\"的尾部添加事件，也就是说，它指定的任务总是在下一次 Event Loop 时执行，这与 setTimeout(fn, 0)很像。请看下面的例子（via StackOverflow）。（这就是为什么 promise 的链式 then 会在当前任务队列最后执行的原因吧）\n\n如果有多个 process.nextTick 语句（不管它们是否嵌套），将全部在当前\"执行栈\"执行。\n\n### process.nextTick 与 setImmediate\n\nprocess.nextTick 和 setImmediate 的一个重要区别：多个 process.nextTick 语句总是在当前\"执行栈\"一次执行完，多个 setImmediate 可能则需要多次 loop 才能执行完。事实上，这正是 Node.js 10.0 版添加 setImmediate 方法的原因，否则像下面这样的递归调用 process.nextTick，将会没完没了，主线程根本不会去读取\"事件队列\"！\n\n另外，由于 process.nextTick 指定的回调函数是在本次\"事件循环\"触发，而 setImmediate 指定的是在下次\"事件循环\"触发，所以很显然，前者总是比后者发生得早，而且执行效率也高（因为不用检查\"任务队列\"）。\n\n### Macrotasks 和 Microtasks\n\nMacrotasks 和 Microtasks 都属于上述的异步任务中的一种，他们分别有如下 API：\nmacrotasks: setTimeout, setInterval, setImmediate, I/O, UI rendering\nmicrotasks: process.nextTick, Promise, MutationObserver\n\nsetTimeout 的 macrotask， 和 Promise 的 microtask 有哪些不同，先来看下代码如下：\n\n```javascript\nconsole.log(1)\nsetTimeout(function () {\n  console.log(2)\n}, 0)\nPromise.resolve()\n  .then(function () {\n    console.log(3)\n  })\n  .then(function () {\n    console.log(4)\n  })\n\n//1\n//3\n//4\n//2\n```\n\n如上代码可以看到，Promise 的函数代码的异步任务会优先于 setTimeout 的延时为 0 的任务先执行。\n\n原因是任务队列分为 macrotasks 和 microtasks, 而 promise 中的 then 方法的函数会被推入到 microtasks 队列中，而 setTimeout 函数会被推入到 macrotasks 任务队列中，在每一次事件循环中，macrotask 只会提取一个执行，而 microtask 会一直提取，直到 microsoft 队列为空为止。\n\n也就是说如果某个 microtask 任务被推入到执行中，那么当主线程任务执行完成后，会循环调用该队列任务中的下一个任务来执行，直到该任务队列到最后一个任务为止。\n\n而事件循环每次只会入栈一个 macrotask,主线程执行完成该任务后又会检查 microtasks 队列并完成里面的所有任务后再执行 macrotask 的任务。\n\n### 最后\n\n```javascript\nsetImmediate(function () {\n  console.log('setImmediate')\n  setImmediate(function () {\n    console.log('嵌套setImmediate')\n  })\n  process.nextTick(function () {\n    console.log('nextTick')\n  })\n})\n\n// setImmediate\n// nextTick\n// 嵌套setImmediate\n```\n\n解析：事件循环 check 阶段执行回调函数输出 setImmediate，之后输出 nextTick。嵌套的 setImmediate 在下一个事件循环的 check 阶段执行回调输出嵌套的 setImmediate。\n\n```javascript\nvar fs = require('fs')\n\nfunction someAsyncOperation(callback) {\n  // 假设这个任务要消耗 95ms\n  fs.readFile('/path/to/file', callback)\n}\n\nvar timeoutScheduled = Date.now()\n\nsetTimeout(function () {\n  var delay = Date.now() - timeoutScheduled\n\n  console.log(delay + 'ms have passed since I was scheduled')\n}, 100)\n\n// someAsyncOperation要消耗 95 ms 才能完成\nsomeAsyncOperation(function () {\n  var startCallback = Date.now()\n\n  // 消耗 10ms...\n  while (Date.now() - startCallback < 10) {\n    // do nothing\n  }\n})\n```\n\n解析：事件循环进入 poll 阶段发现队列为空，并且没有代码被 setImmediate()。于是在 poll 阶段等待 timers 下限时间到达。当等到 95ms 时，fs.readFile 首先执行了，它的回调被添加进 poll 队列并同步执行，耗时 10ms。此时总共时间累积 105ms。等到 poll 队列为空的时候，事件循环会查看最近到达的 timer 的下限时间，发现已经到达，再回到 timers 阶段，执行 timer 的回调。\n\n### 参考\n\n- [Node 探秘之事件循环](https://www.jianshu.com/p/837b584e1bdd)\n- [node.js 下的异步递归 setImmediate 和 process.nextTick 如何使用](https://yijiebuyi.com/blog/c96c2aa46fd0b91e75be22161cceeea1.html)\n- [asap 异步执行实现原理](https://www.yht7.com/news/80094)\n- [nodejs_setimmediate](https://nodejs.org/api/timers.html#timers_setimmediate_callback_args)\n","source":"_posts/Event-loop-JS.md","raw":"---\ntitle: 事件循环（Event loop）\ndate: 2018-04-28 11:19:52\ncategories: JavaScript\n---\n\n[主线程从任务队列中读取事件，这个过程是循环不断的，所以整个种运行机制又称为 Event Loop(事件循环)](https://www.ruanyifeng.com/blog/2014/10/event-loop.html)\n\n<!--more-->\n\nJS 是一门非阻塞单线程语言。\n\nJS 在执行过程中会产生执行环境，这些执行环境会被顺序的加入到执行栈中。如果遇到异步的代码，会被挂起并加入搭配 Task（有多种 Task）队列中。一旦执行栈为空，Event Loop 就会从 Task 队列中拿出需要执行的代码放入到执行栈中执行。\n\n运行机制如下：\n\n1. 所有同步任务都在主线程上执行，形成一个执行栈（execution context stack)\n2. 主线程之外，还存在一个“任务队列（task quue）”。只要异步任务有了运行结果，就在任务队列中放置一个结果\n3. 一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列，那些对应的异步任务，结束等待状态，进入执行栈开始执行\n4. 主线程不断重复上面的第三步\n\n`宏任务（mscro-task）和微任务（micro-task）表示异步任务的两种分类。在挂起任务时，JS引擎会将所有任务按照类别分到这两个队列中，首先在macrotask的队列取出第一个任务，执行完毕后取出microtask队列中的所有任务顺序执行；之后再取macrotask任务，周而复始，直至两个队列的任务都取完`\n\n```javascript\nconsole.log('script start')\n\nsetTimeout(function () {\n  console.log('setTimeout')\n}, 0)\nsetInterval(myFunction,60000) //每隔6秒执行一次\nfuncition myFunction(){\n   alert('myFunction()');\n}\nconsole.log('script end')\n```\n\n以上代码虽然 setTimeout 延时为 0，其实还是异步。这是因为 HTML5 标准规定这个函数第二个参数不得小于 4 毫秒，不足会自动增加。所以 setTimeout 还是会在 script end 之后打印。\n\n## 任务队列\n\nJS 中有两类任务队列：宏任务队列(macro task) 和 微任务队列(micro task)。宏任务队列可以有多个，微任务队列只有一个。\n不同的任务源会被分配到不同的 Task 队列中，任务源可以分为 微任务（microtask） 和 宏任务（macrotask）。在 ES6 规范中，microtask 称为 jobs，macrotask 称为 task。\n\n- (macro)task 宏任务:\n  (macro)task 主要包括：script(整体代码)，setTimeout、setInterval、I/O、UI 交互事件、setImmediate(Node.js 环境)\n- (micro)task 微任务：\n  (micro)task 主要包括：Promise、MutaionObserver、process.nextTick(Node.js 环境)\n\n代码开始执行都是从 script（全局任务）开始，所以，一旦我们的全局任务（`<script>`属于宏任务）执行完，就马上执行完整个微任务队列。\n\n## Promise 哪些 API 涉及了微任务？\n\nPromise 中只有涉及到状态变更后才需要被执行的回调才算是微任务，比如说 then、catch、finally,其他所有的代码执行都是宏任务（同步执行）\n\n### 1\n\n```javascript\nconsole.log('script start');\n\nPromise.resolve().then(() => {\n    console.log('p 1');\n});\n\nsetTimeout(() => {\n    console.log('setTimeout');\n}, 0);\n\nvar s = new Date();\nwhile(new Date() - s < 50); // 阻塞50ms\n\nPromise.resolve().then(() => {\n    console.log('p 2');\n});\n\nconsole.log('script ent');\n\n\n/*** output ***/\n\n// one macro task\nscript start\nscript ent\n\n// all micro tasks\np 1\np 2\n\n// one macro task again\nsetTimeout\n```\n\n### 2\n\n```javascript\nconsole.log('script start')\n\nsetTimeout(function () {\n  console.log('setTimeout')\n}, 0)\n\nnew Promise((resolve) => {\n  console.log('Promise')\n  resolve()\n})\n  .then(function () {\n    console.log('promise1')\n  })\n  .then(function () {\n    console.log('promise2')\n  })\n\nconsole.log('script end')\n// script start => Promise => script end => promise1 => promise2 => setTimeout\n```\n\n### 3\n\n```javascript\nPromise.resolve()\n  .then(() => {\n    console.log('then1')\n    Promise.resolve().then(() => {\n      console.log('then1-1')\n    })\n  })\n  .then(() => {\n    console.log('then2')\n  })\n```\n\n### 4\n\n```javascript\nlet p = Promise.resolve()\n\np.then(() => {\n  console.log('then1')\n  Promise.resolve().then(() => {\n    console.log('then1-1')\n  })\n}).then(() => {\n  console.log('then1-2')\n})\n\np.then(() => {\n  console.log('then2')\n})\n```\n\n### 5\n\n```javascript\nlet p = Promise.resolve()\n  .then(() => {\n    console.log('then1')\n    Promise.resolve().then(() => {\n      console.log('then1-1')\n    })\n  })\n  .then(() => {\n    console.log('then2')\n  })\n\np.then(() => {\n  console.log('then3')\n})\n```\n\n### 6\n\n```javascript\nPromise.resolve()\n  .then(() => {\n    console.log('then1')\n    Promise.resolve()\n      .then(() => {\n        console.log('then1-1')\n        return Promise.resolve()\n      })\n      .then(() => {\n        console.log('then1-2')\n      })\n  })\n  .then(() => {\n    console.log('then2')\n  })\n  .then(() => {\n    console.log('then3')\n  })\n  .then(() => {\n    console.log('then4')\n  })\n```\n\n### 7\n\n```javascript\npromise2 = new Promise()\npromise2\n  .then(() => {\n    //then new Promise=>a\n    console.log(1111)\n    Promise.resolve()\n      .then(() => {\n        //then new promise b\n        console.log('1111-1')\n      })\n      .then(() => {\n        // then new promise e\n        console.log('1111-2')\n      })\n  })\n  .then(() => {\n    // then new promise c\n    console.log(2222)\n  })\n\npromise2\n  .then(() => {\n    //同一个promise a\n    console.log(3333)\n  })\n  .then(() => {\n    // then new promise d\n    console.log(44444)\n  })\n//1111\n//3333\n//1111-1\n//2222\n//44444\n//1111-2\n```\n\n## Promise 与 asap 异步执行原理\n\nPromise 异步执行是通过[asap](https://github.com/kriskowal/asap)这个库来实现的\n\n### asap 概述\n\nasap 是 as soon as possible 的简称，在 Node 和浏览器环境下，能讲回调函数以高优先级任务来执行（下一个时间循环之前），即把任务放在微队列中执行。\n用法：\n\n```javascirpt\nasap(function () {\n    // ...\n});\n```\n\n### asap 源码分析-Node 版\n\nasap 源码库包含了支持 Node 和浏览器的两个版本，这里主要分析 Node 版\n主要包含两个源码文件\n\n- [asap.js](https://github.com/kriskowal/asap/blob/master/asap.js)\n- [raw.js](https://github.com/kriskowal/asap/blob/master/raw.js)\n\n这两个文件分别导出了 asap 和 rawAsap 这两个方法，而 asap 可以看作是对 rawAsap 的进一步封装，通过缓存的 domain（可以捕捉处理 try catch 无法捕捉的异常，针对异步代码的异常处理）和 try/finally 实现了即使某个任务抛出异常也可以恢复任务栈的继续执行，另外也做了一点缓存优化（具体见源码）。\n\n因此这里主要分析 raw.js 里面的代码即可：\n\n#### 首先是对外导出的 rawAsap 方法\n\n```javascript\nvar queue = []\nvar flushing = false\nfunction rawAsap(task) {\n  if (!queue.length) {\n    requestFlush()\n    flushing = true\n  }\n  queue[queue.length] = task\n}\n```\n\n源码分析：如果任务栈 queue 为空，则触发 requestFlush 方法，并将 flushing 标志为 true，并且始终会将要执行的 task 添加到任务栈 queue 的末尾。这里需要注意的是由于 requestFlush 是异步去触发任务栈的执行的，所以即使 queue[queue.length]=task 在 requestFlush 调用之后执行，也能保证在任务栈 queue 真正执行前，任务 task 已经被添加到了任务栈 queue 的末尾。（如果任务栈 queue 不为空。所以 requestFlush 已经触发了，此时任务栈正在被循环依次执行，执行完毕会清空任务栈）\n\n#### 其次是异步触发 flush 方法执行的 requestFlush 方法\n\n```javascript\nvar domain\nvar hasSetImmediate = typeof setImmediate === 'function'\n\n// 设置为 rawAsap 的属性，方便在任务执行异常时再次触发 requestFlush\nrawAsap.requestFlush = requestFlush\nfunction requestFlush() {\n  // 确保 flushing 未绑定到任何域\n  var parentDomain = process.domain\n  if (parentDomain) {\n    if (!domain) {\n      // 惰性加载执行 domain 模块\n      domain = require('domain')\n    }\n    domain.active = process.domain = null\n  }\n\n  if (flushing && hasSetImmediate) {\n    setImmediate(flush)\n  } else {\n    process.nextTick(flush)\n  }\n\n  if (parentDomain) {\n    domain.active = process.domain = parentDomain\n  }\n}\n```\n\n源码解析：核心代码其实就一句：setImmediate(flush)，通过 setImmediate 异步执行 flush 方法。而判断 parentDomain 以及设置和恢复 domain 都只是为了当前的 flush 方法不绑定任何域执行。而这里还有一个 hasSetImmediate 判断，是为了做兼容降级处理，如果不存在 setImmediate 方法，则使用 process.nextTick 方法触发异步执行。但使用 process.nextTick 方法有一个缺陷，就是它不能够处理递归。\n\n#### 最后是执行任务栈的 flush 方法\n\n```javascript\n// 下一个任务在任务队列中执行的位置\nvar index = 0\nvar capacity = 1024\n\nfunction flush() {\n  while (index < queue.length) {\n    var currentIndex = index\n    // 在调用任务之前先设置下一个任务的索引，可以确保再次触发 flush 方法时，跳过异常任务\n    index = index + 1\n    queue[currentIndex].call()\n\n    // 防止内存泄露\n    if (index > capacity) {\n      for (\n        var scan = 0, newLength = queue.length - index;\n        scan < newLength;\n        scan++\n      ) {\n        queue[scan] = queue[scan + index]\n      }\n      queue.length -= index\n      index = 0\n    }\n  }\n  queue.length = 0\n  index = 0\n  flushing = false\n}\n```\n\n源码解析：通过 while 循环依次去执行任务栈 queue 中的每一个任务，这里需要注意一点，index + 1 表示下一个要执行的任务下标，而其放在 queue[currentIndex].call() 之前，是为了保证当当前任务执行发生异常了，再次触发 requestFlush 方法时，能够跳过发生异常的任务，从下一个任务开始执行。而判断 if (index > capacity) 是为了防止内存泄露，当任务栈 queue 的长度超过了指定的阈值 capacity 时，对任务栈 queue 中的任务进行移动，将所有剩余的未执行的任务置前，并重置任务栈 queue 的长度。当所有任务执行完毕后，重置任务栈以及相应状态。\n\n#### 总结\n\nrawAsap 方法是通过 setImmediate 或 process.nextTick 来实现异步执行的任务栈，而 asap 方法是对 rawAsap 方法的进一步封装，通过缓存的 domain 和 try/finally 实现了即使某个任务抛出异常也可以恢复任务栈的继续执行（再次调用 rawAsap.requestFlush）。\n\n## Node.js 的 Event Loop\n\n```javascript\nconsole.log(1)\nsetTimeout(function () {\n  console.log(2)\n  new Promise(function (resolve, reject) {\n    console.log('promise')\n    resolve()\n  }).then((res) => {\n    console.log('promise.then')\n  })\n})\nsetTimeout(function () {\n  console.log(4)\n})\nconsole.log(5)\n//1 5 2 promise 4 promise.then\n```\n\nNode.js 也是单线程的 Event Loop，但是它的运行机制不同于浏览器。\n\n除了 settimeout 和 setInverval 这两个方法，Node.js 还提供了另外两种与任务队列有关的方法：process.nextTick 和 setImmediate。\n\nprocess.nextTick 方法可以在当前\"执行栈\"的尾部----下一次 Event Loop（主线程读取\"任务队列\"）之前----触发回调函数。也就是说，它指定的任务总是发生在所有异步任务之前。setImmediate 方法则是在当前\"任务队列\"的尾部添加事件，也就是说，它指定的任务总是在下一次 Event Loop 时执行，这与 setTimeout(fn, 0)很像。请看下面的例子（via StackOverflow）。（这就是为什么 promise 的链式 then 会在当前任务队列最后执行的原因吧）\n\n如果有多个 process.nextTick 语句（不管它们是否嵌套），将全部在当前\"执行栈\"执行。\n\n### process.nextTick 与 setImmediate\n\nprocess.nextTick 和 setImmediate 的一个重要区别：多个 process.nextTick 语句总是在当前\"执行栈\"一次执行完，多个 setImmediate 可能则需要多次 loop 才能执行完。事实上，这正是 Node.js 10.0 版添加 setImmediate 方法的原因，否则像下面这样的递归调用 process.nextTick，将会没完没了，主线程根本不会去读取\"事件队列\"！\n\n另外，由于 process.nextTick 指定的回调函数是在本次\"事件循环\"触发，而 setImmediate 指定的是在下次\"事件循环\"触发，所以很显然，前者总是比后者发生得早，而且执行效率也高（因为不用检查\"任务队列\"）。\n\n### Macrotasks 和 Microtasks\n\nMacrotasks 和 Microtasks 都属于上述的异步任务中的一种，他们分别有如下 API：\nmacrotasks: setTimeout, setInterval, setImmediate, I/O, UI rendering\nmicrotasks: process.nextTick, Promise, MutationObserver\n\nsetTimeout 的 macrotask， 和 Promise 的 microtask 有哪些不同，先来看下代码如下：\n\n```javascript\nconsole.log(1)\nsetTimeout(function () {\n  console.log(2)\n}, 0)\nPromise.resolve()\n  .then(function () {\n    console.log(3)\n  })\n  .then(function () {\n    console.log(4)\n  })\n\n//1\n//3\n//4\n//2\n```\n\n如上代码可以看到，Promise 的函数代码的异步任务会优先于 setTimeout 的延时为 0 的任务先执行。\n\n原因是任务队列分为 macrotasks 和 microtasks, 而 promise 中的 then 方法的函数会被推入到 microtasks 队列中，而 setTimeout 函数会被推入到 macrotasks 任务队列中，在每一次事件循环中，macrotask 只会提取一个执行，而 microtask 会一直提取，直到 microsoft 队列为空为止。\n\n也就是说如果某个 microtask 任务被推入到执行中，那么当主线程任务执行完成后，会循环调用该队列任务中的下一个任务来执行，直到该任务队列到最后一个任务为止。\n\n而事件循环每次只会入栈一个 macrotask,主线程执行完成该任务后又会检查 microtasks 队列并完成里面的所有任务后再执行 macrotask 的任务。\n\n### 最后\n\n```javascript\nsetImmediate(function () {\n  console.log('setImmediate')\n  setImmediate(function () {\n    console.log('嵌套setImmediate')\n  })\n  process.nextTick(function () {\n    console.log('nextTick')\n  })\n})\n\n// setImmediate\n// nextTick\n// 嵌套setImmediate\n```\n\n解析：事件循环 check 阶段执行回调函数输出 setImmediate，之后输出 nextTick。嵌套的 setImmediate 在下一个事件循环的 check 阶段执行回调输出嵌套的 setImmediate。\n\n```javascript\nvar fs = require('fs')\n\nfunction someAsyncOperation(callback) {\n  // 假设这个任务要消耗 95ms\n  fs.readFile('/path/to/file', callback)\n}\n\nvar timeoutScheduled = Date.now()\n\nsetTimeout(function () {\n  var delay = Date.now() - timeoutScheduled\n\n  console.log(delay + 'ms have passed since I was scheduled')\n}, 100)\n\n// someAsyncOperation要消耗 95 ms 才能完成\nsomeAsyncOperation(function () {\n  var startCallback = Date.now()\n\n  // 消耗 10ms...\n  while (Date.now() - startCallback < 10) {\n    // do nothing\n  }\n})\n```\n\n解析：事件循环进入 poll 阶段发现队列为空，并且没有代码被 setImmediate()。于是在 poll 阶段等待 timers 下限时间到达。当等到 95ms 时，fs.readFile 首先执行了，它的回调被添加进 poll 队列并同步执行，耗时 10ms。此时总共时间累积 105ms。等到 poll 队列为空的时候，事件循环会查看最近到达的 timer 的下限时间，发现已经到达，再回到 timers 阶段，执行 timer 的回调。\n\n### 参考\n\n- [Node 探秘之事件循环](https://www.jianshu.com/p/837b584e1bdd)\n- [node.js 下的异步递归 setImmediate 和 process.nextTick 如何使用](https://yijiebuyi.com/blog/c96c2aa46fd0b91e75be22161cceeea1.html)\n- [asap 异步执行实现原理](https://www.yht7.com/news/80094)\n- [nodejs_setimmediate](https://nodejs.org/api/timers.html#timers_setimmediate_callback_args)\n","slug":"Event-loop-JS","published":1,"updated":"2021-04-24T15:38:16.545Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wb0003l5v07evddjob","content":"<p><a href=\"https://www.ruanyifeng.com/blog/2014/10/event-loop.html\">主线程从任务队列中读取事件，这个过程是循环不断的，所以整个种运行机制又称为 Event Loop(事件循环)</a></p>\n<span id=\"more\"></span>\n\n<p>JS 是一门非阻塞单线程语言。</p>\n<p>JS 在执行过程中会产生执行环境，这些执行环境会被顺序的加入到执行栈中。如果遇到异步的代码，会被挂起并加入搭配 Task（有多种 Task）队列中。一旦执行栈为空，Event Loop 就会从 Task 队列中拿出需要执行的代码放入到执行栈中执行。</p>\n<p>运行机制如下：</p>\n<ol>\n<li>所有同步任务都在主线程上执行，形成一个执行栈（execution context stack)</li>\n<li>主线程之外，还存在一个“任务队列（task quue）”。只要异步任务有了运行结果，就在任务队列中放置一个结果</li>\n<li>一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列，那些对应的异步任务，结束等待状态，进入执行栈开始执行</li>\n<li>主线程不断重复上面的第三步</li>\n</ol>\n<p><code>宏任务（mscro-task）和微任务（micro-task）表示异步任务的两种分类。在挂起任务时，JS引擎会将所有任务按照类别分到这两个队列中，首先在macrotask的队列取出第一个任务，执行完毕后取出microtask队列中的所有任务顺序执行；之后再取macrotask任务，周而复始，直至两个队列的任务都取完</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script start&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;setTimeout&#x27;</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"built_in\">setInterval</span>(myFunction,<span class=\"number\">60000</span>) <span class=\"comment\">//每隔6秒执行一次</span></span><br><span class=\"line\">funcition <span class=\"function\"><span class=\"title\">myFunction</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">   alert(<span class=\"string\">&#x27;myFunction()&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script end&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>以上代码虽然 setTimeout 延时为 0，其实还是异步。这是因为 HTML5 标准规定这个函数第二个参数不得小于 4 毫秒，不足会自动增加。所以 setTimeout 还是会在 script end 之后打印。</p>\n<h2 id=\"任务队列\"><a href=\"#任务队列\" class=\"headerlink\" title=\"任务队列\"></a>任务队列</h2><p>JS 中有两类任务队列：宏任务队列(macro task) 和 微任务队列(micro task)。宏任务队列可以有多个，微任务队列只有一个。<br>不同的任务源会被分配到不同的 Task 队列中，任务源可以分为 微任务（microtask） 和 宏任务（macrotask）。在 ES6 规范中，microtask 称为 jobs，macrotask 称为 task。</p>\n<ul>\n<li>(macro)task 宏任务:<br>(macro)task 主要包括：script(整体代码)，setTimeout、setInterval、I/O、UI 交互事件、setImmediate(Node.js 环境)</li>\n<li>(micro)task 微任务：<br>(micro)task 主要包括：Promise、MutaionObserver、process.nextTick(Node.js 环境)</li>\n</ul>\n<p>代码开始执行都是从 script（全局任务）开始，所以，一旦我们的全局任务（<code>&lt;script&gt;</code>属于宏任务）执行完，就马上执行完整个微任务队列。</p>\n<h2 id=\"Promise-哪些-API-涉及了微任务？\"><a href=\"#Promise-哪些-API-涉及了微任务？\" class=\"headerlink\" title=\"Promise 哪些 API 涉及了微任务？\"></a>Promise 哪些 API 涉及了微任务？</h2><p>Promise 中只有涉及到状态变更后才需要被执行的回调才算是微任务，比如说 then、catch、finally,其他所有的代码执行都是宏任务（同步执行）</p>\n<h3 id=\"1\"><a href=\"#1\" class=\"headerlink\" title=\"1\"></a>1</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script start&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;p 1&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;setTimeout&#x27;</span>);</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> s = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() - s &lt; <span class=\"number\">50</span>); <span class=\"comment\">// 阻塞50ms</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;p 2&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script ent&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*** output ***/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// one macro task</span></span><br><span class=\"line\">script start</span><br><span class=\"line\">script ent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// all micro tasks</span></span><br><span class=\"line\">p <span class=\"number\">1</span></span><br><span class=\"line\">p <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// one macro task again</span></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2\"><a href=\"#2\" class=\"headerlink\" title=\"2\"></a>2</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script start&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;setTimeout&#x27;</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Promise&#x27;</span>)</span><br><span class=\"line\">  resolve()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;promise1&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;promise2&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script end&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// script start =&gt; Promise =&gt; script end =&gt; promise1 =&gt; promise2 =&gt; setTimeout</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3\"><a href=\"#3\" class=\"headerlink\" title=\"3\"></a>3</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-1&#x27;</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then2&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4\"><a href=\"#4\" class=\"headerlink\" title=\"4\"></a>4</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> p = <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-1&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;).then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-2&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then2&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5\"><a href=\"#5\" class=\"headerlink\" title=\"5\"></a>5</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> p = <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-1&#x27;</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then2&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then3&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6\"><a href=\"#6\" class=\"headerlink\" title=\"6\"></a>6</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-1&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-2&#x27;</span>)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then2&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then3&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then4&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7\"><a href=\"#7\" class=\"headerlink\" title=\"7\"></a>7</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">promise2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>()</span><br><span class=\"line\">promise2</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//then new Promise=&gt;a</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1111</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//then new promise b</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;1111-1&#x27;</span>)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// then new promise e</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;1111-2&#x27;</span>)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// then new promise c</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2222</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">promise2</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//同一个promise a</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3333</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// then new promise d</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">44444</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"><span class=\"comment\">//1111</span></span><br><span class=\"line\"><span class=\"comment\">//3333</span></span><br><span class=\"line\"><span class=\"comment\">//1111-1</span></span><br><span class=\"line\"><span class=\"comment\">//2222</span></span><br><span class=\"line\"><span class=\"comment\">//44444</span></span><br><span class=\"line\"><span class=\"comment\">//1111-2</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Promise-与-asap-异步执行原理\"><a href=\"#Promise-与-asap-异步执行原理\" class=\"headerlink\" title=\"Promise 与 asap 异步执行原理\"></a>Promise 与 asap 异步执行原理</h2><p>Promise 异步执行是通过<a href=\"https://github.com/kriskowal/asap\">asap</a>这个库来实现的</p>\n<h3 id=\"asap-概述\"><a href=\"#asap-概述\" class=\"headerlink\" title=\"asap 概述\"></a>asap 概述</h3><p>asap 是 as soon as possible 的简称，在 Node 和浏览器环境下，能讲回调函数以高优先级任务来执行（下一个时间循环之前），即把任务放在微队列中执行。<br>用法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">asap(function () &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; ...</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"asap-源码分析-Node-版\"><a href=\"#asap-源码分析-Node-版\" class=\"headerlink\" title=\"asap 源码分析-Node 版\"></a>asap 源码分析-Node 版</h3><p>asap 源码库包含了支持 Node 和浏览器的两个版本，这里主要分析 Node 版<br>主要包含两个源码文件</p>\n<ul>\n<li><a href=\"https://github.com/kriskowal/asap/blob/master/asap.js\">asap.js</a></li>\n<li><a href=\"https://github.com/kriskowal/asap/blob/master/raw.js\">raw.js</a></li>\n</ul>\n<p>这两个文件分别导出了 asap 和 rawAsap 这两个方法，而 asap 可以看作是对 rawAsap 的进一步封装，通过缓存的 domain（可以捕捉处理 try catch 无法捕捉的异常，针对异步代码的异常处理）和 try/finally 实现了即使某个任务抛出异常也可以恢复任务栈的继续执行，另外也做了一点缓存优化（具体见源码）。</p>\n<p>因此这里主要分析 raw.js 里面的代码即可：</p>\n<h4 id=\"首先是对外导出的-rawAsap-方法\"><a href=\"#首先是对外导出的-rawAsap-方法\" class=\"headerlink\" title=\"首先是对外导出的 rawAsap 方法\"></a>首先是对外导出的 rawAsap 方法</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> queue = []</span><br><span class=\"line\"><span class=\"keyword\">var</span> flushing = <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rawAsap</span>(<span class=\"params\">task</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!queue.length) &#123;</span><br><span class=\"line\">    requestFlush()</span><br><span class=\"line\">    flushing = <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  queue[queue.length] = task</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>源码分析：如果任务栈 queue 为空，则触发 requestFlush 方法，并将 flushing 标志为 true，并且始终会将要执行的 task 添加到任务栈 queue 的末尾。这里需要注意的是由于 requestFlush 是异步去触发任务栈的执行的，所以即使 queue[queue.length]=task 在 requestFlush 调用之后执行，也能保证在任务栈 queue 真正执行前，任务 task 已经被添加到了任务栈 queue 的末尾。（如果任务栈 queue 不为空。所以 requestFlush 已经触发了，此时任务栈正在被循环依次执行，执行完毕会清空任务栈）</p>\n<h4 id=\"其次是异步触发-flush-方法执行的-requestFlush-方法\"><a href=\"#其次是异步触发-flush-方法执行的-requestFlush-方法\" class=\"headerlink\" title=\"其次是异步触发 flush 方法执行的 requestFlush 方法\"></a>其次是异步触发 flush 方法执行的 requestFlush 方法</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> domain</span><br><span class=\"line\"><span class=\"keyword\">var</span> hasSetImmediate = <span class=\"keyword\">typeof</span> setImmediate === <span class=\"string\">&#x27;function&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置为 rawAsap 的属性，方便在任务执行异常时再次触发 requestFlush</span></span><br><span class=\"line\">rawAsap.requestFlush = requestFlush</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">requestFlush</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 确保 flushing 未绑定到任何域</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> parentDomain = process.domain</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (parentDomain) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!domain) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 惰性加载执行 domain 模块</span></span><br><span class=\"line\">      domain = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;domain&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    domain.active = process.domain = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (flushing &amp;&amp; hasSetImmediate) &#123;</span><br><span class=\"line\">    setImmediate(flush)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    process.nextTick(flush)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (parentDomain) &#123;</span><br><span class=\"line\">    domain.active = process.domain = parentDomain</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>源码解析：核心代码其实就一句：setImmediate(flush)，通过 setImmediate 异步执行 flush 方法。而判断 parentDomain 以及设置和恢复 domain 都只是为了当前的 flush 方法不绑定任何域执行。而这里还有一个 hasSetImmediate 判断，是为了做兼容降级处理，如果不存在 setImmediate 方法，则使用 process.nextTick 方法触发异步执行。但使用 process.nextTick 方法有一个缺陷，就是它不能够处理递归。</p>\n<h4 id=\"最后是执行任务栈的-flush-方法\"><a href=\"#最后是执行任务栈的-flush-方法\" class=\"headerlink\" title=\"最后是执行任务栈的 flush 方法\"></a>最后是执行任务栈的 flush 方法</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 下一个任务在任务队列中执行的位置</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> index = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> capacity = <span class=\"number\">1024</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">flush</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (index &lt; queue.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> currentIndex = index</span><br><span class=\"line\">    <span class=\"comment\">// 在调用任务之前先设置下一个任务的索引，可以确保再次触发 flush 方法时，跳过异常任务</span></span><br><span class=\"line\">    index = index + <span class=\"number\">1</span></span><br><span class=\"line\">    queue[currentIndex].call()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 防止内存泄露</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt; capacity) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (</span><br><span class=\"line\">        <span class=\"keyword\">var</span> scan = <span class=\"number\">0</span>, newLength = queue.length - index;</span><br><span class=\"line\">        scan &lt; newLength;</span><br><span class=\"line\">        scan++</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        queue[scan] = queue[scan + index]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      queue.length -= index</span><br><span class=\"line\">      index = <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  queue.length = <span class=\"number\">0</span></span><br><span class=\"line\">  index = <span class=\"number\">0</span></span><br><span class=\"line\">  flushing = <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>源码解析：通过 while 循环依次去执行任务栈 queue 中的每一个任务，这里需要注意一点，index + 1 表示下一个要执行的任务下标，而其放在 queue[currentIndex].call() 之前，是为了保证当当前任务执行发生异常了，再次触发 requestFlush 方法时，能够跳过发生异常的任务，从下一个任务开始执行。而判断 if (index &gt; capacity) 是为了防止内存泄露，当任务栈 queue 的长度超过了指定的阈值 capacity 时，对任务栈 queue 中的任务进行移动，将所有剩余的未执行的任务置前，并重置任务栈 queue 的长度。当所有任务执行完毕后，重置任务栈以及相应状态。</p>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>rawAsap 方法是通过 setImmediate 或 process.nextTick 来实现异步执行的任务栈，而 asap 方法是对 rawAsap 方法的进一步封装，通过缓存的 domain 和 try/finally 实现了即使某个任务抛出异常也可以恢复任务栈的继续执行（再次调用 rawAsap.requestFlush）。</p>\n<h2 id=\"Node-js-的-Event-Loop\"><a href=\"#Node-js-的-Event-Loop\" class=\"headerlink\" title=\"Node.js 的 Event Loop\"></a>Node.js 的 Event Loop</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">  <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;promise&#x27;</span>)</span><br><span class=\"line\">    resolve()</span><br><span class=\"line\">  &#125;).then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;promise.then&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"comment\">//1 5 2 promise 4 promise.then</span></span><br></pre></td></tr></table></figure>\n\n<p>Node.js 也是单线程的 Event Loop，但是它的运行机制不同于浏览器。</p>\n<p>除了 settimeout 和 setInverval 这两个方法，Node.js 还提供了另外两种与任务队列有关的方法：process.nextTick 和 setImmediate。</p>\n<p>process.nextTick 方法可以在当前”执行栈”的尾部—-下一次 Event Loop（主线程读取”任务队列”）之前—-触发回调函数。也就是说，它指定的任务总是发生在所有异步任务之前。setImmediate 方法则是在当前”任务队列”的尾部添加事件，也就是说，它指定的任务总是在下一次 Event Loop 时执行，这与 setTimeout(fn, 0)很像。请看下面的例子（via StackOverflow）。（这就是为什么 promise 的链式 then 会在当前任务队列最后执行的原因吧）</p>\n<p>如果有多个 process.nextTick 语句（不管它们是否嵌套），将全部在当前”执行栈”执行。</p>\n<h3 id=\"process-nextTick-与-setImmediate\"><a href=\"#process-nextTick-与-setImmediate\" class=\"headerlink\" title=\"process.nextTick 与 setImmediate\"></a>process.nextTick 与 setImmediate</h3><p>process.nextTick 和 setImmediate 的一个重要区别：多个 process.nextTick 语句总是在当前”执行栈”一次执行完，多个 setImmediate 可能则需要多次 loop 才能执行完。事实上，这正是 Node.js 10.0 版添加 setImmediate 方法的原因，否则像下面这样的递归调用 process.nextTick，将会没完没了，主线程根本不会去读取”事件队列”！</p>\n<p>另外，由于 process.nextTick 指定的回调函数是在本次”事件循环”触发，而 setImmediate 指定的是在下次”事件循环”触发，所以很显然，前者总是比后者发生得早，而且执行效率也高（因为不用检查”任务队列”）。</p>\n<h3 id=\"Macrotasks-和-Microtasks\"><a href=\"#Macrotasks-和-Microtasks\" class=\"headerlink\" title=\"Macrotasks 和 Microtasks\"></a>Macrotasks 和 Microtasks</h3><p>Macrotasks 和 Microtasks 都属于上述的异步任务中的一种，他们分别有如下 API：<br>macrotasks: setTimeout, setInterval, setImmediate, I/O, UI rendering<br>microtasks: process.nextTick, Promise, MutationObserver</p>\n<p>setTimeout 的 macrotask， 和 Promise 的 microtask 有哪些不同，先来看下代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"comment\">//3</span></span><br><span class=\"line\"><span class=\"comment\">//4</span></span><br><span class=\"line\"><span class=\"comment\">//2</span></span><br></pre></td></tr></table></figure>\n\n<p>如上代码可以看到，Promise 的函数代码的异步任务会优先于 setTimeout 的延时为 0 的任务先执行。</p>\n<p>原因是任务队列分为 macrotasks 和 microtasks, 而 promise 中的 then 方法的函数会被推入到 microtasks 队列中，而 setTimeout 函数会被推入到 macrotasks 任务队列中，在每一次事件循环中，macrotask 只会提取一个执行，而 microtask 会一直提取，直到 microsoft 队列为空为止。</p>\n<p>也就是说如果某个 microtask 任务被推入到执行中，那么当主线程任务执行完成后，会循环调用该队列任务中的下一个任务来执行，直到该任务队列到最后一个任务为止。</p>\n<p>而事件循环每次只会入栈一个 macrotask,主线程执行完成该任务后又会检查 microtasks 队列并完成里面的所有任务后再执行 macrotask 的任务。</p>\n<h3 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;setImmediate&#x27;</span>)</span><br><span class=\"line\">  setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;嵌套setImmediate&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;nextTick&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// setImmediate</span></span><br><span class=\"line\"><span class=\"comment\">// nextTick</span></span><br><span class=\"line\"><span class=\"comment\">// 嵌套setImmediate</span></span><br></pre></td></tr></table></figure>\n\n<p>解析：事件循环 check 阶段执行回调函数输出 setImmediate，之后输出 nextTick。嵌套的 setImmediate 在下一个事件循环的 check 阶段执行回调输出嵌套的 setImmediate。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">someAsyncOperation</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 假设这个任务要消耗 95ms</span></span><br><span class=\"line\">  fs.readFile(<span class=\"string\">&#x27;/path/to/file&#x27;</span>, callback)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> timeoutScheduled = <span class=\"built_in\">Date</span>.now()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> delay = <span class=\"built_in\">Date</span>.now() - timeoutScheduled</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(delay + <span class=\"string\">&#x27;ms have passed since I was scheduled&#x27;</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// someAsyncOperation要消耗 95 ms 才能完成</span></span><br><span class=\"line\">someAsyncOperation(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> startCallback = <span class=\"built_in\">Date</span>.now()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 消耗 10ms...</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"built_in\">Date</span>.now() - startCallback &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do nothing</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>解析：事件循环进入 poll 阶段发现队列为空，并且没有代码被 setImmediate()。于是在 poll 阶段等待 timers 下限时间到达。当等到 95ms 时，fs.readFile 首先执行了，它的回调被添加进 poll 队列并同步执行，耗时 10ms。此时总共时间累积 105ms。等到 poll 队列为空的时候，事件循环会查看最近到达的 timer 的下限时间，发现已经到达，再回到 timers 阶段，执行 timer 的回调。</p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><ul>\n<li><a href=\"https://www.jianshu.com/p/837b584e1bdd\">Node 探秘之事件循环</a></li>\n<li><a href=\"https://yijiebuyi.com/blog/c96c2aa46fd0b91e75be22161cceeea1.html\">node.js 下的异步递归 setImmediate 和 process.nextTick 如何使用</a></li>\n<li><a href=\"https://www.yht7.com/news/80094\">asap 异步执行实现原理</a></li>\n<li><a href=\"https://nodejs.org/api/timers.html#timers_setimmediate_callback_args\">nodejs_setimmediate</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><a href=\"https://www.ruanyifeng.com/blog/2014/10/event-loop.html\">主线程从任务队列中读取事件，这个过程是循环不断的，所以整个种运行机制又称为 Event Loop(事件循环)</a></p>","more":"<p>JS 是一门非阻塞单线程语言。</p>\n<p>JS 在执行过程中会产生执行环境，这些执行环境会被顺序的加入到执行栈中。如果遇到异步的代码，会被挂起并加入搭配 Task（有多种 Task）队列中。一旦执行栈为空，Event Loop 就会从 Task 队列中拿出需要执行的代码放入到执行栈中执行。</p>\n<p>运行机制如下：</p>\n<ol>\n<li>所有同步任务都在主线程上执行，形成一个执行栈（execution context stack)</li>\n<li>主线程之外，还存在一个“任务队列（task quue）”。只要异步任务有了运行结果，就在任务队列中放置一个结果</li>\n<li>一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列，那些对应的异步任务，结束等待状态，进入执行栈开始执行</li>\n<li>主线程不断重复上面的第三步</li>\n</ol>\n<p><code>宏任务（mscro-task）和微任务（micro-task）表示异步任务的两种分类。在挂起任务时，JS引擎会将所有任务按照类别分到这两个队列中，首先在macrotask的队列取出第一个任务，执行完毕后取出microtask队列中的所有任务顺序执行；之后再取macrotask任务，周而复始，直至两个队列的任务都取完</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script start&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;setTimeout&#x27;</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"built_in\">setInterval</span>(myFunction,<span class=\"number\">60000</span>) <span class=\"comment\">//每隔6秒执行一次</span></span><br><span class=\"line\">funcition <span class=\"function\"><span class=\"title\">myFunction</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">   alert(<span class=\"string\">&#x27;myFunction()&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script end&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>以上代码虽然 setTimeout 延时为 0，其实还是异步。这是因为 HTML5 标准规定这个函数第二个参数不得小于 4 毫秒，不足会自动增加。所以 setTimeout 还是会在 script end 之后打印。</p>\n<h2 id=\"任务队列\"><a href=\"#任务队列\" class=\"headerlink\" title=\"任务队列\"></a>任务队列</h2><p>JS 中有两类任务队列：宏任务队列(macro task) 和 微任务队列(micro task)。宏任务队列可以有多个，微任务队列只有一个。<br>不同的任务源会被分配到不同的 Task 队列中，任务源可以分为 微任务（microtask） 和 宏任务（macrotask）。在 ES6 规范中，microtask 称为 jobs，macrotask 称为 task。</p>\n<ul>\n<li>(macro)task 宏任务:<br>(macro)task 主要包括：script(整体代码)，setTimeout、setInterval、I/O、UI 交互事件、setImmediate(Node.js 环境)</li>\n<li>(micro)task 微任务：<br>(micro)task 主要包括：Promise、MutaionObserver、process.nextTick(Node.js 环境)</li>\n</ul>\n<p>代码开始执行都是从 script（全局任务）开始，所以，一旦我们的全局任务（<code>&lt;script&gt;</code>属于宏任务）执行完，就马上执行完整个微任务队列。</p>\n<h2 id=\"Promise-哪些-API-涉及了微任务？\"><a href=\"#Promise-哪些-API-涉及了微任务？\" class=\"headerlink\" title=\"Promise 哪些 API 涉及了微任务？\"></a>Promise 哪些 API 涉及了微任务？</h2><p>Promise 中只有涉及到状态变更后才需要被执行的回调才算是微任务，比如说 then、catch、finally,其他所有的代码执行都是宏任务（同步执行）</p>\n<h3 id=\"1\"><a href=\"#1\" class=\"headerlink\" title=\"1\"></a>1</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script start&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;p 1&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;setTimeout&#x27;</span>);</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> s = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() - s &lt; <span class=\"number\">50</span>); <span class=\"comment\">// 阻塞50ms</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;p 2&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script ent&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*** output ***/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// one macro task</span></span><br><span class=\"line\">script start</span><br><span class=\"line\">script ent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// all micro tasks</span></span><br><span class=\"line\">p <span class=\"number\">1</span></span><br><span class=\"line\">p <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// one macro task again</span></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2\"><a href=\"#2\" class=\"headerlink\" title=\"2\"></a>2</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script start&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;setTimeout&#x27;</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Promise&#x27;</span>)</span><br><span class=\"line\">  resolve()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;promise1&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;promise2&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;script end&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// script start =&gt; Promise =&gt; script end =&gt; promise1 =&gt; promise2 =&gt; setTimeout</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3\"><a href=\"#3\" class=\"headerlink\" title=\"3\"></a>3</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-1&#x27;</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then2&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4\"><a href=\"#4\" class=\"headerlink\" title=\"4\"></a>4</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> p = <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-1&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;).then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-2&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then2&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5\"><a href=\"#5\" class=\"headerlink\" title=\"5\"></a>5</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> p = <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve().then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-1&#x27;</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then2&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then3&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6\"><a href=\"#6\" class=\"headerlink\" title=\"6\"></a>6</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-1&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then1-2&#x27;</span>)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then2&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then3&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;then4&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7\"><a href=\"#7\" class=\"headerlink\" title=\"7\"></a>7</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">promise2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>()</span><br><span class=\"line\">promise2</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//then new Promise=&gt;a</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1111</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//then new promise b</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;1111-1&#x27;</span>)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// then new promise e</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;1111-2&#x27;</span>)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// then new promise c</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2222</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">promise2</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//同一个promise a</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3333</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// then new promise d</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">44444</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"><span class=\"comment\">//1111</span></span><br><span class=\"line\"><span class=\"comment\">//3333</span></span><br><span class=\"line\"><span class=\"comment\">//1111-1</span></span><br><span class=\"line\"><span class=\"comment\">//2222</span></span><br><span class=\"line\"><span class=\"comment\">//44444</span></span><br><span class=\"line\"><span class=\"comment\">//1111-2</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Promise-与-asap-异步执行原理\"><a href=\"#Promise-与-asap-异步执行原理\" class=\"headerlink\" title=\"Promise 与 asap 异步执行原理\"></a>Promise 与 asap 异步执行原理</h2><p>Promise 异步执行是通过<a href=\"https://github.com/kriskowal/asap\">asap</a>这个库来实现的</p>\n<h3 id=\"asap-概述\"><a href=\"#asap-概述\" class=\"headerlink\" title=\"asap 概述\"></a>asap 概述</h3><p>asap 是 as soon as possible 的简称，在 Node 和浏览器环境下，能讲回调函数以高优先级任务来执行（下一个时间循环之前），即把任务放在微队列中执行。<br>用法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">asap(function () &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; ...</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"asap-源码分析-Node-版\"><a href=\"#asap-源码分析-Node-版\" class=\"headerlink\" title=\"asap 源码分析-Node 版\"></a>asap 源码分析-Node 版</h3><p>asap 源码库包含了支持 Node 和浏览器的两个版本，这里主要分析 Node 版<br>主要包含两个源码文件</p>\n<ul>\n<li><a href=\"https://github.com/kriskowal/asap/blob/master/asap.js\">asap.js</a></li>\n<li><a href=\"https://github.com/kriskowal/asap/blob/master/raw.js\">raw.js</a></li>\n</ul>\n<p>这两个文件分别导出了 asap 和 rawAsap 这两个方法，而 asap 可以看作是对 rawAsap 的进一步封装，通过缓存的 domain（可以捕捉处理 try catch 无法捕捉的异常，针对异步代码的异常处理）和 try/finally 实现了即使某个任务抛出异常也可以恢复任务栈的继续执行，另外也做了一点缓存优化（具体见源码）。</p>\n<p>因此这里主要分析 raw.js 里面的代码即可：</p>\n<h4 id=\"首先是对外导出的-rawAsap-方法\"><a href=\"#首先是对外导出的-rawAsap-方法\" class=\"headerlink\" title=\"首先是对外导出的 rawAsap 方法\"></a>首先是对外导出的 rawAsap 方法</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> queue = []</span><br><span class=\"line\"><span class=\"keyword\">var</span> flushing = <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rawAsap</span>(<span class=\"params\">task</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!queue.length) &#123;</span><br><span class=\"line\">    requestFlush()</span><br><span class=\"line\">    flushing = <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  queue[queue.length] = task</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>源码分析：如果任务栈 queue 为空，则触发 requestFlush 方法，并将 flushing 标志为 true，并且始终会将要执行的 task 添加到任务栈 queue 的末尾。这里需要注意的是由于 requestFlush 是异步去触发任务栈的执行的，所以即使 queue[queue.length]=task 在 requestFlush 调用之后执行，也能保证在任务栈 queue 真正执行前，任务 task 已经被添加到了任务栈 queue 的末尾。（如果任务栈 queue 不为空。所以 requestFlush 已经触发了，此时任务栈正在被循环依次执行，执行完毕会清空任务栈）</p>\n<h4 id=\"其次是异步触发-flush-方法执行的-requestFlush-方法\"><a href=\"#其次是异步触发-flush-方法执行的-requestFlush-方法\" class=\"headerlink\" title=\"其次是异步触发 flush 方法执行的 requestFlush 方法\"></a>其次是异步触发 flush 方法执行的 requestFlush 方法</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> domain</span><br><span class=\"line\"><span class=\"keyword\">var</span> hasSetImmediate = <span class=\"keyword\">typeof</span> setImmediate === <span class=\"string\">&#x27;function&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置为 rawAsap 的属性，方便在任务执行异常时再次触发 requestFlush</span></span><br><span class=\"line\">rawAsap.requestFlush = requestFlush</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">requestFlush</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 确保 flushing 未绑定到任何域</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> parentDomain = process.domain</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (parentDomain) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!domain) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 惰性加载执行 domain 模块</span></span><br><span class=\"line\">      domain = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;domain&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    domain.active = process.domain = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (flushing &amp;&amp; hasSetImmediate) &#123;</span><br><span class=\"line\">    setImmediate(flush)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    process.nextTick(flush)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (parentDomain) &#123;</span><br><span class=\"line\">    domain.active = process.domain = parentDomain</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>源码解析：核心代码其实就一句：setImmediate(flush)，通过 setImmediate 异步执行 flush 方法。而判断 parentDomain 以及设置和恢复 domain 都只是为了当前的 flush 方法不绑定任何域执行。而这里还有一个 hasSetImmediate 判断，是为了做兼容降级处理，如果不存在 setImmediate 方法，则使用 process.nextTick 方法触发异步执行。但使用 process.nextTick 方法有一个缺陷，就是它不能够处理递归。</p>\n<h4 id=\"最后是执行任务栈的-flush-方法\"><a href=\"#最后是执行任务栈的-flush-方法\" class=\"headerlink\" title=\"最后是执行任务栈的 flush 方法\"></a>最后是执行任务栈的 flush 方法</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 下一个任务在任务队列中执行的位置</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> index = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> capacity = <span class=\"number\">1024</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">flush</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (index &lt; queue.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> currentIndex = index</span><br><span class=\"line\">    <span class=\"comment\">// 在调用任务之前先设置下一个任务的索引，可以确保再次触发 flush 方法时，跳过异常任务</span></span><br><span class=\"line\">    index = index + <span class=\"number\">1</span></span><br><span class=\"line\">    queue[currentIndex].call()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 防止内存泄露</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt; capacity) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (</span><br><span class=\"line\">        <span class=\"keyword\">var</span> scan = <span class=\"number\">0</span>, newLength = queue.length - index;</span><br><span class=\"line\">        scan &lt; newLength;</span><br><span class=\"line\">        scan++</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        queue[scan] = queue[scan + index]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      queue.length -= index</span><br><span class=\"line\">      index = <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  queue.length = <span class=\"number\">0</span></span><br><span class=\"line\">  index = <span class=\"number\">0</span></span><br><span class=\"line\">  flushing = <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>源码解析：通过 while 循环依次去执行任务栈 queue 中的每一个任务，这里需要注意一点，index + 1 表示下一个要执行的任务下标，而其放在 queue[currentIndex].call() 之前，是为了保证当当前任务执行发生异常了，再次触发 requestFlush 方法时，能够跳过发生异常的任务，从下一个任务开始执行。而判断 if (index &gt; capacity) 是为了防止内存泄露，当任务栈 queue 的长度超过了指定的阈值 capacity 时，对任务栈 queue 中的任务进行移动，将所有剩余的未执行的任务置前，并重置任务栈 queue 的长度。当所有任务执行完毕后，重置任务栈以及相应状态。</p>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>rawAsap 方法是通过 setImmediate 或 process.nextTick 来实现异步执行的任务栈，而 asap 方法是对 rawAsap 方法的进一步封装，通过缓存的 domain 和 try/finally 实现了即使某个任务抛出异常也可以恢复任务栈的继续执行（再次调用 rawAsap.requestFlush）。</p>\n<h2 id=\"Node-js-的-Event-Loop\"><a href=\"#Node-js-的-Event-Loop\" class=\"headerlink\" title=\"Node.js 的 Event Loop\"></a>Node.js 的 Event Loop</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">  <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;promise&#x27;</span>)</span><br><span class=\"line\">    resolve()</span><br><span class=\"line\">  &#125;).then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;promise.then&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"comment\">//1 5 2 promise 4 promise.then</span></span><br></pre></td></tr></table></figure>\n\n<p>Node.js 也是单线程的 Event Loop，但是它的运行机制不同于浏览器。</p>\n<p>除了 settimeout 和 setInverval 这两个方法，Node.js 还提供了另外两种与任务队列有关的方法：process.nextTick 和 setImmediate。</p>\n<p>process.nextTick 方法可以在当前”执行栈”的尾部—-下一次 Event Loop（主线程读取”任务队列”）之前—-触发回调函数。也就是说，它指定的任务总是发生在所有异步任务之前。setImmediate 方法则是在当前”任务队列”的尾部添加事件，也就是说，它指定的任务总是在下一次 Event Loop 时执行，这与 setTimeout(fn, 0)很像。请看下面的例子（via StackOverflow）。（这就是为什么 promise 的链式 then 会在当前任务队列最后执行的原因吧）</p>\n<p>如果有多个 process.nextTick 语句（不管它们是否嵌套），将全部在当前”执行栈”执行。</p>\n<h3 id=\"process-nextTick-与-setImmediate\"><a href=\"#process-nextTick-与-setImmediate\" class=\"headerlink\" title=\"process.nextTick 与 setImmediate\"></a>process.nextTick 与 setImmediate</h3><p>process.nextTick 和 setImmediate 的一个重要区别：多个 process.nextTick 语句总是在当前”执行栈”一次执行完，多个 setImmediate 可能则需要多次 loop 才能执行完。事实上，这正是 Node.js 10.0 版添加 setImmediate 方法的原因，否则像下面这样的递归调用 process.nextTick，将会没完没了，主线程根本不会去读取”事件队列”！</p>\n<p>另外，由于 process.nextTick 指定的回调函数是在本次”事件循环”触发，而 setImmediate 指定的是在下次”事件循环”触发，所以很显然，前者总是比后者发生得早，而且执行效率也高（因为不用检查”任务队列”）。</p>\n<h3 id=\"Macrotasks-和-Microtasks\"><a href=\"#Macrotasks-和-Microtasks\" class=\"headerlink\" title=\"Macrotasks 和 Microtasks\"></a>Macrotasks 和 Microtasks</h3><p>Macrotasks 和 Microtasks 都属于上述的异步任务中的一种，他们分别有如下 API：<br>macrotasks: setTimeout, setInterval, setImmediate, I/O, UI rendering<br>microtasks: process.nextTick, Promise, MutationObserver</p>\n<p>setTimeout 的 macrotask， 和 Promise 的 microtask 有哪些不同，先来看下代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"comment\">//3</span></span><br><span class=\"line\"><span class=\"comment\">//4</span></span><br><span class=\"line\"><span class=\"comment\">//2</span></span><br></pre></td></tr></table></figure>\n\n<p>如上代码可以看到，Promise 的函数代码的异步任务会优先于 setTimeout 的延时为 0 的任务先执行。</p>\n<p>原因是任务队列分为 macrotasks 和 microtasks, 而 promise 中的 then 方法的函数会被推入到 microtasks 队列中，而 setTimeout 函数会被推入到 macrotasks 任务队列中，在每一次事件循环中，macrotask 只会提取一个执行，而 microtask 会一直提取，直到 microsoft 队列为空为止。</p>\n<p>也就是说如果某个 microtask 任务被推入到执行中，那么当主线程任务执行完成后，会循环调用该队列任务中的下一个任务来执行，直到该任务队列到最后一个任务为止。</p>\n<p>而事件循环每次只会入栈一个 macrotask,主线程执行完成该任务后又会检查 microtasks 队列并完成里面的所有任务后再执行 macrotask 的任务。</p>\n<h3 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;setImmediate&#x27;</span>)</span><br><span class=\"line\">  setImmediate(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;嵌套setImmediate&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  process.nextTick(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;nextTick&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// setImmediate</span></span><br><span class=\"line\"><span class=\"comment\">// nextTick</span></span><br><span class=\"line\"><span class=\"comment\">// 嵌套setImmediate</span></span><br></pre></td></tr></table></figure>\n\n<p>解析：事件循环 check 阶段执行回调函数输出 setImmediate，之后输出 nextTick。嵌套的 setImmediate 在下一个事件循环的 check 阶段执行回调输出嵌套的 setImmediate。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">someAsyncOperation</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 假设这个任务要消耗 95ms</span></span><br><span class=\"line\">  fs.readFile(<span class=\"string\">&#x27;/path/to/file&#x27;</span>, callback)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> timeoutScheduled = <span class=\"built_in\">Date</span>.now()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> delay = <span class=\"built_in\">Date</span>.now() - timeoutScheduled</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(delay + <span class=\"string\">&#x27;ms have passed since I was scheduled&#x27;</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// someAsyncOperation要消耗 95 ms 才能完成</span></span><br><span class=\"line\">someAsyncOperation(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> startCallback = <span class=\"built_in\">Date</span>.now()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 消耗 10ms...</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"built_in\">Date</span>.now() - startCallback &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do nothing</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>解析：事件循环进入 poll 阶段发现队列为空，并且没有代码被 setImmediate()。于是在 poll 阶段等待 timers 下限时间到达。当等到 95ms 时，fs.readFile 首先执行了，它的回调被添加进 poll 队列并同步执行，耗时 10ms。此时总共时间累积 105ms。等到 poll 队列为空的时候，事件循环会查看最近到达的 timer 的下限时间，发现已经到达，再回到 timers 阶段，执行 timer 的回调。</p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><ul>\n<li><a href=\"https://www.jianshu.com/p/837b584e1bdd\">Node 探秘之事件循环</a></li>\n<li><a href=\"https://yijiebuyi.com/blog/c96c2aa46fd0b91e75be22161cceeea1.html\">node.js 下的异步递归 setImmediate 和 process.nextTick 如何使用</a></li>\n<li><a href=\"https://www.yht7.com/news/80094\">asap 异步执行实现原理</a></li>\n<li><a href=\"https://nodejs.org/api/timers.html#timers_setimmediate_callback_args\">nodejs_setimmediate</a></li>\n</ul>"},{"title":"HTTP2","date":"2018-03-22T03:05:35.000Z","_content":"\nhttp/2 的前身是由 Google 与 2009 年发布的实验性协议 SPDY，其主要目标是**通过解决 HTTP/1.1 中广为人知的一些性能限制来减少页面的架子啊延迟**。\n\n<!--more-->\n\nHTTP 请求完就结束了，所以 HTTP 根本没有长连接说法，更没有短连接了，**HTTP 是应用层的协议**，而长连接与短连接说的是 TCP 链接，TCP 链接是一个双向通道，它可以保持一段时间不关闭，因为 TCP 链接才有真正的长连接和短连接。\n\n一个形象的例子就是，拿你在网上购物来说，HTTP 协议是指的那个快递单，你寄件的时候填的单子就像是发了一个 HTTP 请求，等货物运到地方了，快递员会根据你发的请求把货物送给相应的收货人。而 TCP 协议就是中间运货的那个大货车，也可能是火车或者飞机，但不管是什么，它是负责运输的，因此必须要有路，不管是地上还是天上。那么这个路就是所谓的 TCP 连接，也就是一个双向的数据通道。\n\n在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输 HTTP 数据的 TCP 连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。Keep-Alive 不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如 Apache）中设定这个时间。实现长连接要客户端和服务端都支持长连接。\n\nHTTP/1.1 的主要性能问题：\n\n- HTTTP/1.x 客户端需要使用多个连接才能实现并发和缩短延时。\n- HTTP/1.x 不会压缩请求和响应标头，从而导致不必要的网络流量。\n- HTTP/1.x 不支持有效的资源优先级，致使底层 TCP 连接的利用率低下。\n\n这正是 HTTP/2 要致力于解决的：\nHTTP/2 通过支持**标头字段压缩和在同一连接上进行多个并发连接**，让应用更有效低利用网络资源，减少感知的延时时间。具体来说，它可以对同一链接上的请求和响应消息进行交错发送并未 HTTP 标头字段有效编码。**HTTP/2 还允许为请求设置优先级，让更重要的请求更快速地完成**，从而进一步提升性能。\n\n## 多路复用的单一长连接\n\n### 单一长连接\n\n在 HTTP/2 中，客户端向某个域名的服务器请求页面的过程中，**只会创建一条 TCP 连接**，即使这页面可能包含上百个资源。而之前的 HTTP/1.x 一般会创建 6-8 条 TCP 连接来请求这 100 多个资源。单一的连接应该是 HTTP2 的主要优势，单一的连接能减少 TCP 握手带来的延时（如果是建立在 SSL、TLS 上面，HTTP2 能减少很多不必要的 SSL 握手。）\n\nTCP 协议有一个滑动窗口，有慢启动这件事，就是说每次建立连接后，数据先是慢慢的传，然后滑动窗口慢慢变大，才能较高效的传，但是 http/1.x 会创建新连接受数据，因此像公交车一样走走停停（向大神致敬）。\n\n### 多路复用\n\n![network](/images/common/http2_1.jpg)\n\n在 http1.x 中，在一条 TCP 连接上，多个请求只能串行执行。HTTP2 把要传输的信息分割成一个个二进制帧，首部信息会被封装到 HWADER Frame，相应的 request body 就会放到 DATA Frame，这样就讲请求和响应区分开来了。进一步 HTTP2 还能对这些流（车道）制定优先级，优先级能动态的被改变。优先级能动态的被改变，例如把 CSS 和 JavaScript 文件设置得比图片的优先级要高，这样代码文件能更快的下载下来并得到执行。\n\n## 头部压缩和二进制格式\n\n因为一些重复东西在每个 http 请求里面都有，例如 method: GET。当一个客户端从同一服务器请求一些资源（例如页面的图片）的时候，这些请求看起来几乎是一致的。而这些大量一致的东西正好值得被压缩。HTTP2 使用 HPACK 要锁头部，减少报头的大小\n\n## 服务端推送 server push\n\n这个功能通常被称为“缓存推送”。主要思想是：当用户请求资源 X，而服务器知道它可能也需要资源 Z 的情况下，服务器可以在客户端发送请求之前，主动将资源 Z 推送给客户端。\n\n这个功能帮组客户端将 Z 放进缓存以备将来只需。**服务端推送需要客户端显示的允许服务器提供该功能**，但即使如此，客户端依然能自主选择是否需要终端推送的流。如果不需要的话。客户端可以通过发送一个 RST_STREAM 帧来中止。\n","source":"_posts/HTTP2.md","raw":"---\ntitle: HTTP2\ndate: 2018-03-22 11:05:35\ncategories: 网络&安全\n---\n\nhttp/2 的前身是由 Google 与 2009 年发布的实验性协议 SPDY，其主要目标是**通过解决 HTTP/1.1 中广为人知的一些性能限制来减少页面的架子啊延迟**。\n\n<!--more-->\n\nHTTP 请求完就结束了，所以 HTTP 根本没有长连接说法，更没有短连接了，**HTTP 是应用层的协议**，而长连接与短连接说的是 TCP 链接，TCP 链接是一个双向通道，它可以保持一段时间不关闭，因为 TCP 链接才有真正的长连接和短连接。\n\n一个形象的例子就是，拿你在网上购物来说，HTTP 协议是指的那个快递单，你寄件的时候填的单子就像是发了一个 HTTP 请求，等货物运到地方了，快递员会根据你发的请求把货物送给相应的收货人。而 TCP 协议就是中间运货的那个大货车，也可能是火车或者飞机，但不管是什么，它是负责运输的，因此必须要有路，不管是地上还是天上。那么这个路就是所谓的 TCP 连接，也就是一个双向的数据通道。\n\n在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输 HTTP 数据的 TCP 连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。Keep-Alive 不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如 Apache）中设定这个时间。实现长连接要客户端和服务端都支持长连接。\n\nHTTP/1.1 的主要性能问题：\n\n- HTTTP/1.x 客户端需要使用多个连接才能实现并发和缩短延时。\n- HTTP/1.x 不会压缩请求和响应标头，从而导致不必要的网络流量。\n- HTTP/1.x 不支持有效的资源优先级，致使底层 TCP 连接的利用率低下。\n\n这正是 HTTP/2 要致力于解决的：\nHTTP/2 通过支持**标头字段压缩和在同一连接上进行多个并发连接**，让应用更有效低利用网络资源，减少感知的延时时间。具体来说，它可以对同一链接上的请求和响应消息进行交错发送并未 HTTP 标头字段有效编码。**HTTP/2 还允许为请求设置优先级，让更重要的请求更快速地完成**，从而进一步提升性能。\n\n## 多路复用的单一长连接\n\n### 单一长连接\n\n在 HTTP/2 中，客户端向某个域名的服务器请求页面的过程中，**只会创建一条 TCP 连接**，即使这页面可能包含上百个资源。而之前的 HTTP/1.x 一般会创建 6-8 条 TCP 连接来请求这 100 多个资源。单一的连接应该是 HTTP2 的主要优势，单一的连接能减少 TCP 握手带来的延时（如果是建立在 SSL、TLS 上面，HTTP2 能减少很多不必要的 SSL 握手。）\n\nTCP 协议有一个滑动窗口，有慢启动这件事，就是说每次建立连接后，数据先是慢慢的传，然后滑动窗口慢慢变大，才能较高效的传，但是 http/1.x 会创建新连接受数据，因此像公交车一样走走停停（向大神致敬）。\n\n### 多路复用\n\n![network](/images/common/http2_1.jpg)\n\n在 http1.x 中，在一条 TCP 连接上，多个请求只能串行执行。HTTP2 把要传输的信息分割成一个个二进制帧，首部信息会被封装到 HWADER Frame，相应的 request body 就会放到 DATA Frame，这样就讲请求和响应区分开来了。进一步 HTTP2 还能对这些流（车道）制定优先级，优先级能动态的被改变。优先级能动态的被改变，例如把 CSS 和 JavaScript 文件设置得比图片的优先级要高，这样代码文件能更快的下载下来并得到执行。\n\n## 头部压缩和二进制格式\n\n因为一些重复东西在每个 http 请求里面都有，例如 method: GET。当一个客户端从同一服务器请求一些资源（例如页面的图片）的时候，这些请求看起来几乎是一致的。而这些大量一致的东西正好值得被压缩。HTTP2 使用 HPACK 要锁头部，减少报头的大小\n\n## 服务端推送 server push\n\n这个功能通常被称为“缓存推送”。主要思想是：当用户请求资源 X，而服务器知道它可能也需要资源 Z 的情况下，服务器可以在客户端发送请求之前，主动将资源 Z 推送给客户端。\n\n这个功能帮组客户端将 Z 放进缓存以备将来只需。**服务端推送需要客户端显示的允许服务器提供该功能**，但即使如此，客户端依然能自主选择是否需要终端推送的流。如果不需要的话。客户端可以通过发送一个 RST_STREAM 帧来中止。\n","slug":"HTTP2","published":1,"updated":"2021-05-23T15:23:12.708Z","_id":"ckon1h1wf0006l5v0fzooajl1","comments":1,"layout":"post","photos":[],"link":"","content":"<p>http/2 的前身是由 Google 与 2009 年发布的实验性协议 SPDY，其主要目标是<strong>通过解决 HTTP/1.1 中广为人知的一些性能限制来减少页面的架子啊延迟</strong>。</p>\n<span id=\"more\"></span>\n\n<p>HTTP 请求完就结束了，所以 HTTP 根本没有长连接说法，更没有短连接了，<strong>HTTP 是应用层的协议</strong>，而长连接与短连接说的是 TCP 链接，TCP 链接是一个双向通道，它可以保持一段时间不关闭，因为 TCP 链接才有真正的长连接和短连接。</p>\n<p>一个形象的例子就是，拿你在网上购物来说，HTTP 协议是指的那个快递单，你寄件的时候填的单子就像是发了一个 HTTP 请求，等货物运到地方了，快递员会根据你发的请求把货物送给相应的收货人。而 TCP 协议就是中间运货的那个大货车，也可能是火车或者飞机，但不管是什么，它是负责运输的，因此必须要有路，不管是地上还是天上。那么这个路就是所谓的 TCP 连接，也就是一个双向的数据通道。</p>\n<p>在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输 HTTP 数据的 TCP 连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。Keep-Alive 不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如 Apache）中设定这个时间。实现长连接要客户端和服务端都支持长连接。</p>\n<p>HTTP/1.1 的主要性能问题：</p>\n<ul>\n<li>HTTTP/1.x 客户端需要使用多个连接才能实现并发和缩短延时。</li>\n<li>HTTP/1.x 不会压缩请求和响应标头，从而导致不必要的网络流量。</li>\n<li>HTTP/1.x 不支持有效的资源优先级，致使底层 TCP 连接的利用率低下。</li>\n</ul>\n<p>这正是 HTTP/2 要致力于解决的：<br>HTTP/2 通过支持<strong>标头字段压缩和在同一连接上进行多个并发连接</strong>，让应用更有效低利用网络资源，减少感知的延时时间。具体来说，它可以对同一链接上的请求和响应消息进行交错发送并未 HTTP 标头字段有效编码。<strong>HTTP/2 还允许为请求设置优先级，让更重要的请求更快速地完成</strong>，从而进一步提升性能。</p>\n<h2 id=\"多路复用的单一长连接\"><a href=\"#多路复用的单一长连接\" class=\"headerlink\" title=\"多路复用的单一长连接\"></a>多路复用的单一长连接</h2><h3 id=\"单一长连接\"><a href=\"#单一长连接\" class=\"headerlink\" title=\"单一长连接\"></a>单一长连接</h3><p>在 HTTP/2 中，客户端向某个域名的服务器请求页面的过程中，<strong>只会创建一条 TCP 连接</strong>，即使这页面可能包含上百个资源。而之前的 HTTP/1.x 一般会创建 6-8 条 TCP 连接来请求这 100 多个资源。单一的连接应该是 HTTP2 的主要优势，单一的连接能减少 TCP 握手带来的延时（如果是建立在 SSL、TLS 上面，HTTP2 能减少很多不必要的 SSL 握手。）</p>\n<p>TCP 协议有一个滑动窗口，有慢启动这件事，就是说每次建立连接后，数据先是慢慢的传，然后滑动窗口慢慢变大，才能较高效的传，但是 http/1.x 会创建新连接受数据，因此像公交车一样走走停停（向大神致敬）。</p>\n<h3 id=\"多路复用\"><a href=\"#多路复用\" class=\"headerlink\" title=\"多路复用\"></a>多路复用</h3><p><img src=\"/images/common/http2_1.jpg\" alt=\"network\"></p>\n<p>在 http1.x 中，在一条 TCP 连接上，多个请求只能串行执行。HTTP2 把要传输的信息分割成一个个二进制帧，首部信息会被封装到 HWADER Frame，相应的 request body 就会放到 DATA Frame，这样就讲请求和响应区分开来了。进一步 HTTP2 还能对这些流（车道）制定优先级，优先级能动态的被改变。优先级能动态的被改变，例如把 CSS 和 JavaScript 文件设置得比图片的优先级要高，这样代码文件能更快的下载下来并得到执行。</p>\n<h2 id=\"头部压缩和二进制格式\"><a href=\"#头部压缩和二进制格式\" class=\"headerlink\" title=\"头部压缩和二进制格式\"></a>头部压缩和二进制格式</h2><p>因为一些重复东西在每个 http 请求里面都有，例如 method: GET。当一个客户端从同一服务器请求一些资源（例如页面的图片）的时候，这些请求看起来几乎是一致的。而这些大量一致的东西正好值得被压缩。HTTP2 使用 HPACK 要锁头部，减少报头的大小</p>\n<h2 id=\"服务端推送-server-push\"><a href=\"#服务端推送-server-push\" class=\"headerlink\" title=\"服务端推送 server push\"></a>服务端推送 server push</h2><p>这个功能通常被称为“缓存推送”。主要思想是：当用户请求资源 X，而服务器知道它可能也需要资源 Z 的情况下，服务器可以在客户端发送请求之前，主动将资源 Z 推送给客户端。</p>\n<p>这个功能帮组客户端将 Z 放进缓存以备将来只需。<strong>服务端推送需要客户端显示的允许服务器提供该功能</strong>，但即使如此，客户端依然能自主选择是否需要终端推送的流。如果不需要的话。客户端可以通过发送一个 RST_STREAM 帧来中止。</p>\n","site":{"data":{}},"excerpt":"<p>http/2 的前身是由 Google 与 2009 年发布的实验性协议 SPDY，其主要目标是<strong>通过解决 HTTP/1.1 中广为人知的一些性能限制来减少页面的架子啊延迟</strong>。</p>","more":"<p>HTTP 请求完就结束了，所以 HTTP 根本没有长连接说法，更没有短连接了，<strong>HTTP 是应用层的协议</strong>，而长连接与短连接说的是 TCP 链接，TCP 链接是一个双向通道，它可以保持一段时间不关闭，因为 TCP 链接才有真正的长连接和短连接。</p>\n<p>一个形象的例子就是，拿你在网上购物来说，HTTP 协议是指的那个快递单，你寄件的时候填的单子就像是发了一个 HTTP 请求，等货物运到地方了，快递员会根据你发的请求把货物送给相应的收货人。而 TCP 协议就是中间运货的那个大货车，也可能是火车或者飞机，但不管是什么，它是负责运输的，因此必须要有路，不管是地上还是天上。那么这个路就是所谓的 TCP 连接，也就是一个双向的数据通道。</p>\n<p>在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输 HTTP 数据的 TCP 连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。Keep-Alive 不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如 Apache）中设定这个时间。实现长连接要客户端和服务端都支持长连接。</p>\n<p>HTTP/1.1 的主要性能问题：</p>\n<ul>\n<li>HTTTP/1.x 客户端需要使用多个连接才能实现并发和缩短延时。</li>\n<li>HTTP/1.x 不会压缩请求和响应标头，从而导致不必要的网络流量。</li>\n<li>HTTP/1.x 不支持有效的资源优先级，致使底层 TCP 连接的利用率低下。</li>\n</ul>\n<p>这正是 HTTP/2 要致力于解决的：<br>HTTP/2 通过支持<strong>标头字段压缩和在同一连接上进行多个并发连接</strong>，让应用更有效低利用网络资源，减少感知的延时时间。具体来说，它可以对同一链接上的请求和响应消息进行交错发送并未 HTTP 标头字段有效编码。<strong>HTTP/2 还允许为请求设置优先级，让更重要的请求更快速地完成</strong>，从而进一步提升性能。</p>\n<h2 id=\"多路复用的单一长连接\"><a href=\"#多路复用的单一长连接\" class=\"headerlink\" title=\"多路复用的单一长连接\"></a>多路复用的单一长连接</h2><h3 id=\"单一长连接\"><a href=\"#单一长连接\" class=\"headerlink\" title=\"单一长连接\"></a>单一长连接</h3><p>在 HTTP/2 中，客户端向某个域名的服务器请求页面的过程中，<strong>只会创建一条 TCP 连接</strong>，即使这页面可能包含上百个资源。而之前的 HTTP/1.x 一般会创建 6-8 条 TCP 连接来请求这 100 多个资源。单一的连接应该是 HTTP2 的主要优势，单一的连接能减少 TCP 握手带来的延时（如果是建立在 SSL、TLS 上面，HTTP2 能减少很多不必要的 SSL 握手。）</p>\n<p>TCP 协议有一个滑动窗口，有慢启动这件事，就是说每次建立连接后，数据先是慢慢的传，然后滑动窗口慢慢变大，才能较高效的传，但是 http/1.x 会创建新连接受数据，因此像公交车一样走走停停（向大神致敬）。</p>\n<h3 id=\"多路复用\"><a href=\"#多路复用\" class=\"headerlink\" title=\"多路复用\"></a>多路复用</h3><p><img src=\"/images/common/http2_1.jpg\" alt=\"network\"></p>\n<p>在 http1.x 中，在一条 TCP 连接上，多个请求只能串行执行。HTTP2 把要传输的信息分割成一个个二进制帧，首部信息会被封装到 HWADER Frame，相应的 request body 就会放到 DATA Frame，这样就讲请求和响应区分开来了。进一步 HTTP2 还能对这些流（车道）制定优先级，优先级能动态的被改变。优先级能动态的被改变，例如把 CSS 和 JavaScript 文件设置得比图片的优先级要高，这样代码文件能更快的下载下来并得到执行。</p>\n<h2 id=\"头部压缩和二进制格式\"><a href=\"#头部压缩和二进制格式\" class=\"headerlink\" title=\"头部压缩和二进制格式\"></a>头部压缩和二进制格式</h2><p>因为一些重复东西在每个 http 请求里面都有，例如 method: GET。当一个客户端从同一服务器请求一些资源（例如页面的图片）的时候，这些请求看起来几乎是一致的。而这些大量一致的东西正好值得被压缩。HTTP2 使用 HPACK 要锁头部，减少报头的大小</p>\n<h2 id=\"服务端推送-server-push\"><a href=\"#服务端推送-server-push\" class=\"headerlink\" title=\"服务端推送 server push\"></a>服务端推送 server push</h2><p>这个功能通常被称为“缓存推送”。主要思想是：当用户请求资源 X，而服务器知道它可能也需要资源 Z 的情况下，服务器可以在客户端发送请求之前，主动将资源 Z 推送给客户端。</p>\n<p>这个功能帮组客户端将 Z 放进缓存以备将来只需。<strong>服务端推送需要客户端显示的允许服务器提供该功能</strong>，但即使如此，客户端依然能自主选择是否需要终端推送的流。如果不需要的话。客户端可以通过发送一个 RST_STREAM 帧来中止。</p>"},{"title":"HTTPS","date":"2017-07-17T03:30:11.000Z","_content":"\nhttps 可以理解为 HTTP+TLS，TLS 是传输层加密协议，是 HTTPS 安全的核心，其前身是 SSL。TLS 主要有五部分 : 应用数据层协议，握手协议，报警协议，加密消息确认协议，心跳协议。TLS 协议本身又是由 record 协议传输的。\n\n<!--more-->\n\n## 为什么要实现 HTTPS？\n\n1. 由于 HTTP 本身不具备加密功能，所以无法做到对通信整体（使用 HTTP 协议通信的请求和响应的内容）进行加密，即 HTTP 报文使用明文的方式发送\n2. 由于 TCP/IP 协议簇的工作机制，通信内容在所有的通信线路上都有可能遭到窥视\n\n为保护用户隐私和网络安全。通过数据加密、校验数据完整性和身份认证三种机制来保障安全。\n防止窃听保护信息的集中对策中，最为普及的就是加密技术，加密对象有一下几个：\n\n- 通信加密：HTTP 协议没有加密机制，可以通过 SSL 或者是 TLS 的组合使用，加密 HTTP 的通信内容。用 SSL 建立安全通信线路之后，就可以在这条线路上进行 HTTP 通信，与 SSL 组合使用的 HTTP 被称为 HTTPS\n- 内容加密：对 HTTP 协议传输内容加密。客户端需要针对 HTTP 报文进行加密处理后再发送请求。为了做到有效内容加密，前提是客户端和服务器同时具备加密和解密机制\n\n### 定义\n\nHTTPS 并非是应用层的一种新协议，只是 HTTP 通新接口部分使用 SSL 和 TLS 协议替代而已。通过 TCP 和 HTTP 之间 TLS 来加密，由此保证数据传输的安全性。**HTPPS 就是身披 SSL 协议这串外壳的 HTTP**\n\n### SSL/TLS 协议\n\nSSL 协议是一种安全传输协议，TLS 是 SSLv3.0 的升级版\n\n### HTTPS 的层次图\n\n![network](/images/common/https_1.jpeg)\n\nHTTPS 通信时会先和 SSL 层建立通信，然后 SSL 层再和传输层中的 TCP 通信，所以 HHTPS 就是套了 SSL 外壳的 HTTP 协议\n\n## 实现 HTTPS 过程\n\n1. 要先申请 CA 证书，并安装在服务器上（一个文件，配置 nginx 支持监听 443 端口开启 ssl 并设置证书路径）\n2. 浏览器发送请求；\n3. 网站从浏览器发过来的加密规则中选一组自身也支持的加密算法和 hash 算法，并向浏览器发送带有公钥的证书，当然证书还包含了很多信息，如网站地址、证书的颁发机构、过期时间等。\n4. 浏览器解析证书。\n   - 验证证书的合法性。如颁发机构是否合法、证书中的网站地址是否与访问的地址一致，若不合法，则浏览器提示证书不受信任，若合法，浏览器会显示一个小锁头。\n   - 若合法，或用户接受了不合法的证书，浏览器会生成一串随机数的密码（即密钥），并用证书中提供的公钥加密。\n   - 使用约定好的 hash 计算握手消息，并使用生成的随机数（即密钥）对消息进行加密，最后将之前生成的所有消息一并发送给网站服务器。\n5. 网站服务器解析消息。用已有的私钥将密钥解密出来，然后用密钥解密发过来的握手消息，并验证是否跟浏览器传过来的一致。然后再用密钥加密一段握手消息，发送给浏览器。\n6. 浏览器解密并计算握手消息的 HASH，如果与服务端发来的 HASH 一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。这里浏览器与网站互相发送加密的握手消息并验证，目的是为了保证双方都获得了一致的密码，并且可以正常的加密解密数据，为后续真正数据的传输做一次测试。\n\n### TLS 与 SSL 握手过程\n\n![network](/images/common/https_2.png)\n\n## 全站 HTTPS 必须解决的问题\n\n**性能**\n\n- HTTPS 需要多次握手，因此网络耗时变长，用户从 HTTP 跳转到 HTTPS 需要一些时间。但是如果使用 SPDY，HTTPS 的速度甚至比 HTTP 快。HTTPS 对速度的影响主要来自两方面 :\n  1. 协议交换所增加的网络 RTT。\n  2. 加解密相关的计算耗时。\n- HTTPS 要做 RSA 校验，这会影响到设备性能。\n- 所有 CDN 节点要支持 HTTPS，而且需要有极其复杂的解决方案来面对 DDoS 的挑战。\n- 页面中所有嵌入的资源（图片、附件、js 、视频等）都要改为 HTTPS 的，否者就会报警。\n\n### 基于协议和配置的优化\n\n1. HTTPS 访问速度优化\n2. Tcp fast open\n\n### HTTPS\n\n网站通常的做法是对 HTTP 的访问服务器端做 302 跳转，跳转到 HTTPS。但是这个 302 跳转存在两个问题 :\n\n1. 使用不安全的 HTTP 协议进行通信。\n2. 增加一个 Round-Trip Time。\n\n而 HSTS 是 HTTP Strict Transport Security 的缩写，作用是强制客户端（如浏览器）使用 HTTPS 与服务器创建链接。其实 HSTS 的最大作用是防止 302HTTP 劫持（中间人）HSTS 的缺点是浏览器支持率不高，另外配置 HTST 后 HTTPS 很难实时降级为 HTTP。\n\n采用 HSTS 协议的网站将保证浏览器始终连接到该网站的 HTTPS 加密版本，不需要用户手动在 URL 地址栏中输入加密地址。该协议将帮助网站采用全局加密，用户看到的是该网站的安全版本。\n\n在 https://xxx 的响应头中含有 Strict-Transport-Security:max-age=31536000;includeSubDomains 这就意味着两点：\n\n1. 在一年的时间里（31536000 秒）中，浏览器只要向 XXX 或者其子域名发送 HTTP 请求时，必须采用 HTTPS 来发起连接。比如用户在地址栏输入 http://xxx 或者点击超链接，浏览器应当自动将 http 转写成 https, 然后直接向 https://xxx/ 发起请求。\n2. 在接下来的一年中，如果 xxx 服务器发送的 TLS 证书无效，用户不能忽略浏览器警告继续访问网站。\n\n#### 作用\n\nHTST 可以用来抵御 SSL 剥离攻击。攻击者在用户访问 HTTP 页面时替换所有 https 开头的连接为 http。达到阻止 HTTPS 的目的。但是如果使用了 HTST，一旦服务器发送了 HSTS 字段，用户将不再允许忽略警告。\n\n#### 不足\n\n用户首次访问网站是不受 HSTS 保护的。这是因为首次访问时，浏览器还未收到 HSTS，所以仍有可能明文 HTTP 访问。HTST 会在一段时间后失效（由 max-age 指定 )。所以浏览器是否强制 HSTS 取决于当前系统时间。部分操作系统经常通过网络时间协议更新系统时间。\n\n一旦浏览器接受到 HSTS Header( 假如有效期是 1 年），但是网站的证书出现问题，那么在有效都无法访问网站。\n\nSSL 慢可以归于以下两点：\n\n- 通信慢：同 HTTP 协议相比，网络负载会变慢，因此出去 TCP 链接、HTTP 请求与响应体外，还必须处理 SSL、TSL 通信，导致通信量的增加\n- SSL 必须进行加密处理：在服务器端和客户端都要通过加密、解密进行数据的安全处理，因此从结果而言，比起 HTTP 会更多的消耗服务器和客户端的硬件资源，导致负载增强。\n\n### Session resume 复用 session\n\n1. 减少 CPU 消耗，因为不需要非对称秘钥交换的计算。\n2. 提升访问速度，不需要进行完全握手阶段二，节省了一个 RTT 和计算耗时。\n\n### Session cache\n\nSession cache 的原理是使用 client hello 中的 session id 查询服务端的 session cache, 如果服务端有对应的缓存，则直接使用已有的 session 信息提前完成握手，称为简化握手。\n\nSession cache 有两个缺点：\n\n1. 需要消耗服务端内存来存储 session 内容。\n\n2. 目前的开源软件包括 nginx,apache 只支持单机多进程间共享缓存，不支持多机间分布式缓存，对于百度或者其他大型互联网公司而言，单机 session cache 几乎没有作用。\n\nSession cache 也有一个非常大的优点：\n\n1. session id 是 TLS 协议的标准字段，市面上的浏览器全部都支持 session cache。\n\n百度通过对 TLS 握手协议及服务器端实现的优化，已经支持全局的 session cache，能够明显提升用户的访问速度，节省服务器计算资源。\n\n### 使用 SPDY 或者 HTTP2\n\nSPDY 是 google 推出的优化 HTTP 传输效率的协议（https://www.chromium.org/spdy） 它基本上沿用了 HTTP 协议的语义 , 但是通过使用帧控制实现了多个特性，显著提升了 HTTP 协议的传输效率。SPDY 最大的特性就是多路复用，能将多个 HTTP 请求在同一个连接上一起发出去，不像目前的 HTTP 协议一样，只能串行地逐个发送请求。Pipeline 虽然支持多个请求一起发送，但是接收时依然得按照顺序接收，本质上无法解决并发的问题。\n\nHTTP2 是 IETF 2015 年 2 月份通过的 HTTP 下一代协议，它以 SPDY 为原型，经过两年多的讨论和完善最终确定。\n\n需要说明两点 :\n\n1. SPDY 和 HTTP2 目前的实现默认使用 HTTPS 协议。\n\n2. SPDY 和 HTTP2 都支持现有的 HTTP 语义和 API，对 Web 应用几乎是透明的。\n\nGoogle 宣布 chrome 浏览器 2016 年将放弃 SPDY 协议，全面支持 HTTP2，但是目前国内部分浏览器厂商进度非常慢，不仅不支持 HTTP2，连 SPDY 都没有支持过。\n\n百度服务端和百度手机浏览器现在都已经支持 SPDY3.1 协议。\n\n## 参考\n\n- [HTTP & HTTPS 网络协议重点总结](https://blog.csdn.net/ITermeng/article/details/78517364)\n- [Https 加密握手的过程](https://github.com/lgwebdream/FE-Interview/issues/937)\n","source":"_posts/HTTPS.md","raw":"---\ntitle: HTTPS\ncategories: 网络&安全\ndate: 2017-07-17 11:30:11\n---\n\nhttps 可以理解为 HTTP+TLS，TLS 是传输层加密协议，是 HTTPS 安全的核心，其前身是 SSL。TLS 主要有五部分 : 应用数据层协议，握手协议，报警协议，加密消息确认协议，心跳协议。TLS 协议本身又是由 record 协议传输的。\n\n<!--more-->\n\n## 为什么要实现 HTTPS？\n\n1. 由于 HTTP 本身不具备加密功能，所以无法做到对通信整体（使用 HTTP 协议通信的请求和响应的内容）进行加密，即 HTTP 报文使用明文的方式发送\n2. 由于 TCP/IP 协议簇的工作机制，通信内容在所有的通信线路上都有可能遭到窥视\n\n为保护用户隐私和网络安全。通过数据加密、校验数据完整性和身份认证三种机制来保障安全。\n防止窃听保护信息的集中对策中，最为普及的就是加密技术，加密对象有一下几个：\n\n- 通信加密：HTTP 协议没有加密机制，可以通过 SSL 或者是 TLS 的组合使用，加密 HTTP 的通信内容。用 SSL 建立安全通信线路之后，就可以在这条线路上进行 HTTP 通信，与 SSL 组合使用的 HTTP 被称为 HTTPS\n- 内容加密：对 HTTP 协议传输内容加密。客户端需要针对 HTTP 报文进行加密处理后再发送请求。为了做到有效内容加密，前提是客户端和服务器同时具备加密和解密机制\n\n### 定义\n\nHTTPS 并非是应用层的一种新协议，只是 HTTP 通新接口部分使用 SSL 和 TLS 协议替代而已。通过 TCP 和 HTTP 之间 TLS 来加密，由此保证数据传输的安全性。**HTPPS 就是身披 SSL 协议这串外壳的 HTTP**\n\n### SSL/TLS 协议\n\nSSL 协议是一种安全传输协议，TLS 是 SSLv3.0 的升级版\n\n### HTTPS 的层次图\n\n![network](/images/common/https_1.jpeg)\n\nHTTPS 通信时会先和 SSL 层建立通信，然后 SSL 层再和传输层中的 TCP 通信，所以 HHTPS 就是套了 SSL 外壳的 HTTP 协议\n\n## 实现 HTTPS 过程\n\n1. 要先申请 CA 证书，并安装在服务器上（一个文件，配置 nginx 支持监听 443 端口开启 ssl 并设置证书路径）\n2. 浏览器发送请求；\n3. 网站从浏览器发过来的加密规则中选一组自身也支持的加密算法和 hash 算法，并向浏览器发送带有公钥的证书，当然证书还包含了很多信息，如网站地址、证书的颁发机构、过期时间等。\n4. 浏览器解析证书。\n   - 验证证书的合法性。如颁发机构是否合法、证书中的网站地址是否与访问的地址一致，若不合法，则浏览器提示证书不受信任，若合法，浏览器会显示一个小锁头。\n   - 若合法，或用户接受了不合法的证书，浏览器会生成一串随机数的密码（即密钥），并用证书中提供的公钥加密。\n   - 使用约定好的 hash 计算握手消息，并使用生成的随机数（即密钥）对消息进行加密，最后将之前生成的所有消息一并发送给网站服务器。\n5. 网站服务器解析消息。用已有的私钥将密钥解密出来，然后用密钥解密发过来的握手消息，并验证是否跟浏览器传过来的一致。然后再用密钥加密一段握手消息，发送给浏览器。\n6. 浏览器解密并计算握手消息的 HASH，如果与服务端发来的 HASH 一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。这里浏览器与网站互相发送加密的握手消息并验证，目的是为了保证双方都获得了一致的密码，并且可以正常的加密解密数据，为后续真正数据的传输做一次测试。\n\n### TLS 与 SSL 握手过程\n\n![network](/images/common/https_2.png)\n\n## 全站 HTTPS 必须解决的问题\n\n**性能**\n\n- HTTPS 需要多次握手，因此网络耗时变长，用户从 HTTP 跳转到 HTTPS 需要一些时间。但是如果使用 SPDY，HTTPS 的速度甚至比 HTTP 快。HTTPS 对速度的影响主要来自两方面 :\n  1. 协议交换所增加的网络 RTT。\n  2. 加解密相关的计算耗时。\n- HTTPS 要做 RSA 校验，这会影响到设备性能。\n- 所有 CDN 节点要支持 HTTPS，而且需要有极其复杂的解决方案来面对 DDoS 的挑战。\n- 页面中所有嵌入的资源（图片、附件、js 、视频等）都要改为 HTTPS 的，否者就会报警。\n\n### 基于协议和配置的优化\n\n1. HTTPS 访问速度优化\n2. Tcp fast open\n\n### HTTPS\n\n网站通常的做法是对 HTTP 的访问服务器端做 302 跳转，跳转到 HTTPS。但是这个 302 跳转存在两个问题 :\n\n1. 使用不安全的 HTTP 协议进行通信。\n2. 增加一个 Round-Trip Time。\n\n而 HSTS 是 HTTP Strict Transport Security 的缩写，作用是强制客户端（如浏览器）使用 HTTPS 与服务器创建链接。其实 HSTS 的最大作用是防止 302HTTP 劫持（中间人）HSTS 的缺点是浏览器支持率不高，另外配置 HTST 后 HTTPS 很难实时降级为 HTTP。\n\n采用 HSTS 协议的网站将保证浏览器始终连接到该网站的 HTTPS 加密版本，不需要用户手动在 URL 地址栏中输入加密地址。该协议将帮助网站采用全局加密，用户看到的是该网站的安全版本。\n\n在 https://xxx 的响应头中含有 Strict-Transport-Security:max-age=31536000;includeSubDomains 这就意味着两点：\n\n1. 在一年的时间里（31536000 秒）中，浏览器只要向 XXX 或者其子域名发送 HTTP 请求时，必须采用 HTTPS 来发起连接。比如用户在地址栏输入 http://xxx 或者点击超链接，浏览器应当自动将 http 转写成 https, 然后直接向 https://xxx/ 发起请求。\n2. 在接下来的一年中，如果 xxx 服务器发送的 TLS 证书无效，用户不能忽略浏览器警告继续访问网站。\n\n#### 作用\n\nHTST 可以用来抵御 SSL 剥离攻击。攻击者在用户访问 HTTP 页面时替换所有 https 开头的连接为 http。达到阻止 HTTPS 的目的。但是如果使用了 HTST，一旦服务器发送了 HSTS 字段，用户将不再允许忽略警告。\n\n#### 不足\n\n用户首次访问网站是不受 HSTS 保护的。这是因为首次访问时，浏览器还未收到 HSTS，所以仍有可能明文 HTTP 访问。HTST 会在一段时间后失效（由 max-age 指定 )。所以浏览器是否强制 HSTS 取决于当前系统时间。部分操作系统经常通过网络时间协议更新系统时间。\n\n一旦浏览器接受到 HSTS Header( 假如有效期是 1 年），但是网站的证书出现问题，那么在有效都无法访问网站。\n\nSSL 慢可以归于以下两点：\n\n- 通信慢：同 HTTP 协议相比，网络负载会变慢，因此出去 TCP 链接、HTTP 请求与响应体外，还必须处理 SSL、TSL 通信，导致通信量的增加\n- SSL 必须进行加密处理：在服务器端和客户端都要通过加密、解密进行数据的安全处理，因此从结果而言，比起 HTTP 会更多的消耗服务器和客户端的硬件资源，导致负载增强。\n\n### Session resume 复用 session\n\n1. 减少 CPU 消耗，因为不需要非对称秘钥交换的计算。\n2. 提升访问速度，不需要进行完全握手阶段二，节省了一个 RTT 和计算耗时。\n\n### Session cache\n\nSession cache 的原理是使用 client hello 中的 session id 查询服务端的 session cache, 如果服务端有对应的缓存，则直接使用已有的 session 信息提前完成握手，称为简化握手。\n\nSession cache 有两个缺点：\n\n1. 需要消耗服务端内存来存储 session 内容。\n\n2. 目前的开源软件包括 nginx,apache 只支持单机多进程间共享缓存，不支持多机间分布式缓存，对于百度或者其他大型互联网公司而言，单机 session cache 几乎没有作用。\n\nSession cache 也有一个非常大的优点：\n\n1. session id 是 TLS 协议的标准字段，市面上的浏览器全部都支持 session cache。\n\n百度通过对 TLS 握手协议及服务器端实现的优化，已经支持全局的 session cache，能够明显提升用户的访问速度，节省服务器计算资源。\n\n### 使用 SPDY 或者 HTTP2\n\nSPDY 是 google 推出的优化 HTTP 传输效率的协议（https://www.chromium.org/spdy） 它基本上沿用了 HTTP 协议的语义 , 但是通过使用帧控制实现了多个特性，显著提升了 HTTP 协议的传输效率。SPDY 最大的特性就是多路复用，能将多个 HTTP 请求在同一个连接上一起发出去，不像目前的 HTTP 协议一样，只能串行地逐个发送请求。Pipeline 虽然支持多个请求一起发送，但是接收时依然得按照顺序接收，本质上无法解决并发的问题。\n\nHTTP2 是 IETF 2015 年 2 月份通过的 HTTP 下一代协议，它以 SPDY 为原型，经过两年多的讨论和完善最终确定。\n\n需要说明两点 :\n\n1. SPDY 和 HTTP2 目前的实现默认使用 HTTPS 协议。\n\n2. SPDY 和 HTTP2 都支持现有的 HTTP 语义和 API，对 Web 应用几乎是透明的。\n\nGoogle 宣布 chrome 浏览器 2016 年将放弃 SPDY 协议，全面支持 HTTP2，但是目前国内部分浏览器厂商进度非常慢，不仅不支持 HTTP2，连 SPDY 都没有支持过。\n\n百度服务端和百度手机浏览器现在都已经支持 SPDY3.1 协议。\n\n## 参考\n\n- [HTTP & HTTPS 网络协议重点总结](https://blog.csdn.net/ITermeng/article/details/78517364)\n- [Https 加密握手的过程](https://github.com/lgwebdream/FE-Interview/issues/937)\n","slug":"HTTPS","published":1,"updated":"2021-05-24T01:44:33.532Z","_id":"ckon1h1wg0008l5v0as918m3m","comments":1,"layout":"post","photos":[],"link":"","content":"<p>https 可以理解为 HTTP+TLS，TLS 是传输层加密协议，是 HTTPS 安全的核心，其前身是 SSL。TLS 主要有五部分 : 应用数据层协议，握手协议，报警协议，加密消息确认协议，心跳协议。TLS 协议本身又是由 record 协议传输的。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"为什么要实现-HTTPS？\"><a href=\"#为什么要实现-HTTPS？\" class=\"headerlink\" title=\"为什么要实现 HTTPS？\"></a>为什么要实现 HTTPS？</h2><ol>\n<li>由于 HTTP 本身不具备加密功能，所以无法做到对通信整体（使用 HTTP 协议通信的请求和响应的内容）进行加密，即 HTTP 报文使用明文的方式发送</li>\n<li>由于 TCP/IP 协议簇的工作机制，通信内容在所有的通信线路上都有可能遭到窥视</li>\n</ol>\n<p>为保护用户隐私和网络安全。通过数据加密、校验数据完整性和身份认证三种机制来保障安全。<br>防止窃听保护信息的集中对策中，最为普及的就是加密技术，加密对象有一下几个：</p>\n<ul>\n<li>通信加密：HTTP 协议没有加密机制，可以通过 SSL 或者是 TLS 的组合使用，加密 HTTP 的通信内容。用 SSL 建立安全通信线路之后，就可以在这条线路上进行 HTTP 通信，与 SSL 组合使用的 HTTP 被称为 HTTPS</li>\n<li>内容加密：对 HTTP 协议传输内容加密。客户端需要针对 HTTP 报文进行加密处理后再发送请求。为了做到有效内容加密，前提是客户端和服务器同时具备加密和解密机制</li>\n</ul>\n<h3 id=\"定义\"><a href=\"#定义\" class=\"headerlink\" title=\"定义\"></a>定义</h3><p>HTTPS 并非是应用层的一种新协议，只是 HTTP 通新接口部分使用 SSL 和 TLS 协议替代而已。通过 TCP 和 HTTP 之间 TLS 来加密，由此保证数据传输的安全性。<strong>HTPPS 就是身披 SSL 协议这串外壳的 HTTP</strong></p>\n<h3 id=\"SSL-TLS-协议\"><a href=\"#SSL-TLS-协议\" class=\"headerlink\" title=\"SSL/TLS 协议\"></a>SSL/TLS 协议</h3><p>SSL 协议是一种安全传输协议，TLS 是 SSLv3.0 的升级版</p>\n<h3 id=\"HTTPS-的层次图\"><a href=\"#HTTPS-的层次图\" class=\"headerlink\" title=\"HTTPS 的层次图\"></a>HTTPS 的层次图</h3><p><img src=\"/images/common/https_1.jpeg\" alt=\"network\"></p>\n<p>HTTPS 通信时会先和 SSL 层建立通信，然后 SSL 层再和传输层中的 TCP 通信，所以 HHTPS 就是套了 SSL 外壳的 HTTP 协议</p>\n<h2 id=\"实现-HTTPS-过程\"><a href=\"#实现-HTTPS-过程\" class=\"headerlink\" title=\"实现 HTTPS 过程\"></a>实现 HTTPS 过程</h2><ol>\n<li>要先申请 CA 证书，并安装在服务器上（一个文件，配置 nginx 支持监听 443 端口开启 ssl 并设置证书路径）</li>\n<li>浏览器发送请求；</li>\n<li>网站从浏览器发过来的加密规则中选一组自身也支持的加密算法和 hash 算法，并向浏览器发送带有公钥的证书，当然证书还包含了很多信息，如网站地址、证书的颁发机构、过期时间等。</li>\n<li>浏览器解析证书。<ul>\n<li>验证证书的合法性。如颁发机构是否合法、证书中的网站地址是否与访问的地址一致，若不合法，则浏览器提示证书不受信任，若合法，浏览器会显示一个小锁头。</li>\n<li>若合法，或用户接受了不合法的证书，浏览器会生成一串随机数的密码（即密钥），并用证书中提供的公钥加密。</li>\n<li>使用约定好的 hash 计算握手消息，并使用生成的随机数（即密钥）对消息进行加密，最后将之前生成的所有消息一并发送给网站服务器。</li>\n</ul>\n</li>\n<li>网站服务器解析消息。用已有的私钥将密钥解密出来，然后用密钥解密发过来的握手消息，并验证是否跟浏览器传过来的一致。然后再用密钥加密一段握手消息，发送给浏览器。</li>\n<li>浏览器解密并计算握手消息的 HASH，如果与服务端发来的 HASH 一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。这里浏览器与网站互相发送加密的握手消息并验证，目的是为了保证双方都获得了一致的密码，并且可以正常的加密解密数据，为后续真正数据的传输做一次测试。</li>\n</ol>\n<h3 id=\"TLS-与-SSL-握手过程\"><a href=\"#TLS-与-SSL-握手过程\" class=\"headerlink\" title=\"TLS 与 SSL 握手过程\"></a>TLS 与 SSL 握手过程</h3><p><img src=\"/images/common/https_2.png\" alt=\"network\"></p>\n<h2 id=\"全站-HTTPS-必须解决的问题\"><a href=\"#全站-HTTPS-必须解决的问题\" class=\"headerlink\" title=\"全站 HTTPS 必须解决的问题\"></a>全站 HTTPS 必须解决的问题</h2><p><strong>性能</strong></p>\n<ul>\n<li>HTTPS 需要多次握手，因此网络耗时变长，用户从 HTTP 跳转到 HTTPS 需要一些时间。但是如果使用 SPDY，HTTPS 的速度甚至比 HTTP 快。HTTPS 对速度的影响主要来自两方面 :<ol>\n<li>协议交换所增加的网络 RTT。</li>\n<li>加解密相关的计算耗时。</li>\n</ol>\n</li>\n<li>HTTPS 要做 RSA 校验，这会影响到设备性能。</li>\n<li>所有 CDN 节点要支持 HTTPS，而且需要有极其复杂的解决方案来面对 DDoS 的挑战。</li>\n<li>页面中所有嵌入的资源（图片、附件、js 、视频等）都要改为 HTTPS 的，否者就会报警。</li>\n</ul>\n<h3 id=\"基于协议和配置的优化\"><a href=\"#基于协议和配置的优化\" class=\"headerlink\" title=\"基于协议和配置的优化\"></a>基于协议和配置的优化</h3><ol>\n<li>HTTPS 访问速度优化</li>\n<li>Tcp fast open</li>\n</ol>\n<h3 id=\"HTTPS\"><a href=\"#HTTPS\" class=\"headerlink\" title=\"HTTPS\"></a>HTTPS</h3><p>网站通常的做法是对 HTTP 的访问服务器端做 302 跳转，跳转到 HTTPS。但是这个 302 跳转存在两个问题 :</p>\n<ol>\n<li>使用不安全的 HTTP 协议进行通信。</li>\n<li>增加一个 Round-Trip Time。</li>\n</ol>\n<p>而 HSTS 是 HTTP Strict Transport Security 的缩写，作用是强制客户端（如浏览器）使用 HTTPS 与服务器创建链接。其实 HSTS 的最大作用是防止 302HTTP 劫持（中间人）HSTS 的缺点是浏览器支持率不高，另外配置 HTST 后 HTTPS 很难实时降级为 HTTP。</p>\n<p>采用 HSTS 协议的网站将保证浏览器始终连接到该网站的 HTTPS 加密版本，不需要用户手动在 URL 地址栏中输入加密地址。该协议将帮助网站采用全局加密，用户看到的是该网站的安全版本。</p>\n<p>在 <a href=\"https://xxx/\">https://xxx</a> 的响应头中含有 Strict-Transport-Security:max-age=31536000;includeSubDomains 这就意味着两点：</p>\n<ol>\n<li>在一年的时间里（31536000 秒）中，浏览器只要向 XXX 或者其子域名发送 HTTP 请求时，必须采用 HTTPS 来发起连接。比如用户在地址栏输入 <a href=\"http://xxx/\">http://xxx</a> 或者点击超链接，浏览器应当自动将 http 转写成 https, 然后直接向 <a href=\"https://xxx/\">https://xxx/</a> 发起请求。</li>\n<li>在接下来的一年中，如果 xxx 服务器发送的 TLS 证书无效，用户不能忽略浏览器警告继续访问网站。</li>\n</ol>\n<h4 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h4><p>HTST 可以用来抵御 SSL 剥离攻击。攻击者在用户访问 HTTP 页面时替换所有 https 开头的连接为 http。达到阻止 HTTPS 的目的。但是如果使用了 HTST，一旦服务器发送了 HSTS 字段，用户将不再允许忽略警告。</p>\n<h4 id=\"不足\"><a href=\"#不足\" class=\"headerlink\" title=\"不足\"></a>不足</h4><p>用户首次访问网站是不受 HSTS 保护的。这是因为首次访问时，浏览器还未收到 HSTS，所以仍有可能明文 HTTP 访问。HTST 会在一段时间后失效（由 max-age 指定 )。所以浏览器是否强制 HSTS 取决于当前系统时间。部分操作系统经常通过网络时间协议更新系统时间。</p>\n<p>一旦浏览器接受到 HSTS Header( 假如有效期是 1 年），但是网站的证书出现问题，那么在有效都无法访问网站。</p>\n<p>SSL 慢可以归于以下两点：</p>\n<ul>\n<li>通信慢：同 HTTP 协议相比，网络负载会变慢，因此出去 TCP 链接、HTTP 请求与响应体外，还必须处理 SSL、TSL 通信，导致通信量的增加</li>\n<li>SSL 必须进行加密处理：在服务器端和客户端都要通过加密、解密进行数据的安全处理，因此从结果而言，比起 HTTP 会更多的消耗服务器和客户端的硬件资源，导致负载增强。</li>\n</ul>\n<h3 id=\"Session-resume-复用-session\"><a href=\"#Session-resume-复用-session\" class=\"headerlink\" title=\"Session resume 复用 session\"></a>Session resume 复用 session</h3><ol>\n<li>减少 CPU 消耗，因为不需要非对称秘钥交换的计算。</li>\n<li>提升访问速度，不需要进行完全握手阶段二，节省了一个 RTT 和计算耗时。</li>\n</ol>\n<h3 id=\"Session-cache\"><a href=\"#Session-cache\" class=\"headerlink\" title=\"Session cache\"></a>Session cache</h3><p>Session cache 的原理是使用 client hello 中的 session id 查询服务端的 session cache, 如果服务端有对应的缓存，则直接使用已有的 session 信息提前完成握手，称为简化握手。</p>\n<p>Session cache 有两个缺点：</p>\n<ol>\n<li><p>需要消耗服务端内存来存储 session 内容。</p>\n</li>\n<li><p>目前的开源软件包括 nginx,apache 只支持单机多进程间共享缓存，不支持多机间分布式缓存，对于百度或者其他大型互联网公司而言，单机 session cache 几乎没有作用。</p>\n</li>\n</ol>\n<p>Session cache 也有一个非常大的优点：</p>\n<ol>\n<li>session id 是 TLS 协议的标准字段，市面上的浏览器全部都支持 session cache。</li>\n</ol>\n<p>百度通过对 TLS 握手协议及服务器端实现的优化，已经支持全局的 session cache，能够明显提升用户的访问速度，节省服务器计算资源。</p>\n<h3 id=\"使用-SPDY-或者-HTTP2\"><a href=\"#使用-SPDY-或者-HTTP2\" class=\"headerlink\" title=\"使用 SPDY 或者 HTTP2\"></a>使用 SPDY 或者 HTTP2</h3><p>SPDY 是 google 推出的优化 HTTP 传输效率的协议（<a href=\"https://www.chromium.org/spdy%EF%BC%89\">https://www.chromium.org/spdy）</a> 它基本上沿用了 HTTP 协议的语义 , 但是通过使用帧控制实现了多个特性，显著提升了 HTTP 协议的传输效率。SPDY 最大的特性就是多路复用，能将多个 HTTP 请求在同一个连接上一起发出去，不像目前的 HTTP 协议一样，只能串行地逐个发送请求。Pipeline 虽然支持多个请求一起发送，但是接收时依然得按照顺序接收，本质上无法解决并发的问题。</p>\n<p>HTTP2 是 IETF 2015 年 2 月份通过的 HTTP 下一代协议，它以 SPDY 为原型，经过两年多的讨论和完善最终确定。</p>\n<p>需要说明两点 :</p>\n<ol>\n<li><p>SPDY 和 HTTP2 目前的实现默认使用 HTTPS 协议。</p>\n</li>\n<li><p>SPDY 和 HTTP2 都支持现有的 HTTP 语义和 API，对 Web 应用几乎是透明的。</p>\n</li>\n</ol>\n<p>Google 宣布 chrome 浏览器 2016 年将放弃 SPDY 协议，全面支持 HTTP2，但是目前国内部分浏览器厂商进度非常慢，不仅不支持 HTTP2，连 SPDY 都没有支持过。</p>\n<p>百度服务端和百度手机浏览器现在都已经支持 SPDY3.1 协议。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://blog.csdn.net/ITermeng/article/details/78517364\">HTTP &amp; HTTPS 网络协议重点总结</a></li>\n<li><a href=\"https://github.com/lgwebdream/FE-Interview/issues/937\">Https 加密握手的过程</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>https 可以理解为 HTTP+TLS，TLS 是传输层加密协议，是 HTTPS 安全的核心，其前身是 SSL。TLS 主要有五部分 : 应用数据层协议，握手协议，报警协议，加密消息确认协议，心跳协议。TLS 协议本身又是由 record 协议传输的。</p>","more":"<h2 id=\"为什么要实现-HTTPS？\"><a href=\"#为什么要实现-HTTPS？\" class=\"headerlink\" title=\"为什么要实现 HTTPS？\"></a>为什么要实现 HTTPS？</h2><ol>\n<li>由于 HTTP 本身不具备加密功能，所以无法做到对通信整体（使用 HTTP 协议通信的请求和响应的内容）进行加密，即 HTTP 报文使用明文的方式发送</li>\n<li>由于 TCP/IP 协议簇的工作机制，通信内容在所有的通信线路上都有可能遭到窥视</li>\n</ol>\n<p>为保护用户隐私和网络安全。通过数据加密、校验数据完整性和身份认证三种机制来保障安全。<br>防止窃听保护信息的集中对策中，最为普及的就是加密技术，加密对象有一下几个：</p>\n<ul>\n<li>通信加密：HTTP 协议没有加密机制，可以通过 SSL 或者是 TLS 的组合使用，加密 HTTP 的通信内容。用 SSL 建立安全通信线路之后，就可以在这条线路上进行 HTTP 通信，与 SSL 组合使用的 HTTP 被称为 HTTPS</li>\n<li>内容加密：对 HTTP 协议传输内容加密。客户端需要针对 HTTP 报文进行加密处理后再发送请求。为了做到有效内容加密，前提是客户端和服务器同时具备加密和解密机制</li>\n</ul>\n<h3 id=\"定义\"><a href=\"#定义\" class=\"headerlink\" title=\"定义\"></a>定义</h3><p>HTTPS 并非是应用层的一种新协议，只是 HTTP 通新接口部分使用 SSL 和 TLS 协议替代而已。通过 TCP 和 HTTP 之间 TLS 来加密，由此保证数据传输的安全性。<strong>HTPPS 就是身披 SSL 协议这串外壳的 HTTP</strong></p>\n<h3 id=\"SSL-TLS-协议\"><a href=\"#SSL-TLS-协议\" class=\"headerlink\" title=\"SSL/TLS 协议\"></a>SSL/TLS 协议</h3><p>SSL 协议是一种安全传输协议，TLS 是 SSLv3.0 的升级版</p>\n<h3 id=\"HTTPS-的层次图\"><a href=\"#HTTPS-的层次图\" class=\"headerlink\" title=\"HTTPS 的层次图\"></a>HTTPS 的层次图</h3><p><img src=\"/images/common/https_1.jpeg\" alt=\"network\"></p>\n<p>HTTPS 通信时会先和 SSL 层建立通信，然后 SSL 层再和传输层中的 TCP 通信，所以 HHTPS 就是套了 SSL 外壳的 HTTP 协议</p>\n<h2 id=\"实现-HTTPS-过程\"><a href=\"#实现-HTTPS-过程\" class=\"headerlink\" title=\"实现 HTTPS 过程\"></a>实现 HTTPS 过程</h2><ol>\n<li>要先申请 CA 证书，并安装在服务器上（一个文件，配置 nginx 支持监听 443 端口开启 ssl 并设置证书路径）</li>\n<li>浏览器发送请求；</li>\n<li>网站从浏览器发过来的加密规则中选一组自身也支持的加密算法和 hash 算法，并向浏览器发送带有公钥的证书，当然证书还包含了很多信息，如网站地址、证书的颁发机构、过期时间等。</li>\n<li>浏览器解析证书。<ul>\n<li>验证证书的合法性。如颁发机构是否合法、证书中的网站地址是否与访问的地址一致，若不合法，则浏览器提示证书不受信任，若合法，浏览器会显示一个小锁头。</li>\n<li>若合法，或用户接受了不合法的证书，浏览器会生成一串随机数的密码（即密钥），并用证书中提供的公钥加密。</li>\n<li>使用约定好的 hash 计算握手消息，并使用生成的随机数（即密钥）对消息进行加密，最后将之前生成的所有消息一并发送给网站服务器。</li>\n</ul>\n</li>\n<li>网站服务器解析消息。用已有的私钥将密钥解密出来，然后用密钥解密发过来的握手消息，并验证是否跟浏览器传过来的一致。然后再用密钥加密一段握手消息，发送给浏览器。</li>\n<li>浏览器解密并计算握手消息的 HASH，如果与服务端发来的 HASH 一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。这里浏览器与网站互相发送加密的握手消息并验证，目的是为了保证双方都获得了一致的密码，并且可以正常的加密解密数据，为后续真正数据的传输做一次测试。</li>\n</ol>\n<h3 id=\"TLS-与-SSL-握手过程\"><a href=\"#TLS-与-SSL-握手过程\" class=\"headerlink\" title=\"TLS 与 SSL 握手过程\"></a>TLS 与 SSL 握手过程</h3><p><img src=\"/images/common/https_2.png\" alt=\"network\"></p>\n<h2 id=\"全站-HTTPS-必须解决的问题\"><a href=\"#全站-HTTPS-必须解决的问题\" class=\"headerlink\" title=\"全站 HTTPS 必须解决的问题\"></a>全站 HTTPS 必须解决的问题</h2><p><strong>性能</strong></p>\n<ul>\n<li>HTTPS 需要多次握手，因此网络耗时变长，用户从 HTTP 跳转到 HTTPS 需要一些时间。但是如果使用 SPDY，HTTPS 的速度甚至比 HTTP 快。HTTPS 对速度的影响主要来自两方面 :<ol>\n<li>协议交换所增加的网络 RTT。</li>\n<li>加解密相关的计算耗时。</li>\n</ol>\n</li>\n<li>HTTPS 要做 RSA 校验，这会影响到设备性能。</li>\n<li>所有 CDN 节点要支持 HTTPS，而且需要有极其复杂的解决方案来面对 DDoS 的挑战。</li>\n<li>页面中所有嵌入的资源（图片、附件、js 、视频等）都要改为 HTTPS 的，否者就会报警。</li>\n</ul>\n<h3 id=\"基于协议和配置的优化\"><a href=\"#基于协议和配置的优化\" class=\"headerlink\" title=\"基于协议和配置的优化\"></a>基于协议和配置的优化</h3><ol>\n<li>HTTPS 访问速度优化</li>\n<li>Tcp fast open</li>\n</ol>\n<h3 id=\"HTTPS\"><a href=\"#HTTPS\" class=\"headerlink\" title=\"HTTPS\"></a>HTTPS</h3><p>网站通常的做法是对 HTTP 的访问服务器端做 302 跳转，跳转到 HTTPS。但是这个 302 跳转存在两个问题 :</p>\n<ol>\n<li>使用不安全的 HTTP 协议进行通信。</li>\n<li>增加一个 Round-Trip Time。</li>\n</ol>\n<p>而 HSTS 是 HTTP Strict Transport Security 的缩写，作用是强制客户端（如浏览器）使用 HTTPS 与服务器创建链接。其实 HSTS 的最大作用是防止 302HTTP 劫持（中间人）HSTS 的缺点是浏览器支持率不高，另外配置 HTST 后 HTTPS 很难实时降级为 HTTP。</p>\n<p>采用 HSTS 协议的网站将保证浏览器始终连接到该网站的 HTTPS 加密版本，不需要用户手动在 URL 地址栏中输入加密地址。该协议将帮助网站采用全局加密，用户看到的是该网站的安全版本。</p>\n<p>在 <a href=\"https://xxx/\">https://xxx</a> 的响应头中含有 Strict-Transport-Security:max-age=31536000;includeSubDomains 这就意味着两点：</p>\n<ol>\n<li>在一年的时间里（31536000 秒）中，浏览器只要向 XXX 或者其子域名发送 HTTP 请求时，必须采用 HTTPS 来发起连接。比如用户在地址栏输入 <a href=\"http://xxx/\">http://xxx</a> 或者点击超链接，浏览器应当自动将 http 转写成 https, 然后直接向 <a href=\"https://xxx/\">https://xxx/</a> 发起请求。</li>\n<li>在接下来的一年中，如果 xxx 服务器发送的 TLS 证书无效，用户不能忽略浏览器警告继续访问网站。</li>\n</ol>\n<h4 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h4><p>HTST 可以用来抵御 SSL 剥离攻击。攻击者在用户访问 HTTP 页面时替换所有 https 开头的连接为 http。达到阻止 HTTPS 的目的。但是如果使用了 HTST，一旦服务器发送了 HSTS 字段，用户将不再允许忽略警告。</p>\n<h4 id=\"不足\"><a href=\"#不足\" class=\"headerlink\" title=\"不足\"></a>不足</h4><p>用户首次访问网站是不受 HSTS 保护的。这是因为首次访问时，浏览器还未收到 HSTS，所以仍有可能明文 HTTP 访问。HTST 会在一段时间后失效（由 max-age 指定 )。所以浏览器是否强制 HSTS 取决于当前系统时间。部分操作系统经常通过网络时间协议更新系统时间。</p>\n<p>一旦浏览器接受到 HSTS Header( 假如有效期是 1 年），但是网站的证书出现问题，那么在有效都无法访问网站。</p>\n<p>SSL 慢可以归于以下两点：</p>\n<ul>\n<li>通信慢：同 HTTP 协议相比，网络负载会变慢，因此出去 TCP 链接、HTTP 请求与响应体外，还必须处理 SSL、TSL 通信，导致通信量的增加</li>\n<li>SSL 必须进行加密处理：在服务器端和客户端都要通过加密、解密进行数据的安全处理，因此从结果而言，比起 HTTP 会更多的消耗服务器和客户端的硬件资源，导致负载增强。</li>\n</ul>\n<h3 id=\"Session-resume-复用-session\"><a href=\"#Session-resume-复用-session\" class=\"headerlink\" title=\"Session resume 复用 session\"></a>Session resume 复用 session</h3><ol>\n<li>减少 CPU 消耗，因为不需要非对称秘钥交换的计算。</li>\n<li>提升访问速度，不需要进行完全握手阶段二，节省了一个 RTT 和计算耗时。</li>\n</ol>\n<h3 id=\"Session-cache\"><a href=\"#Session-cache\" class=\"headerlink\" title=\"Session cache\"></a>Session cache</h3><p>Session cache 的原理是使用 client hello 中的 session id 查询服务端的 session cache, 如果服务端有对应的缓存，则直接使用已有的 session 信息提前完成握手，称为简化握手。</p>\n<p>Session cache 有两个缺点：</p>\n<ol>\n<li><p>需要消耗服务端内存来存储 session 内容。</p>\n</li>\n<li><p>目前的开源软件包括 nginx,apache 只支持单机多进程间共享缓存，不支持多机间分布式缓存，对于百度或者其他大型互联网公司而言，单机 session cache 几乎没有作用。</p>\n</li>\n</ol>\n<p>Session cache 也有一个非常大的优点：</p>\n<ol>\n<li>session id 是 TLS 协议的标准字段，市面上的浏览器全部都支持 session cache。</li>\n</ol>\n<p>百度通过对 TLS 握手协议及服务器端实现的优化，已经支持全局的 session cache，能够明显提升用户的访问速度，节省服务器计算资源。</p>\n<h3 id=\"使用-SPDY-或者-HTTP2\"><a href=\"#使用-SPDY-或者-HTTP2\" class=\"headerlink\" title=\"使用 SPDY 或者 HTTP2\"></a>使用 SPDY 或者 HTTP2</h3><p>SPDY 是 google 推出的优化 HTTP 传输效率的协议（<a href=\"https://www.chromium.org/spdy%EF%BC%89\">https://www.chromium.org/spdy）</a> 它基本上沿用了 HTTP 协议的语义 , 但是通过使用帧控制实现了多个特性，显著提升了 HTTP 协议的传输效率。SPDY 最大的特性就是多路复用，能将多个 HTTP 请求在同一个连接上一起发出去，不像目前的 HTTP 协议一样，只能串行地逐个发送请求。Pipeline 虽然支持多个请求一起发送，但是接收时依然得按照顺序接收，本质上无法解决并发的问题。</p>\n<p>HTTP2 是 IETF 2015 年 2 月份通过的 HTTP 下一代协议，它以 SPDY 为原型，经过两年多的讨论和完善最终确定。</p>\n<p>需要说明两点 :</p>\n<ol>\n<li><p>SPDY 和 HTTP2 目前的实现默认使用 HTTPS 协议。</p>\n</li>\n<li><p>SPDY 和 HTTP2 都支持现有的 HTTP 语义和 API，对 Web 应用几乎是透明的。</p>\n</li>\n</ol>\n<p>Google 宣布 chrome 浏览器 2016 年将放弃 SPDY 协议，全面支持 HTTP2，但是目前国内部分浏览器厂商进度非常慢，不仅不支持 HTTP2，连 SPDY 都没有支持过。</p>\n<p>百度服务端和百度手机浏览器现在都已经支持 SPDY3.1 协议。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://blog.csdn.net/ITermeng/article/details/78517364\">HTTP &amp; HTTPS 网络协议重点总结</a></li>\n<li><a href=\"https://github.com/lgwebdream/FE-Interview/issues/937\">Https 加密握手的过程</a></li>\n</ul>"},{"title":"JS代码片段","date":"2018-01-15T08:27:23.000Z","_content":"\n搬砖时的 JS 代码片段整理\n\n<!--more-->\n\n# 将 bytes 格式化\n\n```javascript\nlet total = this.fileSizeFormat(spaceSize, 2, true, false)\n\n fileSizeFormat(bytes, digits, unitFlag, floorFlag) {\n      bytes = parseFloat(bytes)\n      let absBytes = Math.abs(bytes)\n      let humanSize, unit\n\n      if (digits === undefined) {\n        digits = 2\n      }\n      if (unitFlag === undefined) {\n        unitFlag = true\n      }\n\n      if (absBytes < 1024) {\n        digits = 0\n        humanSize = bytes\n        unit = 'B'\n      } else {\n        if (absBytes < 900 * 1024) {\n          humanSize = bytes / 1024\n          unit = 'K'\n        } else {\n          if (absBytes < 900 * 1048576) {\n            humanSize = bytes / 1048576\n            unit = 'M'\n          } else {\n            if (absBytes < 900 * 1073741824 || (digits === 0 && absBytes < 1048576 * 1048576)) {\n              humanSize = bytes / 1073741824\n              unit = 'G'\n            } else {\n              humanSize = bytes / (1048576 * 1048576)\n              unit = 'T'\n            }\n          }\n        }\n        humanSize = Math.round(humanSize * Math.pow(10, digits)) / parseFloat(Math.pow(10, digits))\n        humanSize = humanSize.toFixed(digits)\n\n        let result\n        if (floorFlag && digits > 0) {\n          if (humanSize !== Math.floor(humanSize)) {\n            result = humanSize\n          } else {\n            result = parseInt(Math.floor(humanSize), 10)\n          }\n        } else {\n          result = humanSize\n        }\n        if (unitFlag) {\n          result = result + unit\n        }\n\n        return result\n      }\n    }\n```\n\n## 获取文件扩展名\n\n```javascript\nconst extname = filename => {\n    if (filename.indexOf(\".\") > 0) {\n        var resultArr = filename.split(\".\");\n        var result = \".\" + resultArr[resultArr.length - 1];\n        return result;\n    } else return \"\";\n};\n```\n\n## 冒泡排序\n\n```javascript\nfunction bubbleSort(arr) {\n    var i = arr.length,\n        j;\n    var tempExchangVal;\n    while (i > 0) {\n        for (j = 0; j < i - 1; j++) {\n            if (arr[j] > arr[j + 1]) {\n                tempExchangVal = arr[j];\n                arr[j] = arr[j + 1];\n                arr[j + 1] = tempExchangVal;\n            }\n        }\n        i--;\n    }\n    return arr;\n}\n\nvar arr = [3, 2, 4, 9, 1, 5, 7, 6, 8];\nvar arrSorted = bubbleSort(arr);\nconsole.log(arrSorted);\nalert(arrSorted);\n```\n\n## 快速排序算法\n\n快速排序是处理大数据急最快的排序算法之一。它是一种分而治之的算法，通过递归的方式将数据一次分解为包含较小元素和较大元素的不同子序列。\n\n![network](/images/common/kuaipai.png)\n\n```javascript\nfunction quickSort(array) {\n    if (array.length == 0) {\n        return [];\n    }\n    var left = [];\n    var right = [];\n    var priot = array[0];\n\n    for (var i = 1; i < array.length; i++) {\n        if (array[i] < privot) {\n            left.push(array[i]);\n        } else {\n            right.push(array[i]);\n        }\n    }\n    return quickSort(left).concat(privot, quickSort(right));\n}\n```\n\n## JS 深度克隆\n\n```javascript\nfunction deepClone(obj) {\n    var _toString = Object.prototype.toString;\n\n    // null, undefined, non-object, function\n    if (!obj || typeof obj !== \"object\") {\n        return obj;\n    }\n\n    // DOM Node\n    if (obj.nodeType && \"cloneNode\" in obj) {\n        return obj.cloneNode(true);\n    }\n\n    // Date\n    if (_toString.call(obj) === \"[object Date]\") {\n        return new Date(obj.getTime());\n    }\n\n    // RegExp\n    if (_toString.call(obj) === \"[object RegExp]\") {\n        var flags = [];\n        if (obj.global) {\n            flags.push(\"g\");\n        }\n        if (obj.multiline) {\n            flags.push(\"m\");\n        }\n        if (obj.ignoreCase) {\n            flags.push(\"i\");\n        }\n\n        return new RegExp(obj.source, flags.join(\"\"));\n    }\n\n    var result = Array.isArray(obj)\n        ? []\n        : obj.constructor\n        ? new obj.constructor()\n        : {};\n\n    for (var key in obj) {\n        result[key] = deepClone(obj[key]);\n    }\n\n    return result;\n}\n\nfunction A() {\n    this.a = a;\n}\n\nvar a = {\n    name: \"qiu\",\n    birth: new Date(),\n    pattern: /qiu/gim,\n    container: document.body,\n    hobbys: [\"book\", new Date(), /aaa/gim, 111]\n};\n\nvar c = new A();\nvar b = deepClone(c);\nconsole.log(c.a === b.a);\nconsole.log(c, b);\n```\n\n## Javascript 的节流和防抖\n\n函数节流和函数防抖，两者都是优化高频率执行 JS 代码的一种手段。\n\n### 函数节流\n\n防抖动和节流本质是不一样的。放\n\n是指一定时间内 js 方法只跑一次。\n\n函数节流应用的实际场景，多数在监听页面元素滚动时间的时候会用到。因为滚动事件，是一个高频触发的事件。以下是监听页面元素滚动的示例代码：\n\n```javascript\n//函数节流\nvar canRun = true;\ndocument.getElementById(\"throttle\").onsroll = function() {\n    if (!canRun) {\n        //判断是否空闲，如果在执行中，则直接return\n        return;\n    }\n    canRun = false;\n    setTimeout(function() {\n        console.log(\"函数节流\");\n        canRun = true;\n    }, 300);\n};\n```\n\n### 函数防抖\n\n函数防抖的应有场景，最常见的就是用户注册的时候的手机号码验证和邮箱验证了。只有等用户输入完毕后，前端才需要检查格式是否正确，如果不正确，在弹出提示语。以下还是以页面元素滚动监听的例子，来解析：\n\n```javascript\n//函数防抖\nvar timer = fasle;\ndocument.getElementById(\"document\").onsrcoll = function() {\n    clearTimeout(timer).timer = setTimeout(function() {\n        //清楚未执行的代码，重置回初始状态\n        console.log(\"函数防抖\");\n    }, 300);\n};\n\n// func是用户传入需要防抖的函数\n// wait是等待时间\nconst debounce = (func, wait = 50) => {\n    // 缓存一个定时器id\n    let timer = 0;\n    // 这里返回的函数是每次用户实际调用的防抖函数\n    // 如果已经设定过定时器了就清空上一次的定时器\n    // 开始一个新的定时器，延迟执行用户传入的方法\n    return function(...args) {\n        if (timer) clearTimeout(timer);\n        timer = setTimeout(() => {\n            func.apply(this, args);\n        }, wait);\n    };\n};\n// 不难看出如果用户调用该函数的间隔小于wait的情况下，上一次的时间还未到就被清除了，并不会执行函数\n```\n\n函数防抖的要点，也是需要一个 setTimeout 来辅助实现。延迟执行需要跑的代码\n\n但是这种简单版的防抖也是缺陷的，这个防抖只能在最后调用。一般的防抖会有 imm 选项，表示是否立即调用。这两者的区别在于：\n\n-   在搜索引擎搜索问题的时候，希望达到用户数万最后一个字才调用查询整个接口，这个时候适用`延迟执行`的防抖函数，它总是在一连串（间隔小于 wait 的）函数出发之后才调用。\n-   例如在用户点击按钮时，是立即调用接口，并且下一次调用时间间隔大于 wait 才会触发。\n\n带有立即执行选项的防抖函数\n\n```javascript\nfunction now() {\n    //获取当前时间戳\n    return new Date();\n}\n/**\n * 防抖函数，返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行\n *\n * @param  {function} func        回调函数\n * @param  {number}   wait        表示时间窗口的间隔\n * @param  {boolean}  immediate   设置为ture时，是否立即调用函数\n * @return {function}             返回客户调用函数\n */\n\nfunction debounce(func, wait = 50, immediate = true) {\n    let timer, context, args;\n\n    // 延迟执行函数\n    const later = () =>\n        setTimeout(() => {\n            // 延迟函数执行完毕，清空缓存的定时器序号\n            timer = null;\n            // 延迟执行的情况下，函数会在延迟函数中执行\n            // 使用到之前缓存的参数和上下文\n            if (!immediate) {\n                func.apply(context, args);\n                context = args = null;\n            }\n        }, wait);\n\n    // 这里返回的函数是每次实际调用的函数\n    return function(...params) {\n        // 如果没有创建延迟执行函数（later），就创建一个\n        if (!timer) {\n            timer = later();\n            // 如果是立即执行，调用函数\n            // 否则缓存参数和调用上下文\n            if (immediate) {\n                func.apply(this, params);\n            } else {\n                context = this;\n                args = params;\n            }\n            // 如果已有延迟执行函数（later），调用的时候清除原来的并重新设定一个\n            // 这样做延迟函数会重新计时\n        } else {\n            clearTimeout(timer);\n            timer = later();\n        }\n    };\n}\n```\n\n## FileReader 对象\n\n之前做图片上传预览都是把图片上传到服务器获得线上地址，如今才发现有另一种方法：使用`FildeReader`(但兼容性不是很好，ie10)\n\n`FileReader`允许 Web 应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。主要用来把文件读入内存，并且读取文件中的数据。通过构造函数创建一个 FileReader 对象。\n\n其中 file 对象可以是来自用户在一个`<input>`元素上悬着文件后返回的 filelist 对象，也可以来自拖放操作生成的`DataTransfer`对象，还可以是来自一个`HTMLCanvasElement`上执行`mozGetAsFile()`方法后返回结果。\n\n`FileReader.readyState`表示 FileReader 状态的数字。取值如下：\n\n-   EMPTY: 0 还没有加载任何数据。\n-   LOADING: 1 数据正在加载。\n-   DONE：2 已经完成全部的读取请求。\n\n`FileReader.result`表示文件内容。该属性仅在读取操作完成后才有效，数据的格式取决于使用哪个方法来启动读取操作。\n\n`FileReader.readAsDataURL()`表示开始读取指定的 Blob 中的内容。一旦完成，result 属性中将包含一个 data:URL 格式的字符串以表示所读取文件的内容。\n\n-   abort：中断读取操作。\n-   readAsArrayBuffer：读取文件内容到 ArrayBuffer 对象中。\n-   readAsBinaryString：将文件读取为二进制数据。\n-   readAsDataURL：将文件读取为 data: URL 格式的字符串。\n-   readAsText：将文件读取为文本。\n\n### 上传图片预览\n\n```html\n<input type=\"file\" id=\"files\" accept=\"image/jpeg,image/jpg,image/png\" />\n<img src=\"blank.gif\" id=\"preview\" />\n<script>\n    var elem = document.getElementById(\"files\"),\n        img = document.getElementById(\"preview\");\n    elem.onchange = function() {\n        var files = elem.files,\n            reader = new FileReader();\n        if (files && files[0]) {\n            reader.onload = function(ev) {\n                img.src = ev.target.result;\n            };\n            reader.readAsDataURL(files[0]);\n        }\n    };\n</script>\n```\n\n### 图片上传 小图片转 base64\n\n```javascript\nlet reader = new FileReader();\nlet imgUrlBase64 = reader.readAsDataURL(file);\nreader.onload = function(e) {\n    reader.result.length; //去判断大小 reader.result就是\n};\n```\n\n## Base64 编码\n\n在 HTML5 中新增了 atob 和 btoa 方法来支持 Base64 编码。它们的命名也很简单，b to a 和 a to b，即代表着编码和解码。\n\n```javascript\nvar a = \"https://lin-xin.github.io\";\nvar b = btoa(a);\nvar c = atob(b);\nconsole.log(a);     // https://lin-xin.github.io\nconsole.log(b);     // aHR0cHM6Ly9saW4teGluLmdpdGh1Yi5pbw==\nconsole.log(c);     // https://lin-xin.github.io复制代码btoa 方法对字符串 a 进行编码，不会改变 a 的值，返回一个编码后的值。atob 方法对编码后的字符串进行解码。\n但是参数中带中文，已经超出了8位ASCII编码的字符范围，浏览器就会报错。所以需要先对中文进行 encodeURIComponent 编码处理。\nvar a = \"哈喽 世界\";\nvar b = btoa(encodeURIComponent(a));\nvar c = decodeURIComponent(atob(b));\n\nconsole.log(b);     // JUU1JTkzJTg4JUU1JTk2JUJEJTIwJUU0JUI4JTk2JUU3JTk1JThD\nconsole.log(c);     // 哈喽 世界\n```\n\n## 查找数组对象里面是否含有某对象\n\n查找 selectedList 里面是否存在 listAppEquipment 数组里面的对象\n\n```javascript\nlet selectedListString = JSON.stringify(that.selectedList);\nthat.listAppEquipment.forEach((item: any) => {\n    let value = JSON.stringify(item.value);\n    if (selectedListString.indexOf(value) != -1) {\n        item.checked = true;\n        item.selected = true;\n    }\n});\n```\n","source":"_posts/JS代码片段.md","raw":"---\ntitle: JS代码片段\ndate: 2018-01-15 16:27:23\ncategories: JavaScript\n---\n\n搬砖时的 JS 代码片段整理\n\n<!--more-->\n\n# 将 bytes 格式化\n\n```javascript\nlet total = this.fileSizeFormat(spaceSize, 2, true, false)\n\n fileSizeFormat(bytes, digits, unitFlag, floorFlag) {\n      bytes = parseFloat(bytes)\n      let absBytes = Math.abs(bytes)\n      let humanSize, unit\n\n      if (digits === undefined) {\n        digits = 2\n      }\n      if (unitFlag === undefined) {\n        unitFlag = true\n      }\n\n      if (absBytes < 1024) {\n        digits = 0\n        humanSize = bytes\n        unit = 'B'\n      } else {\n        if (absBytes < 900 * 1024) {\n          humanSize = bytes / 1024\n          unit = 'K'\n        } else {\n          if (absBytes < 900 * 1048576) {\n            humanSize = bytes / 1048576\n            unit = 'M'\n          } else {\n            if (absBytes < 900 * 1073741824 || (digits === 0 && absBytes < 1048576 * 1048576)) {\n              humanSize = bytes / 1073741824\n              unit = 'G'\n            } else {\n              humanSize = bytes / (1048576 * 1048576)\n              unit = 'T'\n            }\n          }\n        }\n        humanSize = Math.round(humanSize * Math.pow(10, digits)) / parseFloat(Math.pow(10, digits))\n        humanSize = humanSize.toFixed(digits)\n\n        let result\n        if (floorFlag && digits > 0) {\n          if (humanSize !== Math.floor(humanSize)) {\n            result = humanSize\n          } else {\n            result = parseInt(Math.floor(humanSize), 10)\n          }\n        } else {\n          result = humanSize\n        }\n        if (unitFlag) {\n          result = result + unit\n        }\n\n        return result\n      }\n    }\n```\n\n## 获取文件扩展名\n\n```javascript\nconst extname = filename => {\n    if (filename.indexOf(\".\") > 0) {\n        var resultArr = filename.split(\".\");\n        var result = \".\" + resultArr[resultArr.length - 1];\n        return result;\n    } else return \"\";\n};\n```\n\n## 冒泡排序\n\n```javascript\nfunction bubbleSort(arr) {\n    var i = arr.length,\n        j;\n    var tempExchangVal;\n    while (i > 0) {\n        for (j = 0; j < i - 1; j++) {\n            if (arr[j] > arr[j + 1]) {\n                tempExchangVal = arr[j];\n                arr[j] = arr[j + 1];\n                arr[j + 1] = tempExchangVal;\n            }\n        }\n        i--;\n    }\n    return arr;\n}\n\nvar arr = [3, 2, 4, 9, 1, 5, 7, 6, 8];\nvar arrSorted = bubbleSort(arr);\nconsole.log(arrSorted);\nalert(arrSorted);\n```\n\n## 快速排序算法\n\n快速排序是处理大数据急最快的排序算法之一。它是一种分而治之的算法，通过递归的方式将数据一次分解为包含较小元素和较大元素的不同子序列。\n\n![network](/images/common/kuaipai.png)\n\n```javascript\nfunction quickSort(array) {\n    if (array.length == 0) {\n        return [];\n    }\n    var left = [];\n    var right = [];\n    var priot = array[0];\n\n    for (var i = 1; i < array.length; i++) {\n        if (array[i] < privot) {\n            left.push(array[i]);\n        } else {\n            right.push(array[i]);\n        }\n    }\n    return quickSort(left).concat(privot, quickSort(right));\n}\n```\n\n## JS 深度克隆\n\n```javascript\nfunction deepClone(obj) {\n    var _toString = Object.prototype.toString;\n\n    // null, undefined, non-object, function\n    if (!obj || typeof obj !== \"object\") {\n        return obj;\n    }\n\n    // DOM Node\n    if (obj.nodeType && \"cloneNode\" in obj) {\n        return obj.cloneNode(true);\n    }\n\n    // Date\n    if (_toString.call(obj) === \"[object Date]\") {\n        return new Date(obj.getTime());\n    }\n\n    // RegExp\n    if (_toString.call(obj) === \"[object RegExp]\") {\n        var flags = [];\n        if (obj.global) {\n            flags.push(\"g\");\n        }\n        if (obj.multiline) {\n            flags.push(\"m\");\n        }\n        if (obj.ignoreCase) {\n            flags.push(\"i\");\n        }\n\n        return new RegExp(obj.source, flags.join(\"\"));\n    }\n\n    var result = Array.isArray(obj)\n        ? []\n        : obj.constructor\n        ? new obj.constructor()\n        : {};\n\n    for (var key in obj) {\n        result[key] = deepClone(obj[key]);\n    }\n\n    return result;\n}\n\nfunction A() {\n    this.a = a;\n}\n\nvar a = {\n    name: \"qiu\",\n    birth: new Date(),\n    pattern: /qiu/gim,\n    container: document.body,\n    hobbys: [\"book\", new Date(), /aaa/gim, 111]\n};\n\nvar c = new A();\nvar b = deepClone(c);\nconsole.log(c.a === b.a);\nconsole.log(c, b);\n```\n\n## Javascript 的节流和防抖\n\n函数节流和函数防抖，两者都是优化高频率执行 JS 代码的一种手段。\n\n### 函数节流\n\n防抖动和节流本质是不一样的。放\n\n是指一定时间内 js 方法只跑一次。\n\n函数节流应用的实际场景，多数在监听页面元素滚动时间的时候会用到。因为滚动事件，是一个高频触发的事件。以下是监听页面元素滚动的示例代码：\n\n```javascript\n//函数节流\nvar canRun = true;\ndocument.getElementById(\"throttle\").onsroll = function() {\n    if (!canRun) {\n        //判断是否空闲，如果在执行中，则直接return\n        return;\n    }\n    canRun = false;\n    setTimeout(function() {\n        console.log(\"函数节流\");\n        canRun = true;\n    }, 300);\n};\n```\n\n### 函数防抖\n\n函数防抖的应有场景，最常见的就是用户注册的时候的手机号码验证和邮箱验证了。只有等用户输入完毕后，前端才需要检查格式是否正确，如果不正确，在弹出提示语。以下还是以页面元素滚动监听的例子，来解析：\n\n```javascript\n//函数防抖\nvar timer = fasle;\ndocument.getElementById(\"document\").onsrcoll = function() {\n    clearTimeout(timer).timer = setTimeout(function() {\n        //清楚未执行的代码，重置回初始状态\n        console.log(\"函数防抖\");\n    }, 300);\n};\n\n// func是用户传入需要防抖的函数\n// wait是等待时间\nconst debounce = (func, wait = 50) => {\n    // 缓存一个定时器id\n    let timer = 0;\n    // 这里返回的函数是每次用户实际调用的防抖函数\n    // 如果已经设定过定时器了就清空上一次的定时器\n    // 开始一个新的定时器，延迟执行用户传入的方法\n    return function(...args) {\n        if (timer) clearTimeout(timer);\n        timer = setTimeout(() => {\n            func.apply(this, args);\n        }, wait);\n    };\n};\n// 不难看出如果用户调用该函数的间隔小于wait的情况下，上一次的时间还未到就被清除了，并不会执行函数\n```\n\n函数防抖的要点，也是需要一个 setTimeout 来辅助实现。延迟执行需要跑的代码\n\n但是这种简单版的防抖也是缺陷的，这个防抖只能在最后调用。一般的防抖会有 imm 选项，表示是否立即调用。这两者的区别在于：\n\n-   在搜索引擎搜索问题的时候，希望达到用户数万最后一个字才调用查询整个接口，这个时候适用`延迟执行`的防抖函数，它总是在一连串（间隔小于 wait 的）函数出发之后才调用。\n-   例如在用户点击按钮时，是立即调用接口，并且下一次调用时间间隔大于 wait 才会触发。\n\n带有立即执行选项的防抖函数\n\n```javascript\nfunction now() {\n    //获取当前时间戳\n    return new Date();\n}\n/**\n * 防抖函数，返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行\n *\n * @param  {function} func        回调函数\n * @param  {number}   wait        表示时间窗口的间隔\n * @param  {boolean}  immediate   设置为ture时，是否立即调用函数\n * @return {function}             返回客户调用函数\n */\n\nfunction debounce(func, wait = 50, immediate = true) {\n    let timer, context, args;\n\n    // 延迟执行函数\n    const later = () =>\n        setTimeout(() => {\n            // 延迟函数执行完毕，清空缓存的定时器序号\n            timer = null;\n            // 延迟执行的情况下，函数会在延迟函数中执行\n            // 使用到之前缓存的参数和上下文\n            if (!immediate) {\n                func.apply(context, args);\n                context = args = null;\n            }\n        }, wait);\n\n    // 这里返回的函数是每次实际调用的函数\n    return function(...params) {\n        // 如果没有创建延迟执行函数（later），就创建一个\n        if (!timer) {\n            timer = later();\n            // 如果是立即执行，调用函数\n            // 否则缓存参数和调用上下文\n            if (immediate) {\n                func.apply(this, params);\n            } else {\n                context = this;\n                args = params;\n            }\n            // 如果已有延迟执行函数（later），调用的时候清除原来的并重新设定一个\n            // 这样做延迟函数会重新计时\n        } else {\n            clearTimeout(timer);\n            timer = later();\n        }\n    };\n}\n```\n\n## FileReader 对象\n\n之前做图片上传预览都是把图片上传到服务器获得线上地址，如今才发现有另一种方法：使用`FildeReader`(但兼容性不是很好，ie10)\n\n`FileReader`允许 Web 应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。主要用来把文件读入内存，并且读取文件中的数据。通过构造函数创建一个 FileReader 对象。\n\n其中 file 对象可以是来自用户在一个`<input>`元素上悬着文件后返回的 filelist 对象，也可以来自拖放操作生成的`DataTransfer`对象，还可以是来自一个`HTMLCanvasElement`上执行`mozGetAsFile()`方法后返回结果。\n\n`FileReader.readyState`表示 FileReader 状态的数字。取值如下：\n\n-   EMPTY: 0 还没有加载任何数据。\n-   LOADING: 1 数据正在加载。\n-   DONE：2 已经完成全部的读取请求。\n\n`FileReader.result`表示文件内容。该属性仅在读取操作完成后才有效，数据的格式取决于使用哪个方法来启动读取操作。\n\n`FileReader.readAsDataURL()`表示开始读取指定的 Blob 中的内容。一旦完成，result 属性中将包含一个 data:URL 格式的字符串以表示所读取文件的内容。\n\n-   abort：中断读取操作。\n-   readAsArrayBuffer：读取文件内容到 ArrayBuffer 对象中。\n-   readAsBinaryString：将文件读取为二进制数据。\n-   readAsDataURL：将文件读取为 data: URL 格式的字符串。\n-   readAsText：将文件读取为文本。\n\n### 上传图片预览\n\n```html\n<input type=\"file\" id=\"files\" accept=\"image/jpeg,image/jpg,image/png\" />\n<img src=\"blank.gif\" id=\"preview\" />\n<script>\n    var elem = document.getElementById(\"files\"),\n        img = document.getElementById(\"preview\");\n    elem.onchange = function() {\n        var files = elem.files,\n            reader = new FileReader();\n        if (files && files[0]) {\n            reader.onload = function(ev) {\n                img.src = ev.target.result;\n            };\n            reader.readAsDataURL(files[0]);\n        }\n    };\n</script>\n```\n\n### 图片上传 小图片转 base64\n\n```javascript\nlet reader = new FileReader();\nlet imgUrlBase64 = reader.readAsDataURL(file);\nreader.onload = function(e) {\n    reader.result.length; //去判断大小 reader.result就是\n};\n```\n\n## Base64 编码\n\n在 HTML5 中新增了 atob 和 btoa 方法来支持 Base64 编码。它们的命名也很简单，b to a 和 a to b，即代表着编码和解码。\n\n```javascript\nvar a = \"https://lin-xin.github.io\";\nvar b = btoa(a);\nvar c = atob(b);\nconsole.log(a);     // https://lin-xin.github.io\nconsole.log(b);     // aHR0cHM6Ly9saW4teGluLmdpdGh1Yi5pbw==\nconsole.log(c);     // https://lin-xin.github.io复制代码btoa 方法对字符串 a 进行编码，不会改变 a 的值，返回一个编码后的值。atob 方法对编码后的字符串进行解码。\n但是参数中带中文，已经超出了8位ASCII编码的字符范围，浏览器就会报错。所以需要先对中文进行 encodeURIComponent 编码处理。\nvar a = \"哈喽 世界\";\nvar b = btoa(encodeURIComponent(a));\nvar c = decodeURIComponent(atob(b));\n\nconsole.log(b);     // JUU1JTkzJTg4JUU1JTk2JUJEJTIwJUU0JUI4JTk2JUU3JTk1JThD\nconsole.log(c);     // 哈喽 世界\n```\n\n## 查找数组对象里面是否含有某对象\n\n查找 selectedList 里面是否存在 listAppEquipment 数组里面的对象\n\n```javascript\nlet selectedListString = JSON.stringify(that.selectedList);\nthat.listAppEquipment.forEach((item: any) => {\n    let value = JSON.stringify(item.value);\n    if (selectedListString.indexOf(value) != -1) {\n        item.checked = true;\n        item.selected = true;\n    }\n});\n```\n","slug":"JS代码片段","published":1,"updated":"2021-03-05T14:57:59.439Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wh000al5v0fjzpbdua","content":"<p>搬砖时的 JS 代码片段整理</p>\n<span id=\"more\"></span>\n\n<h1 id=\"将-bytes-格式化\"><a href=\"#将-bytes-格式化\" class=\"headerlink\" title=\"将 bytes 格式化\"></a>将 bytes 格式化</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> total = <span class=\"built_in\">this</span>.fileSizeFormat(spaceSize, <span class=\"number\">2</span>, <span class=\"literal\">true</span>, <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"title\">fileSizeFormat</span>(<span class=\"params\">bytes, digits, unitFlag, floorFlag</span>)</span> &#123;</span><br><span class=\"line\">      bytes = <span class=\"built_in\">parseFloat</span>(bytes)</span><br><span class=\"line\">      <span class=\"keyword\">let</span> absBytes = <span class=\"built_in\">Math</span>.abs(bytes)</span><br><span class=\"line\">      <span class=\"keyword\">let</span> humanSize, unit</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (digits === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        digits = <span class=\"number\">2</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (unitFlag === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        unitFlag = <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (absBytes &lt; <span class=\"number\">1024</span>) &#123;</span><br><span class=\"line\">        digits = <span class=\"number\">0</span></span><br><span class=\"line\">        humanSize = bytes</span><br><span class=\"line\">        unit = <span class=\"string\">&#x27;B&#x27;</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (absBytes &lt; <span class=\"number\">900</span> * <span class=\"number\">1024</span>) &#123;</span><br><span class=\"line\">          humanSize = bytes / <span class=\"number\">1024</span></span><br><span class=\"line\">          unit = <span class=\"string\">&#x27;K&#x27;</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (absBytes &lt; <span class=\"number\">900</span> * <span class=\"number\">1048576</span>) &#123;</span><br><span class=\"line\">            humanSize = bytes / <span class=\"number\">1048576</span></span><br><span class=\"line\">            unit = <span class=\"string\">&#x27;M&#x27;</span></span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (absBytes &lt; <span class=\"number\">900</span> * <span class=\"number\">1073741824</span> || (digits === <span class=\"number\">0</span> &amp;&amp; absBytes &lt; <span class=\"number\">1048576</span> * <span class=\"number\">1048576</span>)) &#123;</span><br><span class=\"line\">              humanSize = bytes / <span class=\"number\">1073741824</span></span><br><span class=\"line\">              unit = <span class=\"string\">&#x27;G&#x27;</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              humanSize = bytes / (<span class=\"number\">1048576</span> * <span class=\"number\">1048576</span>)</span><br><span class=\"line\">              unit = <span class=\"string\">&#x27;T&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        humanSize = <span class=\"built_in\">Math</span>.round(humanSize * <span class=\"built_in\">Math</span>.pow(<span class=\"number\">10</span>, digits)) / <span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.pow(<span class=\"number\">10</span>, digits))</span><br><span class=\"line\">        humanSize = humanSize.toFixed(digits)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> result</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (floorFlag &amp;&amp; digits &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (humanSize !== <span class=\"built_in\">Math</span>.floor(humanSize)) &#123;</span><br><span class=\"line\">            result = humanSize</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">Math</span>.floor(humanSize), <span class=\"number\">10</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          result = humanSize</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (unitFlag) &#123;</span><br><span class=\"line\">          result = result + unit</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"获取文件扩展名\"><a href=\"#获取文件扩展名\" class=\"headerlink\" title=\"获取文件扩展名\"></a>获取文件扩展名</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> extname = <span class=\"function\"><span class=\"params\">filename</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (filename.indexOf(<span class=\"string\">&quot;.&quot;</span>) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> resultArr = filename.split(<span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> result = <span class=\"string\">&quot;.&quot;</span> + resultArr[resultArr.length - <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"冒泡排序\"><a href=\"#冒泡排序\" class=\"headerlink\" title=\"冒泡排序\"></a>冒泡排序</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bubbleSort</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = arr.length,</span><br><span class=\"line\">        j;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> tempExchangVal;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (j = <span class=\"number\">0</span>; j &lt; i - <span class=\"number\">1</span>; j++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (arr[j] &gt; arr[j + <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">                tempExchangVal = arr[j];</span><br><span class=\"line\">                arr[j] = arr[j + <span class=\"number\">1</span>];</span><br><span class=\"line\">                arr[j + <span class=\"number\">1</span>] = tempExchangVal;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        i--;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">9</span>, <span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrSorted = bubbleSort(arr);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrSorted);</span><br><span class=\"line\">alert(arrSorted);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"快速排序算法\"><a href=\"#快速排序算法\" class=\"headerlink\" title=\"快速排序算法\"></a>快速排序算法</h2><p>快速排序是处理大数据急最快的排序算法之一。它是一种分而治之的算法，通过递归的方式将数据一次分解为包含较小元素和较大元素的不同子序列。</p>\n<p><img src=\"/images/common/kuaipai.png\" alt=\"network\"></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">quickSort</span>(<span class=\"params\">array</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (array.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> left = [];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> right = [];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> priot = array[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; array.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (array[i] &lt; privot) &#123;</span><br><span class=\"line\">            left.push(array[i]);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            right.push(array[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> quickSort(left).concat(privot, quickSort(right));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"JS-深度克隆\"><a href=\"#JS-深度克隆\" class=\"headerlink\" title=\"JS 深度克隆\"></a>JS 深度克隆</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepClone</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _toString = <span class=\"built_in\">Object</span>.prototype.toString;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// null, undefined, non-object, function</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!obj || <span class=\"keyword\">typeof</span> obj !== <span class=\"string\">&quot;object&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// DOM Node</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.nodeType &amp;&amp; <span class=\"string\">&quot;cloneNode&quot;</span> <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj.cloneNode(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Date</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_toString.call(obj) === <span class=\"string\">&quot;[object Date]&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(obj.getTime());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// RegExp</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_toString.call(obj) === <span class=\"string\">&quot;[object RegExp]&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> flags = [];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj.global) &#123;</span><br><span class=\"line\">            flags.push(<span class=\"string\">&quot;g&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj.multiline) &#123;</span><br><span class=\"line\">            flags.push(<span class=\"string\">&quot;m&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj.ignoreCase) &#123;</span><br><span class=\"line\">            flags.push(<span class=\"string\">&quot;i&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(obj.source, flags.join(<span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"built_in\">Array</span>.isArray(obj)</span><br><span class=\"line\">        ? []</span><br><span class=\"line\">        : obj.constructor</span><br><span class=\"line\">        ? <span class=\"keyword\">new</span> obj.constructor()</span><br><span class=\"line\">        : &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">        result[key] = deepClone(obj[key]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.a = a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&quot;qiu&quot;</span>,</span><br><span class=\"line\">    birth: <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(),</span><br><span class=\"line\">    pattern: <span class=\"regexp\">/qiu/gim</span>,</span><br><span class=\"line\">    container: <span class=\"built_in\">document</span>.body,</span><br><span class=\"line\">    hobbys: [<span class=\"string\">&quot;book&quot;</span>, <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(), <span class=\"regexp\">/aaa/gim</span>, <span class=\"number\">111</span>]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> A();</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = deepClone(c);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c.a === b.a);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c, b);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Javascript-的节流和防抖\"><a href=\"#Javascript-的节流和防抖\" class=\"headerlink\" title=\"Javascript 的节流和防抖\"></a>Javascript 的节流和防抖</h2><p>函数节流和函数防抖，两者都是优化高频率执行 JS 代码的一种手段。</p>\n<h3 id=\"函数节流\"><a href=\"#函数节流\" class=\"headerlink\" title=\"函数节流\"></a>函数节流</h3><p>防抖动和节流本质是不一样的。放</p>\n<p>是指一定时间内 js 方法只跑一次。</p>\n<p>函数节流应用的实际场景，多数在监听页面元素滚动时间的时候会用到。因为滚动事件，是一个高频触发的事件。以下是监听页面元素滚动的示例代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//函数节流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> canRun = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;throttle&quot;</span>).onsroll = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!canRun) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//判断是否空闲，如果在执行中，则直接return</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    canRun = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;函数节流&quot;</span>);</span><br><span class=\"line\">        canRun = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;, <span class=\"number\">300</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"函数防抖\"><a href=\"#函数防抖\" class=\"headerlink\" title=\"函数防抖\"></a>函数防抖</h3><p>函数防抖的应有场景，最常见的就是用户注册的时候的手机号码验证和邮箱验证了。只有等用户输入完毕后，前端才需要检查格式是否正确，如果不正确，在弹出提示语。以下还是以页面元素滚动监听的例子，来解析：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//函数防抖</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> timer = fasle;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;document&quot;</span>).onsrcoll = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">clearTimeout</span>(timer).timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//清楚未执行的代码，重置回初始状态</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;函数防抖&quot;</span>);</span><br><span class=\"line\">    &#125;, <span class=\"number\">300</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// func是用户传入需要防抖的函数</span></span><br><span class=\"line\"><span class=\"comment\">// wait是等待时间</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> debounce = <span class=\"function\">(<span class=\"params\">func, wait = <span class=\"number\">50</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 缓存一个定时器id</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> timer = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 这里返回的函数是每次用户实际调用的防抖函数</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果已经设定过定时器了就清空上一次的定时器</span></span><br><span class=\"line\">    <span class=\"comment\">// 开始一个新的定时器，延迟执行用户传入的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (timer) <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">        timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            func.apply(<span class=\"built_in\">this</span>, args);</span><br><span class=\"line\">        &#125;, wait);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 不难看出如果用户调用该函数的间隔小于wait的情况下，上一次的时间还未到就被清除了，并不会执行函数</span></span><br></pre></td></tr></table></figure>\n\n<p>函数防抖的要点，也是需要一个 setTimeout 来辅助实现。延迟执行需要跑的代码</p>\n<p>但是这种简单版的防抖也是缺陷的，这个防抖只能在最后调用。一般的防抖会有 imm 选项，表示是否立即调用。这两者的区别在于：</p>\n<ul>\n<li>  在搜索引擎搜索问题的时候，希望达到用户数万最后一个字才调用查询整个接口，这个时候适用<code>延迟执行</code>的防抖函数，它总是在一连串（间隔小于 wait 的）函数出发之后才调用。</li>\n<li>  例如在用户点击按钮时，是立即调用接口，并且下一次调用时间间隔大于 wait 才会触发。</li>\n</ul>\n<p>带有立即执行选项的防抖函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">now</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//获取当前时间戳</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 防抖函数，返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;function&#125;</span> </span>func        回调函数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;number&#125;</span>   </span>wait        表示时间窗口的间隔</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;boolean&#125;</span>  </span>immediate   设置为ture时，是否立即调用函数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return <span class=\"type\">&#123;function&#125;</span>             </span>返回客户调用函数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">func, wait = <span class=\"number\">50</span>, immediate = <span class=\"literal\">true</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> timer, context, args;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 延迟执行函数</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> later = <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 延迟函数执行完毕，清空缓存的定时器序号</span></span><br><span class=\"line\">            timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"comment\">// 延迟执行的情况下，函数会在延迟函数中执行</span></span><br><span class=\"line\">            <span class=\"comment\">// 使用到之前缓存的参数和上下文</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!immediate) &#123;</span><br><span class=\"line\">                func.apply(context, args);</span><br><span class=\"line\">                context = args = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, wait);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 这里返回的函数是每次实际调用的函数</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">...params</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 如果没有创建延迟执行函数（later），就创建一个</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!timer) &#123;</span><br><span class=\"line\">            timer = later();</span><br><span class=\"line\">            <span class=\"comment\">// 如果是立即执行，调用函数</span></span><br><span class=\"line\">            <span class=\"comment\">// 否则缓存参数和调用上下文</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (immediate) &#123;</span><br><span class=\"line\">                func.apply(<span class=\"built_in\">this</span>, params);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                context = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">                args = params;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 如果已有延迟执行函数（later），调用的时候清除原来的并重新设定一个</span></span><br><span class=\"line\">            <span class=\"comment\">// 这样做延迟函数会重新计时</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">            timer = later();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"FileReader-对象\"><a href=\"#FileReader-对象\" class=\"headerlink\" title=\"FileReader 对象\"></a>FileReader 对象</h2><p>之前做图片上传预览都是把图片上传到服务器获得线上地址，如今才发现有另一种方法：使用<code>FildeReader</code>(但兼容性不是很好，ie10)</p>\n<p><code>FileReader</code>允许 Web 应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。主要用来把文件读入内存，并且读取文件中的数据。通过构造函数创建一个 FileReader 对象。</p>\n<p>其中 file 对象可以是来自用户在一个<code>&lt;input&gt;</code>元素上悬着文件后返回的 filelist 对象，也可以来自拖放操作生成的<code>DataTransfer</code>对象，还可以是来自一个<code>HTMLCanvasElement</code>上执行<code>mozGetAsFile()</code>方法后返回结果。</p>\n<p><code>FileReader.readyState</code>表示 FileReader 状态的数字。取值如下：</p>\n<ul>\n<li>  EMPTY: 0 还没有加载任何数据。</li>\n<li>  LOADING: 1 数据正在加载。</li>\n<li>  DONE：2 已经完成全部的读取请求。</li>\n</ul>\n<p><code>FileReader.result</code>表示文件内容。该属性仅在读取操作完成后才有效，数据的格式取决于使用哪个方法来启动读取操作。</p>\n<p><code>FileReader.readAsDataURL()</code>表示开始读取指定的 Blob 中的内容。一旦完成，result 属性中将包含一个 data:URL 格式的字符串以表示所读取文件的内容。</p>\n<ul>\n<li>  abort：中断读取操作。</li>\n<li>  readAsArrayBuffer：读取文件内容到 ArrayBuffer 对象中。</li>\n<li>  readAsBinaryString：将文件读取为二进制数据。</li>\n<li>  readAsDataURL：将文件读取为 data: URL 格式的字符串。</li>\n<li>  readAsText：将文件读取为文本。</li>\n</ul>\n<h3 id=\"上传图片预览\"><a href=\"#上传图片预览\" class=\"headerlink\" title=\"上传图片预览\"></a>上传图片预览</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;files&quot;</span> <span class=\"attr\">accept</span>=<span class=\"string\">&quot;image/jpeg,image/jpg,image/png&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;blank.gif&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;preview&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> elem = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;files&quot;</span>),</span></span><br><span class=\"line\"><span class=\"javascript\">        img = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;preview&quot;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">    elem.onchange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> files = elem.files,</span></span><br><span class=\"line\"><span class=\"javascript\">            reader = <span class=\"keyword\">new</span> FileReader();</span></span><br><span class=\"line\">        if (files &amp;&amp; files[0]) &#123;</span><br><span class=\"line\"><span class=\"javascript\">            reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123;</span></span><br><span class=\"line\">                img.src = ev.target.result;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            reader.readAsDataURL(files[0]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"图片上传-小图片转-base64\"><a href=\"#图片上传-小图片转-base64\" class=\"headerlink\" title=\"图片上传 小图片转 base64\"></a>图片上传 小图片转 base64</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\"><span class=\"keyword\">let</span> imgUrlBase64 = reader.readAsDataURL(file);</span><br><span class=\"line\">reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    reader.result.length; <span class=\"comment\">//去判断大小 reader.result就是</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Base64-编码\"><a href=\"#Base64-编码\" class=\"headerlink\" title=\"Base64 编码\"></a>Base64 编码</h2><p>在 HTML5 中新增了 atob 和 btoa 方法来支持 Base64 编码。它们的命名也很简单，b to a 和 a to b，即代表着编码和解码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&quot;https://lin-xin.github.io&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = btoa(a);</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = atob(b);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);     <span class=\"comment\">// https://lin-xin.github.io</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b);     <span class=\"comment\">// aHR0cHM6Ly9saW4teGluLmdpdGh1Yi5pbw==</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c);     <span class=\"comment\">// https://lin-xin.github.io复制代码btoa 方法对字符串 a 进行编码，不会改变 a 的值，返回一个编码后的值。atob 方法对编码后的字符串进行解码。</span></span><br><span class=\"line\">但是参数中带中文，已经超出了<span class=\"number\">8</span>位ASCII编码的字符范围，浏览器就会报错。所以需要先对中文进行 <span class=\"built_in\">encodeURIComponent</span> 编码处理。</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&quot;哈喽 世界&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = btoa(<span class=\"built_in\">encodeURIComponent</span>(a));</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"built_in\">decodeURIComponent</span>(atob(b));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b);     <span class=\"comment\">// JUU1JTkzJTg4JUU1JTk2JUJEJTIwJUU0JUI4JTk2JUU3JTk1JThD</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c);     <span class=\"comment\">// 哈喽 世界</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查找数组对象里面是否含有某对象\"><a href=\"#查找数组对象里面是否含有某对象\" class=\"headerlink\" title=\"查找数组对象里面是否含有某对象\"></a>查找数组对象里面是否含有某对象</h2><p>查找 selectedList 里面是否存在 listAppEquipment 数组里面的对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> selectedListString = <span class=\"built_in\">JSON</span>.stringify(that.selectedList);</span><br><span class=\"line\">that.listAppEquipment.forEach(<span class=\"function\">(<span class=\"params\">item: any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> value = <span class=\"built_in\">JSON</span>.stringify(item.value);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (selectedListString.indexOf(value) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        item.checked = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        item.selected = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>搬砖时的 JS 代码片段整理</p>","more":"<h1 id=\"将-bytes-格式化\"><a href=\"#将-bytes-格式化\" class=\"headerlink\" title=\"将 bytes 格式化\"></a>将 bytes 格式化</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> total = <span class=\"built_in\">this</span>.fileSizeFormat(spaceSize, <span class=\"number\">2</span>, <span class=\"literal\">true</span>, <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"title\">fileSizeFormat</span>(<span class=\"params\">bytes, digits, unitFlag, floorFlag</span>)</span> &#123;</span><br><span class=\"line\">      bytes = <span class=\"built_in\">parseFloat</span>(bytes)</span><br><span class=\"line\">      <span class=\"keyword\">let</span> absBytes = <span class=\"built_in\">Math</span>.abs(bytes)</span><br><span class=\"line\">      <span class=\"keyword\">let</span> humanSize, unit</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (digits === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        digits = <span class=\"number\">2</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (unitFlag === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        unitFlag = <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (absBytes &lt; <span class=\"number\">1024</span>) &#123;</span><br><span class=\"line\">        digits = <span class=\"number\">0</span></span><br><span class=\"line\">        humanSize = bytes</span><br><span class=\"line\">        unit = <span class=\"string\">&#x27;B&#x27;</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (absBytes &lt; <span class=\"number\">900</span> * <span class=\"number\">1024</span>) &#123;</span><br><span class=\"line\">          humanSize = bytes / <span class=\"number\">1024</span></span><br><span class=\"line\">          unit = <span class=\"string\">&#x27;K&#x27;</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (absBytes &lt; <span class=\"number\">900</span> * <span class=\"number\">1048576</span>) &#123;</span><br><span class=\"line\">            humanSize = bytes / <span class=\"number\">1048576</span></span><br><span class=\"line\">            unit = <span class=\"string\">&#x27;M&#x27;</span></span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (absBytes &lt; <span class=\"number\">900</span> * <span class=\"number\">1073741824</span> || (digits === <span class=\"number\">0</span> &amp;&amp; absBytes &lt; <span class=\"number\">1048576</span> * <span class=\"number\">1048576</span>)) &#123;</span><br><span class=\"line\">              humanSize = bytes / <span class=\"number\">1073741824</span></span><br><span class=\"line\">              unit = <span class=\"string\">&#x27;G&#x27;</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              humanSize = bytes / (<span class=\"number\">1048576</span> * <span class=\"number\">1048576</span>)</span><br><span class=\"line\">              unit = <span class=\"string\">&#x27;T&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        humanSize = <span class=\"built_in\">Math</span>.round(humanSize * <span class=\"built_in\">Math</span>.pow(<span class=\"number\">10</span>, digits)) / <span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.pow(<span class=\"number\">10</span>, digits))</span><br><span class=\"line\">        humanSize = humanSize.toFixed(digits)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> result</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (floorFlag &amp;&amp; digits &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (humanSize !== <span class=\"built_in\">Math</span>.floor(humanSize)) &#123;</span><br><span class=\"line\">            result = humanSize</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">Math</span>.floor(humanSize), <span class=\"number\">10</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          result = humanSize</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (unitFlag) &#123;</span><br><span class=\"line\">          result = result + unit</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"获取文件扩展名\"><a href=\"#获取文件扩展名\" class=\"headerlink\" title=\"获取文件扩展名\"></a>获取文件扩展名</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> extname = <span class=\"function\"><span class=\"params\">filename</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (filename.indexOf(<span class=\"string\">&quot;.&quot;</span>) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> resultArr = filename.split(<span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> result = <span class=\"string\">&quot;.&quot;</span> + resultArr[resultArr.length - <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"冒泡排序\"><a href=\"#冒泡排序\" class=\"headerlink\" title=\"冒泡排序\"></a>冒泡排序</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bubbleSort</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = arr.length,</span><br><span class=\"line\">        j;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> tempExchangVal;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (j = <span class=\"number\">0</span>; j &lt; i - <span class=\"number\">1</span>; j++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (arr[j] &gt; arr[j + <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">                tempExchangVal = arr[j];</span><br><span class=\"line\">                arr[j] = arr[j + <span class=\"number\">1</span>];</span><br><span class=\"line\">                arr[j + <span class=\"number\">1</span>] = tempExchangVal;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        i--;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">9</span>, <span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrSorted = bubbleSort(arr);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrSorted);</span><br><span class=\"line\">alert(arrSorted);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"快速排序算法\"><a href=\"#快速排序算法\" class=\"headerlink\" title=\"快速排序算法\"></a>快速排序算法</h2><p>快速排序是处理大数据急最快的排序算法之一。它是一种分而治之的算法，通过递归的方式将数据一次分解为包含较小元素和较大元素的不同子序列。</p>\n<p><img src=\"/images/common/kuaipai.png\" alt=\"network\"></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">quickSort</span>(<span class=\"params\">array</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (array.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> left = [];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> right = [];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> priot = array[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; array.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (array[i] &lt; privot) &#123;</span><br><span class=\"line\">            left.push(array[i]);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            right.push(array[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> quickSort(left).concat(privot, quickSort(right));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"JS-深度克隆\"><a href=\"#JS-深度克隆\" class=\"headerlink\" title=\"JS 深度克隆\"></a>JS 深度克隆</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepClone</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _toString = <span class=\"built_in\">Object</span>.prototype.toString;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// null, undefined, non-object, function</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!obj || <span class=\"keyword\">typeof</span> obj !== <span class=\"string\">&quot;object&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// DOM Node</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.nodeType &amp;&amp; <span class=\"string\">&quot;cloneNode&quot;</span> <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj.cloneNode(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Date</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_toString.call(obj) === <span class=\"string\">&quot;[object Date]&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(obj.getTime());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// RegExp</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_toString.call(obj) === <span class=\"string\">&quot;[object RegExp]&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> flags = [];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj.global) &#123;</span><br><span class=\"line\">            flags.push(<span class=\"string\">&quot;g&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj.multiline) &#123;</span><br><span class=\"line\">            flags.push(<span class=\"string\">&quot;m&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj.ignoreCase) &#123;</span><br><span class=\"line\">            flags.push(<span class=\"string\">&quot;i&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(obj.source, flags.join(<span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"built_in\">Array</span>.isArray(obj)</span><br><span class=\"line\">        ? []</span><br><span class=\"line\">        : obj.constructor</span><br><span class=\"line\">        ? <span class=\"keyword\">new</span> obj.constructor()</span><br><span class=\"line\">        : &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">        result[key] = deepClone(obj[key]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.a = a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&quot;qiu&quot;</span>,</span><br><span class=\"line\">    birth: <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(),</span><br><span class=\"line\">    pattern: <span class=\"regexp\">/qiu/gim</span>,</span><br><span class=\"line\">    container: <span class=\"built_in\">document</span>.body,</span><br><span class=\"line\">    hobbys: [<span class=\"string\">&quot;book&quot;</span>, <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(), <span class=\"regexp\">/aaa/gim</span>, <span class=\"number\">111</span>]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> A();</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = deepClone(c);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c.a === b.a);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c, b);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Javascript-的节流和防抖\"><a href=\"#Javascript-的节流和防抖\" class=\"headerlink\" title=\"Javascript 的节流和防抖\"></a>Javascript 的节流和防抖</h2><p>函数节流和函数防抖，两者都是优化高频率执行 JS 代码的一种手段。</p>\n<h3 id=\"函数节流\"><a href=\"#函数节流\" class=\"headerlink\" title=\"函数节流\"></a>函数节流</h3><p>防抖动和节流本质是不一样的。放</p>\n<p>是指一定时间内 js 方法只跑一次。</p>\n<p>函数节流应用的实际场景，多数在监听页面元素滚动时间的时候会用到。因为滚动事件，是一个高频触发的事件。以下是监听页面元素滚动的示例代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//函数节流</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> canRun = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;throttle&quot;</span>).onsroll = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!canRun) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//判断是否空闲，如果在执行中，则直接return</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    canRun = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;函数节流&quot;</span>);</span><br><span class=\"line\">        canRun = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;, <span class=\"number\">300</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"函数防抖\"><a href=\"#函数防抖\" class=\"headerlink\" title=\"函数防抖\"></a>函数防抖</h3><p>函数防抖的应有场景，最常见的就是用户注册的时候的手机号码验证和邮箱验证了。只有等用户输入完毕后，前端才需要检查格式是否正确，如果不正确，在弹出提示语。以下还是以页面元素滚动监听的例子，来解析：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//函数防抖</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> timer = fasle;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;document&quot;</span>).onsrcoll = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">clearTimeout</span>(timer).timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//清楚未执行的代码，重置回初始状态</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;函数防抖&quot;</span>);</span><br><span class=\"line\">    &#125;, <span class=\"number\">300</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// func是用户传入需要防抖的函数</span></span><br><span class=\"line\"><span class=\"comment\">// wait是等待时间</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> debounce = <span class=\"function\">(<span class=\"params\">func, wait = <span class=\"number\">50</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 缓存一个定时器id</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> timer = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 这里返回的函数是每次用户实际调用的防抖函数</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果已经设定过定时器了就清空上一次的定时器</span></span><br><span class=\"line\">    <span class=\"comment\">// 开始一个新的定时器，延迟执行用户传入的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (timer) <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">        timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            func.apply(<span class=\"built_in\">this</span>, args);</span><br><span class=\"line\">        &#125;, wait);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 不难看出如果用户调用该函数的间隔小于wait的情况下，上一次的时间还未到就被清除了，并不会执行函数</span></span><br></pre></td></tr></table></figure>\n\n<p>函数防抖的要点，也是需要一个 setTimeout 来辅助实现。延迟执行需要跑的代码</p>\n<p>但是这种简单版的防抖也是缺陷的，这个防抖只能在最后调用。一般的防抖会有 imm 选项，表示是否立即调用。这两者的区别在于：</p>\n<ul>\n<li>  在搜索引擎搜索问题的时候，希望达到用户数万最后一个字才调用查询整个接口，这个时候适用<code>延迟执行</code>的防抖函数，它总是在一连串（间隔小于 wait 的）函数出发之后才调用。</li>\n<li>  例如在用户点击按钮时，是立即调用接口，并且下一次调用时间间隔大于 wait 才会触发。</li>\n</ul>\n<p>带有立即执行选项的防抖函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">now</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//获取当前时间戳</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 防抖函数，返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;function&#125;</span> </span>func        回调函数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;number&#125;</span>   </span>wait        表示时间窗口的间隔</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;boolean&#125;</span>  </span>immediate   设置为ture时，是否立即调用函数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return <span class=\"type\">&#123;function&#125;</span>             </span>返回客户调用函数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">func, wait = <span class=\"number\">50</span>, immediate = <span class=\"literal\">true</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> timer, context, args;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 延迟执行函数</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> later = <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 延迟函数执行完毕，清空缓存的定时器序号</span></span><br><span class=\"line\">            timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"comment\">// 延迟执行的情况下，函数会在延迟函数中执行</span></span><br><span class=\"line\">            <span class=\"comment\">// 使用到之前缓存的参数和上下文</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!immediate) &#123;</span><br><span class=\"line\">                func.apply(context, args);</span><br><span class=\"line\">                context = args = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, wait);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 这里返回的函数是每次实际调用的函数</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">...params</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 如果没有创建延迟执行函数（later），就创建一个</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!timer) &#123;</span><br><span class=\"line\">            timer = later();</span><br><span class=\"line\">            <span class=\"comment\">// 如果是立即执行，调用函数</span></span><br><span class=\"line\">            <span class=\"comment\">// 否则缓存参数和调用上下文</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (immediate) &#123;</span><br><span class=\"line\">                func.apply(<span class=\"built_in\">this</span>, params);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                context = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">                args = params;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 如果已有延迟执行函数（later），调用的时候清除原来的并重新设定一个</span></span><br><span class=\"line\">            <span class=\"comment\">// 这样做延迟函数会重新计时</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">            timer = later();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"FileReader-对象\"><a href=\"#FileReader-对象\" class=\"headerlink\" title=\"FileReader 对象\"></a>FileReader 对象</h2><p>之前做图片上传预览都是把图片上传到服务器获得线上地址，如今才发现有另一种方法：使用<code>FildeReader</code>(但兼容性不是很好，ie10)</p>\n<p><code>FileReader</code>允许 Web 应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。主要用来把文件读入内存，并且读取文件中的数据。通过构造函数创建一个 FileReader 对象。</p>\n<p>其中 file 对象可以是来自用户在一个<code>&lt;input&gt;</code>元素上悬着文件后返回的 filelist 对象，也可以来自拖放操作生成的<code>DataTransfer</code>对象，还可以是来自一个<code>HTMLCanvasElement</code>上执行<code>mozGetAsFile()</code>方法后返回结果。</p>\n<p><code>FileReader.readyState</code>表示 FileReader 状态的数字。取值如下：</p>\n<ul>\n<li>  EMPTY: 0 还没有加载任何数据。</li>\n<li>  LOADING: 1 数据正在加载。</li>\n<li>  DONE：2 已经完成全部的读取请求。</li>\n</ul>\n<p><code>FileReader.result</code>表示文件内容。该属性仅在读取操作完成后才有效，数据的格式取决于使用哪个方法来启动读取操作。</p>\n<p><code>FileReader.readAsDataURL()</code>表示开始读取指定的 Blob 中的内容。一旦完成，result 属性中将包含一个 data:URL 格式的字符串以表示所读取文件的内容。</p>\n<ul>\n<li>  abort：中断读取操作。</li>\n<li>  readAsArrayBuffer：读取文件内容到 ArrayBuffer 对象中。</li>\n<li>  readAsBinaryString：将文件读取为二进制数据。</li>\n<li>  readAsDataURL：将文件读取为 data: URL 格式的字符串。</li>\n<li>  readAsText：将文件读取为文本。</li>\n</ul>\n<h3 id=\"上传图片预览\"><a href=\"#上传图片预览\" class=\"headerlink\" title=\"上传图片预览\"></a>上传图片预览</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;files&quot;</span> <span class=\"attr\">accept</span>=<span class=\"string\">&quot;image/jpeg,image/jpg,image/png&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;blank.gif&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;preview&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> elem = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;files&quot;</span>),</span></span><br><span class=\"line\"><span class=\"javascript\">        img = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;preview&quot;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">    elem.onchange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> files = elem.files,</span></span><br><span class=\"line\"><span class=\"javascript\">            reader = <span class=\"keyword\">new</span> FileReader();</span></span><br><span class=\"line\">        if (files &amp;&amp; files[0]) &#123;</span><br><span class=\"line\"><span class=\"javascript\">            reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) </span>&#123;</span></span><br><span class=\"line\">                img.src = ev.target.result;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            reader.readAsDataURL(files[0]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"图片上传-小图片转-base64\"><a href=\"#图片上传-小图片转-base64\" class=\"headerlink\" title=\"图片上传 小图片转 base64\"></a>图片上传 小图片转 base64</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\"><span class=\"keyword\">let</span> imgUrlBase64 = reader.readAsDataURL(file);</span><br><span class=\"line\">reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    reader.result.length; <span class=\"comment\">//去判断大小 reader.result就是</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Base64-编码\"><a href=\"#Base64-编码\" class=\"headerlink\" title=\"Base64 编码\"></a>Base64 编码</h2><p>在 HTML5 中新增了 atob 和 btoa 方法来支持 Base64 编码。它们的命名也很简单，b to a 和 a to b，即代表着编码和解码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&quot;https://lin-xin.github.io&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = btoa(a);</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = atob(b);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);     <span class=\"comment\">// https://lin-xin.github.io</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b);     <span class=\"comment\">// aHR0cHM6Ly9saW4teGluLmdpdGh1Yi5pbw==</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c);     <span class=\"comment\">// https://lin-xin.github.io复制代码btoa 方法对字符串 a 进行编码，不会改变 a 的值，返回一个编码后的值。atob 方法对编码后的字符串进行解码。</span></span><br><span class=\"line\">但是参数中带中文，已经超出了<span class=\"number\">8</span>位ASCII编码的字符范围，浏览器就会报错。所以需要先对中文进行 <span class=\"built_in\">encodeURIComponent</span> 编码处理。</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&quot;哈喽 世界&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = btoa(<span class=\"built_in\">encodeURIComponent</span>(a));</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"built_in\">decodeURIComponent</span>(atob(b));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b);     <span class=\"comment\">// JUU1JTkzJTg4JUU1JTk2JUJEJTIwJUU0JUI4JTk2JUU3JTk1JThD</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c);     <span class=\"comment\">// 哈喽 世界</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查找数组对象里面是否含有某对象\"><a href=\"#查找数组对象里面是否含有某对象\" class=\"headerlink\" title=\"查找数组对象里面是否含有某对象\"></a>查找数组对象里面是否含有某对象</h2><p>查找 selectedList 里面是否存在 listAppEquipment 数组里面的对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> selectedListString = <span class=\"built_in\">JSON</span>.stringify(that.selectedList);</span><br><span class=\"line\">that.listAppEquipment.forEach(<span class=\"function\">(<span class=\"params\">item: any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> value = <span class=\"built_in\">JSON</span>.stringify(item.value);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (selectedListString.indexOf(value) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        item.checked = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        item.selected = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>"},{"title":"JS基础(ES5)","date":"2018-01-18T02:12:34.000Z","_content":"\n感觉自己的 ES5 掌握的比较杂乱，在此整理一下自己的思路，总结、归纳原生 JS 的知识。\n\n<!--more-->\n\n## 内置类型\n\nJS 中有 7 种内置类型，7 种内置类型又分为两大类型：基本类型和对象（Object）\n基础基本类型有 6 种：`null`,`undefined`,`boolean`,`number`,`string`,`symbol`。\n\n## `Typeof`\n\n`typeof` 对于基本类型。除了`null`都可以显示正确的类型\n\n```javascript\ntypeof 1 // 'number'\ntypeof '1' // 'string'\ntypeof undefined // 'undefined'\ntypeof true // 'boolean'\ntypeof Symbol() // 'symbol'\ntypeof b // b 没有声明，但是还会显示 undefined\n\n//typeof 对于对象，除了函数都会显示 object\n\ntypeof [] // 'object'\ntypeof {} // 'object'\ntypeof console.log // 'function'\n\ntypeof null // 'object'\n```\n\nPS：为什么会出现这种情况呢？因为在 JS 的最初版本中，使用的是 32 位系统，为了性能考虑使用低位存储了变量的类型信息，000 开头代表是对象，然而 null 表示为全零，所以将它错误的判断为 object 。虽然现在的内部类型判断代码已经改变了，但是对于这个 Bug 却是一直流传下来\n\n```javascript\nlet a\n// 我们也可以这样判断 undefined\na === undefined\n// 但是 undefined 不是保留字，能够在低版本浏览器被赋值\nlet undefined = 1\n// 这样判断就会出错\n// 所以可以用下面的方式来判断，并且代码量更少\n// 因为 void 后面随便跟上一个组成表达式\n// 返回就是 undefined\na === void 0\n```\n\n## 对象\n\n创建对象可以通过对象直接量，关键字 new 和 object.creat() 函数来创建对象。每一个对象都有与知相关的原型，类和可扩展性。可分为普通对象和函数对象。凡是通过 new function() 创建的都是函数对象。其他都是普通对象。\n\n### instanceof\n\ninstanceof 可以正确的判断对象类型，因为内部机制是通过对象的原型链中是不是能找到类型的 prototype\n\n```javascript\nconsole.log([] instanceof Arrage) //true\nconsole.log({} instanceof Object) //true\nconsole.log(function () {} instanceof Function) //true\nconsole.log(1 instanceof NUmber) //true\n```\n\n### 对象直接量\n\n对象直接量是类似于 var a = {x:0,y:0} 的映射表。对象直接量是一个表达式，这个表达式的每次运算都创建并初始化一个新的对象。每次计算对象直接量的时候。也会计算它的每个属性值，**也就是说在一个循环体内使用了对象直接量，他将会创建很对新对象，并且每次创建的对象的属性值也有可能不同。**\n\n### 通过 new 创建对象\n\n1. 新生成了一个对象\n2. 链接到原型\n3. 绑定 this\n4. 返回新对象\n\n在调用`new`的过程中会发生以上四件事情。\n\nvar obj=new MyClass(); new 运算符创建并初始化一个**新对象** 用 new 调用时，this 会指向空的对象，并且这个对象的原型指向 MyClass.prototype\n\n#### new 的过程以及是实现 new\n\n```javascript\nlet obj = {}\nlet con = [].shift.call(arguments)\n```\n\n## 事件委托\n\n利用事件委托技术能让你对特定的每个节点添加事件监听器；相反，事件监听器是被添加到他们的父元素上的。事件监听器会分析从子元素冒泡上来的事件，找到是哪一个子元素的事件。\n\n- event.target 返回触发事件的元素\n- event.currentTarget 返回绑定事件的元素\n\n```html\n<ul id=\"parent-list\">\n  <li id=\"post-1\">Item 1</li>\n  <li id=\"post-2\">Item 2</li>\n  <li id=\"post-3\">Item 3</li>\n  <li id=\"post-4\">Item 4</li>\n  <li id=\"post-5\">Item 5</li>\n  <li id=\"post-6\">Item 6</li>\n</ul>\n<script>\n  document\n    .getElementById('parent-list')\n    .addEventListener('click', function (e) {\n      // e.target是被点击的元素!\n      // 如果被点击的是li元素\n      if (e.target && e.target.nodeName == 'LI') {\n        // 找到目标，输出ID!\n        console.log('List item ', e.target.id.replace('post-'), ' was clicked!')\n      }\n\n      $('li').click(function () {\n        $(this).css('background', '#D4DFE6')\n      })\n\n      // jQuery的delegate写法\n      $('#wrap').delegate('li', 'click', function (ev) {\n        // this 指向委托的对象 li\n        $(this).css('background', '#D4DFE6')\n\n        // 找到父级 ul#wrap\n        $(ev.delegateTarget).css('border', '2px solid #f00')\n      })\n    })\n</script>\n```\n\n## `getComputedStyle()`\n\n`getComputedStyle`是一个可以获取当前元素所有最终使用 css 属性值。返回一个 css 样式声明对象([object CSSStyleDeclaration])，只读。之前偶尔有一次要更改伪类元素 ::after 的样式\n\n```javascript\nvar dom = document.getElementById('test'),\n  style = window.getComputedStyle(dom, ':after')\n```\n\n### `getComputedStyle`与`style`的区别\n\n- `getComputedStyle`方法是只读的，只能获取样式，不能设置；而`element.style`能读能写。\n- 获取对象范围\n  `getComputedStyle`方法获取的是最终应用在元素上的所有 css 属性对象；而`element.style`只能获取元素`style`中的 css 样式。因此对于一个光秃秃的元素`<p>`，`getComputedStyle`方法返回对象中的 length 属性值就有 190+,而`element.style`就是 0。\n\n### `getPropertyValue`方法\n\n`getPropertyValue`方法可以获取 CSS 样式申明对象上的属性值（直接属性名称），例如：\n\n```javascript\nwindow.getComputedStyle(element, null).getPropertyValue('float')\n```\n\n## `this`\n\n\\*\\* `this`要在执行的时候才能确定值，定义时是无法确认，因为 js 不是编译型语言而是解释型语言\n\n说明 this 几种不同的使用方式\n\n- 作为构造函数执行\n- 作为对象属性执行\n- 作为普通函数执行\n- `call`,`applay`,`bind`\n\n```javascript\nvar a = {\n  name: A,\n  fn: function () {\n    console.log(this.name)\n  },\n}\na.fn() //this===a\na.fn({ name: 'b' }) //this==={name:'b'}\nvar fn1 = a.fn\nfn1() //this===window\n```\n\n---\n\n## 深浅拷贝\n\n### 浅拷贝\n\n浅拷贝之解决了第一层的问题，如果接下去的值中还有对象的话，那么就又会出现值引用，改变值会互相影响\n\n- 首先可以通过`Object.assign`来解决这个问题。\n\n  ```javascript\n  let a = {\n    age: 1,\n  }\n  let b = Object.assign({}, a)\n  a.age = 2\n  console.log(b.age)\n  ```\n\n- 当然也可以通过展开运算符（···）来解决\n  ```javascript\n  let a = {\n    age: 1,\n  }\n  let b = { ...a }\n  a.age = 2\n  console.log(b.age) //1\n  ```\n\n### 深拷贝\n\n这个问题可以通过`JSON.parse(JSON.stringfy(object))`来解决。\n\n但是该方法也是有局限性的：\n\n- 会忽略 `undefined`\n- 会忽略`symbol`\n- 不能序列化函数\n- 不能解决循环引用对象\n\n```javascript\nlet obj = {\n  a: 1,\n  b: {\n    c: 2,\n    d: 3,\n  },\n}\nobj.c = obj.b\nobj.e = obj.a\nobj.b.c = obj.c\nobj.b.e = obj.b.c\nlet newObj = JSON.parse(JSON.stringfy(obj))\nconsole.log(newObj) //会报错\n```\n\n```javascript\nlet a = {\n  age: undefined,\n  sex: Symbol('male'),\n  jobs: function () {},\n  name: 'yck',\n}\n\nlet b = JSON.parse(JSON.stringfy(a))\nconsole.log(b) //{name:'yck'}\n```\n\n## `Map`、`FlatMap`、`Reduce`\n\n`Map`作用是生成一个新数组，遍历原数组，将每一个元素拿出来做一些变换然后`append`到新的数组中。\n\n```javascript\n;[1, 2, 3].map((v) => v + 1) //=>[2,3,4]\n```\n\n`Map`有三个参数，分别是当前索引元素，索引，原数组\n\n```javascript\n;['1', '2', '3'].map(parseInt)\n//  parseInt('1', 0) -> 1\n//  parseInt('2', 1) -> NaN\n//  parseInt('3', 2) -> NaN\n```\n\n## NaN\n\n```javascript\nNaN !== NaN //true\nNaN.valueOf() //NaN\nNaN.toString() //'NaN\nNaN < 3 //false\nNaN >= 3 //false\nNaN < NaN //false\nNaN >= NaN //false\n```\n\n## 标签语句\n\n相当于定位符，用于跳转到程序的任意位置。标签通常与 break 语句和 continue 语句配合使用，跳出特定的循环。\n\n```javascript\ntop: for (var i = 0; i < 3; i++) {\n  for (var j = 0; j < 3; j++) {\n    if (i === 1 && j === 1) break top\n    console.log('i=' + i + ', j=' + j)\n  }\n}\n```\n\nbreak 命令后加上 top 标签，满足条件时，直接跳出双层循环。如果 break 语句后面不适用标签，则纸条出内层循环，进入下一次外层循环。\n\ncontinue 语句也可以配合使用\n\n```javascript\ntop: for (var i = 0; i < 3; i++) {\n  for (var j = 0; j < 3; j++) {\n    if (i === 1 && j === 1) continue top\n    console.log('i=' + i + ', j=' + j)\n  }\n}\n// i=0, j=0\n// i=0, j=1\n// i=0, j=2\n// i=1, j=0\n// i=2, j=0\n// i=2, j=1\n// i=2, j=2\n```\n\n满足条件时，会跳过当前循环，直接进入到下一论外层循环。如果 continue 语句后面不使用标签，则只能进入下一轮内层循环。\n\n## with\n\nwith 语句用途是将代码作用于设置为特定对象，使用例子是：\n\n```javascript\nwith(location{\n  let qs = search.substring(1)\n  let hostName = hostname\n  let url = href\n})\n```\n\n使用 with 代替频繁使用的 location 对象，这意味着在这个语句内部，每个变量首先会被认为是一个局部变量，如果没有找到该局部变量，则会搜索 location 对象，看它是否是有一个同名属性。如果有，则该苏醒会被求值成 location 对象属性\n\n由于 with 语句影响性能且难以调试其中代码,通常不推荐在代码中使用\n\n## 原始数据类型\n\nECMScript 变量可以包含两种不同类型的数据：原始值和引用值。原始值就是最简单的数据，引用值是由多个值构成的对象。\n\n**6 种引用值**：Undefined、Null、Boolean、Number、String 和 Symbol，typeOf 操作符最适合用来判断是否是原始类型，但是如果值是对象或是 null，那么 typeof 返回 Object\n\n保存原始值的变量是**按值**访问的，因为我们操作的就是存储在变量中的实际值\n\n注意，原始类型的初始化可以只使用原始字面量形式。如果使用的是 new 关键字，则 JavaScript 会创建一个 Object 类型的实例，但其行为类似原始值。下面来看看这两种初始化方式的差异：\n\n```javascript\nlet name1 = \"Nicholas\";\nlet name2 = new String(\"Matt\");\nname1.age = 27;\nname2.age = 26;\nconsole.log(name1.age) //undefined\nconsole.log(name2.age) // 26\nconsole.log(typeOf name1) //string\nconsole.log(typeOf name2) //object\n```\n\n## 引用值\n\n一个值得深思的例子\n\n```javascript\nfunction setName(obj) {\n  obj.name = 'Nicholas'\n  obj = new Object()\n  obj.name = 'Greg'\n  console.log(obj) //Greg\n}\nlet person = new Object()\nsetName(person)\nconsole.log(person.name) //“Nicholas\"\n```\n\n如果 person 是按饮用类型传递的，那么 person 应该自动将指针改为指向 name 为”Greg\"的对象。可是，当我们再次访问 person.name 时，它的值是“Nicholas\",这表明函数中参数的，原始的引用类型仍然没有改变。\n\n当 obj 在函数内部被重写时，它变成了一个指向本地对象的指针。而那个本地对象在函数执行结束时就被销毁\n","source":"_posts/JS基础-ES5.md","raw":"---\ntitle: JS基础(ES5)\ndate: 2018-01-18 10:12:34\ncategories: JavaScript\n---\n\n感觉自己的 ES5 掌握的比较杂乱，在此整理一下自己的思路，总结、归纳原生 JS 的知识。\n\n<!--more-->\n\n## 内置类型\n\nJS 中有 7 种内置类型，7 种内置类型又分为两大类型：基本类型和对象（Object）\n基础基本类型有 6 种：`null`,`undefined`,`boolean`,`number`,`string`,`symbol`。\n\n## `Typeof`\n\n`typeof` 对于基本类型。除了`null`都可以显示正确的类型\n\n```javascript\ntypeof 1 // 'number'\ntypeof '1' // 'string'\ntypeof undefined // 'undefined'\ntypeof true // 'boolean'\ntypeof Symbol() // 'symbol'\ntypeof b // b 没有声明，但是还会显示 undefined\n\n//typeof 对于对象，除了函数都会显示 object\n\ntypeof [] // 'object'\ntypeof {} // 'object'\ntypeof console.log // 'function'\n\ntypeof null // 'object'\n```\n\nPS：为什么会出现这种情况呢？因为在 JS 的最初版本中，使用的是 32 位系统，为了性能考虑使用低位存储了变量的类型信息，000 开头代表是对象，然而 null 表示为全零，所以将它错误的判断为 object 。虽然现在的内部类型判断代码已经改变了，但是对于这个 Bug 却是一直流传下来\n\n```javascript\nlet a\n// 我们也可以这样判断 undefined\na === undefined\n// 但是 undefined 不是保留字，能够在低版本浏览器被赋值\nlet undefined = 1\n// 这样判断就会出错\n// 所以可以用下面的方式来判断，并且代码量更少\n// 因为 void 后面随便跟上一个组成表达式\n// 返回就是 undefined\na === void 0\n```\n\n## 对象\n\n创建对象可以通过对象直接量，关键字 new 和 object.creat() 函数来创建对象。每一个对象都有与知相关的原型，类和可扩展性。可分为普通对象和函数对象。凡是通过 new function() 创建的都是函数对象。其他都是普通对象。\n\n### instanceof\n\ninstanceof 可以正确的判断对象类型，因为内部机制是通过对象的原型链中是不是能找到类型的 prototype\n\n```javascript\nconsole.log([] instanceof Arrage) //true\nconsole.log({} instanceof Object) //true\nconsole.log(function () {} instanceof Function) //true\nconsole.log(1 instanceof NUmber) //true\n```\n\n### 对象直接量\n\n对象直接量是类似于 var a = {x:0,y:0} 的映射表。对象直接量是一个表达式，这个表达式的每次运算都创建并初始化一个新的对象。每次计算对象直接量的时候。也会计算它的每个属性值，**也就是说在一个循环体内使用了对象直接量，他将会创建很对新对象，并且每次创建的对象的属性值也有可能不同。**\n\n### 通过 new 创建对象\n\n1. 新生成了一个对象\n2. 链接到原型\n3. 绑定 this\n4. 返回新对象\n\n在调用`new`的过程中会发生以上四件事情。\n\nvar obj=new MyClass(); new 运算符创建并初始化一个**新对象** 用 new 调用时，this 会指向空的对象，并且这个对象的原型指向 MyClass.prototype\n\n#### new 的过程以及是实现 new\n\n```javascript\nlet obj = {}\nlet con = [].shift.call(arguments)\n```\n\n## 事件委托\n\n利用事件委托技术能让你对特定的每个节点添加事件监听器；相反，事件监听器是被添加到他们的父元素上的。事件监听器会分析从子元素冒泡上来的事件，找到是哪一个子元素的事件。\n\n- event.target 返回触发事件的元素\n- event.currentTarget 返回绑定事件的元素\n\n```html\n<ul id=\"parent-list\">\n  <li id=\"post-1\">Item 1</li>\n  <li id=\"post-2\">Item 2</li>\n  <li id=\"post-3\">Item 3</li>\n  <li id=\"post-4\">Item 4</li>\n  <li id=\"post-5\">Item 5</li>\n  <li id=\"post-6\">Item 6</li>\n</ul>\n<script>\n  document\n    .getElementById('parent-list')\n    .addEventListener('click', function (e) {\n      // e.target是被点击的元素!\n      // 如果被点击的是li元素\n      if (e.target && e.target.nodeName == 'LI') {\n        // 找到目标，输出ID!\n        console.log('List item ', e.target.id.replace('post-'), ' was clicked!')\n      }\n\n      $('li').click(function () {\n        $(this).css('background', '#D4DFE6')\n      })\n\n      // jQuery的delegate写法\n      $('#wrap').delegate('li', 'click', function (ev) {\n        // this 指向委托的对象 li\n        $(this).css('background', '#D4DFE6')\n\n        // 找到父级 ul#wrap\n        $(ev.delegateTarget).css('border', '2px solid #f00')\n      })\n    })\n</script>\n```\n\n## `getComputedStyle()`\n\n`getComputedStyle`是一个可以获取当前元素所有最终使用 css 属性值。返回一个 css 样式声明对象([object CSSStyleDeclaration])，只读。之前偶尔有一次要更改伪类元素 ::after 的样式\n\n```javascript\nvar dom = document.getElementById('test'),\n  style = window.getComputedStyle(dom, ':after')\n```\n\n### `getComputedStyle`与`style`的区别\n\n- `getComputedStyle`方法是只读的，只能获取样式，不能设置；而`element.style`能读能写。\n- 获取对象范围\n  `getComputedStyle`方法获取的是最终应用在元素上的所有 css 属性对象；而`element.style`只能获取元素`style`中的 css 样式。因此对于一个光秃秃的元素`<p>`，`getComputedStyle`方法返回对象中的 length 属性值就有 190+,而`element.style`就是 0。\n\n### `getPropertyValue`方法\n\n`getPropertyValue`方法可以获取 CSS 样式申明对象上的属性值（直接属性名称），例如：\n\n```javascript\nwindow.getComputedStyle(element, null).getPropertyValue('float')\n```\n\n## `this`\n\n\\*\\* `this`要在执行的时候才能确定值，定义时是无法确认，因为 js 不是编译型语言而是解释型语言\n\n说明 this 几种不同的使用方式\n\n- 作为构造函数执行\n- 作为对象属性执行\n- 作为普通函数执行\n- `call`,`applay`,`bind`\n\n```javascript\nvar a = {\n  name: A,\n  fn: function () {\n    console.log(this.name)\n  },\n}\na.fn() //this===a\na.fn({ name: 'b' }) //this==={name:'b'}\nvar fn1 = a.fn\nfn1() //this===window\n```\n\n---\n\n## 深浅拷贝\n\n### 浅拷贝\n\n浅拷贝之解决了第一层的问题，如果接下去的值中还有对象的话，那么就又会出现值引用，改变值会互相影响\n\n- 首先可以通过`Object.assign`来解决这个问题。\n\n  ```javascript\n  let a = {\n    age: 1,\n  }\n  let b = Object.assign({}, a)\n  a.age = 2\n  console.log(b.age)\n  ```\n\n- 当然也可以通过展开运算符（···）来解决\n  ```javascript\n  let a = {\n    age: 1,\n  }\n  let b = { ...a }\n  a.age = 2\n  console.log(b.age) //1\n  ```\n\n### 深拷贝\n\n这个问题可以通过`JSON.parse(JSON.stringfy(object))`来解决。\n\n但是该方法也是有局限性的：\n\n- 会忽略 `undefined`\n- 会忽略`symbol`\n- 不能序列化函数\n- 不能解决循环引用对象\n\n```javascript\nlet obj = {\n  a: 1,\n  b: {\n    c: 2,\n    d: 3,\n  },\n}\nobj.c = obj.b\nobj.e = obj.a\nobj.b.c = obj.c\nobj.b.e = obj.b.c\nlet newObj = JSON.parse(JSON.stringfy(obj))\nconsole.log(newObj) //会报错\n```\n\n```javascript\nlet a = {\n  age: undefined,\n  sex: Symbol('male'),\n  jobs: function () {},\n  name: 'yck',\n}\n\nlet b = JSON.parse(JSON.stringfy(a))\nconsole.log(b) //{name:'yck'}\n```\n\n## `Map`、`FlatMap`、`Reduce`\n\n`Map`作用是生成一个新数组，遍历原数组，将每一个元素拿出来做一些变换然后`append`到新的数组中。\n\n```javascript\n;[1, 2, 3].map((v) => v + 1) //=>[2,3,4]\n```\n\n`Map`有三个参数，分别是当前索引元素，索引，原数组\n\n```javascript\n;['1', '2', '3'].map(parseInt)\n//  parseInt('1', 0) -> 1\n//  parseInt('2', 1) -> NaN\n//  parseInt('3', 2) -> NaN\n```\n\n## NaN\n\n```javascript\nNaN !== NaN //true\nNaN.valueOf() //NaN\nNaN.toString() //'NaN\nNaN < 3 //false\nNaN >= 3 //false\nNaN < NaN //false\nNaN >= NaN //false\n```\n\n## 标签语句\n\n相当于定位符，用于跳转到程序的任意位置。标签通常与 break 语句和 continue 语句配合使用，跳出特定的循环。\n\n```javascript\ntop: for (var i = 0; i < 3; i++) {\n  for (var j = 0; j < 3; j++) {\n    if (i === 1 && j === 1) break top\n    console.log('i=' + i + ', j=' + j)\n  }\n}\n```\n\nbreak 命令后加上 top 标签，满足条件时，直接跳出双层循环。如果 break 语句后面不适用标签，则纸条出内层循环，进入下一次外层循环。\n\ncontinue 语句也可以配合使用\n\n```javascript\ntop: for (var i = 0; i < 3; i++) {\n  for (var j = 0; j < 3; j++) {\n    if (i === 1 && j === 1) continue top\n    console.log('i=' + i + ', j=' + j)\n  }\n}\n// i=0, j=0\n// i=0, j=1\n// i=0, j=2\n// i=1, j=0\n// i=2, j=0\n// i=2, j=1\n// i=2, j=2\n```\n\n满足条件时，会跳过当前循环，直接进入到下一论外层循环。如果 continue 语句后面不使用标签，则只能进入下一轮内层循环。\n\n## with\n\nwith 语句用途是将代码作用于设置为特定对象，使用例子是：\n\n```javascript\nwith(location{\n  let qs = search.substring(1)\n  let hostName = hostname\n  let url = href\n})\n```\n\n使用 with 代替频繁使用的 location 对象，这意味着在这个语句内部，每个变量首先会被认为是一个局部变量，如果没有找到该局部变量，则会搜索 location 对象，看它是否是有一个同名属性。如果有，则该苏醒会被求值成 location 对象属性\n\n由于 with 语句影响性能且难以调试其中代码,通常不推荐在代码中使用\n\n## 原始数据类型\n\nECMScript 变量可以包含两种不同类型的数据：原始值和引用值。原始值就是最简单的数据，引用值是由多个值构成的对象。\n\n**6 种引用值**：Undefined、Null、Boolean、Number、String 和 Symbol，typeOf 操作符最适合用来判断是否是原始类型，但是如果值是对象或是 null，那么 typeof 返回 Object\n\n保存原始值的变量是**按值**访问的，因为我们操作的就是存储在变量中的实际值\n\n注意，原始类型的初始化可以只使用原始字面量形式。如果使用的是 new 关键字，则 JavaScript 会创建一个 Object 类型的实例，但其行为类似原始值。下面来看看这两种初始化方式的差异：\n\n```javascript\nlet name1 = \"Nicholas\";\nlet name2 = new String(\"Matt\");\nname1.age = 27;\nname2.age = 26;\nconsole.log(name1.age) //undefined\nconsole.log(name2.age) // 26\nconsole.log(typeOf name1) //string\nconsole.log(typeOf name2) //object\n```\n\n## 引用值\n\n一个值得深思的例子\n\n```javascript\nfunction setName(obj) {\n  obj.name = 'Nicholas'\n  obj = new Object()\n  obj.name = 'Greg'\n  console.log(obj) //Greg\n}\nlet person = new Object()\nsetName(person)\nconsole.log(person.name) //“Nicholas\"\n```\n\n如果 person 是按饮用类型传递的，那么 person 应该自动将指针改为指向 name 为”Greg\"的对象。可是，当我们再次访问 person.name 时，它的值是“Nicholas\",这表明函数中参数的，原始的引用类型仍然没有改变。\n\n当 obj 在函数内部被重写时，它变成了一个指向本地对象的指针。而那个本地对象在函数执行结束时就被销毁\n","slug":"JS基础-ES5","published":1,"updated":"2021-04-07T12:40:24.792Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wj000dl5v03mt50irq","content":"<p>感觉自己的 ES5 掌握的比较杂乱，在此整理一下自己的思路，总结、归纳原生 JS 的知识。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"内置类型\"><a href=\"#内置类型\" class=\"headerlink\" title=\"内置类型\"></a>内置类型</h2><p>JS 中有 7 种内置类型，7 种内置类型又分为两大类型：基本类型和对象（Object）<br>基础基本类型有 6 种：<code>null</code>,<code>undefined</code>,<code>boolean</code>,<code>number</code>,<code>string</code>,<code>symbol</code>。</p>\n<h2 id=\"Typeof\"><a href=\"#Typeof\" class=\"headerlink\" title=\"Typeof\"></a><code>Typeof</code></h2><p><code>typeof</code> 对于基本类型。除了<code>null</code>都可以显示正确的类型</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">1</span> <span class=\"comment\">// &#x27;number&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"comment\">// &#x27;string&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">undefined</span> <span class=\"comment\">// &#x27;undefined&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">true</span> <span class=\"comment\">// &#x27;boolean&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"built_in\">Symbol</span>() <span class=\"comment\">// &#x27;symbol&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> b <span class=\"comment\">// b 没有声明，但是还会显示 undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//typeof 对于对象，除了函数都会显示 object</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> [] <span class=\"comment\">// &#x27;object&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> &#123;&#125; <span class=\"comment\">// &#x27;object&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"built_in\">console</span>.log <span class=\"comment\">// &#x27;function&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">null</span> <span class=\"comment\">// &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>PS：为什么会出现这种情况呢？因为在 JS 的最初版本中，使用的是 32 位系统，为了性能考虑使用低位存储了变量的类型信息，000 开头代表是对象，然而 null 表示为全零，所以将它错误的判断为 object 。虽然现在的内部类型判断代码已经改变了，但是对于这个 Bug 却是一直流传下来</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a</span><br><span class=\"line\"><span class=\"comment\">// 我们也可以这样判断 undefined</span></span><br><span class=\"line\">a === <span class=\"literal\">undefined</span></span><br><span class=\"line\"><span class=\"comment\">// 但是 undefined 不是保留字，能够在低版本浏览器被赋值</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"literal\">undefined</span> = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"comment\">// 这样判断就会出错</span></span><br><span class=\"line\"><span class=\"comment\">// 所以可以用下面的方式来判断，并且代码量更少</span></span><br><span class=\"line\"><span class=\"comment\">// 因为 void 后面随便跟上一个组成表达式</span></span><br><span class=\"line\"><span class=\"comment\">// 返回就是 undefined</span></span><br><span class=\"line\">a === <span class=\"keyword\">void</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"对象\"><a href=\"#对象\" class=\"headerlink\" title=\"对象\"></a>对象</h2><p>创建对象可以通过对象直接量，关键字 new 和 object.creat() 函数来创建对象。每一个对象都有与知相关的原型，类和可扩展性。可分为普通对象和函数对象。凡是通过 new function() 创建的都是函数对象。其他都是普通对象。</p>\n<h3 id=\"instanceof\"><a href=\"#instanceof\" class=\"headerlink\" title=\"instanceof\"></a>instanceof</h3><p>instanceof 可以正确的判断对象类型，因为内部机制是通过对象的原型链中是不是能找到类型的 prototype</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log([] <span class=\"keyword\">instanceof</span> Arrage) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(&#123;&#125; <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125; <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Function</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span> <span class=\"keyword\">instanceof</span> NUmber) <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对象直接量\"><a href=\"#对象直接量\" class=\"headerlink\" title=\"对象直接量\"></a>对象直接量</h3><p>对象直接量是类似于 var a = {x:0,y:0} 的映射表。对象直接量是一个表达式，这个表达式的每次运算都创建并初始化一个新的对象。每次计算对象直接量的时候。也会计算它的每个属性值，<strong>也就是说在一个循环体内使用了对象直接量，他将会创建很对新对象，并且每次创建的对象的属性值也有可能不同。</strong></p>\n<h3 id=\"通过-new-创建对象\"><a href=\"#通过-new-创建对象\" class=\"headerlink\" title=\"通过 new 创建对象\"></a>通过 new 创建对象</h3><ol>\n<li>新生成了一个对象</li>\n<li>链接到原型</li>\n<li>绑定 this</li>\n<li>返回新对象</li>\n</ol>\n<p>在调用<code>new</code>的过程中会发生以上四件事情。</p>\n<p>var obj=new MyClass(); new 运算符创建并初始化一个<strong>新对象</strong> 用 new 调用时，this 会指向空的对象，并且这个对象的原型指向 MyClass.prototype</p>\n<h4 id=\"new-的过程以及是实现-new\"><a href=\"#new-的过程以及是实现-new\" class=\"headerlink\" title=\"new 的过程以及是实现 new\"></a>new 的过程以及是实现 new</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> con = [].shift.call(<span class=\"built_in\">arguments</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"事件委托\"><a href=\"#事件委托\" class=\"headerlink\" title=\"事件委托\"></a>事件委托</h2><p>利用事件委托技术能让你对特定的每个节点添加事件监听器；相反，事件监听器是被添加到他们的父元素上的。事件监听器会分析从子元素冒泡上来的事件，找到是哪一个子元素的事件。</p>\n<ul>\n<li>event.target 返回触发事件的元素</li>\n<li>event.currentTarget 返回绑定事件的元素</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;parent-list&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-1&quot;</span>&gt;</span>Item 1<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-2&quot;</span>&gt;</span>Item 2<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-3&quot;</span>&gt;</span>Item 3<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-4&quot;</span>&gt;</span>Item 4<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-5&quot;</span>&gt;</span>Item 5<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-6&quot;</span>&gt;</span>Item 6<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"built_in\">document</span></span></span><br><span class=\"line\"><span class=\"javascript\">    .getElementById(<span class=\"string\">&#x27;parent-list&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">    .addEventListener(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// e.target是被点击的元素!</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// 如果被点击的是li元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">if</span> (e.target &amp;&amp; e.target.nodeName == <span class=\"string\">&#x27;LI&#x27;</span>) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// 找到目标，输出ID!</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;List item &#x27;</span>, e.target.id.replace(<span class=\"string\">&#x27;post-&#x27;</span>), <span class=\"string\">&#x27; was clicked!&#x27;</span>)</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">      $(<span class=\"string\">&#x27;li&#x27;</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        $(<span class=\"built_in\">this</span>).css(<span class=\"string\">&#x27;background&#x27;</span>, <span class=\"string\">&#x27;#D4DFE6&#x27;</span>)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// jQuery的delegate写法</span></span></span><br><span class=\"line\"><span class=\"javascript\">      $(<span class=\"string\">&#x27;#wrap&#x27;</span>).delegate(<span class=\"string\">&#x27;li&#x27;</span>, <span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// this 指向委托的对象 li</span></span></span><br><span class=\"line\"><span class=\"javascript\">        $(<span class=\"built_in\">this</span>).css(<span class=\"string\">&#x27;background&#x27;</span>, <span class=\"string\">&#x27;#D4DFE6&#x27;</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// 找到父级 ul#wrap</span></span></span><br><span class=\"line\"><span class=\"javascript\">        $(ev.delegateTarget).css(<span class=\"string\">&#x27;border&#x27;</span>, <span class=\"string\">&#x27;2px solid #f00&#x27;</span>)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"getComputedStyle\"><a href=\"#getComputedStyle\" class=\"headerlink\" title=\"getComputedStyle()\"></a><code>getComputedStyle()</code></h2><p><code>getComputedStyle</code>是一个可以获取当前元素所有最终使用 css 属性值。返回一个 css 样式声明对象([object CSSStyleDeclaration])，只读。之前偶尔有一次要更改伪类元素 ::after 的样式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> dom = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;test&#x27;</span>),</span><br><span class=\"line\">  style = <span class=\"built_in\">window</span>.getComputedStyle(dom, <span class=\"string\">&#x27;:after&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"getComputedStyle与style的区别\"><a href=\"#getComputedStyle与style的区别\" class=\"headerlink\" title=\"getComputedStyle与style的区别\"></a><code>getComputedStyle</code>与<code>style</code>的区别</h3><ul>\n<li><code>getComputedStyle</code>方法是只读的，只能获取样式，不能设置；而<code>element.style</code>能读能写。</li>\n<li>获取对象范围<br><code>getComputedStyle</code>方法获取的是最终应用在元素上的所有 css 属性对象；而<code>element.style</code>只能获取元素<code>style</code>中的 css 样式。因此对于一个光秃秃的元素<code>&lt;p&gt;</code>，<code>getComputedStyle</code>方法返回对象中的 length 属性值就有 190+,而<code>element.style</code>就是 0。</li>\n</ul>\n<h3 id=\"getPropertyValue方法\"><a href=\"#getPropertyValue方法\" class=\"headerlink\" title=\"getPropertyValue方法\"></a><code>getPropertyValue</code>方法</h3><p><code>getPropertyValue</code>方法可以获取 CSS 样式申明对象上的属性值（直接属性名称），例如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.getComputedStyle(element, <span class=\"literal\">null</span>).getPropertyValue(<span class=\"string\">&#x27;float&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"this\"><a href=\"#this\" class=\"headerlink\" title=\"this\"></a><code>this</code></h2><p>** <code>this</code>要在执行的时候才能确定值，定义时是无法确认，因为 js 不是编译型语言而是解释型语言</p>\n<p>说明 this 几种不同的使用方式</p>\n<ul>\n<li>作为构造函数执行</li>\n<li>作为对象属性执行</li>\n<li>作为普通函数执行</li>\n<li><code>call</code>,<code>applay</code>,<code>bind</code></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  name: A,</span><br><span class=\"line\">  fn: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a.fn() <span class=\"comment\">//this===a</span></span><br><span class=\"line\">a.fn(&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;b&#x27;</span> &#125;) <span class=\"comment\">//this===&#123;name:&#x27;b&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fn1 = a.fn</span><br><span class=\"line\">fn1() <span class=\"comment\">//this===window</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"深浅拷贝\"><a href=\"#深浅拷贝\" class=\"headerlink\" title=\"深浅拷贝\"></a>深浅拷贝</h2><h3 id=\"浅拷贝\"><a href=\"#浅拷贝\" class=\"headerlink\" title=\"浅拷贝\"></a>浅拷贝</h3><p>浅拷贝之解决了第一层的问题，如果接下去的值中还有对象的话，那么就又会出现值引用，改变值会互相影响</p>\n<ul>\n<li><p>首先可以通过<code>Object.assign</code>来解决这个问题。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123;</span><br><span class=\"line\">  age: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> b = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, a)</span><br><span class=\"line\">a.age = <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.age)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>当然也可以通过展开运算符（···）来解决</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123;</span><br><span class=\"line\">  age: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> b = &#123; ...a &#125;</span><br><span class=\"line\">a.age = <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.age) <span class=\"comment\">//1</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"深拷贝\"><a href=\"#深拷贝\" class=\"headerlink\" title=\"深拷贝\"></a>深拷贝</h3><p>这个问题可以通过<code>JSON.parse(JSON.stringfy(object))</code>来解决。</p>\n<p>但是该方法也是有局限性的：</p>\n<ul>\n<li>会忽略 <code>undefined</code></li>\n<li>会忽略<code>symbol</code></li>\n<li>不能序列化函数</li>\n<li>不能解决循环引用对象</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">1</span>,</span><br><span class=\"line\">  b: &#123;</span><br><span class=\"line\">    c: <span class=\"number\">2</span>,</span><br><span class=\"line\">    d: <span class=\"number\">3</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.c = obj.b</span><br><span class=\"line\">obj.e = obj.a</span><br><span class=\"line\">obj.b.c = obj.c</span><br><span class=\"line\">obj.b.e = obj.b.c</span><br><span class=\"line\"><span class=\"keyword\">let</span> newObj = <span class=\"built_in\">JSON</span>.parse(<span class=\"built_in\">JSON</span>.stringfy(obj))</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newObj) <span class=\"comment\">//会报错</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123;</span><br><span class=\"line\">  age: <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">  sex: <span class=\"built_in\">Symbol</span>(<span class=\"string\">&#x27;male&#x27;</span>),</span><br><span class=\"line\">  jobs: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;,</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;yck&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> b = <span class=\"built_in\">JSON</span>.parse(<span class=\"built_in\">JSON</span>.stringfy(a))</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b) <span class=\"comment\">//&#123;name:&#x27;yck&#x27;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Map、FlatMap、Reduce\"><a href=\"#Map、FlatMap、Reduce\" class=\"headerlink\" title=\"Map、FlatMap、Reduce\"></a><code>Map</code>、<code>FlatMap</code>、<code>Reduce</code></h2><p><code>Map</code>作用是生成一个新数组，遍历原数组，将每一个元素拿出来做一些变换然后<code>append</code>到新的数组中。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>].map(<span class=\"function\">(<span class=\"params\">v</span>) =&gt;</span> v + <span class=\"number\">1</span>) <span class=\"comment\">//=&gt;[2,3,4]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>Map</code>有三个参数，分别是当前索引元素，索引，原数组</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;[<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>].map(<span class=\"built_in\">parseInt</span>)</span><br><span class=\"line\"><span class=\"comment\">//  parseInt(&#x27;1&#x27;, 0) -&gt; 1</span></span><br><span class=\"line\"><span class=\"comment\">//  parseInt(&#x27;2&#x27;, 1) -&gt; NaN</span></span><br><span class=\"line\"><span class=\"comment\">//  parseInt(&#x27;3&#x27;, 2) -&gt; NaN</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"NaN\"><a href=\"#NaN\" class=\"headerlink\" title=\"NaN\"></a>NaN</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">NaN</span> !== <span class=\"literal\">NaN</span> <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span>.valueOf() <span class=\"comment\">//NaN</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span>.toString() <span class=\"comment\">//&#x27;NaN</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span> &lt; <span class=\"number\">3</span> <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span> &gt;= <span class=\"number\">3</span> <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span> &lt; <span class=\"literal\">NaN</span> <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span> &gt;= <span class=\"literal\">NaN</span> <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"标签语句\"><a href=\"#标签语句\" class=\"headerlink\" title=\"标签语句\"></a>标签语句</h2><p>相当于定位符，用于跳转到程序的任意位置。标签通常与 break 语句和 continue 语句配合使用，跳出特定的循环。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top: <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">3</span>; j++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === <span class=\"number\">1</span> &amp;&amp; j === <span class=\"number\">1</span>) <span class=\"keyword\">break</span> top</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;i=&#x27;</span> + i + <span class=\"string\">&#x27;, j=&#x27;</span> + j)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>break 命令后加上 top 标签，满足条件时，直接跳出双层循环。如果 break 语句后面不适用标签，则纸条出内层循环，进入下一次外层循环。</p>\n<p>continue 语句也可以配合使用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top: <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">3</span>; j++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === <span class=\"number\">1</span> &amp;&amp; j === <span class=\"number\">1</span>) <span class=\"keyword\">continue</span> top</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;i=&#x27;</span> + i + <span class=\"string\">&#x27;, j=&#x27;</span> + j)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// i=0, j=0</span></span><br><span class=\"line\"><span class=\"comment\">// i=0, j=1</span></span><br><span class=\"line\"><span class=\"comment\">// i=0, j=2</span></span><br><span class=\"line\"><span class=\"comment\">// i=1, j=0</span></span><br><span class=\"line\"><span class=\"comment\">// i=2, j=0</span></span><br><span class=\"line\"><span class=\"comment\">// i=2, j=1</span></span><br><span class=\"line\"><span class=\"comment\">// i=2, j=2</span></span><br></pre></td></tr></table></figure>\n\n<p>满足条件时，会跳过当前循环，直接进入到下一论外层循环。如果 continue 语句后面不使用标签，则只能进入下一轮内层循环。</p>\n<h2 id=\"with\"><a href=\"#with\" class=\"headerlink\" title=\"with\"></a>with</h2><p>with 语句用途是将代码作用于设置为特定对象，使用例子是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span>(location&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> qs = search.substring(<span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> hostName = hostname</span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = href</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>使用 with 代替频繁使用的 location 对象，这意味着在这个语句内部，每个变量首先会被认为是一个局部变量，如果没有找到该局部变量，则会搜索 location 对象，看它是否是有一个同名属性。如果有，则该苏醒会被求值成 location 对象属性</p>\n<p>由于 with 语句影响性能且难以调试其中代码,通常不推荐在代码中使用</p>\n<h2 id=\"原始数据类型\"><a href=\"#原始数据类型\" class=\"headerlink\" title=\"原始数据类型\"></a>原始数据类型</h2><p>ECMScript 变量可以包含两种不同类型的数据：原始值和引用值。原始值就是最简单的数据，引用值是由多个值构成的对象。</p>\n<p><strong>6 种引用值</strong>：Undefined、Null、Boolean、Number、String 和 Symbol，typeOf 操作符最适合用来判断是否是原始类型，但是如果值是对象或是 null，那么 typeof 返回 Object</p>\n<p>保存原始值的变量是<strong>按值</strong>访问的，因为我们操作的就是存储在变量中的实际值</p>\n<p>注意，原始类型的初始化可以只使用原始字面量形式。如果使用的是 new 关键字，则 JavaScript 会创建一个 Object 类型的实例，但其行为类似原始值。下面来看看这两种初始化方式的差异：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> name1 = <span class=\"string\">&quot;Nicholas&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> name2 = <span class=\"keyword\">new</span> <span class=\"built_in\">String</span>(<span class=\"string\">&quot;Matt&quot;</span>);</span><br><span class=\"line\">name1.age = <span class=\"number\">27</span>;</span><br><span class=\"line\">name2.age = <span class=\"number\">26</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(name1.age) <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(name2.age) <span class=\"comment\">// 26</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(typeOf name1) <span class=\"comment\">//string</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(typeOf name2) <span class=\"comment\">//object</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"引用值\"><a href=\"#引用值\" class=\"headerlink\" title=\"引用值\"></a>引用值</h2><p>一个值得深思的例子</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setName</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  obj.name = <span class=\"string\">&#x27;Nicholas&#x27;</span></span><br><span class=\"line\">  obj = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>()</span><br><span class=\"line\">  obj.name = <span class=\"string\">&#x27;Greg&#x27;</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(obj) <span class=\"comment\">//Greg</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> person = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>()</span><br><span class=\"line\">setName(person)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.name) <span class=\"comment\">//“Nicholas&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果 person 是按饮用类型传递的，那么 person 应该自动将指针改为指向 name 为”Greg”的对象。可是，当我们再次访问 person.name 时，它的值是“Nicholas”,这表明函数中参数的，原始的引用类型仍然没有改变。</p>\n<p>当 obj 在函数内部被重写时，它变成了一个指向本地对象的指针。而那个本地对象在函数执行结束时就被销毁</p>\n","site":{"data":{}},"excerpt":"<p>感觉自己的 ES5 掌握的比较杂乱，在此整理一下自己的思路，总结、归纳原生 JS 的知识。</p>","more":"<h2 id=\"内置类型\"><a href=\"#内置类型\" class=\"headerlink\" title=\"内置类型\"></a>内置类型</h2><p>JS 中有 7 种内置类型，7 种内置类型又分为两大类型：基本类型和对象（Object）<br>基础基本类型有 6 种：<code>null</code>,<code>undefined</code>,<code>boolean</code>,<code>number</code>,<code>string</code>,<code>symbol</code>。</p>\n<h2 id=\"Typeof\"><a href=\"#Typeof\" class=\"headerlink\" title=\"Typeof\"></a><code>Typeof</code></h2><p><code>typeof</code> 对于基本类型。除了<code>null</code>都可以显示正确的类型</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">1</span> <span class=\"comment\">// &#x27;number&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"comment\">// &#x27;string&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">undefined</span> <span class=\"comment\">// &#x27;undefined&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">true</span> <span class=\"comment\">// &#x27;boolean&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"built_in\">Symbol</span>() <span class=\"comment\">// &#x27;symbol&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> b <span class=\"comment\">// b 没有声明，但是还会显示 undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//typeof 对于对象，除了函数都会显示 object</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> [] <span class=\"comment\">// &#x27;object&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> &#123;&#125; <span class=\"comment\">// &#x27;object&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"built_in\">console</span>.log <span class=\"comment\">// &#x27;function&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">null</span> <span class=\"comment\">// &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>PS：为什么会出现这种情况呢？因为在 JS 的最初版本中，使用的是 32 位系统，为了性能考虑使用低位存储了变量的类型信息，000 开头代表是对象，然而 null 表示为全零，所以将它错误的判断为 object 。虽然现在的内部类型判断代码已经改变了，但是对于这个 Bug 却是一直流传下来</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a</span><br><span class=\"line\"><span class=\"comment\">// 我们也可以这样判断 undefined</span></span><br><span class=\"line\">a === <span class=\"literal\">undefined</span></span><br><span class=\"line\"><span class=\"comment\">// 但是 undefined 不是保留字，能够在低版本浏览器被赋值</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"literal\">undefined</span> = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"comment\">// 这样判断就会出错</span></span><br><span class=\"line\"><span class=\"comment\">// 所以可以用下面的方式来判断，并且代码量更少</span></span><br><span class=\"line\"><span class=\"comment\">// 因为 void 后面随便跟上一个组成表达式</span></span><br><span class=\"line\"><span class=\"comment\">// 返回就是 undefined</span></span><br><span class=\"line\">a === <span class=\"keyword\">void</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"对象\"><a href=\"#对象\" class=\"headerlink\" title=\"对象\"></a>对象</h2><p>创建对象可以通过对象直接量，关键字 new 和 object.creat() 函数来创建对象。每一个对象都有与知相关的原型，类和可扩展性。可分为普通对象和函数对象。凡是通过 new function() 创建的都是函数对象。其他都是普通对象。</p>\n<h3 id=\"instanceof\"><a href=\"#instanceof\" class=\"headerlink\" title=\"instanceof\"></a>instanceof</h3><p>instanceof 可以正确的判断对象类型，因为内部机制是通过对象的原型链中是不是能找到类型的 prototype</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log([] <span class=\"keyword\">instanceof</span> Arrage) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(&#123;&#125; <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125; <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Function</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span> <span class=\"keyword\">instanceof</span> NUmber) <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对象直接量\"><a href=\"#对象直接量\" class=\"headerlink\" title=\"对象直接量\"></a>对象直接量</h3><p>对象直接量是类似于 var a = {x:0,y:0} 的映射表。对象直接量是一个表达式，这个表达式的每次运算都创建并初始化一个新的对象。每次计算对象直接量的时候。也会计算它的每个属性值，<strong>也就是说在一个循环体内使用了对象直接量，他将会创建很对新对象，并且每次创建的对象的属性值也有可能不同。</strong></p>\n<h3 id=\"通过-new-创建对象\"><a href=\"#通过-new-创建对象\" class=\"headerlink\" title=\"通过 new 创建对象\"></a>通过 new 创建对象</h3><ol>\n<li>新生成了一个对象</li>\n<li>链接到原型</li>\n<li>绑定 this</li>\n<li>返回新对象</li>\n</ol>\n<p>在调用<code>new</code>的过程中会发生以上四件事情。</p>\n<p>var obj=new MyClass(); new 运算符创建并初始化一个<strong>新对象</strong> 用 new 调用时，this 会指向空的对象，并且这个对象的原型指向 MyClass.prototype</p>\n<h4 id=\"new-的过程以及是实现-new\"><a href=\"#new-的过程以及是实现-new\" class=\"headerlink\" title=\"new 的过程以及是实现 new\"></a>new 的过程以及是实现 new</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> con = [].shift.call(<span class=\"built_in\">arguments</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"事件委托\"><a href=\"#事件委托\" class=\"headerlink\" title=\"事件委托\"></a>事件委托</h2><p>利用事件委托技术能让你对特定的每个节点添加事件监听器；相反，事件监听器是被添加到他们的父元素上的。事件监听器会分析从子元素冒泡上来的事件，找到是哪一个子元素的事件。</p>\n<ul>\n<li>event.target 返回触发事件的元素</li>\n<li>event.currentTarget 返回绑定事件的元素</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;parent-list&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-1&quot;</span>&gt;</span>Item 1<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-2&quot;</span>&gt;</span>Item 2<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-3&quot;</span>&gt;</span>Item 3<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-4&quot;</span>&gt;</span>Item 4<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-5&quot;</span>&gt;</span>Item 5<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;post-6&quot;</span>&gt;</span>Item 6<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"built_in\">document</span></span></span><br><span class=\"line\"><span class=\"javascript\">    .getElementById(<span class=\"string\">&#x27;parent-list&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">    .addEventListener(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// e.target是被点击的元素!</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// 如果被点击的是li元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">if</span> (e.target &amp;&amp; e.target.nodeName == <span class=\"string\">&#x27;LI&#x27;</span>) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// 找到目标，输出ID!</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;List item &#x27;</span>, e.target.id.replace(<span class=\"string\">&#x27;post-&#x27;</span>), <span class=\"string\">&#x27; was clicked!&#x27;</span>)</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">      $(<span class=\"string\">&#x27;li&#x27;</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        $(<span class=\"built_in\">this</span>).css(<span class=\"string\">&#x27;background&#x27;</span>, <span class=\"string\">&#x27;#D4DFE6&#x27;</span>)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// jQuery的delegate写法</span></span></span><br><span class=\"line\"><span class=\"javascript\">      $(<span class=\"string\">&#x27;#wrap&#x27;</span>).delegate(<span class=\"string\">&#x27;li&#x27;</span>, <span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// this 指向委托的对象 li</span></span></span><br><span class=\"line\"><span class=\"javascript\">        $(<span class=\"built_in\">this</span>).css(<span class=\"string\">&#x27;background&#x27;</span>, <span class=\"string\">&#x27;#D4DFE6&#x27;</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// 找到父级 ul#wrap</span></span></span><br><span class=\"line\"><span class=\"javascript\">        $(ev.delegateTarget).css(<span class=\"string\">&#x27;border&#x27;</span>, <span class=\"string\">&#x27;2px solid #f00&#x27;</span>)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"getComputedStyle\"><a href=\"#getComputedStyle\" class=\"headerlink\" title=\"getComputedStyle()\"></a><code>getComputedStyle()</code></h2><p><code>getComputedStyle</code>是一个可以获取当前元素所有最终使用 css 属性值。返回一个 css 样式声明对象([object CSSStyleDeclaration])，只读。之前偶尔有一次要更改伪类元素 ::after 的样式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> dom = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;test&#x27;</span>),</span><br><span class=\"line\">  style = <span class=\"built_in\">window</span>.getComputedStyle(dom, <span class=\"string\">&#x27;:after&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"getComputedStyle与style的区别\"><a href=\"#getComputedStyle与style的区别\" class=\"headerlink\" title=\"getComputedStyle与style的区别\"></a><code>getComputedStyle</code>与<code>style</code>的区别</h3><ul>\n<li><code>getComputedStyle</code>方法是只读的，只能获取样式，不能设置；而<code>element.style</code>能读能写。</li>\n<li>获取对象范围<br><code>getComputedStyle</code>方法获取的是最终应用在元素上的所有 css 属性对象；而<code>element.style</code>只能获取元素<code>style</code>中的 css 样式。因此对于一个光秃秃的元素<code>&lt;p&gt;</code>，<code>getComputedStyle</code>方法返回对象中的 length 属性值就有 190+,而<code>element.style</code>就是 0。</li>\n</ul>\n<h3 id=\"getPropertyValue方法\"><a href=\"#getPropertyValue方法\" class=\"headerlink\" title=\"getPropertyValue方法\"></a><code>getPropertyValue</code>方法</h3><p><code>getPropertyValue</code>方法可以获取 CSS 样式申明对象上的属性值（直接属性名称），例如：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.getComputedStyle(element, <span class=\"literal\">null</span>).getPropertyValue(<span class=\"string\">&#x27;float&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"this\"><a href=\"#this\" class=\"headerlink\" title=\"this\"></a><code>this</code></h2><p>** <code>this</code>要在执行的时候才能确定值，定义时是无法确认，因为 js 不是编译型语言而是解释型语言</p>\n<p>说明 this 几种不同的使用方式</p>\n<ul>\n<li>作为构造函数执行</li>\n<li>作为对象属性执行</li>\n<li>作为普通函数执行</li>\n<li><code>call</code>,<code>applay</code>,<code>bind</code></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  name: A,</span><br><span class=\"line\">  fn: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a.fn() <span class=\"comment\">//this===a</span></span><br><span class=\"line\">a.fn(&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;b&#x27;</span> &#125;) <span class=\"comment\">//this===&#123;name:&#x27;b&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fn1 = a.fn</span><br><span class=\"line\">fn1() <span class=\"comment\">//this===window</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"深浅拷贝\"><a href=\"#深浅拷贝\" class=\"headerlink\" title=\"深浅拷贝\"></a>深浅拷贝</h2><h3 id=\"浅拷贝\"><a href=\"#浅拷贝\" class=\"headerlink\" title=\"浅拷贝\"></a>浅拷贝</h3><p>浅拷贝之解决了第一层的问题，如果接下去的值中还有对象的话，那么就又会出现值引用，改变值会互相影响</p>\n<ul>\n<li><p>首先可以通过<code>Object.assign</code>来解决这个问题。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123;</span><br><span class=\"line\">  age: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> b = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, a)</span><br><span class=\"line\">a.age = <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.age)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>当然也可以通过展开运算符（···）来解决</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123;</span><br><span class=\"line\">  age: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> b = &#123; ...a &#125;</span><br><span class=\"line\">a.age = <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.age) <span class=\"comment\">//1</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"深拷贝\"><a href=\"#深拷贝\" class=\"headerlink\" title=\"深拷贝\"></a>深拷贝</h3><p>这个问题可以通过<code>JSON.parse(JSON.stringfy(object))</code>来解决。</p>\n<p>但是该方法也是有局限性的：</p>\n<ul>\n<li>会忽略 <code>undefined</code></li>\n<li>会忽略<code>symbol</code></li>\n<li>不能序列化函数</li>\n<li>不能解决循环引用对象</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">1</span>,</span><br><span class=\"line\">  b: &#123;</span><br><span class=\"line\">    c: <span class=\"number\">2</span>,</span><br><span class=\"line\">    d: <span class=\"number\">3</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.c = obj.b</span><br><span class=\"line\">obj.e = obj.a</span><br><span class=\"line\">obj.b.c = obj.c</span><br><span class=\"line\">obj.b.e = obj.b.c</span><br><span class=\"line\"><span class=\"keyword\">let</span> newObj = <span class=\"built_in\">JSON</span>.parse(<span class=\"built_in\">JSON</span>.stringfy(obj))</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newObj) <span class=\"comment\">//会报错</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123;</span><br><span class=\"line\">  age: <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">  sex: <span class=\"built_in\">Symbol</span>(<span class=\"string\">&#x27;male&#x27;</span>),</span><br><span class=\"line\">  jobs: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;,</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;yck&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> b = <span class=\"built_in\">JSON</span>.parse(<span class=\"built_in\">JSON</span>.stringfy(a))</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b) <span class=\"comment\">//&#123;name:&#x27;yck&#x27;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Map、FlatMap、Reduce\"><a href=\"#Map、FlatMap、Reduce\" class=\"headerlink\" title=\"Map、FlatMap、Reduce\"></a><code>Map</code>、<code>FlatMap</code>、<code>Reduce</code></h2><p><code>Map</code>作用是生成一个新数组，遍历原数组，将每一个元素拿出来做一些变换然后<code>append</code>到新的数组中。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>].map(<span class=\"function\">(<span class=\"params\">v</span>) =&gt;</span> v + <span class=\"number\">1</span>) <span class=\"comment\">//=&gt;[2,3,4]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>Map</code>有三个参数，分别是当前索引元素，索引，原数组</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;[<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>].map(<span class=\"built_in\">parseInt</span>)</span><br><span class=\"line\"><span class=\"comment\">//  parseInt(&#x27;1&#x27;, 0) -&gt; 1</span></span><br><span class=\"line\"><span class=\"comment\">//  parseInt(&#x27;2&#x27;, 1) -&gt; NaN</span></span><br><span class=\"line\"><span class=\"comment\">//  parseInt(&#x27;3&#x27;, 2) -&gt; NaN</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"NaN\"><a href=\"#NaN\" class=\"headerlink\" title=\"NaN\"></a>NaN</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">NaN</span> !== <span class=\"literal\">NaN</span> <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span>.valueOf() <span class=\"comment\">//NaN</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span>.toString() <span class=\"comment\">//&#x27;NaN</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span> &lt; <span class=\"number\">3</span> <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span> &gt;= <span class=\"number\">3</span> <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span> &lt; <span class=\"literal\">NaN</span> <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"literal\">NaN</span> &gt;= <span class=\"literal\">NaN</span> <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"标签语句\"><a href=\"#标签语句\" class=\"headerlink\" title=\"标签语句\"></a>标签语句</h2><p>相当于定位符，用于跳转到程序的任意位置。标签通常与 break 语句和 continue 语句配合使用，跳出特定的循环。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top: <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">3</span>; j++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === <span class=\"number\">1</span> &amp;&amp; j === <span class=\"number\">1</span>) <span class=\"keyword\">break</span> top</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;i=&#x27;</span> + i + <span class=\"string\">&#x27;, j=&#x27;</span> + j)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>break 命令后加上 top 标签，满足条件时，直接跳出双层循环。如果 break 语句后面不适用标签，则纸条出内层循环，进入下一次外层循环。</p>\n<p>continue 语句也可以配合使用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top: <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">3</span>; j++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === <span class=\"number\">1</span> &amp;&amp; j === <span class=\"number\">1</span>) <span class=\"keyword\">continue</span> top</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;i=&#x27;</span> + i + <span class=\"string\">&#x27;, j=&#x27;</span> + j)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// i=0, j=0</span></span><br><span class=\"line\"><span class=\"comment\">// i=0, j=1</span></span><br><span class=\"line\"><span class=\"comment\">// i=0, j=2</span></span><br><span class=\"line\"><span class=\"comment\">// i=1, j=0</span></span><br><span class=\"line\"><span class=\"comment\">// i=2, j=0</span></span><br><span class=\"line\"><span class=\"comment\">// i=2, j=1</span></span><br><span class=\"line\"><span class=\"comment\">// i=2, j=2</span></span><br></pre></td></tr></table></figure>\n\n<p>满足条件时，会跳过当前循环，直接进入到下一论外层循环。如果 continue 语句后面不使用标签，则只能进入下一轮内层循环。</p>\n<h2 id=\"with\"><a href=\"#with\" class=\"headerlink\" title=\"with\"></a>with</h2><p>with 语句用途是将代码作用于设置为特定对象，使用例子是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span>(location&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> qs = search.substring(<span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> hostName = hostname</span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = href</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>使用 with 代替频繁使用的 location 对象，这意味着在这个语句内部，每个变量首先会被认为是一个局部变量，如果没有找到该局部变量，则会搜索 location 对象，看它是否是有一个同名属性。如果有，则该苏醒会被求值成 location 对象属性</p>\n<p>由于 with 语句影响性能且难以调试其中代码,通常不推荐在代码中使用</p>\n<h2 id=\"原始数据类型\"><a href=\"#原始数据类型\" class=\"headerlink\" title=\"原始数据类型\"></a>原始数据类型</h2><p>ECMScript 变量可以包含两种不同类型的数据：原始值和引用值。原始值就是最简单的数据，引用值是由多个值构成的对象。</p>\n<p><strong>6 种引用值</strong>：Undefined、Null、Boolean、Number、String 和 Symbol，typeOf 操作符最适合用来判断是否是原始类型，但是如果值是对象或是 null，那么 typeof 返回 Object</p>\n<p>保存原始值的变量是<strong>按值</strong>访问的，因为我们操作的就是存储在变量中的实际值</p>\n<p>注意，原始类型的初始化可以只使用原始字面量形式。如果使用的是 new 关键字，则 JavaScript 会创建一个 Object 类型的实例，但其行为类似原始值。下面来看看这两种初始化方式的差异：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> name1 = <span class=\"string\">&quot;Nicholas&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> name2 = <span class=\"keyword\">new</span> <span class=\"built_in\">String</span>(<span class=\"string\">&quot;Matt&quot;</span>);</span><br><span class=\"line\">name1.age = <span class=\"number\">27</span>;</span><br><span class=\"line\">name2.age = <span class=\"number\">26</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(name1.age) <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(name2.age) <span class=\"comment\">// 26</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(typeOf name1) <span class=\"comment\">//string</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(typeOf name2) <span class=\"comment\">//object</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"引用值\"><a href=\"#引用值\" class=\"headerlink\" title=\"引用值\"></a>引用值</h2><p>一个值得深思的例子</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setName</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  obj.name = <span class=\"string\">&#x27;Nicholas&#x27;</span></span><br><span class=\"line\">  obj = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>()</span><br><span class=\"line\">  obj.name = <span class=\"string\">&#x27;Greg&#x27;</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(obj) <span class=\"comment\">//Greg</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> person = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>()</span><br><span class=\"line\">setName(person)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.name) <span class=\"comment\">//“Nicholas&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果 person 是按饮用类型传递的，那么 person 应该自动将指针改为指向 name 为”Greg”的对象。可是，当我们再次访问 person.name 时，它的值是“Nicholas”,这表明函数中参数的，原始的引用类型仍然没有改变。</p>\n<p>当 obj 在函数内部被重写时，它变成了一个指向本地对象的指针。而那个本地对象在函数执行结束时就被销毁</p>"},{"title":"JS的number类型最大值","date":"2019-09-10T06:42:07.000Z","_content":"\n遇到过几次number类型精度丢失的问题，一次是后台传的类型为number类型的 超大值，结果丢失了精度，后来就修改成string 型的就没有了这个问题，一次是对number 型进行乘除操作，后台返回了超大值，出于产品方面的考虑，数据库限定了输入长度。但我想，若是真的有对一个超长number型数字处理的话，那该如何呢？\n\n<!--more-->\n\n## 精度丢失的根本原因\n\njs 的number类型有个最大值（安全值），即2的53次方，为9007199254740992，如果超出这个值，那么js 会出现不精准的问题，这个值为16位。在浏览器控制台分别输入Number.MAX_SAFE_INTEGER和Number.MIN_SAFE_INTEGER可查看对应的最大/小值\n\n## BigInt\n\nBigInt 是JavaScript 中一个新的原始类型，可以用任一精度表示整数。使用BigInt，即使超出JS Number 的安全整数限制，也可以安全的存储和操作大整数。\n\nchrome 67+开始支持BigInt，本文所有demo都是基于chrome 67。\n\n要创建BigInit,在数字后面添加n后缀即可，例如123变成123n。\n\nBigInt是JavaScript语言中的一个原始类型。因此，可以使用typeof操作符检测到这种类型：\n```javascript\ntypeof 123;\n// → 'number'\ntypeof 123n;\n// → 'bigint'\n```\n\n","source":"_posts/JS的number类型最大值.md","raw":"---\ntitle: JS的number类型最大值\ndate: 2019-09-10 14:42:07\ncategories: JavaScript\n---\n\n遇到过几次number类型精度丢失的问题，一次是后台传的类型为number类型的 超大值，结果丢失了精度，后来就修改成string 型的就没有了这个问题，一次是对number 型进行乘除操作，后台返回了超大值，出于产品方面的考虑，数据库限定了输入长度。但我想，若是真的有对一个超长number型数字处理的话，那该如何呢？\n\n<!--more-->\n\n## 精度丢失的根本原因\n\njs 的number类型有个最大值（安全值），即2的53次方，为9007199254740992，如果超出这个值，那么js 会出现不精准的问题，这个值为16位。在浏览器控制台分别输入Number.MAX_SAFE_INTEGER和Number.MIN_SAFE_INTEGER可查看对应的最大/小值\n\n## BigInt\n\nBigInt 是JavaScript 中一个新的原始类型，可以用任一精度表示整数。使用BigInt，即使超出JS Number 的安全整数限制，也可以安全的存储和操作大整数。\n\nchrome 67+开始支持BigInt，本文所有demo都是基于chrome 67。\n\n要创建BigInit,在数字后面添加n后缀即可，例如123变成123n。\n\nBigInt是JavaScript语言中的一个原始类型。因此，可以使用typeof操作符检测到这种类型：\n```javascript\ntypeof 123;\n// → 'number'\ntypeof 123n;\n// → 'bigint'\n```\n\n","slug":"JS的number类型最大值","published":1,"updated":"2021-02-27T12:24:38.482Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wk000fl5v0fwlh6o2j","content":"<p>遇到过几次number类型精度丢失的问题，一次是后台传的类型为number类型的 超大值，结果丢失了精度，后来就修改成string 型的就没有了这个问题，一次是对number 型进行乘除操作，后台返回了超大值，出于产品方面的考虑，数据库限定了输入长度。但我想，若是真的有对一个超长number型数字处理的话，那该如何呢？</p>\n<span id=\"more\"></span>\n\n<h2 id=\"精度丢失的根本原因\"><a href=\"#精度丢失的根本原因\" class=\"headerlink\" title=\"精度丢失的根本原因\"></a>精度丢失的根本原因</h2><p>js 的number类型有个最大值（安全值），即2的53次方，为9007199254740992，如果超出这个值，那么js 会出现不精准的问题，这个值为16位。在浏览器控制台分别输入Number.MAX_SAFE_INTEGER和Number.MIN_SAFE_INTEGER可查看对应的最大/小值</p>\n<h2 id=\"BigInt\"><a href=\"#BigInt\" class=\"headerlink\" title=\"BigInt\"></a>BigInt</h2><p>BigInt 是JavaScript 中一个新的原始类型，可以用任一精度表示整数。使用BigInt，即使超出JS Number 的安全整数限制，也可以安全的存储和操作大整数。</p>\n<p>chrome 67+开始支持BigInt，本文所有demo都是基于chrome 67。</p>\n<p>要创建BigInit,在数字后面添加n后缀即可，例如123变成123n。</p>\n<p>BigInt是JavaScript语言中的一个原始类型。因此，可以使用typeof操作符检测到这种类型：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"comment\">// → &#x27;number&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">123n</span>;</span><br><span class=\"line\"><span class=\"comment\">// → &#x27;bigint&#x27;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>遇到过几次number类型精度丢失的问题，一次是后台传的类型为number类型的 超大值，结果丢失了精度，后来就修改成string 型的就没有了这个问题，一次是对number 型进行乘除操作，后台返回了超大值，出于产品方面的考虑，数据库限定了输入长度。但我想，若是真的有对一个超长number型数字处理的话，那该如何呢？</p>","more":"<h2 id=\"精度丢失的根本原因\"><a href=\"#精度丢失的根本原因\" class=\"headerlink\" title=\"精度丢失的根本原因\"></a>精度丢失的根本原因</h2><p>js 的number类型有个最大值（安全值），即2的53次方，为9007199254740992，如果超出这个值，那么js 会出现不精准的问题，这个值为16位。在浏览器控制台分别输入Number.MAX_SAFE_INTEGER和Number.MIN_SAFE_INTEGER可查看对应的最大/小值</p>\n<h2 id=\"BigInt\"><a href=\"#BigInt\" class=\"headerlink\" title=\"BigInt\"></a>BigInt</h2><p>BigInt 是JavaScript 中一个新的原始类型，可以用任一精度表示整数。使用BigInt，即使超出JS Number 的安全整数限制，也可以安全的存储和操作大整数。</p>\n<p>chrome 67+开始支持BigInt，本文所有demo都是基于chrome 67。</p>\n<p>要创建BigInit,在数字后面添加n后缀即可，例如123变成123n。</p>\n<p>BigInt是JavaScript语言中的一个原始类型。因此，可以使用typeof操作符检测到这种类型：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"comment\">// → &#x27;number&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">123n</span>;</span><br><span class=\"line\"><span class=\"comment\">// → &#x27;bigint&#x27;</span></span><br></pre></td></tr></table></figure>"},{"title":"JavaScript动态规划和贪心算法","date":"2019-07-24T01:58:16.000Z","_content":"\n自从做了一个树的深度搜索、广度查询、树的之后，我就深刻的意识到自己对算法和数据结构一无所知，做出来的方案总感觉不是最优解。\n\n<!--more-->\n\n这里记录两种常用的算法：动态规划和贪心算法。动态规划常被人比作是递归的逆过程，而贪心算法在很多求有问题上，是不二之选。\n\n# 动态规划\n\n动态规划为什么会被认为是递归相反的技术呢，是因为递归是从顶部开始将问题分解，通过解决掉所有小问题的方式，来解决整个问题，动态规划是从底部开始解决问题，将所有小问题解决掉，然后合并成整个大的问题。\n\n递归算法写法简单但是效率并不高。\n\n## 斐波拉契数列\n\n斐波拉契数列 定义为一下序列：0,1,1,2,3,5,8,13,21,34,55\n\n公式为：n>=2,a<sub>n</sub> = a<sub>n-1</sub>+a <sub>n-2</sub>,这个序列是用来描述在理想状况下兔子的增长情况。\n\n若是用递归实现：\n\n```javascript\nfunction fibo(n) {\n  if (n <= 0) {\n    return 0\n  }\n  if (n === 1) {\n    return 1\n  }\n  return fibo(n - 1) + fibo(n - 2)\n}\n```\n\n这种实现方式非常耗性能，在 n 的数量级到达千级别就会变得特别慢，甚至失去响应。\n\n优化方案：\n\n```javascript\nfunction fibo(n) {\n  if (n <= 0) return 0\n  if (n <= 1) return 1\n  var a = 0,\n    b = 1\n  for (var i = 2; i <= n; i++) {\n    b = a + b\n    a = b - a\n  }\n  return b\n}\n```\n\n## 寻找最长公共子串\n\n例如在 hello 和 wellcome 中最长子串是 ell\n\n一种暴力的办法：\n\n```javascript\nfunction maxSubString(str1, str2) {\n  if (!str1 || !str2) return ''\n  var len1 = str1.length,\n    len2 = str2.length\n  var maxSubStr = ''\n  for (var i = 0; i < len1; i++) {\n    for (var j = 0; j < len2; j++) {\n      var tempStr = '',\n        k = 0\n      while (i + k < len1 && j + k < len2 && str1[i + k] === str2[j + k]) {\n        tempStr += str1[i + k]\n        k++\n      }\n      if (tempStr.length > maxSubStr.length) {\n        maxSubStr = tempStr\n      }\n    }\n  }\n  return maxSubStr\n}\n```\n\n而且上面不考虑多个一样长的情况吗？\n\n```javascript\nfunction findSubStr(str1, str2) {\n  if (str1.length > str2.length) {\n    var temp = str1\n    str1 = str2\n    str2 = temp\n  }\n  var len1 = str1.length,\n    len2 = str2.length\n  for (var j = len1; j > 0; j--) {\n    for (var i = 0; i < len1 - j; i++) {\n      var current = str1.substr(i, j)\n      if (str2.indexOf(current) >= 0) {\n        return current\n      }\n    }\n  }\n  return ''\n}\nconsole.log(findSubStr('aaa3333', 'baa333cc')) // aa333\nconsole.log(findSubStr('aaaX3333--', 'baa333ccX3333333x')) // X3333\n```\n","source":"_posts/JavaScript动态规划和贪心算法.md","raw":"---\ntitle: JavaScript动态规划和贪心算法\ndate: 2019-07-24 09:58:16\ncategories: JavaScript\n---\n\n自从做了一个树的深度搜索、广度查询、树的之后，我就深刻的意识到自己对算法和数据结构一无所知，做出来的方案总感觉不是最优解。\n\n<!--more-->\n\n这里记录两种常用的算法：动态规划和贪心算法。动态规划常被人比作是递归的逆过程，而贪心算法在很多求有问题上，是不二之选。\n\n# 动态规划\n\n动态规划为什么会被认为是递归相反的技术呢，是因为递归是从顶部开始将问题分解，通过解决掉所有小问题的方式，来解决整个问题，动态规划是从底部开始解决问题，将所有小问题解决掉，然后合并成整个大的问题。\n\n递归算法写法简单但是效率并不高。\n\n## 斐波拉契数列\n\n斐波拉契数列 定义为一下序列：0,1,1,2,3,5,8,13,21,34,55\n\n公式为：n>=2,a<sub>n</sub> = a<sub>n-1</sub>+a <sub>n-2</sub>,这个序列是用来描述在理想状况下兔子的增长情况。\n\n若是用递归实现：\n\n```javascript\nfunction fibo(n) {\n  if (n <= 0) {\n    return 0\n  }\n  if (n === 1) {\n    return 1\n  }\n  return fibo(n - 1) + fibo(n - 2)\n}\n```\n\n这种实现方式非常耗性能，在 n 的数量级到达千级别就会变得特别慢，甚至失去响应。\n\n优化方案：\n\n```javascript\nfunction fibo(n) {\n  if (n <= 0) return 0\n  if (n <= 1) return 1\n  var a = 0,\n    b = 1\n  for (var i = 2; i <= n; i++) {\n    b = a + b\n    a = b - a\n  }\n  return b\n}\n```\n\n## 寻找最长公共子串\n\n例如在 hello 和 wellcome 中最长子串是 ell\n\n一种暴力的办法：\n\n```javascript\nfunction maxSubString(str1, str2) {\n  if (!str1 || !str2) return ''\n  var len1 = str1.length,\n    len2 = str2.length\n  var maxSubStr = ''\n  for (var i = 0; i < len1; i++) {\n    for (var j = 0; j < len2; j++) {\n      var tempStr = '',\n        k = 0\n      while (i + k < len1 && j + k < len2 && str1[i + k] === str2[j + k]) {\n        tempStr += str1[i + k]\n        k++\n      }\n      if (tempStr.length > maxSubStr.length) {\n        maxSubStr = tempStr\n      }\n    }\n  }\n  return maxSubStr\n}\n```\n\n而且上面不考虑多个一样长的情况吗？\n\n```javascript\nfunction findSubStr(str1, str2) {\n  if (str1.length > str2.length) {\n    var temp = str1\n    str1 = str2\n    str2 = temp\n  }\n  var len1 = str1.length,\n    len2 = str2.length\n  for (var j = len1; j > 0; j--) {\n    for (var i = 0; i < len1 - j; i++) {\n      var current = str1.substr(i, j)\n      if (str2.indexOf(current) >= 0) {\n        return current\n      }\n    }\n  }\n  return ''\n}\nconsole.log(findSubStr('aaa3333', 'baa333cc')) // aa333\nconsole.log(findSubStr('aaaX3333--', 'baa333ccX3333333x')) // X3333\n```\n","slug":"JavaScript动态规划和贪心算法","published":1,"updated":"2021-05-06T12:22:09.894Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wm000jl5v0hrzaa33e","content":"<p>自从做了一个树的深度搜索、广度查询、树的之后，我就深刻的意识到自己对算法和数据结构一无所知，做出来的方案总感觉不是最优解。</p>\n<span id=\"more\"></span>\n\n<p>这里记录两种常用的算法：动态规划和贪心算法。动态规划常被人比作是递归的逆过程，而贪心算法在很多求有问题上，是不二之选。</p>\n<h1 id=\"动态规划\"><a href=\"#动态规划\" class=\"headerlink\" title=\"动态规划\"></a>动态规划</h1><p>动态规划为什么会被认为是递归相反的技术呢，是因为递归是从顶部开始将问题分解，通过解决掉所有小问题的方式，来解决整个问题，动态规划是从底部开始解决问题，将所有小问题解决掉，然后合并成整个大的问题。</p>\n<p>递归算法写法简单但是效率并不高。</p>\n<h2 id=\"斐波拉契数列\"><a href=\"#斐波拉契数列\" class=\"headerlink\" title=\"斐波拉契数列\"></a>斐波拉契数列</h2><p>斐波拉契数列 定义为一下序列：0,1,1,2,3,5,8,13,21,34,55</p>\n<p>公式为：n&gt;=2,a<sub>n</sub> = a<sub>n-1</sub>+a <sub>n-2</sub>,这个序列是用来描述在理想状况下兔子的增长情况。</p>\n<p>若是用递归实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fibo</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fibo(n - <span class=\"number\">1</span>) + fibo(n - <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种实现方式非常耗性能，在 n 的数量级到达千级别就会变得特别慢，甚至失去响应。</p>\n<p>优化方案：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fibo</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">1</span>) <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">0</span>,</span><br><span class=\"line\">    b = <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">2</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">    b = a + b</span><br><span class=\"line\">    a = b - a</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> b</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"寻找最长公共子串\"><a href=\"#寻找最长公共子串\" class=\"headerlink\" title=\"寻找最长公共子串\"></a>寻找最长公共子串</h2><p>例如在 hello 和 wellcome 中最长子串是 ell</p>\n<p>一种暴力的办法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">maxSubString</span>(<span class=\"params\">str1, str2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!str1 || !str2) <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> len1 = str1.length,</span><br><span class=\"line\">    len2 = str2.length</span><br><span class=\"line\">  <span class=\"keyword\">var</span> maxSubStr = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len1; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; len2; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> tempStr = <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        k = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">while</span> (i + k &lt; len1 &amp;&amp; j + k &lt; len2 &amp;&amp; str1[i + k] === str2[j + k]) &#123;</span><br><span class=\"line\">        tempStr += str1[i + k]</span><br><span class=\"line\">        k++</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (tempStr.length &gt; maxSubStr.length) &#123;</span><br><span class=\"line\">        maxSubStr = tempStr</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> maxSubStr</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而且上面不考虑多个一样长的情况吗？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findSubStr</span>(<span class=\"params\">str1, str2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (str1.length &gt; str2.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> temp = str1</span><br><span class=\"line\">    str1 = str2</span><br><span class=\"line\">    str2 = temp</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> len1 = str1.length,</span><br><span class=\"line\">    len2 = str2.length</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = len1; j &gt; <span class=\"number\">0</span>; j--) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len1 - j; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> current = str1.substr(i, j)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (str2.indexOf(current) &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findSubStr(<span class=\"string\">&#x27;aaa3333&#x27;</span>, <span class=\"string\">&#x27;baa333cc&#x27;</span>)) <span class=\"comment\">// aa333</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findSubStr(<span class=\"string\">&#x27;aaaX3333--&#x27;</span>, <span class=\"string\">&#x27;baa333ccX3333333x&#x27;</span>)) <span class=\"comment\">// X3333</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>自从做了一个树的深度搜索、广度查询、树的之后，我就深刻的意识到自己对算法和数据结构一无所知，做出来的方案总感觉不是最优解。</p>","more":"<p>这里记录两种常用的算法：动态规划和贪心算法。动态规划常被人比作是递归的逆过程，而贪心算法在很多求有问题上，是不二之选。</p>\n<h1 id=\"动态规划\"><a href=\"#动态规划\" class=\"headerlink\" title=\"动态规划\"></a>动态规划</h1><p>动态规划为什么会被认为是递归相反的技术呢，是因为递归是从顶部开始将问题分解，通过解决掉所有小问题的方式，来解决整个问题，动态规划是从底部开始解决问题，将所有小问题解决掉，然后合并成整个大的问题。</p>\n<p>递归算法写法简单但是效率并不高。</p>\n<h2 id=\"斐波拉契数列\"><a href=\"#斐波拉契数列\" class=\"headerlink\" title=\"斐波拉契数列\"></a>斐波拉契数列</h2><p>斐波拉契数列 定义为一下序列：0,1,1,2,3,5,8,13,21,34,55</p>\n<p>公式为：n&gt;=2,a<sub>n</sub> = a<sub>n-1</sub>+a <sub>n-2</sub>,这个序列是用来描述在理想状况下兔子的增长情况。</p>\n<p>若是用递归实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fibo</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fibo(n - <span class=\"number\">1</span>) + fibo(n - <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种实现方式非常耗性能，在 n 的数量级到达千级别就会变得特别慢，甚至失去响应。</p>\n<p>优化方案：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fibo</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">1</span>) <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">0</span>,</span><br><span class=\"line\">    b = <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">2</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">    b = a + b</span><br><span class=\"line\">    a = b - a</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> b</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"寻找最长公共子串\"><a href=\"#寻找最长公共子串\" class=\"headerlink\" title=\"寻找最长公共子串\"></a>寻找最长公共子串</h2><p>例如在 hello 和 wellcome 中最长子串是 ell</p>\n<p>一种暴力的办法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">maxSubString</span>(<span class=\"params\">str1, str2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!str1 || !str2) <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> len1 = str1.length,</span><br><span class=\"line\">    len2 = str2.length</span><br><span class=\"line\">  <span class=\"keyword\">var</span> maxSubStr = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len1; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; len2; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> tempStr = <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        k = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">while</span> (i + k &lt; len1 &amp;&amp; j + k &lt; len2 &amp;&amp; str1[i + k] === str2[j + k]) &#123;</span><br><span class=\"line\">        tempStr += str1[i + k]</span><br><span class=\"line\">        k++</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (tempStr.length &gt; maxSubStr.length) &#123;</span><br><span class=\"line\">        maxSubStr = tempStr</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> maxSubStr</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而且上面不考虑多个一样长的情况吗？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findSubStr</span>(<span class=\"params\">str1, str2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (str1.length &gt; str2.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> temp = str1</span><br><span class=\"line\">    str1 = str2</span><br><span class=\"line\">    str2 = temp</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> len1 = str1.length,</span><br><span class=\"line\">    len2 = str2.length</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = len1; j &gt; <span class=\"number\">0</span>; j--) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len1 - j; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> current = str1.substr(i, j)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (str2.indexOf(current) &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findSubStr(<span class=\"string\">&#x27;aaa3333&#x27;</span>, <span class=\"string\">&#x27;baa333cc&#x27;</span>)) <span class=\"comment\">// aa333</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findSubStr(<span class=\"string\">&#x27;aaaX3333--&#x27;</span>, <span class=\"string\">&#x27;baa333ccX3333333x&#x27;</span>)) <span class=\"comment\">// X3333</span></span><br></pre></td></tr></table></figure>"},{"title":"Javascript链表数据结构","date":"2021-04-07T07:23:51.000Z","_content":"\n数组和列表可能是最常用的数据结构，但是要实现从起点插入或者是从中间插入或移出项的成本很高，因为需要移动元素。链表的好处在于添加或者移除元素时不需要移动其他的元素。然而想要访问链表中间的一个元素，则需要从起点开始迭代链表知道找到所需要的元素。\n\n<!--more-->\n\n链表存储有序的元素集合，不同于数组，链表中的元素在内存中不是连续放置的。每个元素由一个存储元素本身的节点和一个指向下一个元素的引用（也称指针活链接）组成。\n\n![network](/images/common/linked-list.jpg)\n\n## 实现单向数据链表\n\n```javascript\nclass Node {\n  constructor(element) {\n    this.element = element\n    this.next = null\n  }\n}\n\nclass LinkedList {\n  constructor() {\n    this.count = 0\n    this.head = null\n    this.equalsFn = function (a, b) {\n      return a === b //用于实现indexOf的方法\n    }\n  }\n  push(element) {\n    //向链表尾部添加一个新元素\n    const node = new Node(element)\n    let current\n    if (this.head === null) {\n      this.head = node\n    } else {\n      current = this.head\n      while (current.next !== null) {\n        current = current.next\n      }\n      current.next = node\n    }\n    this.count++\n  }\n  insert(element, position) {\n    //向链表的特定位置插入一个新元素\n    if (index >= 0 && index <= this.count) {\n      const node = new Node(element)\n      if (index === 0) {\n        const current = this.head\n        node.next = current\n        this.head = node\n      } else {\n        const previous = this.getElementAt(index - 1)\n        const current = previous.next\n        node.next = current\n        previous.next = node\n      }\n      this.count++\n      return true\n    }\n    return false\n  }\n  getElementAt(index) {\n    //返回链表中特定位置的元素，若是不存在则返回undefined\n    if (index >= 0 && index <= this.count) {\n      let node = this.head\n      for (let i = 0; i < index && node != null; i++) {\n        node = node.next\n      }\n      return node\n    }\n    return undefined\n  }\n  remove(element) {\n    //从链表中移出一个元素 可以使用getElementAt来重构remove方法\n    const index = this.indexOf(element)\n    return this.removeAt(index)\n  }\n  indexOf(element) {\n    //返回元素在链表中的索引，如果链表中没有改元素则返回-1\n    let current = this.head\n    for (let i = 0; i < this.count && current != null; i++) {\n      if (this.equalsFn(element, current.element)) {\n        return i\n      }\n      current = current.next\n    }\n    return -1\n  }\n  removeAt(index) {\n    //从链表的特定位置移出一个元素\n    if (index >= 0 && index < this.count) {\n      let current = this.head\n      if (index === 0) {\n        this.head = current.next\n      } else {\n        //将previous与current 的下一项链接起来，跳过current，从而移除它\n        const previous = this.getElementAt(index - 1)\n        current = previous.next\n        previous.next = current.next\n      }\n      this.count--\n      return current.element\n    }\n    return undefined\n  }\n  isEmpty() {\n    return this.size() === 0\n  }\n  size() {\n    return this.count\n  }\n  getHead() {\n    return this.head\n  }\n  toString() {\n    //返回表示整个链表的字符串\n    if (this.head == null) {\n      return ''\n    }\n    let objString = `${this.head.element}`\n    let current = this.head.next\n    for (let i = 1; i < this.size() && current != null; i++) {\n      objString = `${objString},${current.element}`\n      current = current.next\n    }\n    return objString\n  }\n}\n```\n\n","source":"_posts/Javascript链表数据结构.md","raw":"---\ntitle: Javascript链表数据结构\ndate: 2021-04-07 15:23:51\ncategories: JavaScript\n---\n\n数组和列表可能是最常用的数据结构，但是要实现从起点插入或者是从中间插入或移出项的成本很高，因为需要移动元素。链表的好处在于添加或者移除元素时不需要移动其他的元素。然而想要访问链表中间的一个元素，则需要从起点开始迭代链表知道找到所需要的元素。\n\n<!--more-->\n\n链表存储有序的元素集合，不同于数组，链表中的元素在内存中不是连续放置的。每个元素由一个存储元素本身的节点和一个指向下一个元素的引用（也称指针活链接）组成。\n\n![network](/images/common/linked-list.jpg)\n\n## 实现单向数据链表\n\n```javascript\nclass Node {\n  constructor(element) {\n    this.element = element\n    this.next = null\n  }\n}\n\nclass LinkedList {\n  constructor() {\n    this.count = 0\n    this.head = null\n    this.equalsFn = function (a, b) {\n      return a === b //用于实现indexOf的方法\n    }\n  }\n  push(element) {\n    //向链表尾部添加一个新元素\n    const node = new Node(element)\n    let current\n    if (this.head === null) {\n      this.head = node\n    } else {\n      current = this.head\n      while (current.next !== null) {\n        current = current.next\n      }\n      current.next = node\n    }\n    this.count++\n  }\n  insert(element, position) {\n    //向链表的特定位置插入一个新元素\n    if (index >= 0 && index <= this.count) {\n      const node = new Node(element)\n      if (index === 0) {\n        const current = this.head\n        node.next = current\n        this.head = node\n      } else {\n        const previous = this.getElementAt(index - 1)\n        const current = previous.next\n        node.next = current\n        previous.next = node\n      }\n      this.count++\n      return true\n    }\n    return false\n  }\n  getElementAt(index) {\n    //返回链表中特定位置的元素，若是不存在则返回undefined\n    if (index >= 0 && index <= this.count) {\n      let node = this.head\n      for (let i = 0; i < index && node != null; i++) {\n        node = node.next\n      }\n      return node\n    }\n    return undefined\n  }\n  remove(element) {\n    //从链表中移出一个元素 可以使用getElementAt来重构remove方法\n    const index = this.indexOf(element)\n    return this.removeAt(index)\n  }\n  indexOf(element) {\n    //返回元素在链表中的索引，如果链表中没有改元素则返回-1\n    let current = this.head\n    for (let i = 0; i < this.count && current != null; i++) {\n      if (this.equalsFn(element, current.element)) {\n        return i\n      }\n      current = current.next\n    }\n    return -1\n  }\n  removeAt(index) {\n    //从链表的特定位置移出一个元素\n    if (index >= 0 && index < this.count) {\n      let current = this.head\n      if (index === 0) {\n        this.head = current.next\n      } else {\n        //将previous与current 的下一项链接起来，跳过current，从而移除它\n        const previous = this.getElementAt(index - 1)\n        current = previous.next\n        previous.next = current.next\n      }\n      this.count--\n      return current.element\n    }\n    return undefined\n  }\n  isEmpty() {\n    return this.size() === 0\n  }\n  size() {\n    return this.count\n  }\n  getHead() {\n    return this.head\n  }\n  toString() {\n    //返回表示整个链表的字符串\n    if (this.head == null) {\n      return ''\n    }\n    let objString = `${this.head.element}`\n    let current = this.head.next\n    for (let i = 1; i < this.size() && current != null; i++) {\n      objString = `${objString},${current.element}`\n      current = current.next\n    }\n    return objString\n  }\n}\n```\n\n","slug":"Javascript链表数据结构","published":1,"updated":"2021-04-07T12:41:07.206Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wn000kl5v01u305y8v","content":"<p>数组和列表可能是最常用的数据结构，但是要实现从起点插入或者是从中间插入或移出项的成本很高，因为需要移动元素。链表的好处在于添加或者移除元素时不需要移动其他的元素。然而想要访问链表中间的一个元素，则需要从起点开始迭代链表知道找到所需要的元素。</p>\n<span id=\"more\"></span>\n\n<p>链表存储有序的元素集合，不同于数组，链表中的元素在内存中不是连续放置的。每个元素由一个存储元素本身的节点和一个指向下一个元素的引用（也称指针活链接）组成。</p>\n<p><img src=\"/images/common/linked-list.jpg\" alt=\"network\"></p>\n<h2 id=\"实现单向数据链表\"><a href=\"#实现单向数据链表\" class=\"headerlink\" title=\"实现单向数据链表\"></a>实现单向数据链表</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">element</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.element = element</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.next = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkedList</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.count = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.head = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.equalsFn = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> a === b <span class=\"comment\">//用于实现indexOf的方法</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">push</span>(<span class=\"params\">element</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//向链表尾部添加一个新元素</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> current</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.head === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.head = node</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      current = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">      <span class=\"keyword\">while</span> (current.next !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        current = current.next</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      current.next = node</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.count++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">insert</span>(<span class=\"params\">element, position</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//向链表的特定位置插入一个新元素</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt;= <span class=\"built_in\">this</span>.count) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> current = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">        node.next = current</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.head = node</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> previous = <span class=\"built_in\">this</span>.getElementAt(index - <span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> current = previous.next</span><br><span class=\"line\">        node.next = current</span><br><span class=\"line\">        previous.next = node</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.count++</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getElementAt</span>(<span class=\"params\">index</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//返回链表中特定位置的元素，若是不存在则返回undefined</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt;= <span class=\"built_in\">this</span>.count) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> node = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; index &amp;&amp; node != <span class=\"literal\">null</span>; i++) &#123;</span><br><span class=\"line\">        node = node.next</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> node</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">remove</span>(<span class=\"params\">element</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//从链表中移出一个元素 可以使用getElementAt来重构remove方法</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = <span class=\"built_in\">this</span>.indexOf(element)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.removeAt(index)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">indexOf</span>(<span class=\"params\">element</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//返回元素在链表中的索引，如果链表中没有改元素则返回-1</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"built_in\">this</span>.count &amp;&amp; current != <span class=\"literal\">null</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.equalsFn(element, current.element)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> i</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      current = current.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">removeAt</span>(<span class=\"params\">index</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//从链表的特定位置移出一个元素</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt; <span class=\"built_in\">this</span>.count) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> current = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.head = current.next</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//将previous与current 的下一项链接起来，跳过current，从而移除它</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> previous = <span class=\"built_in\">this</span>.getElementAt(index - <span class=\"number\">1</span>)</span><br><span class=\"line\">        current = previous.next</span><br><span class=\"line\">        previous.next = current.next</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.count--</span><br><span class=\"line\">      <span class=\"keyword\">return</span> current.element</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">isEmpty</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.size() === <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">size</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.count</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getHead</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//返回表示整个链表的字符串</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.head == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> objString = <span class=\"string\">`<span class=\"subst\">$&#123;<span class=\"built_in\">this</span>.head.element&#125;</span>`</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"built_in\">this</span>.head.next</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"built_in\">this</span>.size() &amp;&amp; current != <span class=\"literal\">null</span>; i++) &#123;</span><br><span class=\"line\">      objString = <span class=\"string\">`<span class=\"subst\">$&#123;objString&#125;</span>,<span class=\"subst\">$&#123;current.element&#125;</span>`</span></span><br><span class=\"line\">      current = current.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> objString</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>数组和列表可能是最常用的数据结构，但是要实现从起点插入或者是从中间插入或移出项的成本很高，因为需要移动元素。链表的好处在于添加或者移除元素时不需要移动其他的元素。然而想要访问链表中间的一个元素，则需要从起点开始迭代链表知道找到所需要的元素。</p>","more":"<p>链表存储有序的元素集合，不同于数组，链表中的元素在内存中不是连续放置的。每个元素由一个存储元素本身的节点和一个指向下一个元素的引用（也称指针活链接）组成。</p>\n<p><img src=\"/images/common/linked-list.jpg\" alt=\"network\"></p>\n<h2 id=\"实现单向数据链表\"><a href=\"#实现单向数据链表\" class=\"headerlink\" title=\"实现单向数据链表\"></a>实现单向数据链表</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">element</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.element = element</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.next = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkedList</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.count = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.head = <span class=\"literal\">null</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.equalsFn = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> a === b <span class=\"comment\">//用于实现indexOf的方法</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">push</span>(<span class=\"params\">element</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//向链表尾部添加一个新元素</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> current</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.head === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.head = node</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      current = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">      <span class=\"keyword\">while</span> (current.next !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        current = current.next</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      current.next = node</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.count++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">insert</span>(<span class=\"params\">element, position</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//向链表的特定位置插入一个新元素</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt;= <span class=\"built_in\">this</span>.count) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> node = <span class=\"keyword\">new</span> Node(element)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> current = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">        node.next = current</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.head = node</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> previous = <span class=\"built_in\">this</span>.getElementAt(index - <span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> current = previous.next</span><br><span class=\"line\">        node.next = current</span><br><span class=\"line\">        previous.next = node</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.count++</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getElementAt</span>(<span class=\"params\">index</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//返回链表中特定位置的元素，若是不存在则返回undefined</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt;= <span class=\"built_in\">this</span>.count) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> node = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; index &amp;&amp; node != <span class=\"literal\">null</span>; i++) &#123;</span><br><span class=\"line\">        node = node.next</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> node</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">remove</span>(<span class=\"params\">element</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//从链表中移出一个元素 可以使用getElementAt来重构remove方法</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = <span class=\"built_in\">this</span>.indexOf(element)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.removeAt(index)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">indexOf</span>(<span class=\"params\">element</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//返回元素在链表中的索引，如果链表中没有改元素则返回-1</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"built_in\">this</span>.count &amp;&amp; current != <span class=\"literal\">null</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.equalsFn(element, current.element)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> i</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      current = current.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">removeAt</span>(<span class=\"params\">index</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//从链表的特定位置移出一个元素</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt; <span class=\"built_in\">this</span>.count) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> current = <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.head = current.next</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//将previous与current 的下一项链接起来，跳过current，从而移除它</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> previous = <span class=\"built_in\">this</span>.getElementAt(index - <span class=\"number\">1</span>)</span><br><span class=\"line\">        current = previous.next</span><br><span class=\"line\">        previous.next = current.next</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.count--</span><br><span class=\"line\">      <span class=\"keyword\">return</span> current.element</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">isEmpty</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.size() === <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">size</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.count</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getHead</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.head</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//返回表示整个链表的字符串</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.head == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> objString = <span class=\"string\">`<span class=\"subst\">$&#123;<span class=\"built_in\">this</span>.head.element&#125;</span>`</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> current = <span class=\"built_in\">this</span>.head.next</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"built_in\">this</span>.size() &amp;&amp; current != <span class=\"literal\">null</span>; i++) &#123;</span><br><span class=\"line\">      objString = <span class=\"string\">`<span class=\"subst\">$&#123;objString&#125;</span>,<span class=\"subst\">$&#123;current.element&#125;</span>`</span></span><br><span class=\"line\">      current = current.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> objString</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Jenkins对前端应用做自动化构建","date":"2019-12-03T08:58:31.000Z","_content":"# Jenkins是什么\nJenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能，最初的创建者川口清子（Kohsuke Kawaguchi）。他独自写了大部分代码\n\n<!--more-->\n![network](https://user-images.githubusercontent.com/16111288/68524077-01e52f80-02fd-11ea-9531-d039a4c77113.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68523536-9c417500-02f5-11ea-9862-dd7bc23ae9ec.png)\n\n# 概要\n\n今天分享的主要内容有\n- Docker简单介绍\n- Jenkins的简介与安装\n- Jenkins对接Github 项目做持续集成\n- Jenkins构建项目的几种方式\n- Jenkins上传前端包到文件服务器\n- 云服务器简单使用介绍\n\n\n涉及到的资源和工具\n- 一台阿里云Linux服务器（默认安装Centos）。\n- Xshell：一个Windows软件，脚本的方式来操作服务器。\n- XFTP：是Xshell的一个插件，能图形化看到服务器的文件。\n- Nginx：展示前端页面\n- Docker：一个运行Jenkins的容器\n- Jenkins\n- Git\n\n# 现状\n如今我们已经到前后端分离开发的模式。通常情况下，前端只需要把HTML，CSS，JS打包好之后，发给后端部署即可。最能体现这个场景比如使用vue来开发前端项目的时候，利用vue-cli脚手架来帮我们打包npm run build。 最终会生成一个dist目录，我们只需提供这个dist包给后端开发人员即可。\n\n如果只发一个版本，这种方式完全OK，但是如果需要频繁的更新版本，就会有如下图的操作，各个人员在频发互传代码包，容易出问题。这对于前后端来说，都是一个很低效的事情。\n\n![network](https://user-images.githubusercontent.com/16111288/68523471-c6466780-02f4-11ea-8700-e6c5e0bef519.png)\n\n因此我们需要将低效的手动式部署，升级为更加先进的工程化，流水线式的持续部署。Jenkins就很好的可以做这样的事情，而且我们公司的持续集成也是使用这个工具。\n\n# CI/CD\n## 持续集成Continuous Integration（CI）\n持续集成强调开发人员提交了新代码之后，立刻自动的进行构建、（单元）测试。根据测试结果，我们可以确定新代码和原有代码能否正确地集成在一起。\n持续集成过程中很重视自动化测试验证结果，对可能出现的一些问题进行预警，以保障最终合并的代码没有问题。\n\n## 持续交付Continuous Delivery（CD）\n持续交付在持续集成的基础上，将集成后的代码部署到更贴近真实运行环境的「类生产环境」（production-like environments）中。交付给质量团队或者用户，以供评审。如果评审通过，代码就进入生产阶段。\n持续交付并不是指软件每一个改动都要尽快部署到产品环境中，它指的是任何的代码修改都可以在任何时候实施部署。\n这里强调的是\n\n- 手动部署\n- 有部署的能力，但不一定部署\n\n## 持续部署（Continuous Deployment)\n持续部署是指当交付的代码通过评审之后，自动部署到生产环境中。持续部署是持续交付的最高阶段。\n这里强调\n\n- 持续部署是自动的\n- 持续部署是持续交付的最高阶段\n\n## 总结\n「持续集成（Continuous Integration）」、「持续交付（Continuous Delivery）」和「持续部署（Continuous Deployment）」提供了一个优秀的 DevOps 环境，对于整个团队来说，好处与挑战并行。无论如何，频繁部署、快速交付以及开发测试流程自动化都将成为未来软件工程的重要组成部分。\n\n# Docker\n\n## docker简介\n\nDocker 是现今非常流行的一种容器化打包和发布工具，配合Git、SVN等代码版本管理工具， Jenkins、Gitlab Runner等持续集成工具，以及Swarn、Kubernetes 等容器编排工具，可以形成一个完整的软件自动化集成、测试发布流水线（CI/CD），可以有效的提升团队的生产效率和运维体验。\n\nDocker是一种Linux容器技术，容器有效的将由单个操作系统挂管理的资源划分到孤立的组中，以便更好的在组之间平衡有冲突的资源使用需求。可简单理解为一种沙盒 。每个容器内运行一个应用，不同的容器之间相互隔离，容器之间也可以建立通信机制。容器的创建和停止都十分快速，资源需求远远低于虚拟机，一个非常明显的区别就是在运行虚拟机中包含有操作系统，而容器中却没有。\n\n虚拟机正因为带有独立的操作系统，它可以通过这个操作系统内核进行对硬件资源的自主访问，成为一个独立完备的计算机小生态。Docker容器不具备这样的功能，它只能通过与宿主机共享操作系统内核来进行硬件资源的访问，但这也不是docker 的缺点，反而因为不需要携带自己的操作系统，容器变得更小更轻量，创建容器变得非常快速\n\n## docker与虚拟机对比\n| 特性       | docker容器           | 虚拟机               |\n| ---------- | -------------------- | -------------------- |\n| 启动速度   | 秒级                 | 分钟级               |\n| 硬盘使用   | 一般为MB             | 一般为GB             |\n| 性能       | 接近原生             | 弱于原生             |\n| 系统支持量 | 单台机支持上千个容器 | 单台机支持几十个容器 |\n| 隔离性     | 安全隔离             | 安全隔离             |\n\n## Docker容器\n\n 类似linux系统环境，运行和隔离应用。容器从镜像启动的时候，docker会在镜像的最上一层创建一个可写层，镜像本身是只读的，保持不变，是一个文件系统。\n\n## Docker镜像\n\nDocker镜像是一个Docker的可执行文件，其中包含了运行应用程序所需要的代码、依赖库、环境变量、配置文件等等，也是一个文件系统。\n\n## 仓库\n仓库分为本地仓库和远程仓库，是用于存储镜像的地方，通常在电脑上通过docker build 构建镜像后，镜像就被存放着在本地仓库中；当我们要转移、分发这些镜像的时候，就需要利用远程镜像仓库，讲镜像上传，方便后续其他电脑可以从小这些远程仓库中下载到我们的镜像。\n## Dockerfile\n\n如果你想要从一个基础镜像开始建立一个自定义镜像，可以选择一步一步进行构建，也可以选择写一个配置文件，然后一条命令（docker build）完成构建，显然配置文件的方式可以更好地应对需求的变更，这个配置文件就是Dockerfile。\n学习Dockerfile的最好方式就是阅读别人写的Dockerfile，遇到不会的指令就查一查Dockerfile的文档\n\n## 注意\n关机后，docker容器会停止运行，镜像会保留在硬盘上，就想关机了，软件就关闭了，但可以再次打开。\n\n# Jenkins\n\n## Jenkins安装\n建议直接在Linux上安装，首页的插件选择默认的安装。\n\n## Jenkins页面简介\n\n​\t\tjenkins系统的介绍\n\n## Jenkins插件安装\n\n作为CI/CD的调度中心，Jenkins具有十八般武艺，目前已有1500多个插件，功能非常强大，比如说我们用到的，node插件，npm插件，Github插件，ssh上传文件插件，还有很多插件，比较多人用的，导出测试报告，sonar代码扫描等等。如果再jenkins里面没有搜到想用的插件，去官网搜，下载后在回来安装需要额外安装的有：\n- Github plugin：把代码从Github上拉下来\n- Nodejs：运行前端项目，npm install，npm run build \n- Pubish Over SSH：把构建好的文件 上传到nginx\n- Email Extended  Template : 发送邮件通知\n\n### 在github配置钩子\n\tJenkins需要一个对项目有读写权限的账户，所以要在github生成一个token给jenkins使用，这个token，在后面需要用到。\n> \t进入github --> setting --> Personal Access Token --> Generate new token\n\n![network](https://user-images.githubusercontent.com/16111288/68523844-aebdad80-02f9-11ea-9294-828868dfdf69.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68523993-9e0e3700-02fb-11ea-9a0b-f07e19b9cc7f.png)\n\n拿到这个token之后先保存好，等会到jenkins中需要配置凭证\n我们有一个token可以访问到github了，但是还要对其中的项目设置钩子\n> \t进入GitHub上指定的项目 --> setting --> WebHooks&Services --> add webhook --> 输入刚刚部署jenkins的服务器的IP\n\n![network](https://user-images.githubusercontent.com/16111288/68524015-04935500-02fc-11ea-9a12-9cfd5bfc7695.png)\n\n## 在Jenkins和github钩子\n\n### 安装github plugin\n> 系统管理-->插件管理-->可选插件\n### 配置github plugin\n> 系统管理-->github plugin\n\nAPI URL 输入 `https://api.github.com`，Credentials点击Add添加，Kind选择Secret Text,具体如下图所示。\n\n![network](https://user-images.githubusercontent.com/16111288/68524053-c64a6580-02fc-11ea-9f2d-db3a71b304d3.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68524112-9485ce80-02fd-11ea-9047-d73780d20b48.png)\n\n设置完成后，点击`TestConnection`,提示`Credentials verified for user UUserName, rate limit: xxx`,则表明有效。\n\n## 构建配置\n\n## 构建方式\n\n- 手动构建：自己上Jenkins点击。\n- 自动构建：提交代码到git仓库之后，自动构建。\n- 定时构建：每隔一段时间构建一次，比如设置每天固定某个时间段构建。\n\n### 编写shell脚本\n\nShell 是一个用 C 语言编写的程序，它是用户使用 Linux 的桥梁。Shell 既是一种命令语言，又是一种程序设计语言。\n\n`node -v`\n`npm -v`\n`npm --registry https://registry.npm.taobao.org install`\n`npm run test:unit`\n`npm run build`\n\n### 参数化构建\n选择参数化构建，配置参数，在工程的首页就会多一个构建入口，参数化构建使得构建变得更加灵活。\n\n![network](https://user-images.githubusercontent.com/16111288/68524161-5d63ed00-02fe-11ea-9874-1f4672d47891.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68524197-a0be5b80-02fe-11ea-8765-a5505bc42420.png)\n\n### 上传构建包\n\n使用nginx做为文件服务器\n在机器上安装nginx\n在nginx上配置为文件资源服务器\n\n`location / {\n        root   /usr/share/nginx/html/static;\n        autoindex on;\n        autoindex_exact_size off;\n        autoindex_localtime on;\n    }`\n![network](https://user-images.githubusercontent.com/16111288/68524366-0b709680-0301-11ea-8892-a7e1e50f4cfa.png)\n\n## Jenkins系统配置SSH账号\n\n安装Publish Over SSH插件用于SSH连接远程的服务器。\n\n登录 jenkins 管理系统首页，打开“系统管理”--“管理插件”  搜索 Publish Over SSH 然后勾选安装\n配置远程服务器的连接\n\n打开“系统管理”--“系统设置”  找到 “Publish over SSH” 项 ，我这里远程服务器用的是ssh登录，通过ppk密钥进行连接，所以我的配置如图，如果是帐号密码登录的Passphrase填写密码Username填写用户名，path to key 为空就可以了。\n\n![network](https://user-images.githubusercontent.com/16111288/68524390-5094c880-0301-11ea-8559-ad729ff4f671.png)\n\n点击 Test Configuration 按钮测试连接是否成功\n\n![network](https://user-images.githubusercontent.com/16111288/68524400-6bffd380-0301-11ea-840d-96bc52a4257b.png)\n\n### JOB添加构建后上传\n\n> “构建后操作步骤”---“Send build artifacts over SSH” \n\nName：第三步创建的远程服务器名称\n\nSource files：本地需要传输过去的文件路径\n\nRemove prefix：过滤掉的目录名\n\nRemote directory：远程服务器的保存路径\n\nExec command：传输完成后在远程服务器执行的sh命令\n\n![network](https://user-images.githubusercontent.com/16111288/68524450-03652680-0302-11ea-9bce-f7b42ddf589d.png)\n\n## 构建后邮件通知\n构建成功之后，可以进行邮件通知。\n第一步，先到插件管理安装插件，Email Extension Plugin，我只搜到了Email EXtension Template，所以就安装了它\n\n\n如果是QQ邮箱，先去获取一个独立密码\n\n![network](https://user-images.githubusercontent.com/16111288/68524622-02cd8f80-0304-11ea-949b-ec148ea39d08.png)\n\n> 系统管理-->系统设置--> Extended E-mail Notification\n\n![network](https://user-images.githubusercontent.com/16111288/68524633-1a0c7d00-0304-11ea-8bdb-3c94222fcfb8.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68524636-21338b00-0304-11ea-8ac7-0e8aa0f07aab.png)\n\n## 配置邮件报错\n\n![network](https://user-images.githubusercontent.com/16111288/68524653-593ace00-0304-11ea-9b60-d4f4227f020c.png)\n\n邮件配置的过程出错，是因为管理的邮箱没有配置，到用户设置去设置\n\n![network](https://user-images.githubusercontent.com/16111288/68524659-6952ad80-0304-11ea-846b-fb1dc721ab56.png)\n\n### 构建后选择接收人\n\n![network](https://user-images.githubusercontent.com/16111288/68524667-7f606e00-0304-11ea-8425-84fbd475e9af.png)\n\n\n## 注意\n\n 对于新手来说，Jenkin最好直接安装在机器上，安装在docker上的话，Jenkins无法访问到宿主机器的环境变量，比如我在机器上安装Yarn，但docker上的Jenkins无法访问得到Yarn，只能老老实实的使用npm。\n\n\n\n## 遇到的问题\n\n- 学习Jenkins，Docker这种工具，最好租一个服务器，不需要买域名，按月租就够了。\n- 境外服务器的比境内便宜，但境外的经常连不上去，每天总有几个小时连不上去。\n- 构建过程中npm install总是失败，服务器从1G内存扩容到2G 之后又成功了。\n- Docker安装的jenkins无法访问到本机的环境变量，例如无法在构建脚本中写Yarn命令。\n\n\n# 阿里云简介\n\n轻量应用型服务器，便宜，适合学习。\n买好之后，在点击进入自己的机器\n\n![network](https://user-images.githubusercontent.com/16111288/68524467-30193e00-0302-11ea-8266-0114201443ba.png)\n\n服务器默认只开发 80,443，22端口是可以通过外网进行访问的，如果自己的应用是8080,8088这个端口，需要在阿里云防火墙里面添加规则，并重启机器\n\n![network](https://user-images.githubusercontent.com/16111288/68524471-3c050000-0302-11ea-8d61-54e8fc0000fb.png)\n\n## 通过xshell进入服务器\n\n![network](https://user-images.githubusercontent.com/16111288/68524476-4c1cdf80-0302-11ea-825b-aa3ce6144c22.png)\n\n# 访问github慢\n\ngithub的CDN被某墙屏了，由于网络代理商的原因，所以访问下载很慢。ping github.com 时，速度只有300多ms。\n绕过dns解析，在本地直接绑定host，该方法也可加速其他因为CDN被屏蔽导致访问慢的网站。\nwindows系统的hosts文件的位置如下：C:\\Windows\\System32\\drivers\\etc\\hosts\nmac/linux系统的hosts文件的位置如下：/etc/hosts\n\n修改windows里的hosts文件，添加如下内容\n\n`# Github\n151.101.44.249 github.global.ssl.fastly.net \n192.30.253.113 github.com \n103.245.222.133 assets-cdn.github.com \n23.235.47.133 assets-cdn.github.com \n203.208.39.104 assets-cdn.github.com \n204.232.175.78 documentcloud.github.com \n204.232.175.94 gist.github.com \n107.21.116.220 help.github.com \n207.97.227.252 nodeload.github.com \n199.27.76.130 raw.github.com \n107.22.3.110 status.github.com \n204.232.175.78 training.github.com \n207.97.227.243 www.github.com \n185.31.16.184 github.global.ssl.fastly.net \n185.31.18.133 avatars0.githubusercontent.com \n185.31.19.133 avatars1.githubusercontent.com\n192.30.253.120 codeload.github.com`","source":"_posts/Jenkins对前端应用做自动化构建.md","raw":"---\ntitle: Jenkins对前端应用做自动化构建\ndate: 2019-12-03 16:58:31\ncategories: 工具\n---\n# Jenkins是什么\nJenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能，最初的创建者川口清子（Kohsuke Kawaguchi）。他独自写了大部分代码\n\n<!--more-->\n![network](https://user-images.githubusercontent.com/16111288/68524077-01e52f80-02fd-11ea-9531-d039a4c77113.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68523536-9c417500-02f5-11ea-9862-dd7bc23ae9ec.png)\n\n# 概要\n\n今天分享的主要内容有\n- Docker简单介绍\n- Jenkins的简介与安装\n- Jenkins对接Github 项目做持续集成\n- Jenkins构建项目的几种方式\n- Jenkins上传前端包到文件服务器\n- 云服务器简单使用介绍\n\n\n涉及到的资源和工具\n- 一台阿里云Linux服务器（默认安装Centos）。\n- Xshell：一个Windows软件，脚本的方式来操作服务器。\n- XFTP：是Xshell的一个插件，能图形化看到服务器的文件。\n- Nginx：展示前端页面\n- Docker：一个运行Jenkins的容器\n- Jenkins\n- Git\n\n# 现状\n如今我们已经到前后端分离开发的模式。通常情况下，前端只需要把HTML，CSS，JS打包好之后，发给后端部署即可。最能体现这个场景比如使用vue来开发前端项目的时候，利用vue-cli脚手架来帮我们打包npm run build。 最终会生成一个dist目录，我们只需提供这个dist包给后端开发人员即可。\n\n如果只发一个版本，这种方式完全OK，但是如果需要频繁的更新版本，就会有如下图的操作，各个人员在频发互传代码包，容易出问题。这对于前后端来说，都是一个很低效的事情。\n\n![network](https://user-images.githubusercontent.com/16111288/68523471-c6466780-02f4-11ea-8700-e6c5e0bef519.png)\n\n因此我们需要将低效的手动式部署，升级为更加先进的工程化，流水线式的持续部署。Jenkins就很好的可以做这样的事情，而且我们公司的持续集成也是使用这个工具。\n\n# CI/CD\n## 持续集成Continuous Integration（CI）\n持续集成强调开发人员提交了新代码之后，立刻自动的进行构建、（单元）测试。根据测试结果，我们可以确定新代码和原有代码能否正确地集成在一起。\n持续集成过程中很重视自动化测试验证结果，对可能出现的一些问题进行预警，以保障最终合并的代码没有问题。\n\n## 持续交付Continuous Delivery（CD）\n持续交付在持续集成的基础上，将集成后的代码部署到更贴近真实运行环境的「类生产环境」（production-like environments）中。交付给质量团队或者用户，以供评审。如果评审通过，代码就进入生产阶段。\n持续交付并不是指软件每一个改动都要尽快部署到产品环境中，它指的是任何的代码修改都可以在任何时候实施部署。\n这里强调的是\n\n- 手动部署\n- 有部署的能力，但不一定部署\n\n## 持续部署（Continuous Deployment)\n持续部署是指当交付的代码通过评审之后，自动部署到生产环境中。持续部署是持续交付的最高阶段。\n这里强调\n\n- 持续部署是自动的\n- 持续部署是持续交付的最高阶段\n\n## 总结\n「持续集成（Continuous Integration）」、「持续交付（Continuous Delivery）」和「持续部署（Continuous Deployment）」提供了一个优秀的 DevOps 环境，对于整个团队来说，好处与挑战并行。无论如何，频繁部署、快速交付以及开发测试流程自动化都将成为未来软件工程的重要组成部分。\n\n# Docker\n\n## docker简介\n\nDocker 是现今非常流行的一种容器化打包和发布工具，配合Git、SVN等代码版本管理工具， Jenkins、Gitlab Runner等持续集成工具，以及Swarn、Kubernetes 等容器编排工具，可以形成一个完整的软件自动化集成、测试发布流水线（CI/CD），可以有效的提升团队的生产效率和运维体验。\n\nDocker是一种Linux容器技术，容器有效的将由单个操作系统挂管理的资源划分到孤立的组中，以便更好的在组之间平衡有冲突的资源使用需求。可简单理解为一种沙盒 。每个容器内运行一个应用，不同的容器之间相互隔离，容器之间也可以建立通信机制。容器的创建和停止都十分快速，资源需求远远低于虚拟机，一个非常明显的区别就是在运行虚拟机中包含有操作系统，而容器中却没有。\n\n虚拟机正因为带有独立的操作系统，它可以通过这个操作系统内核进行对硬件资源的自主访问，成为一个独立完备的计算机小生态。Docker容器不具备这样的功能，它只能通过与宿主机共享操作系统内核来进行硬件资源的访问，但这也不是docker 的缺点，反而因为不需要携带自己的操作系统，容器变得更小更轻量，创建容器变得非常快速\n\n## docker与虚拟机对比\n| 特性       | docker容器           | 虚拟机               |\n| ---------- | -------------------- | -------------------- |\n| 启动速度   | 秒级                 | 分钟级               |\n| 硬盘使用   | 一般为MB             | 一般为GB             |\n| 性能       | 接近原生             | 弱于原生             |\n| 系统支持量 | 单台机支持上千个容器 | 单台机支持几十个容器 |\n| 隔离性     | 安全隔离             | 安全隔离             |\n\n## Docker容器\n\n 类似linux系统环境，运行和隔离应用。容器从镜像启动的时候，docker会在镜像的最上一层创建一个可写层，镜像本身是只读的，保持不变，是一个文件系统。\n\n## Docker镜像\n\nDocker镜像是一个Docker的可执行文件，其中包含了运行应用程序所需要的代码、依赖库、环境变量、配置文件等等，也是一个文件系统。\n\n## 仓库\n仓库分为本地仓库和远程仓库，是用于存储镜像的地方，通常在电脑上通过docker build 构建镜像后，镜像就被存放着在本地仓库中；当我们要转移、分发这些镜像的时候，就需要利用远程镜像仓库，讲镜像上传，方便后续其他电脑可以从小这些远程仓库中下载到我们的镜像。\n## Dockerfile\n\n如果你想要从一个基础镜像开始建立一个自定义镜像，可以选择一步一步进行构建，也可以选择写一个配置文件，然后一条命令（docker build）完成构建，显然配置文件的方式可以更好地应对需求的变更，这个配置文件就是Dockerfile。\n学习Dockerfile的最好方式就是阅读别人写的Dockerfile，遇到不会的指令就查一查Dockerfile的文档\n\n## 注意\n关机后，docker容器会停止运行，镜像会保留在硬盘上，就想关机了，软件就关闭了，但可以再次打开。\n\n# Jenkins\n\n## Jenkins安装\n建议直接在Linux上安装，首页的插件选择默认的安装。\n\n## Jenkins页面简介\n\n​\t\tjenkins系统的介绍\n\n## Jenkins插件安装\n\n作为CI/CD的调度中心，Jenkins具有十八般武艺，目前已有1500多个插件，功能非常强大，比如说我们用到的，node插件，npm插件，Github插件，ssh上传文件插件，还有很多插件，比较多人用的，导出测试报告，sonar代码扫描等等。如果再jenkins里面没有搜到想用的插件，去官网搜，下载后在回来安装需要额外安装的有：\n- Github plugin：把代码从Github上拉下来\n- Nodejs：运行前端项目，npm install，npm run build \n- Pubish Over SSH：把构建好的文件 上传到nginx\n- Email Extended  Template : 发送邮件通知\n\n### 在github配置钩子\n\tJenkins需要一个对项目有读写权限的账户，所以要在github生成一个token给jenkins使用，这个token，在后面需要用到。\n> \t进入github --> setting --> Personal Access Token --> Generate new token\n\n![network](https://user-images.githubusercontent.com/16111288/68523844-aebdad80-02f9-11ea-9294-828868dfdf69.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68523993-9e0e3700-02fb-11ea-9a0b-f07e19b9cc7f.png)\n\n拿到这个token之后先保存好，等会到jenkins中需要配置凭证\n我们有一个token可以访问到github了，但是还要对其中的项目设置钩子\n> \t进入GitHub上指定的项目 --> setting --> WebHooks&Services --> add webhook --> 输入刚刚部署jenkins的服务器的IP\n\n![network](https://user-images.githubusercontent.com/16111288/68524015-04935500-02fc-11ea-9a12-9cfd5bfc7695.png)\n\n## 在Jenkins和github钩子\n\n### 安装github plugin\n> 系统管理-->插件管理-->可选插件\n### 配置github plugin\n> 系统管理-->github plugin\n\nAPI URL 输入 `https://api.github.com`，Credentials点击Add添加，Kind选择Secret Text,具体如下图所示。\n\n![network](https://user-images.githubusercontent.com/16111288/68524053-c64a6580-02fc-11ea-9f2d-db3a71b304d3.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68524112-9485ce80-02fd-11ea-9047-d73780d20b48.png)\n\n设置完成后，点击`TestConnection`,提示`Credentials verified for user UUserName, rate limit: xxx`,则表明有效。\n\n## 构建配置\n\n## 构建方式\n\n- 手动构建：自己上Jenkins点击。\n- 自动构建：提交代码到git仓库之后，自动构建。\n- 定时构建：每隔一段时间构建一次，比如设置每天固定某个时间段构建。\n\n### 编写shell脚本\n\nShell 是一个用 C 语言编写的程序，它是用户使用 Linux 的桥梁。Shell 既是一种命令语言，又是一种程序设计语言。\n\n`node -v`\n`npm -v`\n`npm --registry https://registry.npm.taobao.org install`\n`npm run test:unit`\n`npm run build`\n\n### 参数化构建\n选择参数化构建，配置参数，在工程的首页就会多一个构建入口，参数化构建使得构建变得更加灵活。\n\n![network](https://user-images.githubusercontent.com/16111288/68524161-5d63ed00-02fe-11ea-9874-1f4672d47891.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68524197-a0be5b80-02fe-11ea-8765-a5505bc42420.png)\n\n### 上传构建包\n\n使用nginx做为文件服务器\n在机器上安装nginx\n在nginx上配置为文件资源服务器\n\n`location / {\n        root   /usr/share/nginx/html/static;\n        autoindex on;\n        autoindex_exact_size off;\n        autoindex_localtime on;\n    }`\n![network](https://user-images.githubusercontent.com/16111288/68524366-0b709680-0301-11ea-8892-a7e1e50f4cfa.png)\n\n## Jenkins系统配置SSH账号\n\n安装Publish Over SSH插件用于SSH连接远程的服务器。\n\n登录 jenkins 管理系统首页，打开“系统管理”--“管理插件”  搜索 Publish Over SSH 然后勾选安装\n配置远程服务器的连接\n\n打开“系统管理”--“系统设置”  找到 “Publish over SSH” 项 ，我这里远程服务器用的是ssh登录，通过ppk密钥进行连接，所以我的配置如图，如果是帐号密码登录的Passphrase填写密码Username填写用户名，path to key 为空就可以了。\n\n![network](https://user-images.githubusercontent.com/16111288/68524390-5094c880-0301-11ea-8559-ad729ff4f671.png)\n\n点击 Test Configuration 按钮测试连接是否成功\n\n![network](https://user-images.githubusercontent.com/16111288/68524400-6bffd380-0301-11ea-840d-96bc52a4257b.png)\n\n### JOB添加构建后上传\n\n> “构建后操作步骤”---“Send build artifacts over SSH” \n\nName：第三步创建的远程服务器名称\n\nSource files：本地需要传输过去的文件路径\n\nRemove prefix：过滤掉的目录名\n\nRemote directory：远程服务器的保存路径\n\nExec command：传输完成后在远程服务器执行的sh命令\n\n![network](https://user-images.githubusercontent.com/16111288/68524450-03652680-0302-11ea-9bce-f7b42ddf589d.png)\n\n## 构建后邮件通知\n构建成功之后，可以进行邮件通知。\n第一步，先到插件管理安装插件，Email Extension Plugin，我只搜到了Email EXtension Template，所以就安装了它\n\n\n如果是QQ邮箱，先去获取一个独立密码\n\n![network](https://user-images.githubusercontent.com/16111288/68524622-02cd8f80-0304-11ea-949b-ec148ea39d08.png)\n\n> 系统管理-->系统设置--> Extended E-mail Notification\n\n![network](https://user-images.githubusercontent.com/16111288/68524633-1a0c7d00-0304-11ea-8bdb-3c94222fcfb8.png)\n\n![network](https://user-images.githubusercontent.com/16111288/68524636-21338b00-0304-11ea-8ac7-0e8aa0f07aab.png)\n\n## 配置邮件报错\n\n![network](https://user-images.githubusercontent.com/16111288/68524653-593ace00-0304-11ea-9b60-d4f4227f020c.png)\n\n邮件配置的过程出错，是因为管理的邮箱没有配置，到用户设置去设置\n\n![network](https://user-images.githubusercontent.com/16111288/68524659-6952ad80-0304-11ea-846b-fb1dc721ab56.png)\n\n### 构建后选择接收人\n\n![network](https://user-images.githubusercontent.com/16111288/68524667-7f606e00-0304-11ea-8425-84fbd475e9af.png)\n\n\n## 注意\n\n 对于新手来说，Jenkin最好直接安装在机器上，安装在docker上的话，Jenkins无法访问到宿主机器的环境变量，比如我在机器上安装Yarn，但docker上的Jenkins无法访问得到Yarn，只能老老实实的使用npm。\n\n\n\n## 遇到的问题\n\n- 学习Jenkins，Docker这种工具，最好租一个服务器，不需要买域名，按月租就够了。\n- 境外服务器的比境内便宜，但境外的经常连不上去，每天总有几个小时连不上去。\n- 构建过程中npm install总是失败，服务器从1G内存扩容到2G 之后又成功了。\n- Docker安装的jenkins无法访问到本机的环境变量，例如无法在构建脚本中写Yarn命令。\n\n\n# 阿里云简介\n\n轻量应用型服务器，便宜，适合学习。\n买好之后，在点击进入自己的机器\n\n![network](https://user-images.githubusercontent.com/16111288/68524467-30193e00-0302-11ea-8266-0114201443ba.png)\n\n服务器默认只开发 80,443，22端口是可以通过外网进行访问的，如果自己的应用是8080,8088这个端口，需要在阿里云防火墙里面添加规则，并重启机器\n\n![network](https://user-images.githubusercontent.com/16111288/68524471-3c050000-0302-11ea-8d61-54e8fc0000fb.png)\n\n## 通过xshell进入服务器\n\n![network](https://user-images.githubusercontent.com/16111288/68524476-4c1cdf80-0302-11ea-825b-aa3ce6144c22.png)\n\n# 访问github慢\n\ngithub的CDN被某墙屏了，由于网络代理商的原因，所以访问下载很慢。ping github.com 时，速度只有300多ms。\n绕过dns解析，在本地直接绑定host，该方法也可加速其他因为CDN被屏蔽导致访问慢的网站。\nwindows系统的hosts文件的位置如下：C:\\Windows\\System32\\drivers\\etc\\hosts\nmac/linux系统的hosts文件的位置如下：/etc/hosts\n\n修改windows里的hosts文件，添加如下内容\n\n`# Github\n151.101.44.249 github.global.ssl.fastly.net \n192.30.253.113 github.com \n103.245.222.133 assets-cdn.github.com \n23.235.47.133 assets-cdn.github.com \n203.208.39.104 assets-cdn.github.com \n204.232.175.78 documentcloud.github.com \n204.232.175.94 gist.github.com \n107.21.116.220 help.github.com \n207.97.227.252 nodeload.github.com \n199.27.76.130 raw.github.com \n107.22.3.110 status.github.com \n204.232.175.78 training.github.com \n207.97.227.243 www.github.com \n185.31.16.184 github.global.ssl.fastly.net \n185.31.18.133 avatars0.githubusercontent.com \n185.31.19.133 avatars1.githubusercontent.com\n192.30.253.120 codeload.github.com`","slug":"Jenkins对前端应用做自动化构建","published":1,"updated":"2021-03-29T15:09:23.072Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wp000nl5v093t9h5vi","content":"<h1 id=\"Jenkins是什么\"><a href=\"#Jenkins是什么\" class=\"headerlink\" title=\"Jenkins是什么\"></a>Jenkins是什么</h1><p>Jenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能，最初的创建者川口清子（Kohsuke Kawaguchi）。他独自写了大部分代码</p>\n<span id=\"more\"></span>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524077-01e52f80-02fd-11ea-9531-d039a4c77113.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68523536-9c417500-02f5-11ea-9862-dd7bc23ae9ec.png\" alt=\"network\"></p>\n<h1 id=\"概要\"><a href=\"#概要\" class=\"headerlink\" title=\"概要\"></a>概要</h1><p>今天分享的主要内容有</p>\n<ul>\n<li>Docker简单介绍</li>\n<li>Jenkins的简介与安装</li>\n<li>Jenkins对接Github 项目做持续集成</li>\n<li>Jenkins构建项目的几种方式</li>\n<li>Jenkins上传前端包到文件服务器</li>\n<li>云服务器简单使用介绍</li>\n</ul>\n<p>涉及到的资源和工具</p>\n<ul>\n<li>一台阿里云Linux服务器（默认安装Centos）。</li>\n<li>Xshell：一个Windows软件，脚本的方式来操作服务器。</li>\n<li>XFTP：是Xshell的一个插件，能图形化看到服务器的文件。</li>\n<li>Nginx：展示前端页面</li>\n<li>Docker：一个运行Jenkins的容器</li>\n<li>Jenkins</li>\n<li>Git</li>\n</ul>\n<h1 id=\"现状\"><a href=\"#现状\" class=\"headerlink\" title=\"现状\"></a>现状</h1><p>如今我们已经到前后端分离开发的模式。通常情况下，前端只需要把HTML，CSS，JS打包好之后，发给后端部署即可。最能体现这个场景比如使用vue来开发前端项目的时候，利用vue-cli脚手架来帮我们打包npm run build。 最终会生成一个dist目录，我们只需提供这个dist包给后端开发人员即可。</p>\n<p>如果只发一个版本，这种方式完全OK，但是如果需要频繁的更新版本，就会有如下图的操作，各个人员在频发互传代码包，容易出问题。这对于前后端来说，都是一个很低效的事情。</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68523471-c6466780-02f4-11ea-8700-e6c5e0bef519.png\" alt=\"network\"></p>\n<p>因此我们需要将低效的手动式部署，升级为更加先进的工程化，流水线式的持续部署。Jenkins就很好的可以做这样的事情，而且我们公司的持续集成也是使用这个工具。</p>\n<h1 id=\"CI-CD\"><a href=\"#CI-CD\" class=\"headerlink\" title=\"CI/CD\"></a>CI/CD</h1><h2 id=\"持续集成Continuous-Integration（CI）\"><a href=\"#持续集成Continuous-Integration（CI）\" class=\"headerlink\" title=\"持续集成Continuous Integration（CI）\"></a>持续集成Continuous Integration（CI）</h2><p>持续集成强调开发人员提交了新代码之后，立刻自动的进行构建、（单元）测试。根据测试结果，我们可以确定新代码和原有代码能否正确地集成在一起。<br>持续集成过程中很重视自动化测试验证结果，对可能出现的一些问题进行预警，以保障最终合并的代码没有问题。</p>\n<h2 id=\"持续交付Continuous-Delivery（CD）\"><a href=\"#持续交付Continuous-Delivery（CD）\" class=\"headerlink\" title=\"持续交付Continuous Delivery（CD）\"></a>持续交付Continuous Delivery（CD）</h2><p>持续交付在持续集成的基础上，将集成后的代码部署到更贴近真实运行环境的「类生产环境」（production-like environments）中。交付给质量团队或者用户，以供评审。如果评审通过，代码就进入生产阶段。<br>持续交付并不是指软件每一个改动都要尽快部署到产品环境中，它指的是任何的代码修改都可以在任何时候实施部署。<br>这里强调的是</p>\n<ul>\n<li>手动部署</li>\n<li>有部署的能力，但不一定部署</li>\n</ul>\n<h2 id=\"持续部署（Continuous-Deployment\"><a href=\"#持续部署（Continuous-Deployment\" class=\"headerlink\" title=\"持续部署（Continuous Deployment)\"></a>持续部署（Continuous Deployment)</h2><p>持续部署是指当交付的代码通过评审之后，自动部署到生产环境中。持续部署是持续交付的最高阶段。<br>这里强调</p>\n<ul>\n<li>持续部署是自动的</li>\n<li>持续部署是持续交付的最高阶段</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>「持续集成（Continuous Integration）」、「持续交付（Continuous Delivery）」和「持续部署（Continuous Deployment）」提供了一个优秀的 DevOps 环境，对于整个团队来说，好处与挑战并行。无论如何，频繁部署、快速交付以及开发测试流程自动化都将成为未来软件工程的重要组成部分。</p>\n<h1 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h1><h2 id=\"docker简介\"><a href=\"#docker简介\" class=\"headerlink\" title=\"docker简介\"></a>docker简介</h2><p>Docker 是现今非常流行的一种容器化打包和发布工具，配合Git、SVN等代码版本管理工具， Jenkins、Gitlab Runner等持续集成工具，以及Swarn、Kubernetes 等容器编排工具，可以形成一个完整的软件自动化集成、测试发布流水线（CI/CD），可以有效的提升团队的生产效率和运维体验。</p>\n<p>Docker是一种Linux容器技术，容器有效的将由单个操作系统挂管理的资源划分到孤立的组中，以便更好的在组之间平衡有冲突的资源使用需求。可简单理解为一种沙盒 。每个容器内运行一个应用，不同的容器之间相互隔离，容器之间也可以建立通信机制。容器的创建和停止都十分快速，资源需求远远低于虚拟机，一个非常明显的区别就是在运行虚拟机中包含有操作系统，而容器中却没有。</p>\n<p>虚拟机正因为带有独立的操作系统，它可以通过这个操作系统内核进行对硬件资源的自主访问，成为一个独立完备的计算机小生态。Docker容器不具备这样的功能，它只能通过与宿主机共享操作系统内核来进行硬件资源的访问，但这也不是docker 的缺点，反而因为不需要携带自己的操作系统，容器变得更小更轻量，创建容器变得非常快速</p>\n<h2 id=\"docker与虚拟机对比\"><a href=\"#docker与虚拟机对比\" class=\"headerlink\" title=\"docker与虚拟机对比\"></a>docker与虚拟机对比</h2><table>\n<thead>\n<tr>\n<th>特性</th>\n<th>docker容器</th>\n<th>虚拟机</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>启动速度</td>\n<td>秒级</td>\n<td>分钟级</td>\n</tr>\n<tr>\n<td>硬盘使用</td>\n<td>一般为MB</td>\n<td>一般为GB</td>\n</tr>\n<tr>\n<td>性能</td>\n<td>接近原生</td>\n<td>弱于原生</td>\n</tr>\n<tr>\n<td>系统支持量</td>\n<td>单台机支持上千个容器</td>\n<td>单台机支持几十个容器</td>\n</tr>\n<tr>\n<td>隔离性</td>\n<td>安全隔离</td>\n<td>安全隔离</td>\n</tr>\n</tbody></table>\n<h2 id=\"Docker容器\"><a href=\"#Docker容器\" class=\"headerlink\" title=\"Docker容器\"></a>Docker容器</h2><p> 类似linux系统环境，运行和隔离应用。容器从镜像启动的时候，docker会在镜像的最上一层创建一个可写层，镜像本身是只读的，保持不变，是一个文件系统。</p>\n<h2 id=\"Docker镜像\"><a href=\"#Docker镜像\" class=\"headerlink\" title=\"Docker镜像\"></a>Docker镜像</h2><p>Docker镜像是一个Docker的可执行文件，其中包含了运行应用程序所需要的代码、依赖库、环境变量、配置文件等等，也是一个文件系统。</p>\n<h2 id=\"仓库\"><a href=\"#仓库\" class=\"headerlink\" title=\"仓库\"></a>仓库</h2><p>仓库分为本地仓库和远程仓库，是用于存储镜像的地方，通常在电脑上通过docker build 构建镜像后，镜像就被存放着在本地仓库中；当我们要转移、分发这些镜像的时候，就需要利用远程镜像仓库，讲镜像上传，方便后续其他电脑可以从小这些远程仓库中下载到我们的镜像。</p>\n<h2 id=\"Dockerfile\"><a href=\"#Dockerfile\" class=\"headerlink\" title=\"Dockerfile\"></a>Dockerfile</h2><p>如果你想要从一个基础镜像开始建立一个自定义镜像，可以选择一步一步进行构建，也可以选择写一个配置文件，然后一条命令（docker build）完成构建，显然配置文件的方式可以更好地应对需求的变更，这个配置文件就是Dockerfile。<br>学习Dockerfile的最好方式就是阅读别人写的Dockerfile，遇到不会的指令就查一查Dockerfile的文档</p>\n<h2 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p>关机后，docker容器会停止运行，镜像会保留在硬盘上，就想关机了，软件就关闭了，但可以再次打开。</p>\n<h1 id=\"Jenkins\"><a href=\"#Jenkins\" class=\"headerlink\" title=\"Jenkins\"></a>Jenkins</h1><h2 id=\"Jenkins安装\"><a href=\"#Jenkins安装\" class=\"headerlink\" title=\"Jenkins安装\"></a>Jenkins安装</h2><p>建议直接在Linux上安装，首页的插件选择默认的安装。</p>\n<h2 id=\"Jenkins页面简介\"><a href=\"#Jenkins页面简介\" class=\"headerlink\" title=\"Jenkins页面简介\"></a>Jenkins页面简介</h2><p>​        jenkins系统的介绍</p>\n<h2 id=\"Jenkins插件安装\"><a href=\"#Jenkins插件安装\" class=\"headerlink\" title=\"Jenkins插件安装\"></a>Jenkins插件安装</h2><p>作为CI/CD的调度中心，Jenkins具有十八般武艺，目前已有1500多个插件，功能非常强大，比如说我们用到的，node插件，npm插件，Github插件，ssh上传文件插件，还有很多插件，比较多人用的，导出测试报告，sonar代码扫描等等。如果再jenkins里面没有搜到想用的插件，去官网搜，下载后在回来安装需要额外安装的有：</p>\n<ul>\n<li>Github plugin：把代码从Github上拉下来</li>\n<li>Nodejs：运行前端项目，npm install，npm run build </li>\n<li>Pubish Over SSH：把构建好的文件 上传到nginx</li>\n<li>Email Extended  Template : 发送邮件通知</li>\n</ul>\n<h3 id=\"在github配置钩子\"><a href=\"#在github配置钩子\" class=\"headerlink\" title=\"在github配置钩子\"></a>在github配置钩子</h3><pre><code>Jenkins需要一个对项目有读写权限的账户，所以要在github生成一个token给jenkins使用，这个token，在后面需要用到。\n</code></pre>\n<blockquote>\n<pre><code>进入github --&gt; setting --&gt; Personal Access Token --&gt; Generate new token\n</code></pre>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68523844-aebdad80-02f9-11ea-9294-828868dfdf69.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68523993-9e0e3700-02fb-11ea-9a0b-f07e19b9cc7f.png\" alt=\"network\"></p>\n<p>拿到这个token之后先保存好，等会到jenkins中需要配置凭证<br>我们有一个token可以访问到github了，但是还要对其中的项目设置钩子</p>\n<blockquote>\n<pre><code>进入GitHub上指定的项目 --&gt; setting --&gt; WebHooks&amp;Services --&gt; add webhook --&gt; 输入刚刚部署jenkins的服务器的IP\n</code></pre>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524015-04935500-02fc-11ea-9a12-9cfd5bfc7695.png\" alt=\"network\"></p>\n<h2 id=\"在Jenkins和github钩子\"><a href=\"#在Jenkins和github钩子\" class=\"headerlink\" title=\"在Jenkins和github钩子\"></a>在Jenkins和github钩子</h2><h3 id=\"安装github-plugin\"><a href=\"#安装github-plugin\" class=\"headerlink\" title=\"安装github plugin\"></a>安装github plugin</h3><blockquote>\n<p>系统管理–&gt;插件管理–&gt;可选插件</p>\n</blockquote>\n<h3 id=\"配置github-plugin\"><a href=\"#配置github-plugin\" class=\"headerlink\" title=\"配置github plugin\"></a>配置github plugin</h3><blockquote>\n<p>系统管理–&gt;github plugin</p>\n</blockquote>\n<p>API URL 输入 <code>https://api.github.com</code>，Credentials点击Add添加，Kind选择Secret Text,具体如下图所示。</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524053-c64a6580-02fc-11ea-9f2d-db3a71b304d3.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524112-9485ce80-02fd-11ea-9047-d73780d20b48.png\" alt=\"network\"></p>\n<p>设置完成后，点击<code>TestConnection</code>,提示<code>Credentials verified for user UUserName, rate limit: xxx</code>,则表明有效。</p>\n<h2 id=\"构建配置\"><a href=\"#构建配置\" class=\"headerlink\" title=\"构建配置\"></a>构建配置</h2><h2 id=\"构建方式\"><a href=\"#构建方式\" class=\"headerlink\" title=\"构建方式\"></a>构建方式</h2><ul>\n<li>手动构建：自己上Jenkins点击。</li>\n<li>自动构建：提交代码到git仓库之后，自动构建。</li>\n<li>定时构建：每隔一段时间构建一次，比如设置每天固定某个时间段构建。</li>\n</ul>\n<h3 id=\"编写shell脚本\"><a href=\"#编写shell脚本\" class=\"headerlink\" title=\"编写shell脚本\"></a>编写shell脚本</h3><p>Shell 是一个用 C 语言编写的程序，它是用户使用 Linux 的桥梁。Shell 既是一种命令语言，又是一种程序设计语言。</p>\n<p><code>node -v</code><br><code>npm -v</code><br><code>npm --registry https://registry.npm.taobao.org install</code><br><code>npm run test:unit</code><br><code>npm run build</code></p>\n<h3 id=\"参数化构建\"><a href=\"#参数化构建\" class=\"headerlink\" title=\"参数化构建\"></a>参数化构建</h3><p>选择参数化构建，配置参数，在工程的首页就会多一个构建入口，参数化构建使得构建变得更加灵活。</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524161-5d63ed00-02fe-11ea-9874-1f4672d47891.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524197-a0be5b80-02fe-11ea-8765-a5505bc42420.png\" alt=\"network\"></p>\n<h3 id=\"上传构建包\"><a href=\"#上传构建包\" class=\"headerlink\" title=\"上传构建包\"></a>上传构建包</h3><p>使用nginx做为文件服务器<br>在机器上安装nginx<br>在nginx上配置为文件资源服务器</p>\n<p><code>location / &#123;         root   /usr/share/nginx/html/static;         autoindex on;         autoindex_exact_size off;         autoindex_localtime on;     &#125;</code><br><img src=\"https://user-images.githubusercontent.com/16111288/68524366-0b709680-0301-11ea-8892-a7e1e50f4cfa.png\" alt=\"network\"></p>\n<h2 id=\"Jenkins系统配置SSH账号\"><a href=\"#Jenkins系统配置SSH账号\" class=\"headerlink\" title=\"Jenkins系统配置SSH账号\"></a>Jenkins系统配置SSH账号</h2><p>安装Publish Over SSH插件用于SSH连接远程的服务器。</p>\n<p>登录 jenkins 管理系统首页，打开“系统管理”–“管理插件”  搜索 Publish Over SSH 然后勾选安装<br>配置远程服务器的连接</p>\n<p>打开“系统管理”–“系统设置”  找到 “Publish over SSH” 项 ，我这里远程服务器用的是ssh登录，通过ppk密钥进行连接，所以我的配置如图，如果是帐号密码登录的Passphrase填写密码Username填写用户名，path to key 为空就可以了。</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524390-5094c880-0301-11ea-8559-ad729ff4f671.png\" alt=\"network\"></p>\n<p>点击 Test Configuration 按钮测试连接是否成功</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524400-6bffd380-0301-11ea-840d-96bc52a4257b.png\" alt=\"network\"></p>\n<h3 id=\"JOB添加构建后上传\"><a href=\"#JOB添加构建后上传\" class=\"headerlink\" title=\"JOB添加构建后上传\"></a>JOB添加构建后上传</h3><blockquote>\n<p>“构建后操作步骤”—“Send build artifacts over SSH” </p>\n</blockquote>\n<p>Name：第三步创建的远程服务器名称</p>\n<p>Source files：本地需要传输过去的文件路径</p>\n<p>Remove prefix：过滤掉的目录名</p>\n<p>Remote directory：远程服务器的保存路径</p>\n<p>Exec command：传输完成后在远程服务器执行的sh命令</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524450-03652680-0302-11ea-9bce-f7b42ddf589d.png\" alt=\"network\"></p>\n<h2 id=\"构建后邮件通知\"><a href=\"#构建后邮件通知\" class=\"headerlink\" title=\"构建后邮件通知\"></a>构建后邮件通知</h2><p>构建成功之后，可以进行邮件通知。<br>第一步，先到插件管理安装插件，Email Extension Plugin，我只搜到了Email EXtension Template，所以就安装了它</p>\n<p>如果是QQ邮箱，先去获取一个独立密码</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524622-02cd8f80-0304-11ea-949b-ec148ea39d08.png\" alt=\"network\"></p>\n<blockquote>\n<p>系统管理–&gt;系统设置–&gt; Extended E-mail Notification</p>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524633-1a0c7d00-0304-11ea-8bdb-3c94222fcfb8.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524636-21338b00-0304-11ea-8ac7-0e8aa0f07aab.png\" alt=\"network\"></p>\n<h2 id=\"配置邮件报错\"><a href=\"#配置邮件报错\" class=\"headerlink\" title=\"配置邮件报错\"></a>配置邮件报错</h2><p><img src=\"https://user-images.githubusercontent.com/16111288/68524653-593ace00-0304-11ea-9b60-d4f4227f020c.png\" alt=\"network\"></p>\n<p>邮件配置的过程出错，是因为管理的邮箱没有配置，到用户设置去设置</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524659-6952ad80-0304-11ea-846b-fb1dc721ab56.png\" alt=\"network\"></p>\n<h3 id=\"构建后选择接收人\"><a href=\"#构建后选择接收人\" class=\"headerlink\" title=\"构建后选择接收人\"></a>构建后选择接收人</h3><p><img src=\"https://user-images.githubusercontent.com/16111288/68524667-7f606e00-0304-11ea-8425-84fbd475e9af.png\" alt=\"network\"></p>\n<h2 id=\"注意-1\"><a href=\"#注意-1\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p> 对于新手来说，Jenkin最好直接安装在机器上，安装在docker上的话，Jenkins无法访问到宿主机器的环境变量，比如我在机器上安装Yarn，但docker上的Jenkins无法访问得到Yarn，只能老老实实的使用npm。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><ul>\n<li>学习Jenkins，Docker这种工具，最好租一个服务器，不需要买域名，按月租就够了。</li>\n<li>境外服务器的比境内便宜，但境外的经常连不上去，每天总有几个小时连不上去。</li>\n<li>构建过程中npm install总是失败，服务器从1G内存扩容到2G 之后又成功了。</li>\n<li>Docker安装的jenkins无法访问到本机的环境变量，例如无法在构建脚本中写Yarn命令。</li>\n</ul>\n<h1 id=\"阿里云简介\"><a href=\"#阿里云简介\" class=\"headerlink\" title=\"阿里云简介\"></a>阿里云简介</h1><p>轻量应用型服务器，便宜，适合学习。<br>买好之后，在点击进入自己的机器</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524467-30193e00-0302-11ea-8266-0114201443ba.png\" alt=\"network\"></p>\n<p>服务器默认只开发 80,443，22端口是可以通过外网进行访问的，如果自己的应用是8080,8088这个端口，需要在阿里云防火墙里面添加规则，并重启机器</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524471-3c050000-0302-11ea-8d61-54e8fc0000fb.png\" alt=\"network\"></p>\n<h2 id=\"通过xshell进入服务器\"><a href=\"#通过xshell进入服务器\" class=\"headerlink\" title=\"通过xshell进入服务器\"></a>通过xshell进入服务器</h2><p><img src=\"https://user-images.githubusercontent.com/16111288/68524476-4c1cdf80-0302-11ea-825b-aa3ce6144c22.png\" alt=\"network\"></p>\n<h1 id=\"访问github慢\"><a href=\"#访问github慢\" class=\"headerlink\" title=\"访问github慢\"></a>访问github慢</h1><p>github的CDN被某墙屏了，由于网络代理商的原因，所以访问下载很慢。ping github.com 时，速度只有300多ms。<br>绕过dns解析，在本地直接绑定host，该方法也可加速其他因为CDN被屏蔽导致访问慢的网站。<br>windows系统的hosts文件的位置如下：C:\\Windows\\System32\\drivers\\etc\\hosts<br>mac/linux系统的hosts文件的位置如下：/etc/hosts</p>\n<p>修改windows里的hosts文件，添加如下内容</p>\n<p><code># Github 151.101.44.249 github.global.ssl.fastly.net  192.30.253.113 github.com  103.245.222.133 assets-cdn.github.com  23.235.47.133 assets-cdn.github.com  203.208.39.104 assets-cdn.github.com  204.232.175.78 documentcloud.github.com  204.232.175.94 gist.github.com  107.21.116.220 help.github.com  207.97.227.252 nodeload.github.com  199.27.76.130 raw.github.com  107.22.3.110 status.github.com  204.232.175.78 training.github.com  207.97.227.243 www.github.com  185.31.16.184 github.global.ssl.fastly.net  185.31.18.133 avatars0.githubusercontent.com  185.31.19.133 avatars1.githubusercontent.com 192.30.253.120 codeload.github.com</code></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"Jenkins是什么\"><a href=\"#Jenkins是什么\" class=\"headerlink\" title=\"Jenkins是什么\"></a>Jenkins是什么</h1><p>Jenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能，最初的创建者川口清子（Kohsuke Kawaguchi）。他独自写了大部分代码</p>","more":"<p><img src=\"https://user-images.githubusercontent.com/16111288/68524077-01e52f80-02fd-11ea-9531-d039a4c77113.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68523536-9c417500-02f5-11ea-9862-dd7bc23ae9ec.png\" alt=\"network\"></p>\n<h1 id=\"概要\"><a href=\"#概要\" class=\"headerlink\" title=\"概要\"></a>概要</h1><p>今天分享的主要内容有</p>\n<ul>\n<li>Docker简单介绍</li>\n<li>Jenkins的简介与安装</li>\n<li>Jenkins对接Github 项目做持续集成</li>\n<li>Jenkins构建项目的几种方式</li>\n<li>Jenkins上传前端包到文件服务器</li>\n<li>云服务器简单使用介绍</li>\n</ul>\n<p>涉及到的资源和工具</p>\n<ul>\n<li>一台阿里云Linux服务器（默认安装Centos）。</li>\n<li>Xshell：一个Windows软件，脚本的方式来操作服务器。</li>\n<li>XFTP：是Xshell的一个插件，能图形化看到服务器的文件。</li>\n<li>Nginx：展示前端页面</li>\n<li>Docker：一个运行Jenkins的容器</li>\n<li>Jenkins</li>\n<li>Git</li>\n</ul>\n<h1 id=\"现状\"><a href=\"#现状\" class=\"headerlink\" title=\"现状\"></a>现状</h1><p>如今我们已经到前后端分离开发的模式。通常情况下，前端只需要把HTML，CSS，JS打包好之后，发给后端部署即可。最能体现这个场景比如使用vue来开发前端项目的时候，利用vue-cli脚手架来帮我们打包npm run build。 最终会生成一个dist目录，我们只需提供这个dist包给后端开发人员即可。</p>\n<p>如果只发一个版本，这种方式完全OK，但是如果需要频繁的更新版本，就会有如下图的操作，各个人员在频发互传代码包，容易出问题。这对于前后端来说，都是一个很低效的事情。</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68523471-c6466780-02f4-11ea-8700-e6c5e0bef519.png\" alt=\"network\"></p>\n<p>因此我们需要将低效的手动式部署，升级为更加先进的工程化，流水线式的持续部署。Jenkins就很好的可以做这样的事情，而且我们公司的持续集成也是使用这个工具。</p>\n<h1 id=\"CI-CD\"><a href=\"#CI-CD\" class=\"headerlink\" title=\"CI/CD\"></a>CI/CD</h1><h2 id=\"持续集成Continuous-Integration（CI）\"><a href=\"#持续集成Continuous-Integration（CI）\" class=\"headerlink\" title=\"持续集成Continuous Integration（CI）\"></a>持续集成Continuous Integration（CI）</h2><p>持续集成强调开发人员提交了新代码之后，立刻自动的进行构建、（单元）测试。根据测试结果，我们可以确定新代码和原有代码能否正确地集成在一起。<br>持续集成过程中很重视自动化测试验证结果，对可能出现的一些问题进行预警，以保障最终合并的代码没有问题。</p>\n<h2 id=\"持续交付Continuous-Delivery（CD）\"><a href=\"#持续交付Continuous-Delivery（CD）\" class=\"headerlink\" title=\"持续交付Continuous Delivery（CD）\"></a>持续交付Continuous Delivery（CD）</h2><p>持续交付在持续集成的基础上，将集成后的代码部署到更贴近真实运行环境的「类生产环境」（production-like environments）中。交付给质量团队或者用户，以供评审。如果评审通过，代码就进入生产阶段。<br>持续交付并不是指软件每一个改动都要尽快部署到产品环境中，它指的是任何的代码修改都可以在任何时候实施部署。<br>这里强调的是</p>\n<ul>\n<li>手动部署</li>\n<li>有部署的能力，但不一定部署</li>\n</ul>\n<h2 id=\"持续部署（Continuous-Deployment\"><a href=\"#持续部署（Continuous-Deployment\" class=\"headerlink\" title=\"持续部署（Continuous Deployment)\"></a>持续部署（Continuous Deployment)</h2><p>持续部署是指当交付的代码通过评审之后，自动部署到生产环境中。持续部署是持续交付的最高阶段。<br>这里强调</p>\n<ul>\n<li>持续部署是自动的</li>\n<li>持续部署是持续交付的最高阶段</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>「持续集成（Continuous Integration）」、「持续交付（Continuous Delivery）」和「持续部署（Continuous Deployment）」提供了一个优秀的 DevOps 环境，对于整个团队来说，好处与挑战并行。无论如何，频繁部署、快速交付以及开发测试流程自动化都将成为未来软件工程的重要组成部分。</p>\n<h1 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h1><h2 id=\"docker简介\"><a href=\"#docker简介\" class=\"headerlink\" title=\"docker简介\"></a>docker简介</h2><p>Docker 是现今非常流行的一种容器化打包和发布工具，配合Git、SVN等代码版本管理工具， Jenkins、Gitlab Runner等持续集成工具，以及Swarn、Kubernetes 等容器编排工具，可以形成一个完整的软件自动化集成、测试发布流水线（CI/CD），可以有效的提升团队的生产效率和运维体验。</p>\n<p>Docker是一种Linux容器技术，容器有效的将由单个操作系统挂管理的资源划分到孤立的组中，以便更好的在组之间平衡有冲突的资源使用需求。可简单理解为一种沙盒 。每个容器内运行一个应用，不同的容器之间相互隔离，容器之间也可以建立通信机制。容器的创建和停止都十分快速，资源需求远远低于虚拟机，一个非常明显的区别就是在运行虚拟机中包含有操作系统，而容器中却没有。</p>\n<p>虚拟机正因为带有独立的操作系统，它可以通过这个操作系统内核进行对硬件资源的自主访问，成为一个独立完备的计算机小生态。Docker容器不具备这样的功能，它只能通过与宿主机共享操作系统内核来进行硬件资源的访问，但这也不是docker 的缺点，反而因为不需要携带自己的操作系统，容器变得更小更轻量，创建容器变得非常快速</p>\n<h2 id=\"docker与虚拟机对比\"><a href=\"#docker与虚拟机对比\" class=\"headerlink\" title=\"docker与虚拟机对比\"></a>docker与虚拟机对比</h2><table>\n<thead>\n<tr>\n<th>特性</th>\n<th>docker容器</th>\n<th>虚拟机</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>启动速度</td>\n<td>秒级</td>\n<td>分钟级</td>\n</tr>\n<tr>\n<td>硬盘使用</td>\n<td>一般为MB</td>\n<td>一般为GB</td>\n</tr>\n<tr>\n<td>性能</td>\n<td>接近原生</td>\n<td>弱于原生</td>\n</tr>\n<tr>\n<td>系统支持量</td>\n<td>单台机支持上千个容器</td>\n<td>单台机支持几十个容器</td>\n</tr>\n<tr>\n<td>隔离性</td>\n<td>安全隔离</td>\n<td>安全隔离</td>\n</tr>\n</tbody></table>\n<h2 id=\"Docker容器\"><a href=\"#Docker容器\" class=\"headerlink\" title=\"Docker容器\"></a>Docker容器</h2><p> 类似linux系统环境，运行和隔离应用。容器从镜像启动的时候，docker会在镜像的最上一层创建一个可写层，镜像本身是只读的，保持不变，是一个文件系统。</p>\n<h2 id=\"Docker镜像\"><a href=\"#Docker镜像\" class=\"headerlink\" title=\"Docker镜像\"></a>Docker镜像</h2><p>Docker镜像是一个Docker的可执行文件，其中包含了运行应用程序所需要的代码、依赖库、环境变量、配置文件等等，也是一个文件系统。</p>\n<h2 id=\"仓库\"><a href=\"#仓库\" class=\"headerlink\" title=\"仓库\"></a>仓库</h2><p>仓库分为本地仓库和远程仓库，是用于存储镜像的地方，通常在电脑上通过docker build 构建镜像后，镜像就被存放着在本地仓库中；当我们要转移、分发这些镜像的时候，就需要利用远程镜像仓库，讲镜像上传，方便后续其他电脑可以从小这些远程仓库中下载到我们的镜像。</p>\n<h2 id=\"Dockerfile\"><a href=\"#Dockerfile\" class=\"headerlink\" title=\"Dockerfile\"></a>Dockerfile</h2><p>如果你想要从一个基础镜像开始建立一个自定义镜像，可以选择一步一步进行构建，也可以选择写一个配置文件，然后一条命令（docker build）完成构建，显然配置文件的方式可以更好地应对需求的变更，这个配置文件就是Dockerfile。<br>学习Dockerfile的最好方式就是阅读别人写的Dockerfile，遇到不会的指令就查一查Dockerfile的文档</p>\n<h2 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p>关机后，docker容器会停止运行，镜像会保留在硬盘上，就想关机了，软件就关闭了，但可以再次打开。</p>\n<h1 id=\"Jenkins\"><a href=\"#Jenkins\" class=\"headerlink\" title=\"Jenkins\"></a>Jenkins</h1><h2 id=\"Jenkins安装\"><a href=\"#Jenkins安装\" class=\"headerlink\" title=\"Jenkins安装\"></a>Jenkins安装</h2><p>建议直接在Linux上安装，首页的插件选择默认的安装。</p>\n<h2 id=\"Jenkins页面简介\"><a href=\"#Jenkins页面简介\" class=\"headerlink\" title=\"Jenkins页面简介\"></a>Jenkins页面简介</h2><p>​        jenkins系统的介绍</p>\n<h2 id=\"Jenkins插件安装\"><a href=\"#Jenkins插件安装\" class=\"headerlink\" title=\"Jenkins插件安装\"></a>Jenkins插件安装</h2><p>作为CI/CD的调度中心，Jenkins具有十八般武艺，目前已有1500多个插件，功能非常强大，比如说我们用到的，node插件，npm插件，Github插件，ssh上传文件插件，还有很多插件，比较多人用的，导出测试报告，sonar代码扫描等等。如果再jenkins里面没有搜到想用的插件，去官网搜，下载后在回来安装需要额外安装的有：</p>\n<ul>\n<li>Github plugin：把代码从Github上拉下来</li>\n<li>Nodejs：运行前端项目，npm install，npm run build </li>\n<li>Pubish Over SSH：把构建好的文件 上传到nginx</li>\n<li>Email Extended  Template : 发送邮件通知</li>\n</ul>\n<h3 id=\"在github配置钩子\"><a href=\"#在github配置钩子\" class=\"headerlink\" title=\"在github配置钩子\"></a>在github配置钩子</h3><pre><code>Jenkins需要一个对项目有读写权限的账户，所以要在github生成一个token给jenkins使用，这个token，在后面需要用到。\n</code></pre>\n<blockquote>\n<pre><code>进入github --&gt; setting --&gt; Personal Access Token --&gt; Generate new token\n</code></pre>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68523844-aebdad80-02f9-11ea-9294-828868dfdf69.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68523993-9e0e3700-02fb-11ea-9a0b-f07e19b9cc7f.png\" alt=\"network\"></p>\n<p>拿到这个token之后先保存好，等会到jenkins中需要配置凭证<br>我们有一个token可以访问到github了，但是还要对其中的项目设置钩子</p>\n<blockquote>\n<pre><code>进入GitHub上指定的项目 --&gt; setting --&gt; WebHooks&amp;Services --&gt; add webhook --&gt; 输入刚刚部署jenkins的服务器的IP\n</code></pre>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524015-04935500-02fc-11ea-9a12-9cfd5bfc7695.png\" alt=\"network\"></p>\n<h2 id=\"在Jenkins和github钩子\"><a href=\"#在Jenkins和github钩子\" class=\"headerlink\" title=\"在Jenkins和github钩子\"></a>在Jenkins和github钩子</h2><h3 id=\"安装github-plugin\"><a href=\"#安装github-plugin\" class=\"headerlink\" title=\"安装github plugin\"></a>安装github plugin</h3><blockquote>\n<p>系统管理–&gt;插件管理–&gt;可选插件</p>\n</blockquote>\n<h3 id=\"配置github-plugin\"><a href=\"#配置github-plugin\" class=\"headerlink\" title=\"配置github plugin\"></a>配置github plugin</h3><blockquote>\n<p>系统管理–&gt;github plugin</p>\n</blockquote>\n<p>API URL 输入 <code>https://api.github.com</code>，Credentials点击Add添加，Kind选择Secret Text,具体如下图所示。</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524053-c64a6580-02fc-11ea-9f2d-db3a71b304d3.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524112-9485ce80-02fd-11ea-9047-d73780d20b48.png\" alt=\"network\"></p>\n<p>设置完成后，点击<code>TestConnection</code>,提示<code>Credentials verified for user UUserName, rate limit: xxx</code>,则表明有效。</p>\n<h2 id=\"构建配置\"><a href=\"#构建配置\" class=\"headerlink\" title=\"构建配置\"></a>构建配置</h2><h2 id=\"构建方式\"><a href=\"#构建方式\" class=\"headerlink\" title=\"构建方式\"></a>构建方式</h2><ul>\n<li>手动构建：自己上Jenkins点击。</li>\n<li>自动构建：提交代码到git仓库之后，自动构建。</li>\n<li>定时构建：每隔一段时间构建一次，比如设置每天固定某个时间段构建。</li>\n</ul>\n<h3 id=\"编写shell脚本\"><a href=\"#编写shell脚本\" class=\"headerlink\" title=\"编写shell脚本\"></a>编写shell脚本</h3><p>Shell 是一个用 C 语言编写的程序，它是用户使用 Linux 的桥梁。Shell 既是一种命令语言，又是一种程序设计语言。</p>\n<p><code>node -v</code><br><code>npm -v</code><br><code>npm --registry https://registry.npm.taobao.org install</code><br><code>npm run test:unit</code><br><code>npm run build</code></p>\n<h3 id=\"参数化构建\"><a href=\"#参数化构建\" class=\"headerlink\" title=\"参数化构建\"></a>参数化构建</h3><p>选择参数化构建，配置参数，在工程的首页就会多一个构建入口，参数化构建使得构建变得更加灵活。</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524161-5d63ed00-02fe-11ea-9874-1f4672d47891.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524197-a0be5b80-02fe-11ea-8765-a5505bc42420.png\" alt=\"network\"></p>\n<h3 id=\"上传构建包\"><a href=\"#上传构建包\" class=\"headerlink\" title=\"上传构建包\"></a>上传构建包</h3><p>使用nginx做为文件服务器<br>在机器上安装nginx<br>在nginx上配置为文件资源服务器</p>\n<p><code>location / &#123;         root   /usr/share/nginx/html/static;         autoindex on;         autoindex_exact_size off;         autoindex_localtime on;     &#125;</code><br><img src=\"https://user-images.githubusercontent.com/16111288/68524366-0b709680-0301-11ea-8892-a7e1e50f4cfa.png\" alt=\"network\"></p>\n<h2 id=\"Jenkins系统配置SSH账号\"><a href=\"#Jenkins系统配置SSH账号\" class=\"headerlink\" title=\"Jenkins系统配置SSH账号\"></a>Jenkins系统配置SSH账号</h2><p>安装Publish Over SSH插件用于SSH连接远程的服务器。</p>\n<p>登录 jenkins 管理系统首页，打开“系统管理”–“管理插件”  搜索 Publish Over SSH 然后勾选安装<br>配置远程服务器的连接</p>\n<p>打开“系统管理”–“系统设置”  找到 “Publish over SSH” 项 ，我这里远程服务器用的是ssh登录，通过ppk密钥进行连接，所以我的配置如图，如果是帐号密码登录的Passphrase填写密码Username填写用户名，path to key 为空就可以了。</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524390-5094c880-0301-11ea-8559-ad729ff4f671.png\" alt=\"network\"></p>\n<p>点击 Test Configuration 按钮测试连接是否成功</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524400-6bffd380-0301-11ea-840d-96bc52a4257b.png\" alt=\"network\"></p>\n<h3 id=\"JOB添加构建后上传\"><a href=\"#JOB添加构建后上传\" class=\"headerlink\" title=\"JOB添加构建后上传\"></a>JOB添加构建后上传</h3><blockquote>\n<p>“构建后操作步骤”—“Send build artifacts over SSH” </p>\n</blockquote>\n<p>Name：第三步创建的远程服务器名称</p>\n<p>Source files：本地需要传输过去的文件路径</p>\n<p>Remove prefix：过滤掉的目录名</p>\n<p>Remote directory：远程服务器的保存路径</p>\n<p>Exec command：传输完成后在远程服务器执行的sh命令</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524450-03652680-0302-11ea-9bce-f7b42ddf589d.png\" alt=\"network\"></p>\n<h2 id=\"构建后邮件通知\"><a href=\"#构建后邮件通知\" class=\"headerlink\" title=\"构建后邮件通知\"></a>构建后邮件通知</h2><p>构建成功之后，可以进行邮件通知。<br>第一步，先到插件管理安装插件，Email Extension Plugin，我只搜到了Email EXtension Template，所以就安装了它</p>\n<p>如果是QQ邮箱，先去获取一个独立密码</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524622-02cd8f80-0304-11ea-949b-ec148ea39d08.png\" alt=\"network\"></p>\n<blockquote>\n<p>系统管理–&gt;系统设置–&gt; Extended E-mail Notification</p>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524633-1a0c7d00-0304-11ea-8bdb-3c94222fcfb8.png\" alt=\"network\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524636-21338b00-0304-11ea-8ac7-0e8aa0f07aab.png\" alt=\"network\"></p>\n<h2 id=\"配置邮件报错\"><a href=\"#配置邮件报错\" class=\"headerlink\" title=\"配置邮件报错\"></a>配置邮件报错</h2><p><img src=\"https://user-images.githubusercontent.com/16111288/68524653-593ace00-0304-11ea-9b60-d4f4227f020c.png\" alt=\"network\"></p>\n<p>邮件配置的过程出错，是因为管理的邮箱没有配置，到用户设置去设置</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524659-6952ad80-0304-11ea-846b-fb1dc721ab56.png\" alt=\"network\"></p>\n<h3 id=\"构建后选择接收人\"><a href=\"#构建后选择接收人\" class=\"headerlink\" title=\"构建后选择接收人\"></a>构建后选择接收人</h3><p><img src=\"https://user-images.githubusercontent.com/16111288/68524667-7f606e00-0304-11ea-8425-84fbd475e9af.png\" alt=\"network\"></p>\n<h2 id=\"注意-1\"><a href=\"#注意-1\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p> 对于新手来说，Jenkin最好直接安装在机器上，安装在docker上的话，Jenkins无法访问到宿主机器的环境变量，比如我在机器上安装Yarn，但docker上的Jenkins无法访问得到Yarn，只能老老实实的使用npm。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><ul>\n<li>学习Jenkins，Docker这种工具，最好租一个服务器，不需要买域名，按月租就够了。</li>\n<li>境外服务器的比境内便宜，但境外的经常连不上去，每天总有几个小时连不上去。</li>\n<li>构建过程中npm install总是失败，服务器从1G内存扩容到2G 之后又成功了。</li>\n<li>Docker安装的jenkins无法访问到本机的环境变量，例如无法在构建脚本中写Yarn命令。</li>\n</ul>\n<h1 id=\"阿里云简介\"><a href=\"#阿里云简介\" class=\"headerlink\" title=\"阿里云简介\"></a>阿里云简介</h1><p>轻量应用型服务器，便宜，适合学习。<br>买好之后，在点击进入自己的机器</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524467-30193e00-0302-11ea-8266-0114201443ba.png\" alt=\"network\"></p>\n<p>服务器默认只开发 80,443，22端口是可以通过外网进行访问的，如果自己的应用是8080,8088这个端口，需要在阿里云防火墙里面添加规则，并重启机器</p>\n<p><img src=\"https://user-images.githubusercontent.com/16111288/68524471-3c050000-0302-11ea-8d61-54e8fc0000fb.png\" alt=\"network\"></p>\n<h2 id=\"通过xshell进入服务器\"><a href=\"#通过xshell进入服务器\" class=\"headerlink\" title=\"通过xshell进入服务器\"></a>通过xshell进入服务器</h2><p><img src=\"https://user-images.githubusercontent.com/16111288/68524476-4c1cdf80-0302-11ea-825b-aa3ce6144c22.png\" alt=\"network\"></p>\n<h1 id=\"访问github慢\"><a href=\"#访问github慢\" class=\"headerlink\" title=\"访问github慢\"></a>访问github慢</h1><p>github的CDN被某墙屏了，由于网络代理商的原因，所以访问下载很慢。ping github.com 时，速度只有300多ms。<br>绕过dns解析，在本地直接绑定host，该方法也可加速其他因为CDN被屏蔽导致访问慢的网站。<br>windows系统的hosts文件的位置如下：C:\\Windows\\System32\\drivers\\etc\\hosts<br>mac/linux系统的hosts文件的位置如下：/etc/hosts</p>\n<p>修改windows里的hosts文件，添加如下内容</p>\n<p><code># Github 151.101.44.249 github.global.ssl.fastly.net  192.30.253.113 github.com  103.245.222.133 assets-cdn.github.com  23.235.47.133 assets-cdn.github.com  203.208.39.104 assets-cdn.github.com  204.232.175.78 documentcloud.github.com  204.232.175.94 gist.github.com  107.21.116.220 help.github.com  207.97.227.252 nodeload.github.com  199.27.76.130 raw.github.com  107.22.3.110 status.github.com  204.232.175.78 training.github.com  207.97.227.243 www.github.com  185.31.16.184 github.global.ssl.fastly.net  185.31.18.133 avatars0.githubusercontent.com  185.31.19.133 avatars1.githubusercontent.com 192.30.253.120 codeload.github.com</code></p>"},{"title":"Object.defineProperty","date":"2017-11-09T03:28:03.000Z","_content":"\nObject.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性， 并返回这个对象。Vue 是通过数据劫持来做数据绑定的，其中最核心的方法便是通过 Ojbect.defineProperty() 来实现对属性的劫持，达到监听数据变动的目的。\n\n<!--more-->\n\n对象的属性分两种：数据属性和访问属性\n\n## 数据属性\n\n数据属性包含一个保存数据值的位置。数据属性有 4 个特性描述它们的行为\n\n- Configurable：表示属性是否可以通过 delete 删除并重新定义，是否可以修改它的特性，以及是否可以把它改为访问属性，默认为 true\n- Enumerable：表示是否可以通过 for-in 循环返回，默认为 true\n- Writable：是否可以被修改，默认为 true\n- Value：包含属性实际的值，默认值为 undefined\n\n要修改属性的默认特性，就必须使用 Object.defineProperty()方法\n\n### Object.defineProperty(object, propertyname, descriptor) 为对象定义属性\n\n在 js 中我们可以通过下面几种方法定义属性 :\n\n```javascript\n// (1) define someOne property name\nsomeOne.name = 'cover';\n//or use (2)\nsomeOne['name'] = 'cover';\n// or use (3) defineProperty\nObject.defineProperty(someOne, 'name', {\n  writable:false\n  value: 'cover'\n});\nsomeOne['name'] = 'bbbb';\nconsole.log(someOne['name'])//cover\n```\n\n若是用来封装自定义 API 是非常有用的\n\n#### descriptor\n\n其中 descriptor 的参数值得我们关注下 , 该属性可设置的值有：value 、 writable、configurable 、 enumerable、set 和 get。\n\n#### 【 value】\n\n该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等），默认为 undefined。\n\n#### 【 writable】\n\n该属性是否可写，如果设置成 false，则任何对该属性改写的操作都无效（但不会报错），对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。\n\n```javascript\nvar someOne = {}\nObject.defineProperty(someOne, 'name', {\n  value: 'coverguo', //由于设定了writable属性为false 导致这个量不可以修改 ，任何修改豆浆无效化\n  writable: false,\n})\nconsole.log(someOne.name) // 输出 coverguo\nsomeOne.name = 'linkzhu'\nconsole.log(someOne.name) // 输出coverguo\n```\n\n#### 【 configurable】\n\n仅当该属性的 configurable 为 true 时，该属性才能够被改变，也能够被删除。默认为 false。\n\n如果为 false，则任何尝试删除目标属性或修改属性以下特性（writable, configurable, enumerable ）的行为将被无效化，对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。\n\n#### 【 enumerable】\n\n是否能在 for-in 循环中遍历出来或在 Object.keys 中列举出来。对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。\n\n```javascript\nvar a = {}\nObject.defineProperty(a, 'b', {\n  value: 3445,\n  enumerable: true,\n})\nconsole.log(Object.keys(a)) // 打印[\"b\"]\n//改为false\nvar a = {}\nObject.defineProperty(a, 'b', {\n  value: 3445,\n  enumerable: false, //注意咯这里改了\n})\nconsole.log(Object.keys(a)) // 打印[]\n```\n\n#### 注意：\n\n在调用 Object.defineProperty() 方法时，如果不指定， configurable ， enumerable， writable 特性的默认值都是 false, 这跟之前所 说的对于像前面例子中直接在对象上定义的属性，这个特性默认值为为 true。并不冲突，如下代码所示：\n\n```javascript\n//调用Object.defineProperty()方法时，如果不指定\nvar someOne = {}\nsomeOne.name = 'coverguo'\nconsole.log(Object.getOwnPropertyDescriptor(someOne, 'name'))\n//输出 Object {value: \"coverguo\", writable: true, enumerable: true, configurable: true}\n\n//直接在对象上定义的属性，这个特性默认值为为 true\nvar otherOne = {}\nObject.defineProperty(otherOne, 'name', {\n  value: 'coverguo',\n})\nconsole.log(Object.getOwnPropertyDescriptor(otherOne, 'name'))\n//输出 Object {value: \"coverguo\", writable: false, enumerable: false, configurable: false}\n```\n\n## 访问器属性\n\n访问器属性不包含数据值。相反他们包含一个获取 getter 函数和一个设置 setter 函数，不过这两个函数不是必需的。在读取访问器属性时，会调用获取函数，这个函数的责任就是返回一个有效的值。\n\n在写入访问器属性时，会调用设置函数并传入新值，这个函数必须决定对数据做出什么修改，访问器属性有 4 个特性描述它们的行为。\n\n- Configurable：表示属性是否可以通过 delete 删除并重新定义，是否可以修改它的特性，以及是否可以把它改为数据属性，默认为 true\n- Enumerable：表示属性是否可以通过 for-in 循环返回，默认为 true\n- Get：获取函数，在读取属性时调用，默认为 undefined\n- Set：设置函数，在写入属性时调用，默认为 undefined\n\n访问器属性是不能直接定义的，不许使用 Object.defineProperty()\n\n#### 【 get】和【set 】\n\n在 descriptor 中不能 同时设置访问器 (get 和 set) 和 wriable 或 value，否则会错，就是说想用 (get 和 set)，就不能用（wriable 或 value 中的任何一个）\n\n```javascript\nvar a= {}\nObject.defineProperty(a,\"b\",{\n  set:function(newValue){\n    console.log(\"你要赋值给我,我的新值是\"＋newValue)\n    },\n  get:function(){\n    console.log(\"你取我的值\")\n    return 2 //注意这里，我硬编码返回2\n   }\n})\na.b =1 //打印 你要赋值给我,我的新值是1\nconsole.log(a.b)    //打印 你取我的值\n                    //打印 2    注意这里，和我的硬编码相同的\n```\n\n\\*\\* 这个 \"b\" 赋值 或者取值的时候会分别触发 set 和 get 对应的函数，这就是 observe 的关键，是 vue 实现 observe 的实现的基础，也是实现 \\$watch 的基础。\n\n##### 【 get】\n\n一旦目标对象访问该属性，就会调用这个方法，并返回结果。默认为 undefined。 ##### 【 set】 一旦目标对象设置该属性，就会调用这个方法。默认为 undefined。\n\n## 兼容性\n\n在 ie8 下只能在 DOM 对象上使用，尝试在原生的对象使用 Object.defineProperty() 会报错。\n","source":"_posts/Object-defineProperty.md","raw":"---\ntitle: Object.defineProperty\ncategories: JavaScript\ndate: 2017-11-09 11:28:03\n---\n\nObject.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性， 并返回这个对象。Vue 是通过数据劫持来做数据绑定的，其中最核心的方法便是通过 Ojbect.defineProperty() 来实现对属性的劫持，达到监听数据变动的目的。\n\n<!--more-->\n\n对象的属性分两种：数据属性和访问属性\n\n## 数据属性\n\n数据属性包含一个保存数据值的位置。数据属性有 4 个特性描述它们的行为\n\n- Configurable：表示属性是否可以通过 delete 删除并重新定义，是否可以修改它的特性，以及是否可以把它改为访问属性，默认为 true\n- Enumerable：表示是否可以通过 for-in 循环返回，默认为 true\n- Writable：是否可以被修改，默认为 true\n- Value：包含属性实际的值，默认值为 undefined\n\n要修改属性的默认特性，就必须使用 Object.defineProperty()方法\n\n### Object.defineProperty(object, propertyname, descriptor) 为对象定义属性\n\n在 js 中我们可以通过下面几种方法定义属性 :\n\n```javascript\n// (1) define someOne property name\nsomeOne.name = 'cover';\n//or use (2)\nsomeOne['name'] = 'cover';\n// or use (3) defineProperty\nObject.defineProperty(someOne, 'name', {\n  writable:false\n  value: 'cover'\n});\nsomeOne['name'] = 'bbbb';\nconsole.log(someOne['name'])//cover\n```\n\n若是用来封装自定义 API 是非常有用的\n\n#### descriptor\n\n其中 descriptor 的参数值得我们关注下 , 该属性可设置的值有：value 、 writable、configurable 、 enumerable、set 和 get。\n\n#### 【 value】\n\n该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等），默认为 undefined。\n\n#### 【 writable】\n\n该属性是否可写，如果设置成 false，则任何对该属性改写的操作都无效（但不会报错），对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。\n\n```javascript\nvar someOne = {}\nObject.defineProperty(someOne, 'name', {\n  value: 'coverguo', //由于设定了writable属性为false 导致这个量不可以修改 ，任何修改豆浆无效化\n  writable: false,\n})\nconsole.log(someOne.name) // 输出 coverguo\nsomeOne.name = 'linkzhu'\nconsole.log(someOne.name) // 输出coverguo\n```\n\n#### 【 configurable】\n\n仅当该属性的 configurable 为 true 时，该属性才能够被改变，也能够被删除。默认为 false。\n\n如果为 false，则任何尝试删除目标属性或修改属性以下特性（writable, configurable, enumerable ）的行为将被无效化，对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。\n\n#### 【 enumerable】\n\n是否能在 for-in 循环中遍历出来或在 Object.keys 中列举出来。对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。\n\n```javascript\nvar a = {}\nObject.defineProperty(a, 'b', {\n  value: 3445,\n  enumerable: true,\n})\nconsole.log(Object.keys(a)) // 打印[\"b\"]\n//改为false\nvar a = {}\nObject.defineProperty(a, 'b', {\n  value: 3445,\n  enumerable: false, //注意咯这里改了\n})\nconsole.log(Object.keys(a)) // 打印[]\n```\n\n#### 注意：\n\n在调用 Object.defineProperty() 方法时，如果不指定， configurable ， enumerable， writable 特性的默认值都是 false, 这跟之前所 说的对于像前面例子中直接在对象上定义的属性，这个特性默认值为为 true。并不冲突，如下代码所示：\n\n```javascript\n//调用Object.defineProperty()方法时，如果不指定\nvar someOne = {}\nsomeOne.name = 'coverguo'\nconsole.log(Object.getOwnPropertyDescriptor(someOne, 'name'))\n//输出 Object {value: \"coverguo\", writable: true, enumerable: true, configurable: true}\n\n//直接在对象上定义的属性，这个特性默认值为为 true\nvar otherOne = {}\nObject.defineProperty(otherOne, 'name', {\n  value: 'coverguo',\n})\nconsole.log(Object.getOwnPropertyDescriptor(otherOne, 'name'))\n//输出 Object {value: \"coverguo\", writable: false, enumerable: false, configurable: false}\n```\n\n## 访问器属性\n\n访问器属性不包含数据值。相反他们包含一个获取 getter 函数和一个设置 setter 函数，不过这两个函数不是必需的。在读取访问器属性时，会调用获取函数，这个函数的责任就是返回一个有效的值。\n\n在写入访问器属性时，会调用设置函数并传入新值，这个函数必须决定对数据做出什么修改，访问器属性有 4 个特性描述它们的行为。\n\n- Configurable：表示属性是否可以通过 delete 删除并重新定义，是否可以修改它的特性，以及是否可以把它改为数据属性，默认为 true\n- Enumerable：表示属性是否可以通过 for-in 循环返回，默认为 true\n- Get：获取函数，在读取属性时调用，默认为 undefined\n- Set：设置函数，在写入属性时调用，默认为 undefined\n\n访问器属性是不能直接定义的，不许使用 Object.defineProperty()\n\n#### 【 get】和【set 】\n\n在 descriptor 中不能 同时设置访问器 (get 和 set) 和 wriable 或 value，否则会错，就是说想用 (get 和 set)，就不能用（wriable 或 value 中的任何一个）\n\n```javascript\nvar a= {}\nObject.defineProperty(a,\"b\",{\n  set:function(newValue){\n    console.log(\"你要赋值给我,我的新值是\"＋newValue)\n    },\n  get:function(){\n    console.log(\"你取我的值\")\n    return 2 //注意这里，我硬编码返回2\n   }\n})\na.b =1 //打印 你要赋值给我,我的新值是1\nconsole.log(a.b)    //打印 你取我的值\n                    //打印 2    注意这里，和我的硬编码相同的\n```\n\n\\*\\* 这个 \"b\" 赋值 或者取值的时候会分别触发 set 和 get 对应的函数，这就是 observe 的关键，是 vue 实现 observe 的实现的基础，也是实现 \\$watch 的基础。\n\n##### 【 get】\n\n一旦目标对象访问该属性，就会调用这个方法，并返回结果。默认为 undefined。 ##### 【 set】 一旦目标对象设置该属性，就会调用这个方法。默认为 undefined。\n\n## 兼容性\n\n在 ie8 下只能在 DOM 对象上使用，尝试在原生的对象使用 Object.defineProperty() 会报错。\n","slug":"Object-defineProperty","published":1,"updated":"2021-03-29T16:04:45.936Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wq000pl5v04ujr60v6","content":"<p>Object.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性， 并返回这个对象。Vue 是通过数据劫持来做数据绑定的，其中最核心的方法便是通过 Ojbect.defineProperty() 来实现对属性的劫持，达到监听数据变动的目的。</p>\n<span id=\"more\"></span>\n\n<p>对象的属性分两种：数据属性和访问属性</p>\n<h2 id=\"数据属性\"><a href=\"#数据属性\" class=\"headerlink\" title=\"数据属性\"></a>数据属性</h2><p>数据属性包含一个保存数据值的位置。数据属性有 4 个特性描述它们的行为</p>\n<ul>\n<li>Configurable：表示属性是否可以通过 delete 删除并重新定义，是否可以修改它的特性，以及是否可以把它改为访问属性，默认为 true</li>\n<li>Enumerable：表示是否可以通过 for-in 循环返回，默认为 true</li>\n<li>Writable：是否可以被修改，默认为 true</li>\n<li>Value：包含属性实际的值，默认值为 undefined</li>\n</ul>\n<p>要修改属性的默认特性，就必须使用 Object.defineProperty()方法</p>\n<h3 id=\"Object-defineProperty-object-propertyname-descriptor-为对象定义属性\"><a href=\"#Object-defineProperty-object-propertyname-descriptor-为对象定义属性\" class=\"headerlink\" title=\"Object.defineProperty(object, propertyname, descriptor) 为对象定义属性\"></a>Object.defineProperty(object, propertyname, descriptor) 为对象定义属性</h3><p>在 js 中我们可以通过下面几种方法定义属性 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// (1) define someOne property name</span></span><br><span class=\"line\">someOne.name = <span class=\"string\">&#x27;cover&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">//or use (2)</span></span><br><span class=\"line\">someOne[<span class=\"string\">&#x27;name&#x27;</span>] = <span class=\"string\">&#x27;cover&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// or use (3) defineProperty</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(someOne, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">  writable:<span class=\"literal\">false</span></span><br><span class=\"line\">  value: <span class=\"string\">&#x27;cover&#x27;</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">someOne[<span class=\"string\">&#x27;name&#x27;</span>] = <span class=\"string\">&#x27;bbbb&#x27;</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(someOne[<span class=\"string\">&#x27;name&#x27;</span>])<span class=\"comment\">//cover</span></span><br></pre></td></tr></table></figure>\n\n<p>若是用来封装自定义 API 是非常有用的</p>\n<h4 id=\"descriptor\"><a href=\"#descriptor\" class=\"headerlink\" title=\"descriptor\"></a>descriptor</h4><p>其中 descriptor 的参数值得我们关注下 , 该属性可设置的值有：value 、 writable、configurable 、 enumerable、set 和 get。</p>\n<h4 id=\"【-value】\"><a href=\"#【-value】\" class=\"headerlink\" title=\"【 value】\"></a>【 value】</h4><p>该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等），默认为 undefined。</p>\n<h4 id=\"【-writable】\"><a href=\"#【-writable】\" class=\"headerlink\" title=\"【 writable】\"></a>【 writable】</h4><p>该属性是否可写，如果设置成 false，则任何对该属性改写的操作都无效（但不会报错），对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> someOne = &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(someOne, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">  value: <span class=\"string\">&#x27;coverguo&#x27;</span>, <span class=\"comment\">//由于设定了writable属性为false 导致这个量不可以修改 ，任何修改豆浆无效化</span></span><br><span class=\"line\">  writable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(someOne.name) <span class=\"comment\">// 输出 coverguo</span></span><br><span class=\"line\">someOne.name = <span class=\"string\">&#x27;linkzhu&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(someOne.name) <span class=\"comment\">// 输出coverguo</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"【-configurable】\"><a href=\"#【-configurable】\" class=\"headerlink\" title=\"【 configurable】\"></a>【 configurable】</h4><p>仅当该属性的 configurable 为 true 时，该属性才能够被改变，也能够被删除。默认为 false。</p>\n<p>如果为 false，则任何尝试删除目标属性或修改属性以下特性（writable, configurable, enumerable ）的行为将被无效化，对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。</p>\n<h4 id=\"【-enumerable】\"><a href=\"#【-enumerable】\" class=\"headerlink\" title=\"【 enumerable】\"></a>【 enumerable】</h4><p>是否能在 for-in 循环中遍历出来或在 Object.keys 中列举出来。对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(a, <span class=\"string\">&#x27;b&#x27;</span>, &#123;</span><br><span class=\"line\">  value: <span class=\"number\">3445</span>,</span><br><span class=\"line\">  enumerable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Object</span>.keys(a)) <span class=\"comment\">// 打印[&quot;b&quot;]</span></span><br><span class=\"line\"><span class=\"comment\">//改为false</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(a, <span class=\"string\">&#x27;b&#x27;</span>, &#123;</span><br><span class=\"line\">  value: <span class=\"number\">3445</span>,</span><br><span class=\"line\">  enumerable: <span class=\"literal\">false</span>, <span class=\"comment\">//注意咯这里改了</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Object</span>.keys(a)) <span class=\"comment\">// 打印[]</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"注意：\"><a href=\"#注意：\" class=\"headerlink\" title=\"注意：\"></a>注意：</h4><p>在调用 Object.defineProperty() 方法时，如果不指定， configurable ， enumerable， writable 特性的默认值都是 false, 这跟之前所 说的对于像前面例子中直接在对象上定义的属性，这个特性默认值为为 true。并不冲突，如下代码所示：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//调用Object.defineProperty()方法时，如果不指定</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> someOne = &#123;&#125;</span><br><span class=\"line\">someOne.name = <span class=\"string\">&#x27;coverguo&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Object</span>.getOwnPropertyDescriptor(someOne, <span class=\"string\">&#x27;name&#x27;</span>))</span><br><span class=\"line\"><span class=\"comment\">//输出 Object &#123;value: &quot;coverguo&quot;, writable: true, enumerable: true, configurable: true&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//直接在对象上定义的属性，这个特性默认值为为 true</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> otherOne = &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(otherOne, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">  value: <span class=\"string\">&#x27;coverguo&#x27;</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Object</span>.getOwnPropertyDescriptor(otherOne, <span class=\"string\">&#x27;name&#x27;</span>))</span><br><span class=\"line\"><span class=\"comment\">//输出 Object &#123;value: &quot;coverguo&quot;, writable: false, enumerable: false, configurable: false&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"访问器属性\"><a href=\"#访问器属性\" class=\"headerlink\" title=\"访问器属性\"></a>访问器属性</h2><p>访问器属性不包含数据值。相反他们包含一个获取 getter 函数和一个设置 setter 函数，不过这两个函数不是必需的。在读取访问器属性时，会调用获取函数，这个函数的责任就是返回一个有效的值。</p>\n<p>在写入访问器属性时，会调用设置函数并传入新值，这个函数必须决定对数据做出什么修改，访问器属性有 4 个特性描述它们的行为。</p>\n<ul>\n<li>Configurable：表示属性是否可以通过 delete 删除并重新定义，是否可以修改它的特性，以及是否可以把它改为数据属性，默认为 true</li>\n<li>Enumerable：表示属性是否可以通过 for-in 循环返回，默认为 true</li>\n<li>Get：获取函数，在读取属性时调用，默认为 undefined</li>\n<li>Set：设置函数，在写入属性时调用，默认为 undefined</li>\n</ul>\n<p>访问器属性是不能直接定义的，不许使用 Object.defineProperty()</p>\n<h4 id=\"【-get】和【set-】\"><a href=\"#【-get】和【set-】\" class=\"headerlink\" title=\"【 get】和【set 】\"></a>【 get】和【set 】</h4><p>在 descriptor 中不能 同时设置访问器 (get 和 set) 和 wriable 或 value，否则会错，就是说想用 (get 和 set)，就不能用（wriable 或 value 中的任何一个）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a= &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(a,<span class=\"string\">&quot;b&quot;</span>,&#123;</span><br><span class=\"line\">  set:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newValue</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;你要赋值给我,我的新值是&quot;</span>＋newValue)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  get:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;你取我的值&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">2</span> <span class=\"comment\">//注意这里，我硬编码返回2</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">a.b =<span class=\"number\">1</span> <span class=\"comment\">//打印 你要赋值给我,我的新值是1</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.b)    <span class=\"comment\">//打印 你取我的值</span></span><br><span class=\"line\">                    <span class=\"comment\">//打印 2    注意这里，和我的硬编码相同的</span></span><br></pre></td></tr></table></figure>\n\n<p>** 这个 “b” 赋值 或者取值的时候会分别触发 set 和 get 对应的函数，这就是 observe 的关键，是 vue 实现 observe 的实现的基础，也是实现 $watch 的基础。</p>\n<h5 id=\"【-get】\"><a href=\"#【-get】\" class=\"headerlink\" title=\"【 get】\"></a>【 get】</h5><p>一旦目标对象访问该属性，就会调用这个方法，并返回结果。默认为 undefined。 ##### 【 set】 一旦目标对象设置该属性，就会调用这个方法。默认为 undefined。</p>\n<h2 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h2><p>在 ie8 下只能在 DOM 对象上使用，尝试在原生的对象使用 Object.defineProperty() 会报错。</p>\n","site":{"data":{}},"excerpt":"<p>Object.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性， 并返回这个对象。Vue 是通过数据劫持来做数据绑定的，其中最核心的方法便是通过 Ojbect.defineProperty() 来实现对属性的劫持，达到监听数据变动的目的。</p>","more":"<p>对象的属性分两种：数据属性和访问属性</p>\n<h2 id=\"数据属性\"><a href=\"#数据属性\" class=\"headerlink\" title=\"数据属性\"></a>数据属性</h2><p>数据属性包含一个保存数据值的位置。数据属性有 4 个特性描述它们的行为</p>\n<ul>\n<li>Configurable：表示属性是否可以通过 delete 删除并重新定义，是否可以修改它的特性，以及是否可以把它改为访问属性，默认为 true</li>\n<li>Enumerable：表示是否可以通过 for-in 循环返回，默认为 true</li>\n<li>Writable：是否可以被修改，默认为 true</li>\n<li>Value：包含属性实际的值，默认值为 undefined</li>\n</ul>\n<p>要修改属性的默认特性，就必须使用 Object.defineProperty()方法</p>\n<h3 id=\"Object-defineProperty-object-propertyname-descriptor-为对象定义属性\"><a href=\"#Object-defineProperty-object-propertyname-descriptor-为对象定义属性\" class=\"headerlink\" title=\"Object.defineProperty(object, propertyname, descriptor) 为对象定义属性\"></a>Object.defineProperty(object, propertyname, descriptor) 为对象定义属性</h3><p>在 js 中我们可以通过下面几种方法定义属性 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// (1) define someOne property name</span></span><br><span class=\"line\">someOne.name = <span class=\"string\">&#x27;cover&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">//or use (2)</span></span><br><span class=\"line\">someOne[<span class=\"string\">&#x27;name&#x27;</span>] = <span class=\"string\">&#x27;cover&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// or use (3) defineProperty</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(someOne, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">  writable:<span class=\"literal\">false</span></span><br><span class=\"line\">  value: <span class=\"string\">&#x27;cover&#x27;</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">someOne[<span class=\"string\">&#x27;name&#x27;</span>] = <span class=\"string\">&#x27;bbbb&#x27;</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(someOne[<span class=\"string\">&#x27;name&#x27;</span>])<span class=\"comment\">//cover</span></span><br></pre></td></tr></table></figure>\n\n<p>若是用来封装自定义 API 是非常有用的</p>\n<h4 id=\"descriptor\"><a href=\"#descriptor\" class=\"headerlink\" title=\"descriptor\"></a>descriptor</h4><p>其中 descriptor 的参数值得我们关注下 , 该属性可设置的值有：value 、 writable、configurable 、 enumerable、set 和 get。</p>\n<h4 id=\"【-value】\"><a href=\"#【-value】\" class=\"headerlink\" title=\"【 value】\"></a>【 value】</h4><p>该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等），默认为 undefined。</p>\n<h4 id=\"【-writable】\"><a href=\"#【-writable】\" class=\"headerlink\" title=\"【 writable】\"></a>【 writable】</h4><p>该属性是否可写，如果设置成 false，则任何对该属性改写的操作都无效（但不会报错），对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> someOne = &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(someOne, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">  value: <span class=\"string\">&#x27;coverguo&#x27;</span>, <span class=\"comment\">//由于设定了writable属性为false 导致这个量不可以修改 ，任何修改豆浆无效化</span></span><br><span class=\"line\">  writable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(someOne.name) <span class=\"comment\">// 输出 coverguo</span></span><br><span class=\"line\">someOne.name = <span class=\"string\">&#x27;linkzhu&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(someOne.name) <span class=\"comment\">// 输出coverguo</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"【-configurable】\"><a href=\"#【-configurable】\" class=\"headerlink\" title=\"【 configurable】\"></a>【 configurable】</h4><p>仅当该属性的 configurable 为 true 时，该属性才能够被改变，也能够被删除。默认为 false。</p>\n<p>如果为 false，则任何尝试删除目标属性或修改属性以下特性（writable, configurable, enumerable ）的行为将被无效化，对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。</p>\n<h4 id=\"【-enumerable】\"><a href=\"#【-enumerable】\" class=\"headerlink\" title=\"【 enumerable】\"></a>【 enumerable】</h4><p>是否能在 for-in 循环中遍历出来或在 Object.keys 中列举出来。对于像前面例子中直接在对象上定义的属性，这个属性该特性默认值为为 true。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(a, <span class=\"string\">&#x27;b&#x27;</span>, &#123;</span><br><span class=\"line\">  value: <span class=\"number\">3445</span>,</span><br><span class=\"line\">  enumerable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Object</span>.keys(a)) <span class=\"comment\">// 打印[&quot;b&quot;]</span></span><br><span class=\"line\"><span class=\"comment\">//改为false</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(a, <span class=\"string\">&#x27;b&#x27;</span>, &#123;</span><br><span class=\"line\">  value: <span class=\"number\">3445</span>,</span><br><span class=\"line\">  enumerable: <span class=\"literal\">false</span>, <span class=\"comment\">//注意咯这里改了</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Object</span>.keys(a)) <span class=\"comment\">// 打印[]</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"注意：\"><a href=\"#注意：\" class=\"headerlink\" title=\"注意：\"></a>注意：</h4><p>在调用 Object.defineProperty() 方法时，如果不指定， configurable ， enumerable， writable 特性的默认值都是 false, 这跟之前所 说的对于像前面例子中直接在对象上定义的属性，这个特性默认值为为 true。并不冲突，如下代码所示：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//调用Object.defineProperty()方法时，如果不指定</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> someOne = &#123;&#125;</span><br><span class=\"line\">someOne.name = <span class=\"string\">&#x27;coverguo&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Object</span>.getOwnPropertyDescriptor(someOne, <span class=\"string\">&#x27;name&#x27;</span>))</span><br><span class=\"line\"><span class=\"comment\">//输出 Object &#123;value: &quot;coverguo&quot;, writable: true, enumerable: true, configurable: true&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//直接在对象上定义的属性，这个特性默认值为为 true</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> otherOne = &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(otherOne, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">  value: <span class=\"string\">&#x27;coverguo&#x27;</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Object</span>.getOwnPropertyDescriptor(otherOne, <span class=\"string\">&#x27;name&#x27;</span>))</span><br><span class=\"line\"><span class=\"comment\">//输出 Object &#123;value: &quot;coverguo&quot;, writable: false, enumerable: false, configurable: false&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"访问器属性\"><a href=\"#访问器属性\" class=\"headerlink\" title=\"访问器属性\"></a>访问器属性</h2><p>访问器属性不包含数据值。相反他们包含一个获取 getter 函数和一个设置 setter 函数，不过这两个函数不是必需的。在读取访问器属性时，会调用获取函数，这个函数的责任就是返回一个有效的值。</p>\n<p>在写入访问器属性时，会调用设置函数并传入新值，这个函数必须决定对数据做出什么修改，访问器属性有 4 个特性描述它们的行为。</p>\n<ul>\n<li>Configurable：表示属性是否可以通过 delete 删除并重新定义，是否可以修改它的特性，以及是否可以把它改为数据属性，默认为 true</li>\n<li>Enumerable：表示属性是否可以通过 for-in 循环返回，默认为 true</li>\n<li>Get：获取函数，在读取属性时调用，默认为 undefined</li>\n<li>Set：设置函数，在写入属性时调用，默认为 undefined</li>\n</ul>\n<p>访问器属性是不能直接定义的，不许使用 Object.defineProperty()</p>\n<h4 id=\"【-get】和【set-】\"><a href=\"#【-get】和【set-】\" class=\"headerlink\" title=\"【 get】和【set 】\"></a>【 get】和【set 】</h4><p>在 descriptor 中不能 同时设置访问器 (get 和 set) 和 wriable 或 value，否则会错，就是说想用 (get 和 set)，就不能用（wriable 或 value 中的任何一个）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a= &#123;&#125;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(a,<span class=\"string\">&quot;b&quot;</span>,&#123;</span><br><span class=\"line\">  set:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newValue</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;你要赋值给我,我的新值是&quot;</span>＋newValue)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  get:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;你取我的值&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">2</span> <span class=\"comment\">//注意这里，我硬编码返回2</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">a.b =<span class=\"number\">1</span> <span class=\"comment\">//打印 你要赋值给我,我的新值是1</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.b)    <span class=\"comment\">//打印 你取我的值</span></span><br><span class=\"line\">                    <span class=\"comment\">//打印 2    注意这里，和我的硬编码相同的</span></span><br></pre></td></tr></table></figure>\n\n<p>** 这个 “b” 赋值 或者取值的时候会分别触发 set 和 get 对应的函数，这就是 observe 的关键，是 vue 实现 observe 的实现的基础，也是实现 $watch 的基础。</p>\n<h5 id=\"【-get】\"><a href=\"#【-get】\" class=\"headerlink\" title=\"【 get】\"></a>【 get】</h5><p>一旦目标对象访问该属性，就会调用这个方法，并返回结果。默认为 undefined。 ##### 【 set】 一旦目标对象设置该属性，就会调用这个方法。默认为 undefined。</p>\n<h2 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h2><p>在 ie8 下只能在 DOM 对象上使用，尝试在原生的对象使用 Object.defineProperty() 会报错。</p>"},{"title":"Observable","date":"2017-09-26T03:28:03.000Z","_content":"\n观察者模式又称发布订阅模式，在此种模式中，一个目标物件管理所有相依于它的观察者物件。并且在它本身的状态改变时主动发出通知。观察者模式（Observer ）完美的将观察者和被观察的对象分离开。\n\n<!--more-->\n\nObservable 只是一个普通函数，要想让他有所作为，就需要跟 observer 一起使用；而这个 observer（后面我们会介绍）只是一个带有 next、error 、 complete 的简单对象而已。最后，还需要通过 subscribe 订阅来 **启动** Observable；否则它是不会有任何反应；而订阅也会返回一个可用于取消操作（在 RxJS 里叫 unsubscribe）。\n\n- Observer Pattern - ( 观察者模式 / 发布订阅模式 )\n- Iterator Pattern - ( 迭代器模式 )\n\n这两种模式是 Observable 的基础。\n\n## 观察者模式\n\n一个目标对象管理所有相依于它的观察者对象，并且在它本身的状态改变时主动发出通知。它定义了一种一对多的关系，让多个观察者对象同时监听某一个主题对象，这个主题对象的状态发生变化时就会通知所有的观察者对象，使得它们能够自动更新自己。\n\nObservables 与 Observer 之间的订阅发布关系 ( 观察者模式 ) 如下：\n\n- 订阅：Observer 通过 Observable 提供的 subscribe() 方法订阅 Observable。\n- 发布：Observable 通过回调 next 方法向 Observer 发布事件。\n\n当 Observable 设置观察者后，而连接并获取原始数据的这个过程叫生产者，可能是 DOM 中的 click 事件、input 事件、或者更加复杂的 HTTP 通信。\n\n```javascript\nimport { Component } from '@angular/core'\nimport { Observable, Subscription } from 'rxjs'\n\n@Component({\n  selector: 'app-home',\n  template: `<input type=\"text\" /> `\n})\nexport class HomeComponent {\n  ngOnInit() {\n    const node = document.querySelector('input[type=text]')\n\n    // 第二个参数 input 是事件名，对于input元素有一个 oninput 事件用于接受用户输入\n    const input$ = Observable.fromEvent(node, 'input')\n    input$.subscribe({\n      next: (event: any) =>\n        console.log(`You just typed ${event.target.value}!`),\n      error: (err) => console.log(`Oops... ${err}`),\n      complete: () => console.log(`Complete!`)\n    })\n  }\n}\n```\n\n**Observable.fromEvent() 会返回一个 Observable，并且监听 input 事件，当事件被触发后会发送一个 Event 给对应的 observer 观察者。**\n\n## observer\n\n**subscribe 订阅就是接收一个 observer 方法。**\n\n```javascript\ninput$.subscribe((event: any) => {})\n```\n\n从语法角度来讲和 subscribe({ next, error, complete }) 是一样的。当 Observable 产生一个新值时，会通知 observer 的 next()，而当捕获失败可以调用 error()。\n\n当 Observable 被订阅后，除非调用 observer 的 complete() 或 unsubscribe() 取消订阅两情况以外；会一直将值传递给 observer。\n\nObservable 的生产的值允许经过一序列格式化或操作，最终得到一个有价值的数据给观察者，而这一切是由一序列链式 operator 来完成的，每一个 operator 都会产生一个新的 Observable。而我们也称这一序列过程为：**流**。\n\n---\n\n## operator\n\nObservable 可以链式写法，这意味着我们可以这样：\n\n```javascript\nObservable.fromEvent(node, 'input')\n  .map((event: any) => event.target.value)\n  .filter((value) => value.length >= 2)\n  .subscribe((value) => {\n    console.log(value)\n  })\n```\n\n下面是顺序步骤：\n\n- 假设用户输入：a\n- Observable 对触发 oninput 事件作出反应，将值以参数的形式传递给 observer 的 next()。\n- map() 根据 event.target.value 的内容返回一个新的 Observable，并调用 next() 传递给下一个 observer。\n- filter() 如果值长度 >=2 的话，则返回一个新的 Observable，并调用 next() 传递给下一个 observer。\n- 最后，将结果传递给 subscribe 订阅块。\n\n### 取消订阅\n\nObservable 当有数据产生时才会推送给订阅者，所以它可能会无限次向订阅者推送数据。正因为如此，在 Angular 里面创建组件的时候务必要取消订阅操作，以避免内存泄漏，要知道在 SPA 世界里懂得擦屁股是一件必须的事。\n\n### unsubscribe\n\n前面示例讲过，调用 subscribe() 后，会返回一个 Subscription 可用于取消操作 unsubscribe()。最合理的方式在 ngOnDestroy 调用它。\n\n```javascript\n    ngOnDestroy() {\n        this.inputSubscription.unsubscribe();\n    }\n```\n\n### takeWhile\n\n如果组件有很多订阅者的话，则需要将这些订阅者存储在数组中，并组件被销毁时再逐个取消订阅。但，我们有更好的办法：\n\n使用 takeWhile() operator，它会在你传递一个布尔值是调用 next() 还是 complete()。\n\n```javascript\nprivate alive: boolean = true;\nngOnInit() {\n  const node = document.querySelector('input[type=text]');\n\n  this.s = Observable.fromEvent(node, 'input')\n    .takeWhile(() => this.alive)\n    .map((event: any) => event.target.value)\n    .filter(value => value.length >= 2)\n    .subscribe(value => { console.log(value) });\n}\n\nngOnDestroy() {\n  this.alive = false;\n}\n```\n\n## Subject\n\n我们在写一个 Service 用于数据传递时，总是使用 new Subject。\n\n```javascript\n@Injectable()\nexport class MessageService {\n    private subject = new Subject<any>();\n\n    send(message: any) {\n        this.subject.next(message);\n    }\n\n    get(): Observable<any> {\n        return this.subject.asObservable();\n    }\n}\n```\n\n当 F 组件需要向 M 组件传递数据时，我们可以在 F 组件中使用 send()。\n\n```javascript\n    constructor(public srv: MessageService) { }\n\n    ngOnInit() {\n        this.srv.send('w s k f m?')\n    }\n```\n\n而 M 组件只需要订阅内容就行：\n\n```javascript\n    constructor(private srv: MessageService) {}\n\n    message: any;\n    ngOnInit() {\n        this.srv.get().subscribe((result) => {\n            this.message = result;\n        })\n    }\n```\n\n## EventEmitter\n\n其实 EventEmitter 跟 RxJS 没有直接关系，因为他是 Angular 的产物，而非 RxJS 的东西。或者我们压根没必要去谈，因为 EventEmitter 就是 Subject。\n\n**EventEmitter 的作用是使指令或组件能自定义事件。**\n\n```javascript\n@Output() changed = new EventEmitter<string>();\n\nclick() {\n    this.changed.emit('hi~');\n}\n```\n\n```javascript\n@Component({\n  template: `<comp (changed)=\"subscribe($event)\"></comp>`\n})\nexport class HomeComponent {\n  subscribe(message: string) {\n    // 接收：hi~\n  }\n}\n```\n\n上面示例其实和上一个示例中 MessageService 如出一辙，只不过是将 next() 换成 emit() 仅此而已。\n\n## 结论\n\n### 创建数据流：\n\n- 单值：of, empty, never\n- 多值：from\n- 定时：interval, timer\n- 从事件创建：fromEvent\n- 从 Promise 创建：fromPromise\n- 自定义创建：create\n\n### 转换操作：\n\n- 改变数据形态：map, mapTo, pluck\n- 过滤一些值：filter, skip, first, last, take\n- 时间轴上的操作：delay, timeout, throttle, debounce, audit, bufferTime\n- 累加：reduce, scan\n- 异常处理：throw, catch, retry, finally\n- 条件执行：takeUntil, delayWhen, retryWhen, subscribeOn, ObserveOn\n- 转接：switch\n\n### 组合数据流：\n\n- concat ，保持原来的序列顺序连接两个数据流\n- merge，合并序列\n- race，预设条件为其中一个数据流完成\n- forkJoin，预设条件为所有数据流都完成\n- zip，取各来源数据流最后一个值合并为对象\n- combineLatest，取各来源数据流最后一个值合并为数组另，最好使用 $ 结尾的命名方式来表示 Observable，例：input$ 。\n","source":"_posts/Observable.md","raw":"---\ntitle: Observable\ndate: 2017-09-26 11:28:03\ncategories: rx.js\n---\n\n观察者模式又称发布订阅模式，在此种模式中，一个目标物件管理所有相依于它的观察者物件。并且在它本身的状态改变时主动发出通知。观察者模式（Observer ）完美的将观察者和被观察的对象分离开。\n\n<!--more-->\n\nObservable 只是一个普通函数，要想让他有所作为，就需要跟 observer 一起使用；而这个 observer（后面我们会介绍）只是一个带有 next、error 、 complete 的简单对象而已。最后，还需要通过 subscribe 订阅来 **启动** Observable；否则它是不会有任何反应；而订阅也会返回一个可用于取消操作（在 RxJS 里叫 unsubscribe）。\n\n- Observer Pattern - ( 观察者模式 / 发布订阅模式 )\n- Iterator Pattern - ( 迭代器模式 )\n\n这两种模式是 Observable 的基础。\n\n## 观察者模式\n\n一个目标对象管理所有相依于它的观察者对象，并且在它本身的状态改变时主动发出通知。它定义了一种一对多的关系，让多个观察者对象同时监听某一个主题对象，这个主题对象的状态发生变化时就会通知所有的观察者对象，使得它们能够自动更新自己。\n\nObservables 与 Observer 之间的订阅发布关系 ( 观察者模式 ) 如下：\n\n- 订阅：Observer 通过 Observable 提供的 subscribe() 方法订阅 Observable。\n- 发布：Observable 通过回调 next 方法向 Observer 发布事件。\n\n当 Observable 设置观察者后，而连接并获取原始数据的这个过程叫生产者，可能是 DOM 中的 click 事件、input 事件、或者更加复杂的 HTTP 通信。\n\n```javascript\nimport { Component } from '@angular/core'\nimport { Observable, Subscription } from 'rxjs'\n\n@Component({\n  selector: 'app-home',\n  template: `<input type=\"text\" /> `\n})\nexport class HomeComponent {\n  ngOnInit() {\n    const node = document.querySelector('input[type=text]')\n\n    // 第二个参数 input 是事件名，对于input元素有一个 oninput 事件用于接受用户输入\n    const input$ = Observable.fromEvent(node, 'input')\n    input$.subscribe({\n      next: (event: any) =>\n        console.log(`You just typed ${event.target.value}!`),\n      error: (err) => console.log(`Oops... ${err}`),\n      complete: () => console.log(`Complete!`)\n    })\n  }\n}\n```\n\n**Observable.fromEvent() 会返回一个 Observable，并且监听 input 事件，当事件被触发后会发送一个 Event 给对应的 observer 观察者。**\n\n## observer\n\n**subscribe 订阅就是接收一个 observer 方法。**\n\n```javascript\ninput$.subscribe((event: any) => {})\n```\n\n从语法角度来讲和 subscribe({ next, error, complete }) 是一样的。当 Observable 产生一个新值时，会通知 observer 的 next()，而当捕获失败可以调用 error()。\n\n当 Observable 被订阅后，除非调用 observer 的 complete() 或 unsubscribe() 取消订阅两情况以外；会一直将值传递给 observer。\n\nObservable 的生产的值允许经过一序列格式化或操作，最终得到一个有价值的数据给观察者，而这一切是由一序列链式 operator 来完成的，每一个 operator 都会产生一个新的 Observable。而我们也称这一序列过程为：**流**。\n\n---\n\n## operator\n\nObservable 可以链式写法，这意味着我们可以这样：\n\n```javascript\nObservable.fromEvent(node, 'input')\n  .map((event: any) => event.target.value)\n  .filter((value) => value.length >= 2)\n  .subscribe((value) => {\n    console.log(value)\n  })\n```\n\n下面是顺序步骤：\n\n- 假设用户输入：a\n- Observable 对触发 oninput 事件作出反应，将值以参数的形式传递给 observer 的 next()。\n- map() 根据 event.target.value 的内容返回一个新的 Observable，并调用 next() 传递给下一个 observer。\n- filter() 如果值长度 >=2 的话，则返回一个新的 Observable，并调用 next() 传递给下一个 observer。\n- 最后，将结果传递给 subscribe 订阅块。\n\n### 取消订阅\n\nObservable 当有数据产生时才会推送给订阅者，所以它可能会无限次向订阅者推送数据。正因为如此，在 Angular 里面创建组件的时候务必要取消订阅操作，以避免内存泄漏，要知道在 SPA 世界里懂得擦屁股是一件必须的事。\n\n### unsubscribe\n\n前面示例讲过，调用 subscribe() 后，会返回一个 Subscription 可用于取消操作 unsubscribe()。最合理的方式在 ngOnDestroy 调用它。\n\n```javascript\n    ngOnDestroy() {\n        this.inputSubscription.unsubscribe();\n    }\n```\n\n### takeWhile\n\n如果组件有很多订阅者的话，则需要将这些订阅者存储在数组中，并组件被销毁时再逐个取消订阅。但，我们有更好的办法：\n\n使用 takeWhile() operator，它会在你传递一个布尔值是调用 next() 还是 complete()。\n\n```javascript\nprivate alive: boolean = true;\nngOnInit() {\n  const node = document.querySelector('input[type=text]');\n\n  this.s = Observable.fromEvent(node, 'input')\n    .takeWhile(() => this.alive)\n    .map((event: any) => event.target.value)\n    .filter(value => value.length >= 2)\n    .subscribe(value => { console.log(value) });\n}\n\nngOnDestroy() {\n  this.alive = false;\n}\n```\n\n## Subject\n\n我们在写一个 Service 用于数据传递时，总是使用 new Subject。\n\n```javascript\n@Injectable()\nexport class MessageService {\n    private subject = new Subject<any>();\n\n    send(message: any) {\n        this.subject.next(message);\n    }\n\n    get(): Observable<any> {\n        return this.subject.asObservable();\n    }\n}\n```\n\n当 F 组件需要向 M 组件传递数据时，我们可以在 F 组件中使用 send()。\n\n```javascript\n    constructor(public srv: MessageService) { }\n\n    ngOnInit() {\n        this.srv.send('w s k f m?')\n    }\n```\n\n而 M 组件只需要订阅内容就行：\n\n```javascript\n    constructor(private srv: MessageService) {}\n\n    message: any;\n    ngOnInit() {\n        this.srv.get().subscribe((result) => {\n            this.message = result;\n        })\n    }\n```\n\n## EventEmitter\n\n其实 EventEmitter 跟 RxJS 没有直接关系，因为他是 Angular 的产物，而非 RxJS 的东西。或者我们压根没必要去谈，因为 EventEmitter 就是 Subject。\n\n**EventEmitter 的作用是使指令或组件能自定义事件。**\n\n```javascript\n@Output() changed = new EventEmitter<string>();\n\nclick() {\n    this.changed.emit('hi~');\n}\n```\n\n```javascript\n@Component({\n  template: `<comp (changed)=\"subscribe($event)\"></comp>`\n})\nexport class HomeComponent {\n  subscribe(message: string) {\n    // 接收：hi~\n  }\n}\n```\n\n上面示例其实和上一个示例中 MessageService 如出一辙，只不过是将 next() 换成 emit() 仅此而已。\n\n## 结论\n\n### 创建数据流：\n\n- 单值：of, empty, never\n- 多值：from\n- 定时：interval, timer\n- 从事件创建：fromEvent\n- 从 Promise 创建：fromPromise\n- 自定义创建：create\n\n### 转换操作：\n\n- 改变数据形态：map, mapTo, pluck\n- 过滤一些值：filter, skip, first, last, take\n- 时间轴上的操作：delay, timeout, throttle, debounce, audit, bufferTime\n- 累加：reduce, scan\n- 异常处理：throw, catch, retry, finally\n- 条件执行：takeUntil, delayWhen, retryWhen, subscribeOn, ObserveOn\n- 转接：switch\n\n### 组合数据流：\n\n- concat ，保持原来的序列顺序连接两个数据流\n- merge，合并序列\n- race，预设条件为其中一个数据流完成\n- forkJoin，预设条件为所有数据流都完成\n- zip，取各来源数据流最后一个值合并为对象\n- combineLatest，取各来源数据流最后一个值合并为数组另，最好使用 $ 结尾的命名方式来表示 Observable，例：input$ 。\n","slug":"Observable","published":1,"updated":"2021-04-24T15:38:16.548Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wr000sl5v06u9zhhsj","content":"<p>观察者模式又称发布订阅模式，在此种模式中，一个目标物件管理所有相依于它的观察者物件。并且在它本身的状态改变时主动发出通知。观察者模式（Observer ）完美的将观察者和被观察的对象分离开。</p>\n<span id=\"more\"></span>\n\n<p>Observable 只是一个普通函数，要想让他有所作为，就需要跟 observer 一起使用；而这个 observer（后面我们会介绍）只是一个带有 next、error 、 complete 的简单对象而已。最后，还需要通过 subscribe 订阅来 <strong>启动</strong> Observable；否则它是不会有任何反应；而订阅也会返回一个可用于取消操作（在 RxJS 里叫 unsubscribe）。</p>\n<ul>\n<li>Observer Pattern - ( 观察者模式 / 发布订阅模式 )</li>\n<li>Iterator Pattern - ( 迭代器模式 )</li>\n</ul>\n<p>这两种模式是 Observable 的基础。</p>\n<h2 id=\"观察者模式\"><a href=\"#观察者模式\" class=\"headerlink\" title=\"观察者模式\"></a>观察者模式</h2><p>一个目标对象管理所有相依于它的观察者对象，并且在它本身的状态改变时主动发出通知。它定义了一种一对多的关系，让多个观察者对象同时监听某一个主题对象，这个主题对象的状态发生变化时就会通知所有的观察者对象，使得它们能够自动更新自己。</p>\n<p>Observables 与 Observer 之间的订阅发布关系 ( 观察者模式 ) 如下：</p>\n<ul>\n<li>订阅：Observer 通过 Observable 提供的 subscribe() 方法订阅 Observable。</li>\n<li>发布：Observable 通过回调 next 方法向 Observer 发布事件。</li>\n</ul>\n<p>当 Observable 设置观察者后，而连接并获取原始数据的这个过程叫生产者，可能是 DOM 中的 click 事件、input 事件、或者更加复杂的 HTTP 通信。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable, Subscription &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;rxjs&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">@Component(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">&#x27;app-home&#x27;</span>,</span><br><span class=\"line\">  template: <span class=\"string\">`&lt;input type=&quot;text&quot; /&gt; `</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeComponent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">ngOnInit</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> node = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;input[type=text]&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 第二个参数 input 是事件名，对于input元素有一个 oninput 事件用于接受用户输入</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> input$ = Observable.fromEvent(node, <span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">    input$.subscribe(&#123;</span><br><span class=\"line\">      next: <span class=\"function\">(<span class=\"params\">event: any</span>) =&gt;</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`You just typed <span class=\"subst\">$&#123;event.target.value&#125;</span>!`</span>),</span><br><span class=\"line\">      error: <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">`Oops... <span class=\"subst\">$&#123;err&#125;</span>`</span>),</span><br><span class=\"line\">      complete: <span class=\"function\">() =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">`Complete!`</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Observable.fromEvent() 会返回一个 Observable，并且监听 input 事件，当事件被触发后会发送一个 Event 给对应的 observer 观察者。</strong></p>\n<h2 id=\"observer\"><a href=\"#observer\" class=\"headerlink\" title=\"observer\"></a>observer</h2><p><strong>subscribe 订阅就是接收一个 observer 方法。</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input$.subscribe(<span class=\"function\">(<span class=\"params\">event: any</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>从语法角度来讲和 subscribe({ next, error, complete }) 是一样的。当 Observable 产生一个新值时，会通知 observer 的 next()，而当捕获失败可以调用 error()。</p>\n<p>当 Observable 被订阅后，除非调用 observer 的 complete() 或 unsubscribe() 取消订阅两情况以外；会一直将值传递给 observer。</p>\n<p>Observable 的生产的值允许经过一序列格式化或操作，最终得到一个有价值的数据给观察者，而这一切是由一序列链式 operator 来完成的，每一个 operator 都会产生一个新的 Observable。而我们也称这一序列过程为：<strong>流</strong>。</p>\n<hr>\n<h2 id=\"operator\"><a href=\"#operator\" class=\"headerlink\" title=\"operator\"></a>operator</h2><p>Observable 可以链式写法，这意味着我们可以这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Observable.fromEvent(node, <span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">  .map(<span class=\"function\">(<span class=\"params\">event: any</span>) =&gt;</span> event.target.value)</span><br><span class=\"line\">  .filter(<span class=\"function\">(<span class=\"params\">value</span>) =&gt;</span> value.length &gt;= <span class=\"number\">2</span>)</span><br><span class=\"line\">  .subscribe(<span class=\"function\">(<span class=\"params\">value</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>下面是顺序步骤：</p>\n<ul>\n<li>假设用户输入：a</li>\n<li>Observable 对触发 oninput 事件作出反应，将值以参数的形式传递给 observer 的 next()。</li>\n<li>map() 根据 event.target.value 的内容返回一个新的 Observable，并调用 next() 传递给下一个 observer。</li>\n<li>filter() 如果值长度 &gt;=2 的话，则返回一个新的 Observable，并调用 next() 传递给下一个 observer。</li>\n<li>最后，将结果传递给 subscribe 订阅块。</li>\n</ul>\n<h3 id=\"取消订阅\"><a href=\"#取消订阅\" class=\"headerlink\" title=\"取消订阅\"></a>取消订阅</h3><p>Observable 当有数据产生时才会推送给订阅者，所以它可能会无限次向订阅者推送数据。正因为如此，在 Angular 里面创建组件的时候务必要取消订阅操作，以避免内存泄漏，要知道在 SPA 世界里懂得擦屁股是一件必须的事。</p>\n<h3 id=\"unsubscribe\"><a href=\"#unsubscribe\" class=\"headerlink\" title=\"unsubscribe\"></a>unsubscribe</h3><p>前面示例讲过，调用 subscribe() 后，会返回一个 Subscription 可用于取消操作 unsubscribe()。最合理的方式在 ngOnDestroy 调用它。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnDestroy</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.inputSubscription.unsubscribe();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"takeWhile\"><a href=\"#takeWhile\" class=\"headerlink\" title=\"takeWhile\"></a>takeWhile</h3><p>如果组件有很多订阅者的话，则需要将这些订阅者存储在数组中，并组件被销毁时再逐个取消订阅。但，我们有更好的办法：</p>\n<p>使用 takeWhile() operator，它会在你传递一个布尔值是调用 next() 还是 complete()。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private alive: boolean = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnInit</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> node = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;input[type=text]&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.s = Observable.fromEvent(node, <span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">    .takeWhile(<span class=\"function\">() =&gt;</span> <span class=\"built_in\">this</span>.alive)</span><br><span class=\"line\">    .map(<span class=\"function\">(<span class=\"params\">event: any</span>) =&gt;</span> event.target.value)</span><br><span class=\"line\">    .filter(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span> value.length &gt;= <span class=\"number\">2</span>)</span><br><span class=\"line\">    .subscribe(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(value) &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnDestroy</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.alive = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Subject\"><a href=\"#Subject\" class=\"headerlink\" title=\"Subject\"></a>Subject</h2><p>我们在写一个 Service 用于数据传递时，总是使用 new Subject。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Injectable()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MessageService</span> </span>&#123;</span><br><span class=\"line\">    private subject = <span class=\"keyword\">new</span> Subject&lt;any&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">send</span>(<span class=\"params\">message: any</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.subject.next(message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    get(): Observable&lt;any&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.subject.asObservable();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当 F 组件需要向 M 组件传递数据时，我们可以在 F 组件中使用 send()。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">public srv: MessageService</span>)</span> &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnInit</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.srv.send(<span class=\"string\">&#x27;w s k f m?&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而 M 组件只需要订阅内容就行：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">private srv: MessageService</span>)</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">message: any;</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnInit</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.srv.get().subscribe(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.message = result;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"EventEmitter\"><a href=\"#EventEmitter\" class=\"headerlink\" title=\"EventEmitter\"></a>EventEmitter</h2><p>其实 EventEmitter 跟 RxJS 没有直接关系，因为他是 Angular 的产物，而非 RxJS 的东西。或者我们压根没必要去谈，因为 EventEmitter 就是 Subject。</p>\n<p><strong>EventEmitter 的作用是使指令或组件能自定义事件。</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Output() changed = <span class=\"keyword\">new</span> EventEmitter&lt;string&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">click</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.changed.emit(<span class=\"string\">&#x27;hi~&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component(&#123;</span><br><span class=\"line\">  template: <span class=\"string\">`&lt;comp (changed)=&quot;subscribe($event)&quot;&gt;&lt;/comp&gt;`</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeComponent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">subscribe</span>(<span class=\"params\">message: string</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 接收：hi~</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面示例其实和上一个示例中 MessageService 如出一辙，只不过是将 next() 换成 emit() 仅此而已。</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><h3 id=\"创建数据流：\"><a href=\"#创建数据流：\" class=\"headerlink\" title=\"创建数据流：\"></a>创建数据流：</h3><ul>\n<li>单值：of, empty, never</li>\n<li>多值：from</li>\n<li>定时：interval, timer</li>\n<li>从事件创建：fromEvent</li>\n<li>从 Promise 创建：fromPromise</li>\n<li>自定义创建：create</li>\n</ul>\n<h3 id=\"转换操作：\"><a href=\"#转换操作：\" class=\"headerlink\" title=\"转换操作：\"></a>转换操作：</h3><ul>\n<li>改变数据形态：map, mapTo, pluck</li>\n<li>过滤一些值：filter, skip, first, last, take</li>\n<li>时间轴上的操作：delay, timeout, throttle, debounce, audit, bufferTime</li>\n<li>累加：reduce, scan</li>\n<li>异常处理：throw, catch, retry, finally</li>\n<li>条件执行：takeUntil, delayWhen, retryWhen, subscribeOn, ObserveOn</li>\n<li>转接：switch</li>\n</ul>\n<h3 id=\"组合数据流：\"><a href=\"#组合数据流：\" class=\"headerlink\" title=\"组合数据流：\"></a>组合数据流：</h3><ul>\n<li>concat ，保持原来的序列顺序连接两个数据流</li>\n<li>merge，合并序列</li>\n<li>race，预设条件为其中一个数据流完成</li>\n<li>forkJoin，预设条件为所有数据流都完成</li>\n<li>zip，取各来源数据流最后一个值合并为对象</li>\n<li>combineLatest，取各来源数据流最后一个值合并为数组另，最好使用 $ 结尾的命名方式来表示 Observable，例：input$ 。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>观察者模式又称发布订阅模式，在此种模式中，一个目标物件管理所有相依于它的观察者物件。并且在它本身的状态改变时主动发出通知。观察者模式（Observer ）完美的将观察者和被观察的对象分离开。</p>","more":"<p>Observable 只是一个普通函数，要想让他有所作为，就需要跟 observer 一起使用；而这个 observer（后面我们会介绍）只是一个带有 next、error 、 complete 的简单对象而已。最后，还需要通过 subscribe 订阅来 <strong>启动</strong> Observable；否则它是不会有任何反应；而订阅也会返回一个可用于取消操作（在 RxJS 里叫 unsubscribe）。</p>\n<ul>\n<li>Observer Pattern - ( 观察者模式 / 发布订阅模式 )</li>\n<li>Iterator Pattern - ( 迭代器模式 )</li>\n</ul>\n<p>这两种模式是 Observable 的基础。</p>\n<h2 id=\"观察者模式\"><a href=\"#观察者模式\" class=\"headerlink\" title=\"观察者模式\"></a>观察者模式</h2><p>一个目标对象管理所有相依于它的观察者对象，并且在它本身的状态改变时主动发出通知。它定义了一种一对多的关系，让多个观察者对象同时监听某一个主题对象，这个主题对象的状态发生变化时就会通知所有的观察者对象，使得它们能够自动更新自己。</p>\n<p>Observables 与 Observer 之间的订阅发布关系 ( 观察者模式 ) 如下：</p>\n<ul>\n<li>订阅：Observer 通过 Observable 提供的 subscribe() 方法订阅 Observable。</li>\n<li>发布：Observable 通过回调 next 方法向 Observer 发布事件。</li>\n</ul>\n<p>当 Observable 设置观察者后，而连接并获取原始数据的这个过程叫生产者，可能是 DOM 中的 click 事件、input 事件、或者更加复杂的 HTTP 通信。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable, Subscription &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;rxjs&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">@Component(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">&#x27;app-home&#x27;</span>,</span><br><span class=\"line\">  template: <span class=\"string\">`&lt;input type=&quot;text&quot; /&gt; `</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeComponent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">ngOnInit</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> node = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;input[type=text]&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 第二个参数 input 是事件名，对于input元素有一个 oninput 事件用于接受用户输入</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> input$ = Observable.fromEvent(node, <span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">    input$.subscribe(&#123;</span><br><span class=\"line\">      next: <span class=\"function\">(<span class=\"params\">event: any</span>) =&gt;</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`You just typed <span class=\"subst\">$&#123;event.target.value&#125;</span>!`</span>),</span><br><span class=\"line\">      error: <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">`Oops... <span class=\"subst\">$&#123;err&#125;</span>`</span>),</span><br><span class=\"line\">      complete: <span class=\"function\">() =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">`Complete!`</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Observable.fromEvent() 会返回一个 Observable，并且监听 input 事件，当事件被触发后会发送一个 Event 给对应的 observer 观察者。</strong></p>\n<h2 id=\"observer\"><a href=\"#observer\" class=\"headerlink\" title=\"observer\"></a>observer</h2><p><strong>subscribe 订阅就是接收一个 observer 方法。</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input$.subscribe(<span class=\"function\">(<span class=\"params\">event: any</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>从语法角度来讲和 subscribe({ next, error, complete }) 是一样的。当 Observable 产生一个新值时，会通知 observer 的 next()，而当捕获失败可以调用 error()。</p>\n<p>当 Observable 被订阅后，除非调用 observer 的 complete() 或 unsubscribe() 取消订阅两情况以外；会一直将值传递给 observer。</p>\n<p>Observable 的生产的值允许经过一序列格式化或操作，最终得到一个有价值的数据给观察者，而这一切是由一序列链式 operator 来完成的，每一个 operator 都会产生一个新的 Observable。而我们也称这一序列过程为：<strong>流</strong>。</p>\n<hr>\n<h2 id=\"operator\"><a href=\"#operator\" class=\"headerlink\" title=\"operator\"></a>operator</h2><p>Observable 可以链式写法，这意味着我们可以这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Observable.fromEvent(node, <span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">  .map(<span class=\"function\">(<span class=\"params\">event: any</span>) =&gt;</span> event.target.value)</span><br><span class=\"line\">  .filter(<span class=\"function\">(<span class=\"params\">value</span>) =&gt;</span> value.length &gt;= <span class=\"number\">2</span>)</span><br><span class=\"line\">  .subscribe(<span class=\"function\">(<span class=\"params\">value</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(value)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>下面是顺序步骤：</p>\n<ul>\n<li>假设用户输入：a</li>\n<li>Observable 对触发 oninput 事件作出反应，将值以参数的形式传递给 observer 的 next()。</li>\n<li>map() 根据 event.target.value 的内容返回一个新的 Observable，并调用 next() 传递给下一个 observer。</li>\n<li>filter() 如果值长度 &gt;=2 的话，则返回一个新的 Observable，并调用 next() 传递给下一个 observer。</li>\n<li>最后，将结果传递给 subscribe 订阅块。</li>\n</ul>\n<h3 id=\"取消订阅\"><a href=\"#取消订阅\" class=\"headerlink\" title=\"取消订阅\"></a>取消订阅</h3><p>Observable 当有数据产生时才会推送给订阅者，所以它可能会无限次向订阅者推送数据。正因为如此，在 Angular 里面创建组件的时候务必要取消订阅操作，以避免内存泄漏，要知道在 SPA 世界里懂得擦屁股是一件必须的事。</p>\n<h3 id=\"unsubscribe\"><a href=\"#unsubscribe\" class=\"headerlink\" title=\"unsubscribe\"></a>unsubscribe</h3><p>前面示例讲过，调用 subscribe() 后，会返回一个 Subscription 可用于取消操作 unsubscribe()。最合理的方式在 ngOnDestroy 调用它。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnDestroy</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.inputSubscription.unsubscribe();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"takeWhile\"><a href=\"#takeWhile\" class=\"headerlink\" title=\"takeWhile\"></a>takeWhile</h3><p>如果组件有很多订阅者的话，则需要将这些订阅者存储在数组中，并组件被销毁时再逐个取消订阅。但，我们有更好的办法：</p>\n<p>使用 takeWhile() operator，它会在你传递一个布尔值是调用 next() 还是 complete()。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private alive: boolean = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnInit</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> node = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;input[type=text]&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.s = Observable.fromEvent(node, <span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">    .takeWhile(<span class=\"function\">() =&gt;</span> <span class=\"built_in\">this</span>.alive)</span><br><span class=\"line\">    .map(<span class=\"function\">(<span class=\"params\">event: any</span>) =&gt;</span> event.target.value)</span><br><span class=\"line\">    .filter(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span> value.length &gt;= <span class=\"number\">2</span>)</span><br><span class=\"line\">    .subscribe(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(value) &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnDestroy</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.alive = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Subject\"><a href=\"#Subject\" class=\"headerlink\" title=\"Subject\"></a>Subject</h2><p>我们在写一个 Service 用于数据传递时，总是使用 new Subject。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Injectable()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MessageService</span> </span>&#123;</span><br><span class=\"line\">    private subject = <span class=\"keyword\">new</span> Subject&lt;any&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">send</span>(<span class=\"params\">message: any</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.subject.next(message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    get(): Observable&lt;any&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.subject.asObservable();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当 F 组件需要向 M 组件传递数据时，我们可以在 F 组件中使用 send()。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">public srv: MessageService</span>)</span> &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnInit</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.srv.send(<span class=\"string\">&#x27;w s k f m?&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而 M 组件只需要订阅内容就行：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">private srv: MessageService</span>)</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">message: any;</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">ngOnInit</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.srv.get().subscribe(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.message = result;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"EventEmitter\"><a href=\"#EventEmitter\" class=\"headerlink\" title=\"EventEmitter\"></a>EventEmitter</h2><p>其实 EventEmitter 跟 RxJS 没有直接关系，因为他是 Angular 的产物，而非 RxJS 的东西。或者我们压根没必要去谈，因为 EventEmitter 就是 Subject。</p>\n<p><strong>EventEmitter 的作用是使指令或组件能自定义事件。</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Output() changed = <span class=\"keyword\">new</span> EventEmitter&lt;string&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">click</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.changed.emit(<span class=\"string\">&#x27;hi~&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component(&#123;</span><br><span class=\"line\">  template: <span class=\"string\">`&lt;comp (changed)=&quot;subscribe($event)&quot;&gt;&lt;/comp&gt;`</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeComponent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">subscribe</span>(<span class=\"params\">message: string</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 接收：hi~</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面示例其实和上一个示例中 MessageService 如出一辙，只不过是将 next() 换成 emit() 仅此而已。</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><h3 id=\"创建数据流：\"><a href=\"#创建数据流：\" class=\"headerlink\" title=\"创建数据流：\"></a>创建数据流：</h3><ul>\n<li>单值：of, empty, never</li>\n<li>多值：from</li>\n<li>定时：interval, timer</li>\n<li>从事件创建：fromEvent</li>\n<li>从 Promise 创建：fromPromise</li>\n<li>自定义创建：create</li>\n</ul>\n<h3 id=\"转换操作：\"><a href=\"#转换操作：\" class=\"headerlink\" title=\"转换操作：\"></a>转换操作：</h3><ul>\n<li>改变数据形态：map, mapTo, pluck</li>\n<li>过滤一些值：filter, skip, first, last, take</li>\n<li>时间轴上的操作：delay, timeout, throttle, debounce, audit, bufferTime</li>\n<li>累加：reduce, scan</li>\n<li>异常处理：throw, catch, retry, finally</li>\n<li>条件执行：takeUntil, delayWhen, retryWhen, subscribeOn, ObserveOn</li>\n<li>转接：switch</li>\n</ul>\n<h3 id=\"组合数据流：\"><a href=\"#组合数据流：\" class=\"headerlink\" title=\"组合数据流：\"></a>组合数据流：</h3><ul>\n<li>concat ，保持原来的序列顺序连接两个数据流</li>\n<li>merge，合并序列</li>\n<li>race，预设条件为其中一个数据流完成</li>\n<li>forkJoin，预设条件为所有数据流都完成</li>\n<li>zip，取各来源数据流最后一个值合并为对象</li>\n<li>combineLatest，取各来源数据流最后一个值合并为数组另，最好使用 $ 结尾的命名方式来表示 Observable，例：input$ 。</li>\n</ul>"},{"title":"PWA 离线缓存","date":"2017-11-01T03:28:03.000Z","_content":"\n## PWA (Progressive Web App) 特点\n\n1. installability( 可安装性 )，可被添加自主屏与全屏运行。\n2. app shell: 第一次渲染个壳，等异步数据来了在填充。\n3. offline( 离线能力 )：离线和弱网环境也能秒开，server worker 给了 web 一个可以跑后台的线程，它可以搭配非常靠谱的 cache Api 做缓存、可以拦截所有 Http 请求并使用 Fetch API 进行 response ，一个非常完备哦的 proxy 就这么诞生了\n4. re-engageable：推送通知的能力，依赖 service Worker 与 http push，不过默认支持的可是 GCM\n5. 推送是指服务器向服务工作线程提供信息的操作\n6. 通知是指服务工作线程或网页脚本向用户信息的操作。\n\n<!--more-->\n\n## service Worker 有以下功能和特性\n\nservice Worker 是 Chorme 团队提出和力推的一个 WEB Api，用于给 web 应用日工高级的可持续的后台处理能力。\n\nservice Worke 最主要的特点是：在页面中注册成功后，运行与浏览器后台，不受页面刷新的影响（此功能对于执行后台同步和提供推送通知很重要），可以监听和拦截作用于范围内所有页面的 HTTP 请求\n\n类似一个服务器与浏览器之间的中间人角色，如果网站中注册了 service worker 那么它可以拦截当前网站的所有请求，进行判断（需要编写相应的判断程序），如果需要向服务器发起请求的就转给服务器，如果可以直接使用缓存的就直接返回缓存不再给服务器，从而大大挺高浏览器体验。\n\n- 一个独立的 worker 线程，独立于当前网页进程，有自己独立的 worker context。\n- 一旦被 install，就永远存在，除非被 uninstall\n- 需要的时候可以直接唤醒，不需要的时候自动睡眠（有效利用资源，此处有坑）\n- 可编程拦截代理请求和返回，缓存文件，缓存的文件可以被网页进程取到（包括网络离线状态）\n- 离线内容开发者可控\n- 能向客户端推送消息\n- 不能直接操作 DOM\n- 出于安全的考虑，必须在 HTTPS 环境下才能工作\n- 异步实现，内部大都是通过 Promise 实现\n\n### service Worker 前提条件\n\n- 要求 HTTPS 的环境\n- 缓存机制是依赖 cache API 实现的 (cacheStorage)\n- 依赖 HTML5 fetchAPI\n- 依赖 Promise\n\n### 注册\n\n```javascript\nif ('serviceWorker' in navigator) {\n  navigator.serviceWorker\n    .register('./pwa/sw.js', { scope: '/pwa' })\n    .then(function (registration) {\n      console.log('Service Worker 注册成功，域名: ', registration.scope)\n    })\n    .catch(function (err) {\n      console.log('Service Worker 注册失败: ', err)\n    })\n}\n```\n\n每次页面加载成功后，就会调用 register()方法。浏览器会判断 service Worker 线程是否已注册，并作出相应的处理\nscope 方法是可选的，用于指定你想让 service worker 控制内容的子目录。service worker 线程将接受\nscope 指定网域目录上所有事项的 fetch 事件。并将它保存在你正在访问的域名下。\nsw.js 将包含所有自定义的 service worker 事件处理程序\nscope 的意义在于如果 sw.js 在/a/b/sw.js 下，那么 scope 默认是/a/b,那么 service worker 线程只能\n捕捉到 path 为/a/b 开头的（/a/b/page1,/a/b/page2,..)下的 fetch 事件\n\n现在 Service Worker 已经被注册好了，接下来是在 Service Worker 生命周期中触发实现对应的事件处理程序了。\n\n### 事件处理程序\n\n生命周期：installing installed activating activated,这个状态变化的过程就是 service worker 生命周期的反应。\n\n### 安装\n\ninstall 事件我们会绑定在 service worker 文件中，在 service worker 安装成功后，install 事件被触发。**install 事件一般是被用来填充你的浏览器的离线缓存能力。**为了达到这个目的，我们使用了 service worker 新的标志性的存储**cache API** ——一个 service worker 上的全局对象，**它使我们可以存储网络响应发来的资源，并且根据他们的请求来生成 key**。这个 API 和浏览器的标准的缓存工作原理很相似，但是是只对应你的站点的域的。它会一直持久存在，直到你告诉它不再存储，你拥有全部的控制权。\n\n由于 service worker 是走的另外的线程，因此，window 和 DOM 都是不能访问的，因此我们要使用 self 访问全局上下文。\n\n```javascript\nconst CACHE_NAME = 'yu'\nconst urlsToCache = ['/', '/js/main.js', '/css/style.css', '/img/bob-ross.jpg']\n\nself.addEventListener('install', function (e) {\n  console.log('[ServiceWorker] Install')\n  /*ExtendableEvent.waitUntil():\n         延长了时间的生命周期。在服务工作中，延长事件的生命周期阻止浏览器在事件中的一部操作完成之前终止service worker。\n         当在与安装事件相关联的EventHandler中调用时，它会延时将已安装的工作程序视为安装，\n         直到传递的promise成功解析为止。这主要用于确保service worker在其依赖的所有核心高速缓存填充之前不会被考虑安装*/\n  e.waitUntil(\n    caches.open(chache_name).then(function (cache) {\n      console.log('[ServiceWorker] Caching app shell')\n      console.log(cache)\n      return cache.addAll(urlsToCache)\n    })\n  )\n})\n```\n\n这里我们新增了`install`事件监听器，接着在事件上接了一个`ExtendableEvent.waitUntil()`方法\n这会确保`service worker`不会在`waitUntil()`里面的代码执行完毕之前安装完成\n我们使用`caches.open()`方法创建了一个 yu 的新缓存，将会是我们站点资源的缓存的第一个版本。它返回了一个创建缓存的`promise`,\n当它`resolved` 的时候，我们接着会调用在创建的缓存上的一个方法`addALL()`，这个方法的参数是一个由一组相对于 origin 的 URL 组成的数组，\n这个数组就是你想缓存的资源的列表\n`caches`是一个全局的`CacheStorage`对象，允许在浏览器中管理你的缓存。调用`open`方法来检索具体我们想要使用的`Cache`对象。\n\n### 更新静态资源\n\n缓存资源随着版本的更新会过期，所以会根据缓存的字符串名称（CACHE_NAME）值清除旧缓存，可以遍历所有的缓存名称最易判断决定是否清除\n\n```javascript\nself.addEventListener('activate', function (e) {\n  e.waitUntil(\n    Promise.all(\n      caches.keys().then((cacheNames) => {\n        return cacheNames.map((name) => {\n          if (name !== CACHE_NAME) {\n            return caches.delete(name)\n          }\n        })\n      })\n    ).then(() => {\n      return self.clients.claim()\n    })\n  )\n})\n```\n\n在新安装的 Service Worker 中调用 self.clients.claim()取的页面的控制权，这样之后打开的页面都会使用版本更新的缓存。旧的 Service Worker 脚本不在控制页面之后会被停止。\n\n### 自定义请求响应\n\n```javascript\nself.addEventListener('fetch', function (e) {\n  console.log('[service worker] fetch', e.request.url)\n  /*respondWith()方法旨在包裹代码，这些代码为来自受控页面的request生成的自定义的response。用来劫持我们的http响应*/\n  e.resondWith(\n    caches.match(e.request).then(function () {\n      //如果sw有自己的返回，就直接返回，减少一次http请求。\n      if (response) {\n        return response\n      }\n\n      //如果没有返回，就直接请求真实远程服务\n      var request = e.request.clone() //拷贝原始请求\n      //clone()允许多次请求body()对象。\n      return fetch(request).then(function (httpRes) {\n        //http请求的返回已经抓到，可以进行设置\n\n        //请求失败，直接返回失败的结果\n        if (!httpRes || httpRes.status !== 200) {\n          return httpRes\n        }\n        //  请求成功，将请求缓存\n        var responseClone = httpRes.clone()\n        caches.open(cache_name).then(function (cache) {\n          cache.put(e.request, responseClone)\n        })\n        return httpRes\n      })\n    })\n  )\n})\n```\n\n每次任何被`service worker` 控制的资源被请求到时，都会触发`fetch`事件，这些资源包括了指定的`scope`内的\n`html` 文档，和这些`html`文档内引用的其他任何资源（比如`index.html`发起了一个跨域的请求来嵌入一张图片，这个也会通过`service worker`。\n我们可以在`install` 的时候进行静态资源缓存。也可以通过`fetch`事件回调来代理页面请求从而实现动态资源缓存:\n\n- `on install` 的优点是第二次访问就可以离线访问，缺点是需要缓存的 URL 在编译时插入到脚本中，增加代码量和降低可维护性。\n- `on fetch` 的优点是无需变更编译过程，也不会产生额外的流量，缺点是需要多一次访问才能离线访问。\n- `request` 属性包含在`FetchEvent`对象里，它用于查找匹配请求的缓存。\n- `cache.match`将尝试找到一个与指定请求匹配的缓存响应。如果没有找到对应的缓存，则`promise`会返回一个 undefined 值。在这里我们通过判断这个值来决定是否返回这个值，还是调用`fetch`发出一个网络请求并返回一个`promise`。\n- `e.resondWith`是一个 fetchevent 对象中的特殊方法，用于将请求的响应发送回浏览器（提供对应的请求）。打开缓存找到匹配的响应，如果它不存在，就发情网络请求。\n\n#### Fetch 事件\n\n`fetch`事件是在每次网页发出请求的时候触发的，触发该事件的时候 `service worker`能够拦截请求，弄决定是返回缓存的数据，还是返回真是请求响应的数据。与请求匹配的任何缓存数据都将优先被返回，而不需要发送网络请求。只有当没有现有的缓存数据时才会发出网络请求。\n\n#### Service Worker 生命周期 （也许翻译的不好，尽量去看原文）\n\n- **installing**: 这一阶段标志着开始注册。它想要允许设置 worker-specific 的资源,例如离线模式的 caches.\n  - 用 **event.waitUntil()** 通过一个 promise 去延长安装 service worker 阶段直到 e.waitUntil()里的代码执行完毕。如果所有资源安装成功缓存则安装成功，否则安装失败，则无法激活 service worker。\n  - 用 **self.skipWaiting()** self 是当前 context 的 global 变量。强制当前处于 waiting 状态的脚本进入 activate 状态。\n- **installed**:service worker 已经完成了它的安装，在等待其他 service Workers 线程被关闭。\n- **activating**: 这时没有被其他 workers 控制的客户端。这个阶段允许 workers 去完成安装并且清理其他 worker 以及关联缓存的就缓存资源，等待新的 service worker 线程被激活。\n- **activated**:现在可以处理方法事件。\n- **message**: service worker 运行于独立 context 中，无法直接访问当前页面主线程的 DOM 信息，但是通过 postMessageAPI ,可以实现他们之间的消息传递，这样主线程就可以接受 service worker 的指令操作 DOM。\n\n### 定期后台同步\n\nservice Worker 与其他服务工作者 在一个单独的线程上运行，所以即使关闭页面，它们也可以执行其代码，此功能对于执行后台同步和提供推送通知很重要\n\n后台同步的目的是解决这个问题，一旦链接重新建立，自动发送数据\n\n```JS\n// app.js\nnavigator.serviceWorker.ready.then((registration) => {\n  return registration.sync.register('sync-save-document');\n});\n```\n\n```JS\n//service-worker.js\nself.addEventListener('sync', (event) => {\n  if (event.tag === 'sync-save-document') {\n    event.waitUntil(saveDocument());\n  }\n});\n```\n\nsaveDocument 是一个返回 Promise，如果被拒接(例如网络问题)，同步将自动重试。\n\n要注意的一件事是，同步标记必须是唯一的。 例如，如果我要安排 5 个“message”类型的后台同步，则只有最后一个会通过。 因此，在这种情况下，每个标签都应具有唯一的标识符。\n\n#### 后台同步\n\n用户离开页面后，后台同步通常用于同步数据\n\n例如，在手机上编辑文档后，我们写完会点击保存并离开页面，如果在编辑文档期间链接断开，我们必须等待链接回复才能保存文档\n\n#### 定期后台同步\n\n定期后台同步解决与正常那个后台同步不同的问题。该 API 可用于在后台更新数据，而不必等待用户\n\n有了这项技术，用户可以在没有互联网链接的情况下阅读最新的新闻文章\n\n为了防止滥用这个功能，同步的频率取决于浏览器为每个网站设置的站点参与度分数。如果经常打开一个页面，这个频率最多可以达到 12 小时\n\n不放此目的一个要求的是，该网站以作为移动端上的一个 PWA 安装并被天假到主屏幕\n\n## manifest.json\n\npwa 添加至桌面的功能实现依赖于 manifest.json。\n\n### 基本功能\n\n- name:{string} 应用名称，用于安装横幅、启动画面显示\n- short_name:{string} 应用短名称，用于主屏幕显示\n- icon:img 应用图标列表，其中包括:\n  - src:{string} 图标 URL\n  - type:图标的 mime 类型\n  - size:图标尺寸。当 PWA 添加到主屏幕时，浏览器会根据有效图标的 size 字段进行选择，如果匹配到的图标路径错误，将会显示浏览器默认 icon。\n- start_url:{string=} 应用启动地址\n- background_color:{color} css 色值\n- display: {string} 显示类型\n  - fullScreen: 应用的显示界面将占满整个屏幕\n  - standalone: 浏览器相关 UI（导航栏、工具栏等）将会被隐藏\n  - minimal-ui: 显示形式与 standalone 类似，浏览器相关 UI 会最小化为一个按钮，不同浏览器在实现上略有不同\n  - browser: 浏览器模式，与普通网页在浏览器中打开的显示一致\n- orientation: string 应用显示方向\n- theme_color: 主题颜色\n\n### 设置作用域\n\n- 如果没有在 manifest 中设置 scope，则默认的作用域为 manifest.json 所在的文件夹；\n- **start_url 必须在作用域范围之内**;\n- 如果 start_url 为相对地址，其根路径收 scope 所影响;\n- 如果 start_url 为绝对地址（以/开头）,则该地址将永远以/作为跟地址；\n\n### 添加启动动画\n\n当 PWA 添加到主屏幕点击打开时，幕后执行了若干操作：\n\n1. 启动浏览器\n2. 启动显示页面的渲染器\n3. 加载资源\n\n在这个过程中，由于页面未加载完毕，因此屏幕将显示空白并且看似停滞。如果是从网络加载的页面资源，白屏过程将会变得更加明显。因此 PWA 提供了启动画面功能，用标题、颜色和图像组成的画面来替代白屏，提升用户体验。\n\n目前，如果修改了 manifest.json 的应用的名称，已经添加到主屏幕的名称并不会改变，只有当用户重新添加到桌面时，更改后的名称才会显示出来。但是未来版本的 chrome 支持自动更新。\n\n## 更新页面\n\n如何解决每次发布上线，用户首次拿到的都是旧的，需要再次刷新呢？\n（个人认为这是一个缺点）\n页面被缓存之后，就需要适当处理缓存失效时的页面更新。某些配置中被缓存的资源是无法发起请求判断是否被更新的，只有 sw.js 会自动根据 HTTP 缓存的机制尝试去判断应用是否被更新。所以当页面发生改变时，要同时对 sw.js 文件的缓存名进行修改。这就意味着在联网情况下，用户得到的可能不是最新的数据。\n\n然后重新打开页面，这个时候渲染的页面依旧是的，但是 sw.js 被安装和激活。之后关闭页面后再次打开才可以看到更新过后的页面。所以最好是将一些不经常更改的静态文件发到缓存中，提高用户体验。\n\n### 如何更新一个 service Worker\n\n更新你 service worker 的 JavaScript 文件\n\n1. 当用户浏览你的网站时，浏览器尝试在后台重新下载 service worker 的脚本文件。经过对比，只要服务器上的文件和本地文件有一个字节不同，这个文件就认为是新的。\n2. 之后更新后的 service worker 启动并触发 install 事件。\n3. 此时，当前页面生效的依然是老版本的 service worker，新的 service worker 会进入 “waiting” 状态。\n4. 当页面关闭之后，老的 service worker 会被干掉，新的 servicer worker 接管页面\n5. 一旦新的 service worker 生效后会触发 activate 事件。\n\n之前我们使用的缓存可以叫 my-site-cache-v1 ，我们想把这个拆封到多个缓存，一份给页面使用，一份给博客文章使用。这意味着，install 步骤里，我们要创建两个缓存： pages-cache-v1 和 blog-posts-cache-v1。在 activite 步骤里，我们需要删除旧的 my-site-cache-v1。\n\n下面的代码会遍历所有的缓存，并删除掉不在 cacheWhitelist 数组（我们定义的缓存白名单）中的缓存。\n\n```JS\nself.addEventListener('activate', function(event) {\n\n  var cacheWhitelist = ['pages-cache-v1', 'blog-posts-cache-v1'];\n\n  event.waitUntil(\n    caches.keys().then(function(cacheNames) {\n      return Promise.all(\n        cacheNames.map(function(cacheName) {\n          if (cacheWhitelist.indexOf(cacheName) === -1) {\n            return caches.delete(cacheName);\n          }\n        })\n      );\n    })\n  );\n});\n```\n\n### 设置 Cache-Control\n\n静态文件，类似于图片和视频等不会经常改变的资源，做长时间缓存是没有很大的问题，可以在 HTTP 头里设置 `Cache-Control`来缓存文件使其缓存时间为一年：`Cache-Control: max-age=31536000`\n\n页面，css 和 script 文件会经常变化，所以应该设置一个很短的缓存时间比如 24 小时，并在联网时与服务区端文件进行验证 `Cache-Control: must-revalidate, max-age=86400`\n\n### 为什么首次注册之后的首次刷新没有拦截到网络请求\n\n而在首次注册、安装、激活之后，Service Worker 已经拿到了当前页面的控制权了，但为什么首次刷新却没有拦截到网络请求呢？主要是因为在 Service Worker 的注册是一个异步的过程，在激活完成后当前页面的请求都已经发送完成，因为时机太晚，此时是拦截不到任何请求的，只能等待下次访问再进行。\n\n而第二次刷新页面，由于当前站点的 Service Worker 是处于激活状态，所以不会再次新建 worker 工作线程并执行 Service Worker。也就是说激活状态的 Service Worker 在一个站点只会存在一个 worker 工作线程，除非 Service Worker 文件发生了变化（手动 unregister Service Worker 也会注销掉 worker 工作线程），触发了浏览器更新，才会重新开启生命周期。而由于 Service Worker 工作线程的离线特性，只要处于激活状态，在后续的任何访问中，都会通过 fetch 事件监听器拦截当前页面的网络请求，并执行 fetch 事件回调。\n\n## 参考\n\n1. [Service Worker 生命周期](hhttps://developers.google.com/web/fundamentals/primers/service-workers/lifecycle?hl=zh-cn)\n1. [PWA 应用实战](https://lavas-project.github.io/pwa-book/)\n1. [发现刷新两次，数据才更新](https://blog.csdn.net/zmx_FZ/article/details/106206890)\n1. [浏览器缓存、CacheStorage、Web Worker 与 Service Worke](https://github.com/youngwind/blog/issues/113)\n1. [谨慎处理 Service Worker 的更新](https://juejin.cn/post/6844903792522035208)\n1. [ServiceWorkerRegistration.update](https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerRegistration/update)\n1. [Service Worker 更新机制](https://harttle.land/2017/04/10/service-worker-update.html)\n1. [借助 Service Worker 和 cacheStorage 缓存及离线开发](https://www.zhangxinxu.com/wordpress/2017/07/service-worker-cachestorage-offline-develop/)\n1. [Service Workers - JavaScript API 简介](https://segmentfault.com/a/1190000027080988)\n","source":"_posts/PWA-offline.md","raw":"---\ntitle: PWA 离线缓存\ndate: 2017-11-01 11:28:03\ncategories: Web\n---\n\n## PWA (Progressive Web App) 特点\n\n1. installability( 可安装性 )，可被添加自主屏与全屏运行。\n2. app shell: 第一次渲染个壳，等异步数据来了在填充。\n3. offline( 离线能力 )：离线和弱网环境也能秒开，server worker 给了 web 一个可以跑后台的线程，它可以搭配非常靠谱的 cache Api 做缓存、可以拦截所有 Http 请求并使用 Fetch API 进行 response ，一个非常完备哦的 proxy 就这么诞生了\n4. re-engageable：推送通知的能力，依赖 service Worker 与 http push，不过默认支持的可是 GCM\n5. 推送是指服务器向服务工作线程提供信息的操作\n6. 通知是指服务工作线程或网页脚本向用户信息的操作。\n\n<!--more-->\n\n## service Worker 有以下功能和特性\n\nservice Worker 是 Chorme 团队提出和力推的一个 WEB Api，用于给 web 应用日工高级的可持续的后台处理能力。\n\nservice Worke 最主要的特点是：在页面中注册成功后，运行与浏览器后台，不受页面刷新的影响（此功能对于执行后台同步和提供推送通知很重要），可以监听和拦截作用于范围内所有页面的 HTTP 请求\n\n类似一个服务器与浏览器之间的中间人角色，如果网站中注册了 service worker 那么它可以拦截当前网站的所有请求，进行判断（需要编写相应的判断程序），如果需要向服务器发起请求的就转给服务器，如果可以直接使用缓存的就直接返回缓存不再给服务器，从而大大挺高浏览器体验。\n\n- 一个独立的 worker 线程，独立于当前网页进程，有自己独立的 worker context。\n- 一旦被 install，就永远存在，除非被 uninstall\n- 需要的时候可以直接唤醒，不需要的时候自动睡眠（有效利用资源，此处有坑）\n- 可编程拦截代理请求和返回，缓存文件，缓存的文件可以被网页进程取到（包括网络离线状态）\n- 离线内容开发者可控\n- 能向客户端推送消息\n- 不能直接操作 DOM\n- 出于安全的考虑，必须在 HTTPS 环境下才能工作\n- 异步实现，内部大都是通过 Promise 实现\n\n### service Worker 前提条件\n\n- 要求 HTTPS 的环境\n- 缓存机制是依赖 cache API 实现的 (cacheStorage)\n- 依赖 HTML5 fetchAPI\n- 依赖 Promise\n\n### 注册\n\n```javascript\nif ('serviceWorker' in navigator) {\n  navigator.serviceWorker\n    .register('./pwa/sw.js', { scope: '/pwa' })\n    .then(function (registration) {\n      console.log('Service Worker 注册成功，域名: ', registration.scope)\n    })\n    .catch(function (err) {\n      console.log('Service Worker 注册失败: ', err)\n    })\n}\n```\n\n每次页面加载成功后，就会调用 register()方法。浏览器会判断 service Worker 线程是否已注册，并作出相应的处理\nscope 方法是可选的，用于指定你想让 service worker 控制内容的子目录。service worker 线程将接受\nscope 指定网域目录上所有事项的 fetch 事件。并将它保存在你正在访问的域名下。\nsw.js 将包含所有自定义的 service worker 事件处理程序\nscope 的意义在于如果 sw.js 在/a/b/sw.js 下，那么 scope 默认是/a/b,那么 service worker 线程只能\n捕捉到 path 为/a/b 开头的（/a/b/page1,/a/b/page2,..)下的 fetch 事件\n\n现在 Service Worker 已经被注册好了，接下来是在 Service Worker 生命周期中触发实现对应的事件处理程序了。\n\n### 事件处理程序\n\n生命周期：installing installed activating activated,这个状态变化的过程就是 service worker 生命周期的反应。\n\n### 安装\n\ninstall 事件我们会绑定在 service worker 文件中，在 service worker 安装成功后，install 事件被触发。**install 事件一般是被用来填充你的浏览器的离线缓存能力。**为了达到这个目的，我们使用了 service worker 新的标志性的存储**cache API** ——一个 service worker 上的全局对象，**它使我们可以存储网络响应发来的资源，并且根据他们的请求来生成 key**。这个 API 和浏览器的标准的缓存工作原理很相似，但是是只对应你的站点的域的。它会一直持久存在，直到你告诉它不再存储，你拥有全部的控制权。\n\n由于 service worker 是走的另外的线程，因此，window 和 DOM 都是不能访问的，因此我们要使用 self 访问全局上下文。\n\n```javascript\nconst CACHE_NAME = 'yu'\nconst urlsToCache = ['/', '/js/main.js', '/css/style.css', '/img/bob-ross.jpg']\n\nself.addEventListener('install', function (e) {\n  console.log('[ServiceWorker] Install')\n  /*ExtendableEvent.waitUntil():\n         延长了时间的生命周期。在服务工作中，延长事件的生命周期阻止浏览器在事件中的一部操作完成之前终止service worker。\n         当在与安装事件相关联的EventHandler中调用时，它会延时将已安装的工作程序视为安装，\n         直到传递的promise成功解析为止。这主要用于确保service worker在其依赖的所有核心高速缓存填充之前不会被考虑安装*/\n  e.waitUntil(\n    caches.open(chache_name).then(function (cache) {\n      console.log('[ServiceWorker] Caching app shell')\n      console.log(cache)\n      return cache.addAll(urlsToCache)\n    })\n  )\n})\n```\n\n这里我们新增了`install`事件监听器，接着在事件上接了一个`ExtendableEvent.waitUntil()`方法\n这会确保`service worker`不会在`waitUntil()`里面的代码执行完毕之前安装完成\n我们使用`caches.open()`方法创建了一个 yu 的新缓存，将会是我们站点资源的缓存的第一个版本。它返回了一个创建缓存的`promise`,\n当它`resolved` 的时候，我们接着会调用在创建的缓存上的一个方法`addALL()`，这个方法的参数是一个由一组相对于 origin 的 URL 组成的数组，\n这个数组就是你想缓存的资源的列表\n`caches`是一个全局的`CacheStorage`对象，允许在浏览器中管理你的缓存。调用`open`方法来检索具体我们想要使用的`Cache`对象。\n\n### 更新静态资源\n\n缓存资源随着版本的更新会过期，所以会根据缓存的字符串名称（CACHE_NAME）值清除旧缓存，可以遍历所有的缓存名称最易判断决定是否清除\n\n```javascript\nself.addEventListener('activate', function (e) {\n  e.waitUntil(\n    Promise.all(\n      caches.keys().then((cacheNames) => {\n        return cacheNames.map((name) => {\n          if (name !== CACHE_NAME) {\n            return caches.delete(name)\n          }\n        })\n      })\n    ).then(() => {\n      return self.clients.claim()\n    })\n  )\n})\n```\n\n在新安装的 Service Worker 中调用 self.clients.claim()取的页面的控制权，这样之后打开的页面都会使用版本更新的缓存。旧的 Service Worker 脚本不在控制页面之后会被停止。\n\n### 自定义请求响应\n\n```javascript\nself.addEventListener('fetch', function (e) {\n  console.log('[service worker] fetch', e.request.url)\n  /*respondWith()方法旨在包裹代码，这些代码为来自受控页面的request生成的自定义的response。用来劫持我们的http响应*/\n  e.resondWith(\n    caches.match(e.request).then(function () {\n      //如果sw有自己的返回，就直接返回，减少一次http请求。\n      if (response) {\n        return response\n      }\n\n      //如果没有返回，就直接请求真实远程服务\n      var request = e.request.clone() //拷贝原始请求\n      //clone()允许多次请求body()对象。\n      return fetch(request).then(function (httpRes) {\n        //http请求的返回已经抓到，可以进行设置\n\n        //请求失败，直接返回失败的结果\n        if (!httpRes || httpRes.status !== 200) {\n          return httpRes\n        }\n        //  请求成功，将请求缓存\n        var responseClone = httpRes.clone()\n        caches.open(cache_name).then(function (cache) {\n          cache.put(e.request, responseClone)\n        })\n        return httpRes\n      })\n    })\n  )\n})\n```\n\n每次任何被`service worker` 控制的资源被请求到时，都会触发`fetch`事件，这些资源包括了指定的`scope`内的\n`html` 文档，和这些`html`文档内引用的其他任何资源（比如`index.html`发起了一个跨域的请求来嵌入一张图片，这个也会通过`service worker`。\n我们可以在`install` 的时候进行静态资源缓存。也可以通过`fetch`事件回调来代理页面请求从而实现动态资源缓存:\n\n- `on install` 的优点是第二次访问就可以离线访问，缺点是需要缓存的 URL 在编译时插入到脚本中，增加代码量和降低可维护性。\n- `on fetch` 的优点是无需变更编译过程，也不会产生额外的流量，缺点是需要多一次访问才能离线访问。\n- `request` 属性包含在`FetchEvent`对象里，它用于查找匹配请求的缓存。\n- `cache.match`将尝试找到一个与指定请求匹配的缓存响应。如果没有找到对应的缓存，则`promise`会返回一个 undefined 值。在这里我们通过判断这个值来决定是否返回这个值，还是调用`fetch`发出一个网络请求并返回一个`promise`。\n- `e.resondWith`是一个 fetchevent 对象中的特殊方法，用于将请求的响应发送回浏览器（提供对应的请求）。打开缓存找到匹配的响应，如果它不存在，就发情网络请求。\n\n#### Fetch 事件\n\n`fetch`事件是在每次网页发出请求的时候触发的，触发该事件的时候 `service worker`能够拦截请求，弄决定是返回缓存的数据，还是返回真是请求响应的数据。与请求匹配的任何缓存数据都将优先被返回，而不需要发送网络请求。只有当没有现有的缓存数据时才会发出网络请求。\n\n#### Service Worker 生命周期 （也许翻译的不好，尽量去看原文）\n\n- **installing**: 这一阶段标志着开始注册。它想要允许设置 worker-specific 的资源,例如离线模式的 caches.\n  - 用 **event.waitUntil()** 通过一个 promise 去延长安装 service worker 阶段直到 e.waitUntil()里的代码执行完毕。如果所有资源安装成功缓存则安装成功，否则安装失败，则无法激活 service worker。\n  - 用 **self.skipWaiting()** self 是当前 context 的 global 变量。强制当前处于 waiting 状态的脚本进入 activate 状态。\n- **installed**:service worker 已经完成了它的安装，在等待其他 service Workers 线程被关闭。\n- **activating**: 这时没有被其他 workers 控制的客户端。这个阶段允许 workers 去完成安装并且清理其他 worker 以及关联缓存的就缓存资源，等待新的 service worker 线程被激活。\n- **activated**:现在可以处理方法事件。\n- **message**: service worker 运行于独立 context 中，无法直接访问当前页面主线程的 DOM 信息，但是通过 postMessageAPI ,可以实现他们之间的消息传递，这样主线程就可以接受 service worker 的指令操作 DOM。\n\n### 定期后台同步\n\nservice Worker 与其他服务工作者 在一个单独的线程上运行，所以即使关闭页面，它们也可以执行其代码，此功能对于执行后台同步和提供推送通知很重要\n\n后台同步的目的是解决这个问题，一旦链接重新建立，自动发送数据\n\n```JS\n// app.js\nnavigator.serviceWorker.ready.then((registration) => {\n  return registration.sync.register('sync-save-document');\n});\n```\n\n```JS\n//service-worker.js\nself.addEventListener('sync', (event) => {\n  if (event.tag === 'sync-save-document') {\n    event.waitUntil(saveDocument());\n  }\n});\n```\n\nsaveDocument 是一个返回 Promise，如果被拒接(例如网络问题)，同步将自动重试。\n\n要注意的一件事是，同步标记必须是唯一的。 例如，如果我要安排 5 个“message”类型的后台同步，则只有最后一个会通过。 因此，在这种情况下，每个标签都应具有唯一的标识符。\n\n#### 后台同步\n\n用户离开页面后，后台同步通常用于同步数据\n\n例如，在手机上编辑文档后，我们写完会点击保存并离开页面，如果在编辑文档期间链接断开，我们必须等待链接回复才能保存文档\n\n#### 定期后台同步\n\n定期后台同步解决与正常那个后台同步不同的问题。该 API 可用于在后台更新数据，而不必等待用户\n\n有了这项技术，用户可以在没有互联网链接的情况下阅读最新的新闻文章\n\n为了防止滥用这个功能，同步的频率取决于浏览器为每个网站设置的站点参与度分数。如果经常打开一个页面，这个频率最多可以达到 12 小时\n\n不放此目的一个要求的是，该网站以作为移动端上的一个 PWA 安装并被天假到主屏幕\n\n## manifest.json\n\npwa 添加至桌面的功能实现依赖于 manifest.json。\n\n### 基本功能\n\n- name:{string} 应用名称，用于安装横幅、启动画面显示\n- short_name:{string} 应用短名称，用于主屏幕显示\n- icon:img 应用图标列表，其中包括:\n  - src:{string} 图标 URL\n  - type:图标的 mime 类型\n  - size:图标尺寸。当 PWA 添加到主屏幕时，浏览器会根据有效图标的 size 字段进行选择，如果匹配到的图标路径错误，将会显示浏览器默认 icon。\n- start_url:{string=} 应用启动地址\n- background_color:{color} css 色值\n- display: {string} 显示类型\n  - fullScreen: 应用的显示界面将占满整个屏幕\n  - standalone: 浏览器相关 UI（导航栏、工具栏等）将会被隐藏\n  - minimal-ui: 显示形式与 standalone 类似，浏览器相关 UI 会最小化为一个按钮，不同浏览器在实现上略有不同\n  - browser: 浏览器模式，与普通网页在浏览器中打开的显示一致\n- orientation: string 应用显示方向\n- theme_color: 主题颜色\n\n### 设置作用域\n\n- 如果没有在 manifest 中设置 scope，则默认的作用域为 manifest.json 所在的文件夹；\n- **start_url 必须在作用域范围之内**;\n- 如果 start_url 为相对地址，其根路径收 scope 所影响;\n- 如果 start_url 为绝对地址（以/开头）,则该地址将永远以/作为跟地址；\n\n### 添加启动动画\n\n当 PWA 添加到主屏幕点击打开时，幕后执行了若干操作：\n\n1. 启动浏览器\n2. 启动显示页面的渲染器\n3. 加载资源\n\n在这个过程中，由于页面未加载完毕，因此屏幕将显示空白并且看似停滞。如果是从网络加载的页面资源，白屏过程将会变得更加明显。因此 PWA 提供了启动画面功能，用标题、颜色和图像组成的画面来替代白屏，提升用户体验。\n\n目前，如果修改了 manifest.json 的应用的名称，已经添加到主屏幕的名称并不会改变，只有当用户重新添加到桌面时，更改后的名称才会显示出来。但是未来版本的 chrome 支持自动更新。\n\n## 更新页面\n\n如何解决每次发布上线，用户首次拿到的都是旧的，需要再次刷新呢？\n（个人认为这是一个缺点）\n页面被缓存之后，就需要适当处理缓存失效时的页面更新。某些配置中被缓存的资源是无法发起请求判断是否被更新的，只有 sw.js 会自动根据 HTTP 缓存的机制尝试去判断应用是否被更新。所以当页面发生改变时，要同时对 sw.js 文件的缓存名进行修改。这就意味着在联网情况下，用户得到的可能不是最新的数据。\n\n然后重新打开页面，这个时候渲染的页面依旧是的，但是 sw.js 被安装和激活。之后关闭页面后再次打开才可以看到更新过后的页面。所以最好是将一些不经常更改的静态文件发到缓存中，提高用户体验。\n\n### 如何更新一个 service Worker\n\n更新你 service worker 的 JavaScript 文件\n\n1. 当用户浏览你的网站时，浏览器尝试在后台重新下载 service worker 的脚本文件。经过对比，只要服务器上的文件和本地文件有一个字节不同，这个文件就认为是新的。\n2. 之后更新后的 service worker 启动并触发 install 事件。\n3. 此时，当前页面生效的依然是老版本的 service worker，新的 service worker 会进入 “waiting” 状态。\n4. 当页面关闭之后，老的 service worker 会被干掉，新的 servicer worker 接管页面\n5. 一旦新的 service worker 生效后会触发 activate 事件。\n\n之前我们使用的缓存可以叫 my-site-cache-v1 ，我们想把这个拆封到多个缓存，一份给页面使用，一份给博客文章使用。这意味着，install 步骤里，我们要创建两个缓存： pages-cache-v1 和 blog-posts-cache-v1。在 activite 步骤里，我们需要删除旧的 my-site-cache-v1。\n\n下面的代码会遍历所有的缓存，并删除掉不在 cacheWhitelist 数组（我们定义的缓存白名单）中的缓存。\n\n```JS\nself.addEventListener('activate', function(event) {\n\n  var cacheWhitelist = ['pages-cache-v1', 'blog-posts-cache-v1'];\n\n  event.waitUntil(\n    caches.keys().then(function(cacheNames) {\n      return Promise.all(\n        cacheNames.map(function(cacheName) {\n          if (cacheWhitelist.indexOf(cacheName) === -1) {\n            return caches.delete(cacheName);\n          }\n        })\n      );\n    })\n  );\n});\n```\n\n### 设置 Cache-Control\n\n静态文件，类似于图片和视频等不会经常改变的资源，做长时间缓存是没有很大的问题，可以在 HTTP 头里设置 `Cache-Control`来缓存文件使其缓存时间为一年：`Cache-Control: max-age=31536000`\n\n页面，css 和 script 文件会经常变化，所以应该设置一个很短的缓存时间比如 24 小时，并在联网时与服务区端文件进行验证 `Cache-Control: must-revalidate, max-age=86400`\n\n### 为什么首次注册之后的首次刷新没有拦截到网络请求\n\n而在首次注册、安装、激活之后，Service Worker 已经拿到了当前页面的控制权了，但为什么首次刷新却没有拦截到网络请求呢？主要是因为在 Service Worker 的注册是一个异步的过程，在激活完成后当前页面的请求都已经发送完成，因为时机太晚，此时是拦截不到任何请求的，只能等待下次访问再进行。\n\n而第二次刷新页面，由于当前站点的 Service Worker 是处于激活状态，所以不会再次新建 worker 工作线程并执行 Service Worker。也就是说激活状态的 Service Worker 在一个站点只会存在一个 worker 工作线程，除非 Service Worker 文件发生了变化（手动 unregister Service Worker 也会注销掉 worker 工作线程），触发了浏览器更新，才会重新开启生命周期。而由于 Service Worker 工作线程的离线特性，只要处于激活状态，在后续的任何访问中，都会通过 fetch 事件监听器拦截当前页面的网络请求，并执行 fetch 事件回调。\n\n## 参考\n\n1. [Service Worker 生命周期](hhttps://developers.google.com/web/fundamentals/primers/service-workers/lifecycle?hl=zh-cn)\n1. [PWA 应用实战](https://lavas-project.github.io/pwa-book/)\n1. [发现刷新两次，数据才更新](https://blog.csdn.net/zmx_FZ/article/details/106206890)\n1. [浏览器缓存、CacheStorage、Web Worker 与 Service Worke](https://github.com/youngwind/blog/issues/113)\n1. [谨慎处理 Service Worker 的更新](https://juejin.cn/post/6844903792522035208)\n1. [ServiceWorkerRegistration.update](https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerRegistration/update)\n1. [Service Worker 更新机制](https://harttle.land/2017/04/10/service-worker-update.html)\n1. [借助 Service Worker 和 cacheStorage 缓存及离线开发](https://www.zhangxinxu.com/wordpress/2017/07/service-worker-cachestorage-offline-develop/)\n1. [Service Workers - JavaScript API 简介](https://segmentfault.com/a/1190000027080988)\n","slug":"PWA-offline","published":1,"updated":"2021-05-26T15:13:29.994Z","_id":"ckon1h1ws000ul5v0etvy6olf","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"PWA-Progressive-Web-App-特点\"><a href=\"#PWA-Progressive-Web-App-特点\" class=\"headerlink\" title=\"PWA (Progressive Web App) 特点\"></a>PWA (Progressive Web App) 特点</h2><ol>\n<li>installability( 可安装性 )，可被添加自主屏与全屏运行。</li>\n<li>app shell: 第一次渲染个壳，等异步数据来了在填充。</li>\n<li>offline( 离线能力 )：离线和弱网环境也能秒开，server worker 给了 web 一个可以跑后台的线程，它可以搭配非常靠谱的 cache Api 做缓存、可以拦截所有 Http 请求并使用 Fetch API 进行 response ，一个非常完备哦的 proxy 就这么诞生了</li>\n<li>re-engageable：推送通知的能力，依赖 service Worker 与 http push，不过默认支持的可是 GCM</li>\n<li>推送是指服务器向服务工作线程提供信息的操作</li>\n<li>通知是指服务工作线程或网页脚本向用户信息的操作。</li>\n</ol>\n<span id=\"more\"></span>\n\n<h2 id=\"service-Worker-有以下功能和特性\"><a href=\"#service-Worker-有以下功能和特性\" class=\"headerlink\" title=\"service Worker 有以下功能和特性\"></a>service Worker 有以下功能和特性</h2><p>service Worker 是 Chorme 团队提出和力推的一个 WEB Api，用于给 web 应用日工高级的可持续的后台处理能力。</p>\n<p>service Worke 最主要的特点是：在页面中注册成功后，运行与浏览器后台，不受页面刷新的影响（此功能对于执行后台同步和提供推送通知很重要），可以监听和拦截作用于范围内所有页面的 HTTP 请求</p>\n<p>类似一个服务器与浏览器之间的中间人角色，如果网站中注册了 service worker 那么它可以拦截当前网站的所有请求，进行判断（需要编写相应的判断程序），如果需要向服务器发起请求的就转给服务器，如果可以直接使用缓存的就直接返回缓存不再给服务器，从而大大挺高浏览器体验。</p>\n<ul>\n<li>一个独立的 worker 线程，独立于当前网页进程，有自己独立的 worker context。</li>\n<li>一旦被 install，就永远存在，除非被 uninstall</li>\n<li>需要的时候可以直接唤醒，不需要的时候自动睡眠（有效利用资源，此处有坑）</li>\n<li>可编程拦截代理请求和返回，缓存文件，缓存的文件可以被网页进程取到（包括网络离线状态）</li>\n<li>离线内容开发者可控</li>\n<li>能向客户端推送消息</li>\n<li>不能直接操作 DOM</li>\n<li>出于安全的考虑，必须在 HTTPS 环境下才能工作</li>\n<li>异步实现，内部大都是通过 Promise 实现</li>\n</ul>\n<h3 id=\"service-Worker-前提条件\"><a href=\"#service-Worker-前提条件\" class=\"headerlink\" title=\"service Worker 前提条件\"></a>service Worker 前提条件</h3><ul>\n<li>要求 HTTPS 的环境</li>\n<li>缓存机制是依赖 cache API 实现的 (cacheStorage)</li>\n<li>依赖 HTML5 fetchAPI</li>\n<li>依赖 Promise</li>\n</ul>\n<h3 id=\"注册\"><a href=\"#注册\" class=\"headerlink\" title=\"注册\"></a>注册</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">&#x27;serviceWorker&#x27;</span> <span class=\"keyword\">in</span> navigator) &#123;</span><br><span class=\"line\">  navigator.serviceWorker</span><br><span class=\"line\">    .register(<span class=\"string\">&#x27;./pwa/sw.js&#x27;</span>, &#123; <span class=\"attr\">scope</span>: <span class=\"string\">&#x27;/pwa&#x27;</span> &#125;)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">registration</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Service Worker 注册成功，域名: &#x27;</span>, registration.scope)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Service Worker 注册失败: &#x27;</span>, err)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>每次页面加载成功后，就会调用 register()方法。浏览器会判断 service Worker 线程是否已注册，并作出相应的处理<br>scope 方法是可选的，用于指定你想让 service worker 控制内容的子目录。service worker 线程将接受<br>scope 指定网域目录上所有事项的 fetch 事件。并将它保存在你正在访问的域名下。<br>sw.js 将包含所有自定义的 service worker 事件处理程序<br>scope 的意义在于如果 sw.js 在/a/b/sw.js 下，那么 scope 默认是/a/b,那么 service worker 线程只能<br>捕捉到 path 为/a/b 开头的（/a/b/page1,/a/b/page2,..)下的 fetch 事件</p>\n<p>现在 Service Worker 已经被注册好了，接下来是在 Service Worker 生命周期中触发实现对应的事件处理程序了。</p>\n<h3 id=\"事件处理程序\"><a href=\"#事件处理程序\" class=\"headerlink\" title=\"事件处理程序\"></a>事件处理程序</h3><p>生命周期：installing installed activating activated,这个状态变化的过程就是 service worker 生命周期的反应。</p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>install 事件我们会绑定在 service worker 文件中，在 service worker 安装成功后，install 事件被触发。<strong>install 事件一般是被用来填充你的浏览器的离线缓存能力。</strong>为了达到这个目的，我们使用了 service worker 新的标志性的存储<strong>cache API</strong> ——一个 service worker 上的全局对象，<strong>它使我们可以存储网络响应发来的资源，并且根据他们的请求来生成 key</strong>。这个 API 和浏览器的标准的缓存工作原理很相似，但是是只对应你的站点的域的。它会一直持久存在，直到你告诉它不再存储，你拥有全部的控制权。</p>\n<p>由于 service worker 是走的另外的线程，因此，window 和 DOM 都是不能访问的，因此我们要使用 self 访问全局上下文。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> CACHE_NAME = <span class=\"string\">&#x27;yu&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> urlsToCache = [<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"string\">&#x27;/js/main.js&#x27;</span>, <span class=\"string\">&#x27;/css/style.css&#x27;</span>, <span class=\"string\">&#x27;/img/bob-ross.jpg&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;install&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;[ServiceWorker] Install&#x27;</span>)</span><br><span class=\"line\">  <span class=\"comment\">/*ExtendableEvent.waitUntil():</span></span><br><span class=\"line\"><span class=\"comment\">         延长了时间的生命周期。在服务工作中，延长事件的生命周期阻止浏览器在事件中的一部操作完成之前终止service worker。</span></span><br><span class=\"line\"><span class=\"comment\">         当在与安装事件相关联的EventHandler中调用时，它会延时将已安装的工作程序视为安装，</span></span><br><span class=\"line\"><span class=\"comment\">         直到传递的promise成功解析为止。这主要用于确保service worker在其依赖的所有核心高速缓存填充之前不会被考虑安装*/</span></span><br><span class=\"line\">  e.waitUntil(</span><br><span class=\"line\">    caches.open(chache_name).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">cache</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;[ServiceWorker] Caching app shell&#x27;</span>)</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(cache)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cache.addAll(urlsToCache)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这里我们新增了<code>install</code>事件监听器，接着在事件上接了一个<code>ExtendableEvent.waitUntil()</code>方法<br>这会确保<code>service worker</code>不会在<code>waitUntil()</code>里面的代码执行完毕之前安装完成<br>我们使用<code>caches.open()</code>方法创建了一个 yu 的新缓存，将会是我们站点资源的缓存的第一个版本。它返回了一个创建缓存的<code>promise</code>,<br>当它<code>resolved</code> 的时候，我们接着会调用在创建的缓存上的一个方法<code>addALL()</code>，这个方法的参数是一个由一组相对于 origin 的 URL 组成的数组，<br>这个数组就是你想缓存的资源的列表<br><code>caches</code>是一个全局的<code>CacheStorage</code>对象，允许在浏览器中管理你的缓存。调用<code>open</code>方法来检索具体我们想要使用的<code>Cache</code>对象。</p>\n<h3 id=\"更新静态资源\"><a href=\"#更新静态资源\" class=\"headerlink\" title=\"更新静态资源\"></a>更新静态资源</h3><p>缓存资源随着版本的更新会过期，所以会根据缓存的字符串名称（CACHE_NAME）值清除旧缓存，可以遍历所有的缓存名称最易判断决定是否清除</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  e.waitUntil(</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.all(</span><br><span class=\"line\">      caches.keys().then(<span class=\"function\">(<span class=\"params\">cacheNames</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cacheNames.map(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (name !== CACHE_NAME) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> caches.delete(name)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ).then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> self.clients.claim()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>在新安装的 Service Worker 中调用 self.clients.claim()取的页面的控制权，这样之后打开的页面都会使用版本更新的缓存。旧的 Service Worker 脚本不在控制页面之后会被停止。</p>\n<h3 id=\"自定义请求响应\"><a href=\"#自定义请求响应\" class=\"headerlink\" title=\"自定义请求响应\"></a>自定义请求响应</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;fetch&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;[service worker] fetch&#x27;</span>, e.request.url)</span><br><span class=\"line\">  <span class=\"comment\">/*respondWith()方法旨在包裹代码，这些代码为来自受控页面的request生成的自定义的response。用来劫持我们的http响应*/</span></span><br><span class=\"line\">  e.resondWith(</span><br><span class=\"line\">    caches.match(e.request).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//如果sw有自己的返回，就直接返回，减少一次http请求。</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (response) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//如果没有返回，就直接请求真实远程服务</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> request = e.request.clone() <span class=\"comment\">//拷贝原始请求</span></span><br><span class=\"line\">      <span class=\"comment\">//clone()允许多次请求body()对象。</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> fetch(request).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">httpRes</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//http请求的返回已经抓到，可以进行设置</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//请求失败，直接返回失败的结果</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!httpRes || httpRes.status !== <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> httpRes</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  请求成功，将请求缓存</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> responseClone = httpRes.clone()</span><br><span class=\"line\">        caches.open(cache_name).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">cache</span>) </span>&#123;</span><br><span class=\"line\">          cache.put(e.request, responseClone)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> httpRes</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>每次任何被<code>service worker</code> 控制的资源被请求到时，都会触发<code>fetch</code>事件，这些资源包括了指定的<code>scope</code>内的<br><code>html</code> 文档，和这些<code>html</code>文档内引用的其他任何资源（比如<code>index.html</code>发起了一个跨域的请求来嵌入一张图片，这个也会通过<code>service worker</code>。<br>我们可以在<code>install</code> 的时候进行静态资源缓存。也可以通过<code>fetch</code>事件回调来代理页面请求从而实现动态资源缓存:</p>\n<ul>\n<li><code>on install</code> 的优点是第二次访问就可以离线访问，缺点是需要缓存的 URL 在编译时插入到脚本中，增加代码量和降低可维护性。</li>\n<li><code>on fetch</code> 的优点是无需变更编译过程，也不会产生额外的流量，缺点是需要多一次访问才能离线访问。</li>\n<li><code>request</code> 属性包含在<code>FetchEvent</code>对象里，它用于查找匹配请求的缓存。</li>\n<li><code>cache.match</code>将尝试找到一个与指定请求匹配的缓存响应。如果没有找到对应的缓存，则<code>promise</code>会返回一个 undefined 值。在这里我们通过判断这个值来决定是否返回这个值，还是调用<code>fetch</code>发出一个网络请求并返回一个<code>promise</code>。</li>\n<li><code>e.resondWith</code>是一个 fetchevent 对象中的特殊方法，用于将请求的响应发送回浏览器（提供对应的请求）。打开缓存找到匹配的响应，如果它不存在，就发情网络请求。</li>\n</ul>\n<h4 id=\"Fetch-事件\"><a href=\"#Fetch-事件\" class=\"headerlink\" title=\"Fetch 事件\"></a>Fetch 事件</h4><p><code>fetch</code>事件是在每次网页发出请求的时候触发的，触发该事件的时候 <code>service worker</code>能够拦截请求，弄决定是返回缓存的数据，还是返回真是请求响应的数据。与请求匹配的任何缓存数据都将优先被返回，而不需要发送网络请求。只有当没有现有的缓存数据时才会发出网络请求。</p>\n<h4 id=\"Service-Worker-生命周期-（也许翻译的不好，尽量去看原文）\"><a href=\"#Service-Worker-生命周期-（也许翻译的不好，尽量去看原文）\" class=\"headerlink\" title=\"Service Worker 生命周期 （也许翻译的不好，尽量去看原文）\"></a>Service Worker 生命周期 （也许翻译的不好，尽量去看原文）</h4><ul>\n<li><strong>installing</strong>: 这一阶段标志着开始注册。它想要允许设置 worker-specific 的资源,例如离线模式的 caches.<ul>\n<li>用 <strong>event.waitUntil()</strong> 通过一个 promise 去延长安装 service worker 阶段直到 e.waitUntil()里的代码执行完毕。如果所有资源安装成功缓存则安装成功，否则安装失败，则无法激活 service worker。</li>\n<li>用 <strong>self.skipWaiting()</strong> self 是当前 context 的 global 变量。强制当前处于 waiting 状态的脚本进入 activate 状态。</li>\n</ul>\n</li>\n<li><strong>installed</strong>:service worker 已经完成了它的安装，在等待其他 service Workers 线程被关闭。</li>\n<li><strong>activating</strong>: 这时没有被其他 workers 控制的客户端。这个阶段允许 workers 去完成安装并且清理其他 worker 以及关联缓存的就缓存资源，等待新的 service worker 线程被激活。</li>\n<li><strong>activated</strong>:现在可以处理方法事件。</li>\n<li><strong>message</strong>: service worker 运行于独立 context 中，无法直接访问当前页面主线程的 DOM 信息，但是通过 postMessageAPI ,可以实现他们之间的消息传递，这样主线程就可以接受 service worker 的指令操作 DOM。</li>\n</ul>\n<h3 id=\"定期后台同步\"><a href=\"#定期后台同步\" class=\"headerlink\" title=\"定期后台同步\"></a>定期后台同步</h3><p>service Worker 与其他服务工作者 在一个单独的线程上运行，所以即使关闭页面，它们也可以执行其代码，此功能对于执行后台同步和提供推送通知很重要</p>\n<p>后台同步的目的是解决这个问题，一旦链接重新建立，自动发送数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// app.js</span></span><br><span class=\"line\">navigator.serviceWorker.ready.then(<span class=\"function\">(<span class=\"params\">registration</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> registration.sync.register(<span class=\"string\">&#x27;sync-save-document&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//service-worker.js</span></span><br><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;sync&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (event.tag === <span class=\"string\">&#x27;sync-save-document&#x27;</span>) &#123;</span><br><span class=\"line\">    event.waitUntil(saveDocument());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>saveDocument 是一个返回 Promise，如果被拒接(例如网络问题)，同步将自动重试。</p>\n<p>要注意的一件事是，同步标记必须是唯一的。 例如，如果我要安排 5 个“message”类型的后台同步，则只有最后一个会通过。 因此，在这种情况下，每个标签都应具有唯一的标识符。</p>\n<h4 id=\"后台同步\"><a href=\"#后台同步\" class=\"headerlink\" title=\"后台同步\"></a>后台同步</h4><p>用户离开页面后，后台同步通常用于同步数据</p>\n<p>例如，在手机上编辑文档后，我们写完会点击保存并离开页面，如果在编辑文档期间链接断开，我们必须等待链接回复才能保存文档</p>\n<h4 id=\"定期后台同步-1\"><a href=\"#定期后台同步-1\" class=\"headerlink\" title=\"定期后台同步\"></a>定期后台同步</h4><p>定期后台同步解决与正常那个后台同步不同的问题。该 API 可用于在后台更新数据，而不必等待用户</p>\n<p>有了这项技术，用户可以在没有互联网链接的情况下阅读最新的新闻文章</p>\n<p>为了防止滥用这个功能，同步的频率取决于浏览器为每个网站设置的站点参与度分数。如果经常打开一个页面，这个频率最多可以达到 12 小时</p>\n<p>不放此目的一个要求的是，该网站以作为移动端上的一个 PWA 安装并被天假到主屏幕</p>\n<h2 id=\"manifest-json\"><a href=\"#manifest-json\" class=\"headerlink\" title=\"manifest.json\"></a>manifest.json</h2><p>pwa 添加至桌面的功能实现依赖于 manifest.json。</p>\n<h3 id=\"基本功能\"><a href=\"#基本功能\" class=\"headerlink\" title=\"基本功能\"></a>基本功能</h3><ul>\n<li>name:{string} 应用名称，用于安装横幅、启动画面显示</li>\n<li>short_name:{string} 应用短名称，用于主屏幕显示</li>\n<li>icon:img 应用图标列表，其中包括:<ul>\n<li>src:{string} 图标 URL</li>\n<li>type:图标的 mime 类型</li>\n<li>size:图标尺寸。当 PWA 添加到主屏幕时，浏览器会根据有效图标的 size 字段进行选择，如果匹配到的图标路径错误，将会显示浏览器默认 icon。</li>\n</ul>\n</li>\n<li>start_url:{string=} 应用启动地址</li>\n<li>background_color:{color} css 色值</li>\n<li>display: {string} 显示类型<ul>\n<li>fullScreen: 应用的显示界面将占满整个屏幕</li>\n<li>standalone: 浏览器相关 UI（导航栏、工具栏等）将会被隐藏</li>\n<li>minimal-ui: 显示形式与 standalone 类似，浏览器相关 UI 会最小化为一个按钮，不同浏览器在实现上略有不同</li>\n<li>browser: 浏览器模式，与普通网页在浏览器中打开的显示一致</li>\n</ul>\n</li>\n<li>orientation: string 应用显示方向</li>\n<li>theme_color: 主题颜色</li>\n</ul>\n<h3 id=\"设置作用域\"><a href=\"#设置作用域\" class=\"headerlink\" title=\"设置作用域\"></a>设置作用域</h3><ul>\n<li>如果没有在 manifest 中设置 scope，则默认的作用域为 manifest.json 所在的文件夹；</li>\n<li><strong>start_url 必须在作用域范围之内</strong>;</li>\n<li>如果 start_url 为相对地址，其根路径收 scope 所影响;</li>\n<li>如果 start_url 为绝对地址（以/开头）,则该地址将永远以/作为跟地址；</li>\n</ul>\n<h3 id=\"添加启动动画\"><a href=\"#添加启动动画\" class=\"headerlink\" title=\"添加启动动画\"></a>添加启动动画</h3><p>当 PWA 添加到主屏幕点击打开时，幕后执行了若干操作：</p>\n<ol>\n<li>启动浏览器</li>\n<li>启动显示页面的渲染器</li>\n<li>加载资源</li>\n</ol>\n<p>在这个过程中，由于页面未加载完毕，因此屏幕将显示空白并且看似停滞。如果是从网络加载的页面资源，白屏过程将会变得更加明显。因此 PWA 提供了启动画面功能，用标题、颜色和图像组成的画面来替代白屏，提升用户体验。</p>\n<p>目前，如果修改了 manifest.json 的应用的名称，已经添加到主屏幕的名称并不会改变，只有当用户重新添加到桌面时，更改后的名称才会显示出来。但是未来版本的 chrome 支持自动更新。</p>\n<h2 id=\"更新页面\"><a href=\"#更新页面\" class=\"headerlink\" title=\"更新页面\"></a>更新页面</h2><p>如何解决每次发布上线，用户首次拿到的都是旧的，需要再次刷新呢？<br>（个人认为这是一个缺点）<br>页面被缓存之后，就需要适当处理缓存失效时的页面更新。某些配置中被缓存的资源是无法发起请求判断是否被更新的，只有 sw.js 会自动根据 HTTP 缓存的机制尝试去判断应用是否被更新。所以当页面发生改变时，要同时对 sw.js 文件的缓存名进行修改。这就意味着在联网情况下，用户得到的可能不是最新的数据。</p>\n<p>然后重新打开页面，这个时候渲染的页面依旧是的，但是 sw.js 被安装和激活。之后关闭页面后再次打开才可以看到更新过后的页面。所以最好是将一些不经常更改的静态文件发到缓存中，提高用户体验。</p>\n<h3 id=\"如何更新一个-service-Worker\"><a href=\"#如何更新一个-service-Worker\" class=\"headerlink\" title=\"如何更新一个 service Worker\"></a>如何更新一个 service Worker</h3><p>更新你 service worker 的 JavaScript 文件</p>\n<ol>\n<li>当用户浏览你的网站时，浏览器尝试在后台重新下载 service worker 的脚本文件。经过对比，只要服务器上的文件和本地文件有一个字节不同，这个文件就认为是新的。</li>\n<li>之后更新后的 service worker 启动并触发 install 事件。</li>\n<li>此时，当前页面生效的依然是老版本的 service worker，新的 service worker 会进入 “waiting” 状态。</li>\n<li>当页面关闭之后，老的 service worker 会被干掉，新的 servicer worker 接管页面</li>\n<li>一旦新的 service worker 生效后会触发 activate 事件。</li>\n</ol>\n<p>之前我们使用的缓存可以叫 my-site-cache-v1 ，我们想把这个拆封到多个缓存，一份给页面使用，一份给博客文章使用。这意味着，install 步骤里，我们要创建两个缓存： pages-cache-v1 和 blog-posts-cache-v1。在 activite 步骤里，我们需要删除旧的 my-site-cache-v1。</p>\n<p>下面的代码会遍历所有的缓存，并删除掉不在 cacheWhitelist 数组（我们定义的缓存白名单）中的缓存。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> cacheWhitelist = [<span class=\"string\">&#x27;pages-cache-v1&#x27;</span>, <span class=\"string\">&#x27;blog-posts-cache-v1&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">  event.waitUntil(</span><br><span class=\"line\">    caches.keys().then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cacheNames</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all(</span><br><span class=\"line\">        cacheNames.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cacheName</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (cacheWhitelist.indexOf(cacheName) === -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> caches.delete(cacheName);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"设置-Cache-Control\"><a href=\"#设置-Cache-Control\" class=\"headerlink\" title=\"设置 Cache-Control\"></a>设置 Cache-Control</h3><p>静态文件，类似于图片和视频等不会经常改变的资源，做长时间缓存是没有很大的问题，可以在 HTTP 头里设置 <code>Cache-Control</code>来缓存文件使其缓存时间为一年：<code>Cache-Control: max-age=31536000</code></p>\n<p>页面，css 和 script 文件会经常变化，所以应该设置一个很短的缓存时间比如 24 小时，并在联网时与服务区端文件进行验证 <code>Cache-Control: must-revalidate, max-age=86400</code></p>\n<h3 id=\"为什么首次注册之后的首次刷新没有拦截到网络请求\"><a href=\"#为什么首次注册之后的首次刷新没有拦截到网络请求\" class=\"headerlink\" title=\"为什么首次注册之后的首次刷新没有拦截到网络请求\"></a>为什么首次注册之后的首次刷新没有拦截到网络请求</h3><p>而在首次注册、安装、激活之后，Service Worker 已经拿到了当前页面的控制权了，但为什么首次刷新却没有拦截到网络请求呢？主要是因为在 Service Worker 的注册是一个异步的过程，在激活完成后当前页面的请求都已经发送完成，因为时机太晚，此时是拦截不到任何请求的，只能等待下次访问再进行。</p>\n<p>而第二次刷新页面，由于当前站点的 Service Worker 是处于激活状态，所以不会再次新建 worker 工作线程并执行 Service Worker。也就是说激活状态的 Service Worker 在一个站点只会存在一个 worker 工作线程，除非 Service Worker 文件发生了变化（手动 unregister Service Worker 也会注销掉 worker 工作线程），触发了浏览器更新，才会重新开启生命周期。而由于 Service Worker 工作线程的离线特性，只要处于激活状态，在后续的任何访问中，都会通过 fetch 事件监听器拦截当前页面的网络请求，并执行 fetch 事件回调。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ol>\n<li><a href=\"hhttps://developers.google.com/web/fundamentals/primers/service-workers/lifecycle?hl=zh-cn\">Service Worker 生命周期</a></li>\n<li><a href=\"https://lavas-project.github.io/pwa-book/\">PWA 应用实战</a></li>\n<li><a href=\"https://blog.csdn.net/zmx_FZ/article/details/106206890\">发现刷新两次，数据才更新</a></li>\n<li><a href=\"https://github.com/youngwind/blog/issues/113\">浏览器缓存、CacheStorage、Web Worker 与 Service Worke</a></li>\n<li><a href=\"https://juejin.cn/post/6844903792522035208\">谨慎处理 Service Worker 的更新</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerRegistration/update\">ServiceWorkerRegistration.update</a></li>\n<li><a href=\"https://harttle.land/2017/04/10/service-worker-update.html\">Service Worker 更新机制</a></li>\n<li><a href=\"https://www.zhangxinxu.com/wordpress/2017/07/service-worker-cachestorage-offline-develop/\">借助 Service Worker 和 cacheStorage 缓存及离线开发</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000027080988\">Service Workers - JavaScript API 简介</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<h2 id=\"PWA-Progressive-Web-App-特点\"><a href=\"#PWA-Progressive-Web-App-特点\" class=\"headerlink\" title=\"PWA (Progressive Web App) 特点\"></a>PWA (Progressive Web App) 特点</h2><ol>\n<li>installability( 可安装性 )，可被添加自主屏与全屏运行。</li>\n<li>app shell: 第一次渲染个壳，等异步数据来了在填充。</li>\n<li>offline( 离线能力 )：离线和弱网环境也能秒开，server worker 给了 web 一个可以跑后台的线程，它可以搭配非常靠谱的 cache Api 做缓存、可以拦截所有 Http 请求并使用 Fetch API 进行 response ，一个非常完备哦的 proxy 就这么诞生了</li>\n<li>re-engageable：推送通知的能力，依赖 service Worker 与 http push，不过默认支持的可是 GCM</li>\n<li>推送是指服务器向服务工作线程提供信息的操作</li>\n<li>通知是指服务工作线程或网页脚本向用户信息的操作。</li>\n</ol>","more":"<h2 id=\"service-Worker-有以下功能和特性\"><a href=\"#service-Worker-有以下功能和特性\" class=\"headerlink\" title=\"service Worker 有以下功能和特性\"></a>service Worker 有以下功能和特性</h2><p>service Worker 是 Chorme 团队提出和力推的一个 WEB Api，用于给 web 应用日工高级的可持续的后台处理能力。</p>\n<p>service Worke 最主要的特点是：在页面中注册成功后，运行与浏览器后台，不受页面刷新的影响（此功能对于执行后台同步和提供推送通知很重要），可以监听和拦截作用于范围内所有页面的 HTTP 请求</p>\n<p>类似一个服务器与浏览器之间的中间人角色，如果网站中注册了 service worker 那么它可以拦截当前网站的所有请求，进行判断（需要编写相应的判断程序），如果需要向服务器发起请求的就转给服务器，如果可以直接使用缓存的就直接返回缓存不再给服务器，从而大大挺高浏览器体验。</p>\n<ul>\n<li>一个独立的 worker 线程，独立于当前网页进程，有自己独立的 worker context。</li>\n<li>一旦被 install，就永远存在，除非被 uninstall</li>\n<li>需要的时候可以直接唤醒，不需要的时候自动睡眠（有效利用资源，此处有坑）</li>\n<li>可编程拦截代理请求和返回，缓存文件，缓存的文件可以被网页进程取到（包括网络离线状态）</li>\n<li>离线内容开发者可控</li>\n<li>能向客户端推送消息</li>\n<li>不能直接操作 DOM</li>\n<li>出于安全的考虑，必须在 HTTPS 环境下才能工作</li>\n<li>异步实现，内部大都是通过 Promise 实现</li>\n</ul>\n<h3 id=\"service-Worker-前提条件\"><a href=\"#service-Worker-前提条件\" class=\"headerlink\" title=\"service Worker 前提条件\"></a>service Worker 前提条件</h3><ul>\n<li>要求 HTTPS 的环境</li>\n<li>缓存机制是依赖 cache API 实现的 (cacheStorage)</li>\n<li>依赖 HTML5 fetchAPI</li>\n<li>依赖 Promise</li>\n</ul>\n<h3 id=\"注册\"><a href=\"#注册\" class=\"headerlink\" title=\"注册\"></a>注册</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">&#x27;serviceWorker&#x27;</span> <span class=\"keyword\">in</span> navigator) &#123;</span><br><span class=\"line\">  navigator.serviceWorker</span><br><span class=\"line\">    .register(<span class=\"string\">&#x27;./pwa/sw.js&#x27;</span>, &#123; <span class=\"attr\">scope</span>: <span class=\"string\">&#x27;/pwa&#x27;</span> &#125;)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">registration</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Service Worker 注册成功，域名: &#x27;</span>, registration.scope)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Service Worker 注册失败: &#x27;</span>, err)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>每次页面加载成功后，就会调用 register()方法。浏览器会判断 service Worker 线程是否已注册，并作出相应的处理<br>scope 方法是可选的，用于指定你想让 service worker 控制内容的子目录。service worker 线程将接受<br>scope 指定网域目录上所有事项的 fetch 事件。并将它保存在你正在访问的域名下。<br>sw.js 将包含所有自定义的 service worker 事件处理程序<br>scope 的意义在于如果 sw.js 在/a/b/sw.js 下，那么 scope 默认是/a/b,那么 service worker 线程只能<br>捕捉到 path 为/a/b 开头的（/a/b/page1,/a/b/page2,..)下的 fetch 事件</p>\n<p>现在 Service Worker 已经被注册好了，接下来是在 Service Worker 生命周期中触发实现对应的事件处理程序了。</p>\n<h3 id=\"事件处理程序\"><a href=\"#事件处理程序\" class=\"headerlink\" title=\"事件处理程序\"></a>事件处理程序</h3><p>生命周期：installing installed activating activated,这个状态变化的过程就是 service worker 生命周期的反应。</p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>install 事件我们会绑定在 service worker 文件中，在 service worker 安装成功后，install 事件被触发。<strong>install 事件一般是被用来填充你的浏览器的离线缓存能力。</strong>为了达到这个目的，我们使用了 service worker 新的标志性的存储<strong>cache API</strong> ——一个 service worker 上的全局对象，<strong>它使我们可以存储网络响应发来的资源，并且根据他们的请求来生成 key</strong>。这个 API 和浏览器的标准的缓存工作原理很相似，但是是只对应你的站点的域的。它会一直持久存在，直到你告诉它不再存储，你拥有全部的控制权。</p>\n<p>由于 service worker 是走的另外的线程，因此，window 和 DOM 都是不能访问的，因此我们要使用 self 访问全局上下文。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> CACHE_NAME = <span class=\"string\">&#x27;yu&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> urlsToCache = [<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"string\">&#x27;/js/main.js&#x27;</span>, <span class=\"string\">&#x27;/css/style.css&#x27;</span>, <span class=\"string\">&#x27;/img/bob-ross.jpg&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;install&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;[ServiceWorker] Install&#x27;</span>)</span><br><span class=\"line\">  <span class=\"comment\">/*ExtendableEvent.waitUntil():</span></span><br><span class=\"line\"><span class=\"comment\">         延长了时间的生命周期。在服务工作中，延长事件的生命周期阻止浏览器在事件中的一部操作完成之前终止service worker。</span></span><br><span class=\"line\"><span class=\"comment\">         当在与安装事件相关联的EventHandler中调用时，它会延时将已安装的工作程序视为安装，</span></span><br><span class=\"line\"><span class=\"comment\">         直到传递的promise成功解析为止。这主要用于确保service worker在其依赖的所有核心高速缓存填充之前不会被考虑安装*/</span></span><br><span class=\"line\">  e.waitUntil(</span><br><span class=\"line\">    caches.open(chache_name).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">cache</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;[ServiceWorker] Caching app shell&#x27;</span>)</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(cache)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cache.addAll(urlsToCache)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这里我们新增了<code>install</code>事件监听器，接着在事件上接了一个<code>ExtendableEvent.waitUntil()</code>方法<br>这会确保<code>service worker</code>不会在<code>waitUntil()</code>里面的代码执行完毕之前安装完成<br>我们使用<code>caches.open()</code>方法创建了一个 yu 的新缓存，将会是我们站点资源的缓存的第一个版本。它返回了一个创建缓存的<code>promise</code>,<br>当它<code>resolved</code> 的时候，我们接着会调用在创建的缓存上的一个方法<code>addALL()</code>，这个方法的参数是一个由一组相对于 origin 的 URL 组成的数组，<br>这个数组就是你想缓存的资源的列表<br><code>caches</code>是一个全局的<code>CacheStorage</code>对象，允许在浏览器中管理你的缓存。调用<code>open</code>方法来检索具体我们想要使用的<code>Cache</code>对象。</p>\n<h3 id=\"更新静态资源\"><a href=\"#更新静态资源\" class=\"headerlink\" title=\"更新静态资源\"></a>更新静态资源</h3><p>缓存资源随着版本的更新会过期，所以会根据缓存的字符串名称（CACHE_NAME）值清除旧缓存，可以遍历所有的缓存名称最易判断决定是否清除</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  e.waitUntil(</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.all(</span><br><span class=\"line\">      caches.keys().then(<span class=\"function\">(<span class=\"params\">cacheNames</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cacheNames.map(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (name !== CACHE_NAME) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> caches.delete(name)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ).then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> self.clients.claim()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>在新安装的 Service Worker 中调用 self.clients.claim()取的页面的控制权，这样之后打开的页面都会使用版本更新的缓存。旧的 Service Worker 脚本不在控制页面之后会被停止。</p>\n<h3 id=\"自定义请求响应\"><a href=\"#自定义请求响应\" class=\"headerlink\" title=\"自定义请求响应\"></a>自定义请求响应</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;fetch&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;[service worker] fetch&#x27;</span>, e.request.url)</span><br><span class=\"line\">  <span class=\"comment\">/*respondWith()方法旨在包裹代码，这些代码为来自受控页面的request生成的自定义的response。用来劫持我们的http响应*/</span></span><br><span class=\"line\">  e.resondWith(</span><br><span class=\"line\">    caches.match(e.request).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//如果sw有自己的返回，就直接返回，减少一次http请求。</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (response) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//如果没有返回，就直接请求真实远程服务</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> request = e.request.clone() <span class=\"comment\">//拷贝原始请求</span></span><br><span class=\"line\">      <span class=\"comment\">//clone()允许多次请求body()对象。</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> fetch(request).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">httpRes</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//http请求的返回已经抓到，可以进行设置</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//请求失败，直接返回失败的结果</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!httpRes || httpRes.status !== <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> httpRes</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  请求成功，将请求缓存</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> responseClone = httpRes.clone()</span><br><span class=\"line\">        caches.open(cache_name).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">cache</span>) </span>&#123;</span><br><span class=\"line\">          cache.put(e.request, responseClone)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> httpRes</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>每次任何被<code>service worker</code> 控制的资源被请求到时，都会触发<code>fetch</code>事件，这些资源包括了指定的<code>scope</code>内的<br><code>html</code> 文档，和这些<code>html</code>文档内引用的其他任何资源（比如<code>index.html</code>发起了一个跨域的请求来嵌入一张图片，这个也会通过<code>service worker</code>。<br>我们可以在<code>install</code> 的时候进行静态资源缓存。也可以通过<code>fetch</code>事件回调来代理页面请求从而实现动态资源缓存:</p>\n<ul>\n<li><code>on install</code> 的优点是第二次访问就可以离线访问，缺点是需要缓存的 URL 在编译时插入到脚本中，增加代码量和降低可维护性。</li>\n<li><code>on fetch</code> 的优点是无需变更编译过程，也不会产生额外的流量，缺点是需要多一次访问才能离线访问。</li>\n<li><code>request</code> 属性包含在<code>FetchEvent</code>对象里，它用于查找匹配请求的缓存。</li>\n<li><code>cache.match</code>将尝试找到一个与指定请求匹配的缓存响应。如果没有找到对应的缓存，则<code>promise</code>会返回一个 undefined 值。在这里我们通过判断这个值来决定是否返回这个值，还是调用<code>fetch</code>发出一个网络请求并返回一个<code>promise</code>。</li>\n<li><code>e.resondWith</code>是一个 fetchevent 对象中的特殊方法，用于将请求的响应发送回浏览器（提供对应的请求）。打开缓存找到匹配的响应，如果它不存在，就发情网络请求。</li>\n</ul>\n<h4 id=\"Fetch-事件\"><a href=\"#Fetch-事件\" class=\"headerlink\" title=\"Fetch 事件\"></a>Fetch 事件</h4><p><code>fetch</code>事件是在每次网页发出请求的时候触发的，触发该事件的时候 <code>service worker</code>能够拦截请求，弄决定是返回缓存的数据，还是返回真是请求响应的数据。与请求匹配的任何缓存数据都将优先被返回，而不需要发送网络请求。只有当没有现有的缓存数据时才会发出网络请求。</p>\n<h4 id=\"Service-Worker-生命周期-（也许翻译的不好，尽量去看原文）\"><a href=\"#Service-Worker-生命周期-（也许翻译的不好，尽量去看原文）\" class=\"headerlink\" title=\"Service Worker 生命周期 （也许翻译的不好，尽量去看原文）\"></a>Service Worker 生命周期 （也许翻译的不好，尽量去看原文）</h4><ul>\n<li><strong>installing</strong>: 这一阶段标志着开始注册。它想要允许设置 worker-specific 的资源,例如离线模式的 caches.<ul>\n<li>用 <strong>event.waitUntil()</strong> 通过一个 promise 去延长安装 service worker 阶段直到 e.waitUntil()里的代码执行完毕。如果所有资源安装成功缓存则安装成功，否则安装失败，则无法激活 service worker。</li>\n<li>用 <strong>self.skipWaiting()</strong> self 是当前 context 的 global 变量。强制当前处于 waiting 状态的脚本进入 activate 状态。</li>\n</ul>\n</li>\n<li><strong>installed</strong>:service worker 已经完成了它的安装，在等待其他 service Workers 线程被关闭。</li>\n<li><strong>activating</strong>: 这时没有被其他 workers 控制的客户端。这个阶段允许 workers 去完成安装并且清理其他 worker 以及关联缓存的就缓存资源，等待新的 service worker 线程被激活。</li>\n<li><strong>activated</strong>:现在可以处理方法事件。</li>\n<li><strong>message</strong>: service worker 运行于独立 context 中，无法直接访问当前页面主线程的 DOM 信息，但是通过 postMessageAPI ,可以实现他们之间的消息传递，这样主线程就可以接受 service worker 的指令操作 DOM。</li>\n</ul>\n<h3 id=\"定期后台同步\"><a href=\"#定期后台同步\" class=\"headerlink\" title=\"定期后台同步\"></a>定期后台同步</h3><p>service Worker 与其他服务工作者 在一个单独的线程上运行，所以即使关闭页面，它们也可以执行其代码，此功能对于执行后台同步和提供推送通知很重要</p>\n<p>后台同步的目的是解决这个问题，一旦链接重新建立，自动发送数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// app.js</span></span><br><span class=\"line\">navigator.serviceWorker.ready.then(<span class=\"function\">(<span class=\"params\">registration</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> registration.sync.register(<span class=\"string\">&#x27;sync-save-document&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//service-worker.js</span></span><br><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;sync&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (event.tag === <span class=\"string\">&#x27;sync-save-document&#x27;</span>) &#123;</span><br><span class=\"line\">    event.waitUntil(saveDocument());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>saveDocument 是一个返回 Promise，如果被拒接(例如网络问题)，同步将自动重试。</p>\n<p>要注意的一件事是，同步标记必须是唯一的。 例如，如果我要安排 5 个“message”类型的后台同步，则只有最后一个会通过。 因此，在这种情况下，每个标签都应具有唯一的标识符。</p>\n<h4 id=\"后台同步\"><a href=\"#后台同步\" class=\"headerlink\" title=\"后台同步\"></a>后台同步</h4><p>用户离开页面后，后台同步通常用于同步数据</p>\n<p>例如，在手机上编辑文档后，我们写完会点击保存并离开页面，如果在编辑文档期间链接断开，我们必须等待链接回复才能保存文档</p>\n<h4 id=\"定期后台同步-1\"><a href=\"#定期后台同步-1\" class=\"headerlink\" title=\"定期后台同步\"></a>定期后台同步</h4><p>定期后台同步解决与正常那个后台同步不同的问题。该 API 可用于在后台更新数据，而不必等待用户</p>\n<p>有了这项技术，用户可以在没有互联网链接的情况下阅读最新的新闻文章</p>\n<p>为了防止滥用这个功能，同步的频率取决于浏览器为每个网站设置的站点参与度分数。如果经常打开一个页面，这个频率最多可以达到 12 小时</p>\n<p>不放此目的一个要求的是，该网站以作为移动端上的一个 PWA 安装并被天假到主屏幕</p>\n<h2 id=\"manifest-json\"><a href=\"#manifest-json\" class=\"headerlink\" title=\"manifest.json\"></a>manifest.json</h2><p>pwa 添加至桌面的功能实现依赖于 manifest.json。</p>\n<h3 id=\"基本功能\"><a href=\"#基本功能\" class=\"headerlink\" title=\"基本功能\"></a>基本功能</h3><ul>\n<li>name:{string} 应用名称，用于安装横幅、启动画面显示</li>\n<li>short_name:{string} 应用短名称，用于主屏幕显示</li>\n<li>icon:img 应用图标列表，其中包括:<ul>\n<li>src:{string} 图标 URL</li>\n<li>type:图标的 mime 类型</li>\n<li>size:图标尺寸。当 PWA 添加到主屏幕时，浏览器会根据有效图标的 size 字段进行选择，如果匹配到的图标路径错误，将会显示浏览器默认 icon。</li>\n</ul>\n</li>\n<li>start_url:{string=} 应用启动地址</li>\n<li>background_color:{color} css 色值</li>\n<li>display: {string} 显示类型<ul>\n<li>fullScreen: 应用的显示界面将占满整个屏幕</li>\n<li>standalone: 浏览器相关 UI（导航栏、工具栏等）将会被隐藏</li>\n<li>minimal-ui: 显示形式与 standalone 类似，浏览器相关 UI 会最小化为一个按钮，不同浏览器在实现上略有不同</li>\n<li>browser: 浏览器模式，与普通网页在浏览器中打开的显示一致</li>\n</ul>\n</li>\n<li>orientation: string 应用显示方向</li>\n<li>theme_color: 主题颜色</li>\n</ul>\n<h3 id=\"设置作用域\"><a href=\"#设置作用域\" class=\"headerlink\" title=\"设置作用域\"></a>设置作用域</h3><ul>\n<li>如果没有在 manifest 中设置 scope，则默认的作用域为 manifest.json 所在的文件夹；</li>\n<li><strong>start_url 必须在作用域范围之内</strong>;</li>\n<li>如果 start_url 为相对地址，其根路径收 scope 所影响;</li>\n<li>如果 start_url 为绝对地址（以/开头）,则该地址将永远以/作为跟地址；</li>\n</ul>\n<h3 id=\"添加启动动画\"><a href=\"#添加启动动画\" class=\"headerlink\" title=\"添加启动动画\"></a>添加启动动画</h3><p>当 PWA 添加到主屏幕点击打开时，幕后执行了若干操作：</p>\n<ol>\n<li>启动浏览器</li>\n<li>启动显示页面的渲染器</li>\n<li>加载资源</li>\n</ol>\n<p>在这个过程中，由于页面未加载完毕，因此屏幕将显示空白并且看似停滞。如果是从网络加载的页面资源，白屏过程将会变得更加明显。因此 PWA 提供了启动画面功能，用标题、颜色和图像组成的画面来替代白屏，提升用户体验。</p>\n<p>目前，如果修改了 manifest.json 的应用的名称，已经添加到主屏幕的名称并不会改变，只有当用户重新添加到桌面时，更改后的名称才会显示出来。但是未来版本的 chrome 支持自动更新。</p>\n<h2 id=\"更新页面\"><a href=\"#更新页面\" class=\"headerlink\" title=\"更新页面\"></a>更新页面</h2><p>如何解决每次发布上线，用户首次拿到的都是旧的，需要再次刷新呢？<br>（个人认为这是一个缺点）<br>页面被缓存之后，就需要适当处理缓存失效时的页面更新。某些配置中被缓存的资源是无法发起请求判断是否被更新的，只有 sw.js 会自动根据 HTTP 缓存的机制尝试去判断应用是否被更新。所以当页面发生改变时，要同时对 sw.js 文件的缓存名进行修改。这就意味着在联网情况下，用户得到的可能不是最新的数据。</p>\n<p>然后重新打开页面，这个时候渲染的页面依旧是的，但是 sw.js 被安装和激活。之后关闭页面后再次打开才可以看到更新过后的页面。所以最好是将一些不经常更改的静态文件发到缓存中，提高用户体验。</p>\n<h3 id=\"如何更新一个-service-Worker\"><a href=\"#如何更新一个-service-Worker\" class=\"headerlink\" title=\"如何更新一个 service Worker\"></a>如何更新一个 service Worker</h3><p>更新你 service worker 的 JavaScript 文件</p>\n<ol>\n<li>当用户浏览你的网站时，浏览器尝试在后台重新下载 service worker 的脚本文件。经过对比，只要服务器上的文件和本地文件有一个字节不同，这个文件就认为是新的。</li>\n<li>之后更新后的 service worker 启动并触发 install 事件。</li>\n<li>此时，当前页面生效的依然是老版本的 service worker，新的 service worker 会进入 “waiting” 状态。</li>\n<li>当页面关闭之后，老的 service worker 会被干掉，新的 servicer worker 接管页面</li>\n<li>一旦新的 service worker 生效后会触发 activate 事件。</li>\n</ol>\n<p>之前我们使用的缓存可以叫 my-site-cache-v1 ，我们想把这个拆封到多个缓存，一份给页面使用，一份给博客文章使用。这意味着，install 步骤里，我们要创建两个缓存： pages-cache-v1 和 blog-posts-cache-v1。在 activite 步骤里，我们需要删除旧的 my-site-cache-v1。</p>\n<p>下面的代码会遍历所有的缓存，并删除掉不在 cacheWhitelist 数组（我们定义的缓存白名单）中的缓存。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">self.addEventListener(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> cacheWhitelist = [<span class=\"string\">&#x27;pages-cache-v1&#x27;</span>, <span class=\"string\">&#x27;blog-posts-cache-v1&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">  event.waitUntil(</span><br><span class=\"line\">    caches.keys().then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cacheNames</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all(</span><br><span class=\"line\">        cacheNames.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cacheName</span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (cacheWhitelist.indexOf(cacheName) === -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> caches.delete(cacheName);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"设置-Cache-Control\"><a href=\"#设置-Cache-Control\" class=\"headerlink\" title=\"设置 Cache-Control\"></a>设置 Cache-Control</h3><p>静态文件，类似于图片和视频等不会经常改变的资源，做长时间缓存是没有很大的问题，可以在 HTTP 头里设置 <code>Cache-Control</code>来缓存文件使其缓存时间为一年：<code>Cache-Control: max-age=31536000</code></p>\n<p>页面，css 和 script 文件会经常变化，所以应该设置一个很短的缓存时间比如 24 小时，并在联网时与服务区端文件进行验证 <code>Cache-Control: must-revalidate, max-age=86400</code></p>\n<h3 id=\"为什么首次注册之后的首次刷新没有拦截到网络请求\"><a href=\"#为什么首次注册之后的首次刷新没有拦截到网络请求\" class=\"headerlink\" title=\"为什么首次注册之后的首次刷新没有拦截到网络请求\"></a>为什么首次注册之后的首次刷新没有拦截到网络请求</h3><p>而在首次注册、安装、激活之后，Service Worker 已经拿到了当前页面的控制权了，但为什么首次刷新却没有拦截到网络请求呢？主要是因为在 Service Worker 的注册是一个异步的过程，在激活完成后当前页面的请求都已经发送完成，因为时机太晚，此时是拦截不到任何请求的，只能等待下次访问再进行。</p>\n<p>而第二次刷新页面，由于当前站点的 Service Worker 是处于激活状态，所以不会再次新建 worker 工作线程并执行 Service Worker。也就是说激活状态的 Service Worker 在一个站点只会存在一个 worker 工作线程，除非 Service Worker 文件发生了变化（手动 unregister Service Worker 也会注销掉 worker 工作线程），触发了浏览器更新，才会重新开启生命周期。而由于 Service Worker 工作线程的离线特性，只要处于激活状态，在后续的任何访问中，都会通过 fetch 事件监听器拦截当前页面的网络请求，并执行 fetch 事件回调。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ol>\n<li><a href=\"hhttps://developers.google.com/web/fundamentals/primers/service-workers/lifecycle?hl=zh-cn\">Service Worker 生命周期</a></li>\n<li><a href=\"https://lavas-project.github.io/pwa-book/\">PWA 应用实战</a></li>\n<li><a href=\"https://blog.csdn.net/zmx_FZ/article/details/106206890\">发现刷新两次，数据才更新</a></li>\n<li><a href=\"https://github.com/youngwind/blog/issues/113\">浏览器缓存、CacheStorage、Web Worker 与 Service Worke</a></li>\n<li><a href=\"https://juejin.cn/post/6844903792522035208\">谨慎处理 Service Worker 的更新</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerRegistration/update\">ServiceWorkerRegistration.update</a></li>\n<li><a href=\"https://harttle.land/2017/04/10/service-worker-update.html\">Service Worker 更新机制</a></li>\n<li><a href=\"https://www.zhangxinxu.com/wordpress/2017/07/service-worker-cachestorage-offline-develop/\">借助 Service Worker 和 cacheStorage 缓存及离线开发</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000027080988\">Service Workers - JavaScript API 简介</a></li>\n</ol>"},{"title":"PWA-pushMessage","date":"2017-07-21T03:28:03.000Z","_content":"\n## 消息推送介绍\n\n消息推送通知目前整体支持度并不高，在手机端更只有安卓 chrome57 支持。在订阅消息之前，浏览器主要得到用户授权，同意后才能使用消息推送服务。都是通过 serviceWorker 去实现的。\n\n<!--more-->\n\n基本原理是，你的客户端和推送服务进行绑定，会生成一个绑定后的推送服务 API 接口，服务端调用此接口，发送消息。同时浏览器也需要支持这个功能，在注册 sw 时，加上推送功能的判断。\n\n```javascript\nif ('serviceWorker' in navigator && 'PushManager' in window) {\n  navigator.serviceWorker\n    .register(sw.js)\n    .then(function(swReg) {\n      swRegistration = swReg\n    })\n    .catch(function(error) {\n      console.error('Service Worker Error', error)\n    })\n} else {\n  console.warn('Push messaging is not supported')\n}\n```\n\nPushManager 注册好之后，那么要做的就是浏览器和服务器的绑定了。\n\n## 获取授权\n\n* 在订阅之前先获取用户授权，\\*\\* 使用 Notification.requestPermission。当用户允许或者拒绝授权之后，后续都不会重复询问。\n* 如果不选择 1，在正式订阅时，浏览器也会自动弹出。对于开发者而言不需要显示调用。\n* <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/notification\">Notifications API</a> 的通知接口用于向用户配置和显示桌面通知。\n* <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Push_API\">push API</a> 允许 web 应用程序接受从服务器推送到它们的消息的能力，无论 Web 应用程序是否在用户代理的前台，或者甚至当前加载。这样。开发人员就可以向选择启用的用户投放异步通知和更新，从而更及时的吸引新内容。\n\n## 订阅消息的具体实现\n\n* 在订阅之前先获取用户授权\n* 使用 pushManager 添加订阅，浏览器向推送服务发送请求，轻重传递参数对象包含两个属性。\n  * userVisibleOnly, 不允许静默的推出，所有推出都对用户可见，所以值为 true\n  * applicationServerKey, 服务器生成的公钥\n* 得到推送服务成功响应后，浏览器将推送服务返回的 endpoint 加入推送订阅对象，向服务器发送这个对象供其存储。\n\n消息推送的安全性 :\n\n* 推送服务确保调用来自可靠的服务端。\n* 推送消息内容只有浏览器能够解密，就算是推送服务也不行\n\n## 使用 web-push 服务器发送信息\n\n 这是谷歌自己实现的一个推送功能的服务器\n \n服务器端请求推送服务器，需要涉及加密，设置请求头等复杂操作。使用 web-push 可以解决大部分问题。\n\n* 使用 web-push 生成一对公私钥，还记得 pushManager 订阅时需要用到的 applicationServerKey 吗，我们需要公钥 publicKey 传递到订阅脚本所在的页面中。。\n* 调用 setVapidDetails 为 web-push 设置生成的公私钥。\n* 之前订阅时浏览器已经将推送订阅对象发送到了服务端，此时从数据库中取出。\n* 调用 sendNotification 向推送服务发起调用请求，如果返回错误状态码，从数据库中删除保存的推送订阅对象。\n* 所有推送服务都遵循同意的调用标准，**所有推送服务都遵循统一的调用标准，推送服务如果接到了服务器的调用请求，向设备推送消息，如果处于离线状态，消息将进入待发送队列，过期后队列清空，消息将被丢弃。**\n\n## 推送服务的响应\n\n* 429 too many requests\n* 400 invalid request\n* 404 not found 订阅过期，需要在服务端删除保存的推送订阅对象。\n* 410 Gone 订阅失效，需要在服务端删除保存的推送订阅对象，并调用推送订阅对象的 unsubscribe() 方法\n* 413 Payload size too large\n","source":"_posts/PWA-pushMessage.md","raw":"---\ntitle: PWA-pushMessage\ncategories: Web\ndate: 2017-07-21 11:28:03\n---\n\n## 消息推送介绍\n\n消息推送通知目前整体支持度并不高，在手机端更只有安卓 chrome57 支持。在订阅消息之前，浏览器主要得到用户授权，同意后才能使用消息推送服务。都是通过 serviceWorker 去实现的。\n\n<!--more-->\n\n基本原理是，你的客户端和推送服务进行绑定，会生成一个绑定后的推送服务 API 接口，服务端调用此接口，发送消息。同时浏览器也需要支持这个功能，在注册 sw 时，加上推送功能的判断。\n\n```javascript\nif ('serviceWorker' in navigator && 'PushManager' in window) {\n  navigator.serviceWorker\n    .register(sw.js)\n    .then(function(swReg) {\n      swRegistration = swReg\n    })\n    .catch(function(error) {\n      console.error('Service Worker Error', error)\n    })\n} else {\n  console.warn('Push messaging is not supported')\n}\n```\n\nPushManager 注册好之后，那么要做的就是浏览器和服务器的绑定了。\n\n## 获取授权\n\n* 在订阅之前先获取用户授权，\\*\\* 使用 Notification.requestPermission。当用户允许或者拒绝授权之后，后续都不会重复询问。\n* 如果不选择 1，在正式订阅时，浏览器也会自动弹出。对于开发者而言不需要显示调用。\n* <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/notification\">Notifications API</a> 的通知接口用于向用户配置和显示桌面通知。\n* <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Push_API\">push API</a> 允许 web 应用程序接受从服务器推送到它们的消息的能力，无论 Web 应用程序是否在用户代理的前台，或者甚至当前加载。这样。开发人员就可以向选择启用的用户投放异步通知和更新，从而更及时的吸引新内容。\n\n## 订阅消息的具体实现\n\n* 在订阅之前先获取用户授权\n* 使用 pushManager 添加订阅，浏览器向推送服务发送请求，轻重传递参数对象包含两个属性。\n  * userVisibleOnly, 不允许静默的推出，所有推出都对用户可见，所以值为 true\n  * applicationServerKey, 服务器生成的公钥\n* 得到推送服务成功响应后，浏览器将推送服务返回的 endpoint 加入推送订阅对象，向服务器发送这个对象供其存储。\n\n消息推送的安全性 :\n\n* 推送服务确保调用来自可靠的服务端。\n* 推送消息内容只有浏览器能够解密，就算是推送服务也不行\n\n## 使用 web-push 服务器发送信息\n\n 这是谷歌自己实现的一个推送功能的服务器\n \n服务器端请求推送服务器，需要涉及加密，设置请求头等复杂操作。使用 web-push 可以解决大部分问题。\n\n* 使用 web-push 生成一对公私钥，还记得 pushManager 订阅时需要用到的 applicationServerKey 吗，我们需要公钥 publicKey 传递到订阅脚本所在的页面中。。\n* 调用 setVapidDetails 为 web-push 设置生成的公私钥。\n* 之前订阅时浏览器已经将推送订阅对象发送到了服务端，此时从数据库中取出。\n* 调用 sendNotification 向推送服务发起调用请求，如果返回错误状态码，从数据库中删除保存的推送订阅对象。\n* 所有推送服务都遵循同意的调用标准，**所有推送服务都遵循统一的调用标准，推送服务如果接到了服务器的调用请求，向设备推送消息，如果处于离线状态，消息将进入待发送队列，过期后队列清空，消息将被丢弃。**\n\n## 推送服务的响应\n\n* 429 too many requests\n* 400 invalid request\n* 404 not found 订阅过期，需要在服务端删除保存的推送订阅对象。\n* 410 Gone 订阅失效，需要在服务端删除保存的推送订阅对象，并调用推送订阅对象的 unsubscribe() 方法\n* 413 Payload size too large\n","slug":"PWA-pushMessage","published":1,"updated":"2021-04-03T03:32:14.552Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wt000xl5v09yjlajqb","content":"<h2 id=\"消息推送介绍\"><a href=\"#消息推送介绍\" class=\"headerlink\" title=\"消息推送介绍\"></a>消息推送介绍</h2><p>消息推送通知目前整体支持度并不高，在手机端更只有安卓 chrome57 支持。在订阅消息之前，浏览器主要得到用户授权，同意后才能使用消息推送服务。都是通过 serviceWorker 去实现的。</p>\n<span id=\"more\"></span>\n\n<p>基本原理是，你的客户端和推送服务进行绑定，会生成一个绑定后的推送服务 API 接口，服务端调用此接口，发送消息。同时浏览器也需要支持这个功能，在注册 sw 时，加上推送功能的判断。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">&#x27;serviceWorker&#x27;</span> <span class=\"keyword\">in</span> navigator &amp;&amp; <span class=\"string\">&#x27;PushManager&#x27;</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>) &#123;</span><br><span class=\"line\">  navigator.serviceWorker</span><br><span class=\"line\">    .register(sw.js)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">swReg</span>) </span>&#123;</span><br><span class=\"line\">      swRegistration = swReg</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.error(<span class=\"string\">&#x27;Service Worker Error&#x27;</span>, error)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.warn(<span class=\"string\">&#x27;Push messaging is not supported&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>PushManager 注册好之后，那么要做的就是浏览器和服务器的绑定了。</p>\n<h2 id=\"获取授权\"><a href=\"#获取授权\" class=\"headerlink\" title=\"获取授权\"></a>获取授权</h2><ul>\n<li>在订阅之前先获取用户授权，** 使用 Notification.requestPermission。当用户允许或者拒绝授权之后，后续都不会重复询问。</li>\n<li>如果不选择 1，在正式订阅时，浏览器也会自动弹出。对于开发者而言不需要显示调用。</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/notification\">Notifications API</a> 的通知接口用于向用户配置和显示桌面通知。</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Push_API\">push API</a> 允许 web 应用程序接受从服务器推送到它们的消息的能力，无论 Web 应用程序是否在用户代理的前台，或者甚至当前加载。这样。开发人员就可以向选择启用的用户投放异步通知和更新，从而更及时的吸引新内容。</li>\n</ul>\n<h2 id=\"订阅消息的具体实现\"><a href=\"#订阅消息的具体实现\" class=\"headerlink\" title=\"订阅消息的具体实现\"></a>订阅消息的具体实现</h2><ul>\n<li>在订阅之前先获取用户授权</li>\n<li>使用 pushManager 添加订阅，浏览器向推送服务发送请求，轻重传递参数对象包含两个属性。<ul>\n<li>userVisibleOnly, 不允许静默的推出，所有推出都对用户可见，所以值为 true</li>\n<li>applicationServerKey, 服务器生成的公钥</li>\n</ul>\n</li>\n<li>得到推送服务成功响应后，浏览器将推送服务返回的 endpoint 加入推送订阅对象，向服务器发送这个对象供其存储。</li>\n</ul>\n<p>消息推送的安全性 :</p>\n<ul>\n<li>推送服务确保调用来自可靠的服务端。</li>\n<li>推送消息内容只有浏览器能够解密，就算是推送服务也不行</li>\n</ul>\n<h2 id=\"使用-web-push-服务器发送信息\"><a href=\"#使用-web-push-服务器发送信息\" class=\"headerlink\" title=\"使用 web-push 服务器发送信息\"></a>使用 web-push 服务器发送信息</h2><p> 这是谷歌自己实现的一个推送功能的服务器</p>\n<p>服务器端请求推送服务器，需要涉及加密，设置请求头等复杂操作。使用 web-push 可以解决大部分问题。</p>\n<ul>\n<li>使用 web-push 生成一对公私钥，还记得 pushManager 订阅时需要用到的 applicationServerKey 吗，我们需要公钥 publicKey 传递到订阅脚本所在的页面中。。</li>\n<li>调用 setVapidDetails 为 web-push 设置生成的公私钥。</li>\n<li>之前订阅时浏览器已经将推送订阅对象发送到了服务端，此时从数据库中取出。</li>\n<li>调用 sendNotification 向推送服务发起调用请求，如果返回错误状态码，从数据库中删除保存的推送订阅对象。</li>\n<li>所有推送服务都遵循同意的调用标准，<strong>所有推送服务都遵循统一的调用标准，推送服务如果接到了服务器的调用请求，向设备推送消息，如果处于离线状态，消息将进入待发送队列，过期后队列清空，消息将被丢弃。</strong></li>\n</ul>\n<h2 id=\"推送服务的响应\"><a href=\"#推送服务的响应\" class=\"headerlink\" title=\"推送服务的响应\"></a>推送服务的响应</h2><ul>\n<li>429 too many requests</li>\n<li>400 invalid request</li>\n<li>404 not found 订阅过期，需要在服务端删除保存的推送订阅对象。</li>\n<li>410 Gone 订阅失效，需要在服务端删除保存的推送订阅对象，并调用推送订阅对象的 unsubscribe() 方法</li>\n<li>413 Payload size too large</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"消息推送介绍\"><a href=\"#消息推送介绍\" class=\"headerlink\" title=\"消息推送介绍\"></a>消息推送介绍</h2><p>消息推送通知目前整体支持度并不高，在手机端更只有安卓 chrome57 支持。在订阅消息之前，浏览器主要得到用户授权，同意后才能使用消息推送服务。都是通过 serviceWorker 去实现的。</p>","more":"<p>基本原理是，你的客户端和推送服务进行绑定，会生成一个绑定后的推送服务 API 接口，服务端调用此接口，发送消息。同时浏览器也需要支持这个功能，在注册 sw 时，加上推送功能的判断。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">&#x27;serviceWorker&#x27;</span> <span class=\"keyword\">in</span> navigator &amp;&amp; <span class=\"string\">&#x27;PushManager&#x27;</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>) &#123;</span><br><span class=\"line\">  navigator.serviceWorker</span><br><span class=\"line\">    .register(sw.js)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">swReg</span>) </span>&#123;</span><br><span class=\"line\">      swRegistration = swReg</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.error(<span class=\"string\">&#x27;Service Worker Error&#x27;</span>, error)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.warn(<span class=\"string\">&#x27;Push messaging is not supported&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>PushManager 注册好之后，那么要做的就是浏览器和服务器的绑定了。</p>\n<h2 id=\"获取授权\"><a href=\"#获取授权\" class=\"headerlink\" title=\"获取授权\"></a>获取授权</h2><ul>\n<li>在订阅之前先获取用户授权，** 使用 Notification.requestPermission。当用户允许或者拒绝授权之后，后续都不会重复询问。</li>\n<li>如果不选择 1，在正式订阅时，浏览器也会自动弹出。对于开发者而言不需要显示调用。</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/notification\">Notifications API</a> 的通知接口用于向用户配置和显示桌面通知。</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Push_API\">push API</a> 允许 web 应用程序接受从服务器推送到它们的消息的能力，无论 Web 应用程序是否在用户代理的前台，或者甚至当前加载。这样。开发人员就可以向选择启用的用户投放异步通知和更新，从而更及时的吸引新内容。</li>\n</ul>\n<h2 id=\"订阅消息的具体实现\"><a href=\"#订阅消息的具体实现\" class=\"headerlink\" title=\"订阅消息的具体实现\"></a>订阅消息的具体实现</h2><ul>\n<li>在订阅之前先获取用户授权</li>\n<li>使用 pushManager 添加订阅，浏览器向推送服务发送请求，轻重传递参数对象包含两个属性。<ul>\n<li>userVisibleOnly, 不允许静默的推出，所有推出都对用户可见，所以值为 true</li>\n<li>applicationServerKey, 服务器生成的公钥</li>\n</ul>\n</li>\n<li>得到推送服务成功响应后，浏览器将推送服务返回的 endpoint 加入推送订阅对象，向服务器发送这个对象供其存储。</li>\n</ul>\n<p>消息推送的安全性 :</p>\n<ul>\n<li>推送服务确保调用来自可靠的服务端。</li>\n<li>推送消息内容只有浏览器能够解密，就算是推送服务也不行</li>\n</ul>\n<h2 id=\"使用-web-push-服务器发送信息\"><a href=\"#使用-web-push-服务器发送信息\" class=\"headerlink\" title=\"使用 web-push 服务器发送信息\"></a>使用 web-push 服务器发送信息</h2><p> 这是谷歌自己实现的一个推送功能的服务器</p>\n<p>服务器端请求推送服务器，需要涉及加密，设置请求头等复杂操作。使用 web-push 可以解决大部分问题。</p>\n<ul>\n<li>使用 web-push 生成一对公私钥，还记得 pushManager 订阅时需要用到的 applicationServerKey 吗，我们需要公钥 publicKey 传递到订阅脚本所在的页面中。。</li>\n<li>调用 setVapidDetails 为 web-push 设置生成的公私钥。</li>\n<li>之前订阅时浏览器已经将推送订阅对象发送到了服务端，此时从数据库中取出。</li>\n<li>调用 sendNotification 向推送服务发起调用请求，如果返回错误状态码，从数据库中删除保存的推送订阅对象。</li>\n<li>所有推送服务都遵循同意的调用标准，<strong>所有推送服务都遵循统一的调用标准，推送服务如果接到了服务器的调用请求，向设备推送消息，如果处于离线状态，消息将进入待发送队列，过期后队列清空，消息将被丢弃。</strong></li>\n</ul>\n<h2 id=\"推送服务的响应\"><a href=\"#推送服务的响应\" class=\"headerlink\" title=\"推送服务的响应\"></a>推送服务的响应</h2><ul>\n<li>429 too many requests</li>\n<li>400 invalid request</li>\n<li>404 not found 订阅过期，需要在服务端删除保存的推送订阅对象。</li>\n<li>410 Gone 订阅失效，需要在服务端删除保存的推送订阅对象，并调用推送订阅对象的 unsubscribe() 方法</li>\n<li>413 Payload size too large</li>\n</ul>"},{"title":"Vue.js内部运行机制","date":"2018-11-06T03:07:19.000Z","_content":"\n记录一下 vue.js 内部的整个流程\n\n<!--more-->\n\n## vue 模板如何渲染成 HTML？以及渲染过程\n\n1. vue 模板的本质是字符串，利用各种正则，把模板中的属性去变成 js 中的变量，vif,vshow,v-for 等指令变成 js 中的逻辑\n2. 模板最终会被转换成 render 函数\n3. render 函数执行返回 vnode\n4. 使用 vnode 的 path 方法把 vnode 渲染成真实 DOM\n\n## vue 的整个实现流程\n\n1. 先把模板解析成 render 函数，把模板中的属性 去变成 js 中的变量，vif,vshow,vfor 等指令变成 js 中的逻辑。\n2. 执行 render 函数，在初次渲染执行 render 函数的过程中绑定属性监听，收集依赖，最终得到 vnode。利用 vnode 的 path 方法，把 vnode 渲染成真实的 DOM\n3. 在属性更新后，重新执行 render 函数，不过这时候就不需要绑定属性和收集依赖了，最终生成新的 vnode\n4. 把新的 vnode 和旧的 vnode 去做对比，找出需要更新的 dom，渲染\n\n## 什么是 diff 算法，或者是 diff 算法是用来做什么的\n\n- diff 是 linux 中的基础命令，可以用来做文件，内容之间做比较\n- vnode 中使用 diff 算法是为了找出需要更新的节点，避免造成不必要的更新\n\n## vuex 是什么\n\nvuex 就是一个全局的仓库，公共的状态或者复杂组件交互的状态我们会抽离出来放进里面。\nvuex 的核心主要是包括以下几个部分：\n\n- state：state 里面就是存放的我们需要使用的状态，他是单向数据流，在 vue 中不予许直接对他进行修改，而是使用 mutations 去进行修改\n- mutations：mutations 就是存放如何更改状态 的一些方法\n- actions：actions 是用来做异步修改的，他可以等待异步结束后，在去使用 commit mutations 去修改状态\n- getters:相当于是 state 的计算属性\n\n使用：\n\n- 获取状态在组件内部 computed 中使用 this.\\$store.state 得到想要的状态\n- 修改的话可在组件中使用 this.\\$store.commit 方法去修改状态\n- 如果在一个组件中，方法，状态使用太多，可以使用 mapstate,mapmutations 辅助函数\n\n## 生命周期\n\n- 窗前前/后（beforeCreate/created）:在 beforeCreate 阶段，Vue 实例的挂载元素 el 和数据对象 data 都为 undefined，还未初始化。在 created 阶段，Vue 实例的数据对象 data 有了，el 还没有\n- 载入前后/后（beforeMount/mounted）:在 beforeMount 阶段，vue 实例的\\$el 和 data 都初始化了，但还是挂载之前为虚拟 DOM 节点，data 尚未替换，在 mounted 阶段，vue 实例挂载完成，data 成功渲染\n- 更新前/后（beforeDestory/destory）：beforeDestroy 是在 vue 实例销毁前触发，一般在这里要通过 removeEventLisener 解除手动绑定事件。实例销毁后，触发 destroyed。\n\n## 组件间的通信\n\n1. 父子通信：\n   父向子传递数据是通过 props，子向父是通过 event（\\$emit）;通过父链/子链也可以通信（$parent,$children）；ref 也可以访问组件实例。proved/injectApi\n2. 兄弟通信：\n   Bus;Vuex;\n3. 跨级通信\n   Bus；Vuex;provide/inject Api\n\n## 数组监听漏洞\nVue检测数据的变动是通过Object.defineProperty实现的，所以无法监听数组的添加操作是可以理解的，因为是在构造函数中就已经为所有属性做了这个检测绑定操作。\n但是官方的原文：由于 JavaScript 的限制， Vue 不能检测以下变动的数组：\n- 当你利用索引直接设置一个项时，例如： vm.items[indexOfItem] = newValue\n- 当你修改数组的长度时，例如： vm.items.length = newLength\n\nVue.js观察数组变化主要通过以下7个方法（push、pop、shift、unshift、splice、sort、reverse），由于 Vue 会在初始化实例时对属性执行 getter/setter 转化过程，所以属性必须在 data 对象上存在才能让 Vue 转换它，这样才能让它是响应的。\n\nvue 中是通过对每个键设置getter/setter 来实现响应式的，开发者使用数组，目的往往是遍历，此时电泳getter开销太大了，所以vue不在数组每个键上设置，而是在数组上定义`_ob_`,并且替代了push等等能够影响原数组的原型方法。\n\n```javascript\nvar vm = new Vue({\n    el: '#app',\n    data: {\n        orderList: [{\n            status: 0,\n            points: 3,\n            money: 300,\n            checked:false\n        },\n        {\n            status: 0,\n            points: 3,\n            money: 300\n        },\n        {\n            status: 1,\n            points: 3,\n            money: 400\n        }]\n    },\n    created() {\n        this.orderList.forEach(function (item) {\n            item.checked = false;\n        })\n    },\n    methods: {\n        handleChoose(item) {\n            item.checked = !item.checked;\n        }\n    }\n})\n```\n上面是检测不到后面两个checked的变化的。\n\n### 解决方案\n\n- Vue.set(vue.obj,'e',0)\n- this.obj= Object.assign({}, this.obj, { a: 1, e: 2 })\n\n```javascript\nvar vm = new Vue({\n    el: '#app',\n    data: {\n        orderList: []\n    },\n    created() {\n        var data = [{\n            status: 0,\n            points: 3,\n            money: 300,\n        },\n        {\n            status: 0,\n            points: 3,\n            money: 300\n        },\n        {\n            status: 1,\n            points: 3,\n            money: 400\n        }];\n        data.forEach(function (item) {\n            item.checked = false;\n        })\n        this.orderList = data;\n    },\n    methods: {\n        handleChoose(item) {\n            item.checked = !item.checked;\n        }\n    }\n})\n```\n这样写也是没有问题的，浅层次操作数组是没有问题的。\n\n## vue中的key 到底有什么用\n","source":"_posts/Vue-js内部运行机制.md","raw":"---\ntitle: Vue.js内部运行机制\ndate: 2018-11-06 11:07:19\ntags: Vue\n---\n\n记录一下 vue.js 内部的整个流程\n\n<!--more-->\n\n## vue 模板如何渲染成 HTML？以及渲染过程\n\n1. vue 模板的本质是字符串，利用各种正则，把模板中的属性去变成 js 中的变量，vif,vshow,v-for 等指令变成 js 中的逻辑\n2. 模板最终会被转换成 render 函数\n3. render 函数执行返回 vnode\n4. 使用 vnode 的 path 方法把 vnode 渲染成真实 DOM\n\n## vue 的整个实现流程\n\n1. 先把模板解析成 render 函数，把模板中的属性 去变成 js 中的变量，vif,vshow,vfor 等指令变成 js 中的逻辑。\n2. 执行 render 函数，在初次渲染执行 render 函数的过程中绑定属性监听，收集依赖，最终得到 vnode。利用 vnode 的 path 方法，把 vnode 渲染成真实的 DOM\n3. 在属性更新后，重新执行 render 函数，不过这时候就不需要绑定属性和收集依赖了，最终生成新的 vnode\n4. 把新的 vnode 和旧的 vnode 去做对比，找出需要更新的 dom，渲染\n\n## 什么是 diff 算法，或者是 diff 算法是用来做什么的\n\n- diff 是 linux 中的基础命令，可以用来做文件，内容之间做比较\n- vnode 中使用 diff 算法是为了找出需要更新的节点，避免造成不必要的更新\n\n## vuex 是什么\n\nvuex 就是一个全局的仓库，公共的状态或者复杂组件交互的状态我们会抽离出来放进里面。\nvuex 的核心主要是包括以下几个部分：\n\n- state：state 里面就是存放的我们需要使用的状态，他是单向数据流，在 vue 中不予许直接对他进行修改，而是使用 mutations 去进行修改\n- mutations：mutations 就是存放如何更改状态 的一些方法\n- actions：actions 是用来做异步修改的，他可以等待异步结束后，在去使用 commit mutations 去修改状态\n- getters:相当于是 state 的计算属性\n\n使用：\n\n- 获取状态在组件内部 computed 中使用 this.\\$store.state 得到想要的状态\n- 修改的话可在组件中使用 this.\\$store.commit 方法去修改状态\n- 如果在一个组件中，方法，状态使用太多，可以使用 mapstate,mapmutations 辅助函数\n\n## 生命周期\n\n- 窗前前/后（beforeCreate/created）:在 beforeCreate 阶段，Vue 实例的挂载元素 el 和数据对象 data 都为 undefined，还未初始化。在 created 阶段，Vue 实例的数据对象 data 有了，el 还没有\n- 载入前后/后（beforeMount/mounted）:在 beforeMount 阶段，vue 实例的\\$el 和 data 都初始化了，但还是挂载之前为虚拟 DOM 节点，data 尚未替换，在 mounted 阶段，vue 实例挂载完成，data 成功渲染\n- 更新前/后（beforeDestory/destory）：beforeDestroy 是在 vue 实例销毁前触发，一般在这里要通过 removeEventLisener 解除手动绑定事件。实例销毁后，触发 destroyed。\n\n## 组件间的通信\n\n1. 父子通信：\n   父向子传递数据是通过 props，子向父是通过 event（\\$emit）;通过父链/子链也可以通信（$parent,$children）；ref 也可以访问组件实例。proved/injectApi\n2. 兄弟通信：\n   Bus;Vuex;\n3. 跨级通信\n   Bus；Vuex;provide/inject Api\n\n## 数组监听漏洞\nVue检测数据的变动是通过Object.defineProperty实现的，所以无法监听数组的添加操作是可以理解的，因为是在构造函数中就已经为所有属性做了这个检测绑定操作。\n但是官方的原文：由于 JavaScript 的限制， Vue 不能检测以下变动的数组：\n- 当你利用索引直接设置一个项时，例如： vm.items[indexOfItem] = newValue\n- 当你修改数组的长度时，例如： vm.items.length = newLength\n\nVue.js观察数组变化主要通过以下7个方法（push、pop、shift、unshift、splice、sort、reverse），由于 Vue 会在初始化实例时对属性执行 getter/setter 转化过程，所以属性必须在 data 对象上存在才能让 Vue 转换它，这样才能让它是响应的。\n\nvue 中是通过对每个键设置getter/setter 来实现响应式的，开发者使用数组，目的往往是遍历，此时电泳getter开销太大了，所以vue不在数组每个键上设置，而是在数组上定义`_ob_`,并且替代了push等等能够影响原数组的原型方法。\n\n```javascript\nvar vm = new Vue({\n    el: '#app',\n    data: {\n        orderList: [{\n            status: 0,\n            points: 3,\n            money: 300,\n            checked:false\n        },\n        {\n            status: 0,\n            points: 3,\n            money: 300\n        },\n        {\n            status: 1,\n            points: 3,\n            money: 400\n        }]\n    },\n    created() {\n        this.orderList.forEach(function (item) {\n            item.checked = false;\n        })\n    },\n    methods: {\n        handleChoose(item) {\n            item.checked = !item.checked;\n        }\n    }\n})\n```\n上面是检测不到后面两个checked的变化的。\n\n### 解决方案\n\n- Vue.set(vue.obj,'e',0)\n- this.obj= Object.assign({}, this.obj, { a: 1, e: 2 })\n\n```javascript\nvar vm = new Vue({\n    el: '#app',\n    data: {\n        orderList: []\n    },\n    created() {\n        var data = [{\n            status: 0,\n            points: 3,\n            money: 300,\n        },\n        {\n            status: 0,\n            points: 3,\n            money: 300\n        },\n        {\n            status: 1,\n            points: 3,\n            money: 400\n        }];\n        data.forEach(function (item) {\n            item.checked = false;\n        })\n        this.orderList = data;\n    },\n    methods: {\n        handleChoose(item) {\n            item.checked = !item.checked;\n        }\n    }\n})\n```\n这样写也是没有问题的，浅层次操作数组是没有问题的。\n\n## vue中的key 到底有什么用\n","slug":"Vue-js内部运行机制","published":1,"updated":"2021-02-27T12:24:38.484Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1ww000zl5v08c9f8jg6","content":"<p>记录一下 vue.js 内部的整个流程</p>\n<span id=\"more\"></span>\n\n<h2 id=\"vue-模板如何渲染成-HTML？以及渲染过程\"><a href=\"#vue-模板如何渲染成-HTML？以及渲染过程\" class=\"headerlink\" title=\"vue 模板如何渲染成 HTML？以及渲染过程\"></a>vue 模板如何渲染成 HTML？以及渲染过程</h2><ol>\n<li>vue 模板的本质是字符串，利用各种正则，把模板中的属性去变成 js 中的变量，vif,vshow,v-for 等指令变成 js 中的逻辑</li>\n<li>模板最终会被转换成 render 函数</li>\n<li>render 函数执行返回 vnode</li>\n<li>使用 vnode 的 path 方法把 vnode 渲染成真实 DOM</li>\n</ol>\n<h2 id=\"vue-的整个实现流程\"><a href=\"#vue-的整个实现流程\" class=\"headerlink\" title=\"vue 的整个实现流程\"></a>vue 的整个实现流程</h2><ol>\n<li>先把模板解析成 render 函数，把模板中的属性 去变成 js 中的变量，vif,vshow,vfor 等指令变成 js 中的逻辑。</li>\n<li>执行 render 函数，在初次渲染执行 render 函数的过程中绑定属性监听，收集依赖，最终得到 vnode。利用 vnode 的 path 方法，把 vnode 渲染成真实的 DOM</li>\n<li>在属性更新后，重新执行 render 函数，不过这时候就不需要绑定属性和收集依赖了，最终生成新的 vnode</li>\n<li>把新的 vnode 和旧的 vnode 去做对比，找出需要更新的 dom，渲染</li>\n</ol>\n<h2 id=\"什么是-diff-算法，或者是-diff-算法是用来做什么的\"><a href=\"#什么是-diff-算法，或者是-diff-算法是用来做什么的\" class=\"headerlink\" title=\"什么是 diff 算法，或者是 diff 算法是用来做什么的\"></a>什么是 diff 算法，或者是 diff 算法是用来做什么的</h2><ul>\n<li>diff 是 linux 中的基础命令，可以用来做文件，内容之间做比较</li>\n<li>vnode 中使用 diff 算法是为了找出需要更新的节点，避免造成不必要的更新</li>\n</ul>\n<h2 id=\"vuex-是什么\"><a href=\"#vuex-是什么\" class=\"headerlink\" title=\"vuex 是什么\"></a>vuex 是什么</h2><p>vuex 就是一个全局的仓库，公共的状态或者复杂组件交互的状态我们会抽离出来放进里面。<br>vuex 的核心主要是包括以下几个部分：</p>\n<ul>\n<li>state：state 里面就是存放的我们需要使用的状态，他是单向数据流，在 vue 中不予许直接对他进行修改，而是使用 mutations 去进行修改</li>\n<li>mutations：mutations 就是存放如何更改状态 的一些方法</li>\n<li>actions：actions 是用来做异步修改的，他可以等待异步结束后，在去使用 commit mutations 去修改状态</li>\n<li>getters:相当于是 state 的计算属性</li>\n</ul>\n<p>使用：</p>\n<ul>\n<li>获取状态在组件内部 computed 中使用 this.$store.state 得到想要的状态</li>\n<li>修改的话可在组件中使用 this.$store.commit 方法去修改状态</li>\n<li>如果在一个组件中，方法，状态使用太多，可以使用 mapstate,mapmutations 辅助函数</li>\n</ul>\n<h2 id=\"生命周期\"><a href=\"#生命周期\" class=\"headerlink\" title=\"生命周期\"></a>生命周期</h2><ul>\n<li>窗前前/后（beforeCreate/created）:在 beforeCreate 阶段，Vue 实例的挂载元素 el 和数据对象 data 都为 undefined，还未初始化。在 created 阶段，Vue 实例的数据对象 data 有了，el 还没有</li>\n<li>载入前后/后（beforeMount/mounted）:在 beforeMount 阶段，vue 实例的$el 和 data 都初始化了，但还是挂载之前为虚拟 DOM 节点，data 尚未替换，在 mounted 阶段，vue 实例挂载完成，data 成功渲染</li>\n<li>更新前/后（beforeDestory/destory）：beforeDestroy 是在 vue 实例销毁前触发，一般在这里要通过 removeEventLisener 解除手动绑定事件。实例销毁后，触发 destroyed。</li>\n</ul>\n<h2 id=\"组件间的通信\"><a href=\"#组件间的通信\" class=\"headerlink\" title=\"组件间的通信\"></a>组件间的通信</h2><ol>\n<li>父子通信：<br>父向子传递数据是通过 props，子向父是通过 event（$emit）;通过父链/子链也可以通信（$parent,$children）；ref 也可以访问组件实例。proved/injectApi</li>\n<li>兄弟通信：<br>Bus;Vuex;</li>\n<li>跨级通信<br>Bus；Vuex;provide/inject Api</li>\n</ol>\n<h2 id=\"数组监听漏洞\"><a href=\"#数组监听漏洞\" class=\"headerlink\" title=\"数组监听漏洞\"></a>数组监听漏洞</h2><p>Vue检测数据的变动是通过Object.defineProperty实现的，所以无法监听数组的添加操作是可以理解的，因为是在构造函数中就已经为所有属性做了这个检测绑定操作。<br>但是官方的原文：由于 JavaScript 的限制， Vue 不能检测以下变动的数组：</p>\n<ul>\n<li>当你利用索引直接设置一个项时，例如： vm.items[indexOfItem] = newValue</li>\n<li>当你修改数组的长度时，例如： vm.items.length = newLength</li>\n</ul>\n<p>Vue.js观察数组变化主要通过以下7个方法（push、pop、shift、unshift、splice、sort、reverse），由于 Vue 会在初始化实例时对属性执行 getter/setter 转化过程，所以属性必须在 data 对象上存在才能让 Vue 转换它，这样才能让它是响应的。</p>\n<p>vue 中是通过对每个键设置getter/setter 来实现响应式的，开发者使用数组，目的往往是遍历，此时电泳getter开销太大了，所以vue不在数组每个键上设置，而是在数组上定义<code>_ob_</code>,并且替代了push等等能够影响原数组的原型方法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">    el: <span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">        orderList: [&#123;</span><br><span class=\"line\">            status: <span class=\"number\">0</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">300</span>,</span><br><span class=\"line\">            checked:<span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            status: <span class=\"number\">0</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">300</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            status: <span class=\"number\">1</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">400</span></span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">created</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.orderList.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">            item.checked = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"title\">handleChoose</span>(<span class=\"params\">item</span>)</span> &#123;</span><br><span class=\"line\">            item.checked = !item.checked;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>上面是检测不到后面两个checked的变化的。</p>\n<h3 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h3><ul>\n<li>Vue.set(vue.obj,’e’,0)</li>\n<li>this.obj= Object.assign({}, this.obj, { a: 1, e: 2 })</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">    el: <span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">        orderList: []</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">created</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> data = [&#123;</span><br><span class=\"line\">            status: <span class=\"number\">0</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">300</span>,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            status: <span class=\"number\">0</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">300</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            status: <span class=\"number\">1</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">400</span></span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        data.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">            item.checked = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.orderList = data;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"title\">handleChoose</span>(<span class=\"params\">item</span>)</span> &#123;</span><br><span class=\"line\">            item.checked = !item.checked;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>这样写也是没有问题的，浅层次操作数组是没有问题的。</p>\n<h2 id=\"vue中的key-到底有什么用\"><a href=\"#vue中的key-到底有什么用\" class=\"headerlink\" title=\"vue中的key 到底有什么用\"></a>vue中的key 到底有什么用</h2>","site":{"data":{}},"excerpt":"<p>记录一下 vue.js 内部的整个流程</p>","more":"<h2 id=\"vue-模板如何渲染成-HTML？以及渲染过程\"><a href=\"#vue-模板如何渲染成-HTML？以及渲染过程\" class=\"headerlink\" title=\"vue 模板如何渲染成 HTML？以及渲染过程\"></a>vue 模板如何渲染成 HTML？以及渲染过程</h2><ol>\n<li>vue 模板的本质是字符串，利用各种正则，把模板中的属性去变成 js 中的变量，vif,vshow,v-for 等指令变成 js 中的逻辑</li>\n<li>模板最终会被转换成 render 函数</li>\n<li>render 函数执行返回 vnode</li>\n<li>使用 vnode 的 path 方法把 vnode 渲染成真实 DOM</li>\n</ol>\n<h2 id=\"vue-的整个实现流程\"><a href=\"#vue-的整个实现流程\" class=\"headerlink\" title=\"vue 的整个实现流程\"></a>vue 的整个实现流程</h2><ol>\n<li>先把模板解析成 render 函数，把模板中的属性 去变成 js 中的变量，vif,vshow,vfor 等指令变成 js 中的逻辑。</li>\n<li>执行 render 函数，在初次渲染执行 render 函数的过程中绑定属性监听，收集依赖，最终得到 vnode。利用 vnode 的 path 方法，把 vnode 渲染成真实的 DOM</li>\n<li>在属性更新后，重新执行 render 函数，不过这时候就不需要绑定属性和收集依赖了，最终生成新的 vnode</li>\n<li>把新的 vnode 和旧的 vnode 去做对比，找出需要更新的 dom，渲染</li>\n</ol>\n<h2 id=\"什么是-diff-算法，或者是-diff-算法是用来做什么的\"><a href=\"#什么是-diff-算法，或者是-diff-算法是用来做什么的\" class=\"headerlink\" title=\"什么是 diff 算法，或者是 diff 算法是用来做什么的\"></a>什么是 diff 算法，或者是 diff 算法是用来做什么的</h2><ul>\n<li>diff 是 linux 中的基础命令，可以用来做文件，内容之间做比较</li>\n<li>vnode 中使用 diff 算法是为了找出需要更新的节点，避免造成不必要的更新</li>\n</ul>\n<h2 id=\"vuex-是什么\"><a href=\"#vuex-是什么\" class=\"headerlink\" title=\"vuex 是什么\"></a>vuex 是什么</h2><p>vuex 就是一个全局的仓库，公共的状态或者复杂组件交互的状态我们会抽离出来放进里面。<br>vuex 的核心主要是包括以下几个部分：</p>\n<ul>\n<li>state：state 里面就是存放的我们需要使用的状态，他是单向数据流，在 vue 中不予许直接对他进行修改，而是使用 mutations 去进行修改</li>\n<li>mutations：mutations 就是存放如何更改状态 的一些方法</li>\n<li>actions：actions 是用来做异步修改的，他可以等待异步结束后，在去使用 commit mutations 去修改状态</li>\n<li>getters:相当于是 state 的计算属性</li>\n</ul>\n<p>使用：</p>\n<ul>\n<li>获取状态在组件内部 computed 中使用 this.$store.state 得到想要的状态</li>\n<li>修改的话可在组件中使用 this.$store.commit 方法去修改状态</li>\n<li>如果在一个组件中，方法，状态使用太多，可以使用 mapstate,mapmutations 辅助函数</li>\n</ul>\n<h2 id=\"生命周期\"><a href=\"#生命周期\" class=\"headerlink\" title=\"生命周期\"></a>生命周期</h2><ul>\n<li>窗前前/后（beforeCreate/created）:在 beforeCreate 阶段，Vue 实例的挂载元素 el 和数据对象 data 都为 undefined，还未初始化。在 created 阶段，Vue 实例的数据对象 data 有了，el 还没有</li>\n<li>载入前后/后（beforeMount/mounted）:在 beforeMount 阶段，vue 实例的$el 和 data 都初始化了，但还是挂载之前为虚拟 DOM 节点，data 尚未替换，在 mounted 阶段，vue 实例挂载完成，data 成功渲染</li>\n<li>更新前/后（beforeDestory/destory）：beforeDestroy 是在 vue 实例销毁前触发，一般在这里要通过 removeEventLisener 解除手动绑定事件。实例销毁后，触发 destroyed。</li>\n</ul>\n<h2 id=\"组件间的通信\"><a href=\"#组件间的通信\" class=\"headerlink\" title=\"组件间的通信\"></a>组件间的通信</h2><ol>\n<li>父子通信：<br>父向子传递数据是通过 props，子向父是通过 event（$emit）;通过父链/子链也可以通信（$parent,$children）；ref 也可以访问组件实例。proved/injectApi</li>\n<li>兄弟通信：<br>Bus;Vuex;</li>\n<li>跨级通信<br>Bus；Vuex;provide/inject Api</li>\n</ol>\n<h2 id=\"数组监听漏洞\"><a href=\"#数组监听漏洞\" class=\"headerlink\" title=\"数组监听漏洞\"></a>数组监听漏洞</h2><p>Vue检测数据的变动是通过Object.defineProperty实现的，所以无法监听数组的添加操作是可以理解的，因为是在构造函数中就已经为所有属性做了这个检测绑定操作。<br>但是官方的原文：由于 JavaScript 的限制， Vue 不能检测以下变动的数组：</p>\n<ul>\n<li>当你利用索引直接设置一个项时，例如： vm.items[indexOfItem] = newValue</li>\n<li>当你修改数组的长度时，例如： vm.items.length = newLength</li>\n</ul>\n<p>Vue.js观察数组变化主要通过以下7个方法（push、pop、shift、unshift、splice、sort、reverse），由于 Vue 会在初始化实例时对属性执行 getter/setter 转化过程，所以属性必须在 data 对象上存在才能让 Vue 转换它，这样才能让它是响应的。</p>\n<p>vue 中是通过对每个键设置getter/setter 来实现响应式的，开发者使用数组，目的往往是遍历，此时电泳getter开销太大了，所以vue不在数组每个键上设置，而是在数组上定义<code>_ob_</code>,并且替代了push等等能够影响原数组的原型方法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">    el: <span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">        orderList: [&#123;</span><br><span class=\"line\">            status: <span class=\"number\">0</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">300</span>,</span><br><span class=\"line\">            checked:<span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            status: <span class=\"number\">0</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">300</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            status: <span class=\"number\">1</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">400</span></span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">created</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.orderList.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">            item.checked = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"title\">handleChoose</span>(<span class=\"params\">item</span>)</span> &#123;</span><br><span class=\"line\">            item.checked = !item.checked;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>上面是检测不到后面两个checked的变化的。</p>\n<h3 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h3><ul>\n<li>Vue.set(vue.obj,’e’,0)</li>\n<li>this.obj= Object.assign({}, this.obj, { a: 1, e: 2 })</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">    el: <span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">        orderList: []</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">created</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> data = [&#123;</span><br><span class=\"line\">            status: <span class=\"number\">0</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">300</span>,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            status: <span class=\"number\">0</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">300</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            status: <span class=\"number\">1</span>,</span><br><span class=\"line\">            points: <span class=\"number\">3</span>,</span><br><span class=\"line\">            money: <span class=\"number\">400</span></span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        data.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">            item.checked = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.orderList = data;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"title\">handleChoose</span>(<span class=\"params\">item</span>)</span> &#123;</span><br><span class=\"line\">            item.checked = !item.checked;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>这样写也是没有问题的，浅层次操作数组是没有问题的。</p>\n<h2 id=\"vue中的key-到底有什么用\"><a href=\"#vue中的key-到底有什么用\" class=\"headerlink\" title=\"vue中的key 到底有什么用\"></a>vue中的key 到底有什么用</h2>"},{"title":"Vue小知识点运用","date":"2019-07-09T06:56:06.000Z","_content":"\nVue API 中的小知识点运用与总结\n\n<!--more-->\n\n## 状态共享\n\n随着组件的细化，就会遇到多组件状态共享的情况，Vuex 当然可以解决这些问题，但是如果应用不够大，为避免代码繁琐冗余，最好不要使用它。我们可以通过使用 Observable API 应对一些简单的跨组件数据状态共享的情况。\n\n### Observable\n\n让一个对象可响应。Vue 内部会用它来处理 data 函数返回的对象。可以实现简单的 store 管理。\n\n返回的对象可以直接在渲染函数和计算属性中使用，并在编译时触发适当的更新。它还可以用作简单场景的最小跨组件状态存储：\n\nstore.js\n\n```javascript\nimport vue from 'vue'\nexport const store = vue.observable({ count: 0 })\nexport const mutation = {\n  setCount(count) {\n    store.count = count\n  }\n}\n```\n\n应用组件：\n\n```html\n<template>\n  <div class=\"hello\">\n    <p @click=\"setCount(testCount + 1)\">+</p>\n    <p @click=\"setCount(testCount - 1)\">-</p>\n    <test />\n    <p>{{testCount}}</p>\n  </div>\n</template>\n\n<script>\n  import test from './test'\n  import { store, mutation } from '@/store'\n  export default {\n    name: 'HelloWorld',\n    data() {\n      return {\n        msg: 'Welcome to Your Vue.js App'\n      }\n    },\n    components: {\n      test\n    },\n    methods: {\n      setCount: mutation.setCount\n    },\n    computed: {\n      testCount() {\n        return store.count\n      }\n    }\n  }\n</script>\n```\n\ntest 组件\n\n```html\n<template>\n  <div>test{{testCount}}</div>\n</template>\n<script>\n  import { store } from '@/store'\n  export default {\n    computed: {\n      testCount() {\n        return store.count\n      }\n    }\n  }\n</script>\n```\n\n## 长列表性能优化\n\nvue 是通过 object.defineProperty 对数据进行劫持，来实现视图响应数据的变化，然而有些时候我们的组件就是纯粹的展示，不需要 vue 劫持我们的数据，在大量数据展示的情况下，这能够很明显的减少组件初始化的时间，**我们可以通过`object.freeze`方法来冻结一个对象，一旦被冻结的对象就再也不能被修改了**。\n\n```javascript\nexport default {\n  data: () => ({ user: {} }),\n  async created() {\n    const users = await axios.get('api/users')\n    this.users = Object.freeze(users)\n  }\n}\n```\n\n这里仅仅是冻结了 user 的值，引用不会被冻结，当我们需要 reactive 数据的时候，我们可以重新给 users 赋值。\n\n```html\nexport default { data: () => ({ users: [] }), async created() { const users =\nawait axios.get(\"/api/users\"); this.users = Object.freeze(users); }, methods: {\na() { //改变值不会触发视图响应 this.users[0] = newValue;\n//改变引用依然会触发视图响应 this.users = newValue; } } };\n```\n\n## 函数式组件\n\nApp.vue\n\n```html\n<template>\n  <div id=\"app\">\n    <List\n      :items=\"['Wonderwoman', 'Ironman']\"\n      :item-click=\"item => (clicked = item)\"\n    />\n    <p>Clicked hero: {{ clicked }}</p>\n  </div>\n</template>\n\n<script>\n  import List from './List'\n\n  export default {\n    name: 'App',\n    data: () => ({ clicked: '' }),\n    components: { List }\n  }\n</script>\n```\n\nList.vue\n\n```html\n<template functional>\n  <div>\n    <p v-for=\"item in props.items\" @click=\"props.itemClick(item);\">\n      {{ item }}\n    </p>\n  </div>\n</template>\n```\n\n## 监听组件的生命周期\n\n比如有父组件 Parent 和子组件 Child，如果父组件监听到子组件挂载 mounted 就做一些逻辑处理，常规写法可能如下：\n\n```html\n// Parent.vue\n<Child @mounted=\"doSomething\" />\n\n// Child.vue mounted() { this.$emit(\"mounted\"); }\n```\n\n## 混入\n\n分发 Vue 组件中的可复用功能\n当我们开发应用时，经常会遇到一些功能和逻辑，需要在不同的组件间多次使用，比如同样的方法逻辑，两个组件都要用到，但我们又不想也不应该完全复制两遍，这个时候就该用 mixins 了。\n这意味着，如果我创建了一个组件，它有 X 个不同的方法、周期逻辑、本地的状态等，我想复用它们，我就可以创建个 mixins，让其他的组件扩展这个 mixins，就可以在这些新的组件里使用原本它们没有的方法了\n\n## 前端路由和后端路由\n\n对于路由这快的认知有一个盲点，好像都没有考虑过一直以来 jquery 等应用的页面的路由是怎么样的，webpack 管理的多页应用的路由又是怎么样实现的。\n\n## 后端路由\n\n对于普通的网站，所有超链接都是 URL 地址，所有 URL 地址都对应服务器上对应的资源。\n\n## 前端路由\n\n对于单页应用来说，主要通过 url 中的 hash（#号）来传值，来实现不同网页之间的切换。在单页面应用程序中，这种通过 hash 改变来切换页面的方式，称作前端路由（区别于后端路由）。\n\n### 前端路由实现\n\n#### Pjax(PushState+Ajax)\n\n原理：利用 ajax 请求替代了 a 标签的默认跳转，然后利用 html5 中的 API 修改了 url。\n\n**API：history.pushState 和 history.replaceSate。**\n\nhistory.pushState 和 history.replaceSate 是 HTML5 的新接口,他们可以做到改变网址却不需要刷新页面，这个特性后来就运用到了单页应用，比如：vue-router,react-router-dom 里面，pushSate 会增加一条新的历史记录，而 replaceState 则会替换当前的历史记录。（Ajax 可以实现页面的无刷新操作，于是，返回的时候，通过 url 或者其他传参，我们就可以还原到 Ajax 之前的模样）\n\n浏览器的前进和后退，会触发 window.onpopstate 事件，通过绑定 popstate 事件，就可以根据当前 url 地址中的查询内容让对应的菜单执行 Ajax 载入，实现 Ajax 的前进和后退效果。\n\n页面首次载入的时候，如果没有查询地址、或查询地址不匹配，则使用第一个菜单的 Ajax 地址的查询内容，并使用 history.replaceSate 更改当前的浏览器历史，然后触发 Ajax 操作。\n\n```javascript\nwindow.history.pushSate(null, null, 'name/blue')\nwindow.history.pushSate(null, null, 'name/orange')\n```\n\n#### Hjax(Hash+Ajax)\n\n原理：url 中常会出现# ，一可以表示锚点（如回到顶部的按钮的原理），而是路由里的锚点（hash）,web 服务器并不会解析 hash，也就是说#后的内容 web 服务都会自动忽略，但是 javascript 是可以通过 window.loacation.hash 读取到的，读取到路径加以解析之后就可以响应不同路径的逻辑处理。\n\n### 前端路由的缺陷\n\n使用浏览器的前进后退键时，会重新发出请求，没有合理的利用缓存。\n\n## vue 列表组件中的 key 的作用\n\n[官网解释](https://vuejs.bootcss.com/api/#%E7%89%B9%E6%AE%8A-attribute)\n\n在没有绑定 key 的情况下，并且在遍历模板简单的情况下（只读模式），会导致虚拟新旧节点对比更快，节点也会被复用，这种复用就是就地复用。但是现在 key 是必须要绑定的啊\n\n```html\n<div id=\"app\">\n  <div v-for=\"i in dataList\">{{ i }}</div>\n</div>\n<script>\n  var vm = new Vue({\n    el: '#app',\n    data: {\n      dataList: [1, 2, 3, 4, 5]\n    }\n  })\n</script>\n```\n\n以上的例子，v-for 的内容会生成以下的 dom 节点数组：\n\n```javascript\n;[\n  '<div>1</div>', // id： A\n  '<div>2</div>', // id:  B\n  '<div>3</div>', // id:  C\n  '<div>4</div>', // id:  D\n  '<div>5</div>' // id:  E\n]\n```\n\n改变 dataList 数据，进行数据位置替换，对比改变后的数据\n\n## 组件内导航之 beforeRouteUpdate 的使用\n\n使用场景：\n\n组件复用；路由跳转；\n\n```javascript\nbeforeRouteUpdate (to, from, next) {\n    // 在当前路由改变，但是该组件被复用时调用\n    // 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，\n    // 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。\n    // 可以访问组件实例 `this`\n  },\n```\n\n## $forceUpdate()\n\n迫使 Vue 实例重新 render 渲染虚拟 DOM，注意不是重新加载组件。结合 vue 生命周期，调用$forceUpdata 后只会触发 beforeUpdata 和 updata 这两个钩子函数，不会触发其他钩子函数。它仅仅影响实例本身和插入插槽内容的子组件，而不是所有子组件。暂时不知道使用场景，组件复用重新渲染有 key\n\n## $beforeDestroy\n\n当发生 A->B 路由跳转时，在 A 页面的$beforeDestroy 钩子函数并不在 B 页面的 beforeCreate 前面\n\n## v-pre\n\n用法：跳过这个元素和它的子元素的编译过程，可以用来显示原始 Mustache 标签，跳过大量指令的节点会加快编译\n\n```html\n<div id=\"demo\">\n  <span v-pre>{{message}}</span>\n  <span>{{message}}</span>\n</div>\n<script type=\"text/javascript\">\n  var app = new Vue({\n    el: '#demo',\n    data: {\n      message: 'hello vue'\n    }\n  })\n</script>\n```\n\n以上代码，第一个 span 里的内容不会被编译，显示为`{{message}}`\n\n## v-cloak 指令\n\n在 vue 渲染完制定的整个 DOM 后才进行显示，它必须和 css 样式一起使用\n\n在 vue 渲染完指定的整个 DOM 后才进行显示。它必须和 CSS 样式一起使用。\n\n```html\n[v-cloak]{ display:none; }\n<div v-cloak>{{message}}</div>\n```\n","source":"_posts/Vue小知识点运用.md","raw":"---\ntitle: Vue小知识点运用\ndate: 2019-07-09 14:56:06\ncategories: Vue\n---\n\nVue API 中的小知识点运用与总结\n\n<!--more-->\n\n## 状态共享\n\n随着组件的细化，就会遇到多组件状态共享的情况，Vuex 当然可以解决这些问题，但是如果应用不够大，为避免代码繁琐冗余，最好不要使用它。我们可以通过使用 Observable API 应对一些简单的跨组件数据状态共享的情况。\n\n### Observable\n\n让一个对象可响应。Vue 内部会用它来处理 data 函数返回的对象。可以实现简单的 store 管理。\n\n返回的对象可以直接在渲染函数和计算属性中使用，并在编译时触发适当的更新。它还可以用作简单场景的最小跨组件状态存储：\n\nstore.js\n\n```javascript\nimport vue from 'vue'\nexport const store = vue.observable({ count: 0 })\nexport const mutation = {\n  setCount(count) {\n    store.count = count\n  }\n}\n```\n\n应用组件：\n\n```html\n<template>\n  <div class=\"hello\">\n    <p @click=\"setCount(testCount + 1)\">+</p>\n    <p @click=\"setCount(testCount - 1)\">-</p>\n    <test />\n    <p>{{testCount}}</p>\n  </div>\n</template>\n\n<script>\n  import test from './test'\n  import { store, mutation } from '@/store'\n  export default {\n    name: 'HelloWorld',\n    data() {\n      return {\n        msg: 'Welcome to Your Vue.js App'\n      }\n    },\n    components: {\n      test\n    },\n    methods: {\n      setCount: mutation.setCount\n    },\n    computed: {\n      testCount() {\n        return store.count\n      }\n    }\n  }\n</script>\n```\n\ntest 组件\n\n```html\n<template>\n  <div>test{{testCount}}</div>\n</template>\n<script>\n  import { store } from '@/store'\n  export default {\n    computed: {\n      testCount() {\n        return store.count\n      }\n    }\n  }\n</script>\n```\n\n## 长列表性能优化\n\nvue 是通过 object.defineProperty 对数据进行劫持，来实现视图响应数据的变化，然而有些时候我们的组件就是纯粹的展示，不需要 vue 劫持我们的数据，在大量数据展示的情况下，这能够很明显的减少组件初始化的时间，**我们可以通过`object.freeze`方法来冻结一个对象，一旦被冻结的对象就再也不能被修改了**。\n\n```javascript\nexport default {\n  data: () => ({ user: {} }),\n  async created() {\n    const users = await axios.get('api/users')\n    this.users = Object.freeze(users)\n  }\n}\n```\n\n这里仅仅是冻结了 user 的值，引用不会被冻结，当我们需要 reactive 数据的时候，我们可以重新给 users 赋值。\n\n```html\nexport default { data: () => ({ users: [] }), async created() { const users =\nawait axios.get(\"/api/users\"); this.users = Object.freeze(users); }, methods: {\na() { //改变值不会触发视图响应 this.users[0] = newValue;\n//改变引用依然会触发视图响应 this.users = newValue; } } };\n```\n\n## 函数式组件\n\nApp.vue\n\n```html\n<template>\n  <div id=\"app\">\n    <List\n      :items=\"['Wonderwoman', 'Ironman']\"\n      :item-click=\"item => (clicked = item)\"\n    />\n    <p>Clicked hero: {{ clicked }}</p>\n  </div>\n</template>\n\n<script>\n  import List from './List'\n\n  export default {\n    name: 'App',\n    data: () => ({ clicked: '' }),\n    components: { List }\n  }\n</script>\n```\n\nList.vue\n\n```html\n<template functional>\n  <div>\n    <p v-for=\"item in props.items\" @click=\"props.itemClick(item);\">\n      {{ item }}\n    </p>\n  </div>\n</template>\n```\n\n## 监听组件的生命周期\n\n比如有父组件 Parent 和子组件 Child，如果父组件监听到子组件挂载 mounted 就做一些逻辑处理，常规写法可能如下：\n\n```html\n// Parent.vue\n<Child @mounted=\"doSomething\" />\n\n// Child.vue mounted() { this.$emit(\"mounted\"); }\n```\n\n## 混入\n\n分发 Vue 组件中的可复用功能\n当我们开发应用时，经常会遇到一些功能和逻辑，需要在不同的组件间多次使用，比如同样的方法逻辑，两个组件都要用到，但我们又不想也不应该完全复制两遍，这个时候就该用 mixins 了。\n这意味着，如果我创建了一个组件，它有 X 个不同的方法、周期逻辑、本地的状态等，我想复用它们，我就可以创建个 mixins，让其他的组件扩展这个 mixins，就可以在这些新的组件里使用原本它们没有的方法了\n\n## 前端路由和后端路由\n\n对于路由这快的认知有一个盲点，好像都没有考虑过一直以来 jquery 等应用的页面的路由是怎么样的，webpack 管理的多页应用的路由又是怎么样实现的。\n\n## 后端路由\n\n对于普通的网站，所有超链接都是 URL 地址，所有 URL 地址都对应服务器上对应的资源。\n\n## 前端路由\n\n对于单页应用来说，主要通过 url 中的 hash（#号）来传值，来实现不同网页之间的切换。在单页面应用程序中，这种通过 hash 改变来切换页面的方式，称作前端路由（区别于后端路由）。\n\n### 前端路由实现\n\n#### Pjax(PushState+Ajax)\n\n原理：利用 ajax 请求替代了 a 标签的默认跳转，然后利用 html5 中的 API 修改了 url。\n\n**API：history.pushState 和 history.replaceSate。**\n\nhistory.pushState 和 history.replaceSate 是 HTML5 的新接口,他们可以做到改变网址却不需要刷新页面，这个特性后来就运用到了单页应用，比如：vue-router,react-router-dom 里面，pushSate 会增加一条新的历史记录，而 replaceState 则会替换当前的历史记录。（Ajax 可以实现页面的无刷新操作，于是，返回的时候，通过 url 或者其他传参，我们就可以还原到 Ajax 之前的模样）\n\n浏览器的前进和后退，会触发 window.onpopstate 事件，通过绑定 popstate 事件，就可以根据当前 url 地址中的查询内容让对应的菜单执行 Ajax 载入，实现 Ajax 的前进和后退效果。\n\n页面首次载入的时候，如果没有查询地址、或查询地址不匹配，则使用第一个菜单的 Ajax 地址的查询内容，并使用 history.replaceSate 更改当前的浏览器历史，然后触发 Ajax 操作。\n\n```javascript\nwindow.history.pushSate(null, null, 'name/blue')\nwindow.history.pushSate(null, null, 'name/orange')\n```\n\n#### Hjax(Hash+Ajax)\n\n原理：url 中常会出现# ，一可以表示锚点（如回到顶部的按钮的原理），而是路由里的锚点（hash）,web 服务器并不会解析 hash，也就是说#后的内容 web 服务都会自动忽略，但是 javascript 是可以通过 window.loacation.hash 读取到的，读取到路径加以解析之后就可以响应不同路径的逻辑处理。\n\n### 前端路由的缺陷\n\n使用浏览器的前进后退键时，会重新发出请求，没有合理的利用缓存。\n\n## vue 列表组件中的 key 的作用\n\n[官网解释](https://vuejs.bootcss.com/api/#%E7%89%B9%E6%AE%8A-attribute)\n\n在没有绑定 key 的情况下，并且在遍历模板简单的情况下（只读模式），会导致虚拟新旧节点对比更快，节点也会被复用，这种复用就是就地复用。但是现在 key 是必须要绑定的啊\n\n```html\n<div id=\"app\">\n  <div v-for=\"i in dataList\">{{ i }}</div>\n</div>\n<script>\n  var vm = new Vue({\n    el: '#app',\n    data: {\n      dataList: [1, 2, 3, 4, 5]\n    }\n  })\n</script>\n```\n\n以上的例子，v-for 的内容会生成以下的 dom 节点数组：\n\n```javascript\n;[\n  '<div>1</div>', // id： A\n  '<div>2</div>', // id:  B\n  '<div>3</div>', // id:  C\n  '<div>4</div>', // id:  D\n  '<div>5</div>' // id:  E\n]\n```\n\n改变 dataList 数据，进行数据位置替换，对比改变后的数据\n\n## 组件内导航之 beforeRouteUpdate 的使用\n\n使用场景：\n\n组件复用；路由跳转；\n\n```javascript\nbeforeRouteUpdate (to, from, next) {\n    // 在当前路由改变，但是该组件被复用时调用\n    // 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，\n    // 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。\n    // 可以访问组件实例 `this`\n  },\n```\n\n## $forceUpdate()\n\n迫使 Vue 实例重新 render 渲染虚拟 DOM，注意不是重新加载组件。结合 vue 生命周期，调用$forceUpdata 后只会触发 beforeUpdata 和 updata 这两个钩子函数，不会触发其他钩子函数。它仅仅影响实例本身和插入插槽内容的子组件，而不是所有子组件。暂时不知道使用场景，组件复用重新渲染有 key\n\n## $beforeDestroy\n\n当发生 A->B 路由跳转时，在 A 页面的$beforeDestroy 钩子函数并不在 B 页面的 beforeCreate 前面\n\n## v-pre\n\n用法：跳过这个元素和它的子元素的编译过程，可以用来显示原始 Mustache 标签，跳过大量指令的节点会加快编译\n\n```html\n<div id=\"demo\">\n  <span v-pre>{{message}}</span>\n  <span>{{message}}</span>\n</div>\n<script type=\"text/javascript\">\n  var app = new Vue({\n    el: '#demo',\n    data: {\n      message: 'hello vue'\n    }\n  })\n</script>\n```\n\n以上代码，第一个 span 里的内容不会被编译，显示为`{{message}}`\n\n## v-cloak 指令\n\n在 vue 渲染完制定的整个 DOM 后才进行显示，它必须和 css 样式一起使用\n\n在 vue 渲染完指定的整个 DOM 后才进行显示。它必须和 CSS 样式一起使用。\n\n```html\n[v-cloak]{ display:none; }\n<div v-cloak>{{message}}</div>\n```\n","slug":"Vue小知识点运用","published":1,"updated":"2021-04-24T15:38:33.649Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wx0012l5v06uxibppo","content":"<p>Vue API 中的小知识点运用与总结</p>\n<span id=\"more\"></span>\n\n<h2 id=\"状态共享\"><a href=\"#状态共享\" class=\"headerlink\" title=\"状态共享\"></a>状态共享</h2><p>随着组件的细化，就会遇到多组件状态共享的情况，Vuex 当然可以解决这些问题，但是如果应用不够大，为避免代码繁琐冗余，最好不要使用它。我们可以通过使用 Observable API 应对一些简单的跨组件数据状态共享的情况。</p>\n<h3 id=\"Observable\"><a href=\"#Observable\" class=\"headerlink\" title=\"Observable\"></a>Observable</h3><p>让一个对象可响应。Vue 内部会用它来处理 data 函数返回的对象。可以实现简单的 store 管理。</p>\n<p>返回的对象可以直接在渲染函数和计算属性中使用，并在编译时触发适当的更新。它还可以用作简单场景的最小跨组件状态存储：</p>\n<p>store.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> vue <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> store = vue.observable(&#123; <span class=\"attr\">count</span>: <span class=\"number\">0</span> &#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> mutation = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">setCount</span>(<span class=\"params\">count</span>)</span> &#123;</span><br><span class=\"line\">    store.count = count</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>应用组件：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;hello&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;setCount(testCount + 1)&quot;</span>&gt;</span>+<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;setCount(testCount - 1)&quot;</span>&gt;</span>-<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">test</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;testCount&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">import</span> test <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./test&#x27;</span></span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">import</span> &#123; store, mutation &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/store&#x27;</span></span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    name: <span class=\"string\">&#x27;HelloWorld&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        msg: <span class=\"string\">&#x27;Welcome to Your Vue.js App&#x27;</span></span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    components: &#123;</span><br><span class=\"line\">      test</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">      setCount: mutation.setCount</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    computed: &#123;</span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"function\"><span class=\"title\">testCount</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> store.count</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>test 组件</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>test&#123;&#123;testCount&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">import</span> &#123; store &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/store&#x27;</span></span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\">    computed: &#123;</span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"function\"><span class=\"title\">testCount</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> store.count</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"长列表性能优化\"><a href=\"#长列表性能优化\" class=\"headerlink\" title=\"长列表性能优化\"></a>长列表性能优化</h2><p>vue 是通过 object.defineProperty 对数据进行劫持，来实现视图响应数据的变化，然而有些时候我们的组件就是纯粹的展示，不需要 vue 劫持我们的数据，在大量数据展示的情况下，这能够很明显的减少组件初始化的时间，<strong>我们可以通过<code>object.freeze</code>方法来冻结一个对象，一旦被冻结的对象就再也不能被修改了</strong>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  data: <span class=\"function\">() =&gt;</span> (&#123; <span class=\"attr\">user</span>: &#123;&#125; &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">created</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> users = <span class=\"keyword\">await</span> axios.get(<span class=\"string\">&#x27;api/users&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.users = <span class=\"built_in\">Object</span>.freeze(users)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里仅仅是冻结了 user 的值，引用不会被冻结，当我们需要 reactive 数据的时候，我们可以重新给 users 赋值。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export default &#123; data: () =&gt; (&#123; users: [] &#125;), async created() &#123; const users =</span><br><span class=\"line\">await axios.get(&quot;/api/users&quot;); this.users = Object.freeze(users); &#125;, methods: &#123;</span><br><span class=\"line\">a() &#123; //改变值不会触发视图响应 this.users[0] = newValue;</span><br><span class=\"line\">//改变引用依然会触发视图响应 this.users = newValue; &#125; &#125; &#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"函数式组件\"><a href=\"#函数式组件\" class=\"headerlink\" title=\"函数式组件\"></a>函数式组件</h2><p>App.vue</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    &lt;List</span><br><span class=\"line\">      :items=&quot;[&#x27;Wonderwoman&#x27;, &#x27;Ironman&#x27;]&quot;</span><br><span class=\"line\">      :item-click=&quot;item =&gt; (clicked = item)&quot;</span><br><span class=\"line\">    /&gt;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Clicked hero: &#123;&#123; clicked &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">import</span> List <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./List&#x27;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    name: <span class=\"string\">&#x27;App&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">    data: <span class=\"function\">() =&gt;</span> (&#123; <span class=\"attr\">clicked</span>: <span class=\"string\">&#x27;&#x27;</span> &#125;),</span></span><br><span class=\"line\">    components: &#123; List &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>List.vue</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">functional</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in props.items&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;props.itemClick(item);&quot;</span>&gt;</span></span><br><span class=\"line\">      &#123;&#123; item &#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"监听组件的生命周期\"><a href=\"#监听组件的生命周期\" class=\"headerlink\" title=\"监听组件的生命周期\"></a>监听组件的生命周期</h2><p>比如有父组件 Parent 和子组件 Child，如果父组件监听到子组件挂载 mounted 就做一些逻辑处理，常规写法可能如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Parent.vue</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Child</span> @<span class=\"attr\">mounted</span>=<span class=\"string\">&quot;doSomething&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">// Child.vue mounted() &#123; this.$emit(&quot;mounted&quot;); &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"混入\"><a href=\"#混入\" class=\"headerlink\" title=\"混入\"></a>混入</h2><p>分发 Vue 组件中的可复用功能<br>当我们开发应用时，经常会遇到一些功能和逻辑，需要在不同的组件间多次使用，比如同样的方法逻辑，两个组件都要用到，但我们又不想也不应该完全复制两遍，这个时候就该用 mixins 了。<br>这意味着，如果我创建了一个组件，它有 X 个不同的方法、周期逻辑、本地的状态等，我想复用它们，我就可以创建个 mixins，让其他的组件扩展这个 mixins，就可以在这些新的组件里使用原本它们没有的方法了</p>\n<h2 id=\"前端路由和后端路由\"><a href=\"#前端路由和后端路由\" class=\"headerlink\" title=\"前端路由和后端路由\"></a>前端路由和后端路由</h2><p>对于路由这快的认知有一个盲点，好像都没有考虑过一直以来 jquery 等应用的页面的路由是怎么样的，webpack 管理的多页应用的路由又是怎么样实现的。</p>\n<h2 id=\"后端路由\"><a href=\"#后端路由\" class=\"headerlink\" title=\"后端路由\"></a>后端路由</h2><p>对于普通的网站，所有超链接都是 URL 地址，所有 URL 地址都对应服务器上对应的资源。</p>\n<h2 id=\"前端路由\"><a href=\"#前端路由\" class=\"headerlink\" title=\"前端路由\"></a>前端路由</h2><p>对于单页应用来说，主要通过 url 中的 hash（#号）来传值，来实现不同网页之间的切换。在单页面应用程序中，这种通过 hash 改变来切换页面的方式，称作前端路由（区别于后端路由）。</p>\n<h3 id=\"前端路由实现\"><a href=\"#前端路由实现\" class=\"headerlink\" title=\"前端路由实现\"></a>前端路由实现</h3><h4 id=\"Pjax-PushState-Ajax\"><a href=\"#Pjax-PushState-Ajax\" class=\"headerlink\" title=\"Pjax(PushState+Ajax)\"></a>Pjax(PushState+Ajax)</h4><p>原理：利用 ajax 请求替代了 a 标签的默认跳转，然后利用 html5 中的 API 修改了 url。</p>\n<p><strong>API：history.pushState 和 history.replaceSate。</strong></p>\n<p>history.pushState 和 history.replaceSate 是 HTML5 的新接口,他们可以做到改变网址却不需要刷新页面，这个特性后来就运用到了单页应用，比如：vue-router,react-router-dom 里面，pushSate 会增加一条新的历史记录，而 replaceState 则会替换当前的历史记录。（Ajax 可以实现页面的无刷新操作，于是，返回的时候，通过 url 或者其他传参，我们就可以还原到 Ajax 之前的模样）</p>\n<p>浏览器的前进和后退，会触发 window.onpopstate 事件，通过绑定 popstate 事件，就可以根据当前 url 地址中的查询内容让对应的菜单执行 Ajax 载入，实现 Ajax 的前进和后退效果。</p>\n<p>页面首次载入的时候，如果没有查询地址、或查询地址不匹配，则使用第一个菜单的 Ajax 地址的查询内容，并使用 history.replaceSate 更改当前的浏览器历史，然后触发 Ajax 操作。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.history.pushSate(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"string\">&#x27;name/blue&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">window</span>.history.pushSate(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"string\">&#x27;name/orange&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Hjax-Hash-Ajax\"><a href=\"#Hjax-Hash-Ajax\" class=\"headerlink\" title=\"Hjax(Hash+Ajax)\"></a>Hjax(Hash+Ajax)</h4><p>原理：url 中常会出现# ，一可以表示锚点（如回到顶部的按钮的原理），而是路由里的锚点（hash）,web 服务器并不会解析 hash，也就是说#后的内容 web 服务都会自动忽略，但是 javascript 是可以通过 window.loacation.hash 读取到的，读取到路径加以解析之后就可以响应不同路径的逻辑处理。</p>\n<h3 id=\"前端路由的缺陷\"><a href=\"#前端路由的缺陷\" class=\"headerlink\" title=\"前端路由的缺陷\"></a>前端路由的缺陷</h3><p>使用浏览器的前进后退键时，会重新发出请求，没有合理的利用缓存。</p>\n<h2 id=\"vue-列表组件中的-key-的作用\"><a href=\"#vue-列表组件中的-key-的作用\" class=\"headerlink\" title=\"vue 列表组件中的 key 的作用\"></a>vue 列表组件中的 key 的作用</h2><p><a href=\"https://vuejs.bootcss.com/api/#%E7%89%B9%E6%AE%8A-attribute\">官网解释</a></p>\n<p>在没有绑定 key 的情况下，并且在遍历模板简单的情况下（只读模式），会导致虚拟新旧节点对比更快，节点也会被复用，这种复用就是就地复用。但是现在 key 是必须要绑定的啊</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;i in dataList&quot;</span>&gt;</span>&#123;&#123; i &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      dataList: [1, 2, 3, 4, 5]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>以上的例子，v-for 的内容会生成以下的 dom 节点数组：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;[</span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;1&lt;/div&gt;&#x27;</span>, <span class=\"comment\">// id： A</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;2&lt;/div&gt;&#x27;</span>, <span class=\"comment\">// id:  B</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;3&lt;/div&gt;&#x27;</span>, <span class=\"comment\">// id:  C</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;4&lt;/div&gt;&#x27;</span>, <span class=\"comment\">// id:  D</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;5&lt;/div&gt;&#x27;</span> <span class=\"comment\">// id:  E</span></span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>改变 dataList 数据，进行数据位置替换，对比改变后的数据</p>\n<h2 id=\"组件内导航之-beforeRouteUpdate-的使用\"><a href=\"#组件内导航之-beforeRouteUpdate-的使用\" class=\"headerlink\" title=\"组件内导航之 beforeRouteUpdate 的使用\"></a>组件内导航之 beforeRouteUpdate 的使用</h2><p>使用场景：</p>\n<p>组件复用；路由跳转；</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beforeRouteUpdate (to, <span class=\"keyword\">from</span>, next) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 在当前路由改变，但是该组件被复用时调用</span></span><br><span class=\"line\">    <span class=\"comment\">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，</span></span><br><span class=\"line\">    <span class=\"comment\">// 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以访问组件实例 `this`</span></span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"forceUpdate\"><a href=\"#forceUpdate\" class=\"headerlink\" title=\"$forceUpdate()\"></a>$forceUpdate()</h2><p>迫使 Vue 实例重新 render 渲染虚拟 DOM，注意不是重新加载组件。结合 vue 生命周期，调用$forceUpdata 后只会触发 beforeUpdata 和 updata 这两个钩子函数，不会触发其他钩子函数。它仅仅影响实例本身和插入插槽内容的子组件，而不是所有子组件。暂时不知道使用场景，组件复用重新渲染有 key</p>\n<h2 id=\"beforeDestroy\"><a href=\"#beforeDestroy\" class=\"headerlink\" title=\"$beforeDestroy\"></a>$beforeDestroy</h2><p>当发生 A-&gt;B 路由跳转时，在 A 页面的$beforeDestroy 钩子函数并不在 B 页面的 beforeCreate 前面</p>\n<h2 id=\"v-pre\"><a href=\"#v-pre\" class=\"headerlink\" title=\"v-pre\"></a>v-pre</h2><p>用法：跳过这个元素和它的子元素的编译过程，可以用来显示原始 Mustache 标签，跳过大量指令的节点会加快编译</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;demo&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-pre</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    el: <span class=\"string\">&#x27;#demo&#x27;</span>,</span></span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">      message: <span class=\"string\">&#x27;hello vue&#x27;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>以上代码，第一个 span 里的内容不会被编译，显示为<code>&#123;&#123;message&#125;&#125;</code></p>\n<h2 id=\"v-cloak-指令\"><a href=\"#v-cloak-指令\" class=\"headerlink\" title=\"v-cloak 指令\"></a>v-cloak 指令</h2><p>在 vue 渲染完制定的整个 DOM 后才进行显示，它必须和 css 样式一起使用</p>\n<p>在 vue 渲染完指定的整个 DOM 后才进行显示。它必须和 CSS 样式一起使用。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[v-cloak]&#123; display:none; &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-cloak</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>Vue API 中的小知识点运用与总结</p>","more":"<h2 id=\"状态共享\"><a href=\"#状态共享\" class=\"headerlink\" title=\"状态共享\"></a>状态共享</h2><p>随着组件的细化，就会遇到多组件状态共享的情况，Vuex 当然可以解决这些问题，但是如果应用不够大，为避免代码繁琐冗余，最好不要使用它。我们可以通过使用 Observable API 应对一些简单的跨组件数据状态共享的情况。</p>\n<h3 id=\"Observable\"><a href=\"#Observable\" class=\"headerlink\" title=\"Observable\"></a>Observable</h3><p>让一个对象可响应。Vue 内部会用它来处理 data 函数返回的对象。可以实现简单的 store 管理。</p>\n<p>返回的对象可以直接在渲染函数和计算属性中使用，并在编译时触发适当的更新。它还可以用作简单场景的最小跨组件状态存储：</p>\n<p>store.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> vue <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> store = vue.observable(&#123; <span class=\"attr\">count</span>: <span class=\"number\">0</span> &#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> mutation = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">setCount</span>(<span class=\"params\">count</span>)</span> &#123;</span><br><span class=\"line\">    store.count = count</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>应用组件：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;hello&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;setCount(testCount + 1)&quot;</span>&gt;</span>+<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;setCount(testCount - 1)&quot;</span>&gt;</span>-<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">test</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;testCount&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">import</span> test <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./test&#x27;</span></span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">import</span> &#123; store, mutation &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/store&#x27;</span></span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    name: <span class=\"string\">&#x27;HelloWorld&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        msg: <span class=\"string\">&#x27;Welcome to Your Vue.js App&#x27;</span></span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    components: &#123;</span><br><span class=\"line\">      test</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    methods: &#123;</span><br><span class=\"line\">      setCount: mutation.setCount</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    computed: &#123;</span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"function\"><span class=\"title\">testCount</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> store.count</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>test 组件</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>test&#123;&#123;testCount&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">import</span> &#123; store &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/store&#x27;</span></span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\">    computed: &#123;</span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"function\"><span class=\"title\">testCount</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> store.count</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"长列表性能优化\"><a href=\"#长列表性能优化\" class=\"headerlink\" title=\"长列表性能优化\"></a>长列表性能优化</h2><p>vue 是通过 object.defineProperty 对数据进行劫持，来实现视图响应数据的变化，然而有些时候我们的组件就是纯粹的展示，不需要 vue 劫持我们的数据，在大量数据展示的情况下，这能够很明显的减少组件初始化的时间，<strong>我们可以通过<code>object.freeze</code>方法来冻结一个对象，一旦被冻结的对象就再也不能被修改了</strong>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  data: <span class=\"function\">() =&gt;</span> (&#123; <span class=\"attr\">user</span>: &#123;&#125; &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">created</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> users = <span class=\"keyword\">await</span> axios.get(<span class=\"string\">&#x27;api/users&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.users = <span class=\"built_in\">Object</span>.freeze(users)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里仅仅是冻结了 user 的值，引用不会被冻结，当我们需要 reactive 数据的时候，我们可以重新给 users 赋值。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export default &#123; data: () =&gt; (&#123; users: [] &#125;), async created() &#123; const users =</span><br><span class=\"line\">await axios.get(&quot;/api/users&quot;); this.users = Object.freeze(users); &#125;, methods: &#123;</span><br><span class=\"line\">a() &#123; //改变值不会触发视图响应 this.users[0] = newValue;</span><br><span class=\"line\">//改变引用依然会触发视图响应 this.users = newValue; &#125; &#125; &#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"函数式组件\"><a href=\"#函数式组件\" class=\"headerlink\" title=\"函数式组件\"></a>函数式组件</h2><p>App.vue</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    &lt;List</span><br><span class=\"line\">      :items=&quot;[&#x27;Wonderwoman&#x27;, &#x27;Ironman&#x27;]&quot;</span><br><span class=\"line\">      :item-click=&quot;item =&gt; (clicked = item)&quot;</span><br><span class=\"line\">    /&gt;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Clicked hero: &#123;&#123; clicked &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">import</span> List <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./List&#x27;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    name: <span class=\"string\">&#x27;App&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">    data: <span class=\"function\">() =&gt;</span> (&#123; <span class=\"attr\">clicked</span>: <span class=\"string\">&#x27;&#x27;</span> &#125;),</span></span><br><span class=\"line\">    components: &#123; List &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>List.vue</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">functional</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in props.items&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;props.itemClick(item);&quot;</span>&gt;</span></span><br><span class=\"line\">      &#123;&#123; item &#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"监听组件的生命周期\"><a href=\"#监听组件的生命周期\" class=\"headerlink\" title=\"监听组件的生命周期\"></a>监听组件的生命周期</h2><p>比如有父组件 Parent 和子组件 Child，如果父组件监听到子组件挂载 mounted 就做一些逻辑处理，常规写法可能如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Parent.vue</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Child</span> @<span class=\"attr\">mounted</span>=<span class=\"string\">&quot;doSomething&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">// Child.vue mounted() &#123; this.$emit(&quot;mounted&quot;); &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"混入\"><a href=\"#混入\" class=\"headerlink\" title=\"混入\"></a>混入</h2><p>分发 Vue 组件中的可复用功能<br>当我们开发应用时，经常会遇到一些功能和逻辑，需要在不同的组件间多次使用，比如同样的方法逻辑，两个组件都要用到，但我们又不想也不应该完全复制两遍，这个时候就该用 mixins 了。<br>这意味着，如果我创建了一个组件，它有 X 个不同的方法、周期逻辑、本地的状态等，我想复用它们，我就可以创建个 mixins，让其他的组件扩展这个 mixins，就可以在这些新的组件里使用原本它们没有的方法了</p>\n<h2 id=\"前端路由和后端路由\"><a href=\"#前端路由和后端路由\" class=\"headerlink\" title=\"前端路由和后端路由\"></a>前端路由和后端路由</h2><p>对于路由这快的认知有一个盲点，好像都没有考虑过一直以来 jquery 等应用的页面的路由是怎么样的，webpack 管理的多页应用的路由又是怎么样实现的。</p>\n<h2 id=\"后端路由\"><a href=\"#后端路由\" class=\"headerlink\" title=\"后端路由\"></a>后端路由</h2><p>对于普通的网站，所有超链接都是 URL 地址，所有 URL 地址都对应服务器上对应的资源。</p>\n<h2 id=\"前端路由\"><a href=\"#前端路由\" class=\"headerlink\" title=\"前端路由\"></a>前端路由</h2><p>对于单页应用来说，主要通过 url 中的 hash（#号）来传值，来实现不同网页之间的切换。在单页面应用程序中，这种通过 hash 改变来切换页面的方式，称作前端路由（区别于后端路由）。</p>\n<h3 id=\"前端路由实现\"><a href=\"#前端路由实现\" class=\"headerlink\" title=\"前端路由实现\"></a>前端路由实现</h3><h4 id=\"Pjax-PushState-Ajax\"><a href=\"#Pjax-PushState-Ajax\" class=\"headerlink\" title=\"Pjax(PushState+Ajax)\"></a>Pjax(PushState+Ajax)</h4><p>原理：利用 ajax 请求替代了 a 标签的默认跳转，然后利用 html5 中的 API 修改了 url。</p>\n<p><strong>API：history.pushState 和 history.replaceSate。</strong></p>\n<p>history.pushState 和 history.replaceSate 是 HTML5 的新接口,他们可以做到改变网址却不需要刷新页面，这个特性后来就运用到了单页应用，比如：vue-router,react-router-dom 里面，pushSate 会增加一条新的历史记录，而 replaceState 则会替换当前的历史记录。（Ajax 可以实现页面的无刷新操作，于是，返回的时候，通过 url 或者其他传参，我们就可以还原到 Ajax 之前的模样）</p>\n<p>浏览器的前进和后退，会触发 window.onpopstate 事件，通过绑定 popstate 事件，就可以根据当前 url 地址中的查询内容让对应的菜单执行 Ajax 载入，实现 Ajax 的前进和后退效果。</p>\n<p>页面首次载入的时候，如果没有查询地址、或查询地址不匹配，则使用第一个菜单的 Ajax 地址的查询内容，并使用 history.replaceSate 更改当前的浏览器历史，然后触发 Ajax 操作。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.history.pushSate(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"string\">&#x27;name/blue&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">window</span>.history.pushSate(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>, <span class=\"string\">&#x27;name/orange&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Hjax-Hash-Ajax\"><a href=\"#Hjax-Hash-Ajax\" class=\"headerlink\" title=\"Hjax(Hash+Ajax)\"></a>Hjax(Hash+Ajax)</h4><p>原理：url 中常会出现# ，一可以表示锚点（如回到顶部的按钮的原理），而是路由里的锚点（hash）,web 服务器并不会解析 hash，也就是说#后的内容 web 服务都会自动忽略，但是 javascript 是可以通过 window.loacation.hash 读取到的，读取到路径加以解析之后就可以响应不同路径的逻辑处理。</p>\n<h3 id=\"前端路由的缺陷\"><a href=\"#前端路由的缺陷\" class=\"headerlink\" title=\"前端路由的缺陷\"></a>前端路由的缺陷</h3><p>使用浏览器的前进后退键时，会重新发出请求，没有合理的利用缓存。</p>\n<h2 id=\"vue-列表组件中的-key-的作用\"><a href=\"#vue-列表组件中的-key-的作用\" class=\"headerlink\" title=\"vue 列表组件中的 key 的作用\"></a>vue 列表组件中的 key 的作用</h2><p><a href=\"https://vuejs.bootcss.com/api/#%E7%89%B9%E6%AE%8A-attribute\">官网解释</a></p>\n<p>在没有绑定 key 的情况下，并且在遍历模板简单的情况下（只读模式），会导致虚拟新旧节点对比更快，节点也会被复用，这种复用就是就地复用。但是现在 key 是必须要绑定的啊</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;i in dataList&quot;</span>&gt;</span>&#123;&#123; i &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    el: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      dataList: [1, 2, 3, 4, 5]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>以上的例子，v-for 的内容会生成以下的 dom 节点数组：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;[</span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;1&lt;/div&gt;&#x27;</span>, <span class=\"comment\">// id： A</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;2&lt;/div&gt;&#x27;</span>, <span class=\"comment\">// id:  B</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;3&lt;/div&gt;&#x27;</span>, <span class=\"comment\">// id:  C</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;4&lt;/div&gt;&#x27;</span>, <span class=\"comment\">// id:  D</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;&lt;div&gt;5&lt;/div&gt;&#x27;</span> <span class=\"comment\">// id:  E</span></span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>改变 dataList 数据，进行数据位置替换，对比改变后的数据</p>\n<h2 id=\"组件内导航之-beforeRouteUpdate-的使用\"><a href=\"#组件内导航之-beforeRouteUpdate-的使用\" class=\"headerlink\" title=\"组件内导航之 beforeRouteUpdate 的使用\"></a>组件内导航之 beforeRouteUpdate 的使用</h2><p>使用场景：</p>\n<p>组件复用；路由跳转；</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beforeRouteUpdate (to, <span class=\"keyword\">from</span>, next) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 在当前路由改变，但是该组件被复用时调用</span></span><br><span class=\"line\">    <span class=\"comment\">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，</span></span><br><span class=\"line\">    <span class=\"comment\">// 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以访问组件实例 `this`</span></span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"forceUpdate\"><a href=\"#forceUpdate\" class=\"headerlink\" title=\"$forceUpdate()\"></a>$forceUpdate()</h2><p>迫使 Vue 实例重新 render 渲染虚拟 DOM，注意不是重新加载组件。结合 vue 生命周期，调用$forceUpdata 后只会触发 beforeUpdata 和 updata 这两个钩子函数，不会触发其他钩子函数。它仅仅影响实例本身和插入插槽内容的子组件，而不是所有子组件。暂时不知道使用场景，组件复用重新渲染有 key</p>\n<h2 id=\"beforeDestroy\"><a href=\"#beforeDestroy\" class=\"headerlink\" title=\"$beforeDestroy\"></a>$beforeDestroy</h2><p>当发生 A-&gt;B 路由跳转时，在 A 页面的$beforeDestroy 钩子函数并不在 B 页面的 beforeCreate 前面</p>\n<h2 id=\"v-pre\"><a href=\"#v-pre\" class=\"headerlink\" title=\"v-pre\"></a>v-pre</h2><p>用法：跳过这个元素和它的子元素的编译过程，可以用来显示原始 Mustache 标签，跳过大量指令的节点会加快编译</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;demo&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-pre</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    el: <span class=\"string\">&#x27;#demo&#x27;</span>,</span></span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">      message: <span class=\"string\">&#x27;hello vue&#x27;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>以上代码，第一个 span 里的内容不会被编译，显示为<code>&#123;&#123;message&#125;&#125;</code></p>\n<h2 id=\"v-cloak-指令\"><a href=\"#v-cloak-指令\" class=\"headerlink\" title=\"v-cloak 指令\"></a>v-cloak 指令</h2><p>在 vue 渲染完制定的整个 DOM 后才进行显示，它必须和 css 样式一起使用</p>\n<p>在 vue 渲染完指定的整个 DOM 后才进行显示。它必须和 CSS 样式一起使用。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[v-cloak]&#123; display:none; &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-cloak</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"angular 基础","date":"2017-09-08T03:30:11.000Z","_content":"\n## angular 与 vue 的区别\n\n* angular2 全部采用 TypeScript 编写，TypeScript （编译工具），它为 JS 带来了类似于 Java 和 C# 的静态类型，\n* vue 的双向绑定基于 ES5 的 getter/setter 来实现的，而 angular 是由自己实现一套模板编译规则们需要进行 “ 脏 ” 检查，而 vue 不需要，因此 vue 在性能上更高效。\n* angular 中，当 watcher 越来越多时会越来越慢，因为作用域的每一次变化\n\n<!--more-->\n\n## angular\n\n* 组件化，数据的单向中心。es6 的语法。angular.js 是通过脏值检测的方式比对数据是否有变更，来决定是否更新视图，最简单的方式就是通过 setInterval() 定时轮询检测数据变动，当然 Google 不会这么 low，angular 只有在指定的事件触发时进入脏值检测，大致如下：\n* DOM 事件，譬如用户输入文本，点击按钮等。( ng-click )\n* XHR 响应事件 ( $http )\n* 浏览器 Location 变更事件 ( $location )\n* Timer 事件 ( $timeout , $interval )\n* 执行 $digest() 或 $apply()\n\n## react\n\n* 速度很快：来源于虚拟 DOM，只有在调用 get 和 set 的时候才会更新 DOM，而且是先更新虚拟 DOM 再更新实际的 DOM，由此更新 DOM 的次数少内容也会少很多。\n* FLUX 架构，react 更关注 UI 的组件化和数据的单向更新。可以直接有 es6 的一些语法。\n* 服务器端渲染，单页应用的缺陷是对于搜索引擎有很大的限制。react 的解决的方案是在服务器上预渲染应用然后发送到服务端，但是爬虫是依赖的服务端的响应而不是 web 的执行。\n* 目标是 UI。\n* 本身是一个 MVC 中的 V。\n\n---\n\n## Angular 为表单内置了 4 种 css 样式\n\n* ng-valid 校验合法状态\n* ng-invalid 校验非法状态\n* ng-pristine 如果要使用原生的 form，需要设置这个值\n* ng-dirty 表单处于脏数据状态\n\n---\n\n## @Component\n\n* @Component 是 Angular 提供的装饰函数，用来描述 Component 的元数据\n* selector 指这个组件在 HTML 模板中的标签是什么\n* template 是嵌入（inline ）的 HTML 模板，如果使用单独文件可用 templateUrl。\n* styles 是嵌入（inline ）的 CSS 样式，如果使用单独文件可用 styleUrls。\n* providers 列出会在此模块中 “ 注入 ” 的服务 (service)- 依赖注入\n* bootstrap 指明哪个组件为引导组件 ( 比如 AppComponent), 当 angular 引导应用时，它会在 Dom 中渲染这个引导性组件，并把结果放进 index.html 的该组件的标签中。\n\n## @NgModule\n\n@NgModule 装饰器用来为模块定义元数据。declarations 列出了应用中的顶层组件，在 module 里面声明的组件在 module 范围内都可以直接使用，也就是说在同一 module 里面的任何 Component 都可以在其模板文件中直接使用声明的组件，就想我们在 AppComponent 的模板末尾加上 <app-login></app-login> 一样。\n\n```javascript\nimport { HttpModule } from '@angular/http'\n\nimport { AppComponent } from './app.component'\nimport { LoginComponent } from './login/login.component'\n\n@NgModule({\n  declarations: [AppComponent, LoginComponent],\n  imports: [BrowserModule, FormsModule, HttpModule],\n  providers: [],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {}\n```\n\nNgModule 装饰器用来为模块定义元数据。\n\n* declarations 列出了应用中的顶层组件。\n* BrowerModule 提供了运行在浏览器中的应用所需要的关键服务 (service) 和指令 (Directive), 这个模块所在需要在浏览器中跑的应用都应用引用。\n* FormsModule 提供了表单处理和双向绑定等服务和指令。\n* HttpModule 提供 Htpp 请求和响应的服务。\n* providers 列出会在此模版中 “ 注入 ” 的服务（service ）。\n* bootstrap 指明哪个组件为引导性组件，并把结果放到 index.html 的该组件的元素标签中。\n* 静态引导 AppModuleNgFactory platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);\n\n---\n\n## 依赖注入\n\n如果不使用依赖注入，则需要 // 声明成员变量，其类型为 service 里面自定义的方法\n\n    ```javascript\n    //第一种：\n    service:AuthService;\n\n    constructor(){\n        this.service = new AuthService();//在构造中初始化service\n    }\n    //第二种：\n\n    providers: [\n    {provide: 'auth',  useClass: AuthService}\n    ]\n    ```\n\n* 第一种：由于实例化是在组件中进行的，意味着我们如果更改 service 的构造函数的话，组件也需要更改。如果使用依赖注入的话，就不需要显示声明成员变量 service。当 import 相关的服务后，这是 import 将类型引入进来，而 provider 里面会配置这个类型的实例。\n* provider 是一个数组，这里配置将要注入到其他组件中的服务配置。provide 定义了这个服务的名称，有需要注入这个服务的就引用这个名称就好。useClass 指明这个名称对应的服务是一个类。这样定义之后就能在任意组件中注入这个依赖了。\n\n```javascript\n       onstructor(@Inject('auth') private service) {\n   }\n```\n\n* @inject('auth'), 这个修饰符的意思是请到系统配置中找到名称为 auth 的那个依赖注入到我修饰的变量中。\n\n## 双向数据绑定\n\n* [(ngModel)]=\"username\" ,[] 的作用是将等号后面当成表达式来解析而不是当成字符串，如果去掉 [] 就是将 ngModel 赋值成 username 这个字符串。[] 的含义是单向绑定，就是将组件中给 model 赋的值会设置到 HTML 的 input 控件中。[()]是双向绑定。ngModel 是 FormModule 中提供的指令，它负责从 Domain Model 中创建一个 FormControl 的实例，并将这个实例和表单控件绑定 .\n* @Input() 是输入型绑定的修饰符，用于从数据从父组件传到子组件。\n\n---\n\n## 表单验证\n\n```html\n    <div>\n        <input required type=\"text\"\n            [(ngModel)]=\"username\"\n            #usernameRef=\"ngModel\"\n            />\n            {{usernameRef.valid}}\n        <input required type=\"password\"\n            [(ngModel)]=\"password\"\n            #passwordRef=\"ngModel\"\n            />\n            {{passwordRef.valid}}\n        <button (click)=\"onClick()\">Login</button>\n        </div>\n        <div>\n        <input #usernameRef type=\"text\">\n        <button (click)=\"onClick(usernameRef.value)\">Login</button>\n        </div>\n```\n\n1. 通过 #usernameRef = 'ngModel' 重新加入了引用，这个引用指向了 ngModel, 这个引用是要在模板中使用的所以加入这个引用。\n2. 在输入框中加入 #usernameRef，这个叫引用，引用的是 input 对象，如果想要传递 input 的值，可以用 usernameRef.value.\n\n```html\n    <div>\n        <input type=\"text\"\n            [(ngModel)]=\"username\"\n            #usernameRef=\"ngModel\"\n            required\n            minlength=\"3\"\n            />\n            {{ usernameRef.errors | json }}\n            <div *ngIf=\"usernameRef.errors?.required\">this is required</div>\n            <div *ngIf=\"usernameRef.errors?.minlength\">should be at least 3 charactors</div>\n        <input required type=\"password\"\n            [(ngModel)]=\"password\"\n            #passwordRef=\"ngModel\"\n            />\n            <div *ngIf=\"passwordRef.errors?.required\">this is required</div>\n        <button (click)=\"onClick()\">Login</button>\n    </div>\n```\n\n\\*ngIf = \"usernameRef.error?.required\" 的意思是当 usernameRef.error.required 为 true 的时候显示 div 标签\n\n```html\n    <div>\n        <form #formRef=\"ngForm\" (ngSubmit)=\"onSubmit(formRef.value)\">\n        <fieldset ngModelGroup=\"login\">\n            <input type=\"text\"\n            name=\"username\"\n            [(ngModel)]=\"username\"\n            #usernameRef=\"ngModel\"\n            required\n            minlength=\"3\"\n            />\n            <div *ngIf=\"usernameRef.errors?.required\">this is required</div>\n            <div *ngIf=\"usernameRef.errors?.minlength\">should be at least 3 charactors</div>\n            <input type=\"password\"\n            name=\"password\"\n            [(ngModel)]=\"password\"\n            #passwordRef=\"ngModel\"\n            required\n            />\n            <div *ngIf=\"passwordRef.errors?.required\">this is required</div>\n            <button (click)=\"onClick()\">Login</button>\n            <button type=\"submit\">Submit</button>\n            </fieldset>\n        </form>\n        </div>\n```\n\n* ngModel 会注册成 Form 的子控件，注册控件需要 name ，这个要求我们显示的指定对应控件的 name ，因此需要为 input 增加 name 属性，在 formREF.value 中包含了表单所有填写项的值\n\n* 有时在表单相中表单项过多时，就使用 HTML 中的 fieldset 标签用来处理。<fieldset ngModelGroup=\"login\"> 意味着我们对于 fieldset 之内的数据都分组到了 login 对象中。\n\n---\n\n## 路由\n\n路径配置的顺序是非常重要的，angular2 使用 “ 先匹配优先 ” 的原则。\n\n* redirectTo 重定向\n  ## service\n\n```javascript\n    //post /todos\n    addTodo(desc:string):Promise<Todo>{\n        let todo={\n            id:UUID.UUID(),\n            desc:desc,\n            completed:false\n        };\n        return this.http\n            .post(this.api_url,JSON.stringfy(todo),{header:this.headers})\n            .toPromise()\n            .then(res=>res.json().data as Todo)\n            .catch(this.handleError);\n    }\n```\n\n---\n\n````javascript\n    inputValue: string = '';\n    @Input() placeholder: string = 'What needs to be done?';\n    @Input() delay: number = 300;\n\n    //detect the input value and output this to parent\n    @Output() textChanges = new EventEmitter<string>();\n    //detect the enter keyup event and output this to parent\n    @Output() onEnterUp = new EventEmitter<boolean>();\n    ```\n- placeholder和delay作为2个输入型变量，这样在引入标签中就可以设置这两个属性了。\n- 由@Output修饰的onTextChanges 和 onEnterUp，这两个变量都定义了EventEmitter(事件发射器)。\n- export const routing = RouterModule.forChild(routes);，用的是forChild而不是forRoot,因为forRoot只能用于根目录，所有非跟模块的其他模块都只能用forChild.\n\n\n--------------------------\n## 验证用户帐户的流程\n- UserService:用于通过用户名查找用户并返回用户\n- AuthService:用于认证用户，其中需要利用UserService 的方法。\n- AuthGuard:路由拦截器，用于拦截到路由后通过Authservice来知道此用户是否有权限访问路由。根据结果导航到不同路径。\n- @SkipSelf装饰器意味着在当前注入器的所有祖先注入器中寻找，如果注入器找不到想要的提供商时就会抛出一个错误。但是@Optional装饰器表示找不到该服务则会返回null,\nparentModule参数也就被赋值为空。\n\n----------------\n## 路由守卫\n应用场景如下:\n该用户可能无权导航到目标组件。导航前需要用户先登录。\n\n路由器支持多种守卫：\n\n- 用CanActivate来处理导航到某路由的情况。\n- 用CanActivateChild处理导航到子路由的情况。\n- 用CanDeactivate来处理从当前路由离开的情况。\n- 用Resolve在路由激活之前获取路由数据。\n- 用CanLoad来处理异步导航到某特性模块的情况。\n\n----------------------\n## 模块优化\n 各个模块定义，发现我们不断地重复引入了CommonModule、FormsModule、MdlModule,这些组件常用，就可以建立一个ShareModule(src\\app\\shared\\shared.module.ts)\n\n```javascript\n    import { NgModule } from '@angular/core';\n    import { CommonModule } from '@angular/common';\n    import { FormsModule } from '@angular/forms';\n    import { MdlModule } from 'angular2-mdl';\n\n    @NgModule({\n    imports: [\n        CommonModule,\n        FormsModule,\n        MdlModule\n    ],\n    exports: [\n        CommonModule,\n        FormsModule,\n        MdlModule\n    ]\n    })\n    export class SharedModule { }\n````\n\n这个模块的作用是将常用的模块打包起来，将常用的模块导入又导出，这样在其他模块中值需引入这个模块即可\n","source":"_posts/angular基础.md","raw":"---\ntitle: angular 基础\ndate: 2017-09-08 11:30:11\ncategories: angular\n---\n\n## angular 与 vue 的区别\n\n* angular2 全部采用 TypeScript 编写，TypeScript （编译工具），它为 JS 带来了类似于 Java 和 C# 的静态类型，\n* vue 的双向绑定基于 ES5 的 getter/setter 来实现的，而 angular 是由自己实现一套模板编译规则们需要进行 “ 脏 ” 检查，而 vue 不需要，因此 vue 在性能上更高效。\n* angular 中，当 watcher 越来越多时会越来越慢，因为作用域的每一次变化\n\n<!--more-->\n\n## angular\n\n* 组件化，数据的单向中心。es6 的语法。angular.js 是通过脏值检测的方式比对数据是否有变更，来决定是否更新视图，最简单的方式就是通过 setInterval() 定时轮询检测数据变动，当然 Google 不会这么 low，angular 只有在指定的事件触发时进入脏值检测，大致如下：\n* DOM 事件，譬如用户输入文本，点击按钮等。( ng-click )\n* XHR 响应事件 ( $http )\n* 浏览器 Location 变更事件 ( $location )\n* Timer 事件 ( $timeout , $interval )\n* 执行 $digest() 或 $apply()\n\n## react\n\n* 速度很快：来源于虚拟 DOM，只有在调用 get 和 set 的时候才会更新 DOM，而且是先更新虚拟 DOM 再更新实际的 DOM，由此更新 DOM 的次数少内容也会少很多。\n* FLUX 架构，react 更关注 UI 的组件化和数据的单向更新。可以直接有 es6 的一些语法。\n* 服务器端渲染，单页应用的缺陷是对于搜索引擎有很大的限制。react 的解决的方案是在服务器上预渲染应用然后发送到服务端，但是爬虫是依赖的服务端的响应而不是 web 的执行。\n* 目标是 UI。\n* 本身是一个 MVC 中的 V。\n\n---\n\n## Angular 为表单内置了 4 种 css 样式\n\n* ng-valid 校验合法状态\n* ng-invalid 校验非法状态\n* ng-pristine 如果要使用原生的 form，需要设置这个值\n* ng-dirty 表单处于脏数据状态\n\n---\n\n## @Component\n\n* @Component 是 Angular 提供的装饰函数，用来描述 Component 的元数据\n* selector 指这个组件在 HTML 模板中的标签是什么\n* template 是嵌入（inline ）的 HTML 模板，如果使用单独文件可用 templateUrl。\n* styles 是嵌入（inline ）的 CSS 样式，如果使用单独文件可用 styleUrls。\n* providers 列出会在此模块中 “ 注入 ” 的服务 (service)- 依赖注入\n* bootstrap 指明哪个组件为引导组件 ( 比如 AppComponent), 当 angular 引导应用时，它会在 Dom 中渲染这个引导性组件，并把结果放进 index.html 的该组件的标签中。\n\n## @NgModule\n\n@NgModule 装饰器用来为模块定义元数据。declarations 列出了应用中的顶层组件，在 module 里面声明的组件在 module 范围内都可以直接使用，也就是说在同一 module 里面的任何 Component 都可以在其模板文件中直接使用声明的组件，就想我们在 AppComponent 的模板末尾加上 <app-login></app-login> 一样。\n\n```javascript\nimport { HttpModule } from '@angular/http'\n\nimport { AppComponent } from './app.component'\nimport { LoginComponent } from './login/login.component'\n\n@NgModule({\n  declarations: [AppComponent, LoginComponent],\n  imports: [BrowserModule, FormsModule, HttpModule],\n  providers: [],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {}\n```\n\nNgModule 装饰器用来为模块定义元数据。\n\n* declarations 列出了应用中的顶层组件。\n* BrowerModule 提供了运行在浏览器中的应用所需要的关键服务 (service) 和指令 (Directive), 这个模块所在需要在浏览器中跑的应用都应用引用。\n* FormsModule 提供了表单处理和双向绑定等服务和指令。\n* HttpModule 提供 Htpp 请求和响应的服务。\n* providers 列出会在此模版中 “ 注入 ” 的服务（service ）。\n* bootstrap 指明哪个组件为引导性组件，并把结果放到 index.html 的该组件的元素标签中。\n* 静态引导 AppModuleNgFactory platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);\n\n---\n\n## 依赖注入\n\n如果不使用依赖注入，则需要 // 声明成员变量，其类型为 service 里面自定义的方法\n\n    ```javascript\n    //第一种：\n    service:AuthService;\n\n    constructor(){\n        this.service = new AuthService();//在构造中初始化service\n    }\n    //第二种：\n\n    providers: [\n    {provide: 'auth',  useClass: AuthService}\n    ]\n    ```\n\n* 第一种：由于实例化是在组件中进行的，意味着我们如果更改 service 的构造函数的话，组件也需要更改。如果使用依赖注入的话，就不需要显示声明成员变量 service。当 import 相关的服务后，这是 import 将类型引入进来，而 provider 里面会配置这个类型的实例。\n* provider 是一个数组，这里配置将要注入到其他组件中的服务配置。provide 定义了这个服务的名称，有需要注入这个服务的就引用这个名称就好。useClass 指明这个名称对应的服务是一个类。这样定义之后就能在任意组件中注入这个依赖了。\n\n```javascript\n       onstructor(@Inject('auth') private service) {\n   }\n```\n\n* @inject('auth'), 这个修饰符的意思是请到系统配置中找到名称为 auth 的那个依赖注入到我修饰的变量中。\n\n## 双向数据绑定\n\n* [(ngModel)]=\"username\" ,[] 的作用是将等号后面当成表达式来解析而不是当成字符串，如果去掉 [] 就是将 ngModel 赋值成 username 这个字符串。[] 的含义是单向绑定，就是将组件中给 model 赋的值会设置到 HTML 的 input 控件中。[()]是双向绑定。ngModel 是 FormModule 中提供的指令，它负责从 Domain Model 中创建一个 FormControl 的实例，并将这个实例和表单控件绑定 .\n* @Input() 是输入型绑定的修饰符，用于从数据从父组件传到子组件。\n\n---\n\n## 表单验证\n\n```html\n    <div>\n        <input required type=\"text\"\n            [(ngModel)]=\"username\"\n            #usernameRef=\"ngModel\"\n            />\n            {{usernameRef.valid}}\n        <input required type=\"password\"\n            [(ngModel)]=\"password\"\n            #passwordRef=\"ngModel\"\n            />\n            {{passwordRef.valid}}\n        <button (click)=\"onClick()\">Login</button>\n        </div>\n        <div>\n        <input #usernameRef type=\"text\">\n        <button (click)=\"onClick(usernameRef.value)\">Login</button>\n        </div>\n```\n\n1. 通过 #usernameRef = 'ngModel' 重新加入了引用，这个引用指向了 ngModel, 这个引用是要在模板中使用的所以加入这个引用。\n2. 在输入框中加入 #usernameRef，这个叫引用，引用的是 input 对象，如果想要传递 input 的值，可以用 usernameRef.value.\n\n```html\n    <div>\n        <input type=\"text\"\n            [(ngModel)]=\"username\"\n            #usernameRef=\"ngModel\"\n            required\n            minlength=\"3\"\n            />\n            {{ usernameRef.errors | json }}\n            <div *ngIf=\"usernameRef.errors?.required\">this is required</div>\n            <div *ngIf=\"usernameRef.errors?.minlength\">should be at least 3 charactors</div>\n        <input required type=\"password\"\n            [(ngModel)]=\"password\"\n            #passwordRef=\"ngModel\"\n            />\n            <div *ngIf=\"passwordRef.errors?.required\">this is required</div>\n        <button (click)=\"onClick()\">Login</button>\n    </div>\n```\n\n\\*ngIf = \"usernameRef.error?.required\" 的意思是当 usernameRef.error.required 为 true 的时候显示 div 标签\n\n```html\n    <div>\n        <form #formRef=\"ngForm\" (ngSubmit)=\"onSubmit(formRef.value)\">\n        <fieldset ngModelGroup=\"login\">\n            <input type=\"text\"\n            name=\"username\"\n            [(ngModel)]=\"username\"\n            #usernameRef=\"ngModel\"\n            required\n            minlength=\"3\"\n            />\n            <div *ngIf=\"usernameRef.errors?.required\">this is required</div>\n            <div *ngIf=\"usernameRef.errors?.minlength\">should be at least 3 charactors</div>\n            <input type=\"password\"\n            name=\"password\"\n            [(ngModel)]=\"password\"\n            #passwordRef=\"ngModel\"\n            required\n            />\n            <div *ngIf=\"passwordRef.errors?.required\">this is required</div>\n            <button (click)=\"onClick()\">Login</button>\n            <button type=\"submit\">Submit</button>\n            </fieldset>\n        </form>\n        </div>\n```\n\n* ngModel 会注册成 Form 的子控件，注册控件需要 name ，这个要求我们显示的指定对应控件的 name ，因此需要为 input 增加 name 属性，在 formREF.value 中包含了表单所有填写项的值\n\n* 有时在表单相中表单项过多时，就使用 HTML 中的 fieldset 标签用来处理。<fieldset ngModelGroup=\"login\"> 意味着我们对于 fieldset 之内的数据都分组到了 login 对象中。\n\n---\n\n## 路由\n\n路径配置的顺序是非常重要的，angular2 使用 “ 先匹配优先 ” 的原则。\n\n* redirectTo 重定向\n  ## service\n\n```javascript\n    //post /todos\n    addTodo(desc:string):Promise<Todo>{\n        let todo={\n            id:UUID.UUID(),\n            desc:desc,\n            completed:false\n        };\n        return this.http\n            .post(this.api_url,JSON.stringfy(todo),{header:this.headers})\n            .toPromise()\n            .then(res=>res.json().data as Todo)\n            .catch(this.handleError);\n    }\n```\n\n---\n\n````javascript\n    inputValue: string = '';\n    @Input() placeholder: string = 'What needs to be done?';\n    @Input() delay: number = 300;\n\n    //detect the input value and output this to parent\n    @Output() textChanges = new EventEmitter<string>();\n    //detect the enter keyup event and output this to parent\n    @Output() onEnterUp = new EventEmitter<boolean>();\n    ```\n- placeholder和delay作为2个输入型变量，这样在引入标签中就可以设置这两个属性了。\n- 由@Output修饰的onTextChanges 和 onEnterUp，这两个变量都定义了EventEmitter(事件发射器)。\n- export const routing = RouterModule.forChild(routes);，用的是forChild而不是forRoot,因为forRoot只能用于根目录，所有非跟模块的其他模块都只能用forChild.\n\n\n--------------------------\n## 验证用户帐户的流程\n- UserService:用于通过用户名查找用户并返回用户\n- AuthService:用于认证用户，其中需要利用UserService 的方法。\n- AuthGuard:路由拦截器，用于拦截到路由后通过Authservice来知道此用户是否有权限访问路由。根据结果导航到不同路径。\n- @SkipSelf装饰器意味着在当前注入器的所有祖先注入器中寻找，如果注入器找不到想要的提供商时就会抛出一个错误。但是@Optional装饰器表示找不到该服务则会返回null,\nparentModule参数也就被赋值为空。\n\n----------------\n## 路由守卫\n应用场景如下:\n该用户可能无权导航到目标组件。导航前需要用户先登录。\n\n路由器支持多种守卫：\n\n- 用CanActivate来处理导航到某路由的情况。\n- 用CanActivateChild处理导航到子路由的情况。\n- 用CanDeactivate来处理从当前路由离开的情况。\n- 用Resolve在路由激活之前获取路由数据。\n- 用CanLoad来处理异步导航到某特性模块的情况。\n\n----------------------\n## 模块优化\n 各个模块定义，发现我们不断地重复引入了CommonModule、FormsModule、MdlModule,这些组件常用，就可以建立一个ShareModule(src\\app\\shared\\shared.module.ts)\n\n```javascript\n    import { NgModule } from '@angular/core';\n    import { CommonModule } from '@angular/common';\n    import { FormsModule } from '@angular/forms';\n    import { MdlModule } from 'angular2-mdl';\n\n    @NgModule({\n    imports: [\n        CommonModule,\n        FormsModule,\n        MdlModule\n    ],\n    exports: [\n        CommonModule,\n        FormsModule,\n        MdlModule\n    ]\n    })\n    export class SharedModule { }\n````\n\n这个模块的作用是将常用的模块打包起来，将常用的模块导入又导出，这样在其他模块中值需引入这个模块即可\n","slug":"angular基础","published":1,"updated":"2021-02-28T08:17:02.479Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wy0015l5v0dq75g9qc","content":"<h2 id=\"angular-与-vue-的区别\"><a href=\"#angular-与-vue-的区别\" class=\"headerlink\" title=\"angular 与 vue 的区别\"></a>angular 与 vue 的区别</h2><ul>\n<li>angular2 全部采用 TypeScript 编写，TypeScript （编译工具），它为 JS 带来了类似于 Java 和 C# 的静态类型，</li>\n<li>vue 的双向绑定基于 ES5 的 getter/setter 来实现的，而 angular 是由自己实现一套模板编译规则们需要进行 “ 脏 ” 检查，而 vue 不需要，因此 vue 在性能上更高效。</li>\n<li>angular 中，当 watcher 越来越多时会越来越慢，因为作用域的每一次变化</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"angular\"><a href=\"#angular\" class=\"headerlink\" title=\"angular\"></a>angular</h2><ul>\n<li>组件化，数据的单向中心。es6 的语法。angular.js 是通过脏值检测的方式比对数据是否有变更，来决定是否更新视图，最简单的方式就是通过 setInterval() 定时轮询检测数据变动，当然 Google 不会这么 low，angular 只有在指定的事件触发时进入脏值检测，大致如下：</li>\n<li>DOM 事件，譬如用户输入文本，点击按钮等。( ng-click )</li>\n<li>XHR 响应事件 ( $http )</li>\n<li>浏览器 Location 变更事件 ( $location )</li>\n<li>Timer 事件 ( $timeout , $interval )</li>\n<li>执行 $digest() 或 $apply()</li>\n</ul>\n<h2 id=\"react\"><a href=\"#react\" class=\"headerlink\" title=\"react\"></a>react</h2><ul>\n<li>速度很快：来源于虚拟 DOM，只有在调用 get 和 set 的时候才会更新 DOM，而且是先更新虚拟 DOM 再更新实际的 DOM，由此更新 DOM 的次数少内容也会少很多。</li>\n<li>FLUX 架构，react 更关注 UI 的组件化和数据的单向更新。可以直接有 es6 的一些语法。</li>\n<li>服务器端渲染，单页应用的缺陷是对于搜索引擎有很大的限制。react 的解决的方案是在服务器上预渲染应用然后发送到服务端，但是爬虫是依赖的服务端的响应而不是 web 的执行。</li>\n<li>目标是 UI。</li>\n<li>本身是一个 MVC 中的 V。</li>\n</ul>\n<hr>\n<h2 id=\"Angular-为表单内置了-4-种-css-样式\"><a href=\"#Angular-为表单内置了-4-种-css-样式\" class=\"headerlink\" title=\"Angular 为表单内置了 4 种 css 样式\"></a>Angular 为表单内置了 4 种 css 样式</h2><ul>\n<li>ng-valid 校验合法状态</li>\n<li>ng-invalid 校验非法状态</li>\n<li>ng-pristine 如果要使用原生的 form，需要设置这个值</li>\n<li>ng-dirty 表单处于脏数据状态</li>\n</ul>\n<hr>\n<h2 id=\"Component\"><a href=\"#Component\" class=\"headerlink\" title=\"@Component\"></a>@Component</h2><ul>\n<li>@Component 是 Angular 提供的装饰函数，用来描述 Component 的元数据</li>\n<li>selector 指这个组件在 HTML 模板中的标签是什么</li>\n<li>template 是嵌入（inline ）的 HTML 模板，如果使用单独文件可用 templateUrl。</li>\n<li>styles 是嵌入（inline ）的 CSS 样式，如果使用单独文件可用 styleUrls。</li>\n<li>providers 列出会在此模块中 “ 注入 ” 的服务 (service)- 依赖注入</li>\n<li>bootstrap 指明哪个组件为引导组件 ( 比如 AppComponent), 当 angular 引导应用时，它会在 Dom 中渲染这个引导性组件，并把结果放进 index.html 的该组件的标签中。</li>\n</ul>\n<h2 id=\"NgModule\"><a href=\"#NgModule\" class=\"headerlink\" title=\"@NgModule\"></a>@NgModule</h2><p>@NgModule 装饰器用来为模块定义元数据。declarations 列出了应用中的顶层组件，在 module 里面声明的组件在 module 范围内都可以直接使用，也就是说在同一 module 里面的任何 Component 都可以在其模板文件中直接使用声明的组件，就想我们在 AppComponent 的模板末尾加上 <app-login></app-login> 一样。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; HttpModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/http&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; AppComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./app.component&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; LoginComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./login/login.component&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">@NgModule(&#123;</span><br><span class=\"line\">  declarations: [AppComponent, LoginComponent],</span><br><span class=\"line\">  imports: [BrowserModule, FormsModule, HttpModule],</span><br><span class=\"line\">  providers: [],</span><br><span class=\"line\">  bootstrap: [AppComponent]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppModule</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>NgModule 装饰器用来为模块定义元数据。</p>\n<ul>\n<li>declarations 列出了应用中的顶层组件。</li>\n<li>BrowerModule 提供了运行在浏览器中的应用所需要的关键服务 (service) 和指令 (Directive), 这个模块所在需要在浏览器中跑的应用都应用引用。</li>\n<li>FormsModule 提供了表单处理和双向绑定等服务和指令。</li>\n<li>HttpModule 提供 Htpp 请求和响应的服务。</li>\n<li>providers 列出会在此模版中 “ 注入 ” 的服务（service ）。</li>\n<li>bootstrap 指明哪个组件为引导性组件，并把结果放到 index.html 的该组件的元素标签中。</li>\n<li>静态引导 AppModuleNgFactory platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);</li>\n</ul>\n<hr>\n<h2 id=\"依赖注入\"><a href=\"#依赖注入\" class=\"headerlink\" title=\"依赖注入\"></a>依赖注入</h2><p>如果不使用依赖注入，则需要 // 声明成员变量，其类型为 service 里面自定义的方法</p>\n<pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//第一种：</span></span><br><span class=\"line\">service:AuthService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.service = <span class=\"keyword\">new</span> AuthService();<span class=\"comment\">//在构造中初始化service</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//第二种：</span></span><br><span class=\"line\"></span><br><span class=\"line\">providers: [</span><br><span class=\"line\">&#123;<span class=\"attr\">provide</span>: <span class=\"string\">&#x27;auth&#x27;</span>,  <span class=\"attr\">useClass</span>: AuthService&#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n</code></pre>\n<ul>\n<li>第一种：由于实例化是在组件中进行的，意味着我们如果更改 service 的构造函数的话，组件也需要更改。如果使用依赖注入的话，就不需要显示声明成员变量 service。当 import 相关的服务后，这是 import 将类型引入进来，而 provider 里面会配置这个类型的实例。</li>\n<li>provider 是一个数组，这里配置将要注入到其他组件中的服务配置。provide 定义了这个服务的名称，有需要注入这个服务的就引用这个名称就好。useClass 指明这个名称对应的服务是一个类。这样定义之后就能在任意组件中注入这个依赖了。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"function\"><span class=\"title\">onstructor</span>(<span class=\"params\">@Inject(<span class=\"string\">&#x27;auth&#x27;</span>) private service</span>)</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>@inject(‘auth’), 这个修饰符的意思是请到系统配置中找到名称为 auth 的那个依赖注入到我修饰的变量中。</li>\n</ul>\n<h2 id=\"双向数据绑定\"><a href=\"#双向数据绑定\" class=\"headerlink\" title=\"双向数据绑定\"></a>双向数据绑定</h2><ul>\n<li>[(ngModel)]=”username” ,[] 的作用是将等号后面当成表达式来解析而不是当成字符串，如果去掉 [] 就是将 ngModel 赋值成 username 这个字符串。[] 的含义是单向绑定，就是将组件中给 model 赋的值会设置到 HTML 的 input 控件中。[()]是双向绑定。ngModel 是 FormModule 中提供的指令，它负责从 Domain Model 中创建一个 FormControl 的实例，并将这个实例和表单控件绑定 .</li>\n<li>@Input() 是输入型绑定的修饰符，用于从数据从父组件传到子组件。</li>\n</ul>\n<hr>\n<h2 id=\"表单验证\"><a href=\"#表单验证\" class=\"headerlink\" title=\"表单验证\"></a>表单验证</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">required</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;username&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">usernameRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        &#123;&#123;usernameRef.valid&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">required</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">passwordRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        &#123;&#123;passwordRef.valid&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">&quot;onClick()&quot;</span>&gt;</span>Login<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> #<span class=\"attr\">usernameRef</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">&quot;onClick(usernameRef.value)&quot;</span>&gt;</span>Login<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>通过 #usernameRef = ‘ngModel’ 重新加入了引用，这个引用指向了 ngModel, 这个引用是要在模板中使用的所以加入这个引用。</li>\n<li>在输入框中加入 #usernameRef，这个叫引用，引用的是 input 对象，如果想要传递 input 的值，可以用 usernameRef.value.</li>\n</ol>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;username&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">usernameRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">required</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">minlength</span>=<span class=\"string\">&quot;3&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        &#123;&#123; usernameRef.errors | json &#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;usernameRef.errors?.required&quot;</span>&gt;</span>this is required<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;usernameRef.errors?.minlength&quot;</span>&gt;</span>should be at least 3 charactors<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">required</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">passwordRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;passwordRef.errors?.required&quot;</span>&gt;</span>this is required<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">&quot;onClick()&quot;</span>&gt;</span>Login<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>*ngIf = “usernameRef.error?.required” 的意思是当 usernameRef.error.required 为 true 的时候显示 div 标签</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> #<span class=\"attr\">formRef</span>=<span class=\"string\">&quot;ngForm&quot;</span> (<span class=\"attr\">ngSubmit</span>)=<span class=\"string\">&quot;onSubmit(formRef.value)&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">fieldset</span> <span class=\"attr\">ngModelGroup</span>=<span class=\"string\">&quot;login&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;username&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">usernameRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">required</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">minlength</span>=<span class=\"string\">&quot;3&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;usernameRef.errors?.required&quot;</span>&gt;</span>this is required<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;usernameRef.errors?.minlength&quot;</span>&gt;</span>should be at least 3 charactors<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">passwordRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">required</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;passwordRef.errors?.required&quot;</span>&gt;</span>this is required<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">&quot;onClick()&quot;</span>&gt;</span>Login<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span>Submit<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">fieldset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>ngModel 会注册成 Form 的子控件，注册控件需要 name ，这个要求我们显示的指定对应控件的 name ，因此需要为 input 增加 name 属性，在 formREF.value 中包含了表单所有填写项的值</p>\n</li>\n<li><p>有时在表单相中表单项过多时，就使用 HTML 中的 fieldset 标签用来处理。<fieldset ngModelGroup=\"login\"> 意味着我们对于 fieldset 之内的数据都分组到了 login 对象中。</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"路由\"><a href=\"#路由\" class=\"headerlink\" title=\"路由\"></a>路由</h2><p>路径配置的顺序是非常重要的，angular2 使用 “ 先匹配优先 ” 的原则。</p>\n<ul>\n<li>redirectTo 重定向<h2 id=\"service\"><a href=\"#service\" class=\"headerlink\" title=\"service\"></a>service</h2></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//post /todos</span></span><br><span class=\"line\">addTodo(desc:string):<span class=\"built_in\">Promise</span>&lt;Todo&gt;&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> todo=&#123;</span><br><span class=\"line\">        id:UUID.UUID(),</span><br><span class=\"line\">        desc:desc,</span><br><span class=\"line\">        completed:<span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.http</span><br><span class=\"line\">        .post(<span class=\"built_in\">this</span>.api_url,<span class=\"built_in\">JSON</span>.stringfy(todo),&#123;<span class=\"attr\">header</span>:<span class=\"built_in\">this</span>.headers&#125;)</span><br><span class=\"line\">        .toPromise()</span><br><span class=\"line\">        .then(<span class=\"function\"><span class=\"params\">res</span>=&gt;</span>res.json().data <span class=\"keyword\">as</span> Todo)</span><br><span class=\"line\">        .catch(<span class=\"built_in\">this</span>.handleError);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    inputValue: string = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">    @Input() placeholder: string = <span class=\"string\">&#x27;What needs to be done?&#x27;</span>;</span><br><span class=\"line\">    @Input() delay: number = <span class=\"number\">300</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//detect the input value and output this to parent</span></span><br><span class=\"line\">    @Output() textChanges = <span class=\"keyword\">new</span> EventEmitter&lt;string&gt;();</span><br><span class=\"line\">    <span class=\"comment\">//detect the enter keyup event and output this to parent</span></span><br><span class=\"line\">    @Output() onEnterUp = <span class=\"keyword\">new</span> EventEmitter&lt;boolean&gt;();</span><br><span class=\"line\">    <span class=\"string\">``</span><span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">- placeholder和delay作为2个输入型变量，这样在引入标签中就可以设置这两个属性了。</span></span><br><span class=\"line\"><span class=\"string\">- 由@Output修饰的onTextChanges 和 onEnterUp，这两个变量都定义了EventEmitter(事件发射器)。</span></span><br><span class=\"line\"><span class=\"string\">- export const routing = RouterModule.forChild(routes);，用的是forChild而不是forRoot,因为forRoot只能用于根目录，所有非跟模块的其他模块都只能用forChild.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">--------------------------</span></span><br><span class=\"line\"><span class=\"string\">## 验证用户帐户的流程</span></span><br><span class=\"line\"><span class=\"string\">- UserService:用于通过用户名查找用户并返回用户</span></span><br><span class=\"line\"><span class=\"string\">- AuthService:用于认证用户，其中需要利用UserService 的方法。</span></span><br><span class=\"line\"><span class=\"string\">- AuthGuard:路由拦截器，用于拦截到路由后通过Authservice来知道此用户是否有权限访问路由。根据结果导航到不同路径。</span></span><br><span class=\"line\"><span class=\"string\">- @SkipSelf装饰器意味着在当前注入器的所有祖先注入器中寻找，如果注入器找不到想要的提供商时就会抛出一个错误。但是@Optional装饰器表示找不到该服务则会返回null,</span></span><br><span class=\"line\"><span class=\"string\">parentModule参数也就被赋值为空。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">----------------</span></span><br><span class=\"line\"><span class=\"string\">## 路由守卫</span></span><br><span class=\"line\"><span class=\"string\">应用场景如下:</span></span><br><span class=\"line\"><span class=\"string\">该用户可能无权导航到目标组件。导航前需要用户先登录。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">路由器支持多种守卫：</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">- 用CanActivate来处理导航到某路由的情况。</span></span><br><span class=\"line\"><span class=\"string\">- 用CanActivateChild处理导航到子路由的情况。</span></span><br><span class=\"line\"><span class=\"string\">- 用CanDeactivate来处理从当前路由离开的情况。</span></span><br><span class=\"line\"><span class=\"string\">- 用Resolve在路由激活之前获取路由数据。</span></span><br><span class=\"line\"><span class=\"string\">- 用CanLoad来处理异步导航到某特性模块的情况。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">----------------------</span></span><br><span class=\"line\"><span class=\"string\">## 模块优化</span></span><br><span class=\"line\"><span class=\"string\"> 各个模块定义，发现我们不断地重复引入了CommonModule、FormsModule、MdlModule,这些组件常用，就可以建立一个ShareModule(src\\app\\shared\\shared.module.ts)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\">    <span class=\"keyword\">import</span> &#123; NgModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">import</span> &#123; CommonModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/common&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">import</span> &#123; FormsModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/forms&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">import</span> &#123; MdlModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;angular2-mdl&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    @NgModule(&#123;</span><br><span class=\"line\">    imports: [</span><br><span class=\"line\">        CommonModule,</span><br><span class=\"line\">        FormsModule,</span><br><span class=\"line\">        MdlModule</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"built_in\">exports</span>: [</span><br><span class=\"line\">        CommonModule,</span><br><span class=\"line\">        FormsModule,</span><br><span class=\"line\">        MdlModule</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SharedModule</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个模块的作用是将常用的模块打包起来，将常用的模块导入又导出，这样在其他模块中值需引入这个模块即可</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"angular-与-vue-的区别\"><a href=\"#angular-与-vue-的区别\" class=\"headerlink\" title=\"angular 与 vue 的区别\"></a>angular 与 vue 的区别</h2><ul>\n<li>angular2 全部采用 TypeScript 编写，TypeScript （编译工具），它为 JS 带来了类似于 Java 和 C# 的静态类型，</li>\n<li>vue 的双向绑定基于 ES5 的 getter/setter 来实现的，而 angular 是由自己实现一套模板编译规则们需要进行 “ 脏 ” 检查，而 vue 不需要，因此 vue 在性能上更高效。</li>\n<li>angular 中，当 watcher 越来越多时会越来越慢，因为作用域的每一次变化</li>\n</ul>","more":"<h2 id=\"angular\"><a href=\"#angular\" class=\"headerlink\" title=\"angular\"></a>angular</h2><ul>\n<li>组件化，数据的单向中心。es6 的语法。angular.js 是通过脏值检测的方式比对数据是否有变更，来决定是否更新视图，最简单的方式就是通过 setInterval() 定时轮询检测数据变动，当然 Google 不会这么 low，angular 只有在指定的事件触发时进入脏值检测，大致如下：</li>\n<li>DOM 事件，譬如用户输入文本，点击按钮等。( ng-click )</li>\n<li>XHR 响应事件 ( $http )</li>\n<li>浏览器 Location 变更事件 ( $location )</li>\n<li>Timer 事件 ( $timeout , $interval )</li>\n<li>执行 $digest() 或 $apply()</li>\n</ul>\n<h2 id=\"react\"><a href=\"#react\" class=\"headerlink\" title=\"react\"></a>react</h2><ul>\n<li>速度很快：来源于虚拟 DOM，只有在调用 get 和 set 的时候才会更新 DOM，而且是先更新虚拟 DOM 再更新实际的 DOM，由此更新 DOM 的次数少内容也会少很多。</li>\n<li>FLUX 架构，react 更关注 UI 的组件化和数据的单向更新。可以直接有 es6 的一些语法。</li>\n<li>服务器端渲染，单页应用的缺陷是对于搜索引擎有很大的限制。react 的解决的方案是在服务器上预渲染应用然后发送到服务端，但是爬虫是依赖的服务端的响应而不是 web 的执行。</li>\n<li>目标是 UI。</li>\n<li>本身是一个 MVC 中的 V。</li>\n</ul>\n<hr>\n<h2 id=\"Angular-为表单内置了-4-种-css-样式\"><a href=\"#Angular-为表单内置了-4-种-css-样式\" class=\"headerlink\" title=\"Angular 为表单内置了 4 种 css 样式\"></a>Angular 为表单内置了 4 种 css 样式</h2><ul>\n<li>ng-valid 校验合法状态</li>\n<li>ng-invalid 校验非法状态</li>\n<li>ng-pristine 如果要使用原生的 form，需要设置这个值</li>\n<li>ng-dirty 表单处于脏数据状态</li>\n</ul>\n<hr>\n<h2 id=\"Component\"><a href=\"#Component\" class=\"headerlink\" title=\"@Component\"></a>@Component</h2><ul>\n<li>@Component 是 Angular 提供的装饰函数，用来描述 Component 的元数据</li>\n<li>selector 指这个组件在 HTML 模板中的标签是什么</li>\n<li>template 是嵌入（inline ）的 HTML 模板，如果使用单独文件可用 templateUrl。</li>\n<li>styles 是嵌入（inline ）的 CSS 样式，如果使用单独文件可用 styleUrls。</li>\n<li>providers 列出会在此模块中 “ 注入 ” 的服务 (service)- 依赖注入</li>\n<li>bootstrap 指明哪个组件为引导组件 ( 比如 AppComponent), 当 angular 引导应用时，它会在 Dom 中渲染这个引导性组件，并把结果放进 index.html 的该组件的标签中。</li>\n</ul>\n<h2 id=\"NgModule\"><a href=\"#NgModule\" class=\"headerlink\" title=\"@NgModule\"></a>@NgModule</h2><p>@NgModule 装饰器用来为模块定义元数据。declarations 列出了应用中的顶层组件，在 module 里面声明的组件在 module 范围内都可以直接使用，也就是说在同一 module 里面的任何 Component 都可以在其模板文件中直接使用声明的组件，就想我们在 AppComponent 的模板末尾加上 <app-login></app-login> 一样。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; HttpModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/http&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; AppComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./app.component&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; LoginComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./login/login.component&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">@NgModule(&#123;</span><br><span class=\"line\">  declarations: [AppComponent, LoginComponent],</span><br><span class=\"line\">  imports: [BrowserModule, FormsModule, HttpModule],</span><br><span class=\"line\">  providers: [],</span><br><span class=\"line\">  bootstrap: [AppComponent]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppModule</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>NgModule 装饰器用来为模块定义元数据。</p>\n<ul>\n<li>declarations 列出了应用中的顶层组件。</li>\n<li>BrowerModule 提供了运行在浏览器中的应用所需要的关键服务 (service) 和指令 (Directive), 这个模块所在需要在浏览器中跑的应用都应用引用。</li>\n<li>FormsModule 提供了表单处理和双向绑定等服务和指令。</li>\n<li>HttpModule 提供 Htpp 请求和响应的服务。</li>\n<li>providers 列出会在此模版中 “ 注入 ” 的服务（service ）。</li>\n<li>bootstrap 指明哪个组件为引导性组件，并把结果放到 index.html 的该组件的元素标签中。</li>\n<li>静态引导 AppModuleNgFactory platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);</li>\n</ul>\n<hr>\n<h2 id=\"依赖注入\"><a href=\"#依赖注入\" class=\"headerlink\" title=\"依赖注入\"></a>依赖注入</h2><p>如果不使用依赖注入，则需要 // 声明成员变量，其类型为 service 里面自定义的方法</p>\n<pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//第一种：</span></span><br><span class=\"line\">service:AuthService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.service = <span class=\"keyword\">new</span> AuthService();<span class=\"comment\">//在构造中初始化service</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//第二种：</span></span><br><span class=\"line\"></span><br><span class=\"line\">providers: [</span><br><span class=\"line\">&#123;<span class=\"attr\">provide</span>: <span class=\"string\">&#x27;auth&#x27;</span>,  <span class=\"attr\">useClass</span>: AuthService&#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n</code></pre>\n<ul>\n<li>第一种：由于实例化是在组件中进行的，意味着我们如果更改 service 的构造函数的话，组件也需要更改。如果使用依赖注入的话，就不需要显示声明成员变量 service。当 import 相关的服务后，这是 import 将类型引入进来，而 provider 里面会配置这个类型的实例。</li>\n<li>provider 是一个数组，这里配置将要注入到其他组件中的服务配置。provide 定义了这个服务的名称，有需要注入这个服务的就引用这个名称就好。useClass 指明这个名称对应的服务是一个类。这样定义之后就能在任意组件中注入这个依赖了。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"function\"><span class=\"title\">onstructor</span>(<span class=\"params\">@Inject(<span class=\"string\">&#x27;auth&#x27;</span>) private service</span>)</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>@inject(‘auth’), 这个修饰符的意思是请到系统配置中找到名称为 auth 的那个依赖注入到我修饰的变量中。</li>\n</ul>\n<h2 id=\"双向数据绑定\"><a href=\"#双向数据绑定\" class=\"headerlink\" title=\"双向数据绑定\"></a>双向数据绑定</h2><ul>\n<li>[(ngModel)]=”username” ,[] 的作用是将等号后面当成表达式来解析而不是当成字符串，如果去掉 [] 就是将 ngModel 赋值成 username 这个字符串。[] 的含义是单向绑定，就是将组件中给 model 赋的值会设置到 HTML 的 input 控件中。[()]是双向绑定。ngModel 是 FormModule 中提供的指令，它负责从 Domain Model 中创建一个 FormControl 的实例，并将这个实例和表单控件绑定 .</li>\n<li>@Input() 是输入型绑定的修饰符，用于从数据从父组件传到子组件。</li>\n</ul>\n<hr>\n<h2 id=\"表单验证\"><a href=\"#表单验证\" class=\"headerlink\" title=\"表单验证\"></a>表单验证</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">required</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;username&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">usernameRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        &#123;&#123;usernameRef.valid&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">required</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">passwordRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        &#123;&#123;passwordRef.valid&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">&quot;onClick()&quot;</span>&gt;</span>Login<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> #<span class=\"attr\">usernameRef</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">&quot;onClick(usernameRef.value)&quot;</span>&gt;</span>Login<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>通过 #usernameRef = ‘ngModel’ 重新加入了引用，这个引用指向了 ngModel, 这个引用是要在模板中使用的所以加入这个引用。</li>\n<li>在输入框中加入 #usernameRef，这个叫引用，引用的是 input 对象，如果想要传递 input 的值，可以用 usernameRef.value.</li>\n</ol>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;username&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">usernameRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">required</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">minlength</span>=<span class=\"string\">&quot;3&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        &#123;&#123; usernameRef.errors | json &#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;usernameRef.errors?.required&quot;</span>&gt;</span>this is required<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;usernameRef.errors?.minlength&quot;</span>&gt;</span>should be at least 3 charactors<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">required</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">passwordRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;passwordRef.errors?.required&quot;</span>&gt;</span>this is required<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">&quot;onClick()&quot;</span>&gt;</span>Login<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>*ngIf = “usernameRef.error?.required” 的意思是当 usernameRef.error.required 为 true 的时候显示 div 标签</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> #<span class=\"attr\">formRef</span>=<span class=\"string\">&quot;ngForm&quot;</span> (<span class=\"attr\">ngSubmit</span>)=<span class=\"string\">&quot;onSubmit(formRef.value)&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">fieldset</span> <span class=\"attr\">ngModelGroup</span>=<span class=\"string\">&quot;login&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;username&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">usernameRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">required</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">minlength</span>=<span class=\"string\">&quot;3&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;usernameRef.errors?.required&quot;</span>&gt;</span>this is required<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;usernameRef.errors?.minlength&quot;</span>&gt;</span>should be at least 3 charactors<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        #<span class=\"attr\">passwordRef</span>=<span class=\"string\">&quot;ngModel&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">required</span></span></span><br><span class=\"line\"><span class=\"tag\">        /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;passwordRef.errors?.required&quot;</span>&gt;</span>this is required<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">&quot;onClick()&quot;</span>&gt;</span>Login<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span>Submit<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">fieldset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>ngModel 会注册成 Form 的子控件，注册控件需要 name ，这个要求我们显示的指定对应控件的 name ，因此需要为 input 增加 name 属性，在 formREF.value 中包含了表单所有填写项的值</p>\n</li>\n<li><p>有时在表单相中表单项过多时，就使用 HTML 中的 fieldset 标签用来处理。<fieldset ngModelGroup=\"login\"> 意味着我们对于 fieldset 之内的数据都分组到了 login 对象中。</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"路由\"><a href=\"#路由\" class=\"headerlink\" title=\"路由\"></a>路由</h2><p>路径配置的顺序是非常重要的，angular2 使用 “ 先匹配优先 ” 的原则。</p>\n<ul>\n<li>redirectTo 重定向<h2 id=\"service\"><a href=\"#service\" class=\"headerlink\" title=\"service\"></a>service</h2></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//post /todos</span></span><br><span class=\"line\">addTodo(desc:string):<span class=\"built_in\">Promise</span>&lt;Todo&gt;&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> todo=&#123;</span><br><span class=\"line\">        id:UUID.UUID(),</span><br><span class=\"line\">        desc:desc,</span><br><span class=\"line\">        completed:<span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.http</span><br><span class=\"line\">        .post(<span class=\"built_in\">this</span>.api_url,<span class=\"built_in\">JSON</span>.stringfy(todo),&#123;<span class=\"attr\">header</span>:<span class=\"built_in\">this</span>.headers&#125;)</span><br><span class=\"line\">        .toPromise()</span><br><span class=\"line\">        .then(<span class=\"function\"><span class=\"params\">res</span>=&gt;</span>res.json().data <span class=\"keyword\">as</span> Todo)</span><br><span class=\"line\">        .catch(<span class=\"built_in\">this</span>.handleError);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    inputValue: string = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">    @Input() placeholder: string = <span class=\"string\">&#x27;What needs to be done?&#x27;</span>;</span><br><span class=\"line\">    @Input() delay: number = <span class=\"number\">300</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//detect the input value and output this to parent</span></span><br><span class=\"line\">    @Output() textChanges = <span class=\"keyword\">new</span> EventEmitter&lt;string&gt;();</span><br><span class=\"line\">    <span class=\"comment\">//detect the enter keyup event and output this to parent</span></span><br><span class=\"line\">    @Output() onEnterUp = <span class=\"keyword\">new</span> EventEmitter&lt;boolean&gt;();</span><br><span class=\"line\">    <span class=\"string\">``</span><span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">- placeholder和delay作为2个输入型变量，这样在引入标签中就可以设置这两个属性了。</span></span><br><span class=\"line\"><span class=\"string\">- 由@Output修饰的onTextChanges 和 onEnterUp，这两个变量都定义了EventEmitter(事件发射器)。</span></span><br><span class=\"line\"><span class=\"string\">- export const routing = RouterModule.forChild(routes);，用的是forChild而不是forRoot,因为forRoot只能用于根目录，所有非跟模块的其他模块都只能用forChild.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">--------------------------</span></span><br><span class=\"line\"><span class=\"string\">## 验证用户帐户的流程</span></span><br><span class=\"line\"><span class=\"string\">- UserService:用于通过用户名查找用户并返回用户</span></span><br><span class=\"line\"><span class=\"string\">- AuthService:用于认证用户，其中需要利用UserService 的方法。</span></span><br><span class=\"line\"><span class=\"string\">- AuthGuard:路由拦截器，用于拦截到路由后通过Authservice来知道此用户是否有权限访问路由。根据结果导航到不同路径。</span></span><br><span class=\"line\"><span class=\"string\">- @SkipSelf装饰器意味着在当前注入器的所有祖先注入器中寻找，如果注入器找不到想要的提供商时就会抛出一个错误。但是@Optional装饰器表示找不到该服务则会返回null,</span></span><br><span class=\"line\"><span class=\"string\">parentModule参数也就被赋值为空。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">----------------</span></span><br><span class=\"line\"><span class=\"string\">## 路由守卫</span></span><br><span class=\"line\"><span class=\"string\">应用场景如下:</span></span><br><span class=\"line\"><span class=\"string\">该用户可能无权导航到目标组件。导航前需要用户先登录。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">路由器支持多种守卫：</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">- 用CanActivate来处理导航到某路由的情况。</span></span><br><span class=\"line\"><span class=\"string\">- 用CanActivateChild处理导航到子路由的情况。</span></span><br><span class=\"line\"><span class=\"string\">- 用CanDeactivate来处理从当前路由离开的情况。</span></span><br><span class=\"line\"><span class=\"string\">- 用Resolve在路由激活之前获取路由数据。</span></span><br><span class=\"line\"><span class=\"string\">- 用CanLoad来处理异步导航到某特性模块的情况。</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">----------------------</span></span><br><span class=\"line\"><span class=\"string\">## 模块优化</span></span><br><span class=\"line\"><span class=\"string\"> 各个模块定义，发现我们不断地重复引入了CommonModule、FormsModule、MdlModule,这些组件常用，就可以建立一个ShareModule(src\\app\\shared\\shared.module.ts)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\">    <span class=\"keyword\">import</span> &#123; NgModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">import</span> &#123; CommonModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/common&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">import</span> &#123; FormsModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/forms&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">import</span> &#123; MdlModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;angular2-mdl&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    @NgModule(&#123;</span><br><span class=\"line\">    imports: [</span><br><span class=\"line\">        CommonModule,</span><br><span class=\"line\">        FormsModule,</span><br><span class=\"line\">        MdlModule</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"built_in\">exports</span>: [</span><br><span class=\"line\">        CommonModule,</span><br><span class=\"line\">        FormsModule,</span><br><span class=\"line\">        MdlModule</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">export</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SharedModule</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个模块的作用是将常用的模块打包起来，将常用的模块导入又导出，这样在其他模块中值需引入这个模块即可</p>"},{"title":"call、applay、 bind","date":"2019-04-13T09:36:56.000Z","_content":"\n- 都是用来改变函数的 this 对象的指向的。\n- 第一个参数都是 this 要指向的对象。\n- 参数、绑定规则（显示绑定和强绑定），运行效率（最终都会转换成一个一个的参数去运行）、运行情况（call ， apply 立即执行，bind 是 return 出一个 this “ 固定 ” 的函数，这也是为什么 bind 是强绑定的一个原因）。\n- 在`javascipt`中，`call`和`apply`都是为了改变某个函数运行时的上下文而存在的，换句话说就是为了改变函数体内部`this`的指向。\n  <!--more-->\n\n## call()\n\n```javascript\nfunction class1() {\n  this.name = function () {\n    console.log(this.names)\n    console.log('我是class1内的方法')\n  }\n}\nfunction class2() {\n  this.names = 'class2内部变量'\n  class1.call(this)\n\n  //class2内部变量 我是class1内的方法\n  //此行代码执行后，当前的this指向了class1（也可以说class2继承了class1）\n}\n\nvar f = new class2()\nf.name() //调用的是class1内的方法，将class1的name方法交给class2使用\n```\n\n```javascript\nfunction eat(x, y) {\n  console.log(x + y)\n}\nfunction drink(x, y) {\n  console.log(x - y)\n}\neat.call(drink, 3, 2) //5\n```\n\n这个例子中的意思就是用 eat 来替换 drink，eat.call(drink,3,2) == eat(3,2)\n\n```javascript\nfunction Animal() {\n  this.name = 'animal'\n  this.showName = function () {\n    console.log(this.name)\n  }\n}\nfunction Dog() {\n  this.name = 'dog'\n}\nvar animal = new Animal()\nvar dog = new Dog()\n\nanimal.showName.call(dog) //dog\n```\n\n意思是把 animal 的方法放到 dog 上执行，也可以说，把 animal 的 showName() 方法放到 dog 上来执行，所以 this.name 应该是 dog。\n\n```javascript\nfunction fruits() {}\nfruits.prototype = {\n  color: 'red',\n  say: function (a, b) {\n    console.log('my color is ' + this.color + ' ' + a + '' + b)\n  },\n}\n\nvar apple = new fruits()\napple.say() //my color is red undefinedundefined\n\nbanana = {\n  color: 'yellow',\n}\napple.say.call(banana, 'red', 'blue') //my color is yellowredblue\napple.say.apply(banana) //my color is yellow undefinedundefined\n```\n\n所以可以看出`call`和`apply`是为了动态改变 this 二存在的，当一个 object 没有某个方法。但是其他的有。我们可以借助 call 或 apply 用其他对象的方法来操作。\n\n```javascript\nfunc.call(this, arg1, arg2)\nfunc.apply(this, [arg1, arg2])\n```\n\n**查找数组中的最大值**\n\n```javascript\nvar numbers = [5, 458, 120, -215]\nMath.max.apply(Math, numbers) //458\nMath.max.call(Math, 5, 458, 120, -215) //458\n\n// ES6\nMath.max.call(Math, ...numbers) // 458\n\n//或者\nvar arr = [1, 2, 3]\nvar max = Math.max(...arr)\n```\n\n## 继承\n\n\n```javascript\nfunction Animal(name) {\n  this.name = name\n  this.showName = function () {\n    console.log(this.name)\n  }\n}\nfunction Dog(name) {\n  Animal.call(this, name)\n}\nvar dog = new Dog('Crazy dog')\ndog.showName()\n```\n\nAnimal.call(this) 的意思就是使用 Animal 对象代替 this 对象，那么 Dog 就能直接调用 Animal 的所有属性和方法。\n\n```javascript\nvar toString = Object.prototype.toString\nconsole.log(toString.call(2)) //[object Number]\nconsole.log(toString.call(true)) //[object Boolean]\nconsole.log(toString.call(function () {})) //[object Function]\n```\n\n## apply\n\n```javascript\nfunction class1(args1, args2) {\n  this.name = function () {\n    console.log(args, args)\n  }\n}\nfunction class2() {\n  var args1 = '1'\n  var args2 = '2'\n  class1.call(this, args1, args2)\n  /*或*/\n  class1.apply(this, [args1, args2])\n}\n\nvar c = new class2()\nc.name()\n```\n\n## bind\n\nbind 是在 EcmaScript5 中扩展的方法（IE6,7,8 不支持。)\n\nbind() 方法会创建一个新函数，称为绑定函数，当调用这个绑定函数时，绑定函数会以创建它时传入 bind() 方法的第一个参数作为 this，传入 bind() 方法的第二个以及以后的参数加上绑定函数运行时本身的参数按照顺序作为原函数的参数来调用原函数。\n\n```javascript\nvar bar = function () {\n  console.log(this.x)\n}\nvar foo = {\n  x: 3,\n}\nbar()\nbar.bind(foo)() //undefined 3\n/*或*/\nvar func = bar.bind(foo)\nfunc()\n```\n","source":"_posts/call、applay、bind.md","raw":"---\ntitle: call、applay、 bind\ndate: 2019-04-13 17:36:56\ncategories: JavaScript\n---\n\n- 都是用来改变函数的 this 对象的指向的。\n- 第一个参数都是 this 要指向的对象。\n- 参数、绑定规则（显示绑定和强绑定），运行效率（最终都会转换成一个一个的参数去运行）、运行情况（call ， apply 立即执行，bind 是 return 出一个 this “ 固定 ” 的函数，这也是为什么 bind 是强绑定的一个原因）。\n- 在`javascipt`中，`call`和`apply`都是为了改变某个函数运行时的上下文而存在的，换句话说就是为了改变函数体内部`this`的指向。\n  <!--more-->\n\n## call()\n\n```javascript\nfunction class1() {\n  this.name = function () {\n    console.log(this.names)\n    console.log('我是class1内的方法')\n  }\n}\nfunction class2() {\n  this.names = 'class2内部变量'\n  class1.call(this)\n\n  //class2内部变量 我是class1内的方法\n  //此行代码执行后，当前的this指向了class1（也可以说class2继承了class1）\n}\n\nvar f = new class2()\nf.name() //调用的是class1内的方法，将class1的name方法交给class2使用\n```\n\n```javascript\nfunction eat(x, y) {\n  console.log(x + y)\n}\nfunction drink(x, y) {\n  console.log(x - y)\n}\neat.call(drink, 3, 2) //5\n```\n\n这个例子中的意思就是用 eat 来替换 drink，eat.call(drink,3,2) == eat(3,2)\n\n```javascript\nfunction Animal() {\n  this.name = 'animal'\n  this.showName = function () {\n    console.log(this.name)\n  }\n}\nfunction Dog() {\n  this.name = 'dog'\n}\nvar animal = new Animal()\nvar dog = new Dog()\n\nanimal.showName.call(dog) //dog\n```\n\n意思是把 animal 的方法放到 dog 上执行，也可以说，把 animal 的 showName() 方法放到 dog 上来执行，所以 this.name 应该是 dog。\n\n```javascript\nfunction fruits() {}\nfruits.prototype = {\n  color: 'red',\n  say: function (a, b) {\n    console.log('my color is ' + this.color + ' ' + a + '' + b)\n  },\n}\n\nvar apple = new fruits()\napple.say() //my color is red undefinedundefined\n\nbanana = {\n  color: 'yellow',\n}\napple.say.call(banana, 'red', 'blue') //my color is yellowredblue\napple.say.apply(banana) //my color is yellow undefinedundefined\n```\n\n所以可以看出`call`和`apply`是为了动态改变 this 二存在的，当一个 object 没有某个方法。但是其他的有。我们可以借助 call 或 apply 用其他对象的方法来操作。\n\n```javascript\nfunc.call(this, arg1, arg2)\nfunc.apply(this, [arg1, arg2])\n```\n\n**查找数组中的最大值**\n\n```javascript\nvar numbers = [5, 458, 120, -215]\nMath.max.apply(Math, numbers) //458\nMath.max.call(Math, 5, 458, 120, -215) //458\n\n// ES6\nMath.max.call(Math, ...numbers) // 458\n\n//或者\nvar arr = [1, 2, 3]\nvar max = Math.max(...arr)\n```\n\n## 继承\n\n\n```javascript\nfunction Animal(name) {\n  this.name = name\n  this.showName = function () {\n    console.log(this.name)\n  }\n}\nfunction Dog(name) {\n  Animal.call(this, name)\n}\nvar dog = new Dog('Crazy dog')\ndog.showName()\n```\n\nAnimal.call(this) 的意思就是使用 Animal 对象代替 this 对象，那么 Dog 就能直接调用 Animal 的所有属性和方法。\n\n```javascript\nvar toString = Object.prototype.toString\nconsole.log(toString.call(2)) //[object Number]\nconsole.log(toString.call(true)) //[object Boolean]\nconsole.log(toString.call(function () {})) //[object Function]\n```\n\n## apply\n\n```javascript\nfunction class1(args1, args2) {\n  this.name = function () {\n    console.log(args, args)\n  }\n}\nfunction class2() {\n  var args1 = '1'\n  var args2 = '2'\n  class1.call(this, args1, args2)\n  /*或*/\n  class1.apply(this, [args1, args2])\n}\n\nvar c = new class2()\nc.name()\n```\n\n## bind\n\nbind 是在 EcmaScript5 中扩展的方法（IE6,7,8 不支持。)\n\nbind() 方法会创建一个新函数，称为绑定函数，当调用这个绑定函数时，绑定函数会以创建它时传入 bind() 方法的第一个参数作为 this，传入 bind() 方法的第二个以及以后的参数加上绑定函数运行时本身的参数按照顺序作为原函数的参数来调用原函数。\n\n```javascript\nvar bar = function () {\n  console.log(this.x)\n}\nvar foo = {\n  x: 3,\n}\nbar()\nbar.bind(foo)() //undefined 3\n/*或*/\nvar func = bar.bind(foo)\nfunc()\n```\n","slug":"call、applay、bind","published":1,"updated":"2021-04-03T03:28:14.384Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1wz0017l5v03u5i8cq5","content":"<ul>\n<li>都是用来改变函数的 this 对象的指向的。</li>\n<li>第一个参数都是 this 要指向的对象。</li>\n<li>参数、绑定规则（显示绑定和强绑定），运行效率（最终都会转换成一个一个的参数去运行）、运行情况（call ， apply 立即执行，bind 是 return 出一个 this “ 固定 ” 的函数，这也是为什么 bind 是强绑定的一个原因）。</li>\n<li>在<code>javascipt</code>中，<code>call</code>和<code>apply</code>都是为了改变某个函数运行时的上下文而存在的，换句话说就是为了改变函数体内部<code>this</code>的指向。<span id=\"more\"></span>\n\n</li>\n</ul>\n<h2 id=\"call\"><a href=\"#call\" class=\"headerlink\" title=\"call()\"></a>call()</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class1</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.names)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;我是class1内的方法&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.names = <span class=\"string\">&#x27;class2内部变量&#x27;</span></span><br><span class=\"line\">  class1.call(<span class=\"built_in\">this</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//class2内部变量 我是class1内的方法</span></span><br><span class=\"line\">  <span class=\"comment\">//此行代码执行后，当前的this指向了class1（也可以说class2继承了class1）</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = <span class=\"keyword\">new</span> class2()</span><br><span class=\"line\">f.name() <span class=\"comment\">//调用的是class1内的方法，将class1的name方法交给class2使用</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x + y)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drink</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x - y)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">eat.call(drink, <span class=\"number\">3</span>, <span class=\"number\">2</span>) <span class=\"comment\">//5</span></span><br></pre></td></tr></table></figure>\n\n<p>这个例子中的意思就是用 eat 来替换 drink，eat.call(drink,3,2) == eat(3,2)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Animal</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;animal&#x27;</span></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.showName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dog</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;dog&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> animal = <span class=\"keyword\">new</span> Animal()</span><br><span class=\"line\"><span class=\"keyword\">var</span> dog = <span class=\"keyword\">new</span> Dog()</span><br><span class=\"line\"></span><br><span class=\"line\">animal.showName.call(dog) <span class=\"comment\">//dog</span></span><br></pre></td></tr></table></figure>\n\n<p>意思是把 animal 的方法放到 dog 上执行，也可以说，把 animal 的 showName() 方法放到 dog 上来执行，所以 this.name 应该是 dog。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fruits</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">fruits.prototype = &#123;</span><br><span class=\"line\">  color: <span class=\"string\">&#x27;red&#x27;</span>,</span><br><span class=\"line\">  say: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;my color is &#x27;</span> + <span class=\"built_in\">this</span>.color + <span class=\"string\">&#x27; &#x27;</span> + a + <span class=\"string\">&#x27;&#x27;</span> + b)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> apple = <span class=\"keyword\">new</span> fruits()</span><br><span class=\"line\">apple.say() <span class=\"comment\">//my color is red undefinedundefined</span></span><br><span class=\"line\"></span><br><span class=\"line\">banana = &#123;</span><br><span class=\"line\">  color: <span class=\"string\">&#x27;yellow&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">apple.say.call(banana, <span class=\"string\">&#x27;red&#x27;</span>, <span class=\"string\">&#x27;blue&#x27;</span>) <span class=\"comment\">//my color is yellowredblue</span></span><br><span class=\"line\">apple.say.apply(banana) <span class=\"comment\">//my color is yellow undefinedundefined</span></span><br></pre></td></tr></table></figure>\n\n<p>所以可以看出<code>call</code>和<code>apply</code>是为了动态改变 this 二存在的，当一个 object 没有某个方法。但是其他的有。我们可以借助 call 或 apply 用其他对象的方法来操作。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">func.call(<span class=\"built_in\">this</span>, arg1, arg2)</span><br><span class=\"line\">func.apply(<span class=\"built_in\">this</span>, [arg1, arg2])</span><br></pre></td></tr></table></figure>\n\n<p><strong>查找数组中的最大值</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> numbers = [<span class=\"number\">5</span>, <span class=\"number\">458</span>, <span class=\"number\">120</span>, -<span class=\"number\">215</span>]</span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max.apply(<span class=\"built_in\">Math</span>, numbers) <span class=\"comment\">//458</span></span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max.call(<span class=\"built_in\">Math</span>, <span class=\"number\">5</span>, <span class=\"number\">458</span>, <span class=\"number\">120</span>, -<span class=\"number\">215</span>) <span class=\"comment\">//458</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6</span></span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max.call(<span class=\"built_in\">Math</span>, ...numbers) <span class=\"comment\">// 458</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//或者</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> max = <span class=\"built_in\">Math</span>.max(...arr)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Animal</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.showName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dog</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  Animal.call(<span class=\"built_in\">this</span>, name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> dog = <span class=\"keyword\">new</span> Dog(<span class=\"string\">&#x27;Crazy dog&#x27;</span>)</span><br><span class=\"line\">dog.showName()</span><br></pre></td></tr></table></figure>\n\n<p>Animal.call(this) 的意思就是使用 Animal 对象代替 this 对象，那么 Dog 就能直接调用 Animal 的所有属性和方法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> toString = <span class=\"built_in\">Object</span>.prototype.toString</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toString.call(<span class=\"number\">2</span>)) <span class=\"comment\">//[object Number]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toString.call(<span class=\"literal\">true</span>)) <span class=\"comment\">//[object Boolean]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toString.call(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;)) <span class=\"comment\">//[object Function]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"apply\"><a href=\"#apply\" class=\"headerlink\" title=\"apply\"></a>apply</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class1</span>(<span class=\"params\">args1, args2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(args, args)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> args1 = <span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args2 = <span class=\"string\">&#x27;2&#x27;</span></span><br><span class=\"line\">  class1.call(<span class=\"built_in\">this</span>, args1, args2)</span><br><span class=\"line\">  <span class=\"comment\">/*或*/</span></span><br><span class=\"line\">  class1.apply(<span class=\"built_in\">this</span>, [args1, args2])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> class2()</span><br><span class=\"line\">c.name()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"bind\"><a href=\"#bind\" class=\"headerlink\" title=\"bind\"></a>bind</h2><p>bind 是在 EcmaScript5 中扩展的方法（IE6,7,8 不支持。)</p>\n<p>bind() 方法会创建一个新函数，称为绑定函数，当调用这个绑定函数时，绑定函数会以创建它时传入 bind() 方法的第一个参数作为 this，传入 bind() 方法的第二个以及以后的参数加上绑定函数运行时本身的参数按照顺序作为原函数的参数来调用原函数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.x)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">  x: <span class=\"number\">3</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar()</span><br><span class=\"line\">bar.bind(foo)() <span class=\"comment\">//undefined 3</span></span><br><span class=\"line\"><span class=\"comment\">/*或*/</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> func = bar.bind(foo)</span><br><span class=\"line\">func()</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<ul>\n<li>都是用来改变函数的 this 对象的指向的。</li>\n<li>第一个参数都是 this 要指向的对象。</li>\n<li>参数、绑定规则（显示绑定和强绑定），运行效率（最终都会转换成一个一个的参数去运行）、运行情况（call ， apply 立即执行，bind 是 return 出一个 this “ 固定 ” 的函数，这也是为什么 bind 是强绑定的一个原因）。</li>\n<li>在<code>javascipt</code>中，<code>call</code>和<code>apply</code>都是为了改变某个函数运行时的上下文而存在的，换句话说就是为了改变函数体内部<code>this</code>的指向。","more":"</li>\n</ul>\n<h2 id=\"call\"><a href=\"#call\" class=\"headerlink\" title=\"call()\"></a>call()</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class1</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.names)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;我是class1内的方法&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.names = <span class=\"string\">&#x27;class2内部变量&#x27;</span></span><br><span class=\"line\">  class1.call(<span class=\"built_in\">this</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//class2内部变量 我是class1内的方法</span></span><br><span class=\"line\">  <span class=\"comment\">//此行代码执行后，当前的this指向了class1（也可以说class2继承了class1）</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = <span class=\"keyword\">new</span> class2()</span><br><span class=\"line\">f.name() <span class=\"comment\">//调用的是class1内的方法，将class1的name方法交给class2使用</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x + y)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drink</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x - y)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">eat.call(drink, <span class=\"number\">3</span>, <span class=\"number\">2</span>) <span class=\"comment\">//5</span></span><br></pre></td></tr></table></figure>\n\n<p>这个例子中的意思就是用 eat 来替换 drink，eat.call(drink,3,2) == eat(3,2)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Animal</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;animal&#x27;</span></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.showName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dog</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;dog&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> animal = <span class=\"keyword\">new</span> Animal()</span><br><span class=\"line\"><span class=\"keyword\">var</span> dog = <span class=\"keyword\">new</span> Dog()</span><br><span class=\"line\"></span><br><span class=\"line\">animal.showName.call(dog) <span class=\"comment\">//dog</span></span><br></pre></td></tr></table></figure>\n\n<p>意思是把 animal 的方法放到 dog 上执行，也可以说，把 animal 的 showName() 方法放到 dog 上来执行，所以 this.name 应该是 dog。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fruits</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">fruits.prototype = &#123;</span><br><span class=\"line\">  color: <span class=\"string\">&#x27;red&#x27;</span>,</span><br><span class=\"line\">  say: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;my color is &#x27;</span> + <span class=\"built_in\">this</span>.color + <span class=\"string\">&#x27; &#x27;</span> + a + <span class=\"string\">&#x27;&#x27;</span> + b)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> apple = <span class=\"keyword\">new</span> fruits()</span><br><span class=\"line\">apple.say() <span class=\"comment\">//my color is red undefinedundefined</span></span><br><span class=\"line\"></span><br><span class=\"line\">banana = &#123;</span><br><span class=\"line\">  color: <span class=\"string\">&#x27;yellow&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">apple.say.call(banana, <span class=\"string\">&#x27;red&#x27;</span>, <span class=\"string\">&#x27;blue&#x27;</span>) <span class=\"comment\">//my color is yellowredblue</span></span><br><span class=\"line\">apple.say.apply(banana) <span class=\"comment\">//my color is yellow undefinedundefined</span></span><br></pre></td></tr></table></figure>\n\n<p>所以可以看出<code>call</code>和<code>apply</code>是为了动态改变 this 二存在的，当一个 object 没有某个方法。但是其他的有。我们可以借助 call 或 apply 用其他对象的方法来操作。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">func.call(<span class=\"built_in\">this</span>, arg1, arg2)</span><br><span class=\"line\">func.apply(<span class=\"built_in\">this</span>, [arg1, arg2])</span><br></pre></td></tr></table></figure>\n\n<p><strong>查找数组中的最大值</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> numbers = [<span class=\"number\">5</span>, <span class=\"number\">458</span>, <span class=\"number\">120</span>, -<span class=\"number\">215</span>]</span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max.apply(<span class=\"built_in\">Math</span>, numbers) <span class=\"comment\">//458</span></span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max.call(<span class=\"built_in\">Math</span>, <span class=\"number\">5</span>, <span class=\"number\">458</span>, <span class=\"number\">120</span>, -<span class=\"number\">215</span>) <span class=\"comment\">//458</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6</span></span><br><span class=\"line\"><span class=\"built_in\">Math</span>.max.call(<span class=\"built_in\">Math</span>, ...numbers) <span class=\"comment\">// 458</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//或者</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> max = <span class=\"built_in\">Math</span>.max(...arr)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Animal</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.showName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Dog</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  Animal.call(<span class=\"built_in\">this</span>, name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> dog = <span class=\"keyword\">new</span> Dog(<span class=\"string\">&#x27;Crazy dog&#x27;</span>)</span><br><span class=\"line\">dog.showName()</span><br></pre></td></tr></table></figure>\n\n<p>Animal.call(this) 的意思就是使用 Animal 对象代替 this 对象，那么 Dog 就能直接调用 Animal 的所有属性和方法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> toString = <span class=\"built_in\">Object</span>.prototype.toString</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toString.call(<span class=\"number\">2</span>)) <span class=\"comment\">//[object Number]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toString.call(<span class=\"literal\">true</span>)) <span class=\"comment\">//[object Boolean]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toString.call(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;)) <span class=\"comment\">//[object Function]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"apply\"><a href=\"#apply\" class=\"headerlink\" title=\"apply\"></a>apply</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class1</span>(<span class=\"params\">args1, args2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(args, args)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> args1 = <span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args2 = <span class=\"string\">&#x27;2&#x27;</span></span><br><span class=\"line\">  class1.call(<span class=\"built_in\">this</span>, args1, args2)</span><br><span class=\"line\">  <span class=\"comment\">/*或*/</span></span><br><span class=\"line\">  class1.apply(<span class=\"built_in\">this</span>, [args1, args2])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> class2()</span><br><span class=\"line\">c.name()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"bind\"><a href=\"#bind\" class=\"headerlink\" title=\"bind\"></a>bind</h2><p>bind 是在 EcmaScript5 中扩展的方法（IE6,7,8 不支持。)</p>\n<p>bind() 方法会创建一个新函数，称为绑定函数，当调用这个绑定函数时，绑定函数会以创建它时传入 bind() 方法的第一个参数作为 this，传入 bind() 方法的第二个以及以后的参数加上绑定函数运行时本身的参数按照顺序作为原函数的参数来调用原函数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.x)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">  x: <span class=\"number\">3</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar()</span><br><span class=\"line\">bar.bind(foo)() <span class=\"comment\">//undefined 3</span></span><br><span class=\"line\"><span class=\"comment\">/*或*/</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> func = bar.bind(foo)</span><br><span class=\"line\">func()</span><br></pre></td></tr></table></figure>"},{"title":"css 小知识","date":"2019-04-03T03:30:11.000Z","_content":"\ncss 在开发中的填坑总结\n\n<!--more-->\n\n## 利用 css 的 content 属性 attr 抓取资料\n\n想要获取伪元素，可以用以下写法：\n\n```html\n<div data-msg=\"open\"></div>\ndiv:hover:after{ content:attr(data-mag); }\n```\n\n## 利用：valid 和：invalid 来做表单即使校验\n\n- :required 伪类指定具有 required 属性的表单元素\n- :valid 伪类指定一个通过匹配正确的所要求的表单元素\n- :invalid 伪类指定一个不匹配指定要求的表单元素\n\n## writing-mode\n\n使用 writing-mode 这个 CSS 属性实现容器的文字从上往下排列。 writing-mode: vertical-rl;\n\n## 实现鼠标悬浮内容自动撑开的过渡动画\n\n需要为一个列表添加个动画，容器的高度是不确定的，也就是高度为 auto，悬浮时候撑开内容有个过渡动画。而用 CSS3 实现的话，由于高度的不确定，而 transtion 是需要具体的数值，所以设置 height:auto 是无法实现效果的，可以通过 max-height 这个属性间接的实现这么个效果，css 样式是这样的：\n\n```html\n<ul>\n  <li>\n    <div class=\"hd\">列表1</div>\n    <div class=\"bd\">列表内容<br />内容列表内容<br />内容列表内容<br />内容</div>\n  </li>\n  <li>\n    <div class=\"hd\">列表1</div>\n    <div class=\"bd\">列表内容<br />内容列表内容<br />内容列表内容<br />内容</div>\n  </li>\n  <li>\n    <div class=\"hd\">列表1</div>\n    <div class=\"bd\">列表内容<br />内容列表内容<br />内容列表内容<br />内容</div>\n  </li>\n</ul>\n.bd { max-height:0; overflow:hidden; transition: all 1s ease-out; } li:hover .bd\n{ max-height: 600px; transition-timing-function: ease-in; }\n```\n\n## 移动端 web 页面支持弹性滚动\n\n-webkit-overflow-scrolling: touch;\n\n## 美化浏览器自带的 radio ，checkbox 属性\n\n```html\n<div class=\"radio-beauty-container\">\n  <label>\n    <span class=\"radio-name\">前端工程师</span>\n    <input type=\"radio\" name=\"radioName\" id=\"radioName1\" hidden />\n    <label for=\"radioName1\" class=\"radio-beauty\"></label>\n  </label>\n  <label>\n    <span class=\"radio-name\">后端工程师</span>\n    <input type=\"radio\" name=\"radioName\" id=\"radioName2\" hidden />\n    <label for=\"radioName2\" class=\"radio-beauty\"></label>\n  </label>\n  <label>\n    <span class=\"radio-name\">全栈工程师</span>\n    <input type=\"radio\" name=\"radioName\" id=\"radioName3\" hidden />\n    <label for=\"radioName3\" class=\"radio-beauty\"></label>\n  </label>\n</div>\n.radio-beauty-container { font-size: 0; $bgc: green; %common { padding: 2px;\nbackground-color: $bgc; background-clip: content-box; } .radio-name {\nvertical-align: middle; font-size: 16px; } .radio-beauty { width: 18px; height:\n18px; box-sizing: border-box; display: inline-block; border: 1px solid $bgc;\nvertical-align: middle; margin: 0 15px 0 3px; border-radius: 50%; &:hover {\nbox-shadow: 0 0 7px $bgc; @extend %common; } }\ninput[type=\"radio\"]:checked+.radio-beauty { @extend %common; } }\n```\n\n## 改变 input 焦点光标的颜色\n\n```html\n<input value=\"This field uses a default caret.\" />\n<input class=\"custom\" value=\"I have a custom caret color!\" />\ninput { caret-color: auto; display: block; margin-bottom: .5em; } input.custom {\ncaret-color: red; }\n```\n\n## rem 布局不再使用 JavaScript 设置\n\n现在移动端 css3 单位 vw ,wh 兼容性已经很不错了，在不需要兼容太低版本的安卓机情况下可以这样来：\n\n```css\nhtml {\n  font-size: 100vw / 750;\n}\n```\n\n## 切角效果实现\n\n切角效果是时下非常流行的一种设计风格，并广泛运用于平面设计中，它最常见的形态就是把元素的一个或多个切成 45° 的切口，尤其是在最近几年，扁平化设计盖过拟物化设计后，这种切脚设计更为流行，例如下图就是通过切角实现的一个导航栏，在后面将详细论述起实现。\n\n![network](https://camo.githubusercontent.com/b07ae76cf4ce21d62ef2a4ce97932d831e723c50/687474703a2f2f636f6e74656e742d6d616e6167656d656e742e62302e7570616979756e2e636f6d2f313437323739393439333539332e706e67)\n\n## 响应式页面开发\n\n在页头`head`标签内添加`viewoport meta`是实现响应式页面的第一步。\n\n```html\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n```\n\n### 使用`Media Queries`\n\n- 使用 link 标签 ，根据指定特性引入特定的外部样式文件\n\n  ```html\n  <link rel=\"stylesheet\" media=\"(max-width:640px)\" href=\"max-640px.css\" />\n  ```\n\n- 直接在 style 标签或样式文件内使用`@media`规则\n\n### 样式断点\n\n- moblie 移动设备断点 ，视窗宽度<=768px\n- tablet 平板电脑设备断点，视窗宽度>=769px\n- desktop 桌面电脑断点，视窗宽度>=1024px\n- widescreen 宽屏电脑断点，视窗宽度>=1216px\n- fullhd 高清宽屏电脑断点，视窗宽度>=1408px\n\n## 1px 细线（普通屏幕下 1px，高清屏下 0.5px 的情况）\n\n```css\n.mod_grid {\n    position: relative;\n    &::after {\n        // 实现1物理像素的下边框线\n        content: '';\n        position: absolute;\n        z-index: 1;\n        pointer-events: none;\n        background-color: #ddd;\n        height: 1px;\n        left: 0;\n        right: 0;\n        top: 0;\n        @media only screen and (-webkit-min-device-pixel-ratio: 2) {\n            -webkit-transform: scaleY(0.5);\n            -webkit-transform-origin: 50% 0%;\n        }\n    }\n    ...\n}...\n```\n\n## 需要保持宽高比的图，应该用 padding-top 实现\n\n```css\n.mod_banner {\n  position: relative;\n  /* 使用padding-top 实现宽高比为 100:750 的图片区域 */\n  padding-top: percentage(100/750);\n  height: 0;\n  overflow: hidden;\n  img {\n    width: 100%;\n    height: auto;\n    position: absolute;\n    left: 0;\n    top: 0;\n  }\n}\n```\n\n## `input type=file onchange`\n\n- 上传同一张图片失效\n- 在微信浏览器内无法上传图片 (经测试是不支持`input type=file` 就算支持也无法上传 camera 目录下的文件 )\n\n```javascript\n$fileInput.on('change', function (e) {\n  e.target.value = ''\n})\n```\n\n第二个问题实在没有找到方法 准备使用带有 flash 的插件\n使用百度网盘，饿了么的网页在微信中有同样的问题\n\n## `meta viewport`\n\n```html\n<!DOCTYPE html> H5标准声明，使用 HTML5 doctype，不区分大小写\n<head lang=\"”en”\">\n  标准的 lang 属性写法\n  <meta charset=\"’utf-8′\" />\n  声明文档使用的字符编码\n  <meta http-equiv=\"”X-UA-Compatible”\" content=\"”IE\" =\"edge,chrome\" =\"1″\" />\n  优先使用 IE 最新版本和 Chrome\n  <meta name=\"”description”\" content=\"”不超过150个字符”\" />\n  页面描述\n  <meta name=\"”keywords”\" content=\"””\" />\n  页面关键词\n  <meta name=\"”author”\" content=\"”name,\" email@gmail.com” />\n  网页作者\n  <meta name=\"”robots”\" content=\"”index,follow”\" />\n  搜索引擎抓取\n  <meta\n    name=\"”viewport”\"\n    content=\"”initial-scale\"\n    =\"1,\"\n    maximum-scale=\"3,\"\n    minimum-scale=\"1,\"\n    user-scalable=\"no”\"\n  />\n  为移动设备添加 viewport\n  <meta name=\"”apple-mobile-web-app-title”\" content=\"”标题”\" />\n  iOS 设备 begin\n  <meta name=\"”apple-mobile-web-app-capable”\" content=\"”yes”\" />\n  添加到主屏后的标题（iOS 6 新增）是否启用 WebApp\n  全屏模式，删除苹果默认的工具栏和菜单栏\n  <meta\n    name=\"”apple-itunes-app”\"\n    content=\"”app-id\"\n    =\"myAppStoreID,\"\n    affiliate-data=\"myAffiliateData,\"\n    app-argument=\"myURL”\"\n  />\n  添加智能 App 广告条 Smart App Banner（iOS 6+ Safari）\n  <meta name=\"”apple-mobile-web-app-status-bar-style”\" content=\"”black”\" />\n  <meta name=\"”format-detection”\" content=\"”telphone\" =\"no,\" email=\"no”\" />\n  设置苹果工具栏颜色\n  <meta name=\"”renderer”\" content=\"”webkit”\" />\n  启用360浏览器的极速模式(webkit)\n  <meta http-equiv=\"”X-UA-Compatible”\" content=\"”IE\" =\"edge”\" />\n  避免IE使用兼容模式\n  <meta http-equiv=\"”Cache-Control”\" content=\"”no-siteapp”\" />\n  不让百度转码\n  <meta name=\"”HandheldFriendly”\" content=\"”true”\" />\n  针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓\n  <meta name=\"”MobileOptimized”\" content=\"”320″\" />\n  微软的老式浏览器\n  <meta name=\"”screen-orientation”\" content=\"”portrait”\" />\n  uc强制竖屏\n  <meta name=\"”x5-orientation”\" content=\"”portrait”\" />\n  QQ强制竖屏\n  <meta name=\"”full-screen”\" content=\"”yes”\" />\n  UC强制全屏\n  <meta name=\"”x5-fullscreen”\" content=\"”true”\" />\n  QQ强制全屏\n  <meta name=\"”browsermode”\" content=\"”application”\" />\n  UC应用模式\n  <meta name=\"”x5-page-mode”\" content=\"”app”\" />\n  QQ应用模式\n  <meta name=\"”msapplication-tap-highlight”\" content=\"”no”\" />\n  windows phone 点击无高光设置页面不缓存\n  <meta http-equiv=\"”pragma”\" content=\"”no-cache”\" />\n  <meta http-equiv=\"”cache-control”\" content=\"”no-cache”\" />\n  <meta http-equiv=\"”expires”\" content=\"”0″\" />\n</head>\n```\n\n## 字少时居中，多时靠左\n\n```html\n<div class=\"box\">\n  <p class=\"content\"></p>\n</div>\n\n<!-- CSS -->\n<style>\n  .box {\n    text-align: center;\n  }\n  .content {\n    display: inline-block;\n    text-align: left;\n    word-break: break-all;\n  }\n</style>\n```\n\n## CSS 权重\n\n权重分为 4 级，分别是：\n\n- 内联样式:1000\n- id:100\n- 类，伪类和属性选择器 `:hover`,`[attributer]`,权值为 10\n- 代表元素选择器和伪元素选择器，`div`\n\n** 需要注意的是：通用选择器（\\*），子选择器（>）和相邻通报选择器并不在这四个等级中，所以他们的权值为 0**\n\n## CSS3 动画\n\n- `animation-name`:对应的动画名称\n- `animation-duration`:是动画时长\n- `animation-timing-function`:规定动画的速度曲线。默认是 ease\n- `animation-delay`:规定动画何时开始。默认是 0\n- `animation-iteration-count`:规定动画播放的次数。默认是 1\n- `animation-diraction`:规定动画是否在下一周期逆向地播放。默认是 normal\n- `animation-play-state`:规定动画是否正在运行或暂停。默认是 running\n- `animation-fill-mode`:规定动画执行之前和之后如何给动画的目标应用，默认是 none，保留在最后一帧可以用 forwords\n\n### 实现动画暂停\n\n使用`animation-play-state`可以实现动画暂停\n\n```css\n.play-state {\n  width: 100px;\n  height: 100px;\n  margin: 40px;\n  text-align: center;\n  line-height: 94px;\n  border: 3px solid #e1efde;\n  border-radius: 50%;\n  animation: play-state 3s linear infinite;\n  cursor: pointer;\n}\n.play-state:hover {\n  animation-play-state: paused;\n}\n@keyframes play-state {\n  0% {\n    margin-left: 0;\n  }\n  100% {\n    margin-left: 200px;\n  }\n}\n```\n\n## 重绘和回流\n\n- 重绘：指的是当前页面中的元素不脱离文档流。而简单的样式的变化，比如修改颜色，背景等，浏览器重新绘制样式\n- 回流：指的是处于文档流中 DOM 的尺寸大小，位置或者默写属性变化时，导致浏览器重新渲染部分或全部文档的情况\n\n## 首行缩进\n\n```css\ntext-indent: 2em;\n```\n\n## 一种奇妙的绝对居中办法\n\n```html\n<style>\n  .wp {\n    writing-mode: vertical-lr;\n    text-align: center;\n  }\n  .wp-inner {\n    writing-mode: horizontal-tb;\n    display: inline-block;\n    text-align: center;\n    width: 100%;\n  }\n  .box {\n    display: inline-block;\n    margin: auto;\n    text-align: left;\n  }\n</style>\n<div class=\"wp\">\n  <div class=\"wp-inner\">\n    <div class=\"box\">123123</div>\n  </div>\n</div>\n```\n","source":"_posts/css-小知识.md","raw":"---\ntitle: css 小知识\ndate: 2019-04-03 11:30:11\ncategories: css\n---\n\ncss 在开发中的填坑总结\n\n<!--more-->\n\n## 利用 css 的 content 属性 attr 抓取资料\n\n想要获取伪元素，可以用以下写法：\n\n```html\n<div data-msg=\"open\"></div>\ndiv:hover:after{ content:attr(data-mag); }\n```\n\n## 利用：valid 和：invalid 来做表单即使校验\n\n- :required 伪类指定具有 required 属性的表单元素\n- :valid 伪类指定一个通过匹配正确的所要求的表单元素\n- :invalid 伪类指定一个不匹配指定要求的表单元素\n\n## writing-mode\n\n使用 writing-mode 这个 CSS 属性实现容器的文字从上往下排列。 writing-mode: vertical-rl;\n\n## 实现鼠标悬浮内容自动撑开的过渡动画\n\n需要为一个列表添加个动画，容器的高度是不确定的，也就是高度为 auto，悬浮时候撑开内容有个过渡动画。而用 CSS3 实现的话，由于高度的不确定，而 transtion 是需要具体的数值，所以设置 height:auto 是无法实现效果的，可以通过 max-height 这个属性间接的实现这么个效果，css 样式是这样的：\n\n```html\n<ul>\n  <li>\n    <div class=\"hd\">列表1</div>\n    <div class=\"bd\">列表内容<br />内容列表内容<br />内容列表内容<br />内容</div>\n  </li>\n  <li>\n    <div class=\"hd\">列表1</div>\n    <div class=\"bd\">列表内容<br />内容列表内容<br />内容列表内容<br />内容</div>\n  </li>\n  <li>\n    <div class=\"hd\">列表1</div>\n    <div class=\"bd\">列表内容<br />内容列表内容<br />内容列表内容<br />内容</div>\n  </li>\n</ul>\n.bd { max-height:0; overflow:hidden; transition: all 1s ease-out; } li:hover .bd\n{ max-height: 600px; transition-timing-function: ease-in; }\n```\n\n## 移动端 web 页面支持弹性滚动\n\n-webkit-overflow-scrolling: touch;\n\n## 美化浏览器自带的 radio ，checkbox 属性\n\n```html\n<div class=\"radio-beauty-container\">\n  <label>\n    <span class=\"radio-name\">前端工程师</span>\n    <input type=\"radio\" name=\"radioName\" id=\"radioName1\" hidden />\n    <label for=\"radioName1\" class=\"radio-beauty\"></label>\n  </label>\n  <label>\n    <span class=\"radio-name\">后端工程师</span>\n    <input type=\"radio\" name=\"radioName\" id=\"radioName2\" hidden />\n    <label for=\"radioName2\" class=\"radio-beauty\"></label>\n  </label>\n  <label>\n    <span class=\"radio-name\">全栈工程师</span>\n    <input type=\"radio\" name=\"radioName\" id=\"radioName3\" hidden />\n    <label for=\"radioName3\" class=\"radio-beauty\"></label>\n  </label>\n</div>\n.radio-beauty-container { font-size: 0; $bgc: green; %common { padding: 2px;\nbackground-color: $bgc; background-clip: content-box; } .radio-name {\nvertical-align: middle; font-size: 16px; } .radio-beauty { width: 18px; height:\n18px; box-sizing: border-box; display: inline-block; border: 1px solid $bgc;\nvertical-align: middle; margin: 0 15px 0 3px; border-radius: 50%; &:hover {\nbox-shadow: 0 0 7px $bgc; @extend %common; } }\ninput[type=\"radio\"]:checked+.radio-beauty { @extend %common; } }\n```\n\n## 改变 input 焦点光标的颜色\n\n```html\n<input value=\"This field uses a default caret.\" />\n<input class=\"custom\" value=\"I have a custom caret color!\" />\ninput { caret-color: auto; display: block; margin-bottom: .5em; } input.custom {\ncaret-color: red; }\n```\n\n## rem 布局不再使用 JavaScript 设置\n\n现在移动端 css3 单位 vw ,wh 兼容性已经很不错了，在不需要兼容太低版本的安卓机情况下可以这样来：\n\n```css\nhtml {\n  font-size: 100vw / 750;\n}\n```\n\n## 切角效果实现\n\n切角效果是时下非常流行的一种设计风格，并广泛运用于平面设计中，它最常见的形态就是把元素的一个或多个切成 45° 的切口，尤其是在最近几年，扁平化设计盖过拟物化设计后，这种切脚设计更为流行，例如下图就是通过切角实现的一个导航栏，在后面将详细论述起实现。\n\n![network](https://camo.githubusercontent.com/b07ae76cf4ce21d62ef2a4ce97932d831e723c50/687474703a2f2f636f6e74656e742d6d616e6167656d656e742e62302e7570616979756e2e636f6d2f313437323739393439333539332e706e67)\n\n## 响应式页面开发\n\n在页头`head`标签内添加`viewoport meta`是实现响应式页面的第一步。\n\n```html\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n```\n\n### 使用`Media Queries`\n\n- 使用 link 标签 ，根据指定特性引入特定的外部样式文件\n\n  ```html\n  <link rel=\"stylesheet\" media=\"(max-width:640px)\" href=\"max-640px.css\" />\n  ```\n\n- 直接在 style 标签或样式文件内使用`@media`规则\n\n### 样式断点\n\n- moblie 移动设备断点 ，视窗宽度<=768px\n- tablet 平板电脑设备断点，视窗宽度>=769px\n- desktop 桌面电脑断点，视窗宽度>=1024px\n- widescreen 宽屏电脑断点，视窗宽度>=1216px\n- fullhd 高清宽屏电脑断点，视窗宽度>=1408px\n\n## 1px 细线（普通屏幕下 1px，高清屏下 0.5px 的情况）\n\n```css\n.mod_grid {\n    position: relative;\n    &::after {\n        // 实现1物理像素的下边框线\n        content: '';\n        position: absolute;\n        z-index: 1;\n        pointer-events: none;\n        background-color: #ddd;\n        height: 1px;\n        left: 0;\n        right: 0;\n        top: 0;\n        @media only screen and (-webkit-min-device-pixel-ratio: 2) {\n            -webkit-transform: scaleY(0.5);\n            -webkit-transform-origin: 50% 0%;\n        }\n    }\n    ...\n}...\n```\n\n## 需要保持宽高比的图，应该用 padding-top 实现\n\n```css\n.mod_banner {\n  position: relative;\n  /* 使用padding-top 实现宽高比为 100:750 的图片区域 */\n  padding-top: percentage(100/750);\n  height: 0;\n  overflow: hidden;\n  img {\n    width: 100%;\n    height: auto;\n    position: absolute;\n    left: 0;\n    top: 0;\n  }\n}\n```\n\n## `input type=file onchange`\n\n- 上传同一张图片失效\n- 在微信浏览器内无法上传图片 (经测试是不支持`input type=file` 就算支持也无法上传 camera 目录下的文件 )\n\n```javascript\n$fileInput.on('change', function (e) {\n  e.target.value = ''\n})\n```\n\n第二个问题实在没有找到方法 准备使用带有 flash 的插件\n使用百度网盘，饿了么的网页在微信中有同样的问题\n\n## `meta viewport`\n\n```html\n<!DOCTYPE html> H5标准声明，使用 HTML5 doctype，不区分大小写\n<head lang=\"”en”\">\n  标准的 lang 属性写法\n  <meta charset=\"’utf-8′\" />\n  声明文档使用的字符编码\n  <meta http-equiv=\"”X-UA-Compatible”\" content=\"”IE\" =\"edge,chrome\" =\"1″\" />\n  优先使用 IE 最新版本和 Chrome\n  <meta name=\"”description”\" content=\"”不超过150个字符”\" />\n  页面描述\n  <meta name=\"”keywords”\" content=\"””\" />\n  页面关键词\n  <meta name=\"”author”\" content=\"”name,\" email@gmail.com” />\n  网页作者\n  <meta name=\"”robots”\" content=\"”index,follow”\" />\n  搜索引擎抓取\n  <meta\n    name=\"”viewport”\"\n    content=\"”initial-scale\"\n    =\"1,\"\n    maximum-scale=\"3,\"\n    minimum-scale=\"1,\"\n    user-scalable=\"no”\"\n  />\n  为移动设备添加 viewport\n  <meta name=\"”apple-mobile-web-app-title”\" content=\"”标题”\" />\n  iOS 设备 begin\n  <meta name=\"”apple-mobile-web-app-capable”\" content=\"”yes”\" />\n  添加到主屏后的标题（iOS 6 新增）是否启用 WebApp\n  全屏模式，删除苹果默认的工具栏和菜单栏\n  <meta\n    name=\"”apple-itunes-app”\"\n    content=\"”app-id\"\n    =\"myAppStoreID,\"\n    affiliate-data=\"myAffiliateData,\"\n    app-argument=\"myURL”\"\n  />\n  添加智能 App 广告条 Smart App Banner（iOS 6+ Safari）\n  <meta name=\"”apple-mobile-web-app-status-bar-style”\" content=\"”black”\" />\n  <meta name=\"”format-detection”\" content=\"”telphone\" =\"no,\" email=\"no”\" />\n  设置苹果工具栏颜色\n  <meta name=\"”renderer”\" content=\"”webkit”\" />\n  启用360浏览器的极速模式(webkit)\n  <meta http-equiv=\"”X-UA-Compatible”\" content=\"”IE\" =\"edge”\" />\n  避免IE使用兼容模式\n  <meta http-equiv=\"”Cache-Control”\" content=\"”no-siteapp”\" />\n  不让百度转码\n  <meta name=\"”HandheldFriendly”\" content=\"”true”\" />\n  针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓\n  <meta name=\"”MobileOptimized”\" content=\"”320″\" />\n  微软的老式浏览器\n  <meta name=\"”screen-orientation”\" content=\"”portrait”\" />\n  uc强制竖屏\n  <meta name=\"”x5-orientation”\" content=\"”portrait”\" />\n  QQ强制竖屏\n  <meta name=\"”full-screen”\" content=\"”yes”\" />\n  UC强制全屏\n  <meta name=\"”x5-fullscreen”\" content=\"”true”\" />\n  QQ强制全屏\n  <meta name=\"”browsermode”\" content=\"”application”\" />\n  UC应用模式\n  <meta name=\"”x5-page-mode”\" content=\"”app”\" />\n  QQ应用模式\n  <meta name=\"”msapplication-tap-highlight”\" content=\"”no”\" />\n  windows phone 点击无高光设置页面不缓存\n  <meta http-equiv=\"”pragma”\" content=\"”no-cache”\" />\n  <meta http-equiv=\"”cache-control”\" content=\"”no-cache”\" />\n  <meta http-equiv=\"”expires”\" content=\"”0″\" />\n</head>\n```\n\n## 字少时居中，多时靠左\n\n```html\n<div class=\"box\">\n  <p class=\"content\"></p>\n</div>\n\n<!-- CSS -->\n<style>\n  .box {\n    text-align: center;\n  }\n  .content {\n    display: inline-block;\n    text-align: left;\n    word-break: break-all;\n  }\n</style>\n```\n\n## CSS 权重\n\n权重分为 4 级，分别是：\n\n- 内联样式:1000\n- id:100\n- 类，伪类和属性选择器 `:hover`,`[attributer]`,权值为 10\n- 代表元素选择器和伪元素选择器，`div`\n\n** 需要注意的是：通用选择器（\\*），子选择器（>）和相邻通报选择器并不在这四个等级中，所以他们的权值为 0**\n\n## CSS3 动画\n\n- `animation-name`:对应的动画名称\n- `animation-duration`:是动画时长\n- `animation-timing-function`:规定动画的速度曲线。默认是 ease\n- `animation-delay`:规定动画何时开始。默认是 0\n- `animation-iteration-count`:规定动画播放的次数。默认是 1\n- `animation-diraction`:规定动画是否在下一周期逆向地播放。默认是 normal\n- `animation-play-state`:规定动画是否正在运行或暂停。默认是 running\n- `animation-fill-mode`:规定动画执行之前和之后如何给动画的目标应用，默认是 none，保留在最后一帧可以用 forwords\n\n### 实现动画暂停\n\n使用`animation-play-state`可以实现动画暂停\n\n```css\n.play-state {\n  width: 100px;\n  height: 100px;\n  margin: 40px;\n  text-align: center;\n  line-height: 94px;\n  border: 3px solid #e1efde;\n  border-radius: 50%;\n  animation: play-state 3s linear infinite;\n  cursor: pointer;\n}\n.play-state:hover {\n  animation-play-state: paused;\n}\n@keyframes play-state {\n  0% {\n    margin-left: 0;\n  }\n  100% {\n    margin-left: 200px;\n  }\n}\n```\n\n## 重绘和回流\n\n- 重绘：指的是当前页面中的元素不脱离文档流。而简单的样式的变化，比如修改颜色，背景等，浏览器重新绘制样式\n- 回流：指的是处于文档流中 DOM 的尺寸大小，位置或者默写属性变化时，导致浏览器重新渲染部分或全部文档的情况\n\n## 首行缩进\n\n```css\ntext-indent: 2em;\n```\n\n## 一种奇妙的绝对居中办法\n\n```html\n<style>\n  .wp {\n    writing-mode: vertical-lr;\n    text-align: center;\n  }\n  .wp-inner {\n    writing-mode: horizontal-tb;\n    display: inline-block;\n    text-align: center;\n    width: 100%;\n  }\n  .box {\n    display: inline-block;\n    margin: auto;\n    text-align: left;\n  }\n</style>\n<div class=\"wp\">\n  <div class=\"wp-inner\">\n    <div class=\"box\">123123</div>\n  </div>\n</div>\n```\n","slug":"css-小知识","published":1,"updated":"2021-05-06T12:22:09.894Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x0001al5v02a476mjz","content":"<p>css 在开发中的填坑总结</p>\n<span id=\"more\"></span>\n\n<h2 id=\"利用-css-的-content-属性-attr-抓取资料\"><a href=\"#利用-css-的-content-属性-attr-抓取资料\" class=\"headerlink\" title=\"利用 css 的 content 属性 attr 抓取资料\"></a>利用 css 的 content 属性 attr 抓取资料</h2><p>想要获取伪元素，可以用以下写法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-msg</span>=<span class=\"string\">&quot;open&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">div:hover:after&#123; content:attr(data-mag); &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"利用：valid-和：invalid-来做表单即使校验\"><a href=\"#利用：valid-和：invalid-来做表单即使校验\" class=\"headerlink\" title=\"利用：valid 和：invalid 来做表单即使校验\"></a>利用：valid 和：invalid 来做表单即使校验</h2><ul>\n<li>:required 伪类指定具有 required 属性的表单元素</li>\n<li>:valid 伪类指定一个通过匹配正确的所要求的表单元素</li>\n<li>:invalid 伪类指定一个不匹配指定要求的表单元素</li>\n</ul>\n<h2 id=\"writing-mode\"><a href=\"#writing-mode\" class=\"headerlink\" title=\"writing-mode\"></a>writing-mode</h2><p>使用 writing-mode 这个 CSS 属性实现容器的文字从上往下排列。 writing-mode: vertical-rl;</p>\n<h2 id=\"实现鼠标悬浮内容自动撑开的过渡动画\"><a href=\"#实现鼠标悬浮内容自动撑开的过渡动画\" class=\"headerlink\" title=\"实现鼠标悬浮内容自动撑开的过渡动画\"></a>实现鼠标悬浮内容自动撑开的过渡动画</h2><p>需要为一个列表添加个动画，容器的高度是不确定的，也就是高度为 auto，悬浮时候撑开内容有个过渡动画。而用 CSS3 实现的话，由于高度的不确定，而 transtion 是需要具体的数值，所以设置 height:auto 是无法实现效果的，可以通过 max-height 这个属性间接的实现这么个效果，css 样式是这样的：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;hd&quot;</span>&gt;</span>列表1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;bd&quot;</span>&gt;</span>列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;hd&quot;</span>&gt;</span>列表1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;bd&quot;</span>&gt;</span>列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;hd&quot;</span>&gt;</span>列表1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;bd&quot;</span>&gt;</span>列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">.bd &#123; max-height:0; overflow:hidden; transition: all 1s ease-out; &#125; li:hover .bd</span><br><span class=\"line\">&#123; max-height: 600px; transition-timing-function: ease-in; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"移动端-web-页面支持弹性滚动\"><a href=\"#移动端-web-页面支持弹性滚动\" class=\"headerlink\" title=\"移动端 web 页面支持弹性滚动\"></a>移动端 web 页面支持弹性滚动</h2><p>-webkit-overflow-scrolling: touch;</p>\n<h2 id=\"美化浏览器自带的-radio-，checkbox-属性\"><a href=\"#美化浏览器自带的-radio-，checkbox-属性\" class=\"headerlink\" title=\"美化浏览器自带的 radio ，checkbox 属性\"></a>美化浏览器自带的 radio ，checkbox 属性</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-beauty-container&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-name&quot;</span>&gt;</span>前端工程师<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;radioName&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;radioName1&quot;</span> <span class=\"attr\">hidden</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;radioName1&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-beauty&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-name&quot;</span>&gt;</span>后端工程师<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;radioName&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;radioName2&quot;</span> <span class=\"attr\">hidden</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;radioName2&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-beauty&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-name&quot;</span>&gt;</span>全栈工程师<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;radioName&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;radioName3&quot;</span> <span class=\"attr\">hidden</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;radioName3&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-beauty&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">.radio-beauty-container &#123; font-size: 0; $bgc: green; %common &#123; padding: 2px;</span><br><span class=\"line\">background-color: $bgc; background-clip: content-box; &#125; .radio-name &#123;</span><br><span class=\"line\">vertical-align: middle; font-size: 16px; &#125; .radio-beauty &#123; width: 18px; height:</span><br><span class=\"line\">18px; box-sizing: border-box; display: inline-block; border: 1px solid $bgc;</span><br><span class=\"line\">vertical-align: middle; margin: 0 15px 0 3px; border-radius: 50%; &amp;:hover &#123;</span><br><span class=\"line\">box-shadow: 0 0 7px $bgc; @extend %common; &#125; &#125;</span><br><span class=\"line\">input[type=&quot;radio&quot;]:checked+.radio-beauty &#123; @extend %common; &#125; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"改变-input-焦点光标的颜色\"><a href=\"#改变-input-焦点光标的颜色\" class=\"headerlink\" title=\"改变 input 焦点光标的颜色\"></a>改变 input 焦点光标的颜色</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;This field uses a default caret.&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;custom&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;I have a custom caret color!&quot;</span> /&gt;</span></span><br><span class=\"line\">input &#123; caret-color: auto; display: block; margin-bottom: .5em; &#125; input.custom &#123;</span><br><span class=\"line\">caret-color: red; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"rem-布局不再使用-JavaScript-设置\"><a href=\"#rem-布局不再使用-JavaScript-设置\" class=\"headerlink\" title=\"rem 布局不再使用 JavaScript 设置\"></a>rem 布局不再使用 JavaScript 设置</h2><p>现在移动端 css3 单位 vw ,wh 兼容性已经很不错了，在不需要兼容太低版本的安卓机情况下可以这样来：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">html</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">100vw</span> / <span class=\"number\">750</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"切角效果实现\"><a href=\"#切角效果实现\" class=\"headerlink\" title=\"切角效果实现\"></a>切角效果实现</h2><p>切角效果是时下非常流行的一种设计风格，并广泛运用于平面设计中，它最常见的形态就是把元素的一个或多个切成 45° 的切口，尤其是在最近几年，扁平化设计盖过拟物化设计后，这种切脚设计更为流行，例如下图就是通过切角实现的一个导航栏，在后面将详细论述起实现。</p>\n<p><img src=\"https://camo.githubusercontent.com/b07ae76cf4ce21d62ef2a4ce97932d831e723c50/687474703a2f2f636f6e74656e742d6d616e6167656d656e742e62302e7570616979756e2e636f6d2f313437323739393439333539332e706e67\" alt=\"network\"></p>\n<h2 id=\"响应式页面开发\"><a href=\"#响应式页面开发\" class=\"headerlink\" title=\"响应式页面开发\"></a>响应式页面开发</h2><p>在页头<code>head</code>标签内添加<code>viewoport meta</code>是实现响应式页面的第一步。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用Media-Queries\"><a href=\"#使用Media-Queries\" class=\"headerlink\" title=\"使用Media Queries\"></a>使用<code>Media Queries</code></h3><ul>\n<li><p>使用 link 标签 ，根据指定特性引入特定的外部样式文件</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">media</span>=<span class=\"string\">&quot;(max-width:640px)&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;max-640px.css&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>直接在 style 标签或样式文件内使用<code>@media</code>规则</p>\n</li>\n</ul>\n<h3 id=\"样式断点\"><a href=\"#样式断点\" class=\"headerlink\" title=\"样式断点\"></a>样式断点</h3><ul>\n<li>moblie 移动设备断点 ，视窗宽度&lt;=768px</li>\n<li>tablet 平板电脑设备断点，视窗宽度&gt;=769px</li>\n<li>desktop 桌面电脑断点，视窗宽度&gt;=1024px</li>\n<li>widescreen 宽屏电脑断点，视窗宽度&gt;=1216px</li>\n<li>fullhd 高清宽屏电脑断点，视窗宽度&gt;=1408px</li>\n</ul>\n<h2 id=\"1px-细线（普通屏幕下-1px，高清屏下-0-5px-的情况）\"><a href=\"#1px-细线（普通屏幕下-1px，高清屏下-0-5px-的情况）\" class=\"headerlink\" title=\"1px 细线（普通屏幕下 1px，高清屏下 0.5px 的情况）\"></a>1px 细线（普通屏幕下 1px，高清屏下 0.5px 的情况）</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.mod_grid</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">        // 实现<span class=\"number\">1</span>物理像素的下边框线</span><br><span class=\"line\">        <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">z-index</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"attribute\">pointer-events</span>: none;</span><br><span class=\"line\">        <span class=\"attribute\">background-color</span>: <span class=\"number\">#ddd</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-min-device-pixel-ratio</span>: <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            -webkit-<span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleY</span>(<span class=\"number\">0.5</span>);</span><br><span class=\"line\">            -webkit-<span class=\"attribute\">transform-origin</span>: <span class=\"number\">50%</span> <span class=\"number\">0%</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"需要保持宽高比的图，应该用-padding-top-实现\"><a href=\"#需要保持宽高比的图，应该用-padding-top-实现\" class=\"headerlink\" title=\"需要保持宽高比的图，应该用 padding-top 实现\"></a>需要保持宽高比的图，应该用 padding-top 实现</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.mod_banner</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">  <span class=\"comment\">/* 使用padding-top 实现宽高比为 100:750 的图片区域 */</span></span><br><span class=\"line\">  <span class=\"attribute\">padding-top</span>: <span class=\"built_in\">percentage</span>(<span class=\"number\">100</span>/<span class=\"number\">750</span>);</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">  <span class=\"selector-tag\">img</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: auto;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"input-type-file-onchange\"><a href=\"#input-type-file-onchange\" class=\"headerlink\" title=\"input type=file onchange\"></a><code>input type=file onchange</code></h2><ul>\n<li>上传同一张图片失效</li>\n<li>在微信浏览器内无法上传图片 (经测试是不支持<code>input type=file</code> 就算支持也无法上传 camera 目录下的文件 )</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$fileInput.on(<span class=\"string\">&#x27;change&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  e.target.value = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>第二个问题实在没有找到方法 准备使用带有 flash 的插件<br>使用百度网盘，饿了么的网页在微信中有同样的问题</p>\n<h2 id=\"meta-viewport\"><a href=\"#meta-viewport\" class=\"headerlink\" title=\"meta viewport\"></a><code>meta viewport</code></h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span> H5标准声明，使用 HTML5 doctype，不区分大小写</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;”en”&quot;</span>&gt;</span></span><br><span class=\"line\">  标准的 lang 属性写法</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;’utf-8′&quot;</span> /&gt;</span></span><br><span class=\"line\">  声明文档使用的字符编码</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”X-UA-Compatible”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”IE&quot;</span> =<span class=\"string\">&quot;edge,chrome&quot;</span> =<span class=\"string\">&quot;1″&quot;</span> /&gt;</span></span><br><span class=\"line\">  优先使用 IE 最新版本和 Chrome</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”description”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”不超过150个字符”&quot;</span> /&gt;</span></span><br><span class=\"line\">  页面描述</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”keywords”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;””&quot;</span> /&gt;</span></span><br><span class=\"line\">  页面关键词</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”author”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”name,&quot;</span> <span class=\"attr\">email</span>@<span class=\"attr\">gmail.com</span>” /&gt;</span></span><br><span class=\"line\">  网页作者</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”robots”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”index,follow”&quot;</span> /&gt;</span></span><br><span class=\"line\">  搜索引擎抓取</span><br><span class=\"line\">  &lt;meta</span><br><span class=\"line\">    name=&quot;”viewport”&quot;</span><br><span class=\"line\">    content=&quot;”initial-scale&quot;</span><br><span class=\"line\">    =&quot;1,&quot;</span><br><span class=\"line\">    maximum-scale=&quot;3,&quot;</span><br><span class=\"line\">    minimum-scale=&quot;1,&quot;</span><br><span class=\"line\">    user-scalable=&quot;no”&quot;</span><br><span class=\"line\">  /&gt;</span><br><span class=\"line\">  为移动设备添加 viewport</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”apple-mobile-web-app-title”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”标题”&quot;</span> /&gt;</span></span><br><span class=\"line\">  iOS 设备 begin</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”apple-mobile-web-app-capable”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”yes”&quot;</span> /&gt;</span></span><br><span class=\"line\">  添加到主屏后的标题（iOS 6 新增）是否启用 WebApp</span><br><span class=\"line\">  全屏模式，删除苹果默认的工具栏和菜单栏</span><br><span class=\"line\">  &lt;meta</span><br><span class=\"line\">    name=&quot;”apple-itunes-app”&quot;</span><br><span class=\"line\">    content=&quot;”app-id&quot;</span><br><span class=\"line\">    =&quot;myAppStoreID,&quot;</span><br><span class=\"line\">    affiliate-data=&quot;myAffiliateData,&quot;</span><br><span class=\"line\">    app-argument=&quot;myURL”&quot;</span><br><span class=\"line\">  /&gt;</span><br><span class=\"line\">  添加智能 App 广告条 Smart App Banner（iOS 6+ Safari）</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”apple-mobile-web-app-status-bar-style”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”black”&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”format-detection”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”telphone&quot;</span> =<span class=\"string\">&quot;no,&quot;</span> <span class=\"attr\">email</span>=<span class=\"string\">&quot;no”&quot;</span> /&gt;</span></span><br><span class=\"line\">  设置苹果工具栏颜色</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”renderer”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”webkit”&quot;</span> /&gt;</span></span><br><span class=\"line\">  启用360浏览器的极速模式(webkit)</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”X-UA-Compatible”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”IE&quot;</span> =<span class=\"string\">&quot;edge”&quot;</span> /&gt;</span></span><br><span class=\"line\">  避免IE使用兼容模式</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”Cache-Control”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”no-siteapp”&quot;</span> /&gt;</span></span><br><span class=\"line\">  不让百度转码</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”HandheldFriendly”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”true”&quot;</span> /&gt;</span></span><br><span class=\"line\">  针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”MobileOptimized”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”320″&quot;</span> /&gt;</span></span><br><span class=\"line\">  微软的老式浏览器</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”screen-orientation”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”portrait”&quot;</span> /&gt;</span></span><br><span class=\"line\">  uc强制竖屏</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”x5-orientation”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”portrait”&quot;</span> /&gt;</span></span><br><span class=\"line\">  QQ强制竖屏</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”full-screen”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”yes”&quot;</span> /&gt;</span></span><br><span class=\"line\">  UC强制全屏</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”x5-fullscreen”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”true”&quot;</span> /&gt;</span></span><br><span class=\"line\">  QQ强制全屏</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”browsermode”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”application”&quot;</span> /&gt;</span></span><br><span class=\"line\">  UC应用模式</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”x5-page-mode”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”app”&quot;</span> /&gt;</span></span><br><span class=\"line\">  QQ应用模式</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”msapplication-tap-highlight”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”no”&quot;</span> /&gt;</span></span><br><span class=\"line\">  windows phone 点击无高光设置页面不缓存</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”pragma”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”no-cache”&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”cache-control”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”no-cache”&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”expires”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”0″&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"字少时居中，多时靠左\"><a href=\"#字少时居中，多时靠左\" class=\"headerlink\" title=\"字少时居中，多时靠左\"></a>字少时居中，多时靠左</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;box&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;content&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- CSS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">  .box &#123;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .content &#123;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: left;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">word-break</span>: break-all;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"CSS-权重\"><a href=\"#CSS-权重\" class=\"headerlink\" title=\"CSS 权重\"></a>CSS 权重</h2><p>权重分为 4 级，分别是：</p>\n<ul>\n<li>内联样式:1000</li>\n<li>id:100</li>\n<li>类，伪类和属性选择器 <code>:hover</code>,<code>[attributer]</code>,权值为 10</li>\n<li>代表元素选择器和伪元素选择器，<code>div</code></li>\n</ul>\n<p>** 需要注意的是：通用选择器（*），子选择器（&gt;）和相邻通报选择器并不在这四个等级中，所以他们的权值为 0**</p>\n<h2 id=\"CSS3-动画\"><a href=\"#CSS3-动画\" class=\"headerlink\" title=\"CSS3 动画\"></a>CSS3 动画</h2><ul>\n<li><code>animation-name</code>:对应的动画名称</li>\n<li><code>animation-duration</code>:是动画时长</li>\n<li><code>animation-timing-function</code>:规定动画的速度曲线。默认是 ease</li>\n<li><code>animation-delay</code>:规定动画何时开始。默认是 0</li>\n<li><code>animation-iteration-count</code>:规定动画播放的次数。默认是 1</li>\n<li><code>animation-diraction</code>:规定动画是否在下一周期逆向地播放。默认是 normal</li>\n<li><code>animation-play-state</code>:规定动画是否正在运行或暂停。默认是 running</li>\n<li><code>animation-fill-mode</code>:规定动画执行之前和之后如何给动画的目标应用，默认是 none，保留在最后一帧可以用 forwords</li>\n</ul>\n<h3 id=\"实现动画暂停\"><a href=\"#实现动画暂停\" class=\"headerlink\" title=\"实现动画暂停\"></a>实现动画暂停</h3><p>使用<code>animation-play-state</code>可以实现动画暂停</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.play-state</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">40px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">94px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#e1efde</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">animation</span>: play-state <span class=\"number\">3s</span> linear infinite;</span><br><span class=\"line\">  <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.play-state</span><span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">animation-play-state</span>: paused;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@keyframes</span> play-state &#123;</span><br><span class=\"line\">  <span class=\"number\">0%</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"number\">100%</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"重绘和回流\"><a href=\"#重绘和回流\" class=\"headerlink\" title=\"重绘和回流\"></a>重绘和回流</h2><ul>\n<li>重绘：指的是当前页面中的元素不脱离文档流。而简单的样式的变化，比如修改颜色，背景等，浏览器重新绘制样式</li>\n<li>回流：指的是处于文档流中 DOM 的尺寸大小，位置或者默写属性变化时，导致浏览器重新渲染部分或全部文档的情况</li>\n</ul>\n<h2 id=\"首行缩进\"><a href=\"#首行缩进\" class=\"headerlink\" title=\"首行缩进\"></a>首行缩进</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">text-indent</span>: <span class=\"number\">2em</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一种奇妙的绝对居中办法\"><a href=\"#一种奇妙的绝对居中办法\" class=\"headerlink\" title=\"一种奇妙的绝对居中办法\"></a>一种奇妙的绝对居中办法</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">  .wp &#123;</span><br><span class=\"line\"><span class=\"css\">    writing-mode: vertical-lr;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .wp-inner &#123;</span><br><span class=\"line\"><span class=\"css\">    writing-mode: horizontal-tb;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .box &#123;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">margin</span>: auto;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: left;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;wp&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;wp-inner&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;box&quot;</span>&gt;</span>123123<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>css 在开发中的填坑总结</p>","more":"<h2 id=\"利用-css-的-content-属性-attr-抓取资料\"><a href=\"#利用-css-的-content-属性-attr-抓取资料\" class=\"headerlink\" title=\"利用 css 的 content 属性 attr 抓取资料\"></a>利用 css 的 content 属性 attr 抓取资料</h2><p>想要获取伪元素，可以用以下写法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-msg</span>=<span class=\"string\">&quot;open&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">div:hover:after&#123; content:attr(data-mag); &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"利用：valid-和：invalid-来做表单即使校验\"><a href=\"#利用：valid-和：invalid-来做表单即使校验\" class=\"headerlink\" title=\"利用：valid 和：invalid 来做表单即使校验\"></a>利用：valid 和：invalid 来做表单即使校验</h2><ul>\n<li>:required 伪类指定具有 required 属性的表单元素</li>\n<li>:valid 伪类指定一个通过匹配正确的所要求的表单元素</li>\n<li>:invalid 伪类指定一个不匹配指定要求的表单元素</li>\n</ul>\n<h2 id=\"writing-mode\"><a href=\"#writing-mode\" class=\"headerlink\" title=\"writing-mode\"></a>writing-mode</h2><p>使用 writing-mode 这个 CSS 属性实现容器的文字从上往下排列。 writing-mode: vertical-rl;</p>\n<h2 id=\"实现鼠标悬浮内容自动撑开的过渡动画\"><a href=\"#实现鼠标悬浮内容自动撑开的过渡动画\" class=\"headerlink\" title=\"实现鼠标悬浮内容自动撑开的过渡动画\"></a>实现鼠标悬浮内容自动撑开的过渡动画</h2><p>需要为一个列表添加个动画，容器的高度是不确定的，也就是高度为 auto，悬浮时候撑开内容有个过渡动画。而用 CSS3 实现的话，由于高度的不确定，而 transtion 是需要具体的数值，所以设置 height:auto 是无法实现效果的，可以通过 max-height 这个属性间接的实现这么个效果，css 样式是这样的：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;hd&quot;</span>&gt;</span>列表1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;bd&quot;</span>&gt;</span>列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;hd&quot;</span>&gt;</span>列表1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;bd&quot;</span>&gt;</span>列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;hd&quot;</span>&gt;</span>列表1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;bd&quot;</span>&gt;</span>列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容列表内容<span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span>内容<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">.bd &#123; max-height:0; overflow:hidden; transition: all 1s ease-out; &#125; li:hover .bd</span><br><span class=\"line\">&#123; max-height: 600px; transition-timing-function: ease-in; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"移动端-web-页面支持弹性滚动\"><a href=\"#移动端-web-页面支持弹性滚动\" class=\"headerlink\" title=\"移动端 web 页面支持弹性滚动\"></a>移动端 web 页面支持弹性滚动</h2><p>-webkit-overflow-scrolling: touch;</p>\n<h2 id=\"美化浏览器自带的-radio-，checkbox-属性\"><a href=\"#美化浏览器自带的-radio-，checkbox-属性\" class=\"headerlink\" title=\"美化浏览器自带的 radio ，checkbox 属性\"></a>美化浏览器自带的 radio ，checkbox 属性</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-beauty-container&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-name&quot;</span>&gt;</span>前端工程师<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;radioName&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;radioName1&quot;</span> <span class=\"attr\">hidden</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;radioName1&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-beauty&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-name&quot;</span>&gt;</span>后端工程师<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;radioName&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;radioName2&quot;</span> <span class=\"attr\">hidden</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;radioName2&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-beauty&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-name&quot;</span>&gt;</span>全栈工程师<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;radioName&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;radioName3&quot;</span> <span class=\"attr\">hidden</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;radioName3&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;radio-beauty&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">.radio-beauty-container &#123; font-size: 0; $bgc: green; %common &#123; padding: 2px;</span><br><span class=\"line\">background-color: $bgc; background-clip: content-box; &#125; .radio-name &#123;</span><br><span class=\"line\">vertical-align: middle; font-size: 16px; &#125; .radio-beauty &#123; width: 18px; height:</span><br><span class=\"line\">18px; box-sizing: border-box; display: inline-block; border: 1px solid $bgc;</span><br><span class=\"line\">vertical-align: middle; margin: 0 15px 0 3px; border-radius: 50%; &amp;:hover &#123;</span><br><span class=\"line\">box-shadow: 0 0 7px $bgc; @extend %common; &#125; &#125;</span><br><span class=\"line\">input[type=&quot;radio&quot;]:checked+.radio-beauty &#123; @extend %common; &#125; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"改变-input-焦点光标的颜色\"><a href=\"#改变-input-焦点光标的颜色\" class=\"headerlink\" title=\"改变 input 焦点光标的颜色\"></a>改变 input 焦点光标的颜色</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;This field uses a default caret.&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;custom&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;I have a custom caret color!&quot;</span> /&gt;</span></span><br><span class=\"line\">input &#123; caret-color: auto; display: block; margin-bottom: .5em; &#125; input.custom &#123;</span><br><span class=\"line\">caret-color: red; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"rem-布局不再使用-JavaScript-设置\"><a href=\"#rem-布局不再使用-JavaScript-设置\" class=\"headerlink\" title=\"rem 布局不再使用 JavaScript 设置\"></a>rem 布局不再使用 JavaScript 设置</h2><p>现在移动端 css3 单位 vw ,wh 兼容性已经很不错了，在不需要兼容太低版本的安卓机情况下可以这样来：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">html</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">100vw</span> / <span class=\"number\">750</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"切角效果实现\"><a href=\"#切角效果实现\" class=\"headerlink\" title=\"切角效果实现\"></a>切角效果实现</h2><p>切角效果是时下非常流行的一种设计风格，并广泛运用于平面设计中，它最常见的形态就是把元素的一个或多个切成 45° 的切口，尤其是在最近几年，扁平化设计盖过拟物化设计后，这种切脚设计更为流行，例如下图就是通过切角实现的一个导航栏，在后面将详细论述起实现。</p>\n<p><img src=\"https://camo.githubusercontent.com/b07ae76cf4ce21d62ef2a4ce97932d831e723c50/687474703a2f2f636f6e74656e742d6d616e6167656d656e742e62302e7570616979756e2e636f6d2f313437323739393439333539332e706e67\" alt=\"network\"></p>\n<h2 id=\"响应式页面开发\"><a href=\"#响应式页面开发\" class=\"headerlink\" title=\"响应式页面开发\"></a>响应式页面开发</h2><p>在页头<code>head</code>标签内添加<code>viewoport meta</code>是实现响应式页面的第一步。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用Media-Queries\"><a href=\"#使用Media-Queries\" class=\"headerlink\" title=\"使用Media Queries\"></a>使用<code>Media Queries</code></h3><ul>\n<li><p>使用 link 标签 ，根据指定特性引入特定的外部样式文件</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">media</span>=<span class=\"string\">&quot;(max-width:640px)&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;max-640px.css&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>直接在 style 标签或样式文件内使用<code>@media</code>规则</p>\n</li>\n</ul>\n<h3 id=\"样式断点\"><a href=\"#样式断点\" class=\"headerlink\" title=\"样式断点\"></a>样式断点</h3><ul>\n<li>moblie 移动设备断点 ，视窗宽度&lt;=768px</li>\n<li>tablet 平板电脑设备断点，视窗宽度&gt;=769px</li>\n<li>desktop 桌面电脑断点，视窗宽度&gt;=1024px</li>\n<li>widescreen 宽屏电脑断点，视窗宽度&gt;=1216px</li>\n<li>fullhd 高清宽屏电脑断点，视窗宽度&gt;=1408px</li>\n</ul>\n<h2 id=\"1px-细线（普通屏幕下-1px，高清屏下-0-5px-的情况）\"><a href=\"#1px-细线（普通屏幕下-1px，高清屏下-0-5px-的情况）\" class=\"headerlink\" title=\"1px 细线（普通屏幕下 1px，高清屏下 0.5px 的情况）\"></a>1px 细线（普通屏幕下 1px，高清屏下 0.5px 的情况）</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.mod_grid</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">        // 实现<span class=\"number\">1</span>物理像素的下边框线</span><br><span class=\"line\">        <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">        <span class=\"attribute\">z-index</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"attribute\">pointer-events</span>: none;</span><br><span class=\"line\">        <span class=\"attribute\">background-color</span>: <span class=\"number\">#ddd</span>;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">1px</span>;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">@media</span> <span class=\"keyword\">only</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">-webkit-min-device-pixel-ratio</span>: <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            -webkit-<span class=\"attribute\">transform</span>: <span class=\"built_in\">scaleY</span>(<span class=\"number\">0.5</span>);</span><br><span class=\"line\">            -webkit-<span class=\"attribute\">transform-origin</span>: <span class=\"number\">50%</span> <span class=\"number\">0%</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"需要保持宽高比的图，应该用-padding-top-实现\"><a href=\"#需要保持宽高比的图，应该用-padding-top-实现\" class=\"headerlink\" title=\"需要保持宽高比的图，应该用 padding-top 实现\"></a>需要保持宽高比的图，应该用 padding-top 实现</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.mod_banner</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">  <span class=\"comment\">/* 使用padding-top 实现宽高比为 100:750 的图片区域 */</span></span><br><span class=\"line\">  <span class=\"attribute\">padding-top</span>: <span class=\"built_in\">percentage</span>(<span class=\"number\">100</span>/<span class=\"number\">750</span>);</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">  <span class=\"selector-tag\">img</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: auto;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"input-type-file-onchange\"><a href=\"#input-type-file-onchange\" class=\"headerlink\" title=\"input type=file onchange\"></a><code>input type=file onchange</code></h2><ul>\n<li>上传同一张图片失效</li>\n<li>在微信浏览器内无法上传图片 (经测试是不支持<code>input type=file</code> 就算支持也无法上传 camera 目录下的文件 )</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$fileInput.on(<span class=\"string\">&#x27;change&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  e.target.value = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>第二个问题实在没有找到方法 准备使用带有 flash 的插件<br>使用百度网盘，饿了么的网页在微信中有同样的问题</p>\n<h2 id=\"meta-viewport\"><a href=\"#meta-viewport\" class=\"headerlink\" title=\"meta viewport\"></a><code>meta viewport</code></h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span> H5标准声明，使用 HTML5 doctype，不区分大小写</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;”en”&quot;</span>&gt;</span></span><br><span class=\"line\">  标准的 lang 属性写法</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;’utf-8′&quot;</span> /&gt;</span></span><br><span class=\"line\">  声明文档使用的字符编码</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”X-UA-Compatible”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”IE&quot;</span> =<span class=\"string\">&quot;edge,chrome&quot;</span> =<span class=\"string\">&quot;1″&quot;</span> /&gt;</span></span><br><span class=\"line\">  优先使用 IE 最新版本和 Chrome</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”description”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”不超过150个字符”&quot;</span> /&gt;</span></span><br><span class=\"line\">  页面描述</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”keywords”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;””&quot;</span> /&gt;</span></span><br><span class=\"line\">  页面关键词</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”author”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”name,&quot;</span> <span class=\"attr\">email</span>@<span class=\"attr\">gmail.com</span>” /&gt;</span></span><br><span class=\"line\">  网页作者</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”robots”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”index,follow”&quot;</span> /&gt;</span></span><br><span class=\"line\">  搜索引擎抓取</span><br><span class=\"line\">  &lt;meta</span><br><span class=\"line\">    name=&quot;”viewport”&quot;</span><br><span class=\"line\">    content=&quot;”initial-scale&quot;</span><br><span class=\"line\">    =&quot;1,&quot;</span><br><span class=\"line\">    maximum-scale=&quot;3,&quot;</span><br><span class=\"line\">    minimum-scale=&quot;1,&quot;</span><br><span class=\"line\">    user-scalable=&quot;no”&quot;</span><br><span class=\"line\">  /&gt;</span><br><span class=\"line\">  为移动设备添加 viewport</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”apple-mobile-web-app-title”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”标题”&quot;</span> /&gt;</span></span><br><span class=\"line\">  iOS 设备 begin</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”apple-mobile-web-app-capable”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”yes”&quot;</span> /&gt;</span></span><br><span class=\"line\">  添加到主屏后的标题（iOS 6 新增）是否启用 WebApp</span><br><span class=\"line\">  全屏模式，删除苹果默认的工具栏和菜单栏</span><br><span class=\"line\">  &lt;meta</span><br><span class=\"line\">    name=&quot;”apple-itunes-app”&quot;</span><br><span class=\"line\">    content=&quot;”app-id&quot;</span><br><span class=\"line\">    =&quot;myAppStoreID,&quot;</span><br><span class=\"line\">    affiliate-data=&quot;myAffiliateData,&quot;</span><br><span class=\"line\">    app-argument=&quot;myURL”&quot;</span><br><span class=\"line\">  /&gt;</span><br><span class=\"line\">  添加智能 App 广告条 Smart App Banner（iOS 6+ Safari）</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”apple-mobile-web-app-status-bar-style”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”black”&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”format-detection”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”telphone&quot;</span> =<span class=\"string\">&quot;no,&quot;</span> <span class=\"attr\">email</span>=<span class=\"string\">&quot;no”&quot;</span> /&gt;</span></span><br><span class=\"line\">  设置苹果工具栏颜色</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”renderer”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”webkit”&quot;</span> /&gt;</span></span><br><span class=\"line\">  启用360浏览器的极速模式(webkit)</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”X-UA-Compatible”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”IE&quot;</span> =<span class=\"string\">&quot;edge”&quot;</span> /&gt;</span></span><br><span class=\"line\">  避免IE使用兼容模式</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”Cache-Control”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”no-siteapp”&quot;</span> /&gt;</span></span><br><span class=\"line\">  不让百度转码</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”HandheldFriendly”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”true”&quot;</span> /&gt;</span></span><br><span class=\"line\">  针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”MobileOptimized”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”320″&quot;</span> /&gt;</span></span><br><span class=\"line\">  微软的老式浏览器</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”screen-orientation”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”portrait”&quot;</span> /&gt;</span></span><br><span class=\"line\">  uc强制竖屏</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”x5-orientation”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”portrait”&quot;</span> /&gt;</span></span><br><span class=\"line\">  QQ强制竖屏</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”full-screen”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”yes”&quot;</span> /&gt;</span></span><br><span class=\"line\">  UC强制全屏</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”x5-fullscreen”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”true”&quot;</span> /&gt;</span></span><br><span class=\"line\">  QQ强制全屏</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”browsermode”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”application”&quot;</span> /&gt;</span></span><br><span class=\"line\">  UC应用模式</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”x5-page-mode”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”app”&quot;</span> /&gt;</span></span><br><span class=\"line\">  QQ应用模式</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;”msapplication-tap-highlight”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”no”&quot;</span> /&gt;</span></span><br><span class=\"line\">  windows phone 点击无高光设置页面不缓存</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”pragma”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”no-cache”&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”cache-control”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”no-cache”&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;”expires”&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;”0″&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"字少时居中，多时靠左\"><a href=\"#字少时居中，多时靠左\" class=\"headerlink\" title=\"字少时居中，多时靠左\"></a>字少时居中，多时靠左</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;box&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;content&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- CSS --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">  .box &#123;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .content &#123;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: left;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">word-break</span>: break-all;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"CSS-权重\"><a href=\"#CSS-权重\" class=\"headerlink\" title=\"CSS 权重\"></a>CSS 权重</h2><p>权重分为 4 级，分别是：</p>\n<ul>\n<li>内联样式:1000</li>\n<li>id:100</li>\n<li>类，伪类和属性选择器 <code>:hover</code>,<code>[attributer]</code>,权值为 10</li>\n<li>代表元素选择器和伪元素选择器，<code>div</code></li>\n</ul>\n<p>** 需要注意的是：通用选择器（*），子选择器（&gt;）和相邻通报选择器并不在这四个等级中，所以他们的权值为 0**</p>\n<h2 id=\"CSS3-动画\"><a href=\"#CSS3-动画\" class=\"headerlink\" title=\"CSS3 动画\"></a>CSS3 动画</h2><ul>\n<li><code>animation-name</code>:对应的动画名称</li>\n<li><code>animation-duration</code>:是动画时长</li>\n<li><code>animation-timing-function</code>:规定动画的速度曲线。默认是 ease</li>\n<li><code>animation-delay</code>:规定动画何时开始。默认是 0</li>\n<li><code>animation-iteration-count</code>:规定动画播放的次数。默认是 1</li>\n<li><code>animation-diraction</code>:规定动画是否在下一周期逆向地播放。默认是 normal</li>\n<li><code>animation-play-state</code>:规定动画是否正在运行或暂停。默认是 running</li>\n<li><code>animation-fill-mode</code>:规定动画执行之前和之后如何给动画的目标应用，默认是 none，保留在最后一帧可以用 forwords</li>\n</ul>\n<h3 id=\"实现动画暂停\"><a href=\"#实现动画暂停\" class=\"headerlink\" title=\"实现动画暂停\"></a>实现动画暂停</h3><p>使用<code>animation-play-state</code>可以实现动画暂停</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.play-state</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">40px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">94px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">3px</span> solid <span class=\"number\">#e1efde</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">animation</span>: play-state <span class=\"number\">3s</span> linear infinite;</span><br><span class=\"line\">  <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.play-state</span><span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">animation-play-state</span>: paused;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@keyframes</span> play-state &#123;</span><br><span class=\"line\">  <span class=\"number\">0%</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"number\">100%</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"重绘和回流\"><a href=\"#重绘和回流\" class=\"headerlink\" title=\"重绘和回流\"></a>重绘和回流</h2><ul>\n<li>重绘：指的是当前页面中的元素不脱离文档流。而简单的样式的变化，比如修改颜色，背景等，浏览器重新绘制样式</li>\n<li>回流：指的是处于文档流中 DOM 的尺寸大小，位置或者默写属性变化时，导致浏览器重新渲染部分或全部文档的情况</li>\n</ul>\n<h2 id=\"首行缩进\"><a href=\"#首行缩进\" class=\"headerlink\" title=\"首行缩进\"></a>首行缩进</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">text-indent</span>: <span class=\"number\">2em</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一种奇妙的绝对居中办法\"><a href=\"#一种奇妙的绝对居中办法\" class=\"headerlink\" title=\"一种奇妙的绝对居中办法\"></a>一种奇妙的绝对居中办法</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">  .wp &#123;</span><br><span class=\"line\"><span class=\"css\">    writing-mode: vertical-lr;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .wp-inner &#123;</span><br><span class=\"line\"><span class=\"css\">    writing-mode: horizontal-tb;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .box &#123;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">margin</span>: auto;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">text-align</span>: left;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;wp&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;wp-inner&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;box&quot;</span>&gt;</span>123123<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"innerHTML与createElement","date":"2018-05-11T07:05:13.000Z","_content":"\n最近看到一道海量渲染的面试题的答案，看到他用的是`createElement`然后`appendChild`感觉无法理解为什么要这样使用，难道`innerHTML`比这种方法的性能差吗？\n由此自己做了一些实验\n<!--more-->\n\n自测代码如下：\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n</head>\n<body>\n    <div id=\"a\"></div>\n    <div id=\"b\"></div>\n</body>\n\n</html>\n<script>\n        var $a = document.getElementById(\"a\");\n        var $b = document.getElementById(\"b\");\n        var html1='',html2='';\n        function test1(){\n            console.time(\"html1:\")\n           for(let i = 0;i<1000;i++){\n            html1 +='<p>'+i+'</p>';\n           }\n           $a.innerHTML = html1;\n           console.timeEnd(\"html1:\")\n        }\n\n        function test2(){\n            console.time(\"html2:\")\n            let fragment = document.createDocumentFragment();\n           for(let i = 0;i<1000;i++){\n               let p = document.createElement(\"p\");\n               p.innerHTML = i;\n               fragment.appendChild(p);\n           }\n           $b.appendChild(fragment);\n           console.timeEnd(\"html2:\")\n        }\n        test1(); //html1:: 3.000244140625ms\n        test2(); //html2:: 10.999755859375ms \n</script>\n```\n最后得出的结论是`innerHTML`的方法明显会比 `createElement`这种 办法好，就算是先`appendChild`到虚拟节点里面，也仍然性能不好。那为什么那些大佬们会用第二种办法？难道就是为了使用`createDocumentFragment`这个API？\n\n那么究竟`createElement`会比`innerHTML`好在哪里呢？\n\n看到一位大佬的答案是因为觉得拼接字符串丑陋。。。emmmmmm\n\n### `createElement`\n在创建节点后就能直接事件监听事件，可是这种大量渲染，使用事件委托不是更完美吗？何必每一个都要绑定事件监听？\n```javascript\nvar oButton = document.createElement(\"input\");\n    oButton.type = \"button\";\n    oButton.value = \"xxxxx\";\n    aaa.appendChild(oButton);\n ```\n","source":"_posts/innerHTML与createElement.md","raw":"---\ntitle: innerHTML与createElement\ndate: 2018-05-11 15:05:13\ncategories: JavaScript\n---\n\n最近看到一道海量渲染的面试题的答案，看到他用的是`createElement`然后`appendChild`感觉无法理解为什么要这样使用，难道`innerHTML`比这种方法的性能差吗？\n由此自己做了一些实验\n<!--more-->\n\n自测代码如下：\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n</head>\n<body>\n    <div id=\"a\"></div>\n    <div id=\"b\"></div>\n</body>\n\n</html>\n<script>\n        var $a = document.getElementById(\"a\");\n        var $b = document.getElementById(\"b\");\n        var html1='',html2='';\n        function test1(){\n            console.time(\"html1:\")\n           for(let i = 0;i<1000;i++){\n            html1 +='<p>'+i+'</p>';\n           }\n           $a.innerHTML = html1;\n           console.timeEnd(\"html1:\")\n        }\n\n        function test2(){\n            console.time(\"html2:\")\n            let fragment = document.createDocumentFragment();\n           for(let i = 0;i<1000;i++){\n               let p = document.createElement(\"p\");\n               p.innerHTML = i;\n               fragment.appendChild(p);\n           }\n           $b.appendChild(fragment);\n           console.timeEnd(\"html2:\")\n        }\n        test1(); //html1:: 3.000244140625ms\n        test2(); //html2:: 10.999755859375ms \n</script>\n```\n最后得出的结论是`innerHTML`的方法明显会比 `createElement`这种 办法好，就算是先`appendChild`到虚拟节点里面，也仍然性能不好。那为什么那些大佬们会用第二种办法？难道就是为了使用`createDocumentFragment`这个API？\n\n那么究竟`createElement`会比`innerHTML`好在哪里呢？\n\n看到一位大佬的答案是因为觉得拼接字符串丑陋。。。emmmmmm\n\n### `createElement`\n在创建节点后就能直接事件监听事件，可是这种大量渲染，使用事件委托不是更完美吗？何必每一个都要绑定事件监听？\n```javascript\nvar oButton = document.createElement(\"input\");\n    oButton.type = \"button\";\n    oButton.value = \"xxxxx\";\n    aaa.appendChild(oButton);\n ```\n","slug":"innerHTML与createElement","published":1,"updated":"2021-02-27T12:24:38.485Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x1001dl5v0g30cfze1","content":"<p>最近看到一道海量渲染的面试题的答案，看到他用的是<code>createElement</code>然后<code>appendChild</code>感觉无法理解为什么要这样使用，难道<code>innerHTML</code>比这种方法的性能差吗？<br>由此自己做了一些实验</p>\n<span id=\"more\"></span>\n\n<p>自测代码如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;a&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;b&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> $a = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;a&quot;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> $b = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;b&quot;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> html1=<span class=\"string\">&#x27;&#x27;</span>,html2=<span class=\"string\">&#x27;&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test1</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.time(<span class=\"string\">&quot;html1:&quot;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>;i&lt;<span class=\"number\">1000</span>;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            html1 +=<span class=\"string\">&#x27;&lt;p&gt;&#x27;</span>+i+<span class=\"string\">&#x27;&lt;/p&gt;&#x27;</span>;</span></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           $a.innerHTML = html1;</span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"built_in\">console</span>.timeEnd(<span class=\"string\">&quot;html1:&quot;</span>)</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test2</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.time(<span class=\"string\">&quot;html2:&quot;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> fragment = <span class=\"built_in\">document</span>.createDocumentFragment();</span></span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>;i&lt;<span class=\"number\">1000</span>;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">               <span class=\"keyword\">let</span> p = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&quot;p&quot;</span>);</span></span><br><span class=\"line\">               p.innerHTML = i;</span><br><span class=\"line\">               fragment.appendChild(p);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           $b.appendChild(fragment);</span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"built_in\">console</span>.timeEnd(<span class=\"string\">&quot;html2:&quot;</span>)</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"javascript\">        test1(); <span class=\"comment\">//html1:: 3.000244140625ms</span></span></span><br><span class=\"line\"><span class=\"javascript\">        test2(); <span class=\"comment\">//html2:: 10.999755859375ms </span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>最后得出的结论是<code>innerHTML</code>的方法明显会比 <code>createElement</code>这种 办法好，就算是先<code>appendChild</code>到虚拟节点里面，也仍然性能不好。那为什么那些大佬们会用第二种办法？难道就是为了使用<code>createDocumentFragment</code>这个API？</p>\n<p>那么究竟<code>createElement</code>会比<code>innerHTML</code>好在哪里呢？</p>\n<p>看到一位大佬的答案是因为觉得拼接字符串丑陋。。。emmmmmm</p>\n<h3 id=\"createElement\"><a href=\"#createElement\" class=\"headerlink\" title=\"createElement\"></a><code>createElement</code></h3><p>在创建节点后就能直接事件监听事件，可是这种大量渲染，使用事件委托不是更完美吗？何必每一个都要绑定事件监听？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> oButton = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&quot;input&quot;</span>);</span><br><span class=\"line\">    oButton.type = <span class=\"string\">&quot;button&quot;</span>;</span><br><span class=\"line\">    oButton.value = <span class=\"string\">&quot;xxxxx&quot;</span>;</span><br><span class=\"line\">    aaa.appendChild(oButton);</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>最近看到一道海量渲染的面试题的答案，看到他用的是<code>createElement</code>然后<code>appendChild</code>感觉无法理解为什么要这样使用，难道<code>innerHTML</code>比这种方法的性能差吗？<br>由此自己做了一些实验</p>","more":"<p>自测代码如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;a&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;b&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> $a = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;a&quot;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> $b = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;b&quot;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> html1=<span class=\"string\">&#x27;&#x27;</span>,html2=<span class=\"string\">&#x27;&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test1</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.time(<span class=\"string\">&quot;html1:&quot;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>;i&lt;<span class=\"number\">1000</span>;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            html1 +=<span class=\"string\">&#x27;&lt;p&gt;&#x27;</span>+i+<span class=\"string\">&#x27;&lt;/p&gt;&#x27;</span>;</span></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           $a.innerHTML = html1;</span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"built_in\">console</span>.timeEnd(<span class=\"string\">&quot;html1:&quot;</span>)</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test2</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.time(<span class=\"string\">&quot;html2:&quot;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> fragment = <span class=\"built_in\">document</span>.createDocumentFragment();</span></span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>;i&lt;<span class=\"number\">1000</span>;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">               <span class=\"keyword\">let</span> p = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&quot;p&quot;</span>);</span></span><br><span class=\"line\">               p.innerHTML = i;</span><br><span class=\"line\">               fragment.appendChild(p);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           $b.appendChild(fragment);</span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"built_in\">console</span>.timeEnd(<span class=\"string\">&quot;html2:&quot;</span>)</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"javascript\">        test1(); <span class=\"comment\">//html1:: 3.000244140625ms</span></span></span><br><span class=\"line\"><span class=\"javascript\">        test2(); <span class=\"comment\">//html2:: 10.999755859375ms </span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>最后得出的结论是<code>innerHTML</code>的方法明显会比 <code>createElement</code>这种 办法好，就算是先<code>appendChild</code>到虚拟节点里面，也仍然性能不好。那为什么那些大佬们会用第二种办法？难道就是为了使用<code>createDocumentFragment</code>这个API？</p>\n<p>那么究竟<code>createElement</code>会比<code>innerHTML</code>好在哪里呢？</p>\n<p>看到一位大佬的答案是因为觉得拼接字符串丑陋。。。emmmmmm</p>\n<h3 id=\"createElement\"><a href=\"#createElement\" class=\"headerlink\" title=\"createElement\"></a><code>createElement</code></h3><p>在创建节点后就能直接事件监听事件，可是这种大量渲染，使用事件委托不是更完美吗？何必每一个都要绑定事件监听？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> oButton = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&quot;input&quot;</span>);</span><br><span class=\"line\">    oButton.type = <span class=\"string\">&quot;button&quot;</span>;</span><br><span class=\"line\">    oButton.value = <span class=\"string\">&quot;xxxxx&quot;</span>;</span><br><span class=\"line\">    aaa.appendChild(oButton);</span><br></pre></td></tr></table></figure>"},{"title":"jQuery-组件封装","date":"2019-04-19T03:32:25.000Z","_content":"\n总结在 jQuery 项目开发中所使用到的组件封装技巧，封装一些频繁被使用的功能。\n\n<!--more-->\n\n# JQuery 中封装组件的两种方法\n\n- 使用`$.extend`来扩展 JQuery\n- 通过`$.fn`向 JQuery 添加新的方法\n\n## `$.extend`\n\n```javascript\n(function() {\n  $.extend({\n    Alert: function(str) {\n      if (!str) return;\n      alert(str);\n      console.log(str);\n    }\n  });\n})(JQuery);\n$.Alert();\n$.Alert('Hello');\n```\n\n但是这种方式的弊端是无法使用`$(\"div\").Alert()` 这种形式\n\n## `$.fn`\n\n基本语法：\n\n```javascript\n$.fn.pluginName = function() {};\n```\n\n在插件名字定义的这个函数内部， this 指代的是我们在调用该插件时，用 jQuery 选择器选中的元素\n\n```javascript\n$(function() {\n  $.fn.bgColor = function(cor) {\n    $(this).css('background-color', cor);\n  };\n});\n$('div').bgColor('red');\n```\n","source":"_posts/jQuery-组件封装.md","raw":"---\ntitle: jQuery-组件封装\ndate: 2019-04-19 11:32:25\ncategories: jQuery\n---\n\n总结在 jQuery 项目开发中所使用到的组件封装技巧，封装一些频繁被使用的功能。\n\n<!--more-->\n\n# JQuery 中封装组件的两种方法\n\n- 使用`$.extend`来扩展 JQuery\n- 通过`$.fn`向 JQuery 添加新的方法\n\n## `$.extend`\n\n```javascript\n(function() {\n  $.extend({\n    Alert: function(str) {\n      if (!str) return;\n      alert(str);\n      console.log(str);\n    }\n  });\n})(JQuery);\n$.Alert();\n$.Alert('Hello');\n```\n\n但是这种方式的弊端是无法使用`$(\"div\").Alert()` 这种形式\n\n## `$.fn`\n\n基本语法：\n\n```javascript\n$.fn.pluginName = function() {};\n```\n\n在插件名字定义的这个函数内部， this 指代的是我们在调用该插件时，用 jQuery 选择器选中的元素\n\n```javascript\n$(function() {\n  $.fn.bgColor = function(cor) {\n    $(this).css('background-color', cor);\n  };\n});\n$('div').bgColor('red');\n```\n","slug":"jQuery-组件封装","published":1,"updated":"2021-02-27T12:24:38.485Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x2001gl5v0bu2861yu","content":"<p>总结在 jQuery 项目开发中所使用到的组件封装技巧，封装一些频繁被使用的功能。</p>\n<span id=\"more\"></span>\n\n<h1 id=\"JQuery-中封装组件的两种方法\"><a href=\"#JQuery-中封装组件的两种方法\" class=\"headerlink\" title=\"JQuery 中封装组件的两种方法\"></a>JQuery 中封装组件的两种方法</h1><ul>\n<li>使用<code>$.extend</code>来扩展 JQuery</li>\n<li>通过<code>$.fn</code>向 JQuery 添加新的方法</li>\n</ul>\n<h2 id=\"extend\"><a href=\"#extend\" class=\"headerlink\" title=\"$.extend\"></a><code>$.extend</code></h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  $.extend(&#123;</span><br><span class=\"line\">    Alert: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!str) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      alert(str);</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(str);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;)(JQuery);</span><br><span class=\"line\">$.Alert();</span><br><span class=\"line\">$.Alert(<span class=\"string\">&#x27;Hello&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>但是这种方式的弊端是无法使用<code>$(&quot;div&quot;).Alert()</code> 这种形式</p>\n<h2 id=\"fn\"><a href=\"#fn\" class=\"headerlink\" title=\"$.fn\"></a><code>$.fn</code></h2><p>基本语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.fn.pluginName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>在插件名字定义的这个函数内部， this 指代的是我们在调用该插件时，用 jQuery 选择器选中的元素</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  $.fn.bgColor = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cor</span>) </span>&#123;</span><br><span class=\"line\">    $(<span class=\"built_in\">this</span>).css(<span class=\"string\">&#x27;background-color&#x27;</span>, cor);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">$(<span class=\"string\">&#x27;div&#x27;</span>).bgColor(<span class=\"string\">&#x27;red&#x27;</span>);</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>总结在 jQuery 项目开发中所使用到的组件封装技巧，封装一些频繁被使用的功能。</p>","more":"<h1 id=\"JQuery-中封装组件的两种方法\"><a href=\"#JQuery-中封装组件的两种方法\" class=\"headerlink\" title=\"JQuery 中封装组件的两种方法\"></a>JQuery 中封装组件的两种方法</h1><ul>\n<li>使用<code>$.extend</code>来扩展 JQuery</li>\n<li>通过<code>$.fn</code>向 JQuery 添加新的方法</li>\n</ul>\n<h2 id=\"extend\"><a href=\"#extend\" class=\"headerlink\" title=\"$.extend\"></a><code>$.extend</code></h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  $.extend(&#123;</span><br><span class=\"line\">    Alert: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!str) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      alert(str);</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(str);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;)(JQuery);</span><br><span class=\"line\">$.Alert();</span><br><span class=\"line\">$.Alert(<span class=\"string\">&#x27;Hello&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>但是这种方式的弊端是无法使用<code>$(&quot;div&quot;).Alert()</code> 这种形式</p>\n<h2 id=\"fn\"><a href=\"#fn\" class=\"headerlink\" title=\"$.fn\"></a><code>$.fn</code></h2><p>基本语法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.fn.pluginName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>在插件名字定义的这个函数内部， this 指代的是我们在调用该插件时，用 jQuery 选择器选中的元素</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  $.fn.bgColor = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cor</span>) </span>&#123;</span><br><span class=\"line\">    $(<span class=\"built_in\">this</span>).css(<span class=\"string\">&#x27;background-color&#x27;</span>, cor);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">$(<span class=\"string\">&#x27;div&#x27;</span>).bgColor(<span class=\"string\">&#x27;red&#x27;</span>);</span><br></pre></td></tr></table></figure>"},{"title":"jQuery-源码学习（一）","date":"2018-06-22T03:45:06.000Z","_content":"\n\n感觉自己的很多的代码质量不够好，最近在频繁的使用 jQuery,感觉 jQuery 中的一些函数的思想是应该去学习的，尤其是设计模式的思想，在以后的 vue 开发中，在不引用 jQuery 的情况下，能借鉴 jQuery 的思想封装一些不依赖 DOM 的公共函数。也觉得自己对一些设计模式之内的了解甚少，所以学习 jQuery 源码势在必行。\n\n<!--more-->\n\n\n# jQuery框架的核心\n\n任何库与框架设计的第一要点就是解决命名空间与变量污染的问题。jQuery 就是利用 js 函数作用域的特性，采用立即调用表达式包裹自身的方法解决。\n\n- 匹配`HTML`文档中元素并对其执行操作。\n- 链式调用。\n\n# jQuery 对象的构建方式\n\n常规构建方式：\n```javascript\nvar aquery = function(selector, context){\n  //构造函数\n}\naquery.prototype = {\n  //原型\n  name:function(){},\n  age:function(){}\n}\nvar a = new aquery();\na.name();\n```\n原因：我猜想是因为更好的封装吧。\n\n```javascript\n(function(window, undefined) {\n  function jQuery(selector) {\n    return new jQuery.fn.init(selector);\n    // 若是return jQuery.fn.init(selector) 则init中的this是指向jQuery，只有new 后才能隔离作用域\n  }\n  jQuery.fn = jQuery.prototype = {\n    init: function() {\n      this.age = 18\n      return this\n    },\n    name:function(){\n      console.log(this.age)\n    }\n    age:20\n  };\n  jQuery().age //18\n  jQuery.fn.init.prototype = jQuery.fn; \n  //主要是将jQuery原型链下的方法挂载在 jQuery.fn.init的原型链下\n  window.jQuery = window.$ = jQuery;\n})(window);\n```\n- 闭包结构传参 window\n  - 闭包结构传入实参 window,然后里面用形参接收\n    - 减少内部每次引用 window 的查询时间\n    - 方便压缩代码\n- 形参 undefined\n  - 因为 ie 低版本的浏览器可以给 undefined 赋值成功，所以为了保证 undefined 一定是 undefined\n- jQuery 传参 selector\n  - selector 可以是一对标签，可以是 id、类 、后代、子代等等，可以是 jQuery 对象\n- jQuery 原型对象赋值给 jQuery 原型方法 init 的原型\n- 给 window 暴露可利用成员。\n\n**javascript 中的 undefined 并不是作为一个关键字，因此可以允许用户对其赋值。**\n\n## `jQuery.fn.init.prototype = jQuery.fn` 的作用\n\n** 既能隔离作用域还能使用jQuery原型对象的作用域，在返回实例中访问jQuery的原型对象**\n\n`jQuery.fn.init.prototype = jQuery.fn`使得jQuery的原型对象覆盖了init 构造器的原型对象。\n\n\n## 对象的构建\n\n类一：\n\n```javascript\nfunction aQuery() {\n  this.name = 'jQuery';\n  this.sayName = function() {\n    return this.name;\n  };\n}\n\nvar a = new aQuery();\nvar b = new aQuery();\nvar c = new aQuery();\n```\n\n类二：\n\n```javascript\nfunction aQuery() {\n  this.name = 'jQuery';\n}\n\naQuery.prototype = {\n  sayName: function() {\n    return this.name;\n  }\n};\n\nvar a = new aQuery();\nvar b = new aQuery();\nvar c = new aQuery();\n```\n\n类二 new 产生的 a、b、c 三个实例对象共享了原型的 sayName 方法，这样的好处是节省了内存空间，类一则是要为每一个实例复制 sayName 方法，每个方法属性都占用一定的内存空间，所以如果把所有属性方法都声明在构造函数中，就会无形的增大很多开销。除此之外类一的所有方法都是拷贝到当前实例对象上。类二则是要通过 scope 连接到原型链上查找，这样就无形中多一层作用域链的查找。\n\n\n## 分离构造器\n\n通过 new 操作符构建一个对象，一般经过 4 步：\n\n- 创建一个新对象\n- 将构造函数的作用域给新对象（所以 this 就指向了这个新对象）\n- 执行构造函数中的代码\n- 返回这个新对象\n\n其实 new 操作符主要是把原型链跟实例的 this 关联起来，所以我们如果需要原型链就必须要 new 操作符来进行处理。否则 this 则变成 window 对象了。\n\n```javascript\nvar $$ = (ajQuery = function(selsctor) {\n  this.selector = selector;\n  return this;\n});\n\najQuery.fn = ajQuery.prototype = {\n  selectorName: function() {\n    return this.selector;\n  },\n  constructor: ajQuery\n};\n\nvar a = new $$('aaa'); //实例化\na.selectorName(); //aaa //得到选择器名字\n```\n\n首先改造 jQuery 无 new 的格式，我们可以通过 instanceof 来判断 this 是否是当前实例：\n\n```javascript\nvar $$ = (ajQuery = function(selector) {\n  if (!(this instanceof ajQuery)) {\n    return new ajQuery(selector);\n  }\n  this.selector = selector;\n  return this;\n});\n```\n# 链式调用\nDOM 链式调用的处理：\n1. 节约JS代码\n2. 所返回的都是同一个对象，可以提高代码效率。\n\n```javascript\n  jQuery.prototype = {\n    init:function(){\n      return this\n    },\n    name:function(){\n      return this\n    }\n  }\n\n  jQuery.init().name()\n\n```\n\n# 静态与实例方法共享设计\n\n遍历方法：\n\n```javascript\n$('.aaron').each(); //作为实例方法存在\n$.each(); //作为静态方法存在\n```\n\n第一条语句是给指定的上下文调用的，就是获取('.aaron')获取的 DOM 合集，第二条语句\\$.each()函数可用于得带任何集合，无论是“名/值”对象 或是数组。在迭代数组的情况下，回调函数每次都会传递一个数组索引和相应的数组值作为参数。\n\n```javascript\njQuery.prototype = {\n  each: function(callback, args) {\n    return jQuery.each(this, callback, args);\n  }\n};\n```\n\n实例方法取于静态方法，静态方法挂在 jQuery 构造器上，原型方法呢？jQuery 通过 new 原型 prototype 上 init 方法当成构造器，那么 init 原型链方法就是实例的方法了，所以 jQuery 通过 2 个构造器划分 2 种不同的调用方式，一种是静态，一种是原型。\n\n# 事件绑定\n\njQuery对事件的绑定分别有几个API `.bind(),.live(),.delegate(),.on()`\n不管是用什么方式绑定，归根到底还是用的`addEventListener/attachEvent`处理的，正如选择器不管如何匹配最终还是那些个浏览器接口处理\n\n不管是是用click/bind/delegate之中的哪个方法，最终都是jQuery底层都是调用on方法来完成最终的事件绑定。\n","source":"_posts/jQuery-源码学习（一）.md","raw":"---\ntitle: jQuery-源码学习（一）\ndate: 2018-06-22 11:45:06\ncategories: jQuery\n---\n\n\n感觉自己的很多的代码质量不够好，最近在频繁的使用 jQuery,感觉 jQuery 中的一些函数的思想是应该去学习的，尤其是设计模式的思想，在以后的 vue 开发中，在不引用 jQuery 的情况下，能借鉴 jQuery 的思想封装一些不依赖 DOM 的公共函数。也觉得自己对一些设计模式之内的了解甚少，所以学习 jQuery 源码势在必行。\n\n<!--more-->\n\n\n# jQuery框架的核心\n\n任何库与框架设计的第一要点就是解决命名空间与变量污染的问题。jQuery 就是利用 js 函数作用域的特性，采用立即调用表达式包裹自身的方法解决。\n\n- 匹配`HTML`文档中元素并对其执行操作。\n- 链式调用。\n\n# jQuery 对象的构建方式\n\n常规构建方式：\n```javascript\nvar aquery = function(selector, context){\n  //构造函数\n}\naquery.prototype = {\n  //原型\n  name:function(){},\n  age:function(){}\n}\nvar a = new aquery();\na.name();\n```\n原因：我猜想是因为更好的封装吧。\n\n```javascript\n(function(window, undefined) {\n  function jQuery(selector) {\n    return new jQuery.fn.init(selector);\n    // 若是return jQuery.fn.init(selector) 则init中的this是指向jQuery，只有new 后才能隔离作用域\n  }\n  jQuery.fn = jQuery.prototype = {\n    init: function() {\n      this.age = 18\n      return this\n    },\n    name:function(){\n      console.log(this.age)\n    }\n    age:20\n  };\n  jQuery().age //18\n  jQuery.fn.init.prototype = jQuery.fn; \n  //主要是将jQuery原型链下的方法挂载在 jQuery.fn.init的原型链下\n  window.jQuery = window.$ = jQuery;\n})(window);\n```\n- 闭包结构传参 window\n  - 闭包结构传入实参 window,然后里面用形参接收\n    - 减少内部每次引用 window 的查询时间\n    - 方便压缩代码\n- 形参 undefined\n  - 因为 ie 低版本的浏览器可以给 undefined 赋值成功，所以为了保证 undefined 一定是 undefined\n- jQuery 传参 selector\n  - selector 可以是一对标签，可以是 id、类 、后代、子代等等，可以是 jQuery 对象\n- jQuery 原型对象赋值给 jQuery 原型方法 init 的原型\n- 给 window 暴露可利用成员。\n\n**javascript 中的 undefined 并不是作为一个关键字，因此可以允许用户对其赋值。**\n\n## `jQuery.fn.init.prototype = jQuery.fn` 的作用\n\n** 既能隔离作用域还能使用jQuery原型对象的作用域，在返回实例中访问jQuery的原型对象**\n\n`jQuery.fn.init.prototype = jQuery.fn`使得jQuery的原型对象覆盖了init 构造器的原型对象。\n\n\n## 对象的构建\n\n类一：\n\n```javascript\nfunction aQuery() {\n  this.name = 'jQuery';\n  this.sayName = function() {\n    return this.name;\n  };\n}\n\nvar a = new aQuery();\nvar b = new aQuery();\nvar c = new aQuery();\n```\n\n类二：\n\n```javascript\nfunction aQuery() {\n  this.name = 'jQuery';\n}\n\naQuery.prototype = {\n  sayName: function() {\n    return this.name;\n  }\n};\n\nvar a = new aQuery();\nvar b = new aQuery();\nvar c = new aQuery();\n```\n\n类二 new 产生的 a、b、c 三个实例对象共享了原型的 sayName 方法，这样的好处是节省了内存空间，类一则是要为每一个实例复制 sayName 方法，每个方法属性都占用一定的内存空间，所以如果把所有属性方法都声明在构造函数中，就会无形的增大很多开销。除此之外类一的所有方法都是拷贝到当前实例对象上。类二则是要通过 scope 连接到原型链上查找，这样就无形中多一层作用域链的查找。\n\n\n## 分离构造器\n\n通过 new 操作符构建一个对象，一般经过 4 步：\n\n- 创建一个新对象\n- 将构造函数的作用域给新对象（所以 this 就指向了这个新对象）\n- 执行构造函数中的代码\n- 返回这个新对象\n\n其实 new 操作符主要是把原型链跟实例的 this 关联起来，所以我们如果需要原型链就必须要 new 操作符来进行处理。否则 this 则变成 window 对象了。\n\n```javascript\nvar $$ = (ajQuery = function(selsctor) {\n  this.selector = selector;\n  return this;\n});\n\najQuery.fn = ajQuery.prototype = {\n  selectorName: function() {\n    return this.selector;\n  },\n  constructor: ajQuery\n};\n\nvar a = new $$('aaa'); //实例化\na.selectorName(); //aaa //得到选择器名字\n```\n\n首先改造 jQuery 无 new 的格式，我们可以通过 instanceof 来判断 this 是否是当前实例：\n\n```javascript\nvar $$ = (ajQuery = function(selector) {\n  if (!(this instanceof ajQuery)) {\n    return new ajQuery(selector);\n  }\n  this.selector = selector;\n  return this;\n});\n```\n# 链式调用\nDOM 链式调用的处理：\n1. 节约JS代码\n2. 所返回的都是同一个对象，可以提高代码效率。\n\n```javascript\n  jQuery.prototype = {\n    init:function(){\n      return this\n    },\n    name:function(){\n      return this\n    }\n  }\n\n  jQuery.init().name()\n\n```\n\n# 静态与实例方法共享设计\n\n遍历方法：\n\n```javascript\n$('.aaron').each(); //作为实例方法存在\n$.each(); //作为静态方法存在\n```\n\n第一条语句是给指定的上下文调用的，就是获取('.aaron')获取的 DOM 合集，第二条语句\\$.each()函数可用于得带任何集合，无论是“名/值”对象 或是数组。在迭代数组的情况下，回调函数每次都会传递一个数组索引和相应的数组值作为参数。\n\n```javascript\njQuery.prototype = {\n  each: function(callback, args) {\n    return jQuery.each(this, callback, args);\n  }\n};\n```\n\n实例方法取于静态方法，静态方法挂在 jQuery 构造器上，原型方法呢？jQuery 通过 new 原型 prototype 上 init 方法当成构造器，那么 init 原型链方法就是实例的方法了，所以 jQuery 通过 2 个构造器划分 2 种不同的调用方式，一种是静态，一种是原型。\n\n# 事件绑定\n\njQuery对事件的绑定分别有几个API `.bind(),.live(),.delegate(),.on()`\n不管是用什么方式绑定，归根到底还是用的`addEventListener/attachEvent`处理的，正如选择器不管如何匹配最终还是那些个浏览器接口处理\n\n不管是是用click/bind/delegate之中的哪个方法，最终都是jQuery底层都是调用on方法来完成最终的事件绑定。\n","slug":"jQuery-源码学习（一）","published":1,"updated":"2021-02-27T12:24:38.485Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x2001il5v036jd7qyd","content":"<p>感觉自己的很多的代码质量不够好，最近在频繁的使用 jQuery,感觉 jQuery 中的一些函数的思想是应该去学习的，尤其是设计模式的思想，在以后的 vue 开发中，在不引用 jQuery 的情况下，能借鉴 jQuery 的思想封装一些不依赖 DOM 的公共函数。也觉得自己对一些设计模式之内的了解甚少，所以学习 jQuery 源码势在必行。</p>\n<span id=\"more\"></span>\n\n\n<h1 id=\"jQuery框架的核心\"><a href=\"#jQuery框架的核心\" class=\"headerlink\" title=\"jQuery框架的核心\"></a>jQuery框架的核心</h1><p>任何库与框架设计的第一要点就是解决命名空间与变量污染的问题。jQuery 就是利用 js 函数作用域的特性，采用立即调用表达式包裹自身的方法解决。</p>\n<ul>\n<li>匹配<code>HTML</code>文档中元素并对其执行操作。</li>\n<li>链式调用。</li>\n</ul>\n<h1 id=\"jQuery-对象的构建方式\"><a href=\"#jQuery-对象的构建方式\" class=\"headerlink\" title=\"jQuery 对象的构建方式\"></a>jQuery 对象的构建方式</h1><p>常规构建方式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> aquery = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">selector, context</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//构造函数</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">aquery.prototype = &#123;</span><br><span class=\"line\">  <span class=\"comment\">//原型</span></span><br><span class=\"line\">  name:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,</span><br><span class=\"line\">  age:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> aquery();</span><br><span class=\"line\">a.name();</span><br></pre></td></tr></table></figure>\n<p>原因：我猜想是因为更好的封装吧。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"><span class=\"built_in\">window</span>, <span class=\"literal\">undefined</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">jQuery</span>(<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> jQuery.fn.init(selector);</span><br><span class=\"line\">    <span class=\"comment\">// 若是return jQuery.fn.init(selector) 则init中的this是指向jQuery，只有new 后才能隔离作用域</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  jQuery.fn = jQuery.prototype = &#123;</span><br><span class=\"line\">    init: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.age = <span class=\"number\">18</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    name:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    age:<span class=\"number\">20</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  jQuery().age <span class=\"comment\">//18</span></span><br><span class=\"line\">  jQuery.fn.init.prototype = jQuery.fn; </span><br><span class=\"line\">  <span class=\"comment\">//主要是将jQuery原型链下的方法挂载在 jQuery.fn.init的原型链下</span></span><br><span class=\"line\">  <span class=\"built_in\">window</span>.jQuery = <span class=\"built_in\">window</span>.$ = jQuery;</span><br><span class=\"line\">&#125;)(<span class=\"built_in\">window</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>闭包结构传参 window<ul>\n<li>闭包结构传入实参 window,然后里面用形参接收<ul>\n<li>减少内部每次引用 window 的查询时间</li>\n<li>方便压缩代码</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>形参 undefined<ul>\n<li>因为 ie 低版本的浏览器可以给 undefined 赋值成功，所以为了保证 undefined 一定是 undefined</li>\n</ul>\n</li>\n<li>jQuery 传参 selector<ul>\n<li>selector 可以是一对标签，可以是 id、类 、后代、子代等等，可以是 jQuery 对象</li>\n</ul>\n</li>\n<li>jQuery 原型对象赋值给 jQuery 原型方法 init 的原型</li>\n<li>给 window 暴露可利用成员。</li>\n</ul>\n<p><strong>javascript 中的 undefined 并不是作为一个关键字，因此可以允许用户对其赋值。</strong></p>\n<h2 id=\"jQuery-fn-init-prototype-jQuery-fn-的作用\"><a href=\"#jQuery-fn-init-prototype-jQuery-fn-的作用\" class=\"headerlink\" title=\"jQuery.fn.init.prototype = jQuery.fn 的作用\"></a><code>jQuery.fn.init.prototype = jQuery.fn</code> 的作用</h2><p>** 既能隔离作用域还能使用jQuery原型对象的作用域，在返回实例中访问jQuery的原型对象**</p>\n<p><code>jQuery.fn.init.prototype = jQuery.fn</code>使得jQuery的原型对象覆盖了init 构造器的原型对象。</p>\n<h2 id=\"对象的构建\"><a href=\"#对象的构建\" class=\"headerlink\" title=\"对象的构建\"></a>对象的构建</h2><p>类一：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">aQuery</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;jQuery&#x27;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> aQuery();</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> aQuery();</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> aQuery();</span><br></pre></td></tr></table></figure>\n\n<p>类二：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">aQuery</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;jQuery&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">aQuery.prototype = &#123;</span><br><span class=\"line\">  sayName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> aQuery();</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> aQuery();</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> aQuery();</span><br></pre></td></tr></table></figure>\n\n<p>类二 new 产生的 a、b、c 三个实例对象共享了原型的 sayName 方法，这样的好处是节省了内存空间，类一则是要为每一个实例复制 sayName 方法，每个方法属性都占用一定的内存空间，所以如果把所有属性方法都声明在构造函数中，就会无形的增大很多开销。除此之外类一的所有方法都是拷贝到当前实例对象上。类二则是要通过 scope 连接到原型链上查找，这样就无形中多一层作用域链的查找。</p>\n<h2 id=\"分离构造器\"><a href=\"#分离构造器\" class=\"headerlink\" title=\"分离构造器\"></a>分离构造器</h2><p>通过 new 操作符构建一个对象，一般经过 4 步：</p>\n<ul>\n<li>创建一个新对象</li>\n<li>将构造函数的作用域给新对象（所以 this 就指向了这个新对象）</li>\n<li>执行构造函数中的代码</li>\n<li>返回这个新对象</li>\n</ul>\n<p>其实 new 操作符主要是把原型链跟实例的 this 关联起来，所以我们如果需要原型链就必须要 new 操作符来进行处理。否则 this 则变成 window 对象了。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> $$ = (ajQuery = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">selsctor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.selector = selector;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">ajQuery.fn = ajQuery.prototype = &#123;</span><br><span class=\"line\">  selectorName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.selector;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title\">constructor</span>: <span class=\"title\">ajQuery</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> $$(<span class=\"string\">&#x27;aaa&#x27;</span>); <span class=\"comment\">//实例化</span></span><br><span class=\"line\">a.selectorName(); <span class=\"comment\">//aaa //得到选择器名字</span></span><br></pre></td></tr></table></figure>\n\n<p>首先改造 jQuery 无 new 的格式，我们可以通过 instanceof 来判断 this 是否是当前实例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> $$ = (ajQuery = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(<span class=\"built_in\">this</span> <span class=\"keyword\">instanceof</span> ajQuery)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ajQuery(selector);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.selector = selector;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h1 id=\"链式调用\"><a href=\"#链式调用\" class=\"headerlink\" title=\"链式调用\"></a>链式调用</h1><p>DOM 链式调用的处理：</p>\n<ol>\n<li>节约JS代码</li>\n<li>所返回的都是同一个对象，可以提高代码效率。</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jQuery.prototype = &#123;</span><br><span class=\"line\">  init:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  name:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">jQuery.init().name()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"静态与实例方法共享设计\"><a href=\"#静态与实例方法共享设计\" class=\"headerlink\" title=\"静态与实例方法共享设计\"></a>静态与实例方法共享设计</h1><p>遍历方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;.aaron&#x27;</span>).each(); <span class=\"comment\">//作为实例方法存在</span></span><br><span class=\"line\">$.each(); <span class=\"comment\">//作为静态方法存在</span></span><br></pre></td></tr></table></figure>\n\n<p>第一条语句是给指定的上下文调用的，就是获取(‘.aaron’)获取的 DOM 合集，第二条语句$.each()函数可用于得带任何集合，无论是“名/值”对象 或是数组。在迭代数组的情况下，回调函数每次都会传递一个数组索引和相应的数组值作为参数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jQuery.prototype = &#123;</span><br><span class=\"line\">  each: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback, args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> jQuery.each(<span class=\"built_in\">this</span>, callback, args);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>实例方法取于静态方法，静态方法挂在 jQuery 构造器上，原型方法呢？jQuery 通过 new 原型 prototype 上 init 方法当成构造器，那么 init 原型链方法就是实例的方法了，所以 jQuery 通过 2 个构造器划分 2 种不同的调用方式，一种是静态，一种是原型。</p>\n<h1 id=\"事件绑定\"><a href=\"#事件绑定\" class=\"headerlink\" title=\"事件绑定\"></a>事件绑定</h1><p>jQuery对事件的绑定分别有几个API <code>.bind(),.live(),.delegate(),.on()</code><br>不管是用什么方式绑定，归根到底还是用的<code>addEventListener/attachEvent</code>处理的，正如选择器不管如何匹配最终还是那些个浏览器接口处理</p>\n<p>不管是是用click/bind/delegate之中的哪个方法，最终都是jQuery底层都是调用on方法来完成最终的事件绑定。</p>\n","site":{"data":{}},"excerpt":"<p>感觉自己的很多的代码质量不够好，最近在频繁的使用 jQuery,感觉 jQuery 中的一些函数的思想是应该去学习的，尤其是设计模式的思想，在以后的 vue 开发中，在不引用 jQuery 的情况下，能借鉴 jQuery 的思想封装一些不依赖 DOM 的公共函数。也觉得自己对一些设计模式之内的了解甚少，所以学习 jQuery 源码势在必行。</p>","more":"<h1 id=\"jQuery框架的核心\"><a href=\"#jQuery框架的核心\" class=\"headerlink\" title=\"jQuery框架的核心\"></a>jQuery框架的核心</h1><p>任何库与框架设计的第一要点就是解决命名空间与变量污染的问题。jQuery 就是利用 js 函数作用域的特性，采用立即调用表达式包裹自身的方法解决。</p>\n<ul>\n<li>匹配<code>HTML</code>文档中元素并对其执行操作。</li>\n<li>链式调用。</li>\n</ul>\n<h1 id=\"jQuery-对象的构建方式\"><a href=\"#jQuery-对象的构建方式\" class=\"headerlink\" title=\"jQuery 对象的构建方式\"></a>jQuery 对象的构建方式</h1><p>常规构建方式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> aquery = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">selector, context</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//构造函数</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">aquery.prototype = &#123;</span><br><span class=\"line\">  <span class=\"comment\">//原型</span></span><br><span class=\"line\">  name:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,</span><br><span class=\"line\">  age:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> aquery();</span><br><span class=\"line\">a.name();</span><br></pre></td></tr></table></figure>\n<p>原因：我猜想是因为更好的封装吧。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"><span class=\"built_in\">window</span>, <span class=\"literal\">undefined</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">jQuery</span>(<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> jQuery.fn.init(selector);</span><br><span class=\"line\">    <span class=\"comment\">// 若是return jQuery.fn.init(selector) 则init中的this是指向jQuery，只有new 后才能隔离作用域</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  jQuery.fn = jQuery.prototype = &#123;</span><br><span class=\"line\">    init: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.age = <span class=\"number\">18</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    name:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    age:<span class=\"number\">20</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  jQuery().age <span class=\"comment\">//18</span></span><br><span class=\"line\">  jQuery.fn.init.prototype = jQuery.fn; </span><br><span class=\"line\">  <span class=\"comment\">//主要是将jQuery原型链下的方法挂载在 jQuery.fn.init的原型链下</span></span><br><span class=\"line\">  <span class=\"built_in\">window</span>.jQuery = <span class=\"built_in\">window</span>.$ = jQuery;</span><br><span class=\"line\">&#125;)(<span class=\"built_in\">window</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>闭包结构传参 window<ul>\n<li>闭包结构传入实参 window,然后里面用形参接收<ul>\n<li>减少内部每次引用 window 的查询时间</li>\n<li>方便压缩代码</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>形参 undefined<ul>\n<li>因为 ie 低版本的浏览器可以给 undefined 赋值成功，所以为了保证 undefined 一定是 undefined</li>\n</ul>\n</li>\n<li>jQuery 传参 selector<ul>\n<li>selector 可以是一对标签，可以是 id、类 、后代、子代等等，可以是 jQuery 对象</li>\n</ul>\n</li>\n<li>jQuery 原型对象赋值给 jQuery 原型方法 init 的原型</li>\n<li>给 window 暴露可利用成员。</li>\n</ul>\n<p><strong>javascript 中的 undefined 并不是作为一个关键字，因此可以允许用户对其赋值。</strong></p>\n<h2 id=\"jQuery-fn-init-prototype-jQuery-fn-的作用\"><a href=\"#jQuery-fn-init-prototype-jQuery-fn-的作用\" class=\"headerlink\" title=\"jQuery.fn.init.prototype = jQuery.fn 的作用\"></a><code>jQuery.fn.init.prototype = jQuery.fn</code> 的作用</h2><p>** 既能隔离作用域还能使用jQuery原型对象的作用域，在返回实例中访问jQuery的原型对象**</p>\n<p><code>jQuery.fn.init.prototype = jQuery.fn</code>使得jQuery的原型对象覆盖了init 构造器的原型对象。</p>\n<h2 id=\"对象的构建\"><a href=\"#对象的构建\" class=\"headerlink\" title=\"对象的构建\"></a>对象的构建</h2><p>类一：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">aQuery</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;jQuery&#x27;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> aQuery();</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> aQuery();</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> aQuery();</span><br></pre></td></tr></table></figure>\n\n<p>类二：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">aQuery</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;jQuery&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">aQuery.prototype = &#123;</span><br><span class=\"line\">  sayName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> aQuery();</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> aQuery();</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> aQuery();</span><br></pre></td></tr></table></figure>\n\n<p>类二 new 产生的 a、b、c 三个实例对象共享了原型的 sayName 方法，这样的好处是节省了内存空间，类一则是要为每一个实例复制 sayName 方法，每个方法属性都占用一定的内存空间，所以如果把所有属性方法都声明在构造函数中，就会无形的增大很多开销。除此之外类一的所有方法都是拷贝到当前实例对象上。类二则是要通过 scope 连接到原型链上查找，这样就无形中多一层作用域链的查找。</p>\n<h2 id=\"分离构造器\"><a href=\"#分离构造器\" class=\"headerlink\" title=\"分离构造器\"></a>分离构造器</h2><p>通过 new 操作符构建一个对象，一般经过 4 步：</p>\n<ul>\n<li>创建一个新对象</li>\n<li>将构造函数的作用域给新对象（所以 this 就指向了这个新对象）</li>\n<li>执行构造函数中的代码</li>\n<li>返回这个新对象</li>\n</ul>\n<p>其实 new 操作符主要是把原型链跟实例的 this 关联起来，所以我们如果需要原型链就必须要 new 操作符来进行处理。否则 this 则变成 window 对象了。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> $$ = (ajQuery = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">selsctor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.selector = selector;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">ajQuery.fn = ajQuery.prototype = &#123;</span><br><span class=\"line\">  selectorName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.selector;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title\">constructor</span>: <span class=\"title\">ajQuery</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> $$(<span class=\"string\">&#x27;aaa&#x27;</span>); <span class=\"comment\">//实例化</span></span><br><span class=\"line\">a.selectorName(); <span class=\"comment\">//aaa //得到选择器名字</span></span><br></pre></td></tr></table></figure>\n\n<p>首先改造 jQuery 无 new 的格式，我们可以通过 instanceof 来判断 this 是否是当前实例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> $$ = (ajQuery = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">selector</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(<span class=\"built_in\">this</span> <span class=\"keyword\">instanceof</span> ajQuery)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ajQuery(selector);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.selector = selector;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h1 id=\"链式调用\"><a href=\"#链式调用\" class=\"headerlink\" title=\"链式调用\"></a>链式调用</h1><p>DOM 链式调用的处理：</p>\n<ol>\n<li>节约JS代码</li>\n<li>所返回的都是同一个对象，可以提高代码效率。</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jQuery.prototype = &#123;</span><br><span class=\"line\">  init:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  name:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">jQuery.init().name()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"静态与实例方法共享设计\"><a href=\"#静态与实例方法共享设计\" class=\"headerlink\" title=\"静态与实例方法共享设计\"></a>静态与实例方法共享设计</h1><p>遍历方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;.aaron&#x27;</span>).each(); <span class=\"comment\">//作为实例方法存在</span></span><br><span class=\"line\">$.each(); <span class=\"comment\">//作为静态方法存在</span></span><br></pre></td></tr></table></figure>\n\n<p>第一条语句是给指定的上下文调用的，就是获取(‘.aaron’)获取的 DOM 合集，第二条语句$.each()函数可用于得带任何集合，无论是“名/值”对象 或是数组。在迭代数组的情况下，回调函数每次都会传递一个数组索引和相应的数组值作为参数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jQuery.prototype = &#123;</span><br><span class=\"line\">  each: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback, args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> jQuery.each(<span class=\"built_in\">this</span>, callback, args);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>实例方法取于静态方法，静态方法挂在 jQuery 构造器上，原型方法呢？jQuery 通过 new 原型 prototype 上 init 方法当成构造器，那么 init 原型链方法就是实例的方法了，所以 jQuery 通过 2 个构造器划分 2 种不同的调用方式，一种是静态，一种是原型。</p>\n<h1 id=\"事件绑定\"><a href=\"#事件绑定\" class=\"headerlink\" title=\"事件绑定\"></a>事件绑定</h1><p>jQuery对事件的绑定分别有几个API <code>.bind(),.live(),.delegate(),.on()</code><br>不管是用什么方式绑定，归根到底还是用的<code>addEventListener/attachEvent</code>处理的，正如选择器不管如何匹配最终还是那些个浏览器接口处理</p>\n<p>不管是是用click/bind/delegate之中的哪个方法，最终都是jQuery底层都是调用on方法来完成最终的事件绑定。</p>"},{"title":"keep-alive小知识","date":"2020-03-09T03:28:03.000Z","_content":"keep-alive 使用的小知识点\n\n<!--more-->\n\n- 在动态组件中的应用\n```html\n<keep-alive :include=\"whiteList\" :exclude=\"blackList\" :max=\"amount\">\n     <component :is=\"currentComponent\"></component>\n</keep-alive>\n```\n- include 定义白名单\n- exclude定义黑名单\n- max 定义缓存组件的上限，超出上限使用LRU的策略置换缓存数据\n\nLRU:\n内存管理的一种置换算法，对于在内存中但又不用数据块（内存块）叫做LRU，造作系统会根据那些数据属于LRU而将其移出内存而腾出空间来加载另外的数据。\n\n\n只有当组件在keep-alive 内被切换，才会有actived和deactived 这两个钩子函数。\n\n## keep-alive 组件的渲染\n","source":"_posts/keep-alive小知识.md","raw":"---\ntitle: keep-alive小知识\ndate: 2020-03-09 11:28:03\ncategories: Vue\n---\nkeep-alive 使用的小知识点\n\n<!--more-->\n\n- 在动态组件中的应用\n```html\n<keep-alive :include=\"whiteList\" :exclude=\"blackList\" :max=\"amount\">\n     <component :is=\"currentComponent\"></component>\n</keep-alive>\n```\n- include 定义白名单\n- exclude定义黑名单\n- max 定义缓存组件的上限，超出上限使用LRU的策略置换缓存数据\n\nLRU:\n内存管理的一种置换算法，对于在内存中但又不用数据块（内存块）叫做LRU，造作系统会根据那些数据属于LRU而将其移出内存而腾出空间来加载另外的数据。\n\n\n只有当组件在keep-alive 内被切换，才会有actived和deactived 这两个钩子函数。\n\n## keep-alive 组件的渲染\n","slug":"keep-alive小知识","published":1,"updated":"2021-02-27T12:24:38.486Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x3001ll5v07wg8g8wa","content":"<p>keep-alive 使用的小知识点</p>\n<span id=\"more\"></span>\n\n<ul>\n<li>在动态组件中的应用<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">keep-alive</span> <span class=\"attr\">:include</span>=<span class=\"string\">&quot;whiteList&quot;</span> <span class=\"attr\">:exclude</span>=<span class=\"string\">&quot;blackList&quot;</span> <span class=\"attr\">:max</span>=<span class=\"string\">&quot;amount&quot;</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">component</span> <span class=\"attr\">:is</span>=<span class=\"string\">&quot;currentComponent&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>include 定义白名单</li>\n<li>exclude定义黑名单</li>\n<li>max 定义缓存组件的上限，超出上限使用LRU的策略置换缓存数据</li>\n</ul>\n<p>LRU:<br>内存管理的一种置换算法，对于在内存中但又不用数据块（内存块）叫做LRU，造作系统会根据那些数据属于LRU而将其移出内存而腾出空间来加载另外的数据。</p>\n<p>只有当组件在keep-alive 内被切换，才会有actived和deactived 这两个钩子函数。</p>\n<h2 id=\"keep-alive-组件的渲染\"><a href=\"#keep-alive-组件的渲染\" class=\"headerlink\" title=\"keep-alive 组件的渲染\"></a>keep-alive 组件的渲染</h2>","site":{"data":{}},"excerpt":"<p>keep-alive 使用的小知识点</p>","more":"<ul>\n<li>在动态组件中的应用<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">keep-alive</span> <span class=\"attr\">:include</span>=<span class=\"string\">&quot;whiteList&quot;</span> <span class=\"attr\">:exclude</span>=<span class=\"string\">&quot;blackList&quot;</span> <span class=\"attr\">:max</span>=<span class=\"string\">&quot;amount&quot;</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">component</span> <span class=\"attr\">:is</span>=<span class=\"string\">&quot;currentComponent&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>include 定义白名单</li>\n<li>exclude定义黑名单</li>\n<li>max 定义缓存组件的上限，超出上限使用LRU的策略置换缓存数据</li>\n</ul>\n<p>LRU:<br>内存管理的一种置换算法，对于在内存中但又不用数据块（内存块）叫做LRU，造作系统会根据那些数据属于LRU而将其移出内存而腾出空间来加载另外的数据。</p>\n<p>只有当组件在keep-alive 内被切换，才会有actived和deactived 这两个钩子函数。</p>\n<h2 id=\"keep-alive-组件的渲染\"><a href=\"#keep-alive-组件的渲染\" class=\"headerlink\" title=\"keep-alive 组件的渲染\"></a>keep-alive 组件的渲染</h2>"},{"title":"Vue懒加载与分组打包","date":"2020-04-01T10:28:07.000Z","_content":"\nvue 打包优化小知识点\n\n<!--more-->\n\n在 vue-router 的 index.js 文件中\n将原来的组件引入方式改变如下：\n\n```javascript\nimport Test from '@/component/test1'\n```\n\n变为\n\n```javascript\nconst Test1 = r =>\n  require.ensure([], () => r(rquire('../components/test1')), 'chunkname1')\n```\n\n示例代码：\n\n```javascript\nconst HelloWorld = r =>\n  require.ensure([], () => r(require('../components/HelloWorld')), 'chunkname1')\nconst Test1 = r =>\n  require.ensure([], () => r(require('../components/test1')), 'chunkname1')\nconst Test2 = r =>\n  require.ensure([], () => r(require('../components/test2')), 'chunkname3')\n```\n","source":"_posts/vue懒加载与分组打包.md","raw":"---\ntitle: Vue懒加载与分组打包\ndate: 2020-04-01 18:28:07\ncategories: Vue\n---\n\nvue 打包优化小知识点\n\n<!--more-->\n\n在 vue-router 的 index.js 文件中\n将原来的组件引入方式改变如下：\n\n```javascript\nimport Test from '@/component/test1'\n```\n\n变为\n\n```javascript\nconst Test1 = r =>\n  require.ensure([], () => r(rquire('../components/test1')), 'chunkname1')\n```\n\n示例代码：\n\n```javascript\nconst HelloWorld = r =>\n  require.ensure([], () => r(require('../components/HelloWorld')), 'chunkname1')\nconst Test1 = r =>\n  require.ensure([], () => r(require('../components/test1')), 'chunkname1')\nconst Test2 = r =>\n  require.ensure([], () => r(require('../components/test2')), 'chunkname3')\n```\n","slug":"vue懒加载与分组打包","published":1,"updated":"2021-04-03T03:29:54.527Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x5001pl5v008tkg43s","content":"<p>vue 打包优化小知识点</p>\n<span id=\"more\"></span>\n\n<p>在 vue-router 的 index.js 文件中<br>将原来的组件引入方式改变如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Test <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/component/test1&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>变为</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Test1 = <span class=\"function\"><span class=\"params\">r</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> r(rquire(<span class=\"string\">&#x27;../components/test1&#x27;</span>)), <span class=\"string\">&#x27;chunkname1&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>示例代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> HelloWorld = <span class=\"function\"><span class=\"params\">r</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> r(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../components/HelloWorld&#x27;</span>)), <span class=\"string\">&#x27;chunkname1&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Test1 = <span class=\"function\"><span class=\"params\">r</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> r(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../components/test1&#x27;</span>)), <span class=\"string\">&#x27;chunkname1&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Test2 = <span class=\"function\"><span class=\"params\">r</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> r(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../components/test2&#x27;</span>)), <span class=\"string\">&#x27;chunkname3&#x27;</span>)</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>vue 打包优化小知识点</p>","more":"<p>在 vue-router 的 index.js 文件中<br>将原来的组件引入方式改变如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Test <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/component/test1&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>变为</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Test1 = <span class=\"function\"><span class=\"params\">r</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> r(rquire(<span class=\"string\">&#x27;../components/test1&#x27;</span>)), <span class=\"string\">&#x27;chunkname1&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>示例代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> HelloWorld = <span class=\"function\"><span class=\"params\">r</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> r(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../components/HelloWorld&#x27;</span>)), <span class=\"string\">&#x27;chunkname1&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Test1 = <span class=\"function\"><span class=\"params\">r</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> r(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../components/test1&#x27;</span>)), <span class=\"string\">&#x27;chunkname1&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> Test2 = <span class=\"function\"><span class=\"params\">r</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> r(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../components/test2&#x27;</span>)), <span class=\"string\">&#x27;chunkname3&#x27;</span>)</span><br></pre></td></tr></table></figure>"},{"title":"Web Workers","date":"2019-07-05T08:43:57.000Z","_content":"\nJavaScript 语言采用的是单线程模型，也就是说，所有任务只能在一个线程上完成，一次只能做一件事情。前面的任务没有做完，后面的任务只能等着。随着电脑计算能力增强，尤其是多核 CPU 的出现，单线程带来很大的不便，无法充分发挥计算机的计算能力。\n\n<!--more-->\n\n## Web Worker 的作用\n\n是为 JavaScript 创造多线程环境，允许主线程创建 Worker 线程，将一些任务分配给后者运行。在主线程运行的同时，Worker 线程在后台运行，两者互相不打扰。等到 Worker 线程完成计算任务，再把结果返给主线程。这样的好处是，一些计算密集型或高延迟的任务，被 Worker 线程担负了，主线程（通常负责 UI 交互）就会很流畅，不会因此阻塞/放慢。\n\n## 注意点\n\n1. 同源限制\n   分配给 Worker 线程运行的脚本文件，必须与主线程的脚本文件同源。\n2. DOM 限制\n   Worker 线程所在的全局对象，与主线程不一样，无法读取主线程所在网页的 DOM 对象，也无法使用 document、window、parent 这些对象。但是 Worker 线程可以 navigator 对象和 location 对象（PWA 的应用）。\n3. 通信联系\n   Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。\n4. 脚本限制\n   Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。\n5. 文件限制\n   Worker 线程无法读取本地文件，即不能打开本机的文件系统（file://），它所加载的脚本，必须来自网络。\n\n**Worker 线程一旦新建成功，就会始终运行**，不会被主线程上的活动（比如用户点击按钮、提交表单）单端，这样有利于随时的响应主线程的通信。但是这也造成了 Worker 比较耗费资源，不应该过度使用，而且一旦使用完毕，就应该关闭。\n\n## 基本用法\n\n```javascript\nvar worker = new Worker('work.js')\n\nworker.postMessage('Hello World')\n\nworker.postMessage({ method: 'echo', args: ['Work'] })\n```\n\n`worker.postMessage()`方法的参数，就是主线程传给 Worker 的数据。它可以是各种数据类型，包括二进制数据。\n\n接着，主线程通过 worker.onmessage 指定监听函数，接收子线程发回来的消息。\n\n```javascript\nworker.onmessage = function (event) {\n  console.log('Received message ' + event.data)\n  doSomething()\n}\n\nfunction doSomething() {\n  // 执行任务\n  worker.postMessage('Work done!')\n}\n```\n\n上面代码中，事件对象的 data 属性可以获取 Worker 发来的数据。\n\nWorker 完成任务以后，主线程就可以把它关掉。\n\n`worker.terminate();`\n\n## Web Worker 实战\n\nWeb Worker 可以提高应用的总体性能，并且提升用户体验\n\n### 如何使用 Worker 预加载图片\n\nndex.js 中启用 worker\n\n```javascript\nlet w = new Worker('js/workers.js')\nw.onmessage = function (event) {\n  /*var img = document.createElement(\"img\");\n img.src = window.URL.createObjectURL(event.data); document.querySelector('#result').appendChild(img) */\n  console.log(event.data)\n}\nw.onerror = function (e) {\n  e.currentTarget.terminate()\n  console.log('erro: ' + e.message)\n}\n```\n\nworker.js 中请求图片\n\n```javascript\nlet arr = [...好多图片路径];\nfor (let i = 0, len = arr.length; i < len; i++) {\n let req = new XMLHttpRequest();\nreq.open('GET', arr[i], true);\nreq.responseType = \"blob\";\n//req.setRequestHeader(\"client_type\", \"DESKTOP_WEB\");\n req.onreadystatechange = () => {\n if (req.readyState == 4) {\n // postMessage(req.response);\n}\n} req.send(null); }\n```\n","source":"_posts/webWorkers.md","raw":"---\ntitle: Web Workers\ndate: 2019-07-05 16:43:57\ncategories: Web\n---\n\nJavaScript 语言采用的是单线程模型，也就是说，所有任务只能在一个线程上完成，一次只能做一件事情。前面的任务没有做完，后面的任务只能等着。随着电脑计算能力增强，尤其是多核 CPU 的出现，单线程带来很大的不便，无法充分发挥计算机的计算能力。\n\n<!--more-->\n\n## Web Worker 的作用\n\n是为 JavaScript 创造多线程环境，允许主线程创建 Worker 线程，将一些任务分配给后者运行。在主线程运行的同时，Worker 线程在后台运行，两者互相不打扰。等到 Worker 线程完成计算任务，再把结果返给主线程。这样的好处是，一些计算密集型或高延迟的任务，被 Worker 线程担负了，主线程（通常负责 UI 交互）就会很流畅，不会因此阻塞/放慢。\n\n## 注意点\n\n1. 同源限制\n   分配给 Worker 线程运行的脚本文件，必须与主线程的脚本文件同源。\n2. DOM 限制\n   Worker 线程所在的全局对象，与主线程不一样，无法读取主线程所在网页的 DOM 对象，也无法使用 document、window、parent 这些对象。但是 Worker 线程可以 navigator 对象和 location 对象（PWA 的应用）。\n3. 通信联系\n   Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。\n4. 脚本限制\n   Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。\n5. 文件限制\n   Worker 线程无法读取本地文件，即不能打开本机的文件系统（file://），它所加载的脚本，必须来自网络。\n\n**Worker 线程一旦新建成功，就会始终运行**，不会被主线程上的活动（比如用户点击按钮、提交表单）单端，这样有利于随时的响应主线程的通信。但是这也造成了 Worker 比较耗费资源，不应该过度使用，而且一旦使用完毕，就应该关闭。\n\n## 基本用法\n\n```javascript\nvar worker = new Worker('work.js')\n\nworker.postMessage('Hello World')\n\nworker.postMessage({ method: 'echo', args: ['Work'] })\n```\n\n`worker.postMessage()`方法的参数，就是主线程传给 Worker 的数据。它可以是各种数据类型，包括二进制数据。\n\n接着，主线程通过 worker.onmessage 指定监听函数，接收子线程发回来的消息。\n\n```javascript\nworker.onmessage = function (event) {\n  console.log('Received message ' + event.data)\n  doSomething()\n}\n\nfunction doSomething() {\n  // 执行任务\n  worker.postMessage('Work done!')\n}\n```\n\n上面代码中，事件对象的 data 属性可以获取 Worker 发来的数据。\n\nWorker 完成任务以后，主线程就可以把它关掉。\n\n`worker.terminate();`\n\n## Web Worker 实战\n\nWeb Worker 可以提高应用的总体性能，并且提升用户体验\n\n### 如何使用 Worker 预加载图片\n\nndex.js 中启用 worker\n\n```javascript\nlet w = new Worker('js/workers.js')\nw.onmessage = function (event) {\n  /*var img = document.createElement(\"img\");\n img.src = window.URL.createObjectURL(event.data); document.querySelector('#result').appendChild(img) */\n  console.log(event.data)\n}\nw.onerror = function (e) {\n  e.currentTarget.terminate()\n  console.log('erro: ' + e.message)\n}\n```\n\nworker.js 中请求图片\n\n```javascript\nlet arr = [...好多图片路径];\nfor (let i = 0, len = arr.length; i < len; i++) {\n let req = new XMLHttpRequest();\nreq.open('GET', arr[i], true);\nreq.responseType = \"blob\";\n//req.setRequestHeader(\"client_type\", \"DESKTOP_WEB\");\n req.onreadystatechange = () => {\n if (req.readyState == 4) {\n // postMessage(req.response);\n}\n} req.send(null); }\n```\n","slug":"webWorkers","published":1,"updated":"2021-04-24T15:38:16.549Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x6001sl5v05u0q4553","content":"<p>JavaScript 语言采用的是单线程模型，也就是说，所有任务只能在一个线程上完成，一次只能做一件事情。前面的任务没有做完，后面的任务只能等着。随着电脑计算能力增强，尤其是多核 CPU 的出现，单线程带来很大的不便，无法充分发挥计算机的计算能力。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Web-Worker-的作用\"><a href=\"#Web-Worker-的作用\" class=\"headerlink\" title=\"Web Worker 的作用\"></a>Web Worker 的作用</h2><p>是为 JavaScript 创造多线程环境，允许主线程创建 Worker 线程，将一些任务分配给后者运行。在主线程运行的同时，Worker 线程在后台运行，两者互相不打扰。等到 Worker 线程完成计算任务，再把结果返给主线程。这样的好处是，一些计算密集型或高延迟的任务，被 Worker 线程担负了，主线程（通常负责 UI 交互）就会很流畅，不会因此阻塞/放慢。</p>\n<h2 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h2><ol>\n<li>同源限制<br>分配给 Worker 线程运行的脚本文件，必须与主线程的脚本文件同源。</li>\n<li>DOM 限制<br>Worker 线程所在的全局对象，与主线程不一样，无法读取主线程所在网页的 DOM 对象，也无法使用 document、window、parent 这些对象。但是 Worker 线程可以 navigator 对象和 location 对象（PWA 的应用）。</li>\n<li>通信联系<br>Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。</li>\n<li>脚本限制<br>Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。</li>\n<li>文件限制<br>Worker 线程无法读取本地文件，即不能打开本机的文件系统（file://），它所加载的脚本，必须来自网络。</li>\n</ol>\n<p><strong>Worker 线程一旦新建成功，就会始终运行</strong>，不会被主线程上的活动（比如用户点击按钮、提交表单）单端，这样有利于随时的响应主线程的通信。但是这也造成了 Worker 比较耗费资源，不应该过度使用，而且一旦使用完毕，就应该关闭。</p>\n<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> worker = <span class=\"keyword\">new</span> Worker(<span class=\"string\">&#x27;work.js&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">worker.postMessage(<span class=\"string\">&#x27;Hello World&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">worker.postMessage(&#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;echo&#x27;</span>, <span class=\"attr\">args</span>: [<span class=\"string\">&#x27;Work&#x27;</span>] &#125;)</span><br></pre></td></tr></table></figure>\n\n<p><code>worker.postMessage()</code>方法的参数，就是主线程传给 Worker 的数据。它可以是各种数据类型，包括二进制数据。</p>\n<p>接着，主线程通过 worker.onmessage 指定监听函数，接收子线程发回来的消息。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">worker.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Received message &#x27;</span> + event.data)</span><br><span class=\"line\">  doSomething()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 执行任务</span></span><br><span class=\"line\">  worker.postMessage(<span class=\"string\">&#x27;Work done!&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面代码中，事件对象的 data 属性可以获取 Worker 发来的数据。</p>\n<p>Worker 完成任务以后，主线程就可以把它关掉。</p>\n<p><code>worker.terminate();</code></p>\n<h2 id=\"Web-Worker-实战\"><a href=\"#Web-Worker-实战\" class=\"headerlink\" title=\"Web Worker 实战\"></a>Web Worker 实战</h2><p>Web Worker 可以提高应用的总体性能，并且提升用户体验</p>\n<h3 id=\"如何使用-Worker-预加载图片\"><a href=\"#如何使用-Worker-预加载图片\" class=\"headerlink\" title=\"如何使用 Worker 预加载图片\"></a>如何使用 Worker 预加载图片</h3><p>ndex.js 中启用 worker</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> w = <span class=\"keyword\">new</span> Worker(<span class=\"string\">&#x27;js/workers.js&#x27;</span>)</span><br><span class=\"line\">w.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/*var img = document.createElement(&quot;img&quot;);</span></span><br><span class=\"line\"><span class=\"comment\"> img.src = window.URL.createObjectURL(event.data); document.querySelector(&#x27;#result&#x27;).appendChild(img) */</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(event.data)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">w.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  e.currentTarget.terminate()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;erro: &#x27;</span> + e.message)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>worker.js 中请求图片</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arr = [...好多图片路径];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class=\"line\"> <span class=\"keyword\">let</span> req = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">req.open(<span class=\"string\">&#x27;GET&#x27;</span>, arr[i], <span class=\"literal\">true</span>);</span><br><span class=\"line\">req.responseType = <span class=\"string\">&quot;blob&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//req.setRequestHeader(&quot;client_type&quot;, &quot;DESKTOP_WEB&quot;);</span></span><br><span class=\"line\"> req.onreadystatechange = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (req.readyState == <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\"> <span class=\"comment\">// postMessage(req.response);</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125; req.send(<span class=\"literal\">null</span>); &#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>JavaScript 语言采用的是单线程模型，也就是说，所有任务只能在一个线程上完成，一次只能做一件事情。前面的任务没有做完，后面的任务只能等着。随着电脑计算能力增强，尤其是多核 CPU 的出现，单线程带来很大的不便，无法充分发挥计算机的计算能力。</p>","more":"<h2 id=\"Web-Worker-的作用\"><a href=\"#Web-Worker-的作用\" class=\"headerlink\" title=\"Web Worker 的作用\"></a>Web Worker 的作用</h2><p>是为 JavaScript 创造多线程环境，允许主线程创建 Worker 线程，将一些任务分配给后者运行。在主线程运行的同时，Worker 线程在后台运行，两者互相不打扰。等到 Worker 线程完成计算任务，再把结果返给主线程。这样的好处是，一些计算密集型或高延迟的任务，被 Worker 线程担负了，主线程（通常负责 UI 交互）就会很流畅，不会因此阻塞/放慢。</p>\n<h2 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h2><ol>\n<li>同源限制<br>分配给 Worker 线程运行的脚本文件，必须与主线程的脚本文件同源。</li>\n<li>DOM 限制<br>Worker 线程所在的全局对象，与主线程不一样，无法读取主线程所在网页的 DOM 对象，也无法使用 document、window、parent 这些对象。但是 Worker 线程可以 navigator 对象和 location 对象（PWA 的应用）。</li>\n<li>通信联系<br>Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。</li>\n<li>脚本限制<br>Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。</li>\n<li>文件限制<br>Worker 线程无法读取本地文件，即不能打开本机的文件系统（file://），它所加载的脚本，必须来自网络。</li>\n</ol>\n<p><strong>Worker 线程一旦新建成功，就会始终运行</strong>，不会被主线程上的活动（比如用户点击按钮、提交表单）单端，这样有利于随时的响应主线程的通信。但是这也造成了 Worker 比较耗费资源，不应该过度使用，而且一旦使用完毕，就应该关闭。</p>\n<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> worker = <span class=\"keyword\">new</span> Worker(<span class=\"string\">&#x27;work.js&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">worker.postMessage(<span class=\"string\">&#x27;Hello World&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">worker.postMessage(&#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;echo&#x27;</span>, <span class=\"attr\">args</span>: [<span class=\"string\">&#x27;Work&#x27;</span>] &#125;)</span><br></pre></td></tr></table></figure>\n\n<p><code>worker.postMessage()</code>方法的参数，就是主线程传给 Worker 的数据。它可以是各种数据类型，包括二进制数据。</p>\n<p>接着，主线程通过 worker.onmessage 指定监听函数，接收子线程发回来的消息。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">worker.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Received message &#x27;</span> + event.data)</span><br><span class=\"line\">  doSomething()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 执行任务</span></span><br><span class=\"line\">  worker.postMessage(<span class=\"string\">&#x27;Work done!&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面代码中，事件对象的 data 属性可以获取 Worker 发来的数据。</p>\n<p>Worker 完成任务以后，主线程就可以把它关掉。</p>\n<p><code>worker.terminate();</code></p>\n<h2 id=\"Web-Worker-实战\"><a href=\"#Web-Worker-实战\" class=\"headerlink\" title=\"Web Worker 实战\"></a>Web Worker 实战</h2><p>Web Worker 可以提高应用的总体性能，并且提升用户体验</p>\n<h3 id=\"如何使用-Worker-预加载图片\"><a href=\"#如何使用-Worker-预加载图片\" class=\"headerlink\" title=\"如何使用 Worker 预加载图片\"></a>如何使用 Worker 预加载图片</h3><p>ndex.js 中启用 worker</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> w = <span class=\"keyword\">new</span> Worker(<span class=\"string\">&#x27;js/workers.js&#x27;</span>)</span><br><span class=\"line\">w.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/*var img = document.createElement(&quot;img&quot;);</span></span><br><span class=\"line\"><span class=\"comment\"> img.src = window.URL.createObjectURL(event.data); document.querySelector(&#x27;#result&#x27;).appendChild(img) */</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(event.data)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">w.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  e.currentTarget.terminate()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;erro: &#x27;</span> + e.message)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>worker.js 中请求图片</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arr = [...好多图片路径];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class=\"line\"> <span class=\"keyword\">let</span> req = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">req.open(<span class=\"string\">&#x27;GET&#x27;</span>, arr[i], <span class=\"literal\">true</span>);</span><br><span class=\"line\">req.responseType = <span class=\"string\">&quot;blob&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//req.setRequestHeader(&quot;client_type&quot;, &quot;DESKTOP_WEB&quot;);</span></span><br><span class=\"line\"> req.onreadystatechange = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (req.readyState == <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\"> <span class=\"comment\">// postMessage(req.response);</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125; req.send(<span class=\"literal\">null</span>); &#125;</span><br></pre></td></tr></table></figure>"},{"title":"webpack优化之preload和prefetch","date":"2019-08-16T09:26:11.000Z","_content":"\n链接预取是一种浏览器机制，其利用浏览器空闲时间来下载或预取用户在不久的将来可能访问的文档。网页向浏览器提供一组预取提示，并在浏览器完成当前页面的加载后开始静默地拉取指定的文档并将其存储在缓存中。当用户访问其中一个预取文档时，便可以快速的从浏览器缓存中得到。\n\n<!--more-->\n\n# prefetch\n\nprefetch 的设计初衷是为了让当前页面的关键资源尽早被发现和加载，从而提升首屏渲染性能。\n\n当我们使用 webpack 构建页面时，就会在页面中发现有很多使用`link`引入的 JS 资源。\n\n![network](https://img.hacpai.com/file/2019/08/15659449621-5fea8870.jpg)\n\n这段代码告诉浏览器，这段资源将会在未来某个导航或者功能要用到，但是本资源的下载顺序权重比较低。也就是说 prefetch 通常用于加速下一次导航，而不是本次的。\n\n被标记为 prefetch 的资源，将会被浏览器在空闲时间加载。prefetch 指示的是**下一次**导航可能需要的资源。浏览器识别到 Prefetch 时，应该加载该资源（且不执行），等到真正请求相同资源时，就能够得到更快的响应。\n\n![network]](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Link_prefetching_FAQ)\n\n# preload\n\n```\n<link rel=\"preload\" href=\"late_discovered_thing.js\" as=\"script\">\n```\n\nas 属性的作用是告诉浏览器被加载的是什么资源，可能的 as 值包括：\n\n-   \"script\"\n-   \"style\"\n-   \"image\"\n-   \"media\"\n-   \"document\"\n\n忽略 as 属性，或者错误的 as 属性会使 preload 等同于 XHR 请求，浏览器不知道加载的是什么，因此会赋予此类资源非常低的加载优先级。\n\npreload 通常用于本页面要用到的关键资源，包括关键 js、字体、css 文件。preload 将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度。\n\n# 什么时候使用 preload 和 prefetch\n\n```\n对于当前页面很有必要的资源使用 `preload`，对于可能在将来的页面中使用的资源使用 `prefetch`。\n```\n\n-   `preload`  是对浏览器指示预先请求当前页需要的资源（关键的脚本，字体，主要图片）。\n\n-   `prefetch`  应用场景稍微又些不同 —— 用户将来可能在其他部分（比如视图或页面）使用到的资源。如果  `A`  页面发起一个  `B`  页面的  `prefetch`  请求，这个资源获取过程和导航请求可能是同步进行的，而如果我们用  `preload`  的话，页面  `A`  离开时它会立即停止。\n\n使用  `preload`和  `prefetch`，我们有了对当前页面和将来页面加载关键资源的解决办法。\n\n# preload 和  prefetch  的缓存行为\n\nchrome 有四种缓存：HTTP 缓存，内存缓存，Service Worker 缓存和 Push 缓存，preload 和 prefetch 都被缓存在 HTTP 缓存中。\n\n当一个资源被  `preload`  或者  `prefetch`  获取后，它可以从 HTTP 缓存移动至渲染器的内存缓存中。如果资源可以被缓存（比如说存在有效的[`cache-control`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control)  和  `max-age`），它被存储在 HTTP 缓存中可以被现在或将来的任务使用，如果资源不能被缓存在 HTTP 缓存中，作为代替，它被放在内存缓存中直到被使用。\n\n# webpack 搭配 prefetch 优化单页面应用 code-splitting\n\n单页面应用由于页面过多，可能会导致代码体积过大，从而使得首页打开速度过慢。所以切分代码，优化首屏打开速度尤为重要。\n\n但是所有的技术手段都不是完美的。当我们切割代码后，首屏的 js 文件体积减少了好多。但是也有一个突出的问题：\n那就是当跳转其他页面的时候，需要下载相应页面的 js 文件，这就导致体验极其不好，每一次点击访问新页面都要等待 js 文件下载，然后再去请求接口获取数据。频繁出现 loading 动画的体验真的不好.\n\n所以如果我们在进入首页后，在浏览器的空闲时间提前下好用户可能会点击页面的 js 文件，这样首屏的 js 文件大小得到了控制，而且再点击新页面的时候，相关的 js 文件已经下载好了，就不再会出现 loading 动画。\n\n动态引入 js 文件，实现 code-splitting，减少首屏打开时间\n\n```javascript\n**// 代码分割后的react组件\nconst Brand = asyncComponent(() => import(\n/*webpackChunkName: 'mp-supports'*/\n'./views/Brand' )) // 路由引入\n<Route path=\"/\" component={App}>\n<Route path=\"/brand\" component={Brand} /> </Route>\n```\n\n首页组件的生命周期：\n\n```javascript\n// 在接口取的数据后，进行prefetch\ncomponentDidUpdate({ topics }) {\n  if( topics.length === 0 && this.props.topics.length > 0 ) {\n   // 实行prefetch，注意只有webpack 4版本才支持prefetch功能。\n    import(\n        /* webpackPrefetch: true */\n        /*webpackChunkName: 'topic'*/\n        \"../topic\"\n      )\n  }\n}\n```\n\n关键点：\n1、 `_webpackChunkName: 'chunk-name'_`\n2、 componentDidUpdate\n\n## 这里有两个关键点：\n\n1. webpack 的动态 import()需要指定包命，如果不在注释中说明包名，那么用了几次 import() , webpack 就会给同一个文件打包多少次。使得我们 prefetch 的文件和路由中要用到的文件并不是同一个文件。\n2. prefetch 会在浏览器空闲时，下载相应文件。这是一个很笼统的定义，在我的使用中，我发现在接口没有返回数据，以及图片等还没有请求成功时，prefetch 就会请求数据了。这一点是很不好的，最起码 prefetch 不能影响首页接口的获取速度。所以我把 prefetch 的执行事件放在了 componentDidUpdate 生命周期内。保障了 prefetch 的执行，不会影响到关键的首页数据获取。\n\n当然 prefetch 在服务端渲染的页面并不会有影响接口的问题，是一个比较好的技术选择\n\n# 参考文献\n\n1. [Prefetch 和预加载实践](https://www.itcodemonkey.com/article/9707.html)\n1. [关于 Preload, 你应该知道些什么](https://www.jianshu.com/p/24ffa6d45087)\n1. [Preload，Prefetch 和它们在 Chrome 之中的优先级)](https://www.w3cplus.com/performance/reloading/preload-prefetch-and-priorities-in-chrome.html)\n","source":"_posts/webpack优化之preload和prefetch.md","raw":"---\ntitle: webpack优化之preload和prefetch\ndate: 2019-08-16 17:26:11\ncategories: webpack\n---\n\n链接预取是一种浏览器机制，其利用浏览器空闲时间来下载或预取用户在不久的将来可能访问的文档。网页向浏览器提供一组预取提示，并在浏览器完成当前页面的加载后开始静默地拉取指定的文档并将其存储在缓存中。当用户访问其中一个预取文档时，便可以快速的从浏览器缓存中得到。\n\n<!--more-->\n\n# prefetch\n\nprefetch 的设计初衷是为了让当前页面的关键资源尽早被发现和加载，从而提升首屏渲染性能。\n\n当我们使用 webpack 构建页面时，就会在页面中发现有很多使用`link`引入的 JS 资源。\n\n![network](https://img.hacpai.com/file/2019/08/15659449621-5fea8870.jpg)\n\n这段代码告诉浏览器，这段资源将会在未来某个导航或者功能要用到，但是本资源的下载顺序权重比较低。也就是说 prefetch 通常用于加速下一次导航，而不是本次的。\n\n被标记为 prefetch 的资源，将会被浏览器在空闲时间加载。prefetch 指示的是**下一次**导航可能需要的资源。浏览器识别到 Prefetch 时，应该加载该资源（且不执行），等到真正请求相同资源时，就能够得到更快的响应。\n\n![network]](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Link_prefetching_FAQ)\n\n# preload\n\n```\n<link rel=\"preload\" href=\"late_discovered_thing.js\" as=\"script\">\n```\n\nas 属性的作用是告诉浏览器被加载的是什么资源，可能的 as 值包括：\n\n-   \"script\"\n-   \"style\"\n-   \"image\"\n-   \"media\"\n-   \"document\"\n\n忽略 as 属性，或者错误的 as 属性会使 preload 等同于 XHR 请求，浏览器不知道加载的是什么，因此会赋予此类资源非常低的加载优先级。\n\npreload 通常用于本页面要用到的关键资源，包括关键 js、字体、css 文件。preload 将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度。\n\n# 什么时候使用 preload 和 prefetch\n\n```\n对于当前页面很有必要的资源使用 `preload`，对于可能在将来的页面中使用的资源使用 `prefetch`。\n```\n\n-   `preload`  是对浏览器指示预先请求当前页需要的资源（关键的脚本，字体，主要图片）。\n\n-   `prefetch`  应用场景稍微又些不同 —— 用户将来可能在其他部分（比如视图或页面）使用到的资源。如果  `A`  页面发起一个  `B`  页面的  `prefetch`  请求，这个资源获取过程和导航请求可能是同步进行的，而如果我们用  `preload`  的话，页面  `A`  离开时它会立即停止。\n\n使用  `preload`和  `prefetch`，我们有了对当前页面和将来页面加载关键资源的解决办法。\n\n# preload 和  prefetch  的缓存行为\n\nchrome 有四种缓存：HTTP 缓存，内存缓存，Service Worker 缓存和 Push 缓存，preload 和 prefetch 都被缓存在 HTTP 缓存中。\n\n当一个资源被  `preload`  或者  `prefetch`  获取后，它可以从 HTTP 缓存移动至渲染器的内存缓存中。如果资源可以被缓存（比如说存在有效的[`cache-control`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control)  和  `max-age`），它被存储在 HTTP 缓存中可以被现在或将来的任务使用，如果资源不能被缓存在 HTTP 缓存中，作为代替，它被放在内存缓存中直到被使用。\n\n# webpack 搭配 prefetch 优化单页面应用 code-splitting\n\n单页面应用由于页面过多，可能会导致代码体积过大，从而使得首页打开速度过慢。所以切分代码，优化首屏打开速度尤为重要。\n\n但是所有的技术手段都不是完美的。当我们切割代码后，首屏的 js 文件体积减少了好多。但是也有一个突出的问题：\n那就是当跳转其他页面的时候，需要下载相应页面的 js 文件，这就导致体验极其不好，每一次点击访问新页面都要等待 js 文件下载，然后再去请求接口获取数据。频繁出现 loading 动画的体验真的不好.\n\n所以如果我们在进入首页后，在浏览器的空闲时间提前下好用户可能会点击页面的 js 文件，这样首屏的 js 文件大小得到了控制，而且再点击新页面的时候，相关的 js 文件已经下载好了，就不再会出现 loading 动画。\n\n动态引入 js 文件，实现 code-splitting，减少首屏打开时间\n\n```javascript\n**// 代码分割后的react组件\nconst Brand = asyncComponent(() => import(\n/*webpackChunkName: 'mp-supports'*/\n'./views/Brand' )) // 路由引入\n<Route path=\"/\" component={App}>\n<Route path=\"/brand\" component={Brand} /> </Route>\n```\n\n首页组件的生命周期：\n\n```javascript\n// 在接口取的数据后，进行prefetch\ncomponentDidUpdate({ topics }) {\n  if( topics.length === 0 && this.props.topics.length > 0 ) {\n   // 实行prefetch，注意只有webpack 4版本才支持prefetch功能。\n    import(\n        /* webpackPrefetch: true */\n        /*webpackChunkName: 'topic'*/\n        \"../topic\"\n      )\n  }\n}\n```\n\n关键点：\n1、 `_webpackChunkName: 'chunk-name'_`\n2、 componentDidUpdate\n\n## 这里有两个关键点：\n\n1. webpack 的动态 import()需要指定包命，如果不在注释中说明包名，那么用了几次 import() , webpack 就会给同一个文件打包多少次。使得我们 prefetch 的文件和路由中要用到的文件并不是同一个文件。\n2. prefetch 会在浏览器空闲时，下载相应文件。这是一个很笼统的定义，在我的使用中，我发现在接口没有返回数据，以及图片等还没有请求成功时，prefetch 就会请求数据了。这一点是很不好的，最起码 prefetch 不能影响首页接口的获取速度。所以我把 prefetch 的执行事件放在了 componentDidUpdate 生命周期内。保障了 prefetch 的执行，不会影响到关键的首页数据获取。\n\n当然 prefetch 在服务端渲染的页面并不会有影响接口的问题，是一个比较好的技术选择\n\n# 参考文献\n\n1. [Prefetch 和预加载实践](https://www.itcodemonkey.com/article/9707.html)\n1. [关于 Preload, 你应该知道些什么](https://www.jianshu.com/p/24ffa6d45087)\n1. [Preload，Prefetch 和它们在 Chrome 之中的优先级)](https://www.w3cplus.com/performance/reloading/preload-prefetch-and-priorities-in-chrome.html)\n","slug":"webpack优化之preload和prefetch","published":1,"updated":"2021-04-03T03:29:17.968Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x7001ul5v0bi455ulm","content":"<p>链接预取是一种浏览器机制，其利用浏览器空闲时间来下载或预取用户在不久的将来可能访问的文档。网页向浏览器提供一组预取提示，并在浏览器完成当前页面的加载后开始静默地拉取指定的文档并将其存储在缓存中。当用户访问其中一个预取文档时，便可以快速的从浏览器缓存中得到。</p>\n<span id=\"more\"></span>\n\n<h1 id=\"prefetch\"><a href=\"#prefetch\" class=\"headerlink\" title=\"prefetch\"></a>prefetch</h1><p>prefetch 的设计初衷是为了让当前页面的关键资源尽早被发现和加载，从而提升首屏渲染性能。</p>\n<p>当我们使用 webpack 构建页面时，就会在页面中发现有很多使用<code>link</code>引入的 JS 资源。</p>\n<p><img src=\"https://img.hacpai.com/file/2019/08/15659449621-5fea8870.jpg\" alt=\"network\"></p>\n<p>这段代码告诉浏览器，这段资源将会在未来某个导航或者功能要用到，但是本资源的下载顺序权重比较低。也就是说 prefetch 通常用于加速下一次导航，而不是本次的。</p>\n<p>被标记为 prefetch 的资源，将会被浏览器在空闲时间加载。prefetch 指示的是<strong>下一次</strong>导航可能需要的资源。浏览器识别到 Prefetch 时，应该加载该资源（且不执行），等到真正请求相同资源时，就能够得到更快的响应。</p>\n<p>![network]](<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Link_prefetching_FAQ\">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Link_prefetching_FAQ</a>)</p>\n<h1 id=\"preload\"><a href=\"#preload\" class=\"headerlink\" title=\"preload\"></a>preload</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;link rel&#x3D;&quot;preload&quot; href&#x3D;&quot;late_discovered_thing.js&quot; as&#x3D;&quot;script&quot;&gt;</span><br></pre></td></tr></table></figure>\n\n<p>as 属性的作用是告诉浏览器被加载的是什么资源，可能的 as 值包括：</p>\n<ul>\n<li>  “script”</li>\n<li>  “style”</li>\n<li>  “image”</li>\n<li>  “media”</li>\n<li>  “document”</li>\n</ul>\n<p>忽略 as 属性，或者错误的 as 属性会使 preload 等同于 XHR 请求，浏览器不知道加载的是什么，因此会赋予此类资源非常低的加载优先级。</p>\n<p>preload 通常用于本页面要用到的关键资源，包括关键 js、字体、css 文件。preload 将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度。</p>\n<h1 id=\"什么时候使用-preload-和-prefetch\"><a href=\"#什么时候使用-preload-和-prefetch\" class=\"headerlink\" title=\"什么时候使用 preload 和 prefetch\"></a>什么时候使用 preload 和 prefetch</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">对于当前页面很有必要的资源使用 &#96;preload&#96;，对于可能在将来的页面中使用的资源使用 &#96;prefetch&#96;。</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>  <code>preload</code>  是对浏览器指示预先请求当前页需要的资源（关键的脚本，字体，主要图片）。</p>\n</li>\n<li><p>  <code>prefetch</code>  应用场景稍微又些不同 —— 用户将来可能在其他部分（比如视图或页面）使用到的资源。如果  <code>A</code>  页面发起一个  <code>B</code>  页面的  <code>prefetch</code>  请求，这个资源获取过程和导航请求可能是同步进行的，而如果我们用  <code>preload</code>  的话，页面  <code>A</code>  离开时它会立即停止。</p>\n</li>\n</ul>\n<p>使用  <code>preload</code>和  <code>prefetch</code>，我们有了对当前页面和将来页面加载关键资源的解决办法。</p>\n<h1 id=\"preload-和-prefetch-的缓存行为\"><a href=\"#preload-和-prefetch-的缓存行为\" class=\"headerlink\" title=\"preload 和  prefetch  的缓存行为\"></a>preload 和  prefetch  的缓存行为</h1><p>chrome 有四种缓存：HTTP 缓存，内存缓存，Service Worker 缓存和 Push 缓存，preload 和 prefetch 都被缓存在 HTTP 缓存中。</p>\n<p>当一个资源被  <code>preload</code>  或者  <code>prefetch</code>  获取后，它可以从 HTTP 缓存移动至渲染器的内存缓存中。如果资源可以被缓存（比如说存在有效的<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control\"><code>cache-control</code></a>  和  <code>max-age</code>），它被存储在 HTTP 缓存中可以被现在或将来的任务使用，如果资源不能被缓存在 HTTP 缓存中，作为代替，它被放在内存缓存中直到被使用。</p>\n<h1 id=\"webpack-搭配-prefetch-优化单页面应用-code-splitting\"><a href=\"#webpack-搭配-prefetch-优化单页面应用-code-splitting\" class=\"headerlink\" title=\"webpack 搭配 prefetch 优化单页面应用 code-splitting\"></a>webpack 搭配 prefetch 优化单页面应用 code-splitting</h1><p>单页面应用由于页面过多，可能会导致代码体积过大，从而使得首页打开速度过慢。所以切分代码，优化首屏打开速度尤为重要。</p>\n<p>但是所有的技术手段都不是完美的。当我们切割代码后，首屏的 js 文件体积减少了好多。但是也有一个突出的问题：<br>那就是当跳转其他页面的时候，需要下载相应页面的 js 文件，这就导致体验极其不好，每一次点击访问新页面都要等待 js 文件下载，然后再去请求接口获取数据。频繁出现 loading 动画的体验真的不好.</p>\n<p>所以如果我们在进入首页后，在浏览器的空闲时间提前下好用户可能会点击页面的 js 文件，这样首屏的 js 文件大小得到了控制，而且再点击新页面的时候，相关的 js 文件已经下载好了，就不再会出现 loading 动画。</p>\n<p>动态引入 js 文件，实现 code-splitting，减少首屏打开时间</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**<span class=\"comment\">// 代码分割后的react组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Brand = asyncComponent(<span class=\"function\">() =&gt;</span> <span class=\"keyword\">import</span>(</span><br><span class=\"line\"><span class=\"comment\">/*webpackChunkName: &#x27;mp-supports&#x27;*/</span></span><br><span class=\"line\"><span class=\"string\">&#x27;./views/Brand&#x27;</span> )) <span class=\"comment\">// 路由引入</span></span><br><span class=\"line\">&lt;Route path=<span class=\"string\">&quot;/&quot;</span> component=&#123;App&#125;&gt;</span><br><span class=\"line\">&lt;Route path=<span class=\"string\">&quot;/brand&quot;</span> component=&#123;Brand&#125; /&gt; &lt;/Route&gt;</span><br></pre></td></tr></table></figure>\n\n<p>首页组件的生命周期：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在接口取的数据后，进行prefetch</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">componentDidUpdate</span>(<span class=\"params\">&#123; topics &#125;</span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( topics.length === <span class=\"number\">0</span> &amp;&amp; <span class=\"built_in\">this</span>.props.topics.length &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">   <span class=\"comment\">// 实行prefetch，注意只有webpack 4版本才支持prefetch功能。</span></span><br><span class=\"line\">    <span class=\"keyword\">import</span>(</span><br><span class=\"line\">        <span class=\"comment\">/* webpackPrefetch: true */</span></span><br><span class=\"line\">        <span class=\"comment\">/*webpackChunkName: &#x27;topic&#x27;*/</span></span><br><span class=\"line\">        <span class=\"string\">&quot;../topic&quot;</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>关键点：<br>1、 <code>_webpackChunkName: &#39;chunk-name&#39;_</code><br>2、 componentDidUpdate</p>\n<h2 id=\"这里有两个关键点：\"><a href=\"#这里有两个关键点：\" class=\"headerlink\" title=\"这里有两个关键点：\"></a>这里有两个关键点：</h2><ol>\n<li>webpack 的动态 import()需要指定包命，如果不在注释中说明包名，那么用了几次 import() , webpack 就会给同一个文件打包多少次。使得我们 prefetch 的文件和路由中要用到的文件并不是同一个文件。</li>\n<li>prefetch 会在浏览器空闲时，下载相应文件。这是一个很笼统的定义，在我的使用中，我发现在接口没有返回数据，以及图片等还没有请求成功时，prefetch 就会请求数据了。这一点是很不好的，最起码 prefetch 不能影响首页接口的获取速度。所以我把 prefetch 的执行事件放在了 componentDidUpdate 生命周期内。保障了 prefetch 的执行，不会影响到关键的首页数据获取。</li>\n</ol>\n<p>当然 prefetch 在服务端渲染的页面并不会有影响接口的问题，是一个比较好的技术选择</p>\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><ol>\n<li><a href=\"https://www.itcodemonkey.com/article/9707.html\">Prefetch 和预加载实践</a></li>\n<li><a href=\"https://www.jianshu.com/p/24ffa6d45087\">关于 Preload, 你应该知道些什么</a></li>\n<li><a href=\"https://www.w3cplus.com/performance/reloading/preload-prefetch-and-priorities-in-chrome.html\">Preload，Prefetch 和它们在 Chrome 之中的优先级)</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>链接预取是一种浏览器机制，其利用浏览器空闲时间来下载或预取用户在不久的将来可能访问的文档。网页向浏览器提供一组预取提示，并在浏览器完成当前页面的加载后开始静默地拉取指定的文档并将其存储在缓存中。当用户访问其中一个预取文档时，便可以快速的从浏览器缓存中得到。</p>","more":"<h1 id=\"prefetch\"><a href=\"#prefetch\" class=\"headerlink\" title=\"prefetch\"></a>prefetch</h1><p>prefetch 的设计初衷是为了让当前页面的关键资源尽早被发现和加载，从而提升首屏渲染性能。</p>\n<p>当我们使用 webpack 构建页面时，就会在页面中发现有很多使用<code>link</code>引入的 JS 资源。</p>\n<p><img src=\"https://img.hacpai.com/file/2019/08/15659449621-5fea8870.jpg\" alt=\"network\"></p>\n<p>这段代码告诉浏览器，这段资源将会在未来某个导航或者功能要用到，但是本资源的下载顺序权重比较低。也就是说 prefetch 通常用于加速下一次导航，而不是本次的。</p>\n<p>被标记为 prefetch 的资源，将会被浏览器在空闲时间加载。prefetch 指示的是<strong>下一次</strong>导航可能需要的资源。浏览器识别到 Prefetch 时，应该加载该资源（且不执行），等到真正请求相同资源时，就能够得到更快的响应。</p>\n<p>![network]](<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Link_prefetching_FAQ\">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Link_prefetching_FAQ</a>)</p>\n<h1 id=\"preload\"><a href=\"#preload\" class=\"headerlink\" title=\"preload\"></a>preload</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;link rel&#x3D;&quot;preload&quot; href&#x3D;&quot;late_discovered_thing.js&quot; as&#x3D;&quot;script&quot;&gt;</span><br></pre></td></tr></table></figure>\n\n<p>as 属性的作用是告诉浏览器被加载的是什么资源，可能的 as 值包括：</p>\n<ul>\n<li>  “script”</li>\n<li>  “style”</li>\n<li>  “image”</li>\n<li>  “media”</li>\n<li>  “document”</li>\n</ul>\n<p>忽略 as 属性，或者错误的 as 属性会使 preload 等同于 XHR 请求，浏览器不知道加载的是什么，因此会赋予此类资源非常低的加载优先级。</p>\n<p>preload 通常用于本页面要用到的关键资源，包括关键 js、字体、css 文件。preload 将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度。</p>\n<h1 id=\"什么时候使用-preload-和-prefetch\"><a href=\"#什么时候使用-preload-和-prefetch\" class=\"headerlink\" title=\"什么时候使用 preload 和 prefetch\"></a>什么时候使用 preload 和 prefetch</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">对于当前页面很有必要的资源使用 &#96;preload&#96;，对于可能在将来的页面中使用的资源使用 &#96;prefetch&#96;。</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>  <code>preload</code>  是对浏览器指示预先请求当前页需要的资源（关键的脚本，字体，主要图片）。</p>\n</li>\n<li><p>  <code>prefetch</code>  应用场景稍微又些不同 —— 用户将来可能在其他部分（比如视图或页面）使用到的资源。如果  <code>A</code>  页面发起一个  <code>B</code>  页面的  <code>prefetch</code>  请求，这个资源获取过程和导航请求可能是同步进行的，而如果我们用  <code>preload</code>  的话，页面  <code>A</code>  离开时它会立即停止。</p>\n</li>\n</ul>\n<p>使用  <code>preload</code>和  <code>prefetch</code>，我们有了对当前页面和将来页面加载关键资源的解决办法。</p>\n<h1 id=\"preload-和-prefetch-的缓存行为\"><a href=\"#preload-和-prefetch-的缓存行为\" class=\"headerlink\" title=\"preload 和  prefetch  的缓存行为\"></a>preload 和  prefetch  的缓存行为</h1><p>chrome 有四种缓存：HTTP 缓存，内存缓存，Service Worker 缓存和 Push 缓存，preload 和 prefetch 都被缓存在 HTTP 缓存中。</p>\n<p>当一个资源被  <code>preload</code>  或者  <code>prefetch</code>  获取后，它可以从 HTTP 缓存移动至渲染器的内存缓存中。如果资源可以被缓存（比如说存在有效的<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control\"><code>cache-control</code></a>  和  <code>max-age</code>），它被存储在 HTTP 缓存中可以被现在或将来的任务使用，如果资源不能被缓存在 HTTP 缓存中，作为代替，它被放在内存缓存中直到被使用。</p>\n<h1 id=\"webpack-搭配-prefetch-优化单页面应用-code-splitting\"><a href=\"#webpack-搭配-prefetch-优化单页面应用-code-splitting\" class=\"headerlink\" title=\"webpack 搭配 prefetch 优化单页面应用 code-splitting\"></a>webpack 搭配 prefetch 优化单页面应用 code-splitting</h1><p>单页面应用由于页面过多，可能会导致代码体积过大，从而使得首页打开速度过慢。所以切分代码，优化首屏打开速度尤为重要。</p>\n<p>但是所有的技术手段都不是完美的。当我们切割代码后，首屏的 js 文件体积减少了好多。但是也有一个突出的问题：<br>那就是当跳转其他页面的时候，需要下载相应页面的 js 文件，这就导致体验极其不好，每一次点击访问新页面都要等待 js 文件下载，然后再去请求接口获取数据。频繁出现 loading 动画的体验真的不好.</p>\n<p>所以如果我们在进入首页后，在浏览器的空闲时间提前下好用户可能会点击页面的 js 文件，这样首屏的 js 文件大小得到了控制，而且再点击新页面的时候，相关的 js 文件已经下载好了，就不再会出现 loading 动画。</p>\n<p>动态引入 js 文件，实现 code-splitting，减少首屏打开时间</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**<span class=\"comment\">// 代码分割后的react组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Brand = asyncComponent(<span class=\"function\">() =&gt;</span> <span class=\"keyword\">import</span>(</span><br><span class=\"line\"><span class=\"comment\">/*webpackChunkName: &#x27;mp-supports&#x27;*/</span></span><br><span class=\"line\"><span class=\"string\">&#x27;./views/Brand&#x27;</span> )) <span class=\"comment\">// 路由引入</span></span><br><span class=\"line\">&lt;Route path=<span class=\"string\">&quot;/&quot;</span> component=&#123;App&#125;&gt;</span><br><span class=\"line\">&lt;Route path=<span class=\"string\">&quot;/brand&quot;</span> component=&#123;Brand&#125; /&gt; &lt;/Route&gt;</span><br></pre></td></tr></table></figure>\n\n<p>首页组件的生命周期：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在接口取的数据后，进行prefetch</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">componentDidUpdate</span>(<span class=\"params\">&#123; topics &#125;</span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( topics.length === <span class=\"number\">0</span> &amp;&amp; <span class=\"built_in\">this</span>.props.topics.length &gt; <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">   <span class=\"comment\">// 实行prefetch，注意只有webpack 4版本才支持prefetch功能。</span></span><br><span class=\"line\">    <span class=\"keyword\">import</span>(</span><br><span class=\"line\">        <span class=\"comment\">/* webpackPrefetch: true */</span></span><br><span class=\"line\">        <span class=\"comment\">/*webpackChunkName: &#x27;topic&#x27;*/</span></span><br><span class=\"line\">        <span class=\"string\">&quot;../topic&quot;</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>关键点：<br>1、 <code>_webpackChunkName: &#39;chunk-name&#39;_</code><br>2、 componentDidUpdate</p>\n<h2 id=\"这里有两个关键点：\"><a href=\"#这里有两个关键点：\" class=\"headerlink\" title=\"这里有两个关键点：\"></a>这里有两个关键点：</h2><ol>\n<li>webpack 的动态 import()需要指定包命，如果不在注释中说明包名，那么用了几次 import() , webpack 就会给同一个文件打包多少次。使得我们 prefetch 的文件和路由中要用到的文件并不是同一个文件。</li>\n<li>prefetch 会在浏览器空闲时，下载相应文件。这是一个很笼统的定义，在我的使用中，我发现在接口没有返回数据，以及图片等还没有请求成功时，prefetch 就会请求数据了。这一点是很不好的，最起码 prefetch 不能影响首页接口的获取速度。所以我把 prefetch 的执行事件放在了 componentDidUpdate 生命周期内。保障了 prefetch 的执行，不会影响到关键的首页数据获取。</li>\n</ol>\n<p>当然 prefetch 在服务端渲染的页面并不会有影响接口的问题，是一个比较好的技术选择</p>\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><ol>\n<li><a href=\"https://www.itcodemonkey.com/article/9707.html\">Prefetch 和预加载实践</a></li>\n<li><a href=\"https://www.jianshu.com/p/24ffa6d45087\">关于 Preload, 你应该知道些什么</a></li>\n<li><a href=\"https://www.w3cplus.com/performance/reloading/preload-prefetch-and-priorities-in-chrome.html\">Preload，Prefetch 和它们在 Chrome 之中的优先级)</a></li>\n</ol>"},{"title":"webpack简介","date":"2018-01-31T09:15:07.000Z","_content":"\nwebpack 做的就是分析代码，转换代码，编译代码，输出代码。webpack 本身是一个 node 的模块，所以 webpack.config.js 是一一 commonjs 形式书写的\n\n<!--more-->\n\n## webpack 的特征\n\n- 插件化：webpack 本身非常灵活，提供了丰富插件接口。基于这些接口，webpack 开发了很多插件作为内置功能。\n- 速度快：webpack 使用异步 IO 以及多级缓存机制。所以 webpack 的速度是很快的，尤其是增量更新。\n- 丰富的 loaders：loaders 用来做预处理。这样 webpack 就可以打包任何静态文件。\n- 高适配性：webpack 同时支持 AMD/CommonJS/ES6 模块方案。webpack 会静态解析你的代码，自动帮你管理他们的依赖关系。且对第 - 方库的兼容贼好。\n- 代码拆分：webpack 提供了很多优化机制来减少打包输出的文件大小，不仅如此它还提供了 hash 机制，来解决浏览器缓存。\n- 开发模式友好：webpack 为开发模式也是提供了很多辅助功能。比如 sourceMap、热更新等。\n- 适用于很多场景。\n\n## webpack 简单介绍\n\n它会递归地构建一个依赖关系图，其中包含程序需要的每一个模块，然后将所有模块打包成一个或多个 bundle.\n\n### 包含四个核心概念\n\n- 入口(entey):指示 webpack 应该使用哪个模块，来作为构建内部依赖图开始。进入入口起点后，webpack 会造出哪些模块和库是入口起点（直接或是间接）依赖的。\n- 出口(output):告诉 webpack 在哪里输出他所创建的 bundles，以及如何命名这些文件。默认值为./dist\n- loader:让 webpack 能够去处理那些非 javascript 文件(webpack 只能理解 javascript 和 json)\n- 插件(plugins):插件则可以用于执行范围更广的任务。插件范围包括，从打包优化和压缩，一直到重新定义环境中的变量。[插件接口](https://www.webpackjs.com/api/plugins/) 功能及其强大，可以用来处理各种各样的任务\n- Chunk：coding split 的产物，我们可以对一些代码打包成一个单独的 chunk，比如某些公共模块，去重，更好的利用缓存。或者按需加载某些功能模块，优化加载时间。在 webpack3 及以前我们都利用 CommonsChunkPlugin 将一些公共代码分割成一个 chunk，实现单独加载。在 webpack4 中 CommonsChunkPlugin 被废弃，使用 SplitChunksPlugin\n\n### 配置分离：webpack 配置文件说明\n\n位于根目录的 config 文件夹下：\n\n- webpack.base.conf.js:主要配置打包所需 entry 入口、module 的 rules、external 配置 jquery 等常用开发库、公用的 plugins（静态资源输出、消除冗余 css/js 代码、自动生成 HTML 模板等）\n- webpack.dev.conf.js:主要配置 mode 环境变量、DevServer 快速开发、HMR 模块热替换等等\n- webpack.prod.conf.js:主要配置 mode 环境变量、正式环境打包配置优化（html/js/css 压缩合并等）。\n- webpack.rules.conf.js:配置常规 loader\n\n## webpack 配置\n\n```javascript\nconst path = require('path');\nmodule.exports = {\n  entry: \"./app/entry\", // string | object | array\n  // Webpack打包的入口\n  output: {  // 定义webpack如何输出的选项\n    path: path.resolve(__dirname, \"dist\"), // string\n    // 所有输出文件的目标路径\n    filename: \"[chunkhash].js\", // string\n    // 「入口(entry chunk)」文件命名模版\n    publicPath: \"/assets/\", // string\n    // 构建文件的输出目录\n    /* 其它高级配置 */\n  },\n  module: {  // 模块相关配置\n    rules: [ // 配置模块loaders，解析规则\n      {\n        test: /\\.jsx?$/,  // RegExp | string\n        include: [ // 和test一样，必须匹配选项\n          path.resolve(__dirname, \"app\")\n        ],\n        exclude: [ // 必不匹配选项（优先级高于test和include）\n          path.resolve(__dirname, \"app/demo-files\")\n        ],\n        loader: \"babel-loader\", // 模块上下文解析\n        options: { // loader的可选项\n          presets: [\"es2015\"]\n        },\n      },\n  },\n  resolve: { //  解析模块的可选项\n    modules: [ // 模块的查找目录\n      \"node_modules\",\n      path.resolve(__dirname, \"app\")\n    ],\n    extensions: [\".js\", \".json\", \".jsx\", \".css\"], // 用到的文件的扩展\n    alias: { // 模块别名列表\n      \"module\": \"new-module\"\n\t  },\n  },\n  devtool: \"source-map\", // enum\n  // 为浏览器开发者工具添加元数据增强调试\n  plugins: [ // 附加插件列表\n    // ...\n  ],\n}\n\n```\n\n### publicPath\n\nwebpack 提供一个非常有用的配置，该配置能帮助你为项目中的所有资源指定一个基础路径，它被称为公共路径(publicPath)。\n其实这里说的所有资源的基础路径是指项目中引用 css，js，img 等资源时候的一个基础路径，这个基础路径要配合具体资源中指定的路径使用，所以其实打包后资源的访问路径可以用如下公式表示\n\n### output.publicPath\n\n`静态资源最终访问路径 = output.publicPath + 资源loader或插件等配置路径`\n\n忽然想起微前端中要配置 publicPath ,就是用到了这个原理吧，在没有生成该静态文件夹的情况去去访问路径，一般本地时，访问路径=文件夹绝对地址路径，但在特殊情况下，例如 nginx 转发情况下，访问路径 ≠ 绝对文件路径。\n\n### module.rules 中的 publicPath\n\n对于 url-loader 中的 outputPath，单独配置或者写在 name 里面，对于真实的目录结构来说，效果是一样的。但是在生成这个 cdn 路径上来说，效果是有区别的。最终的访问路径都是：publicPath+name。跟 outputPath 没有关系，所以，请注意路径配置。\n\n### mainFields\n\n有一些第三方模块会针对不同环境提供几分代码。 例如分别提供采用 ES5 和 ES6 的 2 份代码，这 2 份代码的位置写在 package.json 文件里，Webpack 会根据 mainFields 的配置去决定优先采用那份代码，mainFields 默认如下：\n\n```javascript\nmainFields: ['browser', 'main']\n```\n\nWebpack 会按照数组里的顺序去 package.json 文件里寻找，只会使用找到的第一个。\n\n假如你想优先采用 ES6 的那份代码，可以这样配置：\n\n```\nmainFields: ['jsnext:main', 'browser', 'main']\n```\n\n思考：这个可以用来配 vue 的 cdn 路径吗？dev 开发时 min.js 是无法调试的\n\n### babel 与 polyfill 的关系和区别\n\n### babel\n\n是一个广发使用的 ES6 的转码器，可以将 ES6 代码转为 ES5 代码。注意：babel 默认只转换新的 javascript 语法，而不转换新的 api\n@babel-preset-env 就整合了这些语法转义插件\n\n```javascript\n//Using plugins:\ntransform-template-literals {}\ntransform-literals {}\ntransform-function-name {}\ntransform-arrow-functions {}\ntransform-block-scoped-functions {}\ntransform-classes {}\ntransform-object-super {}\n```\n\n### polyfill\n\nBabel 默认只转换新的 JavaScript 句法（syntax），而不转换新的 API ，比如 Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise 等全局对象，以及一些定义在全局对象上的方法（比如 Object.assign）都不会转码。用于实现浏览器并不支持的原生 API 的代码\n这样就导致了一些新的 API 老版浏览器不兼容。如上述所说，对于新的 API，你可能需要引入 @babel-polyfill 来进行兼容\n\n```javascript\nmodule.exports = {\n  entry: ['@babel-polyfill', './src/index.js']\n}\n```\n\nyarn build 时发现文件体积大了很多，因为上面的代码表示将@babel-polyfill 的代码也打包进去，如何进行按需编译呢？在 JS 中 import @babel-polyfill\n\n修改.babelrc\n\n```javascript\n{\n  \"presets\": [[\"@babel/preset-env\", { \"useBuiltIns\": \"usage\" }]]\n}\n```\n\n### 使用自动刷新\n\nDecServer 刷新原理：\n往要开发的网页中注入代理客户端代码，通过代理客户端去刷新整个页面。使用 webSocket 链接，双工通信\n\nwebapck 要完全启用 HMR 需要使用 webpack.HotModuleReplacementPlugin。如果 webpack 或 webpack-dev-server 通过命令添加--hot 选项启动，这个插件会自动添加，所以不需要添加 HotModuleReplacementPlugin 到 webpack.config.js 中。\n\n但是，经实际使用 webpack-dev-server 时发现，在 webpack.config.js 中仅仅配置了 devServer.hot:true，而未添加这个插件的状态下，仍然实现了 HMR。\n\n项目启动之后，会进行首次构建打包，控制台中会输出整个的构建过程，可以观察到一个 hash 值，每一次代码修改后，保存时都会在控制台上看到 hash 值更新。\n\n### webpack watch\n\n在项目启动之后，Webpack 会通过 Compiler 类的 Run 方法开启编译构建过程，编译完成后，调用 Watch 方法监听文件变更，当文件发生变化，重新编译，编译完成之后继续监听。\n\n可以看出所谓模块热替换指的是页面在尽量不经过刷新的情况下将页面所引用的 js 或 css 等模块进行热替换。这里之所以说是尽量不经过刷新页面是因为 webpack 在热替换检查失败的情况会刷新整个页面。\n\n**问题：**\nwebpack-dev-server 好像是只监听 webpack.config.js 中 entry 入口下文件（如 js、css 等等）的变动，只有这些文件的变动才会触发实时编译打包与页面刷新，而对于不在 entry 入口下的 html 文件，却不进行监听与页面自动刷新。\n\n**解决方法：**\n\n添加参数 watchContentBase: true，目录 contentBase 目录下的 html 文件变化也可监听并刷新\n\n```javascript\n  devServer: {\n    port: 9000,\n    hot: true,\n    contentBase: path.join(__dirname, '/example'), //本地服务器所加载文件的目录\n    watchContentBase: true,\n  }\n```\n\n### devServer.watchContentBase\n\n告诉 dev-server 监听 [devServer.contentBase]（＃devservercontentbase）选项提供的文件。 默认情况下禁用。 启用后，文件更改将触发整个页面重新加载。\n\n## webpack 的整个打包流程\n\n1、读取 webpack 的配置参数\n2、启动 webpack，创建 compiler 对象并开始解析项目\n3、从入口文件（entry）开始解析，并且找到其导入的依赖模块，递归遍历分析，形成依赖关系树\n4、对不同的文件类型的依赖模块文件使用对应的 loader 进行编译，最终转为 javascript 文件\n5、整个过程中 webpack 会通过发布订阅模式，向外抛出一些 hooks，而 webpack 的插件即可通过监听这些关键的节点，执行插件任务进而达到敢于输出结果的目的\n\n## 站外资料链接\n\n[深入浅出 webpack](http://webpack.wuhaolin.cn/)\n","source":"_posts/webpack简介.md","raw":"---\ntitle: webpack简介\ndate: 2018-01-31 17:15:07\ncategories: webpack\n---\n\nwebpack 做的就是分析代码，转换代码，编译代码，输出代码。webpack 本身是一个 node 的模块，所以 webpack.config.js 是一一 commonjs 形式书写的\n\n<!--more-->\n\n## webpack 的特征\n\n- 插件化：webpack 本身非常灵活，提供了丰富插件接口。基于这些接口，webpack 开发了很多插件作为内置功能。\n- 速度快：webpack 使用异步 IO 以及多级缓存机制。所以 webpack 的速度是很快的，尤其是增量更新。\n- 丰富的 loaders：loaders 用来做预处理。这样 webpack 就可以打包任何静态文件。\n- 高适配性：webpack 同时支持 AMD/CommonJS/ES6 模块方案。webpack 会静态解析你的代码，自动帮你管理他们的依赖关系。且对第 - 方库的兼容贼好。\n- 代码拆分：webpack 提供了很多优化机制来减少打包输出的文件大小，不仅如此它还提供了 hash 机制，来解决浏览器缓存。\n- 开发模式友好：webpack 为开发模式也是提供了很多辅助功能。比如 sourceMap、热更新等。\n- 适用于很多场景。\n\n## webpack 简单介绍\n\n它会递归地构建一个依赖关系图，其中包含程序需要的每一个模块，然后将所有模块打包成一个或多个 bundle.\n\n### 包含四个核心概念\n\n- 入口(entey):指示 webpack 应该使用哪个模块，来作为构建内部依赖图开始。进入入口起点后，webpack 会造出哪些模块和库是入口起点（直接或是间接）依赖的。\n- 出口(output):告诉 webpack 在哪里输出他所创建的 bundles，以及如何命名这些文件。默认值为./dist\n- loader:让 webpack 能够去处理那些非 javascript 文件(webpack 只能理解 javascript 和 json)\n- 插件(plugins):插件则可以用于执行范围更广的任务。插件范围包括，从打包优化和压缩，一直到重新定义环境中的变量。[插件接口](https://www.webpackjs.com/api/plugins/) 功能及其强大，可以用来处理各种各样的任务\n- Chunk：coding split 的产物，我们可以对一些代码打包成一个单独的 chunk，比如某些公共模块，去重，更好的利用缓存。或者按需加载某些功能模块，优化加载时间。在 webpack3 及以前我们都利用 CommonsChunkPlugin 将一些公共代码分割成一个 chunk，实现单独加载。在 webpack4 中 CommonsChunkPlugin 被废弃，使用 SplitChunksPlugin\n\n### 配置分离：webpack 配置文件说明\n\n位于根目录的 config 文件夹下：\n\n- webpack.base.conf.js:主要配置打包所需 entry 入口、module 的 rules、external 配置 jquery 等常用开发库、公用的 plugins（静态资源输出、消除冗余 css/js 代码、自动生成 HTML 模板等）\n- webpack.dev.conf.js:主要配置 mode 环境变量、DevServer 快速开发、HMR 模块热替换等等\n- webpack.prod.conf.js:主要配置 mode 环境变量、正式环境打包配置优化（html/js/css 压缩合并等）。\n- webpack.rules.conf.js:配置常规 loader\n\n## webpack 配置\n\n```javascript\nconst path = require('path');\nmodule.exports = {\n  entry: \"./app/entry\", // string | object | array\n  // Webpack打包的入口\n  output: {  // 定义webpack如何输出的选项\n    path: path.resolve(__dirname, \"dist\"), // string\n    // 所有输出文件的目标路径\n    filename: \"[chunkhash].js\", // string\n    // 「入口(entry chunk)」文件命名模版\n    publicPath: \"/assets/\", // string\n    // 构建文件的输出目录\n    /* 其它高级配置 */\n  },\n  module: {  // 模块相关配置\n    rules: [ // 配置模块loaders，解析规则\n      {\n        test: /\\.jsx?$/,  // RegExp | string\n        include: [ // 和test一样，必须匹配选项\n          path.resolve(__dirname, \"app\")\n        ],\n        exclude: [ // 必不匹配选项（优先级高于test和include）\n          path.resolve(__dirname, \"app/demo-files\")\n        ],\n        loader: \"babel-loader\", // 模块上下文解析\n        options: { // loader的可选项\n          presets: [\"es2015\"]\n        },\n      },\n  },\n  resolve: { //  解析模块的可选项\n    modules: [ // 模块的查找目录\n      \"node_modules\",\n      path.resolve(__dirname, \"app\")\n    ],\n    extensions: [\".js\", \".json\", \".jsx\", \".css\"], // 用到的文件的扩展\n    alias: { // 模块别名列表\n      \"module\": \"new-module\"\n\t  },\n  },\n  devtool: \"source-map\", // enum\n  // 为浏览器开发者工具添加元数据增强调试\n  plugins: [ // 附加插件列表\n    // ...\n  ],\n}\n\n```\n\n### publicPath\n\nwebpack 提供一个非常有用的配置，该配置能帮助你为项目中的所有资源指定一个基础路径，它被称为公共路径(publicPath)。\n其实这里说的所有资源的基础路径是指项目中引用 css，js，img 等资源时候的一个基础路径，这个基础路径要配合具体资源中指定的路径使用，所以其实打包后资源的访问路径可以用如下公式表示\n\n### output.publicPath\n\n`静态资源最终访问路径 = output.publicPath + 资源loader或插件等配置路径`\n\n忽然想起微前端中要配置 publicPath ,就是用到了这个原理吧，在没有生成该静态文件夹的情况去去访问路径，一般本地时，访问路径=文件夹绝对地址路径，但在特殊情况下，例如 nginx 转发情况下，访问路径 ≠ 绝对文件路径。\n\n### module.rules 中的 publicPath\n\n对于 url-loader 中的 outputPath，单独配置或者写在 name 里面，对于真实的目录结构来说，效果是一样的。但是在生成这个 cdn 路径上来说，效果是有区别的。最终的访问路径都是：publicPath+name。跟 outputPath 没有关系，所以，请注意路径配置。\n\n### mainFields\n\n有一些第三方模块会针对不同环境提供几分代码。 例如分别提供采用 ES5 和 ES6 的 2 份代码，这 2 份代码的位置写在 package.json 文件里，Webpack 会根据 mainFields 的配置去决定优先采用那份代码，mainFields 默认如下：\n\n```javascript\nmainFields: ['browser', 'main']\n```\n\nWebpack 会按照数组里的顺序去 package.json 文件里寻找，只会使用找到的第一个。\n\n假如你想优先采用 ES6 的那份代码，可以这样配置：\n\n```\nmainFields: ['jsnext:main', 'browser', 'main']\n```\n\n思考：这个可以用来配 vue 的 cdn 路径吗？dev 开发时 min.js 是无法调试的\n\n### babel 与 polyfill 的关系和区别\n\n### babel\n\n是一个广发使用的 ES6 的转码器，可以将 ES6 代码转为 ES5 代码。注意：babel 默认只转换新的 javascript 语法，而不转换新的 api\n@babel-preset-env 就整合了这些语法转义插件\n\n```javascript\n//Using plugins:\ntransform-template-literals {}\ntransform-literals {}\ntransform-function-name {}\ntransform-arrow-functions {}\ntransform-block-scoped-functions {}\ntransform-classes {}\ntransform-object-super {}\n```\n\n### polyfill\n\nBabel 默认只转换新的 JavaScript 句法（syntax），而不转换新的 API ，比如 Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise 等全局对象，以及一些定义在全局对象上的方法（比如 Object.assign）都不会转码。用于实现浏览器并不支持的原生 API 的代码\n这样就导致了一些新的 API 老版浏览器不兼容。如上述所说，对于新的 API，你可能需要引入 @babel-polyfill 来进行兼容\n\n```javascript\nmodule.exports = {\n  entry: ['@babel-polyfill', './src/index.js']\n}\n```\n\nyarn build 时发现文件体积大了很多，因为上面的代码表示将@babel-polyfill 的代码也打包进去，如何进行按需编译呢？在 JS 中 import @babel-polyfill\n\n修改.babelrc\n\n```javascript\n{\n  \"presets\": [[\"@babel/preset-env\", { \"useBuiltIns\": \"usage\" }]]\n}\n```\n\n### 使用自动刷新\n\nDecServer 刷新原理：\n往要开发的网页中注入代理客户端代码，通过代理客户端去刷新整个页面。使用 webSocket 链接，双工通信\n\nwebapck 要完全启用 HMR 需要使用 webpack.HotModuleReplacementPlugin。如果 webpack 或 webpack-dev-server 通过命令添加--hot 选项启动，这个插件会自动添加，所以不需要添加 HotModuleReplacementPlugin 到 webpack.config.js 中。\n\n但是，经实际使用 webpack-dev-server 时发现，在 webpack.config.js 中仅仅配置了 devServer.hot:true，而未添加这个插件的状态下，仍然实现了 HMR。\n\n项目启动之后，会进行首次构建打包，控制台中会输出整个的构建过程，可以观察到一个 hash 值，每一次代码修改后，保存时都会在控制台上看到 hash 值更新。\n\n### webpack watch\n\n在项目启动之后，Webpack 会通过 Compiler 类的 Run 方法开启编译构建过程，编译完成后，调用 Watch 方法监听文件变更，当文件发生变化，重新编译，编译完成之后继续监听。\n\n可以看出所谓模块热替换指的是页面在尽量不经过刷新的情况下将页面所引用的 js 或 css 等模块进行热替换。这里之所以说是尽量不经过刷新页面是因为 webpack 在热替换检查失败的情况会刷新整个页面。\n\n**问题：**\nwebpack-dev-server 好像是只监听 webpack.config.js 中 entry 入口下文件（如 js、css 等等）的变动，只有这些文件的变动才会触发实时编译打包与页面刷新，而对于不在 entry 入口下的 html 文件，却不进行监听与页面自动刷新。\n\n**解决方法：**\n\n添加参数 watchContentBase: true，目录 contentBase 目录下的 html 文件变化也可监听并刷新\n\n```javascript\n  devServer: {\n    port: 9000,\n    hot: true,\n    contentBase: path.join(__dirname, '/example'), //本地服务器所加载文件的目录\n    watchContentBase: true,\n  }\n```\n\n### devServer.watchContentBase\n\n告诉 dev-server 监听 [devServer.contentBase]（＃devservercontentbase）选项提供的文件。 默认情况下禁用。 启用后，文件更改将触发整个页面重新加载。\n\n## webpack 的整个打包流程\n\n1、读取 webpack 的配置参数\n2、启动 webpack，创建 compiler 对象并开始解析项目\n3、从入口文件（entry）开始解析，并且找到其导入的依赖模块，递归遍历分析，形成依赖关系树\n4、对不同的文件类型的依赖模块文件使用对应的 loader 进行编译，最终转为 javascript 文件\n5、整个过程中 webpack 会通过发布订阅模式，向外抛出一些 hooks，而 webpack 的插件即可通过监听这些关键的节点，执行插件任务进而达到敢于输出结果的目的\n\n## 站外资料链接\n\n[深入浅出 webpack](http://webpack.wuhaolin.cn/)\n","slug":"webpack简介","published":1,"updated":"2021-05-06T12:22:09.896Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x7001wl5v0fqnpf8iw","content":"<p>webpack 做的就是分析代码，转换代码，编译代码，输出代码。webpack 本身是一个 node 的模块，所以 webpack.config.js 是一一 commonjs 形式书写的</p>\n<span id=\"more\"></span>\n\n<h2 id=\"webpack-的特征\"><a href=\"#webpack-的特征\" class=\"headerlink\" title=\"webpack 的特征\"></a>webpack 的特征</h2><ul>\n<li>插件化：webpack 本身非常灵活，提供了丰富插件接口。基于这些接口，webpack 开发了很多插件作为内置功能。</li>\n<li>速度快：webpack 使用异步 IO 以及多级缓存机制。所以 webpack 的速度是很快的，尤其是增量更新。</li>\n<li>丰富的 loaders：loaders 用来做预处理。这样 webpack 就可以打包任何静态文件。</li>\n<li>高适配性：webpack 同时支持 AMD/CommonJS/ES6 模块方案。webpack 会静态解析你的代码，自动帮你管理他们的依赖关系。且对第 - 方库的兼容贼好。</li>\n<li>代码拆分：webpack 提供了很多优化机制来减少打包输出的文件大小，不仅如此它还提供了 hash 机制，来解决浏览器缓存。</li>\n<li>开发模式友好：webpack 为开发模式也是提供了很多辅助功能。比如 sourceMap、热更新等。</li>\n<li>适用于很多场景。</li>\n</ul>\n<h2 id=\"webpack-简单介绍\"><a href=\"#webpack-简单介绍\" class=\"headerlink\" title=\"webpack 简单介绍\"></a>webpack 简单介绍</h2><p>它会递归地构建一个依赖关系图，其中包含程序需要的每一个模块，然后将所有模块打包成一个或多个 bundle.</p>\n<h3 id=\"包含四个核心概念\"><a href=\"#包含四个核心概念\" class=\"headerlink\" title=\"包含四个核心概念\"></a>包含四个核心概念</h3><ul>\n<li>入口(entey):指示 webpack 应该使用哪个模块，来作为构建内部依赖图开始。进入入口起点后，webpack 会造出哪些模块和库是入口起点（直接或是间接）依赖的。</li>\n<li>出口(output):告诉 webpack 在哪里输出他所创建的 bundles，以及如何命名这些文件。默认值为./dist</li>\n<li>loader:让 webpack 能够去处理那些非 javascript 文件(webpack 只能理解 javascript 和 json)</li>\n<li>插件(plugins):插件则可以用于执行范围更广的任务。插件范围包括，从打包优化和压缩，一直到重新定义环境中的变量。<a href=\"https://www.webpackjs.com/api/plugins/\">插件接口</a> 功能及其强大，可以用来处理各种各样的任务</li>\n<li>Chunk：coding split 的产物，我们可以对一些代码打包成一个单独的 chunk，比如某些公共模块，去重，更好的利用缓存。或者按需加载某些功能模块，优化加载时间。在 webpack3 及以前我们都利用 CommonsChunkPlugin 将一些公共代码分割成一个 chunk，实现单独加载。在 webpack4 中 CommonsChunkPlugin 被废弃，使用 SplitChunksPlugin</li>\n</ul>\n<h3 id=\"配置分离：webpack-配置文件说明\"><a href=\"#配置分离：webpack-配置文件说明\" class=\"headerlink\" title=\"配置分离：webpack 配置文件说明\"></a>配置分离：webpack 配置文件说明</h3><p>位于根目录的 config 文件夹下：</p>\n<ul>\n<li>webpack.base.conf.js:主要配置打包所需 entry 入口、module 的 rules、external 配置 jquery 等常用开发库、公用的 plugins（静态资源输出、消除冗余 css/js 代码、自动生成 HTML 模板等）</li>\n<li>webpack.dev.conf.js:主要配置 mode 环境变量、DevServer 快速开发、HMR 模块热替换等等</li>\n<li>webpack.prod.conf.js:主要配置 mode 环境变量、正式环境打包配置优化（html/js/css 压缩合并等）。</li>\n<li>webpack.rules.conf.js:配置常规 loader</li>\n</ul>\n<h2 id=\"webpack-配置\"><a href=\"#webpack-配置\" class=\"headerlink\" title=\"webpack 配置\"></a>webpack 配置</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: <span class=\"string\">&quot;./app/entry&quot;</span>, <span class=\"comment\">// string | object | array</span></span><br><span class=\"line\">  <span class=\"comment\">// Webpack打包的入口</span></span><br><span class=\"line\">  output: &#123;  <span class=\"comment\">// 定义webpack如何输出的选项</span></span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">&quot;dist&quot;</span>), <span class=\"comment\">// string</span></span><br><span class=\"line\">    <span class=\"comment\">// 所有输出文件的目标路径</span></span><br><span class=\"line\">    filename: <span class=\"string\">&quot;[chunkhash].js&quot;</span>, <span class=\"comment\">// string</span></span><br><span class=\"line\">    <span class=\"comment\">// 「入口(entry chunk)」文件命名模版</span></span><br><span class=\"line\">    publicPath: <span class=\"string\">&quot;/assets/&quot;</span>, <span class=\"comment\">// string</span></span><br><span class=\"line\">    <span class=\"comment\">// 构建文件的输出目录</span></span><br><span class=\"line\">    <span class=\"comment\">/* 其它高级配置 */</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;  <span class=\"comment\">// 模块相关配置</span></span><br><span class=\"line\">    rules: [ <span class=\"comment\">// 配置模块loaders，解析规则</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.jsx?$/</span>,  <span class=\"comment\">// RegExp | string</span></span><br><span class=\"line\">        include: [ <span class=\"comment\">// 和test一样，必须匹配选项</span></span><br><span class=\"line\">          path.resolve(__dirname, <span class=\"string\">&quot;app&quot;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        exclude: [ <span class=\"comment\">// 必不匹配选项（优先级高于test和include）</span></span><br><span class=\"line\">          path.resolve(__dirname, <span class=\"string\">&quot;app/demo-files&quot;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        loader: <span class=\"string\">&quot;babel-loader&quot;</span>, <span class=\"comment\">// 模块上下文解析</span></span><br><span class=\"line\">        options: &#123; <span class=\"comment\">// loader的可选项</span></span><br><span class=\"line\">          presets: [<span class=\"string\">&quot;es2015&quot;</span>]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  resolve: &#123; <span class=\"comment\">//  解析模块的可选项</span></span><br><span class=\"line\">    modules: [ <span class=\"comment\">// 模块的查找目录</span></span><br><span class=\"line\">      <span class=\"string\">&quot;node_modules&quot;</span>,</span><br><span class=\"line\">      path.resolve(__dirname, <span class=\"string\">&quot;app&quot;</span>)</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    extensions: [<span class=\"string\">&quot;.js&quot;</span>, <span class=\"string\">&quot;.json&quot;</span>, <span class=\"string\">&quot;.jsx&quot;</span>, <span class=\"string\">&quot;.css&quot;</span>], <span class=\"comment\">// 用到的文件的扩展</span></span><br><span class=\"line\">    alias: &#123; <span class=\"comment\">// 模块别名列表</span></span><br><span class=\"line\">      <span class=\"string\">&quot;module&quot;</span>: <span class=\"string\">&quot;new-module&quot;</span></span><br><span class=\"line\">\t  &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  devtool: <span class=\"string\">&quot;source-map&quot;</span>, <span class=\"comment\">// enum</span></span><br><span class=\"line\">  <span class=\"comment\">// 为浏览器开发者工具添加元数据增强调试</span></span><br><span class=\"line\">  plugins: [ <span class=\"comment\">// 附加插件列表</span></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"publicPath\"><a href=\"#publicPath\" class=\"headerlink\" title=\"publicPath\"></a>publicPath</h3><p>webpack 提供一个非常有用的配置，该配置能帮助你为项目中的所有资源指定一个基础路径，它被称为公共路径(publicPath)。<br>其实这里说的所有资源的基础路径是指项目中引用 css，js，img 等资源时候的一个基础路径，这个基础路径要配合具体资源中指定的路径使用，所以其实打包后资源的访问路径可以用如下公式表示</p>\n<h3 id=\"output-publicPath\"><a href=\"#output-publicPath\" class=\"headerlink\" title=\"output.publicPath\"></a>output.publicPath</h3><p><code>静态资源最终访问路径 = output.publicPath + 资源loader或插件等配置路径</code></p>\n<p>忽然想起微前端中要配置 publicPath ,就是用到了这个原理吧，在没有生成该静态文件夹的情况去去访问路径，一般本地时，访问路径=文件夹绝对地址路径，但在特殊情况下，例如 nginx 转发情况下，访问路径 ≠ 绝对文件路径。</p>\n<h3 id=\"module-rules-中的-publicPath\"><a href=\"#module-rules-中的-publicPath\" class=\"headerlink\" title=\"module.rules 中的 publicPath\"></a>module.rules 中的 publicPath</h3><p>对于 url-loader 中的 outputPath，单独配置或者写在 name 里面，对于真实的目录结构来说，效果是一样的。但是在生成这个 cdn 路径上来说，效果是有区别的。最终的访问路径都是：publicPath+name。跟 outputPath 没有关系，所以，请注意路径配置。</p>\n<h3 id=\"mainFields\"><a href=\"#mainFields\" class=\"headerlink\" title=\"mainFields\"></a>mainFields</h3><p>有一些第三方模块会针对不同环境提供几分代码。 例如分别提供采用 ES5 和 ES6 的 2 份代码，这 2 份代码的位置写在 package.json 文件里，Webpack 会根据 mainFields 的配置去决定优先采用那份代码，mainFields 默认如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mainFields: [<span class=\"string\">&#x27;browser&#x27;</span>, <span class=\"string\">&#x27;main&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>Webpack 会按照数组里的顺序去 package.json 文件里寻找，只会使用找到的第一个。</p>\n<p>假如你想优先采用 ES6 的那份代码，可以这样配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mainFields: [&#39;jsnext:main&#39;, &#39;browser&#39;, &#39;main&#39;]</span><br></pre></td></tr></table></figure>\n\n<p>思考：这个可以用来配 vue 的 cdn 路径吗？dev 开发时 min.js 是无法调试的</p>\n<h3 id=\"babel-与-polyfill-的关系和区别\"><a href=\"#babel-与-polyfill-的关系和区别\" class=\"headerlink\" title=\"babel 与 polyfill 的关系和区别\"></a>babel 与 polyfill 的关系和区别</h3><h3 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h3><p>是一个广发使用的 ES6 的转码器，可以将 ES6 代码转为 ES5 代码。注意：babel 默认只转换新的 javascript 语法，而不转换新的 api<br>@babel-preset-env 就整合了这些语法转义插件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Using plugins:</span></span><br><span class=\"line\">transform-template-literals &#123;&#125;</span><br><span class=\"line\">transform-literals &#123;&#125;</span><br><span class=\"line\">transform-<span class=\"function\"><span class=\"keyword\">function</span>-<span class=\"title\">name</span> </span>&#123;&#125;</span><br><span class=\"line\">transform-arrow-functions &#123;&#125;</span><br><span class=\"line\">transform-block-scoped-functions &#123;&#125;</span><br><span class=\"line\">transform-classes &#123;&#125;</span><br><span class=\"line\">transform-object-<span class=\"built_in\">super</span> &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"polyfill\"><a href=\"#polyfill\" class=\"headerlink\" title=\"polyfill\"></a>polyfill</h3><p>Babel 默认只转换新的 JavaScript 句法（syntax），而不转换新的 API ，比如 Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise 等全局对象，以及一些定义在全局对象上的方法（比如 Object.assign）都不会转码。用于实现浏览器并不支持的原生 API 的代码<br>这样就导致了一些新的 API 老版浏览器不兼容。如上述所说，对于新的 API，你可能需要引入 @babel-polyfill 来进行兼容</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: [<span class=\"string\">&#x27;@babel-polyfill&#x27;</span>, <span class=\"string\">&#x27;./src/index.js&#x27;</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>yarn build 时发现文件体积大了很多，因为上面的代码表示将@babel-polyfill 的代码也打包进去，如何进行按需编译呢？在 JS 中 import @babel-polyfill</p>\n<p>修改.babelrc</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;presets&quot;</span>: [[<span class=\"string\">&quot;@babel/preset-env&quot;</span>, &#123; <span class=\"string\">&quot;useBuiltIns&quot;</span>: <span class=\"string\">&quot;usage&quot;</span> &#125;]]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用自动刷新\"><a href=\"#使用自动刷新\" class=\"headerlink\" title=\"使用自动刷新\"></a>使用自动刷新</h3><p>DecServer 刷新原理：<br>往要开发的网页中注入代理客户端代码，通过代理客户端去刷新整个页面。使用 webSocket 链接，双工通信</p>\n<p>webapck 要完全启用 HMR 需要使用 webpack.HotModuleReplacementPlugin。如果 webpack 或 webpack-dev-server 通过命令添加–hot 选项启动，这个插件会自动添加，所以不需要添加 HotModuleReplacementPlugin 到 webpack.config.js 中。</p>\n<p>但是，经实际使用 webpack-dev-server 时发现，在 webpack.config.js 中仅仅配置了 devServer.hot:true，而未添加这个插件的状态下，仍然实现了 HMR。</p>\n<p>项目启动之后，会进行首次构建打包，控制台中会输出整个的构建过程，可以观察到一个 hash 值，每一次代码修改后，保存时都会在控制台上看到 hash 值更新。</p>\n<h3 id=\"webpack-watch\"><a href=\"#webpack-watch\" class=\"headerlink\" title=\"webpack watch\"></a>webpack watch</h3><p>在项目启动之后，Webpack 会通过 Compiler 类的 Run 方法开启编译构建过程，编译完成后，调用 Watch 方法监听文件变更，当文件发生变化，重新编译，编译完成之后继续监听。</p>\n<p>可以看出所谓模块热替换指的是页面在尽量不经过刷新的情况下将页面所引用的 js 或 css 等模块进行热替换。这里之所以说是尽量不经过刷新页面是因为 webpack 在热替换检查失败的情况会刷新整个页面。</p>\n<p><strong>问题：</strong><br>webpack-dev-server 好像是只监听 webpack.config.js 中 entry 入口下文件（如 js、css 等等）的变动，只有这些文件的变动才会触发实时编译打包与页面刷新，而对于不在 entry 入口下的 html 文件，却不进行监听与页面自动刷新。</p>\n<p><strong>解决方法：</strong></p>\n<p>添加参数 watchContentBase: true，目录 contentBase 目录下的 html 文件变化也可监听并刷新</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">devServer: &#123;</span><br><span class=\"line\">  port: <span class=\"number\">9000</span>,</span><br><span class=\"line\">  hot: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  contentBase: path.join(__dirname, <span class=\"string\">&#x27;/example&#x27;</span>), <span class=\"comment\">//本地服务器所加载文件的目录</span></span><br><span class=\"line\">  watchContentBase: <span class=\"literal\">true</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"devServer-watchContentBase\"><a href=\"#devServer-watchContentBase\" class=\"headerlink\" title=\"devServer.watchContentBase\"></a>devServer.watchContentBase</h3><p>告诉 dev-server 监听 [devServer.contentBase]（＃devservercontentbase）选项提供的文件。 默认情况下禁用。 启用后，文件更改将触发整个页面重新加载。</p>\n<h2 id=\"webpack-的整个打包流程\"><a href=\"#webpack-的整个打包流程\" class=\"headerlink\" title=\"webpack 的整个打包流程\"></a>webpack 的整个打包流程</h2><p>1、读取 webpack 的配置参数<br>2、启动 webpack，创建 compiler 对象并开始解析项目<br>3、从入口文件（entry）开始解析，并且找到其导入的依赖模块，递归遍历分析，形成依赖关系树<br>4、对不同的文件类型的依赖模块文件使用对应的 loader 进行编译，最终转为 javascript 文件<br>5、整个过程中 webpack 会通过发布订阅模式，向外抛出一些 hooks，而 webpack 的插件即可通过监听这些关键的节点，执行插件任务进而达到敢于输出结果的目的</p>\n<h2 id=\"站外资料链接\"><a href=\"#站外资料链接\" class=\"headerlink\" title=\"站外资料链接\"></a>站外资料链接</h2><p><a href=\"http://webpack.wuhaolin.cn/\">深入浅出 webpack</a></p>\n","site":{"data":{}},"excerpt":"<p>webpack 做的就是分析代码，转换代码，编译代码，输出代码。webpack 本身是一个 node 的模块，所以 webpack.config.js 是一一 commonjs 形式书写的</p>","more":"<h2 id=\"webpack-的特征\"><a href=\"#webpack-的特征\" class=\"headerlink\" title=\"webpack 的特征\"></a>webpack 的特征</h2><ul>\n<li>插件化：webpack 本身非常灵活，提供了丰富插件接口。基于这些接口，webpack 开发了很多插件作为内置功能。</li>\n<li>速度快：webpack 使用异步 IO 以及多级缓存机制。所以 webpack 的速度是很快的，尤其是增量更新。</li>\n<li>丰富的 loaders：loaders 用来做预处理。这样 webpack 就可以打包任何静态文件。</li>\n<li>高适配性：webpack 同时支持 AMD/CommonJS/ES6 模块方案。webpack 会静态解析你的代码，自动帮你管理他们的依赖关系。且对第 - 方库的兼容贼好。</li>\n<li>代码拆分：webpack 提供了很多优化机制来减少打包输出的文件大小，不仅如此它还提供了 hash 机制，来解决浏览器缓存。</li>\n<li>开发模式友好：webpack 为开发模式也是提供了很多辅助功能。比如 sourceMap、热更新等。</li>\n<li>适用于很多场景。</li>\n</ul>\n<h2 id=\"webpack-简单介绍\"><a href=\"#webpack-简单介绍\" class=\"headerlink\" title=\"webpack 简单介绍\"></a>webpack 简单介绍</h2><p>它会递归地构建一个依赖关系图，其中包含程序需要的每一个模块，然后将所有模块打包成一个或多个 bundle.</p>\n<h3 id=\"包含四个核心概念\"><a href=\"#包含四个核心概念\" class=\"headerlink\" title=\"包含四个核心概念\"></a>包含四个核心概念</h3><ul>\n<li>入口(entey):指示 webpack 应该使用哪个模块，来作为构建内部依赖图开始。进入入口起点后，webpack 会造出哪些模块和库是入口起点（直接或是间接）依赖的。</li>\n<li>出口(output):告诉 webpack 在哪里输出他所创建的 bundles，以及如何命名这些文件。默认值为./dist</li>\n<li>loader:让 webpack 能够去处理那些非 javascript 文件(webpack 只能理解 javascript 和 json)</li>\n<li>插件(plugins):插件则可以用于执行范围更广的任务。插件范围包括，从打包优化和压缩，一直到重新定义环境中的变量。<a href=\"https://www.webpackjs.com/api/plugins/\">插件接口</a> 功能及其强大，可以用来处理各种各样的任务</li>\n<li>Chunk：coding split 的产物，我们可以对一些代码打包成一个单独的 chunk，比如某些公共模块，去重，更好的利用缓存。或者按需加载某些功能模块，优化加载时间。在 webpack3 及以前我们都利用 CommonsChunkPlugin 将一些公共代码分割成一个 chunk，实现单独加载。在 webpack4 中 CommonsChunkPlugin 被废弃，使用 SplitChunksPlugin</li>\n</ul>\n<h3 id=\"配置分离：webpack-配置文件说明\"><a href=\"#配置分离：webpack-配置文件说明\" class=\"headerlink\" title=\"配置分离：webpack 配置文件说明\"></a>配置分离：webpack 配置文件说明</h3><p>位于根目录的 config 文件夹下：</p>\n<ul>\n<li>webpack.base.conf.js:主要配置打包所需 entry 入口、module 的 rules、external 配置 jquery 等常用开发库、公用的 plugins（静态资源输出、消除冗余 css/js 代码、自动生成 HTML 模板等）</li>\n<li>webpack.dev.conf.js:主要配置 mode 环境变量、DevServer 快速开发、HMR 模块热替换等等</li>\n<li>webpack.prod.conf.js:主要配置 mode 环境变量、正式环境打包配置优化（html/js/css 压缩合并等）。</li>\n<li>webpack.rules.conf.js:配置常规 loader</li>\n</ul>\n<h2 id=\"webpack-配置\"><a href=\"#webpack-配置\" class=\"headerlink\" title=\"webpack 配置\"></a>webpack 配置</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: <span class=\"string\">&quot;./app/entry&quot;</span>, <span class=\"comment\">// string | object | array</span></span><br><span class=\"line\">  <span class=\"comment\">// Webpack打包的入口</span></span><br><span class=\"line\">  output: &#123;  <span class=\"comment\">// 定义webpack如何输出的选项</span></span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">&quot;dist&quot;</span>), <span class=\"comment\">// string</span></span><br><span class=\"line\">    <span class=\"comment\">// 所有输出文件的目标路径</span></span><br><span class=\"line\">    filename: <span class=\"string\">&quot;[chunkhash].js&quot;</span>, <span class=\"comment\">// string</span></span><br><span class=\"line\">    <span class=\"comment\">// 「入口(entry chunk)」文件命名模版</span></span><br><span class=\"line\">    publicPath: <span class=\"string\">&quot;/assets/&quot;</span>, <span class=\"comment\">// string</span></span><br><span class=\"line\">    <span class=\"comment\">// 构建文件的输出目录</span></span><br><span class=\"line\">    <span class=\"comment\">/* 其它高级配置 */</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;  <span class=\"comment\">// 模块相关配置</span></span><br><span class=\"line\">    rules: [ <span class=\"comment\">// 配置模块loaders，解析规则</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.jsx?$/</span>,  <span class=\"comment\">// RegExp | string</span></span><br><span class=\"line\">        include: [ <span class=\"comment\">// 和test一样，必须匹配选项</span></span><br><span class=\"line\">          path.resolve(__dirname, <span class=\"string\">&quot;app&quot;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        exclude: [ <span class=\"comment\">// 必不匹配选项（优先级高于test和include）</span></span><br><span class=\"line\">          path.resolve(__dirname, <span class=\"string\">&quot;app/demo-files&quot;</span>)</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        loader: <span class=\"string\">&quot;babel-loader&quot;</span>, <span class=\"comment\">// 模块上下文解析</span></span><br><span class=\"line\">        options: &#123; <span class=\"comment\">// loader的可选项</span></span><br><span class=\"line\">          presets: [<span class=\"string\">&quot;es2015&quot;</span>]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  resolve: &#123; <span class=\"comment\">//  解析模块的可选项</span></span><br><span class=\"line\">    modules: [ <span class=\"comment\">// 模块的查找目录</span></span><br><span class=\"line\">      <span class=\"string\">&quot;node_modules&quot;</span>,</span><br><span class=\"line\">      path.resolve(__dirname, <span class=\"string\">&quot;app&quot;</span>)</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    extensions: [<span class=\"string\">&quot;.js&quot;</span>, <span class=\"string\">&quot;.json&quot;</span>, <span class=\"string\">&quot;.jsx&quot;</span>, <span class=\"string\">&quot;.css&quot;</span>], <span class=\"comment\">// 用到的文件的扩展</span></span><br><span class=\"line\">    alias: &#123; <span class=\"comment\">// 模块别名列表</span></span><br><span class=\"line\">      <span class=\"string\">&quot;module&quot;</span>: <span class=\"string\">&quot;new-module&quot;</span></span><br><span class=\"line\">\t  &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  devtool: <span class=\"string\">&quot;source-map&quot;</span>, <span class=\"comment\">// enum</span></span><br><span class=\"line\">  <span class=\"comment\">// 为浏览器开发者工具添加元数据增强调试</span></span><br><span class=\"line\">  plugins: [ <span class=\"comment\">// 附加插件列表</span></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"publicPath\"><a href=\"#publicPath\" class=\"headerlink\" title=\"publicPath\"></a>publicPath</h3><p>webpack 提供一个非常有用的配置，该配置能帮助你为项目中的所有资源指定一个基础路径，它被称为公共路径(publicPath)。<br>其实这里说的所有资源的基础路径是指项目中引用 css，js，img 等资源时候的一个基础路径，这个基础路径要配合具体资源中指定的路径使用，所以其实打包后资源的访问路径可以用如下公式表示</p>\n<h3 id=\"output-publicPath\"><a href=\"#output-publicPath\" class=\"headerlink\" title=\"output.publicPath\"></a>output.publicPath</h3><p><code>静态资源最终访问路径 = output.publicPath + 资源loader或插件等配置路径</code></p>\n<p>忽然想起微前端中要配置 publicPath ,就是用到了这个原理吧，在没有生成该静态文件夹的情况去去访问路径，一般本地时，访问路径=文件夹绝对地址路径，但在特殊情况下，例如 nginx 转发情况下，访问路径 ≠ 绝对文件路径。</p>\n<h3 id=\"module-rules-中的-publicPath\"><a href=\"#module-rules-中的-publicPath\" class=\"headerlink\" title=\"module.rules 中的 publicPath\"></a>module.rules 中的 publicPath</h3><p>对于 url-loader 中的 outputPath，单独配置或者写在 name 里面，对于真实的目录结构来说，效果是一样的。但是在生成这个 cdn 路径上来说，效果是有区别的。最终的访问路径都是：publicPath+name。跟 outputPath 没有关系，所以，请注意路径配置。</p>\n<h3 id=\"mainFields\"><a href=\"#mainFields\" class=\"headerlink\" title=\"mainFields\"></a>mainFields</h3><p>有一些第三方模块会针对不同环境提供几分代码。 例如分别提供采用 ES5 和 ES6 的 2 份代码，这 2 份代码的位置写在 package.json 文件里，Webpack 会根据 mainFields 的配置去决定优先采用那份代码，mainFields 默认如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mainFields: [<span class=\"string\">&#x27;browser&#x27;</span>, <span class=\"string\">&#x27;main&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>Webpack 会按照数组里的顺序去 package.json 文件里寻找，只会使用找到的第一个。</p>\n<p>假如你想优先采用 ES6 的那份代码，可以这样配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mainFields: [&#39;jsnext:main&#39;, &#39;browser&#39;, &#39;main&#39;]</span><br></pre></td></tr></table></figure>\n\n<p>思考：这个可以用来配 vue 的 cdn 路径吗？dev 开发时 min.js 是无法调试的</p>\n<h3 id=\"babel-与-polyfill-的关系和区别\"><a href=\"#babel-与-polyfill-的关系和区别\" class=\"headerlink\" title=\"babel 与 polyfill 的关系和区别\"></a>babel 与 polyfill 的关系和区别</h3><h3 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h3><p>是一个广发使用的 ES6 的转码器，可以将 ES6 代码转为 ES5 代码。注意：babel 默认只转换新的 javascript 语法，而不转换新的 api<br>@babel-preset-env 就整合了这些语法转义插件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Using plugins:</span></span><br><span class=\"line\">transform-template-literals &#123;&#125;</span><br><span class=\"line\">transform-literals &#123;&#125;</span><br><span class=\"line\">transform-<span class=\"function\"><span class=\"keyword\">function</span>-<span class=\"title\">name</span> </span>&#123;&#125;</span><br><span class=\"line\">transform-arrow-functions &#123;&#125;</span><br><span class=\"line\">transform-block-scoped-functions &#123;&#125;</span><br><span class=\"line\">transform-classes &#123;&#125;</span><br><span class=\"line\">transform-object-<span class=\"built_in\">super</span> &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"polyfill\"><a href=\"#polyfill\" class=\"headerlink\" title=\"polyfill\"></a>polyfill</h3><p>Babel 默认只转换新的 JavaScript 句法（syntax），而不转换新的 API ，比如 Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise 等全局对象，以及一些定义在全局对象上的方法（比如 Object.assign）都不会转码。用于实现浏览器并不支持的原生 API 的代码<br>这样就导致了一些新的 API 老版浏览器不兼容。如上述所说，对于新的 API，你可能需要引入 @babel-polyfill 来进行兼容</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: [<span class=\"string\">&#x27;@babel-polyfill&#x27;</span>, <span class=\"string\">&#x27;./src/index.js&#x27;</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>yarn build 时发现文件体积大了很多，因为上面的代码表示将@babel-polyfill 的代码也打包进去，如何进行按需编译呢？在 JS 中 import @babel-polyfill</p>\n<p>修改.babelrc</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;presets&quot;</span>: [[<span class=\"string\">&quot;@babel/preset-env&quot;</span>, &#123; <span class=\"string\">&quot;useBuiltIns&quot;</span>: <span class=\"string\">&quot;usage&quot;</span> &#125;]]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用自动刷新\"><a href=\"#使用自动刷新\" class=\"headerlink\" title=\"使用自动刷新\"></a>使用自动刷新</h3><p>DecServer 刷新原理：<br>往要开发的网页中注入代理客户端代码，通过代理客户端去刷新整个页面。使用 webSocket 链接，双工通信</p>\n<p>webapck 要完全启用 HMR 需要使用 webpack.HotModuleReplacementPlugin。如果 webpack 或 webpack-dev-server 通过命令添加–hot 选项启动，这个插件会自动添加，所以不需要添加 HotModuleReplacementPlugin 到 webpack.config.js 中。</p>\n<p>但是，经实际使用 webpack-dev-server 时发现，在 webpack.config.js 中仅仅配置了 devServer.hot:true，而未添加这个插件的状态下，仍然实现了 HMR。</p>\n<p>项目启动之后，会进行首次构建打包，控制台中会输出整个的构建过程，可以观察到一个 hash 值，每一次代码修改后，保存时都会在控制台上看到 hash 值更新。</p>\n<h3 id=\"webpack-watch\"><a href=\"#webpack-watch\" class=\"headerlink\" title=\"webpack watch\"></a>webpack watch</h3><p>在项目启动之后，Webpack 会通过 Compiler 类的 Run 方法开启编译构建过程，编译完成后，调用 Watch 方法监听文件变更，当文件发生变化，重新编译，编译完成之后继续监听。</p>\n<p>可以看出所谓模块热替换指的是页面在尽量不经过刷新的情况下将页面所引用的 js 或 css 等模块进行热替换。这里之所以说是尽量不经过刷新页面是因为 webpack 在热替换检查失败的情况会刷新整个页面。</p>\n<p><strong>问题：</strong><br>webpack-dev-server 好像是只监听 webpack.config.js 中 entry 入口下文件（如 js、css 等等）的变动，只有这些文件的变动才会触发实时编译打包与页面刷新，而对于不在 entry 入口下的 html 文件，却不进行监听与页面自动刷新。</p>\n<p><strong>解决方法：</strong></p>\n<p>添加参数 watchContentBase: true，目录 contentBase 目录下的 html 文件变化也可监听并刷新</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">devServer: &#123;</span><br><span class=\"line\">  port: <span class=\"number\">9000</span>,</span><br><span class=\"line\">  hot: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  contentBase: path.join(__dirname, <span class=\"string\">&#x27;/example&#x27;</span>), <span class=\"comment\">//本地服务器所加载文件的目录</span></span><br><span class=\"line\">  watchContentBase: <span class=\"literal\">true</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"devServer-watchContentBase\"><a href=\"#devServer-watchContentBase\" class=\"headerlink\" title=\"devServer.watchContentBase\"></a>devServer.watchContentBase</h3><p>告诉 dev-server 监听 [devServer.contentBase]（＃devservercontentbase）选项提供的文件。 默认情况下禁用。 启用后，文件更改将触发整个页面重新加载。</p>\n<h2 id=\"webpack-的整个打包流程\"><a href=\"#webpack-的整个打包流程\" class=\"headerlink\" title=\"webpack 的整个打包流程\"></a>webpack 的整个打包流程</h2><p>1、读取 webpack 的配置参数<br>2、启动 webpack，创建 compiler 对象并开始解析项目<br>3、从入口文件（entry）开始解析，并且找到其导入的依赖模块，递归遍历分析，形成依赖关系树<br>4、对不同的文件类型的依赖模块文件使用对应的 loader 进行编译，最终转为 javascript 文件<br>5、整个过程中 webpack 会通过发布订阅模式，向外抛出一些 hooks，而 webpack 的插件即可通过监听这些关键的节点，执行插件任务进而达到敢于输出结果的目的</p>\n<h2 id=\"站外资料链接\"><a href=\"#站外资料链接\" class=\"headerlink\" title=\"站外资料链接\"></a>站外资料链接</h2><p><a href=\"http://webpack.wuhaolin.cn/\">深入浅出 webpack</a></p>"},{"title":"一篇弄懂继承","date":"2018-01-18T02:17:34.000Z","_content":"\n继承的串联及扩展\n\n<!--more-->\n\n## 对象的三个特性：封装、继承、多态\n\n1. 封装：把客观事物抽象成类，并且类可以把自己的数据库和方法可让可信的类或者对象操作，对不可信的进行信息隐藏。这也是局部变量赋值 symbol 的应用场景\n2. 继承：继承指这样一种能力：它可以使用现有类的所有功能，并无需重新编写原来的类的情况下对这些功能进行扩展\n3. 多态：多态性是允许你将父对象设置成为一个或更多的他的子对象相等的技术，赋值之后，父对象就可以根据当前赋值它的子对象的特性以不同的方式运行。\\*\\*允许将子类类型的指针赋值给父类类型的指针。\n\n## 继承\n\n很多面向对象语言都支持两种继承：接口继承和实现继承。前者只继承方法签名，后者继承实际的方法。接口继承在 ECMScript 中是不可能的，因为函数没有签名。实现继承是 ECMScript 唯一支持的集成方法，而这主要是通过原型链实现。\n\n其基本思想就是通过原型继承多个引用类型的属性和方法\n\n常用继承：组合继承，寄生组合继承\n\njavascript 对象具有 “ 自有属性 ” 也有一些属性是从原型对象继承来的。\n有两种继承方式：\n\n1. 寄生函数继承（构造函数继承 (call/apply)），利用 call 继承父类上的属性，用子类的原型等于父类实例去继承父类的方法。缺点：调用父类两次，造成性能浪费。\n2. 原型链继承 ( 挂载到 prototype 属性上面 )。\n\n## new 操作符\n\nnew 的源码实现\n\n```javascript\nfunction myNew(fun) {\n  return function () {\n    // 创建一个新对象且将其隐式原型指向构造函数原型\n    let obj = {\n      __proto__: fun.prototype\n    }\n    // 执行构造函数\n    fun.call(obj, ...arguments)\n    // 返回该对象\n    return obj\n  }\n}\n\nfunction person(name, age) {\n  this.name = name\n  this.age = age\n}\nlet obj = myNew(person)('chen', 18) // {name: \"chen\", age: 18}\n```\n\n实例化的过程\n\n```javascript\nvar obj = {}\nobj._proto_ = Parent.prototype\nreturn obj\n```\n\n所以通过 Child.prototype = new Parent(),子类就可以得到父类共享方法\n\nnew 的过程如下：\n\n- 创建一个空对象 obj\n- 将创建的空对象的隐式原型指向其构造函数的显示原型\n- 使用 call 改变 this 的指向\n- 如果无返回值或者返回一个空对象值，则将 obj 返回作为新对象；如果返回值是一个新对象的话，那么直接返回该对象\n\n所以，在 new 的过程中，我们使用 call 改变了 this 的指向\n\n### 为什么不是 Child.prototype = Parent.prototype?\n\n看到一道题是这些写的，想着想着掉坑里了，因为原型链是通过*proto*去寻找属性和方法了，若是通过`Child.prototype = Parent.prototype`去绑定的话，那么之后所有继承都只能通过这种方式绑定，不能在通过 new，因为这里没有生成*proto*去构成原型链，这已经不是原型链了吧？顶多算是利用 prototype 的指针进行挂载\n\n我们想要的效果，是将 Parent.prototype 这个对象挂在 Child.prototype._proto_ 的这个属性上；\n\n## 关系判断\n\n- instanceof 判断是否为另一个对象的实例\n- isPrototypeOf() 判断对象是否存在另一个对象原型链上 Chtild.isPrototypeOf(Parent)\n- Object.getPrototypeOf() ES6 中新增的方法，用于获取子类的父类 Object.getPrototypeOf(child)==Parent //true\n\n## 寄生函数继承\n\n```javascript\nfunction Person(name, age, sex) {\n  this.name = name\n\n  this.age = age\n\n  this.sex = sex\n}\n\nfunction Student(name, age, sex, score) {\n  Person.call(this, name, age, sex)\n\n  this.score = score\n}\n\nStudent.prototype = new Person() // 这里改变了原型指向，实现继承\n\nvar stu = new Student('小明', 20, '男', 99) //创建了学生对象stu\n\nconsole.log(stu instanceof Student) // true\n\nconsole.log(stu instanceof Person) // true\n\nconsole.log(stu instanceof Object) // true\n```\n\n寄生函数继承：利用 call 继承父类上的属性，用一个干净的函数的原型去等于父类原型，再用子类的原型的等于干净函数的实例。\n\n## 原型链继承\n\n实例出来的是共用的\n\n```javascript\nfunction Parent() {\n  this.name = 'Parent1'\n  this.arr = [1, 2, 3, 4, 5]\n}\n\nParent.prototype.say = function () {\n  console.log(this.name)\n}\n\nfunction Child() {\n  this.m = [1, 2, 3]\n  this.type = 'Child1'\n}\n\nChild.prototype = new Parent()\n\nvar s1 = new Child()\nvar s2 = new Child()\ns1.m.push(4) //[1,2,3,4]\ns2.m.push(6) //[1,2,3,6]\ns1.arr.push(6)\nconsole.log(s1.arr) //[1,2,3,4,5,6]\nconsole.log(s2.arr) //[1,2,3,4,5,6]\n//他们俩是公用的\nconsole.log(s1.__proto__ === s2.__proto__) //true\n```\n\n## 构造函数继承\n\n```javascript\nfunction Parent(name) {\n  this.name = name\n  this.friends = ['A', 'B']\n}\nParent.prototype.say = function () {\n  log(this.name, this.friends)\n}\nfunction Person() {\n  Parent.apply(this, arguments)\n  // parent.say.bind(child, arguments)(); //child world\n  this.age = 23\n}\nvar p1 = new Person('nameA')\nvar p2 = new Person('nameB')\nlog(p1.name) //nameA\nlog(p2.name) //nameB\np1.friends.push('C')\np2.friends.push('D')\nlog(p1.friends) //[\"A\", \"B\", \"C\"]\nlog(p2.friends) //[\"A\", \"B\", \"D\"]\nlog(p1.say()) // Uncaught TypeError: p1.say is not a function\n```\n\n- 优点：子类可以向父类的构造函数中传参，子类实例中的引用类型属性互不干扰\n- 缺点：子类实例无法访问父类的原型（无法复用父类原型中的方法）\n\n## Object.create\n\n[Object.create——MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\n\n```javascript\n//polyfill\nif (typeof Object.create !== 'function') {\n  Object.create = function (proto, propertiesObject) {\n    if (typeof proto !== 'object' && typeof proto !== 'function') {\n      throw new TypeError('Object prototype may only be an Object: ' + proto)\n    } else if (proto === null) {\n      throw new Error(\n        \"This browser's implementation of Object.create is a shim and doesn't support 'null' as the first argument.\"\n      )\n    }\n\n    if (typeof propertiesObject !== 'undefined')\n      throw new Error(\n        \"This browser's implementation of Object.create is a shim and doesn't support a second argument.\"\n      )\n\n    function F() {}\n    F.prototype = proto //intanceof 的核心判断也是用的这句\n\n    return new F()\n  }\n}\n```\n\n## constructor 的作用\n\n实例的 constructor 指向创建实例的构造函数\n经典原型链继承\n\n```javascript\nfunction Father() {\n  this.color = ['red', 'green']\n}\nfunction Child() {\n  this.test = 1\n}\n/*\n在执行下面这一句之前 Child.prototype.constructor = Child\n执行下面这一句之后Child.prototype.constructor=Father;\n而Child.constructor自始至终都是Function，因为Child是自接由Function字面量定义的\n*/\nChild.prototype = new Father()\nChild.prototype.constructor = Child\n\nlet instance = new Child()\n```\n\n上面的代码中`Child.prototype.constructor = Child`的意义是什么呢？我们访问属性都是按照原型链查找的，为什么还需要这一句？看了有些解释是说要尽量让对象指向其构造函数，以维持这个惯例\n\n还可以将实例的构造器的原型对象暴露出来，比如写了一个插件，别人得到的是实例化后的对象，若是别人想扩展对象就可以用 instance.constructor.prototype 去修改或扩展原型对象\n","source":"_posts/一篇弄懂继承.md","raw":"---\ntitle: 一篇弄懂继承\ndate: 2018-01-18 10:17:34\ncategories: JavaScript\n---\n\n继承的串联及扩展\n\n<!--more-->\n\n## 对象的三个特性：封装、继承、多态\n\n1. 封装：把客观事物抽象成类，并且类可以把自己的数据库和方法可让可信的类或者对象操作，对不可信的进行信息隐藏。这也是局部变量赋值 symbol 的应用场景\n2. 继承：继承指这样一种能力：它可以使用现有类的所有功能，并无需重新编写原来的类的情况下对这些功能进行扩展\n3. 多态：多态性是允许你将父对象设置成为一个或更多的他的子对象相等的技术，赋值之后，父对象就可以根据当前赋值它的子对象的特性以不同的方式运行。\\*\\*允许将子类类型的指针赋值给父类类型的指针。\n\n## 继承\n\n很多面向对象语言都支持两种继承：接口继承和实现继承。前者只继承方法签名，后者继承实际的方法。接口继承在 ECMScript 中是不可能的，因为函数没有签名。实现继承是 ECMScript 唯一支持的集成方法，而这主要是通过原型链实现。\n\n其基本思想就是通过原型继承多个引用类型的属性和方法\n\n常用继承：组合继承，寄生组合继承\n\njavascript 对象具有 “ 自有属性 ” 也有一些属性是从原型对象继承来的。\n有两种继承方式：\n\n1. 寄生函数继承（构造函数继承 (call/apply)），利用 call 继承父类上的属性，用子类的原型等于父类实例去继承父类的方法。缺点：调用父类两次，造成性能浪费。\n2. 原型链继承 ( 挂载到 prototype 属性上面 )。\n\n## new 操作符\n\nnew 的源码实现\n\n```javascript\nfunction myNew(fun) {\n  return function () {\n    // 创建一个新对象且将其隐式原型指向构造函数原型\n    let obj = {\n      __proto__: fun.prototype\n    }\n    // 执行构造函数\n    fun.call(obj, ...arguments)\n    // 返回该对象\n    return obj\n  }\n}\n\nfunction person(name, age) {\n  this.name = name\n  this.age = age\n}\nlet obj = myNew(person)('chen', 18) // {name: \"chen\", age: 18}\n```\n\n实例化的过程\n\n```javascript\nvar obj = {}\nobj._proto_ = Parent.prototype\nreturn obj\n```\n\n所以通过 Child.prototype = new Parent(),子类就可以得到父类共享方法\n\nnew 的过程如下：\n\n- 创建一个空对象 obj\n- 将创建的空对象的隐式原型指向其构造函数的显示原型\n- 使用 call 改变 this 的指向\n- 如果无返回值或者返回一个空对象值，则将 obj 返回作为新对象；如果返回值是一个新对象的话，那么直接返回该对象\n\n所以，在 new 的过程中，我们使用 call 改变了 this 的指向\n\n### 为什么不是 Child.prototype = Parent.prototype?\n\n看到一道题是这些写的，想着想着掉坑里了，因为原型链是通过*proto*去寻找属性和方法了，若是通过`Child.prototype = Parent.prototype`去绑定的话，那么之后所有继承都只能通过这种方式绑定，不能在通过 new，因为这里没有生成*proto*去构成原型链，这已经不是原型链了吧？顶多算是利用 prototype 的指针进行挂载\n\n我们想要的效果，是将 Parent.prototype 这个对象挂在 Child.prototype._proto_ 的这个属性上；\n\n## 关系判断\n\n- instanceof 判断是否为另一个对象的实例\n- isPrototypeOf() 判断对象是否存在另一个对象原型链上 Chtild.isPrototypeOf(Parent)\n- Object.getPrototypeOf() ES6 中新增的方法，用于获取子类的父类 Object.getPrototypeOf(child)==Parent //true\n\n## 寄生函数继承\n\n```javascript\nfunction Person(name, age, sex) {\n  this.name = name\n\n  this.age = age\n\n  this.sex = sex\n}\n\nfunction Student(name, age, sex, score) {\n  Person.call(this, name, age, sex)\n\n  this.score = score\n}\n\nStudent.prototype = new Person() // 这里改变了原型指向，实现继承\n\nvar stu = new Student('小明', 20, '男', 99) //创建了学生对象stu\n\nconsole.log(stu instanceof Student) // true\n\nconsole.log(stu instanceof Person) // true\n\nconsole.log(stu instanceof Object) // true\n```\n\n寄生函数继承：利用 call 继承父类上的属性，用一个干净的函数的原型去等于父类原型，再用子类的原型的等于干净函数的实例。\n\n## 原型链继承\n\n实例出来的是共用的\n\n```javascript\nfunction Parent() {\n  this.name = 'Parent1'\n  this.arr = [1, 2, 3, 4, 5]\n}\n\nParent.prototype.say = function () {\n  console.log(this.name)\n}\n\nfunction Child() {\n  this.m = [1, 2, 3]\n  this.type = 'Child1'\n}\n\nChild.prototype = new Parent()\n\nvar s1 = new Child()\nvar s2 = new Child()\ns1.m.push(4) //[1,2,3,4]\ns2.m.push(6) //[1,2,3,6]\ns1.arr.push(6)\nconsole.log(s1.arr) //[1,2,3,4,5,6]\nconsole.log(s2.arr) //[1,2,3,4,5,6]\n//他们俩是公用的\nconsole.log(s1.__proto__ === s2.__proto__) //true\n```\n\n## 构造函数继承\n\n```javascript\nfunction Parent(name) {\n  this.name = name\n  this.friends = ['A', 'B']\n}\nParent.prototype.say = function () {\n  log(this.name, this.friends)\n}\nfunction Person() {\n  Parent.apply(this, arguments)\n  // parent.say.bind(child, arguments)(); //child world\n  this.age = 23\n}\nvar p1 = new Person('nameA')\nvar p2 = new Person('nameB')\nlog(p1.name) //nameA\nlog(p2.name) //nameB\np1.friends.push('C')\np2.friends.push('D')\nlog(p1.friends) //[\"A\", \"B\", \"C\"]\nlog(p2.friends) //[\"A\", \"B\", \"D\"]\nlog(p1.say()) // Uncaught TypeError: p1.say is not a function\n```\n\n- 优点：子类可以向父类的构造函数中传参，子类实例中的引用类型属性互不干扰\n- 缺点：子类实例无法访问父类的原型（无法复用父类原型中的方法）\n\n## Object.create\n\n[Object.create——MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\n\n```javascript\n//polyfill\nif (typeof Object.create !== 'function') {\n  Object.create = function (proto, propertiesObject) {\n    if (typeof proto !== 'object' && typeof proto !== 'function') {\n      throw new TypeError('Object prototype may only be an Object: ' + proto)\n    } else if (proto === null) {\n      throw new Error(\n        \"This browser's implementation of Object.create is a shim and doesn't support 'null' as the first argument.\"\n      )\n    }\n\n    if (typeof propertiesObject !== 'undefined')\n      throw new Error(\n        \"This browser's implementation of Object.create is a shim and doesn't support a second argument.\"\n      )\n\n    function F() {}\n    F.prototype = proto //intanceof 的核心判断也是用的这句\n\n    return new F()\n  }\n}\n```\n\n## constructor 的作用\n\n实例的 constructor 指向创建实例的构造函数\n经典原型链继承\n\n```javascript\nfunction Father() {\n  this.color = ['red', 'green']\n}\nfunction Child() {\n  this.test = 1\n}\n/*\n在执行下面这一句之前 Child.prototype.constructor = Child\n执行下面这一句之后Child.prototype.constructor=Father;\n而Child.constructor自始至终都是Function，因为Child是自接由Function字面量定义的\n*/\nChild.prototype = new Father()\nChild.prototype.constructor = Child\n\nlet instance = new Child()\n```\n\n上面的代码中`Child.prototype.constructor = Child`的意义是什么呢？我们访问属性都是按照原型链查找的，为什么还需要这一句？看了有些解释是说要尽量让对象指向其构造函数，以维持这个惯例\n\n还可以将实例的构造器的原型对象暴露出来，比如写了一个插件，别人得到的是实例化后的对象，若是别人想扩展对象就可以用 instance.constructor.prototype 去修改或扩展原型对象\n","slug":"一篇弄懂继承","published":1,"updated":"2021-04-25T10:46:12.519Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x8001zl5v0g2117n26","content":"<p>继承的串联及扩展</p>\n<span id=\"more\"></span>\n\n<h2 id=\"对象的三个特性：封装、继承、多态\"><a href=\"#对象的三个特性：封装、继承、多态\" class=\"headerlink\" title=\"对象的三个特性：封装、继承、多态\"></a>对象的三个特性：封装、继承、多态</h2><ol>\n<li>封装：把客观事物抽象成类，并且类可以把自己的数据库和方法可让可信的类或者对象操作，对不可信的进行信息隐藏。这也是局部变量赋值 symbol 的应用场景</li>\n<li>继承：继承指这样一种能力：它可以使用现有类的所有功能，并无需重新编写原来的类的情况下对这些功能进行扩展</li>\n<li>多态：多态性是允许你将父对象设置成为一个或更多的他的子对象相等的技术，赋值之后，父对象就可以根据当前赋值它的子对象的特性以不同的方式运行。**允许将子类类型的指针赋值给父类类型的指针。</li>\n</ol>\n<h2 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h2><p>很多面向对象语言都支持两种继承：接口继承和实现继承。前者只继承方法签名，后者继承实际的方法。接口继承在 ECMScript 中是不可能的，因为函数没有签名。实现继承是 ECMScript 唯一支持的集成方法，而这主要是通过原型链实现。</p>\n<p>其基本思想就是通过原型继承多个引用类型的属性和方法</p>\n<p>常用继承：组合继承，寄生组合继承</p>\n<p>javascript 对象具有 “ 自有属性 ” 也有一些属性是从原型对象继承来的。<br>有两种继承方式：</p>\n<ol>\n<li>寄生函数继承（构造函数继承 (call/apply)），利用 call 继承父类上的属性，用子类的原型等于父类实例去继承父类的方法。缺点：调用父类两次，造成性能浪费。</li>\n<li>原型链继承 ( 挂载到 prototype 属性上面 )。</li>\n</ol>\n<h2 id=\"new-操作符\"><a href=\"#new-操作符\" class=\"headerlink\" title=\"new 操作符\"></a>new 操作符</h2><p>new 的源码实现</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myNew</span>(<span class=\"params\">fun</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建一个新对象且将其隐式原型指向构造函数原型</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">      __proto__: fun.prototype</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 执行构造函数</span></span><br><span class=\"line\">    fun.call(obj, ...arguments)</span><br><span class=\"line\">    <span class=\"comment\">// 返回该对象</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">person</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = myNew(person)(<span class=\"string\">&#x27;chen&#x27;</span>, <span class=\"number\">18</span>) <span class=\"comment\">// &#123;name: &quot;chen&quot;, age: 18&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>实例化的过程</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;&#125;</span><br><span class=\"line\">obj._proto_ = Parent.prototype</span><br><span class=\"line\"><span class=\"keyword\">return</span> obj</span><br></pre></td></tr></table></figure>\n\n<p>所以通过 Child.prototype = new Parent(),子类就可以得到父类共享方法</p>\n<p>new 的过程如下：</p>\n<ul>\n<li>创建一个空对象 obj</li>\n<li>将创建的空对象的隐式原型指向其构造函数的显示原型</li>\n<li>使用 call 改变 this 的指向</li>\n<li>如果无返回值或者返回一个空对象值，则将 obj 返回作为新对象；如果返回值是一个新对象的话，那么直接返回该对象</li>\n</ul>\n<p>所以，在 new 的过程中，我们使用 call 改变了 this 的指向</p>\n<h3 id=\"为什么不是-Child-prototype-Parent-prototype\"><a href=\"#为什么不是-Child-prototype-Parent-prototype\" class=\"headerlink\" title=\"为什么不是 Child.prototype = Parent.prototype?\"></a>为什么不是 Child.prototype = Parent.prototype?</h3><p>看到一道题是这些写的，想着想着掉坑里了，因为原型链是通过<em>proto</em>去寻找属性和方法了，若是通过<code>Child.prototype = Parent.prototype</code>去绑定的话，那么之后所有继承都只能通过这种方式绑定，不能在通过 new，因为这里没有生成<em>proto</em>去构成原型链，这已经不是原型链了吧？顶多算是利用 prototype 的指针进行挂载</p>\n<p>我们想要的效果，是将 Parent.prototype 这个对象挂在 Child.prototype.<em>proto</em> 的这个属性上；</p>\n<h2 id=\"关系判断\"><a href=\"#关系判断\" class=\"headerlink\" title=\"关系判断\"></a>关系判断</h2><ul>\n<li>instanceof 判断是否为另一个对象的实例</li>\n<li>isPrototypeOf() 判断对象是否存在另一个对象原型链上 Chtild.isPrototypeOf(Parent)</li>\n<li>Object.getPrototypeOf() ES6 中新增的方法，用于获取子类的父类 Object.getPrototypeOf(child)==Parent //true</li>\n</ul>\n<h2 id=\"寄生函数继承\"><a href=\"#寄生函数继承\" class=\"headerlink\" title=\"寄生函数继承\"></a>寄生函数继承</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, sex</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sex = sex</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Student</span>(<span class=\"params\">name, age, sex, score</span>) </span>&#123;</span><br><span class=\"line\">  Person.call(<span class=\"built_in\">this</span>, name, age, sex)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.score = score</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Student.prototype = <span class=\"keyword\">new</span> Person() <span class=\"comment\">// 这里改变了原型指向，实现继承</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = <span class=\"keyword\">new</span> Student(<span class=\"string\">&#x27;小明&#x27;</span>, <span class=\"number\">20</span>, <span class=\"string\">&#x27;男&#x27;</span>, <span class=\"number\">99</span>) <span class=\"comment\">//创建了学生对象stu</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stu <span class=\"keyword\">instanceof</span> Student) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stu <span class=\"keyword\">instanceof</span> Person) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stu <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>寄生函数继承：利用 call 继承父类上的属性，用一个干净的函数的原型去等于父类原型，再用子类的原型的等于干净函数的实例。</p>\n<h2 id=\"原型链继承\"><a href=\"#原型链继承\" class=\"headerlink\" title=\"原型链继承\"></a>原型链继承</h2><p>实例出来的是共用的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Parent</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;Parent1&#x27;</span></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Parent.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Child</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.m = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.type = <span class=\"string\">&#x27;Child1&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Child.prototype = <span class=\"keyword\">new</span> Parent()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> s1 = <span class=\"keyword\">new</span> Child()</span><br><span class=\"line\"><span class=\"keyword\">var</span> s2 = <span class=\"keyword\">new</span> Child()</span><br><span class=\"line\">s1.m.push(<span class=\"number\">4</span>) <span class=\"comment\">//[1,2,3,4]</span></span><br><span class=\"line\">s2.m.push(<span class=\"number\">6</span>) <span class=\"comment\">//[1,2,3,6]</span></span><br><span class=\"line\">s1.arr.push(<span class=\"number\">6</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(s1.arr) <span class=\"comment\">//[1,2,3,4,5,6]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(s2.arr) <span class=\"comment\">//[1,2,3,4,5,6]</span></span><br><span class=\"line\"><span class=\"comment\">//他们俩是公用的</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(s1.__proto__ === s2.__proto__) <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构造函数继承\"><a href=\"#构造函数继承\" class=\"headerlink\" title=\"构造函数继承\"></a>构造函数继承</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Parent</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.friends = [<span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Parent.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  log(<span class=\"built_in\">this</span>.name, <span class=\"built_in\">this</span>.friends)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  Parent.apply(<span class=\"built_in\">this</span>, <span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  <span class=\"comment\">// parent.say.bind(child, arguments)(); //child world</span></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = <span class=\"number\">23</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;nameA&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;nameB&#x27;</span>)</span><br><span class=\"line\">log(p1.name) <span class=\"comment\">//nameA</span></span><br><span class=\"line\">log(p2.name) <span class=\"comment\">//nameB</span></span><br><span class=\"line\">p1.friends.push(<span class=\"string\">&#x27;C&#x27;</span>)</span><br><span class=\"line\">p2.friends.push(<span class=\"string\">&#x27;D&#x27;</span>)</span><br><span class=\"line\">log(p1.friends) <span class=\"comment\">//[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</span></span><br><span class=\"line\">log(p2.friends) <span class=\"comment\">//[&quot;A&quot;, &quot;B&quot;, &quot;D&quot;]</span></span><br><span class=\"line\">log(p1.say()) <span class=\"comment\">// Uncaught TypeError: p1.say is not a function</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>优点：子类可以向父类的构造函数中传参，子类实例中的引用类型属性互不干扰</li>\n<li>缺点：子类实例无法访问父类的原型（无法复用父类原型中的方法）</li>\n</ul>\n<h2 id=\"Object-create\"><a href=\"#Object-create\" class=\"headerlink\" title=\"Object.create\"></a>Object.create</h2><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create\">Object.create——MDN</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//polyfill</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">Object</span>.create !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Object</span>.create = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">proto, propertiesObject</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> proto !== <span class=\"string\">&#x27;object&#x27;</span> &amp;&amp; <span class=\"keyword\">typeof</span> proto !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">&#x27;Object prototype may only be an Object: &#x27;</span> + proto)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (proto === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;This browser&#x27;s implementation of Object.create is a shim and doesn&#x27;t support &#x27;null&#x27; as the first argument.&quot;</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> propertiesObject !== <span class=\"string\">&#x27;undefined&#x27;</span>)</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;This browser&#x27;s implementation of Object.create is a shim and doesn&#x27;t support a second argument.&quot;</span></span><br><span class=\"line\">      )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">    F.prototype = proto <span class=\"comment\">//intanceof 的核心判断也是用的这句</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"constructor-的作用\"><a href=\"#constructor-的作用\" class=\"headerlink\" title=\"constructor 的作用\"></a>constructor 的作用</h2><p>实例的 constructor 指向创建实例的构造函数<br>经典原型链继承</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Father</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.color = [<span class=\"string\">&#x27;red&#x27;</span>, <span class=\"string\">&#x27;green&#x27;</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Child</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.test = <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">在执行下面这一句之前 Child.prototype.constructor = Child</span></span><br><span class=\"line\"><span class=\"comment\">执行下面这一句之后Child.prototype.constructor=Father;</span></span><br><span class=\"line\"><span class=\"comment\">而Child.constructor自始至终都是Function，因为Child是自接由Function字面量定义的</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">Child.prototype = <span class=\"keyword\">new</span> Father()</span><br><span class=\"line\">Child.prototype.constructor = Child</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> instance = <span class=\"keyword\">new</span> Child()</span><br></pre></td></tr></table></figure>\n\n<p>上面的代码中<code>Child.prototype.constructor = Child</code>的意义是什么呢？我们访问属性都是按照原型链查找的，为什么还需要这一句？看了有些解释是说要尽量让对象指向其构造函数，以维持这个惯例</p>\n<p>还可以将实例的构造器的原型对象暴露出来，比如写了一个插件，别人得到的是实例化后的对象，若是别人想扩展对象就可以用 instance.constructor.prototype 去修改或扩展原型对象</p>\n","site":{"data":{}},"excerpt":"<p>继承的串联及扩展</p>","more":"<h2 id=\"对象的三个特性：封装、继承、多态\"><a href=\"#对象的三个特性：封装、继承、多态\" class=\"headerlink\" title=\"对象的三个特性：封装、继承、多态\"></a>对象的三个特性：封装、继承、多态</h2><ol>\n<li>封装：把客观事物抽象成类，并且类可以把自己的数据库和方法可让可信的类或者对象操作，对不可信的进行信息隐藏。这也是局部变量赋值 symbol 的应用场景</li>\n<li>继承：继承指这样一种能力：它可以使用现有类的所有功能，并无需重新编写原来的类的情况下对这些功能进行扩展</li>\n<li>多态：多态性是允许你将父对象设置成为一个或更多的他的子对象相等的技术，赋值之后，父对象就可以根据当前赋值它的子对象的特性以不同的方式运行。**允许将子类类型的指针赋值给父类类型的指针。</li>\n</ol>\n<h2 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h2><p>很多面向对象语言都支持两种继承：接口继承和实现继承。前者只继承方法签名，后者继承实际的方法。接口继承在 ECMScript 中是不可能的，因为函数没有签名。实现继承是 ECMScript 唯一支持的集成方法，而这主要是通过原型链实现。</p>\n<p>其基本思想就是通过原型继承多个引用类型的属性和方法</p>\n<p>常用继承：组合继承，寄生组合继承</p>\n<p>javascript 对象具有 “ 自有属性 ” 也有一些属性是从原型对象继承来的。<br>有两种继承方式：</p>\n<ol>\n<li>寄生函数继承（构造函数继承 (call/apply)），利用 call 继承父类上的属性，用子类的原型等于父类实例去继承父类的方法。缺点：调用父类两次，造成性能浪费。</li>\n<li>原型链继承 ( 挂载到 prototype 属性上面 )。</li>\n</ol>\n<h2 id=\"new-操作符\"><a href=\"#new-操作符\" class=\"headerlink\" title=\"new 操作符\"></a>new 操作符</h2><p>new 的源码实现</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myNew</span>(<span class=\"params\">fun</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建一个新对象且将其隐式原型指向构造函数原型</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">      __proto__: fun.prototype</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 执行构造函数</span></span><br><span class=\"line\">    fun.call(obj, ...arguments)</span><br><span class=\"line\">    <span class=\"comment\">// 返回该对象</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">person</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = myNew(person)(<span class=\"string\">&#x27;chen&#x27;</span>, <span class=\"number\">18</span>) <span class=\"comment\">// &#123;name: &quot;chen&quot;, age: 18&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>实例化的过程</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;&#125;</span><br><span class=\"line\">obj._proto_ = Parent.prototype</span><br><span class=\"line\"><span class=\"keyword\">return</span> obj</span><br></pre></td></tr></table></figure>\n\n<p>所以通过 Child.prototype = new Parent(),子类就可以得到父类共享方法</p>\n<p>new 的过程如下：</p>\n<ul>\n<li>创建一个空对象 obj</li>\n<li>将创建的空对象的隐式原型指向其构造函数的显示原型</li>\n<li>使用 call 改变 this 的指向</li>\n<li>如果无返回值或者返回一个空对象值，则将 obj 返回作为新对象；如果返回值是一个新对象的话，那么直接返回该对象</li>\n</ul>\n<p>所以，在 new 的过程中，我们使用 call 改变了 this 的指向</p>\n<h3 id=\"为什么不是-Child-prototype-Parent-prototype\"><a href=\"#为什么不是-Child-prototype-Parent-prototype\" class=\"headerlink\" title=\"为什么不是 Child.prototype = Parent.prototype?\"></a>为什么不是 Child.prototype = Parent.prototype?</h3><p>看到一道题是这些写的，想着想着掉坑里了，因为原型链是通过<em>proto</em>去寻找属性和方法了，若是通过<code>Child.prototype = Parent.prototype</code>去绑定的话，那么之后所有继承都只能通过这种方式绑定，不能在通过 new，因为这里没有生成<em>proto</em>去构成原型链，这已经不是原型链了吧？顶多算是利用 prototype 的指针进行挂载</p>\n<p>我们想要的效果，是将 Parent.prototype 这个对象挂在 Child.prototype.<em>proto</em> 的这个属性上；</p>\n<h2 id=\"关系判断\"><a href=\"#关系判断\" class=\"headerlink\" title=\"关系判断\"></a>关系判断</h2><ul>\n<li>instanceof 判断是否为另一个对象的实例</li>\n<li>isPrototypeOf() 判断对象是否存在另一个对象原型链上 Chtild.isPrototypeOf(Parent)</li>\n<li>Object.getPrototypeOf() ES6 中新增的方法，用于获取子类的父类 Object.getPrototypeOf(child)==Parent //true</li>\n</ul>\n<h2 id=\"寄生函数继承\"><a href=\"#寄生函数继承\" class=\"headerlink\" title=\"寄生函数继承\"></a>寄生函数继承</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, sex</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sex = sex</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Student</span>(<span class=\"params\">name, age, sex, score</span>) </span>&#123;</span><br><span class=\"line\">  Person.call(<span class=\"built_in\">this</span>, name, age, sex)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.score = score</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Student.prototype = <span class=\"keyword\">new</span> Person() <span class=\"comment\">// 这里改变了原型指向，实现继承</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = <span class=\"keyword\">new</span> Student(<span class=\"string\">&#x27;小明&#x27;</span>, <span class=\"number\">20</span>, <span class=\"string\">&#x27;男&#x27;</span>, <span class=\"number\">99</span>) <span class=\"comment\">//创建了学生对象stu</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stu <span class=\"keyword\">instanceof</span> Student) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stu <span class=\"keyword\">instanceof</span> Person) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(stu <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>寄生函数继承：利用 call 继承父类上的属性，用一个干净的函数的原型去等于父类原型，再用子类的原型的等于干净函数的实例。</p>\n<h2 id=\"原型链继承\"><a href=\"#原型链继承\" class=\"headerlink\" title=\"原型链继承\"></a>原型链继承</h2><p>实例出来的是共用的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Parent</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;Parent1&#x27;</span></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Parent.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Child</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.m = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.type = <span class=\"string\">&#x27;Child1&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Child.prototype = <span class=\"keyword\">new</span> Parent()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> s1 = <span class=\"keyword\">new</span> Child()</span><br><span class=\"line\"><span class=\"keyword\">var</span> s2 = <span class=\"keyword\">new</span> Child()</span><br><span class=\"line\">s1.m.push(<span class=\"number\">4</span>) <span class=\"comment\">//[1,2,3,4]</span></span><br><span class=\"line\">s2.m.push(<span class=\"number\">6</span>) <span class=\"comment\">//[1,2,3,6]</span></span><br><span class=\"line\">s1.arr.push(<span class=\"number\">6</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(s1.arr) <span class=\"comment\">//[1,2,3,4,5,6]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(s2.arr) <span class=\"comment\">//[1,2,3,4,5,6]</span></span><br><span class=\"line\"><span class=\"comment\">//他们俩是公用的</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(s1.__proto__ === s2.__proto__) <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构造函数继承\"><a href=\"#构造函数继承\" class=\"headerlink\" title=\"构造函数继承\"></a>构造函数继承</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Parent</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.friends = [<span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Parent.prototype.say = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  log(<span class=\"built_in\">this</span>.name, <span class=\"built_in\">this</span>.friends)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  Parent.apply(<span class=\"built_in\">this</span>, <span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  <span class=\"comment\">// parent.say.bind(child, arguments)(); //child world</span></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = <span class=\"number\">23</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;nameA&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> p2 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;nameB&#x27;</span>)</span><br><span class=\"line\">log(p1.name) <span class=\"comment\">//nameA</span></span><br><span class=\"line\">log(p2.name) <span class=\"comment\">//nameB</span></span><br><span class=\"line\">p1.friends.push(<span class=\"string\">&#x27;C&#x27;</span>)</span><br><span class=\"line\">p2.friends.push(<span class=\"string\">&#x27;D&#x27;</span>)</span><br><span class=\"line\">log(p1.friends) <span class=\"comment\">//[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</span></span><br><span class=\"line\">log(p2.friends) <span class=\"comment\">//[&quot;A&quot;, &quot;B&quot;, &quot;D&quot;]</span></span><br><span class=\"line\">log(p1.say()) <span class=\"comment\">// Uncaught TypeError: p1.say is not a function</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>优点：子类可以向父类的构造函数中传参，子类实例中的引用类型属性互不干扰</li>\n<li>缺点：子类实例无法访问父类的原型（无法复用父类原型中的方法）</li>\n</ul>\n<h2 id=\"Object-create\"><a href=\"#Object-create\" class=\"headerlink\" title=\"Object.create\"></a>Object.create</h2><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create\">Object.create——MDN</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//polyfill</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">Object</span>.create !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Object</span>.create = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">proto, propertiesObject</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> proto !== <span class=\"string\">&#x27;object&#x27;</span> &amp;&amp; <span class=\"keyword\">typeof</span> proto !== <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">&#x27;Object prototype may only be an Object: &#x27;</span> + proto)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (proto === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;This browser&#x27;s implementation of Object.create is a shim and doesn&#x27;t support &#x27;null&#x27; as the first argument.&quot;</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> propertiesObject !== <span class=\"string\">&#x27;undefined&#x27;</span>)</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;This browser&#x27;s implementation of Object.create is a shim and doesn&#x27;t support a second argument.&quot;</span></span><br><span class=\"line\">      )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\">    F.prototype = proto <span class=\"comment\">//intanceof 的核心判断也是用的这句</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"constructor-的作用\"><a href=\"#constructor-的作用\" class=\"headerlink\" title=\"constructor 的作用\"></a>constructor 的作用</h2><p>实例的 constructor 指向创建实例的构造函数<br>经典原型链继承</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Father</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.color = [<span class=\"string\">&#x27;red&#x27;</span>, <span class=\"string\">&#x27;green&#x27;</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Child</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.test = <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">在执行下面这一句之前 Child.prototype.constructor = Child</span></span><br><span class=\"line\"><span class=\"comment\">执行下面这一句之后Child.prototype.constructor=Father;</span></span><br><span class=\"line\"><span class=\"comment\">而Child.constructor自始至终都是Function，因为Child是自接由Function字面量定义的</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">Child.prototype = <span class=\"keyword\">new</span> Father()</span><br><span class=\"line\">Child.prototype.constructor = Child</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> instance = <span class=\"keyword\">new</span> Child()</span><br></pre></td></tr></table></figure>\n\n<p>上面的代码中<code>Child.prototype.constructor = Child</code>的意义是什么呢？我们访问属性都是按照原型链查找的，为什么还需要这一句？看了有些解释是说要尽量让对象指向其构造函数，以维持这个惯例</p>\n<p>还可以将实例的构造器的原型对象暴露出来，比如写了一个插件，别人得到的是实例化后的对象，若是别人想扩展对象就可以用 instance.constructor.prototype 去修改或扩展原型对象</p>"},{"title":"了解Fetch api","date":"2020-09-26T16:00:00.000Z","_content":"\n提及与服务器的异步通信，离不开 Ajax，实际上 Ajax 并非指某一项具体的技术，它主要是基于用脚本操作 HTTP 请求的 Web 应用架构。\n\n在 Ajax 中涉及到的 JavaScript 方面的技术，即 XMLHttpRequest(以下简称 XHR)，至今我们基本都是通过 XHR 与服务器简历异步通信，在设计上将输入、输出和事件监听混杂在一个对象里，且必须通过实例化方式来发请求。配置和调用方式混乱，不符合关注分点离原则。\n\n直到 Fetch API 的提出，前端和服务器端的异步通信方面更进了一步。\n\n<!--more-->\n\n## 什么是 Fetch\n\nFetch API 是近年来被提及将要取代 XHR 的技术新标准，是一个 HTML5 的 API。\n\nFetch 并不是 XHR 的升级版本，而是从一个全新的角度来思考的一种设计。Fetch 是基于 Promise 语法结构，而且它的设计足够低阶，这表示它可以在实际需求中进行更多的弹性设计。对于 XHR 所提供的能力来说，Fetch 已经足够取代 XHR ，并且提供了更多拓展的可能性。\n\nFetch 的核心在于对 HTTP 接口的抽象，包括 Request，Response，Headers，Body，以及用于初始化异步请求的 global fetch。\n\n## 如何使用 Fetch\n\nFetch API 规范明确了用户代理获取资源的语义。原生支持 Promise1，调用方便，符合语义化。可配合使用 ES2016 中的 async / await 语法，更加优雅。\n\n通过一个例子来快速了解和使用 Fetch API 最基本的用法\n\n```javascript\n// 获取 some.json 资源\nfetch('some.json')\n  .then(function(response) {\n    return response.json();\n  })\n  .then(function(data) {\n    console.log('data', data);\n  })\n  .catch(function(error) {\n    console.log('Fetch Error: ', error);\n  });\n\n// 采用ES2016的 async/await 语法\nasync function() {\n  try {\n    const response = await fetch('some.json');\n    const data = await response.json();\n    console.log('data', data);\n  } catch (error) {\n    console.log('Fetch Error: ', error)\n  }\n}\n```\n\n可以简单理解为，Fetch API 是面向未来的异步通信 API。通过例子我们可以发现，使用 Fetch API 能够快速便捷地进行资源地获取。\n\n## 具体用法\n\nfetch 方法有两种调用方式。\n\n```javascript\nPromise fetch(String url, [, Object options])\nPromise fetch(Request req, [, Object options])\n```\n\n- 第一个参数是一个 Request 对象，第二个参数是配置信息，可选\n- 第一个参数是一个 url，第二个参数是配置信息，可选\n  可选配置信息是一个 Object 对象，可以包含以下字段：\n- method: 请求的方法，例如：GET,POST。\n- headers: 请求头部信息，可以是一个简单的对象，也可以是 Headers 类实例化的一个对象。\n- body: 需要发送的信息内容，可以是 Blob,BufferSource,FormData,URLSearchParams 或者 USVString。注意，GET,HEAD 方法不能包含 body。\n- mode: 请求模式，分别有 cors,no-cors,same-origin,navigate 这几个可选值。\n  - cors: 允许跨域，要求响应中 Acess-Control-Allow-Origin 这样的头部表示允许跨域。\n  - no-cors: 只允许使用 HEAD,GET,POST 方法。\n  - same-origin: 只允许同源请求，否则直接报错。\n  - navigate: 支持页面导航。\n- credentials: 表示是否发送 cookie，有三个选项\n  - omit: 不发送 cookie。\n  - same-origin: 仅在同源时发送 cookie。\n  - include: 发送 cookie。\n- cache: 表示处理缓存的策略。\n- redirect: 表示发生重定向时，有三个选项\n  - follow: 跟随。\n  - error: 发生错误。\n  - manual: 需要用户手动跟随。\n- integrity: 包含一个用于验证资资源完整性的字符串。\n\n### Headers\n\nHeaders 可用来表示 HTTP 的头部信息，使用 Headers 的接口，你可以通过 Headers() 构造函数来创建一个你自己的 headers 对象。\n\n```javascript\nvar headers = new Headers({\n  'Content-Type': 'text/plain',\n  'Content-Length': content.length.toString(),\n  'X-Custom-Header': 'ProcessThisImmediately'\n})\nheaders.append('X-Custom-Header', 'AnotherValue')\nheaders.has('Content-Type') // true\nheaders.getAll('X-Custom-Header') // [\"ProcessThisImmediately\", \"AnotherValue\"]\n```\n\nHeaders 提供 append, delete, get, getAll, has, set, forEach 等这些实例方法，可供开发者更加灵活地配置请求中的 headers。\n\n### Request\n\n```javascript\nvar URL = '//api.some.com'\nvar getReq = new Request(URL, { method: 'GET', cache: 'reload' })\nfetch(getReq)\n  .then(function (response) {\n    return response.json()\n  })\n  .catch(function (error) {\n    console.log('Fetch Error: ', error)\n  })\n```\n\nRequest 接口中的配置项 headers 可以是实例化的 Headers 。\n\n```javascript\nvar URL = '//api.some.com'\n// 实例化 Headers\nvar headers = new Headers({\n  'Content-Type': 'text/plain',\n  'Content-Length': content.length.toString(),\n  'X-Custom-Header': 'ProcessThisImmediately'\n})\nvar getReq = new Request(URL, { method: 'GET', headers: headers })\nfetch(getReq)\n  .then(function (response) {\n    return response.json()\n  })\n  .catch(function (error) {\n    console.log('Fetch Error: ', error)\n  })\n```\n\n更便捷的是，Request 对象可以从已有的 Request 对象中继承，并拓展新的配置。\n\n```javascript\nvar URL = '//api.some.com'\nvar getReq = new Request(URL, { method: 'GET', headers: headers })\n// 基于已存在的 Request 实例，拓展创建新的 Request 实例\nvar postReq = new Request(getReq, { method: 'POST' })\n```\n\n### Response\n\nResponse 实例是在 fentch()处理完 promises 之后返回的。它的实例也可用通过 JavaScript 来创建，但只有在 ServiceWorkers 中才真正有用。\n`var res = new Response(body, init);`\n其中 body 可以是 Bolb, BufferSource, FormData, URLSearchParams, USVString 这些类型的值。\n\n**init 是一个对象，可以包括以下这些字段**\n\n- status: 响应状态码\n- statusText: 状态信息\n- headers: 头部信息，可以是对象或者 Headers 实例\n\n**Response 实例提供了以下实例属性，均是只读属性。**\n\n- bodyUsed: 用于表示响应内容是否被使用过\n- headers: 头部信息\n- ok: 表明请求是否成功，响应状态为 200 ~ 299 时，值为 true\n- status: 状态码\n- statusText: 状态信息\n- type: 响应类型\n  - basic: 同源\n  - cors: 跨域\n  - error: 出错\n  - opaque: Request mode 设置为 “no-cors”的响应\n- url: 响应地址\n\n**Response 实例提供以下实例方法**\n\n- clone: 复制一个响应对象。\n- arrayBuffer: 将响应数据转换为 arrayBuffer 后 reslove 。\n- bolb: 把响应数据转换为 Bolb 后 reslove 。\n- formData: 把响应数据转换为 formData 后 reslove 。\n- json: 把响应内容解析为对象后 reslove 。\n- text: 把响应数据当做字符串后 reslove 。\n\n## 常用的 fetch 请求\n\n### HTML\n\n```javascript\nfetch('/index/fetchHtml')\n  .then((res) => {\n    return res.text()\n  })\n  .then((result) => {\n    document.body.innerHTML += result\n  })\n  .catch((err) => {})\n```\n\n### JSON\n\n```javascript\nfetch('/api/user/CaiCai')\n  .then((res) => {\n    return res.json()\n  })\n  .then((json) => {\n    console.log(json)\n  })\n  .catch((err) => {})\n```\n\n### POST Form\n\n```javascript\nfunction postForm() {\n  const form = document.querySelector('form')\n  const name = encodeURI(document.getElementsByName('name')[0].value)\n  fetch(`/api/user/${name}`, {\n    method: 'POST',\n    body: new FormData(form)\n  })\n}\n```\n\n### POST JSON\n\n```javascript\nfetch('/api/user/CaiCai', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    name: 'CaiCai',\n    age: '26'\n  })\n})\n```\n\n## fetch 注意事项\n\n### 错误处理\n\nfetch 只有在网络错误的情况，返回的 promise 会被 reject。成功的 fetch() 检查不仅要包括 promise 被 resolve，还要包括 Response.ok 属性为 true。HTTP 404 状态并不被认为是网络错误，所以 Promise 的状态为 resolve。\n\n### credentials 设置\n\nfetch 可以通过 credentials 自己控制发送请求时是否带上 cookie。credentials 可设置为 include、same-origin、omit。include 为了让浏览器发送包含凭据的请求（即使是跨域源）。如果你只想在请求 URL 与调用脚本位于同一起源处时发送凭据，请添加 credentials: 'same-origin'。要改为确保浏览器不在请求中包含凭据，请使用 credentials: 'omit'。\n\n### 中止\n\nfetch 自身并没有提供 中止请求的方法。但是部分浏览器有实现 AbortController，可以通过 AbortController 中止 fetch 请求\n\n```javascript\nconst controller = new AbortController()\nconst signal = controller.signal\nsetTimeout(() => controller.abort(), 5000)\n\nfetch('/api/user/CaiCai', {\n  signal, // 在option中加入signal\n  method: 'POST',\n  // credentials:'include',\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    name: 'CaiCai',\n    age: '26'\n  })\n})\n  .then((res) => {\n    return res.json()\n  })\n  .then((result) => {\n    console.log(result)\n  })\n  .catch((err) => {\n    console.log(err)\n  })\n```\n\n## Fetch 的缺点\n\n1. fetch 不支持 jsonp，如果项目中使用到 JSONP，需要单独实现一个 JSONP。\n\n2. fetch 自身并没有提供 abort 的方法，需要 AbortController 去处理中止，实现起来会繁琐一点。并且 AbortController 兼容性不是很好，不过我们可以使用“abortcontroller-polyfill”。\n\n3. 在我们平常使用中，fetch 相对 XHR 差别不大，实际业务上，api 请求都是用再次封装好的函数来处理的。底层是 Fetch 还是 XHR 影响不大。所以如果没有特别的需求，从 XHR 升级到 fetch 的意义不大。但是在 ServiceWorker 中 fetch 会大放异彩。目前淘宝首页就使用 fetch+ServiceWorker 来实现离线缓存。\n","source":"_posts/了解Fetch-api.md","raw":"---\ntitle: 了解Fetch api\ndate: 2020-09-27\ncategories: Web\n---\n\n提及与服务器的异步通信，离不开 Ajax，实际上 Ajax 并非指某一项具体的技术，它主要是基于用脚本操作 HTTP 请求的 Web 应用架构。\n\n在 Ajax 中涉及到的 JavaScript 方面的技术，即 XMLHttpRequest(以下简称 XHR)，至今我们基本都是通过 XHR 与服务器简历异步通信，在设计上将输入、输出和事件监听混杂在一个对象里，且必须通过实例化方式来发请求。配置和调用方式混乱，不符合关注分点离原则。\n\n直到 Fetch API 的提出，前端和服务器端的异步通信方面更进了一步。\n\n<!--more-->\n\n## 什么是 Fetch\n\nFetch API 是近年来被提及将要取代 XHR 的技术新标准，是一个 HTML5 的 API。\n\nFetch 并不是 XHR 的升级版本，而是从一个全新的角度来思考的一种设计。Fetch 是基于 Promise 语法结构，而且它的设计足够低阶，这表示它可以在实际需求中进行更多的弹性设计。对于 XHR 所提供的能力来说，Fetch 已经足够取代 XHR ，并且提供了更多拓展的可能性。\n\nFetch 的核心在于对 HTTP 接口的抽象，包括 Request，Response，Headers，Body，以及用于初始化异步请求的 global fetch。\n\n## 如何使用 Fetch\n\nFetch API 规范明确了用户代理获取资源的语义。原生支持 Promise1，调用方便，符合语义化。可配合使用 ES2016 中的 async / await 语法，更加优雅。\n\n通过一个例子来快速了解和使用 Fetch API 最基本的用法\n\n```javascript\n// 获取 some.json 资源\nfetch('some.json')\n  .then(function(response) {\n    return response.json();\n  })\n  .then(function(data) {\n    console.log('data', data);\n  })\n  .catch(function(error) {\n    console.log('Fetch Error: ', error);\n  });\n\n// 采用ES2016的 async/await 语法\nasync function() {\n  try {\n    const response = await fetch('some.json');\n    const data = await response.json();\n    console.log('data', data);\n  } catch (error) {\n    console.log('Fetch Error: ', error)\n  }\n}\n```\n\n可以简单理解为，Fetch API 是面向未来的异步通信 API。通过例子我们可以发现，使用 Fetch API 能够快速便捷地进行资源地获取。\n\n## 具体用法\n\nfetch 方法有两种调用方式。\n\n```javascript\nPromise fetch(String url, [, Object options])\nPromise fetch(Request req, [, Object options])\n```\n\n- 第一个参数是一个 Request 对象，第二个参数是配置信息，可选\n- 第一个参数是一个 url，第二个参数是配置信息，可选\n  可选配置信息是一个 Object 对象，可以包含以下字段：\n- method: 请求的方法，例如：GET,POST。\n- headers: 请求头部信息，可以是一个简单的对象，也可以是 Headers 类实例化的一个对象。\n- body: 需要发送的信息内容，可以是 Blob,BufferSource,FormData,URLSearchParams 或者 USVString。注意，GET,HEAD 方法不能包含 body。\n- mode: 请求模式，分别有 cors,no-cors,same-origin,navigate 这几个可选值。\n  - cors: 允许跨域，要求响应中 Acess-Control-Allow-Origin 这样的头部表示允许跨域。\n  - no-cors: 只允许使用 HEAD,GET,POST 方法。\n  - same-origin: 只允许同源请求，否则直接报错。\n  - navigate: 支持页面导航。\n- credentials: 表示是否发送 cookie，有三个选项\n  - omit: 不发送 cookie。\n  - same-origin: 仅在同源时发送 cookie。\n  - include: 发送 cookie。\n- cache: 表示处理缓存的策略。\n- redirect: 表示发生重定向时，有三个选项\n  - follow: 跟随。\n  - error: 发生错误。\n  - manual: 需要用户手动跟随。\n- integrity: 包含一个用于验证资资源完整性的字符串。\n\n### Headers\n\nHeaders 可用来表示 HTTP 的头部信息，使用 Headers 的接口，你可以通过 Headers() 构造函数来创建一个你自己的 headers 对象。\n\n```javascript\nvar headers = new Headers({\n  'Content-Type': 'text/plain',\n  'Content-Length': content.length.toString(),\n  'X-Custom-Header': 'ProcessThisImmediately'\n})\nheaders.append('X-Custom-Header', 'AnotherValue')\nheaders.has('Content-Type') // true\nheaders.getAll('X-Custom-Header') // [\"ProcessThisImmediately\", \"AnotherValue\"]\n```\n\nHeaders 提供 append, delete, get, getAll, has, set, forEach 等这些实例方法，可供开发者更加灵活地配置请求中的 headers。\n\n### Request\n\n```javascript\nvar URL = '//api.some.com'\nvar getReq = new Request(URL, { method: 'GET', cache: 'reload' })\nfetch(getReq)\n  .then(function (response) {\n    return response.json()\n  })\n  .catch(function (error) {\n    console.log('Fetch Error: ', error)\n  })\n```\n\nRequest 接口中的配置项 headers 可以是实例化的 Headers 。\n\n```javascript\nvar URL = '//api.some.com'\n// 实例化 Headers\nvar headers = new Headers({\n  'Content-Type': 'text/plain',\n  'Content-Length': content.length.toString(),\n  'X-Custom-Header': 'ProcessThisImmediately'\n})\nvar getReq = new Request(URL, { method: 'GET', headers: headers })\nfetch(getReq)\n  .then(function (response) {\n    return response.json()\n  })\n  .catch(function (error) {\n    console.log('Fetch Error: ', error)\n  })\n```\n\n更便捷的是，Request 对象可以从已有的 Request 对象中继承，并拓展新的配置。\n\n```javascript\nvar URL = '//api.some.com'\nvar getReq = new Request(URL, { method: 'GET', headers: headers })\n// 基于已存在的 Request 实例，拓展创建新的 Request 实例\nvar postReq = new Request(getReq, { method: 'POST' })\n```\n\n### Response\n\nResponse 实例是在 fentch()处理完 promises 之后返回的。它的实例也可用通过 JavaScript 来创建，但只有在 ServiceWorkers 中才真正有用。\n`var res = new Response(body, init);`\n其中 body 可以是 Bolb, BufferSource, FormData, URLSearchParams, USVString 这些类型的值。\n\n**init 是一个对象，可以包括以下这些字段**\n\n- status: 响应状态码\n- statusText: 状态信息\n- headers: 头部信息，可以是对象或者 Headers 实例\n\n**Response 实例提供了以下实例属性，均是只读属性。**\n\n- bodyUsed: 用于表示响应内容是否被使用过\n- headers: 头部信息\n- ok: 表明请求是否成功，响应状态为 200 ~ 299 时，值为 true\n- status: 状态码\n- statusText: 状态信息\n- type: 响应类型\n  - basic: 同源\n  - cors: 跨域\n  - error: 出错\n  - opaque: Request mode 设置为 “no-cors”的响应\n- url: 响应地址\n\n**Response 实例提供以下实例方法**\n\n- clone: 复制一个响应对象。\n- arrayBuffer: 将响应数据转换为 arrayBuffer 后 reslove 。\n- bolb: 把响应数据转换为 Bolb 后 reslove 。\n- formData: 把响应数据转换为 formData 后 reslove 。\n- json: 把响应内容解析为对象后 reslove 。\n- text: 把响应数据当做字符串后 reslove 。\n\n## 常用的 fetch 请求\n\n### HTML\n\n```javascript\nfetch('/index/fetchHtml')\n  .then((res) => {\n    return res.text()\n  })\n  .then((result) => {\n    document.body.innerHTML += result\n  })\n  .catch((err) => {})\n```\n\n### JSON\n\n```javascript\nfetch('/api/user/CaiCai')\n  .then((res) => {\n    return res.json()\n  })\n  .then((json) => {\n    console.log(json)\n  })\n  .catch((err) => {})\n```\n\n### POST Form\n\n```javascript\nfunction postForm() {\n  const form = document.querySelector('form')\n  const name = encodeURI(document.getElementsByName('name')[0].value)\n  fetch(`/api/user/${name}`, {\n    method: 'POST',\n    body: new FormData(form)\n  })\n}\n```\n\n### POST JSON\n\n```javascript\nfetch('/api/user/CaiCai', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    name: 'CaiCai',\n    age: '26'\n  })\n})\n```\n\n## fetch 注意事项\n\n### 错误处理\n\nfetch 只有在网络错误的情况，返回的 promise 会被 reject。成功的 fetch() 检查不仅要包括 promise 被 resolve，还要包括 Response.ok 属性为 true。HTTP 404 状态并不被认为是网络错误，所以 Promise 的状态为 resolve。\n\n### credentials 设置\n\nfetch 可以通过 credentials 自己控制发送请求时是否带上 cookie。credentials 可设置为 include、same-origin、omit。include 为了让浏览器发送包含凭据的请求（即使是跨域源）。如果你只想在请求 URL 与调用脚本位于同一起源处时发送凭据，请添加 credentials: 'same-origin'。要改为确保浏览器不在请求中包含凭据，请使用 credentials: 'omit'。\n\n### 中止\n\nfetch 自身并没有提供 中止请求的方法。但是部分浏览器有实现 AbortController，可以通过 AbortController 中止 fetch 请求\n\n```javascript\nconst controller = new AbortController()\nconst signal = controller.signal\nsetTimeout(() => controller.abort(), 5000)\n\nfetch('/api/user/CaiCai', {\n  signal, // 在option中加入signal\n  method: 'POST',\n  // credentials:'include',\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    name: 'CaiCai',\n    age: '26'\n  })\n})\n  .then((res) => {\n    return res.json()\n  })\n  .then((result) => {\n    console.log(result)\n  })\n  .catch((err) => {\n    console.log(err)\n  })\n```\n\n## Fetch 的缺点\n\n1. fetch 不支持 jsonp，如果项目中使用到 JSONP，需要单独实现一个 JSONP。\n\n2. fetch 自身并没有提供 abort 的方法，需要 AbortController 去处理中止，实现起来会繁琐一点。并且 AbortController 兼容性不是很好，不过我们可以使用“abortcontroller-polyfill”。\n\n3. 在我们平常使用中，fetch 相对 XHR 差别不大，实际业务上，api 请求都是用再次封装好的函数来处理的。底层是 Fetch 还是 XHR 影响不大。所以如果没有特别的需求，从 XHR 升级到 fetch 的意义不大。但是在 ServiceWorker 中 fetch 会大放异彩。目前淘宝首页就使用 fetch+ServiceWorker 来实现离线缓存。\n","slug":"了解Fetch-api","published":1,"updated":"2021-04-24T15:38:16.550Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x90021l5v06qo0ezul","content":"<p>提及与服务器的异步通信，离不开 Ajax，实际上 Ajax 并非指某一项具体的技术，它主要是基于用脚本操作 HTTP 请求的 Web 应用架构。</p>\n<p>在 Ajax 中涉及到的 JavaScript 方面的技术，即 XMLHttpRequest(以下简称 XHR)，至今我们基本都是通过 XHR 与服务器简历异步通信，在设计上将输入、输出和事件监听混杂在一个对象里，且必须通过实例化方式来发请求。配置和调用方式混乱，不符合关注分点离原则。</p>\n<p>直到 Fetch API 的提出，前端和服务器端的异步通信方面更进了一步。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"什么是-Fetch\"><a href=\"#什么是-Fetch\" class=\"headerlink\" title=\"什么是 Fetch\"></a>什么是 Fetch</h2><p>Fetch API 是近年来被提及将要取代 XHR 的技术新标准，是一个 HTML5 的 API。</p>\n<p>Fetch 并不是 XHR 的升级版本，而是从一个全新的角度来思考的一种设计。Fetch 是基于 Promise 语法结构，而且它的设计足够低阶，这表示它可以在实际需求中进行更多的弹性设计。对于 XHR 所提供的能力来说，Fetch 已经足够取代 XHR ，并且提供了更多拓展的可能性。</p>\n<p>Fetch 的核心在于对 HTTP 接口的抽象，包括 Request，Response，Headers，Body，以及用于初始化异步请求的 global fetch。</p>\n<h2 id=\"如何使用-Fetch\"><a href=\"#如何使用-Fetch\" class=\"headerlink\" title=\"如何使用 Fetch\"></a>如何使用 Fetch</h2><p>Fetch API 规范明确了用户代理获取资源的语义。原生支持 Promise1，调用方便，符合语义化。可配合使用 ES2016 中的 async / await 语法，更加优雅。</p>\n<p>通过一个例子来快速了解和使用 Fetch API 最基本的用法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取 some.json 资源</span></span><br><span class=\"line\">fetch(<span class=\"string\">&#x27;some.json&#x27;</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response.json();</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;data&#x27;</span>, data);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Fetch Error: &#x27;</span>, error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 采用ES2016的 async/await 语法</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> fetch(<span class=\"string\">&#x27;some.json&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> data = <span class=\"keyword\">await</span> response.json();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;data&#x27;</span>, data);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Fetch Error: &#x27;</span>, error)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以简单理解为，Fetch API 是面向未来的异步通信 API。通过例子我们可以发现，使用 Fetch API 能够快速便捷地进行资源地获取。</p>\n<h2 id=\"具体用法\"><a href=\"#具体用法\" class=\"headerlink\" title=\"具体用法\"></a>具体用法</h2><p>fetch 方法有两种调用方式。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span> fetch(<span class=\"built_in\">String</span> url, [, <span class=\"built_in\">Object</span> options])</span><br><span class=\"line\"><span class=\"built_in\">Promise</span> fetch(Request req, [, <span class=\"built_in\">Object</span> options])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>第一个参数是一个 Request 对象，第二个参数是配置信息，可选</li>\n<li>第一个参数是一个 url，第二个参数是配置信息，可选<br>可选配置信息是一个 Object 对象，可以包含以下字段：</li>\n<li>method: 请求的方法，例如：GET,POST。</li>\n<li>headers: 请求头部信息，可以是一个简单的对象，也可以是 Headers 类实例化的一个对象。</li>\n<li>body: 需要发送的信息内容，可以是 Blob,BufferSource,FormData,URLSearchParams 或者 USVString。注意，GET,HEAD 方法不能包含 body。</li>\n<li>mode: 请求模式，分别有 cors,no-cors,same-origin,navigate 这几个可选值。<ul>\n<li>cors: 允许跨域，要求响应中 Acess-Control-Allow-Origin 这样的头部表示允许跨域。</li>\n<li>no-cors: 只允许使用 HEAD,GET,POST 方法。</li>\n<li>same-origin: 只允许同源请求，否则直接报错。</li>\n<li>navigate: 支持页面导航。</li>\n</ul>\n</li>\n<li>credentials: 表示是否发送 cookie，有三个选项<ul>\n<li>omit: 不发送 cookie。</li>\n<li>same-origin: 仅在同源时发送 cookie。</li>\n<li>include: 发送 cookie。</li>\n</ul>\n</li>\n<li>cache: 表示处理缓存的策略。</li>\n<li>redirect: 表示发生重定向时，有三个选项<ul>\n<li>follow: 跟随。</li>\n<li>error: 发生错误。</li>\n<li>manual: 需要用户手动跟随。</li>\n</ul>\n</li>\n<li>integrity: 包含一个用于验证资资源完整性的字符串。</li>\n</ul>\n<h3 id=\"Headers\"><a href=\"#Headers\" class=\"headerlink\" title=\"Headers\"></a>Headers</h3><p>Headers 可用来表示 HTTP 的头部信息，使用 Headers 的接口，你可以通过 Headers() 构造函数来创建一个你自己的 headers 对象。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> headers = <span class=\"keyword\">new</span> Headers(&#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/plain&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Length&#x27;</span>: content.length.toString(),</span><br><span class=\"line\">  <span class=\"string\">&#x27;X-Custom-Header&#x27;</span>: <span class=\"string\">&#x27;ProcessThisImmediately&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">headers.append(<span class=\"string\">&#x27;X-Custom-Header&#x27;</span>, <span class=\"string\">&#x27;AnotherValue&#x27;</span>)</span><br><span class=\"line\">headers.has(<span class=\"string\">&#x27;Content-Type&#x27;</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\">headers.getAll(<span class=\"string\">&#x27;X-Custom-Header&#x27;</span>) <span class=\"comment\">// [&quot;ProcessThisImmediately&quot;, &quot;AnotherValue&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<p>Headers 提供 append, delete, get, getAll, has, set, forEach 等这些实例方法，可供开发者更加灵活地配置请求中的 headers。</p>\n<h3 id=\"Request\"><a href=\"#Request\" class=\"headerlink\" title=\"Request\"></a>Request</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> URL = <span class=\"string\">&#x27;//api.some.com&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getReq = <span class=\"keyword\">new</span> Request(URL, &#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"attr\">cache</span>: <span class=\"string\">&#x27;reload&#x27;</span> &#125;)</span><br><span class=\"line\">fetch(getReq)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response.json()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Fetch Error: &#x27;</span>, error)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Request 接口中的配置项 headers 可以是实例化的 Headers 。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> URL = <span class=\"string\">&#x27;//api.some.com&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// 实例化 Headers</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> headers = <span class=\"keyword\">new</span> Headers(&#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/plain&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Length&#x27;</span>: content.length.toString(),</span><br><span class=\"line\">  <span class=\"string\">&#x27;X-Custom-Header&#x27;</span>: <span class=\"string\">&#x27;ProcessThisImmediately&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">var</span> getReq = <span class=\"keyword\">new</span> Request(URL, &#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"attr\">headers</span>: headers &#125;)</span><br><span class=\"line\">fetch(getReq)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response.json()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Fetch Error: &#x27;</span>, error)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>更便捷的是，Request 对象可以从已有的 Request 对象中继承，并拓展新的配置。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> URL = <span class=\"string\">&#x27;//api.some.com&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getReq = <span class=\"keyword\">new</span> Request(URL, &#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"attr\">headers</span>: headers &#125;)</span><br><span class=\"line\"><span class=\"comment\">// 基于已存在的 Request 实例，拓展创建新的 Request 实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> postReq = <span class=\"keyword\">new</span> Request(getReq, &#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;POST&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Response\"><a href=\"#Response\" class=\"headerlink\" title=\"Response\"></a>Response</h3><p>Response 实例是在 fentch()处理完 promises 之后返回的。它的实例也可用通过 JavaScript 来创建，但只有在 ServiceWorkers 中才真正有用。<br><code>var res = new Response(body, init);</code><br>其中 body 可以是 Bolb, BufferSource, FormData, URLSearchParams, USVString 这些类型的值。</p>\n<p><strong>init 是一个对象，可以包括以下这些字段</strong></p>\n<ul>\n<li>status: 响应状态码</li>\n<li>statusText: 状态信息</li>\n<li>headers: 头部信息，可以是对象或者 Headers 实例</li>\n</ul>\n<p><strong>Response 实例提供了以下实例属性，均是只读属性。</strong></p>\n<ul>\n<li>bodyUsed: 用于表示响应内容是否被使用过</li>\n<li>headers: 头部信息</li>\n<li>ok: 表明请求是否成功，响应状态为 200 ~ 299 时，值为 true</li>\n<li>status: 状态码</li>\n<li>statusText: 状态信息</li>\n<li>type: 响应类型<ul>\n<li>basic: 同源</li>\n<li>cors: 跨域</li>\n<li>error: 出错</li>\n<li>opaque: Request mode 设置为 “no-cors”的响应</li>\n</ul>\n</li>\n<li>url: 响应地址</li>\n</ul>\n<p><strong>Response 实例提供以下实例方法</strong></p>\n<ul>\n<li>clone: 复制一个响应对象。</li>\n<li>arrayBuffer: 将响应数据转换为 arrayBuffer 后 reslove 。</li>\n<li>bolb: 把响应数据转换为 Bolb 后 reslove 。</li>\n<li>formData: 把响应数据转换为 formData 后 reslove 。</li>\n<li>json: 把响应内容解析为对象后 reslove 。</li>\n<li>text: 把响应数据当做字符串后 reslove 。</li>\n</ul>\n<h2 id=\"常用的-fetch-请求\"><a href=\"#常用的-fetch-请求\" class=\"headerlink\" title=\"常用的 fetch 请求\"></a>常用的 fetch 请求</h2><h3 id=\"HTML\"><a href=\"#HTML\" class=\"headerlink\" title=\"HTML\"></a>HTML</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">&#x27;/index/fetchHtml&#x27;</span>)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.text()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.innerHTML += result</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"JSON\"><a href=\"#JSON\" class=\"headerlink\" title=\"JSON\"></a>JSON</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">&#x27;/api/user/CaiCai&#x27;</span>)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.json()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">json</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(json)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"POST-Form\"><a href=\"#POST-Form\" class=\"headerlink\" title=\"POST Form\"></a>POST Form</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">postForm</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> form = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;form&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> name = <span class=\"built_in\">encodeURI</span>(<span class=\"built_in\">document</span>.getElementsByName(<span class=\"string\">&#x27;name&#x27;</span>)[<span class=\"number\">0</span>].value)</span><br><span class=\"line\">  fetch(<span class=\"string\">`/api/user/<span class=\"subst\">$&#123;name&#125;</span>`</span>, &#123;</span><br><span class=\"line\">    method: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">    body: <span class=\"keyword\">new</span> FormData(form)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"POST-JSON\"><a href=\"#POST-JSON\" class=\"headerlink\" title=\"POST JSON\"></a>POST JSON</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">&#x27;/api/user/CaiCai&#x27;</span>, &#123;</span><br><span class=\"line\">  method: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">  headers: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  body: <span class=\"built_in\">JSON</span>.stringify(&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;CaiCai&#x27;</span>,</span><br><span class=\"line\">    age: <span class=\"string\">&#x27;26&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"fetch-注意事项\"><a href=\"#fetch-注意事项\" class=\"headerlink\" title=\"fetch 注意事项\"></a>fetch 注意事项</h2><h3 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h3><p>fetch 只有在网络错误的情况，返回的 promise 会被 reject。成功的 fetch() 检查不仅要包括 promise 被 resolve，还要包括 Response.ok 属性为 true。HTTP 404 状态并不被认为是网络错误，所以 Promise 的状态为 resolve。</p>\n<h3 id=\"credentials-设置\"><a href=\"#credentials-设置\" class=\"headerlink\" title=\"credentials 设置\"></a>credentials 设置</h3><p>fetch 可以通过 credentials 自己控制发送请求时是否带上 cookie。credentials 可设置为 include、same-origin、omit。include 为了让浏览器发送包含凭据的请求（即使是跨域源）。如果你只想在请求 URL 与调用脚本位于同一起源处时发送凭据，请添加 credentials: ‘same-origin’。要改为确保浏览器不在请求中包含凭据，请使用 credentials: ‘omit’。</p>\n<h3 id=\"中止\"><a href=\"#中止\" class=\"headerlink\" title=\"中止\"></a>中止</h3><p>fetch 自身并没有提供 中止请求的方法。但是部分浏览器有实现 AbortController，可以通过 AbortController 中止 fetch 请求</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> controller = <span class=\"keyword\">new</span> AbortController()</span><br><span class=\"line\"><span class=\"keyword\">const</span> signal = controller.signal</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> controller.abort(), <span class=\"number\">5000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">fetch(<span class=\"string\">&#x27;/api/user/CaiCai&#x27;</span>, &#123;</span><br><span class=\"line\">  signal, <span class=\"comment\">// 在option中加入signal</span></span><br><span class=\"line\">  method: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\">// credentials:&#x27;include&#x27;,</span></span><br><span class=\"line\">  headers: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  body: <span class=\"built_in\">JSON</span>.stringify(&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;CaiCai&#x27;</span>,</span><br><span class=\"line\">    age: <span class=\"string\">&#x27;26&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.json()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(result)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Fetch-的缺点\"><a href=\"#Fetch-的缺点\" class=\"headerlink\" title=\"Fetch 的缺点\"></a>Fetch 的缺点</h2><ol>\n<li><p>fetch 不支持 jsonp，如果项目中使用到 JSONP，需要单独实现一个 JSONP。</p>\n</li>\n<li><p>fetch 自身并没有提供 abort 的方法，需要 AbortController 去处理中止，实现起来会繁琐一点。并且 AbortController 兼容性不是很好，不过我们可以使用“abortcontroller-polyfill”。</p>\n</li>\n<li><p>在我们平常使用中，fetch 相对 XHR 差别不大，实际业务上，api 请求都是用再次封装好的函数来处理的。底层是 Fetch 还是 XHR 影响不大。所以如果没有特别的需求，从 XHR 升级到 fetch 的意义不大。但是在 ServiceWorker 中 fetch 会大放异彩。目前淘宝首页就使用 fetch+ServiceWorker 来实现离线缓存。</p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>提及与服务器的异步通信，离不开 Ajax，实际上 Ajax 并非指某一项具体的技术，它主要是基于用脚本操作 HTTP 请求的 Web 应用架构。</p>\n<p>在 Ajax 中涉及到的 JavaScript 方面的技术，即 XMLHttpRequest(以下简称 XHR)，至今我们基本都是通过 XHR 与服务器简历异步通信，在设计上将输入、输出和事件监听混杂在一个对象里，且必须通过实例化方式来发请求。配置和调用方式混乱，不符合关注分点离原则。</p>\n<p>直到 Fetch API 的提出，前端和服务器端的异步通信方面更进了一步。</p>","more":"<h2 id=\"什么是-Fetch\"><a href=\"#什么是-Fetch\" class=\"headerlink\" title=\"什么是 Fetch\"></a>什么是 Fetch</h2><p>Fetch API 是近年来被提及将要取代 XHR 的技术新标准，是一个 HTML5 的 API。</p>\n<p>Fetch 并不是 XHR 的升级版本，而是从一个全新的角度来思考的一种设计。Fetch 是基于 Promise 语法结构，而且它的设计足够低阶，这表示它可以在实际需求中进行更多的弹性设计。对于 XHR 所提供的能力来说，Fetch 已经足够取代 XHR ，并且提供了更多拓展的可能性。</p>\n<p>Fetch 的核心在于对 HTTP 接口的抽象，包括 Request，Response，Headers，Body，以及用于初始化异步请求的 global fetch。</p>\n<h2 id=\"如何使用-Fetch\"><a href=\"#如何使用-Fetch\" class=\"headerlink\" title=\"如何使用 Fetch\"></a>如何使用 Fetch</h2><p>Fetch API 规范明确了用户代理获取资源的语义。原生支持 Promise1，调用方便，符合语义化。可配合使用 ES2016 中的 async / await 语法，更加优雅。</p>\n<p>通过一个例子来快速了解和使用 Fetch API 最基本的用法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取 some.json 资源</span></span><br><span class=\"line\">fetch(<span class=\"string\">&#x27;some.json&#x27;</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response.json();</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;data&#x27;</span>, data);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Fetch Error: &#x27;</span>, error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 采用ES2016的 async/await 语法</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> fetch(<span class=\"string\">&#x27;some.json&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> data = <span class=\"keyword\">await</span> response.json();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;data&#x27;</span>, data);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Fetch Error: &#x27;</span>, error)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以简单理解为，Fetch API 是面向未来的异步通信 API。通过例子我们可以发现，使用 Fetch API 能够快速便捷地进行资源地获取。</p>\n<h2 id=\"具体用法\"><a href=\"#具体用法\" class=\"headerlink\" title=\"具体用法\"></a>具体用法</h2><p>fetch 方法有两种调用方式。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span> fetch(<span class=\"built_in\">String</span> url, [, <span class=\"built_in\">Object</span> options])</span><br><span class=\"line\"><span class=\"built_in\">Promise</span> fetch(Request req, [, <span class=\"built_in\">Object</span> options])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>第一个参数是一个 Request 对象，第二个参数是配置信息，可选</li>\n<li>第一个参数是一个 url，第二个参数是配置信息，可选<br>可选配置信息是一个 Object 对象，可以包含以下字段：</li>\n<li>method: 请求的方法，例如：GET,POST。</li>\n<li>headers: 请求头部信息，可以是一个简单的对象，也可以是 Headers 类实例化的一个对象。</li>\n<li>body: 需要发送的信息内容，可以是 Blob,BufferSource,FormData,URLSearchParams 或者 USVString。注意，GET,HEAD 方法不能包含 body。</li>\n<li>mode: 请求模式，分别有 cors,no-cors,same-origin,navigate 这几个可选值。<ul>\n<li>cors: 允许跨域，要求响应中 Acess-Control-Allow-Origin 这样的头部表示允许跨域。</li>\n<li>no-cors: 只允许使用 HEAD,GET,POST 方法。</li>\n<li>same-origin: 只允许同源请求，否则直接报错。</li>\n<li>navigate: 支持页面导航。</li>\n</ul>\n</li>\n<li>credentials: 表示是否发送 cookie，有三个选项<ul>\n<li>omit: 不发送 cookie。</li>\n<li>same-origin: 仅在同源时发送 cookie。</li>\n<li>include: 发送 cookie。</li>\n</ul>\n</li>\n<li>cache: 表示处理缓存的策略。</li>\n<li>redirect: 表示发生重定向时，有三个选项<ul>\n<li>follow: 跟随。</li>\n<li>error: 发生错误。</li>\n<li>manual: 需要用户手动跟随。</li>\n</ul>\n</li>\n<li>integrity: 包含一个用于验证资资源完整性的字符串。</li>\n</ul>\n<h3 id=\"Headers\"><a href=\"#Headers\" class=\"headerlink\" title=\"Headers\"></a>Headers</h3><p>Headers 可用来表示 HTTP 的头部信息，使用 Headers 的接口，你可以通过 Headers() 构造函数来创建一个你自己的 headers 对象。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> headers = <span class=\"keyword\">new</span> Headers(&#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/plain&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Length&#x27;</span>: content.length.toString(),</span><br><span class=\"line\">  <span class=\"string\">&#x27;X-Custom-Header&#x27;</span>: <span class=\"string\">&#x27;ProcessThisImmediately&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">headers.append(<span class=\"string\">&#x27;X-Custom-Header&#x27;</span>, <span class=\"string\">&#x27;AnotherValue&#x27;</span>)</span><br><span class=\"line\">headers.has(<span class=\"string\">&#x27;Content-Type&#x27;</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\">headers.getAll(<span class=\"string\">&#x27;X-Custom-Header&#x27;</span>) <span class=\"comment\">// [&quot;ProcessThisImmediately&quot;, &quot;AnotherValue&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<p>Headers 提供 append, delete, get, getAll, has, set, forEach 等这些实例方法，可供开发者更加灵活地配置请求中的 headers。</p>\n<h3 id=\"Request\"><a href=\"#Request\" class=\"headerlink\" title=\"Request\"></a>Request</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> URL = <span class=\"string\">&#x27;//api.some.com&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getReq = <span class=\"keyword\">new</span> Request(URL, &#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"attr\">cache</span>: <span class=\"string\">&#x27;reload&#x27;</span> &#125;)</span><br><span class=\"line\">fetch(getReq)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response.json()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Fetch Error: &#x27;</span>, error)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Request 接口中的配置项 headers 可以是实例化的 Headers 。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> URL = <span class=\"string\">&#x27;//api.some.com&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// 实例化 Headers</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> headers = <span class=\"keyword\">new</span> Headers(&#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;text/plain&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;Content-Length&#x27;</span>: content.length.toString(),</span><br><span class=\"line\">  <span class=\"string\">&#x27;X-Custom-Header&#x27;</span>: <span class=\"string\">&#x27;ProcessThisImmediately&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">var</span> getReq = <span class=\"keyword\">new</span> Request(URL, &#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"attr\">headers</span>: headers &#125;)</span><br><span class=\"line\">fetch(getReq)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response.json()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Fetch Error: &#x27;</span>, error)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>更便捷的是，Request 对象可以从已有的 Request 对象中继承，并拓展新的配置。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> URL = <span class=\"string\">&#x27;//api.some.com&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getReq = <span class=\"keyword\">new</span> Request(URL, &#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"attr\">headers</span>: headers &#125;)</span><br><span class=\"line\"><span class=\"comment\">// 基于已存在的 Request 实例，拓展创建新的 Request 实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> postReq = <span class=\"keyword\">new</span> Request(getReq, &#123; <span class=\"attr\">method</span>: <span class=\"string\">&#x27;POST&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Response\"><a href=\"#Response\" class=\"headerlink\" title=\"Response\"></a>Response</h3><p>Response 实例是在 fentch()处理完 promises 之后返回的。它的实例也可用通过 JavaScript 来创建，但只有在 ServiceWorkers 中才真正有用。<br><code>var res = new Response(body, init);</code><br>其中 body 可以是 Bolb, BufferSource, FormData, URLSearchParams, USVString 这些类型的值。</p>\n<p><strong>init 是一个对象，可以包括以下这些字段</strong></p>\n<ul>\n<li>status: 响应状态码</li>\n<li>statusText: 状态信息</li>\n<li>headers: 头部信息，可以是对象或者 Headers 实例</li>\n</ul>\n<p><strong>Response 实例提供了以下实例属性，均是只读属性。</strong></p>\n<ul>\n<li>bodyUsed: 用于表示响应内容是否被使用过</li>\n<li>headers: 头部信息</li>\n<li>ok: 表明请求是否成功，响应状态为 200 ~ 299 时，值为 true</li>\n<li>status: 状态码</li>\n<li>statusText: 状态信息</li>\n<li>type: 响应类型<ul>\n<li>basic: 同源</li>\n<li>cors: 跨域</li>\n<li>error: 出错</li>\n<li>opaque: Request mode 设置为 “no-cors”的响应</li>\n</ul>\n</li>\n<li>url: 响应地址</li>\n</ul>\n<p><strong>Response 实例提供以下实例方法</strong></p>\n<ul>\n<li>clone: 复制一个响应对象。</li>\n<li>arrayBuffer: 将响应数据转换为 arrayBuffer 后 reslove 。</li>\n<li>bolb: 把响应数据转换为 Bolb 后 reslove 。</li>\n<li>formData: 把响应数据转换为 formData 后 reslove 。</li>\n<li>json: 把响应内容解析为对象后 reslove 。</li>\n<li>text: 把响应数据当做字符串后 reslove 。</li>\n</ul>\n<h2 id=\"常用的-fetch-请求\"><a href=\"#常用的-fetch-请求\" class=\"headerlink\" title=\"常用的 fetch 请求\"></a>常用的 fetch 请求</h2><h3 id=\"HTML\"><a href=\"#HTML\" class=\"headerlink\" title=\"HTML\"></a>HTML</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">&#x27;/index/fetchHtml&#x27;</span>)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.text()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.innerHTML += result</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"JSON\"><a href=\"#JSON\" class=\"headerlink\" title=\"JSON\"></a>JSON</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">&#x27;/api/user/CaiCai&#x27;</span>)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.json()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">json</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(json)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"POST-Form\"><a href=\"#POST-Form\" class=\"headerlink\" title=\"POST Form\"></a>POST Form</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">postForm</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> form = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;form&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> name = <span class=\"built_in\">encodeURI</span>(<span class=\"built_in\">document</span>.getElementsByName(<span class=\"string\">&#x27;name&#x27;</span>)[<span class=\"number\">0</span>].value)</span><br><span class=\"line\">  fetch(<span class=\"string\">`/api/user/<span class=\"subst\">$&#123;name&#125;</span>`</span>, &#123;</span><br><span class=\"line\">    method: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">    body: <span class=\"keyword\">new</span> FormData(form)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"POST-JSON\"><a href=\"#POST-JSON\" class=\"headerlink\" title=\"POST JSON\"></a>POST JSON</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">&#x27;/api/user/CaiCai&#x27;</span>, &#123;</span><br><span class=\"line\">  method: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">  headers: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  body: <span class=\"built_in\">JSON</span>.stringify(&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;CaiCai&#x27;</span>,</span><br><span class=\"line\">    age: <span class=\"string\">&#x27;26&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"fetch-注意事项\"><a href=\"#fetch-注意事项\" class=\"headerlink\" title=\"fetch 注意事项\"></a>fetch 注意事项</h2><h3 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h3><p>fetch 只有在网络错误的情况，返回的 promise 会被 reject。成功的 fetch() 检查不仅要包括 promise 被 resolve，还要包括 Response.ok 属性为 true。HTTP 404 状态并不被认为是网络错误，所以 Promise 的状态为 resolve。</p>\n<h3 id=\"credentials-设置\"><a href=\"#credentials-设置\" class=\"headerlink\" title=\"credentials 设置\"></a>credentials 设置</h3><p>fetch 可以通过 credentials 自己控制发送请求时是否带上 cookie。credentials 可设置为 include、same-origin、omit。include 为了让浏览器发送包含凭据的请求（即使是跨域源）。如果你只想在请求 URL 与调用脚本位于同一起源处时发送凭据，请添加 credentials: ‘same-origin’。要改为确保浏览器不在请求中包含凭据，请使用 credentials: ‘omit’。</p>\n<h3 id=\"中止\"><a href=\"#中止\" class=\"headerlink\" title=\"中止\"></a>中止</h3><p>fetch 自身并没有提供 中止请求的方法。但是部分浏览器有实现 AbortController，可以通过 AbortController 中止 fetch 请求</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> controller = <span class=\"keyword\">new</span> AbortController()</span><br><span class=\"line\"><span class=\"keyword\">const</span> signal = controller.signal</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> controller.abort(), <span class=\"number\">5000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">fetch(<span class=\"string\">&#x27;/api/user/CaiCai&#x27;</span>, &#123;</span><br><span class=\"line\">  signal, <span class=\"comment\">// 在option中加入signal</span></span><br><span class=\"line\">  method: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\">// credentials:&#x27;include&#x27;,</span></span><br><span class=\"line\">  headers: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  body: <span class=\"built_in\">JSON</span>.stringify(&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;CaiCai&#x27;</span>,</span><br><span class=\"line\">    age: <span class=\"string\">&#x27;26&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.json()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(result)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Fetch-的缺点\"><a href=\"#Fetch-的缺点\" class=\"headerlink\" title=\"Fetch 的缺点\"></a>Fetch 的缺点</h2><ol>\n<li><p>fetch 不支持 jsonp，如果项目中使用到 JSONP，需要单独实现一个 JSONP。</p>\n</li>\n<li><p>fetch 自身并没有提供 abort 的方法，需要 AbortController 去处理中止，实现起来会繁琐一点。并且 AbortController 兼容性不是很好，不过我们可以使用“abortcontroller-polyfill”。</p>\n</li>\n<li><p>在我们平常使用中，fetch 相对 XHR 差别不大，实际业务上，api 请求都是用再次封装好的函数来处理的。底层是 Fetch 还是 XHR 影响不大。所以如果没有特别的需求，从 XHR 升级到 fetch 的意义不大。但是在 ServiceWorker 中 fetch 会大放异彩。目前淘宝首页就使用 fetch+ServiceWorker 来实现离线缓存。</p>\n</li>\n</ol>"},{"title":"优化-seo优化","date":"2018-03-08T09:05:51.000Z","_content":"\nseo 优化整合\n\n<!--more-->\n\n* 合理的 title、description、keywords：搜索对着三项的权重逐个减小，title 值强调重点即可，重要关键词出现不要超过 2 次，而且要靠前，不同页面 title 要有所不同；description 把页面内容高度概括，长度合适，不可过分堆砌关键词，不同页面 description 有所不同；keywords 列举出重要关键词即可\n* 语义化的 HTML 代码，符合 W3C 规范：语义化代码让搜索引擎容易理解网页\n* 重要内容 HTML 代码放在最前：搜索引擎抓取 HTML 顺序是从上到下，有的搜索引擎对抓取长度有限制，保证重要内容一定会被抓取重要内容不要用 js 输出：爬虫不会执行 js 获取内容\n* 少用 iframe：搜索引擎不会抓取 iframe 中的内容\n* 非装饰性图片必须加 alt\n* 提高网站速度：网站速度是搜索引擎排序的一个重要指标\n\n## Web 开发中会话跟踪的方法有哪些\nHTTP 是一种无状态协议，当用户发出请求时，服务器就会做出响应，客户端与服务端的联系是离散的，非连续的，当用户在同一个网站的多个页面之间转换时，根本无法确定是否是同一个用户，会话跟踪就可以解决这个问题。当一个用户在多个页面间切换时，服务就会保存该用户的信息。\n1. cookie\n2. session\n3. url 重写\n4. 隐藏input\n5. ip地址\n\n","source":"_posts/优化.md","raw":"---\ntitle: 优化-seo优化\ndate: 2018-03-08 17:05:51\ncategories: Web\n---\n\nseo 优化整合\n\n<!--more-->\n\n* 合理的 title、description、keywords：搜索对着三项的权重逐个减小，title 值强调重点即可，重要关键词出现不要超过 2 次，而且要靠前，不同页面 title 要有所不同；description 把页面内容高度概括，长度合适，不可过分堆砌关键词，不同页面 description 有所不同；keywords 列举出重要关键词即可\n* 语义化的 HTML 代码，符合 W3C 规范：语义化代码让搜索引擎容易理解网页\n* 重要内容 HTML 代码放在最前：搜索引擎抓取 HTML 顺序是从上到下，有的搜索引擎对抓取长度有限制，保证重要内容一定会被抓取重要内容不要用 js 输出：爬虫不会执行 js 获取内容\n* 少用 iframe：搜索引擎不会抓取 iframe 中的内容\n* 非装饰性图片必须加 alt\n* 提高网站速度：网站速度是搜索引擎排序的一个重要指标\n\n## Web 开发中会话跟踪的方法有哪些\nHTTP 是一种无状态协议，当用户发出请求时，服务器就会做出响应，客户端与服务端的联系是离散的，非连续的，当用户在同一个网站的多个页面之间转换时，根本无法确定是否是同一个用户，会话跟踪就可以解决这个问题。当一个用户在多个页面间切换时，服务就会保存该用户的信息。\n1. cookie\n2. session\n3. url 重写\n4. 隐藏input\n5. ip地址\n\n","slug":"优化","published":1,"updated":"2021-04-03T03:32:02.525Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1x90023l5v07tyehvyl","content":"<p>seo 优化整合</p>\n<span id=\"more\"></span>\n\n<ul>\n<li>合理的 title、description、keywords：搜索对着三项的权重逐个减小，title 值强调重点即可，重要关键词出现不要超过 2 次，而且要靠前，不同页面 title 要有所不同；description 把页面内容高度概括，长度合适，不可过分堆砌关键词，不同页面 description 有所不同；keywords 列举出重要关键词即可</li>\n<li>语义化的 HTML 代码，符合 W3C 规范：语义化代码让搜索引擎容易理解网页</li>\n<li>重要内容 HTML 代码放在最前：搜索引擎抓取 HTML 顺序是从上到下，有的搜索引擎对抓取长度有限制，保证重要内容一定会被抓取重要内容不要用 js 输出：爬虫不会执行 js 获取内容</li>\n<li>少用 iframe：搜索引擎不会抓取 iframe 中的内容</li>\n<li>非装饰性图片必须加 alt</li>\n<li>提高网站速度：网站速度是搜索引擎排序的一个重要指标</li>\n</ul>\n<h2 id=\"Web-开发中会话跟踪的方法有哪些\"><a href=\"#Web-开发中会话跟踪的方法有哪些\" class=\"headerlink\" title=\"Web 开发中会话跟踪的方法有哪些\"></a>Web 开发中会话跟踪的方法有哪些</h2><p>HTTP 是一种无状态协议，当用户发出请求时，服务器就会做出响应，客户端与服务端的联系是离散的，非连续的，当用户在同一个网站的多个页面之间转换时，根本无法确定是否是同一个用户，会话跟踪就可以解决这个问题。当一个用户在多个页面间切换时，服务就会保存该用户的信息。</p>\n<ol>\n<li>cookie</li>\n<li>session</li>\n<li>url 重写</li>\n<li>隐藏input</li>\n<li>ip地址</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>seo 优化整合</p>","more":"<ul>\n<li>合理的 title、description、keywords：搜索对着三项的权重逐个减小，title 值强调重点即可，重要关键词出现不要超过 2 次，而且要靠前，不同页面 title 要有所不同；description 把页面内容高度概括，长度合适，不可过分堆砌关键词，不同页面 description 有所不同；keywords 列举出重要关键词即可</li>\n<li>语义化的 HTML 代码，符合 W3C 规范：语义化代码让搜索引擎容易理解网页</li>\n<li>重要内容 HTML 代码放在最前：搜索引擎抓取 HTML 顺序是从上到下，有的搜索引擎对抓取长度有限制，保证重要内容一定会被抓取重要内容不要用 js 输出：爬虫不会执行 js 获取内容</li>\n<li>少用 iframe：搜索引擎不会抓取 iframe 中的内容</li>\n<li>非装饰性图片必须加 alt</li>\n<li>提高网站速度：网站速度是搜索引擎排序的一个重要指标</li>\n</ul>\n<h2 id=\"Web-开发中会话跟踪的方法有哪些\"><a href=\"#Web-开发中会话跟踪的方法有哪些\" class=\"headerlink\" title=\"Web 开发中会话跟踪的方法有哪些\"></a>Web 开发中会话跟踪的方法有哪些</h2><p>HTTP 是一种无状态协议，当用户发出请求时，服务器就会做出响应，客户端与服务端的联系是离散的，非连续的，当用户在同一个网站的多个页面之间转换时，根本无法确定是否是同一个用户，会话跟踪就可以解决这个问题。当一个用户在多个页面间切换时，服务就会保存该用户的信息。</p>\n<ol>\n<li>cookie</li>\n<li>session</li>\n<li>url 重写</li>\n<li>隐藏input</li>\n<li>ip地址</li>\n</ol>"},{"title":"作用域","date":"2018-01-23T03:30:11.000Z","_content":"\n1. 作用域是一套规则，用于确定在何处以及如何查找变量 ( 标识符 )。如果查找的目的是为变量进行赋值，那么就会使用 LHS，如果查找的目的是获取变量的值，就会使用 RHS 查询\n2. 无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由函数被声明时所处的位置决定。\n\n<!--more-->\n\n## 欺骗词法作用域\n\n1. eval(), 可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在程序中这个位置的代码。通常被用来执行动态创建的代码。\n\n   ```javascript\n   function foo(str, a) {\n   eval( str ); // 欺骗！\n   console.log( a, b );\n   } v\n   ar b = 2;\n   foo( \"var b = 3;\", 1 ); // 1, 3\n   ```\n\n2. with ，通常被当做重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域，因此这个对象的属性也会处理为定义在这个作用域中的词法标识符。\n3. js 引擎会在编译阶段进行属相的性能优化。其中有些优化依赖于能够根据代码的词法进行静态分析，并预先确定所有变量和函数的定义位置，才能在执行阶段快速找到标志符，如果引擎发现可 eval 和with，它只能简单的假设关于标识符位子的判断都是无效的，因为无法再词法分析阶段明确知道 eval() 会接受到什么代码，这些代码会如何对作用域进行修改，也无法知道传递给 with 用来创建新词法作用域的对象的内容到底是什么.\n\n## var a = 2\n\n编译器会进行如下的处理：\n\n1. 遇到 var a，编译器会询问作用域是否已经有一个该名称的变量存在于同一个作用域的集合中。如果是，编译器会忽略该声明，继续进行编译；否则它会要求作用域在当前作用域的集合中声明一个新的变量，并命名为 a。\n2. 接下来编译器会为引擎生成运行时所需的代码，这些代码被用来处理 a = 2 这个赋值操作。引擎运行时会首先询问作用域，在当前的作用域集合中是否存在一个叫作 a 的变量。如果否，引擎就会使用这个变量；如果不是，引擎会继续查找该变量，如果引擎最终找到了 a 变量，就会将 2 赋值给它。否则引擎就会举手示意并抛出一个异常！\n\n总结：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。\n\n编译器在编译过程的第二步中生成了代码，引擎执行它时，会通过查找变量 a 来判断它是否已声明过。查找的过程由作用域进行协助，但是引擎执行怎样的查找，会影响最终的查找结果。\n\n在我们的例子中，引擎会为变量 a 进行 LHS 查询。另外一个查找类型叫做 RHS\n\n1. LHS: 赋值操作的目标是谁\n1. RHS：谁是赋值操作的源头\n\n---\n\n当一个块或者函数嵌套在另一个块或函数中时，就发生了作用于的嵌套。因此作用域中无法找到某个变量是，就会在外层嵌套的作用域中继续查找，知道找到该变量，或抵达最外层的作用域为 ( 也就是全局作用域 ) 止。\n\n遍历嵌套作用域链的规则很简单：引擎从当前的执行作用域开始查找变量，如果找不到，就向上一级继续查找。当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都会停止。\n\n---\n\n## 函数作用域和块作用域\n\n函数作用域的含义是指，属于这个函数的全部变量都可以在整个函数的范围内使用及复用 ( 事实上在嵌套的作用用户中也可以使用 )\n\n1. 立即执行函数会被当做函数表达式而不是一个标准的函数声明来处理，函数声明和函数表达式之间最重要的区别是他们的名称标识符将会绑定在何处。\n2. 直接在全局中声明的函数是并绑定在全局作用域中，而立即执行函数被绑定在函数表达式自身的函数中而不是所在作用域中。\n3. 当使用 var 声明变量时，它写在哪儿都是一样的，因为它们最终都会属于外部作用域。\n\n**提升是指声明会被视为存在于其所出现的作用域的整个范围内。但是使用 let 进行的声明不会再块级作用域中进行提升。声明的代码被运行之前，声明并不 “ 存在 ”。**\n\n---\n\n## 提升\n\n任何声明在某个作用域内的变量，都将属于这个作用域\n\n包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理。声明将被提升到顶部，而赋值语句将被留在原地等待执行阶段。只有声明本身会被提升，而赋值或其他运行逻辑会留在原地。如果提升改变了戴安执行的顺序，会照成非常严重的破坏。\n\n函数声明和变量声明都会被提升。但是函数会首先被提升，然后才是变量。尽管重复的声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。\n\nvar a = 2; 被分为两个阶段，一个是编译阶段的任务，而第二个是执行阶段的任务。\n\n---\n\n## 动态作用域\n\n```javascript\n词法作用域是一套关于引擎如何寻找变量以及会在何处找到变量的规则。动态作用域最重要的特征是它的定义过程发生在代码的书写阶段。\nfunction foo() {\nconsole.log( a ); // 2\n} f\nunction bar() {\nvar a = 3;\nfoo();\n} v\nar a = 2;\nbar();\n```\n\n此法作用域让 foo() 中的 a 通过 RHS 引用了全局作用域的 a，所以会输出 2;\n\n而动态作用域并不关心函数和作用域是如何声明以及在何处声明的，值关心它们从何处调用，换句话说，作用域链是基于调用栈的，而不是代码中的作用域嵌套。因此如果 js 具有动态作用域就会输出 3。什么会这样？因为当 foo() 无法找到 a 的变量引用时，会顺着调用栈在调用 foo() 的地方查找 a，而不是在嵌套的词法作用域链中向上查找。由于 foo() 是在 bar() 中调用的，引擎会检查 bar() 的作用域，并在其中找到值为 3 的变量 a。\n\n事实上 js 并不具备动态作用域。它只有词法作用域，但是 this 机制某种程度上很像动态作用域。\n\n**词法作用域是在写代码或者说定义时确定的**，而动态作用域是在运动时确定的。(this 也是 )，词法作用域关注函数在何处声明，而动态作用域关注函数从何处调用。\n","source":"_posts/作用域.md","raw":"---\ntitle: 作用域\ndate: 2018-01-23 11:30:11\ncategories: JavaScript\n---\n\n1. 作用域是一套规则，用于确定在何处以及如何查找变量 ( 标识符 )。如果查找的目的是为变量进行赋值，那么就会使用 LHS，如果查找的目的是获取变量的值，就会使用 RHS 查询\n2. 无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由函数被声明时所处的位置决定。\n\n<!--more-->\n\n## 欺骗词法作用域\n\n1. eval(), 可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在程序中这个位置的代码。通常被用来执行动态创建的代码。\n\n   ```javascript\n   function foo(str, a) {\n   eval( str ); // 欺骗！\n   console.log( a, b );\n   } v\n   ar b = 2;\n   foo( \"var b = 3;\", 1 ); // 1, 3\n   ```\n\n2. with ，通常被当做重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域，因此这个对象的属性也会处理为定义在这个作用域中的词法标识符。\n3. js 引擎会在编译阶段进行属相的性能优化。其中有些优化依赖于能够根据代码的词法进行静态分析，并预先确定所有变量和函数的定义位置，才能在执行阶段快速找到标志符，如果引擎发现可 eval 和with，它只能简单的假设关于标识符位子的判断都是无效的，因为无法再词法分析阶段明确知道 eval() 会接受到什么代码，这些代码会如何对作用域进行修改，也无法知道传递给 with 用来创建新词法作用域的对象的内容到底是什么.\n\n## var a = 2\n\n编译器会进行如下的处理：\n\n1. 遇到 var a，编译器会询问作用域是否已经有一个该名称的变量存在于同一个作用域的集合中。如果是，编译器会忽略该声明，继续进行编译；否则它会要求作用域在当前作用域的集合中声明一个新的变量，并命名为 a。\n2. 接下来编译器会为引擎生成运行时所需的代码，这些代码被用来处理 a = 2 这个赋值操作。引擎运行时会首先询问作用域，在当前的作用域集合中是否存在一个叫作 a 的变量。如果否，引擎就会使用这个变量；如果不是，引擎会继续查找该变量，如果引擎最终找到了 a 变量，就会将 2 赋值给它。否则引擎就会举手示意并抛出一个异常！\n\n总结：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。\n\n编译器在编译过程的第二步中生成了代码，引擎执行它时，会通过查找变量 a 来判断它是否已声明过。查找的过程由作用域进行协助，但是引擎执行怎样的查找，会影响最终的查找结果。\n\n在我们的例子中，引擎会为变量 a 进行 LHS 查询。另外一个查找类型叫做 RHS\n\n1. LHS: 赋值操作的目标是谁\n1. RHS：谁是赋值操作的源头\n\n---\n\n当一个块或者函数嵌套在另一个块或函数中时，就发生了作用于的嵌套。因此作用域中无法找到某个变量是，就会在外层嵌套的作用域中继续查找，知道找到该变量，或抵达最外层的作用域为 ( 也就是全局作用域 ) 止。\n\n遍历嵌套作用域链的规则很简单：引擎从当前的执行作用域开始查找变量，如果找不到，就向上一级继续查找。当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都会停止。\n\n---\n\n## 函数作用域和块作用域\n\n函数作用域的含义是指，属于这个函数的全部变量都可以在整个函数的范围内使用及复用 ( 事实上在嵌套的作用用户中也可以使用 )\n\n1. 立即执行函数会被当做函数表达式而不是一个标准的函数声明来处理，函数声明和函数表达式之间最重要的区别是他们的名称标识符将会绑定在何处。\n2. 直接在全局中声明的函数是并绑定在全局作用域中，而立即执行函数被绑定在函数表达式自身的函数中而不是所在作用域中。\n3. 当使用 var 声明变量时，它写在哪儿都是一样的，因为它们最终都会属于外部作用域。\n\n**提升是指声明会被视为存在于其所出现的作用域的整个范围内。但是使用 let 进行的声明不会再块级作用域中进行提升。声明的代码被运行之前，声明并不 “ 存在 ”。**\n\n---\n\n## 提升\n\n任何声明在某个作用域内的变量，都将属于这个作用域\n\n包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理。声明将被提升到顶部，而赋值语句将被留在原地等待执行阶段。只有声明本身会被提升，而赋值或其他运行逻辑会留在原地。如果提升改变了戴安执行的顺序，会照成非常严重的破坏。\n\n函数声明和变量声明都会被提升。但是函数会首先被提升，然后才是变量。尽管重复的声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。\n\nvar a = 2; 被分为两个阶段，一个是编译阶段的任务，而第二个是执行阶段的任务。\n\n---\n\n## 动态作用域\n\n```javascript\n词法作用域是一套关于引擎如何寻找变量以及会在何处找到变量的规则。动态作用域最重要的特征是它的定义过程发生在代码的书写阶段。\nfunction foo() {\nconsole.log( a ); // 2\n} f\nunction bar() {\nvar a = 3;\nfoo();\n} v\nar a = 2;\nbar();\n```\n\n此法作用域让 foo() 中的 a 通过 RHS 引用了全局作用域的 a，所以会输出 2;\n\n而动态作用域并不关心函数和作用域是如何声明以及在何处声明的，值关心它们从何处调用，换句话说，作用域链是基于调用栈的，而不是代码中的作用域嵌套。因此如果 js 具有动态作用域就会输出 3。什么会这样？因为当 foo() 无法找到 a 的变量引用时，会顺着调用栈在调用 foo() 的地方查找 a，而不是在嵌套的词法作用域链中向上查找。由于 foo() 是在 bar() 中调用的，引擎会检查 bar() 的作用域，并在其中找到值为 3 的变量 a。\n\n事实上 js 并不具备动态作用域。它只有词法作用域，但是 this 机制某种程度上很像动态作用域。\n\n**词法作用域是在写代码或者说定义时确定的**，而动态作用域是在运动时确定的。(this 也是 )，词法作用域关注函数在何处声明，而动态作用域关注函数从何处调用。\n","slug":"作用域","published":1,"updated":"2021-02-27T12:24:38.488Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xa0026l5v09hqndg2v","content":"<ol>\n<li>作用域是一套规则，用于确定在何处以及如何查找变量 ( 标识符 )。如果查找的目的是为变量进行赋值，那么就会使用 LHS，如果查找的目的是获取变量的值，就会使用 RHS 查询</li>\n<li>无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由函数被声明时所处的位置决定。</li>\n</ol>\n<span id=\"more\"></span>\n\n<h2 id=\"欺骗词法作用域\"><a href=\"#欺骗词法作用域\" class=\"headerlink\" title=\"欺骗词法作用域\"></a>欺骗词法作用域</h2><ol>\n<li><p>eval(), 可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在程序中这个位置的代码。通常被用来执行动态创建的代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">str, a</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"built_in\">eval</span>( str ); <span class=\"comment\">// 欺骗！</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( a, b );</span><br><span class=\"line\">&#125; v</span><br><span class=\"line\">ar b = <span class=\"number\">2</span>;</span><br><span class=\"line\">foo( <span class=\"string\">&quot;var b = 3;&quot;</span>, <span class=\"number\">1</span> ); <span class=\"comment\">// 1, 3</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>with ，通常被当做重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域，因此这个对象的属性也会处理为定义在这个作用域中的词法标识符。</p>\n</li>\n<li><p>js 引擎会在编译阶段进行属相的性能优化。其中有些优化依赖于能够根据代码的词法进行静态分析，并预先确定所有变量和函数的定义位置，才能在执行阶段快速找到标志符，如果引擎发现可 eval 和with，它只能简单的假设关于标识符位子的判断都是无效的，因为无法再词法分析阶段明确知道 eval() 会接受到什么代码，这些代码会如何对作用域进行修改，也无法知道传递给 with 用来创建新词法作用域的对象的内容到底是什么.</p>\n</li>\n</ol>\n<h2 id=\"var-a-2\"><a href=\"#var-a-2\" class=\"headerlink\" title=\"var a = 2\"></a>var a = 2</h2><p>编译器会进行如下的处理：</p>\n<ol>\n<li>遇到 var a，编译器会询问作用域是否已经有一个该名称的变量存在于同一个作用域的集合中。如果是，编译器会忽略该声明，继续进行编译；否则它会要求作用域在当前作用域的集合中声明一个新的变量，并命名为 a。</li>\n<li>接下来编译器会为引擎生成运行时所需的代码，这些代码被用来处理 a = 2 这个赋值操作。引擎运行时会首先询问作用域，在当前的作用域集合中是否存在一个叫作 a 的变量。如果否，引擎就会使用这个变量；如果不是，引擎会继续查找该变量，如果引擎最终找到了 a 变量，就会将 2 赋值给它。否则引擎就会举手示意并抛出一个异常！</li>\n</ol>\n<p>总结：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。</p>\n<p>编译器在编译过程的第二步中生成了代码，引擎执行它时，会通过查找变量 a 来判断它是否已声明过。查找的过程由作用域进行协助，但是引擎执行怎样的查找，会影响最终的查找结果。</p>\n<p>在我们的例子中，引擎会为变量 a 进行 LHS 查询。另外一个查找类型叫做 RHS</p>\n<ol>\n<li>LHS: 赋值操作的目标是谁</li>\n<li>RHS：谁是赋值操作的源头</li>\n</ol>\n<hr>\n<p>当一个块或者函数嵌套在另一个块或函数中时，就发生了作用于的嵌套。因此作用域中无法找到某个变量是，就会在外层嵌套的作用域中继续查找，知道找到该变量，或抵达最外层的作用域为 ( 也就是全局作用域 ) 止。</p>\n<p>遍历嵌套作用域链的规则很简单：引擎从当前的执行作用域开始查找变量，如果找不到，就向上一级继续查找。当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都会停止。</p>\n<hr>\n<h2 id=\"函数作用域和块作用域\"><a href=\"#函数作用域和块作用域\" class=\"headerlink\" title=\"函数作用域和块作用域\"></a>函数作用域和块作用域</h2><p>函数作用域的含义是指，属于这个函数的全部变量都可以在整个函数的范围内使用及复用 ( 事实上在嵌套的作用用户中也可以使用 )</p>\n<ol>\n<li>立即执行函数会被当做函数表达式而不是一个标准的函数声明来处理，函数声明和函数表达式之间最重要的区别是他们的名称标识符将会绑定在何处。</li>\n<li>直接在全局中声明的函数是并绑定在全局作用域中，而立即执行函数被绑定在函数表达式自身的函数中而不是所在作用域中。</li>\n<li>当使用 var 声明变量时，它写在哪儿都是一样的，因为它们最终都会属于外部作用域。</li>\n</ol>\n<p><strong>提升是指声明会被视为存在于其所出现的作用域的整个范围内。但是使用 let 进行的声明不会再块级作用域中进行提升。声明的代码被运行之前，声明并不 “ 存在 ”。</strong></p>\n<hr>\n<h2 id=\"提升\"><a href=\"#提升\" class=\"headerlink\" title=\"提升\"></a>提升</h2><p>任何声明在某个作用域内的变量，都将属于这个作用域</p>\n<p>包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理。声明将被提升到顶部，而赋值语句将被留在原地等待执行阶段。只有声明本身会被提升，而赋值或其他运行逻辑会留在原地。如果提升改变了戴安执行的顺序，会照成非常严重的破坏。</p>\n<p>函数声明和变量声明都会被提升。但是函数会首先被提升，然后才是变量。尽管重复的声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。</p>\n<p>var a = 2; 被分为两个阶段，一个是编译阶段的任务，而第二个是执行阶段的任务。</p>\n<hr>\n<h2 id=\"动态作用域\"><a href=\"#动态作用域\" class=\"headerlink\" title=\"动态作用域\"></a>动态作用域</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">词法作用域是一套关于引擎如何寻找变量以及会在何处找到变量的规则。动态作用域最重要的特征是它的定义过程发生在代码的书写阶段。</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">&#125; f</span><br><span class=\"line\">unction <span class=\"function\"><span class=\"title\">bar</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">3</span>;</span><br><span class=\"line\">foo();</span><br><span class=\"line\">&#125; v</span><br><span class=\"line\">ar a = <span class=\"number\">2</span>;</span><br><span class=\"line\">bar();</span><br></pre></td></tr></table></figure>\n\n<p>此法作用域让 foo() 中的 a 通过 RHS 引用了全局作用域的 a，所以会输出 2;</p>\n<p>而动态作用域并不关心函数和作用域是如何声明以及在何处声明的，值关心它们从何处调用，换句话说，作用域链是基于调用栈的，而不是代码中的作用域嵌套。因此如果 js 具有动态作用域就会输出 3。什么会这样？因为当 foo() 无法找到 a 的变量引用时，会顺着调用栈在调用 foo() 的地方查找 a，而不是在嵌套的词法作用域链中向上查找。由于 foo() 是在 bar() 中调用的，引擎会检查 bar() 的作用域，并在其中找到值为 3 的变量 a。</p>\n<p>事实上 js 并不具备动态作用域。它只有词法作用域，但是 this 机制某种程度上很像动态作用域。</p>\n<p><strong>词法作用域是在写代码或者说定义时确定的</strong>，而动态作用域是在运动时确定的。(this 也是 )，词法作用域关注函数在何处声明，而动态作用域关注函数从何处调用。</p>\n","site":{"data":{}},"excerpt":"<ol>\n<li>作用域是一套规则，用于确定在何处以及如何查找变量 ( 标识符 )。如果查找的目的是为变量进行赋值，那么就会使用 LHS，如果查找的目的是获取变量的值，就会使用 RHS 查询</li>\n<li>无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由函数被声明时所处的位置决定。</li>\n</ol>","more":"<h2 id=\"欺骗词法作用域\"><a href=\"#欺骗词法作用域\" class=\"headerlink\" title=\"欺骗词法作用域\"></a>欺骗词法作用域</h2><ol>\n<li><p>eval(), 可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在程序中这个位置的代码。通常被用来执行动态创建的代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">str, a</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"built_in\">eval</span>( str ); <span class=\"comment\">// 欺骗！</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( a, b );</span><br><span class=\"line\">&#125; v</span><br><span class=\"line\">ar b = <span class=\"number\">2</span>;</span><br><span class=\"line\">foo( <span class=\"string\">&quot;var b = 3;&quot;</span>, <span class=\"number\">1</span> ); <span class=\"comment\">// 1, 3</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>with ，通常被当做重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域，因此这个对象的属性也会处理为定义在这个作用域中的词法标识符。</p>\n</li>\n<li><p>js 引擎会在编译阶段进行属相的性能优化。其中有些优化依赖于能够根据代码的词法进行静态分析，并预先确定所有变量和函数的定义位置，才能在执行阶段快速找到标志符，如果引擎发现可 eval 和with，它只能简单的假设关于标识符位子的判断都是无效的，因为无法再词法分析阶段明确知道 eval() 会接受到什么代码，这些代码会如何对作用域进行修改，也无法知道传递给 with 用来创建新词法作用域的对象的内容到底是什么.</p>\n</li>\n</ol>\n<h2 id=\"var-a-2\"><a href=\"#var-a-2\" class=\"headerlink\" title=\"var a = 2\"></a>var a = 2</h2><p>编译器会进行如下的处理：</p>\n<ol>\n<li>遇到 var a，编译器会询问作用域是否已经有一个该名称的变量存在于同一个作用域的集合中。如果是，编译器会忽略该声明，继续进行编译；否则它会要求作用域在当前作用域的集合中声明一个新的变量，并命名为 a。</li>\n<li>接下来编译器会为引擎生成运行时所需的代码，这些代码被用来处理 a = 2 这个赋值操作。引擎运行时会首先询问作用域，在当前的作用域集合中是否存在一个叫作 a 的变量。如果否，引擎就会使用这个变量；如果不是，引擎会继续查找该变量，如果引擎最终找到了 a 变量，就会将 2 赋值给它。否则引擎就会举手示意并抛出一个异常！</li>\n</ol>\n<p>总结：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。</p>\n<p>编译器在编译过程的第二步中生成了代码，引擎执行它时，会通过查找变量 a 来判断它是否已声明过。查找的过程由作用域进行协助，但是引擎执行怎样的查找，会影响最终的查找结果。</p>\n<p>在我们的例子中，引擎会为变量 a 进行 LHS 查询。另外一个查找类型叫做 RHS</p>\n<ol>\n<li>LHS: 赋值操作的目标是谁</li>\n<li>RHS：谁是赋值操作的源头</li>\n</ol>\n<hr>\n<p>当一个块或者函数嵌套在另一个块或函数中时，就发生了作用于的嵌套。因此作用域中无法找到某个变量是，就会在外层嵌套的作用域中继续查找，知道找到该变量，或抵达最外层的作用域为 ( 也就是全局作用域 ) 止。</p>\n<p>遍历嵌套作用域链的规则很简单：引擎从当前的执行作用域开始查找变量，如果找不到，就向上一级继续查找。当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都会停止。</p>\n<hr>\n<h2 id=\"函数作用域和块作用域\"><a href=\"#函数作用域和块作用域\" class=\"headerlink\" title=\"函数作用域和块作用域\"></a>函数作用域和块作用域</h2><p>函数作用域的含义是指，属于这个函数的全部变量都可以在整个函数的范围内使用及复用 ( 事实上在嵌套的作用用户中也可以使用 )</p>\n<ol>\n<li>立即执行函数会被当做函数表达式而不是一个标准的函数声明来处理，函数声明和函数表达式之间最重要的区别是他们的名称标识符将会绑定在何处。</li>\n<li>直接在全局中声明的函数是并绑定在全局作用域中，而立即执行函数被绑定在函数表达式自身的函数中而不是所在作用域中。</li>\n<li>当使用 var 声明变量时，它写在哪儿都是一样的，因为它们最终都会属于外部作用域。</li>\n</ol>\n<p><strong>提升是指声明会被视为存在于其所出现的作用域的整个范围内。但是使用 let 进行的声明不会再块级作用域中进行提升。声明的代码被运行之前，声明并不 “ 存在 ”。</strong></p>\n<hr>\n<h2 id=\"提升\"><a href=\"#提升\" class=\"headerlink\" title=\"提升\"></a>提升</h2><p>任何声明在某个作用域内的变量，都将属于这个作用域</p>\n<p>包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理。声明将被提升到顶部，而赋值语句将被留在原地等待执行阶段。只有声明本身会被提升，而赋值或其他运行逻辑会留在原地。如果提升改变了戴安执行的顺序，会照成非常严重的破坏。</p>\n<p>函数声明和变量声明都会被提升。但是函数会首先被提升，然后才是变量。尽管重复的声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。</p>\n<p>var a = 2; 被分为两个阶段，一个是编译阶段的任务，而第二个是执行阶段的任务。</p>\n<hr>\n<h2 id=\"动态作用域\"><a href=\"#动态作用域\" class=\"headerlink\" title=\"动态作用域\"></a>动态作用域</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">词法作用域是一套关于引擎如何寻找变量以及会在何处找到变量的规则。动态作用域最重要的特征是它的定义过程发生在代码的书写阶段。</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">&#125; f</span><br><span class=\"line\">unction <span class=\"function\"><span class=\"title\">bar</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">3</span>;</span><br><span class=\"line\">foo();</span><br><span class=\"line\">&#125; v</span><br><span class=\"line\">ar a = <span class=\"number\">2</span>;</span><br><span class=\"line\">bar();</span><br></pre></td></tr></table></figure>\n\n<p>此法作用域让 foo() 中的 a 通过 RHS 引用了全局作用域的 a，所以会输出 2;</p>\n<p>而动态作用域并不关心函数和作用域是如何声明以及在何处声明的，值关心它们从何处调用，换句话说，作用域链是基于调用栈的，而不是代码中的作用域嵌套。因此如果 js 具有动态作用域就会输出 3。什么会这样？因为当 foo() 无法找到 a 的变量引用时，会顺着调用栈在调用 foo() 的地方查找 a，而不是在嵌套的词法作用域链中向上查找。由于 foo() 是在 bar() 中调用的，引擎会检查 bar() 的作用域，并在其中找到值为 3 的变量 a。</p>\n<p>事实上 js 并不具备动态作用域。它只有词法作用域，但是 this 机制某种程度上很像动态作用域。</p>\n<p><strong>词法作用域是在写代码或者说定义时确定的</strong>，而动态作用域是在运动时确定的。(this 也是 )，词法作用域关注函数在何处声明，而动态作用域关注函数从何处调用。</p>"},{"title":"函数柯里化","date":"2018-05-24T02:35:37.000Z","_content":"\n函数柯里化是把接受多个参数的函数转变成接受一个单一参数（最初函数的第一个参数），并且返回接受余下的参数而且返回结果的新函数的技术。\n\n<!--more-->\n\n# 理解函数柯里化\n\n通用函数解决兼容性问题，但是同时也会带来使用不便性，不同的应用场景旺旺要传递很多参数，已达到解决特定的目的，有时应用中，会对同一个规则进行反复使用，这样就造成了代码的重复性。\n\n```javascript\nfunction square(i) {\n  return i * i\n}\nfunction dubble(i) {\n  return (i *= 2)\n}\nfunction map(handeler, list) {\n  return list.map(handeler)\n}\n// 数组的每一项平方\nmap(square, [1, 2, 3, 4, 5])\nmap(square, [6, 7, 8, 9, 10])\nmap(square, [10, 20, 30, 40, 50])\n\n// 数组的每一项加倍\nmap(dubble, [1, 2, 3, 4, 5])\nmap(dubble, [6, 7, 8, 9, 10])\nmap(dubble, [10, 20, 30, 40, 50])\n```\n\n例子中，创建了一个 map 通用函数，用于适应不同的应用场景。显然，通用性不用怀疑。同时，例子中重复传入了相同的处理函数：square 和 dubble。\n\n下面可以利用柯里化改造一下：\n\n```javascript\nfunction square(i) {\n  return i * 1\n}\n\nfunction dubble(i) {\n  return (i *= 2)\n}\n\nfunction map(handeler, list) {\n  return list.map(handeler)\n}\n\nvar mapSQ = currying(map, square)\nmapSQ([1, 2, 3, 4, 5])\nmapSQ([6, 7, 8, 9, 10])\nmapSQ([10, 20, 30, 40, 50])\n\nvar mapDB = currying(map, dubble)\nmapDB([1, 2, 3, 4, 5])\nmapDB([6, 7, 8, 9, 10])\nmapDB([10, 20, 30, 40, 50])\n```\n\n```javascript\nvar currying = function (fn) {\n  var args = [].slice.call(arguments, 1) // 截取arguments中的第一个生成一个数组，也就是当前语境下的明面上的合法老婆\n  console.log(args) //合法老婆\n  return function () {\n    // 将已有的参数和新传进来的参数合并为一个数组，对应已有的合法老婆和新搞定的老婆\n    var newArgs = args.concat([].slice.call(arguments))\n    // 将所有的参数newArgs绑定给fn~\n    return fn.apply(null, newArgs)\n  }\n}\n\n// 下面为官员如何搞定7个老婆做测试\n// 获得合法老婆\nvar getWife = currying(function () {\n  var allWife = [].slice.call(arguments)\n  console.log(allWife.join(','))\n}, '合法老婆')\n// 获得其他6个老婆\ngetWife('小老婆1', '小老婆2', '小老婆3', '小老婆4', '小老婆5', '小老婆6') //合法老婆,小老婆1\", \"小老婆2\", \"小老婆3\", \"小老婆4\", \"小老婆5\", \"小老婆6\"\n// 换一批老婆\ngetWife('大老婆', '小老婆', '俏老婆', '刁蛮老婆', '乖老婆', '送上门老婆') //合法老婆,\"大老婆\", \"小老婆\", \"俏老婆\", \"刁蛮老婆\", \"乖老婆\", \"送上门老婆\"\n// 再换一批老婆\ngetWife('超越韦小宝的老婆') //合法老婆\"大老婆\", \"小老婆\", \"俏老婆\", \"刁蛮老婆\", \"乖老婆\", \"送上门老婆\"\n```\n\n无论输入多少个参数嘛都会打印输出，且都会带第一个参数，上文代码`fn.applay(null,newArgs)`中的`null`本事应该制定 fn 中 this 的指向的对象，没有就用 null。\n\n## 实用场景\n\n- 参数复用（上文中的合法老婆）\n- 提前返回，下面是一个兼容现代浏览器以及 IE 浏览器的事件添加方法：\n\n### 事件添加处理\n\n```javascript\nvar addEvent = function (el, type, fn, capture) {\n  if (window.addEventListenner) {\n    el.addEventListenner(\n      type,\n      function (e) {\n        fn.call(el, e)\n      },\n      capture\n    )\n  } else if (window.attachEvent) {\n    el.attachEvent('on' + type, function (e) {\n      fn.call(el, e)\n    })\n  }\n}\n```\n\n在使用 addEvent 为元素添加事件的时候，（eg.IE6/IE7）都会走一遍 if--else,其实只要判定一次就可以了。\n\n```javascript\nvar addEvent = (function () {\n  if (window.addEventListenner) {\n    return function (el, sType, fn, capture) {\n      el.addEventListenner(\n        sType,\n        function (e) {\n          fn.call(el, e)\n        },\n        capture\n      )\n    }\n  } else if (window.attachEvert) {\n    return function (el, sType, fn, capture) {\n      el.attachEvent('on' + sType, function (e) {\n        fn.call(el, e)\n      })\n    }\n  }\n})()\n```\n\n### 延时计算\n\n```javascript\nvar curryWeigth = function (fn) {\n  var _weight = []\n  return function () {\n    if (arguments.length == 0) {\n      return fn.applay(null, _weight)\n    } else {\n      _weight = _weight.concat([].slice.call(arguments))\n    }\n  }\n}\nvar weight = 0\nvar addWeight = curryWeight(function () {\n  var i = 0\n  len = arguments.length\n  for (i; i < len; i += 1) {\n    weight += arguments[i]\n  }\n})\n\naddWeidht(2.3)\naddWeidht(6.5)\naddWeidht(1.2)\naddWeidht() //到这里才开始计算\n\nconsole.log(weight)\n\n//实际上就是利用的闭包而已\n```\n\n### 无限级累加器\n\n```javascript\n//利用闭包的思想\nfucntion add(...args){\n  let sum = args.reduce((target,value)=>target+v,0)\n  function s(...sargs){\n    sum = sargs.reduce((target,v)=>target+v,sum)\n    return s\n  }\n  s.toString = function(){\n    return sum\n  }\n  return s\n}\nadd(1,2)(2)(3)\nƒ 8\nadd(1,2)(2)(3)(4)\nƒ 12\nadd(1,2)(2)(3)(4)(12)\nƒ 24\n\n```\n","source":"_posts/函数柯里化.md","raw":"---\ntitle: 函数柯里化\ndate: 2018-05-24 10:35:37\ncategories: JavaScript\n---\n\n函数柯里化是把接受多个参数的函数转变成接受一个单一参数（最初函数的第一个参数），并且返回接受余下的参数而且返回结果的新函数的技术。\n\n<!--more-->\n\n# 理解函数柯里化\n\n通用函数解决兼容性问题，但是同时也会带来使用不便性，不同的应用场景旺旺要传递很多参数，已达到解决特定的目的，有时应用中，会对同一个规则进行反复使用，这样就造成了代码的重复性。\n\n```javascript\nfunction square(i) {\n  return i * i\n}\nfunction dubble(i) {\n  return (i *= 2)\n}\nfunction map(handeler, list) {\n  return list.map(handeler)\n}\n// 数组的每一项平方\nmap(square, [1, 2, 3, 4, 5])\nmap(square, [6, 7, 8, 9, 10])\nmap(square, [10, 20, 30, 40, 50])\n\n// 数组的每一项加倍\nmap(dubble, [1, 2, 3, 4, 5])\nmap(dubble, [6, 7, 8, 9, 10])\nmap(dubble, [10, 20, 30, 40, 50])\n```\n\n例子中，创建了一个 map 通用函数，用于适应不同的应用场景。显然，通用性不用怀疑。同时，例子中重复传入了相同的处理函数：square 和 dubble。\n\n下面可以利用柯里化改造一下：\n\n```javascript\nfunction square(i) {\n  return i * 1\n}\n\nfunction dubble(i) {\n  return (i *= 2)\n}\n\nfunction map(handeler, list) {\n  return list.map(handeler)\n}\n\nvar mapSQ = currying(map, square)\nmapSQ([1, 2, 3, 4, 5])\nmapSQ([6, 7, 8, 9, 10])\nmapSQ([10, 20, 30, 40, 50])\n\nvar mapDB = currying(map, dubble)\nmapDB([1, 2, 3, 4, 5])\nmapDB([6, 7, 8, 9, 10])\nmapDB([10, 20, 30, 40, 50])\n```\n\n```javascript\nvar currying = function (fn) {\n  var args = [].slice.call(arguments, 1) // 截取arguments中的第一个生成一个数组，也就是当前语境下的明面上的合法老婆\n  console.log(args) //合法老婆\n  return function () {\n    // 将已有的参数和新传进来的参数合并为一个数组，对应已有的合法老婆和新搞定的老婆\n    var newArgs = args.concat([].slice.call(arguments))\n    // 将所有的参数newArgs绑定给fn~\n    return fn.apply(null, newArgs)\n  }\n}\n\n// 下面为官员如何搞定7个老婆做测试\n// 获得合法老婆\nvar getWife = currying(function () {\n  var allWife = [].slice.call(arguments)\n  console.log(allWife.join(','))\n}, '合法老婆')\n// 获得其他6个老婆\ngetWife('小老婆1', '小老婆2', '小老婆3', '小老婆4', '小老婆5', '小老婆6') //合法老婆,小老婆1\", \"小老婆2\", \"小老婆3\", \"小老婆4\", \"小老婆5\", \"小老婆6\"\n// 换一批老婆\ngetWife('大老婆', '小老婆', '俏老婆', '刁蛮老婆', '乖老婆', '送上门老婆') //合法老婆,\"大老婆\", \"小老婆\", \"俏老婆\", \"刁蛮老婆\", \"乖老婆\", \"送上门老婆\"\n// 再换一批老婆\ngetWife('超越韦小宝的老婆') //合法老婆\"大老婆\", \"小老婆\", \"俏老婆\", \"刁蛮老婆\", \"乖老婆\", \"送上门老婆\"\n```\n\n无论输入多少个参数嘛都会打印输出，且都会带第一个参数，上文代码`fn.applay(null,newArgs)`中的`null`本事应该制定 fn 中 this 的指向的对象，没有就用 null。\n\n## 实用场景\n\n- 参数复用（上文中的合法老婆）\n- 提前返回，下面是一个兼容现代浏览器以及 IE 浏览器的事件添加方法：\n\n### 事件添加处理\n\n```javascript\nvar addEvent = function (el, type, fn, capture) {\n  if (window.addEventListenner) {\n    el.addEventListenner(\n      type,\n      function (e) {\n        fn.call(el, e)\n      },\n      capture\n    )\n  } else if (window.attachEvent) {\n    el.attachEvent('on' + type, function (e) {\n      fn.call(el, e)\n    })\n  }\n}\n```\n\n在使用 addEvent 为元素添加事件的时候，（eg.IE6/IE7）都会走一遍 if--else,其实只要判定一次就可以了。\n\n```javascript\nvar addEvent = (function () {\n  if (window.addEventListenner) {\n    return function (el, sType, fn, capture) {\n      el.addEventListenner(\n        sType,\n        function (e) {\n          fn.call(el, e)\n        },\n        capture\n      )\n    }\n  } else if (window.attachEvert) {\n    return function (el, sType, fn, capture) {\n      el.attachEvent('on' + sType, function (e) {\n        fn.call(el, e)\n      })\n    }\n  }\n})()\n```\n\n### 延时计算\n\n```javascript\nvar curryWeigth = function (fn) {\n  var _weight = []\n  return function () {\n    if (arguments.length == 0) {\n      return fn.applay(null, _weight)\n    } else {\n      _weight = _weight.concat([].slice.call(arguments))\n    }\n  }\n}\nvar weight = 0\nvar addWeight = curryWeight(function () {\n  var i = 0\n  len = arguments.length\n  for (i; i < len; i += 1) {\n    weight += arguments[i]\n  }\n})\n\naddWeidht(2.3)\naddWeidht(6.5)\naddWeidht(1.2)\naddWeidht() //到这里才开始计算\n\nconsole.log(weight)\n\n//实际上就是利用的闭包而已\n```\n\n### 无限级累加器\n\n```javascript\n//利用闭包的思想\nfucntion add(...args){\n  let sum = args.reduce((target,value)=>target+v,0)\n  function s(...sargs){\n    sum = sargs.reduce((target,v)=>target+v,sum)\n    return s\n  }\n  s.toString = function(){\n    return sum\n  }\n  return s\n}\nadd(1,2)(2)(3)\nƒ 8\nadd(1,2)(2)(3)(4)\nƒ 12\nadd(1,2)(2)(3)(4)(12)\nƒ 24\n\n```\n","slug":"函数柯里化","published":1,"updated":"2021-04-03T08:28:12.054Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xb0028l5v0fyty9oa0","content":"<p>函数柯里化是把接受多个参数的函数转变成接受一个单一参数（最初函数的第一个参数），并且返回接受余下的参数而且返回结果的新函数的技术。</p>\n<span id=\"more\"></span>\n\n<h1 id=\"理解函数柯里化\"><a href=\"#理解函数柯里化\" class=\"headerlink\" title=\"理解函数柯里化\"></a>理解函数柯里化</h1><p>通用函数解决兼容性问题，但是同时也会带来使用不便性，不同的应用场景旺旺要传递很多参数，已达到解决特定的目的，有时应用中，会对同一个规则进行反复使用，这样就造成了代码的重复性。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">square</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> i * i</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dubble</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (i *= <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">map</span>(<span class=\"params\">handeler, list</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> list.map(handeler)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 数组的每一项平方</span></span><br><span class=\"line\">map(square, [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\">map(square, [<span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>])</span><br><span class=\"line\">map(square, [<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数组的每一项加倍</span></span><br><span class=\"line\">map(dubble, [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\">map(dubble, [<span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>])</span><br><span class=\"line\">map(dubble, [<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>])</span><br></pre></td></tr></table></figure>\n\n<p>例子中，创建了一个 map 通用函数，用于适应不同的应用场景。显然，通用性不用怀疑。同时，例子中重复传入了相同的处理函数：square 和 dubble。</p>\n<p>下面可以利用柯里化改造一下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">square</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> i * <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dubble</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (i *= <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">map</span>(<span class=\"params\">handeler, list</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> list.map(handeler)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> mapSQ = currying(map, square)</span><br><span class=\"line\">mapSQ([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\">mapSQ([<span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>])</span><br><span class=\"line\">mapSQ([<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> mapDB = currying(map, dubble)</span><br><span class=\"line\">mapDB([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\">mapDB([<span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>])</span><br><span class=\"line\">mapDB([<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>])</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> currying = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = [].slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>) <span class=\"comment\">// 截取arguments中的第一个生成一个数组，也就是当前语境下的明面上的合法老婆</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(args) <span class=\"comment\">//合法老婆</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 将已有的参数和新传进来的参数合并为一个数组，对应已有的合法老婆和新搞定的老婆</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> newArgs = args.concat([].slice.call(<span class=\"built_in\">arguments</span>))</span><br><span class=\"line\">    <span class=\"comment\">// 将所有的参数newArgs绑定给fn~</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> fn.apply(<span class=\"literal\">null</span>, newArgs)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 下面为官员如何搞定7个老婆做测试</span></span><br><span class=\"line\"><span class=\"comment\">// 获得合法老婆</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getWife = currying(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> allWife = [].slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(allWife.join(<span class=\"string\">&#x27;,&#x27;</span>))</span><br><span class=\"line\">&#125;, <span class=\"string\">&#x27;合法老婆&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 获得其他6个老婆</span></span><br><span class=\"line\">getWife(<span class=\"string\">&#x27;小老婆1&#x27;</span>, <span class=\"string\">&#x27;小老婆2&#x27;</span>, <span class=\"string\">&#x27;小老婆3&#x27;</span>, <span class=\"string\">&#x27;小老婆4&#x27;</span>, <span class=\"string\">&#x27;小老婆5&#x27;</span>, <span class=\"string\">&#x27;小老婆6&#x27;</span>) <span class=\"comment\">//合法老婆,小老婆1&quot;, &quot;小老婆2&quot;, &quot;小老婆3&quot;, &quot;小老婆4&quot;, &quot;小老婆5&quot;, &quot;小老婆6&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// 换一批老婆</span></span><br><span class=\"line\">getWife(<span class=\"string\">&#x27;大老婆&#x27;</span>, <span class=\"string\">&#x27;小老婆&#x27;</span>, <span class=\"string\">&#x27;俏老婆&#x27;</span>, <span class=\"string\">&#x27;刁蛮老婆&#x27;</span>, <span class=\"string\">&#x27;乖老婆&#x27;</span>, <span class=\"string\">&#x27;送上门老婆&#x27;</span>) <span class=\"comment\">//合法老婆,&quot;大老婆&quot;, &quot;小老婆&quot;, &quot;俏老婆&quot;, &quot;刁蛮老婆&quot;, &quot;乖老婆&quot;, &quot;送上门老婆&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// 再换一批老婆</span></span><br><span class=\"line\">getWife(<span class=\"string\">&#x27;超越韦小宝的老婆&#x27;</span>) <span class=\"comment\">//合法老婆&quot;大老婆&quot;, &quot;小老婆&quot;, &quot;俏老婆&quot;, &quot;刁蛮老婆&quot;, &quot;乖老婆&quot;, &quot;送上门老婆&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>无论输入多少个参数嘛都会打印输出，且都会带第一个参数，上文代码<code>fn.applay(null,newArgs)</code>中的<code>null</code>本事应该制定 fn 中 this 的指向的对象，没有就用 null。</p>\n<h2 id=\"实用场景\"><a href=\"#实用场景\" class=\"headerlink\" title=\"实用场景\"></a>实用场景</h2><ul>\n<li>参数复用（上文中的合法老婆）</li>\n<li>提前返回，下面是一个兼容现代浏览器以及 IE 浏览器的事件添加方法：</li>\n</ul>\n<h3 id=\"事件添加处理\"><a href=\"#事件添加处理\" class=\"headerlink\" title=\"事件添加处理\"></a>事件添加处理</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> addEvent = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el, type, fn, capture</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.addEventListenner) &#123;</span><br><span class=\"line\">    el.addEventListenner(</span><br><span class=\"line\">      type,</span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        fn.call(el, e)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      capture</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.attachEvent) &#123;</span><br><span class=\"line\">    el.attachEvent(<span class=\"string\">&#x27;on&#x27;</span> + type, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">      fn.call(el, e)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在使用 addEvent 为元素添加事件的时候，（eg.IE6/IE7）都会走一遍 if–else,其实只要判定一次就可以了。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> addEvent = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.addEventListenner) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el, sType, fn, capture</span>) </span>&#123;</span><br><span class=\"line\">      el.addEventListenner(</span><br><span class=\"line\">        sType,</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">          fn.call(el, e)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        capture</span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.attachEvert) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el, sType, fn, capture</span>) </span>&#123;</span><br><span class=\"line\">      el.attachEvent(<span class=\"string\">&#x27;on&#x27;</span> + sType, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        fn.call(el, e)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"延时计算\"><a href=\"#延时计算\" class=\"headerlink\" title=\"延时计算\"></a>延时计算</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> curryWeigth = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> _weight = []</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">arguments</span>.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> fn.applay(<span class=\"literal\">null</span>, _weight)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      _weight = _weight.concat([].slice.call(<span class=\"built_in\">arguments</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> weight = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> addWeight = curryWeight(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> i = <span class=\"number\">0</span></span><br><span class=\"line\">  len = <span class=\"built_in\">arguments</span>.length</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (i; i &lt; len; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    weight += <span class=\"built_in\">arguments</span>[i]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">addWeidht(<span class=\"number\">2.3</span>)</span><br><span class=\"line\">addWeidht(<span class=\"number\">6.5</span>)</span><br><span class=\"line\">addWeidht(<span class=\"number\">1.2</span>)</span><br><span class=\"line\">addWeidht() <span class=\"comment\">//到这里才开始计算</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(weight)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//实际上就是利用的闭包而已</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"无限级累加器\"><a href=\"#无限级累加器\" class=\"headerlink\" title=\"无限级累加器\"></a>无限级累加器</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//利用闭包的思想</span></span><br><span class=\"line\">fucntion <span class=\"function\"><span class=\"title\">add</span>(<span class=\"params\">...args</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> sum = args.reduce(<span class=\"function\">(<span class=\"params\">target,value</span>)=&gt;</span>target+v,<span class=\"number\">0</span>)</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">s</span>(<span class=\"params\">...sargs</span>)</span>&#123;</span><br><span class=\"line\">    sum = sargs.reduce(<span class=\"function\">(<span class=\"params\">target,v</span>)=&gt;</span>target+v,sum)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  s.toString = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">add(<span class=\"number\">1</span>,<span class=\"number\">2</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>)</span><br><span class=\"line\">ƒ <span class=\"number\">8</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>,<span class=\"number\">2</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>)(<span class=\"number\">4</span>)</span><br><span class=\"line\">ƒ <span class=\"number\">12</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>,<span class=\"number\">2</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>)(<span class=\"number\">4</span>)(<span class=\"number\">12</span>)</span><br><span class=\"line\">ƒ <span class=\"number\">24</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>函数柯里化是把接受多个参数的函数转变成接受一个单一参数（最初函数的第一个参数），并且返回接受余下的参数而且返回结果的新函数的技术。</p>","more":"<h1 id=\"理解函数柯里化\"><a href=\"#理解函数柯里化\" class=\"headerlink\" title=\"理解函数柯里化\"></a>理解函数柯里化</h1><p>通用函数解决兼容性问题，但是同时也会带来使用不便性，不同的应用场景旺旺要传递很多参数，已达到解决特定的目的，有时应用中，会对同一个规则进行反复使用，这样就造成了代码的重复性。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">square</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> i * i</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dubble</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (i *= <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">map</span>(<span class=\"params\">handeler, list</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> list.map(handeler)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 数组的每一项平方</span></span><br><span class=\"line\">map(square, [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\">map(square, [<span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>])</span><br><span class=\"line\">map(square, [<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数组的每一项加倍</span></span><br><span class=\"line\">map(dubble, [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\">map(dubble, [<span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>])</span><br><span class=\"line\">map(dubble, [<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>])</span><br></pre></td></tr></table></figure>\n\n<p>例子中，创建了一个 map 通用函数，用于适应不同的应用场景。显然，通用性不用怀疑。同时，例子中重复传入了相同的处理函数：square 和 dubble。</p>\n<p>下面可以利用柯里化改造一下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">square</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> i * <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dubble</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (i *= <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">map</span>(<span class=\"params\">handeler, list</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> list.map(handeler)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> mapSQ = currying(map, square)</span><br><span class=\"line\">mapSQ([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\">mapSQ([<span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>])</span><br><span class=\"line\">mapSQ([<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> mapDB = currying(map, dubble)</span><br><span class=\"line\">mapDB([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\">mapDB([<span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>])</span><br><span class=\"line\">mapDB([<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>])</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> currying = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = [].slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>) <span class=\"comment\">// 截取arguments中的第一个生成一个数组，也就是当前语境下的明面上的合法老婆</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(args) <span class=\"comment\">//合法老婆</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 将已有的参数和新传进来的参数合并为一个数组，对应已有的合法老婆和新搞定的老婆</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> newArgs = args.concat([].slice.call(<span class=\"built_in\">arguments</span>))</span><br><span class=\"line\">    <span class=\"comment\">// 将所有的参数newArgs绑定给fn~</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> fn.apply(<span class=\"literal\">null</span>, newArgs)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 下面为官员如何搞定7个老婆做测试</span></span><br><span class=\"line\"><span class=\"comment\">// 获得合法老婆</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getWife = currying(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> allWife = [].slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(allWife.join(<span class=\"string\">&#x27;,&#x27;</span>))</span><br><span class=\"line\">&#125;, <span class=\"string\">&#x27;合法老婆&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 获得其他6个老婆</span></span><br><span class=\"line\">getWife(<span class=\"string\">&#x27;小老婆1&#x27;</span>, <span class=\"string\">&#x27;小老婆2&#x27;</span>, <span class=\"string\">&#x27;小老婆3&#x27;</span>, <span class=\"string\">&#x27;小老婆4&#x27;</span>, <span class=\"string\">&#x27;小老婆5&#x27;</span>, <span class=\"string\">&#x27;小老婆6&#x27;</span>) <span class=\"comment\">//合法老婆,小老婆1&quot;, &quot;小老婆2&quot;, &quot;小老婆3&quot;, &quot;小老婆4&quot;, &quot;小老婆5&quot;, &quot;小老婆6&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// 换一批老婆</span></span><br><span class=\"line\">getWife(<span class=\"string\">&#x27;大老婆&#x27;</span>, <span class=\"string\">&#x27;小老婆&#x27;</span>, <span class=\"string\">&#x27;俏老婆&#x27;</span>, <span class=\"string\">&#x27;刁蛮老婆&#x27;</span>, <span class=\"string\">&#x27;乖老婆&#x27;</span>, <span class=\"string\">&#x27;送上门老婆&#x27;</span>) <span class=\"comment\">//合法老婆,&quot;大老婆&quot;, &quot;小老婆&quot;, &quot;俏老婆&quot;, &quot;刁蛮老婆&quot;, &quot;乖老婆&quot;, &quot;送上门老婆&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// 再换一批老婆</span></span><br><span class=\"line\">getWife(<span class=\"string\">&#x27;超越韦小宝的老婆&#x27;</span>) <span class=\"comment\">//合法老婆&quot;大老婆&quot;, &quot;小老婆&quot;, &quot;俏老婆&quot;, &quot;刁蛮老婆&quot;, &quot;乖老婆&quot;, &quot;送上门老婆&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>无论输入多少个参数嘛都会打印输出，且都会带第一个参数，上文代码<code>fn.applay(null,newArgs)</code>中的<code>null</code>本事应该制定 fn 中 this 的指向的对象，没有就用 null。</p>\n<h2 id=\"实用场景\"><a href=\"#实用场景\" class=\"headerlink\" title=\"实用场景\"></a>实用场景</h2><ul>\n<li>参数复用（上文中的合法老婆）</li>\n<li>提前返回，下面是一个兼容现代浏览器以及 IE 浏览器的事件添加方法：</li>\n</ul>\n<h3 id=\"事件添加处理\"><a href=\"#事件添加处理\" class=\"headerlink\" title=\"事件添加处理\"></a>事件添加处理</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> addEvent = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el, type, fn, capture</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.addEventListenner) &#123;</span><br><span class=\"line\">    el.addEventListenner(</span><br><span class=\"line\">      type,</span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        fn.call(el, e)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      capture</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.attachEvent) &#123;</span><br><span class=\"line\">    el.attachEvent(<span class=\"string\">&#x27;on&#x27;</span> + type, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">      fn.call(el, e)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在使用 addEvent 为元素添加事件的时候，（eg.IE6/IE7）都会走一遍 if–else,其实只要判定一次就可以了。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> addEvent = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.addEventListenner) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el, sType, fn, capture</span>) </span>&#123;</span><br><span class=\"line\">      el.addEventListenner(</span><br><span class=\"line\">        sType,</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">          fn.call(el, e)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        capture</span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.attachEvert) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el, sType, fn, capture</span>) </span>&#123;</span><br><span class=\"line\">      el.attachEvent(<span class=\"string\">&#x27;on&#x27;</span> + sType, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        fn.call(el, e)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"延时计算\"><a href=\"#延时计算\" class=\"headerlink\" title=\"延时计算\"></a>延时计算</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> curryWeigth = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> _weight = []</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">arguments</span>.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> fn.applay(<span class=\"literal\">null</span>, _weight)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      _weight = _weight.concat([].slice.call(<span class=\"built_in\">arguments</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> weight = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> addWeight = curryWeight(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> i = <span class=\"number\">0</span></span><br><span class=\"line\">  len = <span class=\"built_in\">arguments</span>.length</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (i; i &lt; len; i += <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    weight += <span class=\"built_in\">arguments</span>[i]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">addWeidht(<span class=\"number\">2.3</span>)</span><br><span class=\"line\">addWeidht(<span class=\"number\">6.5</span>)</span><br><span class=\"line\">addWeidht(<span class=\"number\">1.2</span>)</span><br><span class=\"line\">addWeidht() <span class=\"comment\">//到这里才开始计算</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(weight)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//实际上就是利用的闭包而已</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"无限级累加器\"><a href=\"#无限级累加器\" class=\"headerlink\" title=\"无限级累加器\"></a>无限级累加器</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//利用闭包的思想</span></span><br><span class=\"line\">fucntion <span class=\"function\"><span class=\"title\">add</span>(<span class=\"params\">...args</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> sum = args.reduce(<span class=\"function\">(<span class=\"params\">target,value</span>)=&gt;</span>target+v,<span class=\"number\">0</span>)</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">s</span>(<span class=\"params\">...sargs</span>)</span>&#123;</span><br><span class=\"line\">    sum = sargs.reduce(<span class=\"function\">(<span class=\"params\">target,v</span>)=&gt;</span>target+v,sum)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  s.toString = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">add(<span class=\"number\">1</span>,<span class=\"number\">2</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>)</span><br><span class=\"line\">ƒ <span class=\"number\">8</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>,<span class=\"number\">2</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>)(<span class=\"number\">4</span>)</span><br><span class=\"line\">ƒ <span class=\"number\">12</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>,<span class=\"number\">2</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>)(<span class=\"number\">4</span>)(<span class=\"number\">12</span>)</span><br><span class=\"line\">ƒ <span class=\"number\">24</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"堆与栈","date":"2021-04-19T13:13:55.000Z","_content":"\n数据结构型的堆与栈和内存使用中的堆与栈的不同，迷糊。由各个地方摘录。\n\n<!--more-->\n\n## 内存使用中的堆与栈\n\n- 栈区（stack）——由编译器自动分配释放，存储函数的参数值，局部变量的值等，其操作方式类似数据中的栈，先进先出。\n- 堆区（heap）——一般由程序员分配释放，若程序员不分配也就没有堆，不释放，程序结束时可能由 OS 回收\n\n### 区别和联系\n\n#### 申请方式\n\n- 堆：由程序员自己申请并指明大小的，在 C 中 malloc 函数，如`p1=(char*)malloc(10)`\n- 栈：系统自动分配的，如声明在函数中一个局部变量 int b；系统自动在栈中为 b 开辟空间\n\n#### 申请后系统的响应动作\n\n- 堆：首先应该知道操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲节点链表中删除，并将该结点的空间分配给程序\n","source":"_posts/堆与栈.md","raw":"---\ntitle: 堆与栈\ndate: 2021-04-19 21:13:55\ncategories: JavaScript\n---\n\n数据结构型的堆与栈和内存使用中的堆与栈的不同，迷糊。由各个地方摘录。\n\n<!--more-->\n\n## 内存使用中的堆与栈\n\n- 栈区（stack）——由编译器自动分配释放，存储函数的参数值，局部变量的值等，其操作方式类似数据中的栈，先进先出。\n- 堆区（heap）——一般由程序员分配释放，若程序员不分配也就没有堆，不释放，程序结束时可能由 OS 回收\n\n### 区别和联系\n\n#### 申请方式\n\n- 堆：由程序员自己申请并指明大小的，在 C 中 malloc 函数，如`p1=(char*)malloc(10)`\n- 栈：系统自动分配的，如声明在函数中一个局部变量 int b；系统自动在栈中为 b 开辟空间\n\n#### 申请后系统的响应动作\n\n- 堆：首先应该知道操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲节点链表中删除，并将该结点的空间分配给程序\n","slug":"堆与栈","published":1,"updated":"2021-04-24T15:38:33.650Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xc002al5v01cm70sau","content":"<p>数据结构型的堆与栈和内存使用中的堆与栈的不同，迷糊。由各个地方摘录。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"内存使用中的堆与栈\"><a href=\"#内存使用中的堆与栈\" class=\"headerlink\" title=\"内存使用中的堆与栈\"></a>内存使用中的堆与栈</h2><ul>\n<li>栈区（stack）——由编译器自动分配释放，存储函数的参数值，局部变量的值等，其操作方式类似数据中的栈，先进先出。</li>\n<li>堆区（heap）——一般由程序员分配释放，若程序员不分配也就没有堆，不释放，程序结束时可能由 OS 回收</li>\n</ul>\n<h3 id=\"区别和联系\"><a href=\"#区别和联系\" class=\"headerlink\" title=\"区别和联系\"></a>区别和联系</h3><h4 id=\"申请方式\"><a href=\"#申请方式\" class=\"headerlink\" title=\"申请方式\"></a>申请方式</h4><ul>\n<li>堆：由程序员自己申请并指明大小的，在 C 中 malloc 函数，如<code>p1=(char*)malloc(10)</code></li>\n<li>栈：系统自动分配的，如声明在函数中一个局部变量 int b；系统自动在栈中为 b 开辟空间</li>\n</ul>\n<h4 id=\"申请后系统的响应动作\"><a href=\"#申请后系统的响应动作\" class=\"headerlink\" title=\"申请后系统的响应动作\"></a>申请后系统的响应动作</h4><ul>\n<li>堆：首先应该知道操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲节点链表中删除，并将该结点的空间分配给程序</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>数据结构型的堆与栈和内存使用中的堆与栈的不同，迷糊。由各个地方摘录。</p>","more":"<h2 id=\"内存使用中的堆与栈\"><a href=\"#内存使用中的堆与栈\" class=\"headerlink\" title=\"内存使用中的堆与栈\"></a>内存使用中的堆与栈</h2><ul>\n<li>栈区（stack）——由编译器自动分配释放，存储函数的参数值，局部变量的值等，其操作方式类似数据中的栈，先进先出。</li>\n<li>堆区（heap）——一般由程序员分配释放，若程序员不分配也就没有堆，不释放，程序结束时可能由 OS 回收</li>\n</ul>\n<h3 id=\"区别和联系\"><a href=\"#区别和联系\" class=\"headerlink\" title=\"区别和联系\"></a>区别和联系</h3><h4 id=\"申请方式\"><a href=\"#申请方式\" class=\"headerlink\" title=\"申请方式\"></a>申请方式</h4><ul>\n<li>堆：由程序员自己申请并指明大小的，在 C 中 malloc 函数，如<code>p1=(char*)malloc(10)</code></li>\n<li>栈：系统自动分配的，如声明在函数中一个局部变量 int b；系统自动在栈中为 b 开辟空间</li>\n</ul>\n<h4 id=\"申请后系统的响应动作\"><a href=\"#申请后系统的响应动作\" class=\"headerlink\" title=\"申请后系统的响应动作\"></a>申请后系统的响应动作</h4><ul>\n<li>堆：首先应该知道操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲节点链表中删除，并将该结点的空间分配给程序</li>\n</ul>"},{"title":"如何实现双向数据绑定 mvvm","date":"2017-11-09T08:52:42.000Z","_content":"\n目前几种主流的 mvc(vm) 框架都实现了单向数据绑定，而我所理解的双向数据绑定无非就是在单向绑定的基础上给可输入元素（input 、 textare 等）添加了 change(input) 事件，来动态修改 model 和 view，并没有多高深。所以无需太过介怀是实现的单向或双向绑定。\n\n<!--more-->\n\n实现数据双向绑定的集中做法大致如下：\n\n- 发布者 - 订阅者模式（backbone.js ）\n\n- 脏值检查（angular.js ）\n\n- 数据劫持（vue.js ）\n\n## vue 的响应式原理\n\nvue 内部使用腊肉 object.defineProperty() 来实现数据响应式，通过这个函数可以监听到 set 和 get 的事件\n\n1. 首先利用 object.defineproperty()给 data 中的属性去设置 set,get 事件\n2. 递归的去把 data 中的每一个属性注册给被观察者。\n3. 解析模板时，在属性的 get 事件中去收集观察者依赖。\n4. 当属性的值发生改变时，在 set 时间中去通知每一个观察者，做到全部更新。\n\n## 数据劫持 :\n\nvue.js 则是采用数据劫持结合发布者 - 订阅者模式的方式，通过 Object.defineProperty() 来劫持各个属性的 setter，getter ，在数据变动时发布消息给订阅者，触发相应的监听回调。\n\n## 1 、实现 Observer\n\nok, 思路已经整理完毕，也已经比较明确相关逻辑和模块功能了，let’s do it\n\n### 实现监听\n\n我们知道可以利用 Obeject.defineProperty() 来监听属性变动那么将需要 observe 的数据对象进行递归遍历，包括子属性的属性，都加上 set 和 get 这样的话，给这个对象的某个值赋值，就会触发 set，那么就能监听到了数据变化。。相关代码可以是这样：\n\n```javascript\nvar data = {name:'kindeng'};\nobserve(data);\ndata.name = 'dmq'; //监听到值得变化 kindeng -->dmq\nfunction observe(data){\n  if(!data||typeof data !== 'object){\n    //[]、{}\n    return;\n  }\n  object.key(data).forEach(function(key)){\n    defineReactive(data,key,data[key]);\n  }\n}\n\nfunction defineReactive(data,key,val){\n  observe(val);//监听子属性\n\n  //循环将data 中的每一个元素都绑定上数据劫持\n  Object.defineProperty(data,key,{\n    enumerable:true,\n    //可枚举\n    configurable:false,\n    //如果为false，则任何尝试删除目标属性或修改属性以下特性（writable, configurable, enumerable）的行为将被无效化\n    get:function(){\n    return val;\n    },\n    set:function(){\n         console.log('值变');\n         val = newVal ;\n    }\n  })\n}\n```\n\n## 数据观测的实现\n\n### Angular\n\nAngular 的数据监测采用的是 “ 脏值检测 ”，每一个指令都会有一个对应的的用来观察到对象的变化，这个应用叫做叫做 watcher，一个作用域中可能有多个 watcher，当数据发生改变，页面更新，Angular 会遍历当前页面中的所有 watcher，对他们一一求值，与之前的值进行对比，如果求值的结果变化了，就会触发对应的更新，这个过程叫做 digest cycle。脏值检测的劣势有两点：\n\n1. 任何数据变动都意味着当前作用域的每一个 watcher 需要被重新求值，且同一时间只允许一个 digest 运行，因此当 watcher 庞大时，应用性能就不可避免的收到影响，并且很难优化。\n2. 当数据变化时，框架并不能主动监测到变化的产生，需要手动触发 digest cycle 才能触发相应的 DOM 更新。Angular 通过在 DOM 事件处理函数中自动触发 digest cycle 部分避免了这个问题，但还是有很多情况下需要用户手动进行触发。\n\n#### \\$watch 对象\n\nAngular 每一个绑定到 UI 的数据，就会有一 \\$watch 对象这个对象包含 3 个值\n\n```javascript\nwatch = {\n  name: '',\n  getNewValue: function($scope) {\n    //得到新值\n    return newValue;\n  },\n  listener: function(newValue, oldValue) {\n    //当数据发生变化时\n  }\n};\n```\n\ngetNewValue() 可以得到当前 \\$scope 上的最新值，listener 函数得到新值和旧值并进行一些操作。\n\n每当我们将数据绑定到 UI 上，angular 就会想你的 watchList 上插入一个 \\$watch\n\n\\*\\* 只有触发 UI 事件，ajax 请求或者 timeout 等回调操作，而数据到界面的呈现则是由脏检查来做。\n\n### Vue\n\nvue 采用的则是基于依赖收集的观测机制，也就是数据劫持，它的基本原理是：\n\n1. 将原生的数据改造成 “ 可观察对象 ”。一个可观察对象可以被取值也可以被赋值。\n2. 在 watcher 的求值过程中，每一个被取值的可观察对象都都会将当前的 watcher 注册为自己的一个订阅者，并成为当前的 watcher 的一个依赖。\n3. 当一个被依赖的可观察对象被赋值时，它会通知所有订阅自己的 watcher 重新求值，并触发相应的更新。\n4. 依赖收集的有点在于可以精准、主动地追踪数据的变化，不存在上述提到的脏检查的两个问题。但传统的依赖收集实现，比如 Knockout, 通常需要包裹原生数据来制造可观察对象，在取值和赋值时需要采用函数的调用形式，在进行数据操作时写法繁琐，不够直观，对复杂嵌套结构的对象支持也不理想。\n","source":"_posts/如何实现双向数据绑定-mvvm.md","raw":"---\ntitle: 如何实现双向数据绑定 mvvm\ndate: 2017-11-9 16:52:42\ncategories: Vue\n---\n\n目前几种主流的 mvc(vm) 框架都实现了单向数据绑定，而我所理解的双向数据绑定无非就是在单向绑定的基础上给可输入元素（input 、 textare 等）添加了 change(input) 事件，来动态修改 model 和 view，并没有多高深。所以无需太过介怀是实现的单向或双向绑定。\n\n<!--more-->\n\n实现数据双向绑定的集中做法大致如下：\n\n- 发布者 - 订阅者模式（backbone.js ）\n\n- 脏值检查（angular.js ）\n\n- 数据劫持（vue.js ）\n\n## vue 的响应式原理\n\nvue 内部使用腊肉 object.defineProperty() 来实现数据响应式，通过这个函数可以监听到 set 和 get 的事件\n\n1. 首先利用 object.defineproperty()给 data 中的属性去设置 set,get 事件\n2. 递归的去把 data 中的每一个属性注册给被观察者。\n3. 解析模板时，在属性的 get 事件中去收集观察者依赖。\n4. 当属性的值发生改变时，在 set 时间中去通知每一个观察者，做到全部更新。\n\n## 数据劫持 :\n\nvue.js 则是采用数据劫持结合发布者 - 订阅者模式的方式，通过 Object.defineProperty() 来劫持各个属性的 setter，getter ，在数据变动时发布消息给订阅者，触发相应的监听回调。\n\n## 1 、实现 Observer\n\nok, 思路已经整理完毕，也已经比较明确相关逻辑和模块功能了，let’s do it\n\n### 实现监听\n\n我们知道可以利用 Obeject.defineProperty() 来监听属性变动那么将需要 observe 的数据对象进行递归遍历，包括子属性的属性，都加上 set 和 get 这样的话，给这个对象的某个值赋值，就会触发 set，那么就能监听到了数据变化。。相关代码可以是这样：\n\n```javascript\nvar data = {name:'kindeng'};\nobserve(data);\ndata.name = 'dmq'; //监听到值得变化 kindeng -->dmq\nfunction observe(data){\n  if(!data||typeof data !== 'object){\n    //[]、{}\n    return;\n  }\n  object.key(data).forEach(function(key)){\n    defineReactive(data,key,data[key]);\n  }\n}\n\nfunction defineReactive(data,key,val){\n  observe(val);//监听子属性\n\n  //循环将data 中的每一个元素都绑定上数据劫持\n  Object.defineProperty(data,key,{\n    enumerable:true,\n    //可枚举\n    configurable:false,\n    //如果为false，则任何尝试删除目标属性或修改属性以下特性（writable, configurable, enumerable）的行为将被无效化\n    get:function(){\n    return val;\n    },\n    set:function(){\n         console.log('值变');\n         val = newVal ;\n    }\n  })\n}\n```\n\n## 数据观测的实现\n\n### Angular\n\nAngular 的数据监测采用的是 “ 脏值检测 ”，每一个指令都会有一个对应的的用来观察到对象的变化，这个应用叫做叫做 watcher，一个作用域中可能有多个 watcher，当数据发生改变，页面更新，Angular 会遍历当前页面中的所有 watcher，对他们一一求值，与之前的值进行对比，如果求值的结果变化了，就会触发对应的更新，这个过程叫做 digest cycle。脏值检测的劣势有两点：\n\n1. 任何数据变动都意味着当前作用域的每一个 watcher 需要被重新求值，且同一时间只允许一个 digest 运行，因此当 watcher 庞大时，应用性能就不可避免的收到影响，并且很难优化。\n2. 当数据变化时，框架并不能主动监测到变化的产生，需要手动触发 digest cycle 才能触发相应的 DOM 更新。Angular 通过在 DOM 事件处理函数中自动触发 digest cycle 部分避免了这个问题，但还是有很多情况下需要用户手动进行触发。\n\n#### \\$watch 对象\n\nAngular 每一个绑定到 UI 的数据，就会有一 \\$watch 对象这个对象包含 3 个值\n\n```javascript\nwatch = {\n  name: '',\n  getNewValue: function($scope) {\n    //得到新值\n    return newValue;\n  },\n  listener: function(newValue, oldValue) {\n    //当数据发生变化时\n  }\n};\n```\n\ngetNewValue() 可以得到当前 \\$scope 上的最新值，listener 函数得到新值和旧值并进行一些操作。\n\n每当我们将数据绑定到 UI 上，angular 就会想你的 watchList 上插入一个 \\$watch\n\n\\*\\* 只有触发 UI 事件，ajax 请求或者 timeout 等回调操作，而数据到界面的呈现则是由脏检查来做。\n\n### Vue\n\nvue 采用的则是基于依赖收集的观测机制，也就是数据劫持，它的基本原理是：\n\n1. 将原生的数据改造成 “ 可观察对象 ”。一个可观察对象可以被取值也可以被赋值。\n2. 在 watcher 的求值过程中，每一个被取值的可观察对象都都会将当前的 watcher 注册为自己的一个订阅者，并成为当前的 watcher 的一个依赖。\n3. 当一个被依赖的可观察对象被赋值时，它会通知所有订阅自己的 watcher 重新求值，并触发相应的更新。\n4. 依赖收集的有点在于可以精准、主动地追踪数据的变化，不存在上述提到的脏检查的两个问题。但传统的依赖收集实现，比如 Knockout, 通常需要包裹原生数据来制造可观察对象，在取值和赋值时需要采用函数的调用形式，在进行数据操作时写法繁琐，不够直观，对复杂嵌套结构的对象支持也不理想。\n","slug":"如何实现双向数据绑定-mvvm","published":1,"updated":"2021-02-28T08:14:10.603Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xc002cl5v02iejc0hq","content":"<p>目前几种主流的 mvc(vm) 框架都实现了单向数据绑定，而我所理解的双向数据绑定无非就是在单向绑定的基础上给可输入元素（input 、 textare 等）添加了 change(input) 事件，来动态修改 model 和 view，并没有多高深。所以无需太过介怀是实现的单向或双向绑定。</p>\n<span id=\"more\"></span>\n\n<p>实现数据双向绑定的集中做法大致如下：</p>\n<ul>\n<li><p>发布者 - 订阅者模式（backbone.js ）</p>\n</li>\n<li><p>脏值检查（angular.js ）</p>\n</li>\n<li><p>数据劫持（vue.js ）</p>\n</li>\n</ul>\n<h2 id=\"vue-的响应式原理\"><a href=\"#vue-的响应式原理\" class=\"headerlink\" title=\"vue 的响应式原理\"></a>vue 的响应式原理</h2><p>vue 内部使用腊肉 object.defineProperty() 来实现数据响应式，通过这个函数可以监听到 set 和 get 的事件</p>\n<ol>\n<li>首先利用 object.defineproperty()给 data 中的属性去设置 set,get 事件</li>\n<li>递归的去把 data 中的每一个属性注册给被观察者。</li>\n<li>解析模板时，在属性的 get 事件中去收集观察者依赖。</li>\n<li>当属性的值发生改变时，在 set 时间中去通知每一个观察者，做到全部更新。</li>\n</ol>\n<h2 id=\"数据劫持\"><a href=\"#数据劫持\" class=\"headerlink\" title=\"数据劫持 :\"></a>数据劫持 :</h2><p>vue.js 则是采用数据劫持结合发布者 - 订阅者模式的方式，通过 Object.defineProperty() 来劫持各个属性的 setter，getter ，在数据变动时发布消息给订阅者，触发相应的监听回调。</p>\n<h2 id=\"1-、实现-Observer\"><a href=\"#1-、实现-Observer\" class=\"headerlink\" title=\"1 、实现 Observer\"></a>1 、实现 Observer</h2><p>ok, 思路已经整理完毕，也已经比较明确相关逻辑和模块功能了，let’s do it</p>\n<h3 id=\"实现监听\"><a href=\"#实现监听\" class=\"headerlink\" title=\"实现监听\"></a>实现监听</h3><p>我们知道可以利用 Obeject.defineProperty() 来监听属性变动那么将需要 observe 的数据对象进行递归遍历，包括子属性的属性，都加上 set 和 get 这样的话，给这个对象的某个值赋值，就会触发 set，那么就能监听到了数据变化。。相关代码可以是这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = &#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;kindeng&#x27;</span>&#125;;</span><br><span class=\"line\">observe(data);</span><br><span class=\"line\">data.name = <span class=\"string\">&#x27;dmq&#x27;</span>; <span class=\"comment\">//监听到值得变化 kindeng --&gt;dmq</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">observe</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!data||<span class=\"keyword\">typeof</span> data !== <span class=\"string\">&#x27;object)&#123;</span></span><br><span class=\"line\"><span class=\"string\">    //[]、&#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">    return;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">  object.key(data).forEach(function(key))&#123;</span></span><br><span class=\"line\"><span class=\"string\">    defineReactive(data,key,data[key]);</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function defineReactive(data,key,val)&#123;</span></span><br><span class=\"line\"><span class=\"string\">  observe(val);//监听子属性</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  //循环将data 中的每一个元素都绑定上数据劫持</span></span><br><span class=\"line\"><span class=\"string\">  Object.defineProperty(data,key,&#123;</span></span><br><span class=\"line\"><span class=\"string\">    enumerable:true,</span></span><br><span class=\"line\"><span class=\"string\">    //可枚举</span></span><br><span class=\"line\"><span class=\"string\">    configurable:false,</span></span><br><span class=\"line\"><span class=\"string\">    //如果为false，则任何尝试删除目标属性或修改属性以下特性（writable, configurable, enumerable）的行为将被无效化</span></span><br><span class=\"line\"><span class=\"string\">    get:function()&#123;</span></span><br><span class=\"line\"><span class=\"string\">    return val;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    set:function()&#123;</span></span><br><span class=\"line\"><span class=\"string\">         console.log(&#x27;</span>值变<span class=\"string\">&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">         val = newVal ;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;)</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据观测的实现\"><a href=\"#数据观测的实现\" class=\"headerlink\" title=\"数据观测的实现\"></a>数据观测的实现</h2><h3 id=\"Angular\"><a href=\"#Angular\" class=\"headerlink\" title=\"Angular\"></a>Angular</h3><p>Angular 的数据监测采用的是 “ 脏值检测 ”，每一个指令都会有一个对应的的用来观察到对象的变化，这个应用叫做叫做 watcher，一个作用域中可能有多个 watcher，当数据发生改变，页面更新，Angular 会遍历当前页面中的所有 watcher，对他们一一求值，与之前的值进行对比，如果求值的结果变化了，就会触发对应的更新，这个过程叫做 digest cycle。脏值检测的劣势有两点：</p>\n<ol>\n<li>任何数据变动都意味着当前作用域的每一个 watcher 需要被重新求值，且同一时间只允许一个 digest 运行，因此当 watcher 庞大时，应用性能就不可避免的收到影响，并且很难优化。</li>\n<li>当数据变化时，框架并不能主动监测到变化的产生，需要手动触发 digest cycle 才能触发相应的 DOM 更新。Angular 通过在 DOM 事件处理函数中自动触发 digest cycle 部分避免了这个问题，但还是有很多情况下需要用户手动进行触发。</li>\n</ol>\n<h4 id=\"watch-对象\"><a href=\"#watch-对象\" class=\"headerlink\" title=\"$watch 对象\"></a>$watch 对象</h4><p>Angular 每一个绑定到 UI 的数据，就会有一 $watch 对象这个对象包含 3 个值</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">watch = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">  getNewValue: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//得到新值</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> newValue;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  listener: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newValue, oldValue</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//当数据发生变化时</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>getNewValue() 可以得到当前 $scope 上的最新值，listener 函数得到新值和旧值并进行一些操作。</p>\n<p>每当我们将数据绑定到 UI 上，angular 就会想你的 watchList 上插入一个 $watch</p>\n<p>** 只有触发 UI 事件，ajax 请求或者 timeout 等回调操作，而数据到界面的呈现则是由脏检查来做。</p>\n<h3 id=\"Vue\"><a href=\"#Vue\" class=\"headerlink\" title=\"Vue\"></a>Vue</h3><p>vue 采用的则是基于依赖收集的观测机制，也就是数据劫持，它的基本原理是：</p>\n<ol>\n<li>将原生的数据改造成 “ 可观察对象 ”。一个可观察对象可以被取值也可以被赋值。</li>\n<li>在 watcher 的求值过程中，每一个被取值的可观察对象都都会将当前的 watcher 注册为自己的一个订阅者，并成为当前的 watcher 的一个依赖。</li>\n<li>当一个被依赖的可观察对象被赋值时，它会通知所有订阅自己的 watcher 重新求值，并触发相应的更新。</li>\n<li>依赖收集的有点在于可以精准、主动地追踪数据的变化，不存在上述提到的脏检查的两个问题。但传统的依赖收集实现，比如 Knockout, 通常需要包裹原生数据来制造可观察对象，在取值和赋值时需要采用函数的调用形式，在进行数据操作时写法繁琐，不够直观，对复杂嵌套结构的对象支持也不理想。</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>目前几种主流的 mvc(vm) 框架都实现了单向数据绑定，而我所理解的双向数据绑定无非就是在单向绑定的基础上给可输入元素（input 、 textare 等）添加了 change(input) 事件，来动态修改 model 和 view，并没有多高深。所以无需太过介怀是实现的单向或双向绑定。</p>","more":"<p>实现数据双向绑定的集中做法大致如下：</p>\n<ul>\n<li><p>发布者 - 订阅者模式（backbone.js ）</p>\n</li>\n<li><p>脏值检查（angular.js ）</p>\n</li>\n<li><p>数据劫持（vue.js ）</p>\n</li>\n</ul>\n<h2 id=\"vue-的响应式原理\"><a href=\"#vue-的响应式原理\" class=\"headerlink\" title=\"vue 的响应式原理\"></a>vue 的响应式原理</h2><p>vue 内部使用腊肉 object.defineProperty() 来实现数据响应式，通过这个函数可以监听到 set 和 get 的事件</p>\n<ol>\n<li>首先利用 object.defineproperty()给 data 中的属性去设置 set,get 事件</li>\n<li>递归的去把 data 中的每一个属性注册给被观察者。</li>\n<li>解析模板时，在属性的 get 事件中去收集观察者依赖。</li>\n<li>当属性的值发生改变时，在 set 时间中去通知每一个观察者，做到全部更新。</li>\n</ol>\n<h2 id=\"数据劫持\"><a href=\"#数据劫持\" class=\"headerlink\" title=\"数据劫持 :\"></a>数据劫持 :</h2><p>vue.js 则是采用数据劫持结合发布者 - 订阅者模式的方式，通过 Object.defineProperty() 来劫持各个属性的 setter，getter ，在数据变动时发布消息给订阅者，触发相应的监听回调。</p>\n<h2 id=\"1-、实现-Observer\"><a href=\"#1-、实现-Observer\" class=\"headerlink\" title=\"1 、实现 Observer\"></a>1 、实现 Observer</h2><p>ok, 思路已经整理完毕，也已经比较明确相关逻辑和模块功能了，let’s do it</p>\n<h3 id=\"实现监听\"><a href=\"#实现监听\" class=\"headerlink\" title=\"实现监听\"></a>实现监听</h3><p>我们知道可以利用 Obeject.defineProperty() 来监听属性变动那么将需要 observe 的数据对象进行递归遍历，包括子属性的属性，都加上 set 和 get 这样的话，给这个对象的某个值赋值，就会触发 set，那么就能监听到了数据变化。。相关代码可以是这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = &#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;kindeng&#x27;</span>&#125;;</span><br><span class=\"line\">observe(data);</span><br><span class=\"line\">data.name = <span class=\"string\">&#x27;dmq&#x27;</span>; <span class=\"comment\">//监听到值得变化 kindeng --&gt;dmq</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">observe</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!data||<span class=\"keyword\">typeof</span> data !== <span class=\"string\">&#x27;object)&#123;</span></span><br><span class=\"line\"><span class=\"string\">    //[]、&#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">    return;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">  object.key(data).forEach(function(key))&#123;</span></span><br><span class=\"line\"><span class=\"string\">    defineReactive(data,key,data[key]);</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function defineReactive(data,key,val)&#123;</span></span><br><span class=\"line\"><span class=\"string\">  observe(val);//监听子属性</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  //循环将data 中的每一个元素都绑定上数据劫持</span></span><br><span class=\"line\"><span class=\"string\">  Object.defineProperty(data,key,&#123;</span></span><br><span class=\"line\"><span class=\"string\">    enumerable:true,</span></span><br><span class=\"line\"><span class=\"string\">    //可枚举</span></span><br><span class=\"line\"><span class=\"string\">    configurable:false,</span></span><br><span class=\"line\"><span class=\"string\">    //如果为false，则任何尝试删除目标属性或修改属性以下特性（writable, configurable, enumerable）的行为将被无效化</span></span><br><span class=\"line\"><span class=\"string\">    get:function()&#123;</span></span><br><span class=\"line\"><span class=\"string\">    return val;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    set:function()&#123;</span></span><br><span class=\"line\"><span class=\"string\">         console.log(&#x27;</span>值变<span class=\"string\">&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">         val = newVal ;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;)</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据观测的实现\"><a href=\"#数据观测的实现\" class=\"headerlink\" title=\"数据观测的实现\"></a>数据观测的实现</h2><h3 id=\"Angular\"><a href=\"#Angular\" class=\"headerlink\" title=\"Angular\"></a>Angular</h3><p>Angular 的数据监测采用的是 “ 脏值检测 ”，每一个指令都会有一个对应的的用来观察到对象的变化，这个应用叫做叫做 watcher，一个作用域中可能有多个 watcher，当数据发生改变，页面更新，Angular 会遍历当前页面中的所有 watcher，对他们一一求值，与之前的值进行对比，如果求值的结果变化了，就会触发对应的更新，这个过程叫做 digest cycle。脏值检测的劣势有两点：</p>\n<ol>\n<li>任何数据变动都意味着当前作用域的每一个 watcher 需要被重新求值，且同一时间只允许一个 digest 运行，因此当 watcher 庞大时，应用性能就不可避免的收到影响，并且很难优化。</li>\n<li>当数据变化时，框架并不能主动监测到变化的产生，需要手动触发 digest cycle 才能触发相应的 DOM 更新。Angular 通过在 DOM 事件处理函数中自动触发 digest cycle 部分避免了这个问题，但还是有很多情况下需要用户手动进行触发。</li>\n</ol>\n<h4 id=\"watch-对象\"><a href=\"#watch-对象\" class=\"headerlink\" title=\"$watch 对象\"></a>$watch 对象</h4><p>Angular 每一个绑定到 UI 的数据，就会有一 $watch 对象这个对象包含 3 个值</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">watch = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">  getNewValue: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$scope</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//得到新值</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> newValue;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  listener: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newValue, oldValue</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//当数据发生变化时</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>getNewValue() 可以得到当前 $scope 上的最新值，listener 函数得到新值和旧值并进行一些操作。</p>\n<p>每当我们将数据绑定到 UI 上，angular 就会想你的 watchList 上插入一个 $watch</p>\n<p>** 只有触发 UI 事件，ajax 请求或者 timeout 等回调操作，而数据到界面的呈现则是由脏检查来做。</p>\n<h3 id=\"Vue\"><a href=\"#Vue\" class=\"headerlink\" title=\"Vue\"></a>Vue</h3><p>vue 采用的则是基于依赖收集的观测机制，也就是数据劫持，它的基本原理是：</p>\n<ol>\n<li>将原生的数据改造成 “ 可观察对象 ”。一个可观察对象可以被取值也可以被赋值。</li>\n<li>在 watcher 的求值过程中，每一个被取值的可观察对象都都会将当前的 watcher 注册为自己的一个订阅者，并成为当前的 watcher 的一个依赖。</li>\n<li>当一个被依赖的可观察对象被赋值时，它会通知所有订阅自己的 watcher 重新求值，并触发相应的更新。</li>\n<li>依赖收集的有点在于可以精准、主动地追踪数据的变化，不存在上述提到的脏检查的两个问题。但传统的依赖收集实现，比如 Knockout, 通常需要包裹原生数据来制造可观察对象，在取值和赋值时需要采用函数的调用形式，在进行数据操作时写法繁琐，不够直观，对复杂嵌套结构的对象支持也不理想。</li>\n</ol>"},{"title":"字符串操作方法","date":"2018-01-15T10:02:34.000Z","_content":"\n字符串常见操作方法总结\n\n<!--more-->\n\n## chartAt()\n\n返回特定位置的字符\n\n## charCodeAt()\n\n返回 0 到 65535 之间的整数，表示给定索引处的 UTF-16 代码单元。\n\n## concat()\n\n连接连个字符串文本，并返回一个新的字符串\n\n## includes()\n\n要在此字符串中搜索的字符串\n\n```javascript\n'Blue Whale'.includes('blue') //return false\nvar str = 'To be, or not to be, that is the question.';\n\nconsole.log(str.includes('To be'));       // true\n```\n\n## endsWidth()\n\n判断一个字符串的结尾收否包含其他字符串中的字符。\n\n```javascript\nvar str = 'To be,or not to be, that is the question.'\nalert(str.endsWith('question.')) // true\nalert(str.endsWith('to be')) // false\nalert(str.endsWith('to be', 19)) // true\nalert(str.endsWith('To be', 5)) // true\n```\n\n## indexOf()\n```javascript\n'Blue Whale'.indexOf('Blue');     // returns  0\n'Blue Whale'.indexOf('Blute');    // returns -1\n'Blue Whale'.indexOf('Whale', 0); // returns  5\n'Blue Whale'.indexOf('Whale', 5); // returns  5\n'Blue Whale'.indexOf('Whale', 7); // returns -1\n'Blue Whale'.indexOf('');         // returns  0\n'Blue Whale'.indexOf('', 9);      // returns  9\n'Blue Whale'.indexOf('', 10);     // returns 10\n'Blue Whale'.indexOf('', 11);     // returns 10\n'Blue Whale'.indexOf('blue'); // returns -1\n```\n## trim()\n该方法从字符串的两端删除空格。这里的空格是所有空格字符（空格，制表符，不间断空格等）和所有行结束符字符（LF，CR等）。\n```javascript\nvar orig = '   foo  ';\nconsole.log(orig.trim()); // 'foo'\n```","source":"_posts/字符串操作方法.md","raw":"---\ntitle: 字符串操作方法\ndate: 2018-01-15 18:02:34\ncategories: JavaScript\n---\n\n字符串常见操作方法总结\n\n<!--more-->\n\n## chartAt()\n\n返回特定位置的字符\n\n## charCodeAt()\n\n返回 0 到 65535 之间的整数，表示给定索引处的 UTF-16 代码单元。\n\n## concat()\n\n连接连个字符串文本，并返回一个新的字符串\n\n## includes()\n\n要在此字符串中搜索的字符串\n\n```javascript\n'Blue Whale'.includes('blue') //return false\nvar str = 'To be, or not to be, that is the question.';\n\nconsole.log(str.includes('To be'));       // true\n```\n\n## endsWidth()\n\n判断一个字符串的结尾收否包含其他字符串中的字符。\n\n```javascript\nvar str = 'To be,or not to be, that is the question.'\nalert(str.endsWith('question.')) // true\nalert(str.endsWith('to be')) // false\nalert(str.endsWith('to be', 19)) // true\nalert(str.endsWith('To be', 5)) // true\n```\n\n## indexOf()\n```javascript\n'Blue Whale'.indexOf('Blue');     // returns  0\n'Blue Whale'.indexOf('Blute');    // returns -1\n'Blue Whale'.indexOf('Whale', 0); // returns  5\n'Blue Whale'.indexOf('Whale', 5); // returns  5\n'Blue Whale'.indexOf('Whale', 7); // returns -1\n'Blue Whale'.indexOf('');         // returns  0\n'Blue Whale'.indexOf('', 9);      // returns  9\n'Blue Whale'.indexOf('', 10);     // returns 10\n'Blue Whale'.indexOf('', 11);     // returns 10\n'Blue Whale'.indexOf('blue'); // returns -1\n```\n## trim()\n该方法从字符串的两端删除空格。这里的空格是所有空格字符（空格，制表符，不间断空格等）和所有行结束符字符（LF，CR等）。\n```javascript\nvar orig = '   foo  ';\nconsole.log(orig.trim()); // 'foo'\n```","slug":"字符串操作方法","published":1,"updated":"2021-02-27T12:24:38.489Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xd002el5v0gd9f7cut","content":"<p>字符串常见操作方法总结</p>\n<span id=\"more\"></span>\n\n<h2 id=\"chartAt\"><a href=\"#chartAt\" class=\"headerlink\" title=\"chartAt()\"></a>chartAt()</h2><p>返回特定位置的字符</p>\n<h2 id=\"charCodeAt\"><a href=\"#charCodeAt\" class=\"headerlink\" title=\"charCodeAt()\"></a>charCodeAt()</h2><p>返回 0 到 65535 之间的整数，表示给定索引处的 UTF-16 代码单元。</p>\n<h2 id=\"concat\"><a href=\"#concat\" class=\"headerlink\" title=\"concat()\"></a>concat()</h2><p>连接连个字符串文本，并返回一个新的字符串</p>\n<h2 id=\"includes\"><a href=\"#includes\" class=\"headerlink\" title=\"includes()\"></a>includes()</h2><p>要在此字符串中搜索的字符串</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.includes(<span class=\"string\">&#x27;blue&#x27;</span>) <span class=\"comment\">//return false</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;To be, or not to be, that is the question.&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.includes(<span class=\"string\">&#x27;To be&#x27;</span>));       <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"endsWidth\"><a href=\"#endsWidth\" class=\"headerlink\" title=\"endsWidth()\"></a>endsWidth()</h2><p>判断一个字符串的结尾收否包含其他字符串中的字符。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;To be,or not to be, that is the question.&#x27;</span></span><br><span class=\"line\">alert(str.endsWith(<span class=\"string\">&#x27;question.&#x27;</span>)) <span class=\"comment\">// true</span></span><br><span class=\"line\">alert(str.endsWith(<span class=\"string\">&#x27;to be&#x27;</span>)) <span class=\"comment\">// false</span></span><br><span class=\"line\">alert(str.endsWith(<span class=\"string\">&#x27;to be&#x27;</span>, <span class=\"number\">19</span>)) <span class=\"comment\">// true</span></span><br><span class=\"line\">alert(str.endsWith(<span class=\"string\">&#x27;To be&#x27;</span>, <span class=\"number\">5</span>)) <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"indexOf\"><a href=\"#indexOf\" class=\"headerlink\" title=\"indexOf()\"></a>indexOf()</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Blue&#x27;</span>);     <span class=\"comment\">// returns  0</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Blute&#x27;</span>);    <span class=\"comment\">// returns -1</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Whale&#x27;</span>, <span class=\"number\">0</span>); <span class=\"comment\">// returns  5</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Whale&#x27;</span>, <span class=\"number\">5</span>); <span class=\"comment\">// returns  5</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Whale&#x27;</span>, <span class=\"number\">7</span>); <span class=\"comment\">// returns -1</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;&#x27;</span>);         <span class=\"comment\">// returns  0</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">9</span>);      <span class=\"comment\">// returns  9</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">10</span>);     <span class=\"comment\">// returns 10</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">11</span>);     <span class=\"comment\">// returns 10</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;blue&#x27;</span>); <span class=\"comment\">// returns -1</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"trim\"><a href=\"#trim\" class=\"headerlink\" title=\"trim()\"></a>trim()</h2><p>该方法从字符串的两端删除空格。这里的空格是所有空格字符（空格，制表符，不间断空格等）和所有行结束符字符（LF，CR等）。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> orig = <span class=\"string\">&#x27;   foo  &#x27;</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(orig.trim()); <span class=\"comment\">// &#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>字符串常见操作方法总结</p>","more":"<h2 id=\"chartAt\"><a href=\"#chartAt\" class=\"headerlink\" title=\"chartAt()\"></a>chartAt()</h2><p>返回特定位置的字符</p>\n<h2 id=\"charCodeAt\"><a href=\"#charCodeAt\" class=\"headerlink\" title=\"charCodeAt()\"></a>charCodeAt()</h2><p>返回 0 到 65535 之间的整数，表示给定索引处的 UTF-16 代码单元。</p>\n<h2 id=\"concat\"><a href=\"#concat\" class=\"headerlink\" title=\"concat()\"></a>concat()</h2><p>连接连个字符串文本，并返回一个新的字符串</p>\n<h2 id=\"includes\"><a href=\"#includes\" class=\"headerlink\" title=\"includes()\"></a>includes()</h2><p>要在此字符串中搜索的字符串</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.includes(<span class=\"string\">&#x27;blue&#x27;</span>) <span class=\"comment\">//return false</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;To be, or not to be, that is the question.&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(str.includes(<span class=\"string\">&#x27;To be&#x27;</span>));       <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"endsWidth\"><a href=\"#endsWidth\" class=\"headerlink\" title=\"endsWidth()\"></a>endsWidth()</h2><p>判断一个字符串的结尾收否包含其他字符串中的字符。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;To be,or not to be, that is the question.&#x27;</span></span><br><span class=\"line\">alert(str.endsWith(<span class=\"string\">&#x27;question.&#x27;</span>)) <span class=\"comment\">// true</span></span><br><span class=\"line\">alert(str.endsWith(<span class=\"string\">&#x27;to be&#x27;</span>)) <span class=\"comment\">// false</span></span><br><span class=\"line\">alert(str.endsWith(<span class=\"string\">&#x27;to be&#x27;</span>, <span class=\"number\">19</span>)) <span class=\"comment\">// true</span></span><br><span class=\"line\">alert(str.endsWith(<span class=\"string\">&#x27;To be&#x27;</span>, <span class=\"number\">5</span>)) <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"indexOf\"><a href=\"#indexOf\" class=\"headerlink\" title=\"indexOf()\"></a>indexOf()</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Blue&#x27;</span>);     <span class=\"comment\">// returns  0</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Blute&#x27;</span>);    <span class=\"comment\">// returns -1</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Whale&#x27;</span>, <span class=\"number\">0</span>); <span class=\"comment\">// returns  5</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Whale&#x27;</span>, <span class=\"number\">5</span>); <span class=\"comment\">// returns  5</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;Whale&#x27;</span>, <span class=\"number\">7</span>); <span class=\"comment\">// returns -1</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;&#x27;</span>);         <span class=\"comment\">// returns  0</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">9</span>);      <span class=\"comment\">// returns  9</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">10</span>);     <span class=\"comment\">// returns 10</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">11</span>);     <span class=\"comment\">// returns 10</span></span><br><span class=\"line\"><span class=\"string\">&#x27;Blue Whale&#x27;</span>.indexOf(<span class=\"string\">&#x27;blue&#x27;</span>); <span class=\"comment\">// returns -1</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"trim\"><a href=\"#trim\" class=\"headerlink\" title=\"trim()\"></a>trim()</h2><p>该方法从字符串的两端删除空格。这里的空格是所有空格字符（空格，制表符，不间断空格等）和所有行结束符字符（LF，CR等）。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> orig = <span class=\"string\">&#x27;   foo  &#x27;</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(orig.trim()); <span class=\"comment\">// &#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>"},{"title":"知识点积累","date":"2018-03-08T10:21:15.000Z","_content":"\n记录一些零碎的知识点\n\n<!--more-->\n\n## CSS 有哪些样式可以给子元素继承\n\n- 可继承的:`font-size`,`font-weight`,`line-height`,`color`,`cursor` 等 。\n- 不可继承的一般是会改变盒子模型的:`display`,`margin`、`border`、`padding`、`height` 等。\n\n## box-sizing 常用的属性有哪些? 分别有啥作用?\n\n这个 css 主要是改变盒子模型的大小。有两个值:`content-box`(标准模型),`border-box`（怪异模型）\n\n```html\n<style>\n  .test {\n    box-sizing: content-box;\n    border: 5px solid #f00;\n    padding: 5px;\n    width: 100px;\n    height: 100px;\n  }\n</style>\n<div class=\"test\"></div>\n<!--\ncontent-box的计算公式会把宽高的定义指向 content,border和 padding 另外计算,\n也就是说 content + padding + border = 120px(盒子实际大小)\n\n而border-box的计算公式是总的大小涵盖这三者, content 会缩小,来让给另外两者\ncontent(80px) + padding(5*2px) + border(5*2px) = 100px\n-->\n```\n\n## 说说样式权重的优先级;\n\n`!important` > `行内样式` > `id` > `class` > `tag`\n\n## 对数组 ['2018-03-05', '2013-06-12','2019-03-12','2018-03-05','2014-02-22'] 去重且排序\n\n```javascript\n//很好理解, Set 具有值唯一性(但不是所有值,等会我抛出我的另外一篇文章)\n// 结合...解构,可以把可迭代(比如 arguments/nodelist 等)的转为数组\n// sort 里面传入 两个值比较,返回-1和1是因为1代表这个数大排后(相对),-1代表小(相对),0为相等\n\nlet arr = [\n  ...new Set([\n    '2018-03-05',\n    '2013-06-12',\n    '2019-03-12',\n    '2018-03-05',\n    '2014-02-22'\n  ])\n].sort(function (a, b) {\n  return a < b ? -1 : 1 // 这里返回的是升序的,降序改下返回值就好了.所以是相对\n})\n\n// [\"2013-06-12\", \"2014-02-22\", \"2018-03-05\", \"2019-03-12\"]\n```\n\n## 对数组[1,2,3,4,5,'6',7,'8','a','b','z']进行乱序\n\n```javascript\n// 我们依旧可以用上面的 sort 的原理实现乱序\n\nlet tempArr = [1, 2, 3, 4, 5, '6', 7, '8', 'a', 'b', 'z'].sort(function () {\n  return Math.random() > 0.5 ? -1 : 1\n})\n\n// 因为里面有随机数,所以答案没有标准答案,我这边跑了一次是输出这个\n//[\"6\", \"z\", 3, \"b\", 5, 2, 7, \"8\", \"a\", 1, 4]\n```\n\n##　 求[1, 10, 11, -1,'-5',12, 13, 14, 15, 2, 3, 4, 7, 8, 9]内最大值与最小值之差\n\n```javascript\n// 来一个很粗糙的版本,只当传入是数组且可以隐性转为数字的\nfunction MaxMinPlus(arr) {\n  // 返回最大值与最小值之差\n  return Array.isArray(arr)\n    ? Math.max.apply(Math, arr) - Math.min.apply(Math, arr)\n    : console.log('传入的不是数组亦或者未能解决的错误')\n}\n\n// 结果是 20\n\n// 若是要完善的话,要考虑传入的是非数组,\n//传入字符串的时候要判断,然后切割为数组..\n// 都要考虑进去代码量不短\n```\n\n## JS 的作用域是什么?有什么特别之处么\n\n作用域就是有它自身的上下文区域(比如函数内),内部会有变量声明提升,函数声明提升这些;\n\n函数声明提升优于变量声明提升..\n\n作用域有全局作用域和块级作用域(局部,比如用 let 或者单纯花括号的);\n\n作用域会影响 this 的指向\n\n### 作用域链\n\n当访问一个变量时，解释器会首先在当前作用域查找标示符，如果没有找到，就去父作用域找，直到找到该变量的标示符或者不在父作用域中，这就是作用域链\n\n作用域链和原型继承查找时的区别：如果去查找一个普通对象的属性，但是在当前对象和其原型中都找不到时，会返回 undefined；但查找的属性在作用域链中不存在的话就会抛出 ReferenceError。\n\n作用域链的顶端是全局对象，在全局环境中定义的变量就会绑定到全局对象中。\n\n## javascript 里面的继承怎么实现，如何避免原型链上面的对象共享\n\n- ES5:寄生组合式继承:通过借用构造函数来继承属性和原型链来实现子继承父。\n\n```javascript\nfunction ParentClass(name) {\n  this.name = name\n}\nParentClass.prototype.sayHello = function () {\n  console.log(\"I'm parent!\" + this.name)\n}\nfunction SubClass(name, age) {\n  //若是要多个参数可以用apply 结合 ...解构\n  ParentClass.call(this, name)\n  this.age = age\n}\nSubClass.prototype = Object.create(ParentClass.prototype)\nSubClass.prototype.constructor = SubClass\nSubClass.prototype.sayChildHello = function (name) {\n  console.log(\"I'm child \" + this.name)\n}\n\nlet testA = new SubClass('CRPER')\n\n// Object.create()的polyfill\n/*\n    function pureObject(o){\n        //定义了一个临时构造函数\n         function F() {}\n         //将这个临时构造函数的原型指向了传入进来的对象。\n         F.prototype = obj;\n         //返回这个构造函数的一个实例。该实例拥有obj的所有属性和方法。\n         //因为该实例的原型是obj对象。\n         return new F();\n    }\n    */\n```\n\n- ES6: 其实就是 ES5 的语法糖,不过可读性很强\n\n```javascript\nclass ParentClass {\n  constructor(name) {\n    this.name = name\n  }\n  sayHello() {\n    console.log(\"I'm parent!\" + this.name)\n  }\n}\n\nclass SubClass extends ParentClass {\n  constructor(name) {\n    super(name)\n  }\n  sayChildHello() {\n    console.log(\"I'm child \" + this.name)\n  }\n  // 重新声明父类同名方法会覆写,ES5的话就是直接操作自己的原型链上\n  sayHello() {\n    console.log(\"override parent method !,I'm sayHello Method\")\n  }\n}\n\nlet testA = new SubClass('CRPER')\n```\n\n## 渲染海量数据且给每条内容添加监听事件\n\n现在浏览器提供了`requestAnimationFrame`API 来解决非常耗时的代码段对渲染阻塞问题。\n\n```javascript\n;(() => {\n  const ndContainer = document.getElementById('js-list')\n  if (!ndContainer) {\n    return\n  }\n\n  const total = 30000\n  const batchSize = 4 // 每批插入的节点次数，越大越卡\n  const batchCount = total / batchSize // 需要批量处理多少次\n  let batchDone = 0 // 已经完成的批处理个数\n\n  function appendItems() {\n    //这是掘金答案，可是个人觉得innerHTML会更好，经测试是真的更好\n    const fragment = document.createDocumentFragment()\n    for (let i = 0; i < batchSize; i++) {\n      const ndItem = document.createElement('li')\n      ndItem.innerText = batchDone * batchSize + i + 1\n      fragment.appendChild(ndItem)\n    }\n\n    // 每次批处理只修改 1 次 DOM\n    ndContainer.appendChild(fragment)\n\n    batchDone += 1\n    doBatchAppend()\n  }\n\n  function doBatchAppend() {\n    if (batchDone < batchCount) {\n      window.requestAnimationFrame(appendItems)\n    }\n  }\n\n  // kickoff\n  doBatchAppend()\n\n  ndContainer.addEventListener('click', function (e) {\n    const target = e.target\n    if (target.tagName === 'LI') {\n      alert(target.innerHTML)\n    }\n  })\n})()\n```\n\n## vue 中 watch 和计算属性的区别\n\n- 计算属性是自动监听依赖值的变化，从而动态返回内容，监听到值变化时，可以出发一次回调，并做一些事情，若是仅需要动态值就使用计算属性\n- 需要知道值改变后执行业务逻辑，才用 watch\n\n## 为什么通常在发送数据买点请求的时候使用的是 1\\*1 像素的透明 gif 图片。\n\n1. 没有跨域问题，一般这种数据上报，代码要写通用的\n2. 不会阻塞页面加载，影响用户体验，只要 new image 对象就好了\n3. 在所有图片中，体积最小\n4. 相比 XMLHttpRequest 对象发送 GET 请求，性能上更好。\n\n另外该脚本的位置一般放在页面最后以免阻塞页面渲染,并且一般情况下也不需要 append 到 DOM 中。通过它的 onerror 和 onload 事件来检测发送状态\n\n```javascript\nvar thisPage = location.href\nvar referringPage = document.referrer ? document.referrer : 'none'\nvar beacon = new Image()\nbeacon.src =\n  'http://www.example.com/logger/beacon.gif?page=' +\n  encodeURI(thisPage) +\n  '&ref=' +\n  encodeURI(referringPage)\n```\n\n## input 搜索如何防抖，如何处理中文输入\n\n```javascript\n// 这个是用来获取当前时间戳的\nfunction now() {\n  return +new Date()\n}\n/**\n * 防抖函数，返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行\n *\n * @param  {function} func        回调函数\n * @param  {number}   wait        表示时间窗口的间隔\n * @param  {boolean}  immediate   设置为ture时，是否立即调用函数\n * @return {function}             返回客户调用函数\n */\nfunction debounce(func, wait = 50, immediate = true) {\n  let timer, context, args\n\n  // 延迟执行函数\n  const later = () =>\n    setTimeout(() => {\n      // 延迟函数执行完毕，清空缓存的定时器序号\n      timer = null\n      // 延迟执行的情况下，函数会在延迟函数中执行\n      // 使用到之前缓存的参数和上下文\n      if (!immediate) {\n        func.apply(context, args)\n        context = args = null\n      }\n    }, wait)\n\n  // 这里返回的函数是每次实际调用的函数\n  return function (...params) {\n    // 如果没有创建延迟执行函数（later），就创建一个\n    if (!timer) {\n      timer = later()\n      // 如果是立即执行，调用函数\n      // 否则缓存参数和调用上下文\n      if (immediate) {\n        func.apply(this, params)\n      } else {\n        context = this\n        args = params\n      }\n      // 如果已有延迟执行函数（later），调用的时候清除原来的并重新设定一个\n      // 这样做延迟函数会重新计时\n    } else {\n      clearTimeout(timer)\n      timer = later()\n    }\n  }\n}\n```\n\n有兼容问题\n\n## DNS 预解析\n\nDNS 解析也是需要时间的，可以通过与解析的方式来蔚县获得域名所对应的 IP\n`<link rel=\"dns-prefetch\" href=\"//yuchengkai.cn\" />`\n","source":"_posts/小知识点积累.md","raw":"---\ntitle: 知识点积累\ndate: 2018-03-08 18:21:15\ncategories: Web\n---\n\n记录一些零碎的知识点\n\n<!--more-->\n\n## CSS 有哪些样式可以给子元素继承\n\n- 可继承的:`font-size`,`font-weight`,`line-height`,`color`,`cursor` 等 。\n- 不可继承的一般是会改变盒子模型的:`display`,`margin`、`border`、`padding`、`height` 等。\n\n## box-sizing 常用的属性有哪些? 分别有啥作用?\n\n这个 css 主要是改变盒子模型的大小。有两个值:`content-box`(标准模型),`border-box`（怪异模型）\n\n```html\n<style>\n  .test {\n    box-sizing: content-box;\n    border: 5px solid #f00;\n    padding: 5px;\n    width: 100px;\n    height: 100px;\n  }\n</style>\n<div class=\"test\"></div>\n<!--\ncontent-box的计算公式会把宽高的定义指向 content,border和 padding 另外计算,\n也就是说 content + padding + border = 120px(盒子实际大小)\n\n而border-box的计算公式是总的大小涵盖这三者, content 会缩小,来让给另外两者\ncontent(80px) + padding(5*2px) + border(5*2px) = 100px\n-->\n```\n\n## 说说样式权重的优先级;\n\n`!important` > `行内样式` > `id` > `class` > `tag`\n\n## 对数组 ['2018-03-05', '2013-06-12','2019-03-12','2018-03-05','2014-02-22'] 去重且排序\n\n```javascript\n//很好理解, Set 具有值唯一性(但不是所有值,等会我抛出我的另外一篇文章)\n// 结合...解构,可以把可迭代(比如 arguments/nodelist 等)的转为数组\n// sort 里面传入 两个值比较,返回-1和1是因为1代表这个数大排后(相对),-1代表小(相对),0为相等\n\nlet arr = [\n  ...new Set([\n    '2018-03-05',\n    '2013-06-12',\n    '2019-03-12',\n    '2018-03-05',\n    '2014-02-22'\n  ])\n].sort(function (a, b) {\n  return a < b ? -1 : 1 // 这里返回的是升序的,降序改下返回值就好了.所以是相对\n})\n\n// [\"2013-06-12\", \"2014-02-22\", \"2018-03-05\", \"2019-03-12\"]\n```\n\n## 对数组[1,2,3,4,5,'6',7,'8','a','b','z']进行乱序\n\n```javascript\n// 我们依旧可以用上面的 sort 的原理实现乱序\n\nlet tempArr = [1, 2, 3, 4, 5, '6', 7, '8', 'a', 'b', 'z'].sort(function () {\n  return Math.random() > 0.5 ? -1 : 1\n})\n\n// 因为里面有随机数,所以答案没有标准答案,我这边跑了一次是输出这个\n//[\"6\", \"z\", 3, \"b\", 5, 2, 7, \"8\", \"a\", 1, 4]\n```\n\n##　 求[1, 10, 11, -1,'-5',12, 13, 14, 15, 2, 3, 4, 7, 8, 9]内最大值与最小值之差\n\n```javascript\n// 来一个很粗糙的版本,只当传入是数组且可以隐性转为数字的\nfunction MaxMinPlus(arr) {\n  // 返回最大值与最小值之差\n  return Array.isArray(arr)\n    ? Math.max.apply(Math, arr) - Math.min.apply(Math, arr)\n    : console.log('传入的不是数组亦或者未能解决的错误')\n}\n\n// 结果是 20\n\n// 若是要完善的话,要考虑传入的是非数组,\n//传入字符串的时候要判断,然后切割为数组..\n// 都要考虑进去代码量不短\n```\n\n## JS 的作用域是什么?有什么特别之处么\n\n作用域就是有它自身的上下文区域(比如函数内),内部会有变量声明提升,函数声明提升这些;\n\n函数声明提升优于变量声明提升..\n\n作用域有全局作用域和块级作用域(局部,比如用 let 或者单纯花括号的);\n\n作用域会影响 this 的指向\n\n### 作用域链\n\n当访问一个变量时，解释器会首先在当前作用域查找标示符，如果没有找到，就去父作用域找，直到找到该变量的标示符或者不在父作用域中，这就是作用域链\n\n作用域链和原型继承查找时的区别：如果去查找一个普通对象的属性，但是在当前对象和其原型中都找不到时，会返回 undefined；但查找的属性在作用域链中不存在的话就会抛出 ReferenceError。\n\n作用域链的顶端是全局对象，在全局环境中定义的变量就会绑定到全局对象中。\n\n## javascript 里面的继承怎么实现，如何避免原型链上面的对象共享\n\n- ES5:寄生组合式继承:通过借用构造函数来继承属性和原型链来实现子继承父。\n\n```javascript\nfunction ParentClass(name) {\n  this.name = name\n}\nParentClass.prototype.sayHello = function () {\n  console.log(\"I'm parent!\" + this.name)\n}\nfunction SubClass(name, age) {\n  //若是要多个参数可以用apply 结合 ...解构\n  ParentClass.call(this, name)\n  this.age = age\n}\nSubClass.prototype = Object.create(ParentClass.prototype)\nSubClass.prototype.constructor = SubClass\nSubClass.prototype.sayChildHello = function (name) {\n  console.log(\"I'm child \" + this.name)\n}\n\nlet testA = new SubClass('CRPER')\n\n// Object.create()的polyfill\n/*\n    function pureObject(o){\n        //定义了一个临时构造函数\n         function F() {}\n         //将这个临时构造函数的原型指向了传入进来的对象。\n         F.prototype = obj;\n         //返回这个构造函数的一个实例。该实例拥有obj的所有属性和方法。\n         //因为该实例的原型是obj对象。\n         return new F();\n    }\n    */\n```\n\n- ES6: 其实就是 ES5 的语法糖,不过可读性很强\n\n```javascript\nclass ParentClass {\n  constructor(name) {\n    this.name = name\n  }\n  sayHello() {\n    console.log(\"I'm parent!\" + this.name)\n  }\n}\n\nclass SubClass extends ParentClass {\n  constructor(name) {\n    super(name)\n  }\n  sayChildHello() {\n    console.log(\"I'm child \" + this.name)\n  }\n  // 重新声明父类同名方法会覆写,ES5的话就是直接操作自己的原型链上\n  sayHello() {\n    console.log(\"override parent method !,I'm sayHello Method\")\n  }\n}\n\nlet testA = new SubClass('CRPER')\n```\n\n## 渲染海量数据且给每条内容添加监听事件\n\n现在浏览器提供了`requestAnimationFrame`API 来解决非常耗时的代码段对渲染阻塞问题。\n\n```javascript\n;(() => {\n  const ndContainer = document.getElementById('js-list')\n  if (!ndContainer) {\n    return\n  }\n\n  const total = 30000\n  const batchSize = 4 // 每批插入的节点次数，越大越卡\n  const batchCount = total / batchSize // 需要批量处理多少次\n  let batchDone = 0 // 已经完成的批处理个数\n\n  function appendItems() {\n    //这是掘金答案，可是个人觉得innerHTML会更好，经测试是真的更好\n    const fragment = document.createDocumentFragment()\n    for (let i = 0; i < batchSize; i++) {\n      const ndItem = document.createElement('li')\n      ndItem.innerText = batchDone * batchSize + i + 1\n      fragment.appendChild(ndItem)\n    }\n\n    // 每次批处理只修改 1 次 DOM\n    ndContainer.appendChild(fragment)\n\n    batchDone += 1\n    doBatchAppend()\n  }\n\n  function doBatchAppend() {\n    if (batchDone < batchCount) {\n      window.requestAnimationFrame(appendItems)\n    }\n  }\n\n  // kickoff\n  doBatchAppend()\n\n  ndContainer.addEventListener('click', function (e) {\n    const target = e.target\n    if (target.tagName === 'LI') {\n      alert(target.innerHTML)\n    }\n  })\n})()\n```\n\n## vue 中 watch 和计算属性的区别\n\n- 计算属性是自动监听依赖值的变化，从而动态返回内容，监听到值变化时，可以出发一次回调，并做一些事情，若是仅需要动态值就使用计算属性\n- 需要知道值改变后执行业务逻辑，才用 watch\n\n## 为什么通常在发送数据买点请求的时候使用的是 1\\*1 像素的透明 gif 图片。\n\n1. 没有跨域问题，一般这种数据上报，代码要写通用的\n2. 不会阻塞页面加载，影响用户体验，只要 new image 对象就好了\n3. 在所有图片中，体积最小\n4. 相比 XMLHttpRequest 对象发送 GET 请求，性能上更好。\n\n另外该脚本的位置一般放在页面最后以免阻塞页面渲染,并且一般情况下也不需要 append 到 DOM 中。通过它的 onerror 和 onload 事件来检测发送状态\n\n```javascript\nvar thisPage = location.href\nvar referringPage = document.referrer ? document.referrer : 'none'\nvar beacon = new Image()\nbeacon.src =\n  'http://www.example.com/logger/beacon.gif?page=' +\n  encodeURI(thisPage) +\n  '&ref=' +\n  encodeURI(referringPage)\n```\n\n## input 搜索如何防抖，如何处理中文输入\n\n```javascript\n// 这个是用来获取当前时间戳的\nfunction now() {\n  return +new Date()\n}\n/**\n * 防抖函数，返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行\n *\n * @param  {function} func        回调函数\n * @param  {number}   wait        表示时间窗口的间隔\n * @param  {boolean}  immediate   设置为ture时，是否立即调用函数\n * @return {function}             返回客户调用函数\n */\nfunction debounce(func, wait = 50, immediate = true) {\n  let timer, context, args\n\n  // 延迟执行函数\n  const later = () =>\n    setTimeout(() => {\n      // 延迟函数执行完毕，清空缓存的定时器序号\n      timer = null\n      // 延迟执行的情况下，函数会在延迟函数中执行\n      // 使用到之前缓存的参数和上下文\n      if (!immediate) {\n        func.apply(context, args)\n        context = args = null\n      }\n    }, wait)\n\n  // 这里返回的函数是每次实际调用的函数\n  return function (...params) {\n    // 如果没有创建延迟执行函数（later），就创建一个\n    if (!timer) {\n      timer = later()\n      // 如果是立即执行，调用函数\n      // 否则缓存参数和调用上下文\n      if (immediate) {\n        func.apply(this, params)\n      } else {\n        context = this\n        args = params\n      }\n      // 如果已有延迟执行函数（later），调用的时候清除原来的并重新设定一个\n      // 这样做延迟函数会重新计时\n    } else {\n      clearTimeout(timer)\n      timer = later()\n    }\n  }\n}\n```\n\n有兼容问题\n\n## DNS 预解析\n\nDNS 解析也是需要时间的，可以通过与解析的方式来蔚县获得域名所对应的 IP\n`<link rel=\"dns-prefetch\" href=\"//yuchengkai.cn\" />`\n","slug":"小知识点积累","published":1,"updated":"2021-05-06T12:22:09.897Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xd002gl5v00sqn1mus","content":"<p>记录一些零碎的知识点</p>\n<span id=\"more\"></span>\n\n<h2 id=\"CSS-有哪些样式可以给子元素继承\"><a href=\"#CSS-有哪些样式可以给子元素继承\" class=\"headerlink\" title=\"CSS 有哪些样式可以给子元素继承\"></a>CSS 有哪些样式可以给子元素继承</h2><ul>\n<li>可继承的:<code>font-size</code>,<code>font-weight</code>,<code>line-height</code>,<code>color</code>,<code>cursor</code> 等 。</li>\n<li>不可继承的一般是会改变盒子模型的:<code>display</code>,<code>margin</code>、<code>border</code>、<code>padding</code>、<code>height</code> 等。</li>\n</ul>\n<h2 id=\"box-sizing-常用的属性有哪些-分别有啥作用\"><a href=\"#box-sizing-常用的属性有哪些-分别有啥作用\" class=\"headerlink\" title=\"box-sizing 常用的属性有哪些? 分别有啥作用?\"></a>box-sizing 常用的属性有哪些? 分别有啥作用?</h2><p>这个 css 主要是改变盒子模型的大小。有两个值:<code>content-box</code>(标准模型),<code>border-box</code>（怪异模型）</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">  .test &#123;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">box-sizing</span>: content-box;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">border</span>: <span class=\"number\">5px</span> solid <span class=\"number\">#f00</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;test&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">content-box的计算公式会把宽高的定义指向 content,border和 padding 另外计算,</span></span><br><span class=\"line\"><span class=\"comment\">也就是说 content + padding + border = 120px(盒子实际大小)</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">而border-box的计算公式是总的大小涵盖这三者, content 会缩小,来让给另外两者</span></span><br><span class=\"line\"><span class=\"comment\">content(80px) + padding(5*2px) + border(5*2px) = 100px</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"说说样式权重的优先级\"><a href=\"#说说样式权重的优先级\" class=\"headerlink\" title=\"说说样式权重的优先级;\"></a>说说样式权重的优先级;</h2><p><code>!important</code> &gt; <code>行内样式</code> &gt; <code>id</code> &gt; <code>class</code> &gt; <code>tag</code></p>\n<h2 id=\"对数组-‘2018-03-05’-‘2013-06-12’-’2019-03-12’-’2018-03-05’-’2014-02-22’-去重且排序\"><a href=\"#对数组-‘2018-03-05’-‘2013-06-12’-’2019-03-12’-’2018-03-05’-’2014-02-22’-去重且排序\" class=\"headerlink\" title=\"对数组 [‘2018-03-05’, ‘2013-06-12’,’2019-03-12’,’2018-03-05’,’2014-02-22’] 去重且排序\"></a>对数组 [‘2018-03-05’, ‘2013-06-12’,’2019-03-12’,’2018-03-05’,’2014-02-22’] 去重且排序</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//很好理解, Set 具有值唯一性(但不是所有值,等会我抛出我的另外一篇文章)</span></span><br><span class=\"line\"><span class=\"comment\">// 结合...解构,可以把可迭代(比如 arguments/nodelist 等)的转为数组</span></span><br><span class=\"line\"><span class=\"comment\">// sort 里面传入 两个值比较,返回-1和1是因为1代表这个数大排后(相对),-1代表小(相对),0为相等</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [</span><br><span class=\"line\">  ...new <span class=\"built_in\">Set</span>([</span><br><span class=\"line\">    <span class=\"string\">&#x27;2018-03-05&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;2013-06-12&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;2019-03-12&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;2018-03-05&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;2014-02-22&#x27;</span></span><br><span class=\"line\">  ])</span><br><span class=\"line\">].sort(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a &lt; b ? -<span class=\"number\">1</span> : <span class=\"number\">1</span> <span class=\"comment\">// 这里返回的是升序的,降序改下返回值就好了.所以是相对</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// [&quot;2013-06-12&quot;, &quot;2014-02-22&quot;, &quot;2018-03-05&quot;, &quot;2019-03-12&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"对数组-1-2-3-4-5-’6’-7-’8’-’a’-’b’-’z’-进行乱序\"><a href=\"#对数组-1-2-3-4-5-’6’-7-’8’-’a’-’b’-’z’-进行乱序\" class=\"headerlink\" title=\"对数组[1,2,3,4,5,’6’,7,’8’,’a’,’b’,’z’]进行乱序\"></a>对数组[1,2,3,4,5,’6’,7,’8’,’a’,’b’,’z’]进行乱序</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 我们依旧可以用上面的 sort 的原理实现乱序</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> tempArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"string\">&#x27;6&#x27;</span>, <span class=\"number\">7</span>, <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;z&#x27;</span>].sort(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.random() &gt; <span class=\"number\">0.5</span> ? -<span class=\"number\">1</span> : <span class=\"number\">1</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 因为里面有随机数,所以答案没有标准答案,我这边跑了一次是输出这个</span></span><br><span class=\"line\"><span class=\"comment\">//[&quot;6&quot;, &quot;z&quot;, 3, &quot;b&quot;, 5, 2, 7, &quot;8&quot;, &quot;a&quot;, 1, 4]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"求-1-10-11-1-’-5’-12-13-14-15-2-3-4-7-8-9-内最大值与最小值之差\"><a href=\"#求-1-10-11-1-’-5’-12-13-14-15-2-3-4-7-8-9-内最大值与最小值之差\" class=\"headerlink\" title=\"求[1, 10, 11, -1,’-5’,12, 13, 14, 15, 2, 3, 4, 7, 8, 9]内最大值与最小值之差\"></a>求[1, 10, 11, -1,’-5’,12, 13, 14, 15, 2, 3, 4, 7, 8, 9]内最大值与最小值之差</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 来一个很粗糙的版本,只当传入是数组且可以隐性转为数字的</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MaxMinPlus</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 返回最大值与最小值之差</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.isArray(arr)</span><br><span class=\"line\">    ? <span class=\"built_in\">Math</span>.max.apply(<span class=\"built_in\">Math</span>, arr) - <span class=\"built_in\">Math</span>.min.apply(<span class=\"built_in\">Math</span>, arr)</span><br><span class=\"line\">    : <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;传入的不是数组亦或者未能解决的错误&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 结果是 20</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 若是要完善的话,要考虑传入的是非数组,</span></span><br><span class=\"line\"><span class=\"comment\">//传入字符串的时候要判断,然后切割为数组..</span></span><br><span class=\"line\"><span class=\"comment\">// 都要考虑进去代码量不短</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"JS-的作用域是什么-有什么特别之处么\"><a href=\"#JS-的作用域是什么-有什么特别之处么\" class=\"headerlink\" title=\"JS 的作用域是什么?有什么特别之处么\"></a>JS 的作用域是什么?有什么特别之处么</h2><p>作用域就是有它自身的上下文区域(比如函数内),内部会有变量声明提升,函数声明提升这些;</p>\n<p>函数声明提升优于变量声明提升..</p>\n<p>作用域有全局作用域和块级作用域(局部,比如用 let 或者单纯花括号的);</p>\n<p>作用域会影响 this 的指向</p>\n<h3 id=\"作用域链\"><a href=\"#作用域链\" class=\"headerlink\" title=\"作用域链\"></a>作用域链</h3><p>当访问一个变量时，解释器会首先在当前作用域查找标示符，如果没有找到，就去父作用域找，直到找到该变量的标示符或者不在父作用域中，这就是作用域链</p>\n<p>作用域链和原型继承查找时的区别：如果去查找一个普通对象的属性，但是在当前对象和其原型中都找不到时，会返回 undefined；但查找的属性在作用域链中不存在的话就会抛出 ReferenceError。</p>\n<p>作用域链的顶端是全局对象，在全局环境中定义的变量就会绑定到全局对象中。</p>\n<h2 id=\"javascript-里面的继承怎么实现，如何避免原型链上面的对象共享\"><a href=\"#javascript-里面的继承怎么实现，如何避免原型链上面的对象共享\" class=\"headerlink\" title=\"javascript 里面的继承怎么实现，如何避免原型链上面的对象共享\"></a>javascript 里面的继承怎么实现，如何避免原型链上面的对象共享</h2><ul>\n<li>ES5:寄生组合式继承:通过借用构造函数来继承属性和原型链来实现子继承父。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ParentClass</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ParentClass.prototype.sayHello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m parent!&quot;</span> + <span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubClass</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//若是要多个参数可以用apply 结合 ...解构</span></span><br><span class=\"line\">  ParentClass.call(<span class=\"built_in\">this</span>, name)</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">SubClass.prototype = <span class=\"built_in\">Object</span>.create(ParentClass.prototype)</span><br><span class=\"line\">SubClass.prototype.constructor = SubClass</span><br><span class=\"line\">SubClass.prototype.sayChildHello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m child &quot;</span> + <span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> testA = <span class=\"keyword\">new</span> SubClass(<span class=\"string\">&#x27;CRPER&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Object.create()的polyfill</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    function pureObject(o)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">        //定义了一个临时构造函数</span></span><br><span class=\"line\"><span class=\"comment\">         function F() &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">         //将这个临时构造函数的原型指向了传入进来的对象。</span></span><br><span class=\"line\"><span class=\"comment\">         F.prototype = obj;</span></span><br><span class=\"line\"><span class=\"comment\">         //返回这个构造函数的一个实例。该实例拥有obj的所有属性和方法。</span></span><br><span class=\"line\"><span class=\"comment\">         //因为该实例的原型是obj对象。</span></span><br><span class=\"line\"><span class=\"comment\">         return new F();</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ES6: 其实就是 ES5 的语法糖,不过可读性很强</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ParentClass</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayHello</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m parent!&quot;</span> + <span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SubClass</span> <span class=\"keyword\">extends</span> <span class=\"title\">ParentClass</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayChildHello</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m child &quot;</span> + <span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 重新声明父类同名方法会覆写,ES5的话就是直接操作自己的原型链上</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayHello</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;override parent method !,I&#x27;m sayHello Method&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> testA = <span class=\"keyword\">new</span> SubClass(<span class=\"string\">&#x27;CRPER&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"渲染海量数据且给每条内容添加监听事件\"><a href=\"#渲染海量数据且给每条内容添加监听事件\" class=\"headerlink\" title=\"渲染海量数据且给每条内容添加监听事件\"></a>渲染海量数据且给每条内容添加监听事件</h2><p>现在浏览器提供了<code>requestAnimationFrame</code>API 来解决非常耗时的代码段对渲染阻塞问题。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> ndContainer = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;js-list&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!ndContainer) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> total = <span class=\"number\">30000</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> batchSize = <span class=\"number\">4</span> <span class=\"comment\">// 每批插入的节点次数，越大越卡</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> batchCount = total / batchSize <span class=\"comment\">// 需要批量处理多少次</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> batchDone = <span class=\"number\">0</span> <span class=\"comment\">// 已经完成的批处理个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">appendItems</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//这是掘金答案，可是个人觉得innerHTML会更好，经测试是真的更好</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> fragment = <span class=\"built_in\">document</span>.createDocumentFragment()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; batchSize; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> ndItem = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;li&#x27;</span>)</span><br><span class=\"line\">      ndItem.innerText = batchDone * batchSize + i + <span class=\"number\">1</span></span><br><span class=\"line\">      fragment.appendChild(ndItem)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 每次批处理只修改 1 次 DOM</span></span><br><span class=\"line\">    ndContainer.appendChild(fragment)</span><br><span class=\"line\"></span><br><span class=\"line\">    batchDone += <span class=\"number\">1</span></span><br><span class=\"line\">    doBatchAppend()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doBatchAppend</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (batchDone &lt; batchCount) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.requestAnimationFrame(appendItems)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// kickoff</span></span><br><span class=\"line\">  doBatchAppend()</span><br><span class=\"line\"></span><br><span class=\"line\">  ndContainer.addEventListener(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> target = e.target</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (target.tagName === <span class=\"string\">&#x27;LI&#x27;</span>) &#123;</span><br><span class=\"line\">      alert(target.innerHTML)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"vue-中-watch-和计算属性的区别\"><a href=\"#vue-中-watch-和计算属性的区别\" class=\"headerlink\" title=\"vue 中 watch 和计算属性的区别\"></a>vue 中 watch 和计算属性的区别</h2><ul>\n<li>计算属性是自动监听依赖值的变化，从而动态返回内容，监听到值变化时，可以出发一次回调，并做一些事情，若是仅需要动态值就使用计算属性</li>\n<li>需要知道值改变后执行业务逻辑，才用 watch</li>\n</ul>\n<h2 id=\"为什么通常在发送数据买点请求的时候使用的是-1-1-像素的透明-gif-图片。\"><a href=\"#为什么通常在发送数据买点请求的时候使用的是-1-1-像素的透明-gif-图片。\" class=\"headerlink\" title=\"为什么通常在发送数据买点请求的时候使用的是 1*1 像素的透明 gif 图片。\"></a>为什么通常在发送数据买点请求的时候使用的是 1*1 像素的透明 gif 图片。</h2><ol>\n<li>没有跨域问题，一般这种数据上报，代码要写通用的</li>\n<li>不会阻塞页面加载，影响用户体验，只要 new image 对象就好了</li>\n<li>在所有图片中，体积最小</li>\n<li>相比 XMLHttpRequest 对象发送 GET 请求，性能上更好。</li>\n</ol>\n<p>另外该脚本的位置一般放在页面最后以免阻塞页面渲染,并且一般情况下也不需要 append 到 DOM 中。通过它的 onerror 和 onload 事件来检测发送状态</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> thisPage = location.href</span><br><span class=\"line\"><span class=\"keyword\">var</span> referringPage = <span class=\"built_in\">document</span>.referrer ? <span class=\"built_in\">document</span>.referrer : <span class=\"string\">&#x27;none&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> beacon = <span class=\"keyword\">new</span> Image()</span><br><span class=\"line\">beacon.src =</span><br><span class=\"line\">  <span class=\"string\">&#x27;http://www.example.com/logger/beacon.gif?page=&#x27;</span> +</span><br><span class=\"line\">  <span class=\"built_in\">encodeURI</span>(thisPage) +</span><br><span class=\"line\">  <span class=\"string\">&#x27;&amp;ref=&#x27;</span> +</span><br><span class=\"line\">  <span class=\"built_in\">encodeURI</span>(referringPage)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"input-搜索如何防抖，如何处理中文输入\"><a href=\"#input-搜索如何防抖，如何处理中文输入\" class=\"headerlink\" title=\"input 搜索如何防抖，如何处理中文输入\"></a>input 搜索如何防抖，如何处理中文输入</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这个是用来获取当前时间戳的</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">now</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 防抖函数，返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;function&#125;</span> </span>func        回调函数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;number&#125;</span>   </span>wait        表示时间窗口的间隔</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;boolean&#125;</span>  </span>immediate   设置为ture时，是否立即调用函数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return <span class=\"type\">&#123;function&#125;</span>             </span>返回客户调用函数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">func, wait = <span class=\"number\">50</span>, immediate = <span class=\"literal\">true</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer, context, args</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 延迟执行函数</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> later = <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 延迟函数执行完毕，清空缓存的定时器序号</span></span><br><span class=\"line\">      timer = <span class=\"literal\">null</span></span><br><span class=\"line\">      <span class=\"comment\">// 延迟执行的情况下，函数会在延迟函数中执行</span></span><br><span class=\"line\">      <span class=\"comment\">// 使用到之前缓存的参数和上下文</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!immediate) &#123;</span><br><span class=\"line\">        func.apply(context, args)</span><br><span class=\"line\">        context = args = <span class=\"literal\">null</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, wait)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 这里返回的函数是每次实际调用的函数</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">...params</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果没有创建延迟执行函数（later），就创建一个</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!timer) &#123;</span><br><span class=\"line\">      timer = later()</span><br><span class=\"line\">      <span class=\"comment\">// 如果是立即执行，调用函数</span></span><br><span class=\"line\">      <span class=\"comment\">// 否则缓存参数和调用上下文</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (immediate) &#123;</span><br><span class=\"line\">        func.apply(<span class=\"built_in\">this</span>, params)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        context = <span class=\"built_in\">this</span></span><br><span class=\"line\">        args = params</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 如果已有延迟执行函数（later），调用的时候清除原来的并重新设定一个</span></span><br><span class=\"line\">      <span class=\"comment\">// 这样做延迟函数会重新计时</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">clearTimeout</span>(timer)</span><br><span class=\"line\">      timer = later()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有兼容问题</p>\n<h2 id=\"DNS-预解析\"><a href=\"#DNS-预解析\" class=\"headerlink\" title=\"DNS 预解析\"></a>DNS 预解析</h2><p>DNS 解析也是需要时间的，可以通过与解析的方式来蔚县获得域名所对应的 IP<br><code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//yuchengkai.cn&quot; /&gt;</code></p>\n","site":{"data":{}},"excerpt":"<p>记录一些零碎的知识点</p>","more":"<h2 id=\"CSS-有哪些样式可以给子元素继承\"><a href=\"#CSS-有哪些样式可以给子元素继承\" class=\"headerlink\" title=\"CSS 有哪些样式可以给子元素继承\"></a>CSS 有哪些样式可以给子元素继承</h2><ul>\n<li>可继承的:<code>font-size</code>,<code>font-weight</code>,<code>line-height</code>,<code>color</code>,<code>cursor</code> 等 。</li>\n<li>不可继承的一般是会改变盒子模型的:<code>display</code>,<code>margin</code>、<code>border</code>、<code>padding</code>、<code>height</code> 等。</li>\n</ul>\n<h2 id=\"box-sizing-常用的属性有哪些-分别有啥作用\"><a href=\"#box-sizing-常用的属性有哪些-分别有啥作用\" class=\"headerlink\" title=\"box-sizing 常用的属性有哪些? 分别有啥作用?\"></a>box-sizing 常用的属性有哪些? 分别有啥作用?</h2><p>这个 css 主要是改变盒子模型的大小。有两个值:<code>content-box</code>(标准模型),<code>border-box</code>（怪异模型）</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">  .test &#123;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">box-sizing</span>: content-box;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">border</span>: <span class=\"number\">5px</span> solid <span class=\"number\">#f00</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;test&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">content-box的计算公式会把宽高的定义指向 content,border和 padding 另外计算,</span></span><br><span class=\"line\"><span class=\"comment\">也就是说 content + padding + border = 120px(盒子实际大小)</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">而border-box的计算公式是总的大小涵盖这三者, content 会缩小,来让给另外两者</span></span><br><span class=\"line\"><span class=\"comment\">content(80px) + padding(5*2px) + border(5*2px) = 100px</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"说说样式权重的优先级\"><a href=\"#说说样式权重的优先级\" class=\"headerlink\" title=\"说说样式权重的优先级;\"></a>说说样式权重的优先级;</h2><p><code>!important</code> &gt; <code>行内样式</code> &gt; <code>id</code> &gt; <code>class</code> &gt; <code>tag</code></p>\n<h2 id=\"对数组-‘2018-03-05’-‘2013-06-12’-’2019-03-12’-’2018-03-05’-’2014-02-22’-去重且排序\"><a href=\"#对数组-‘2018-03-05’-‘2013-06-12’-’2019-03-12’-’2018-03-05’-’2014-02-22’-去重且排序\" class=\"headerlink\" title=\"对数组 [‘2018-03-05’, ‘2013-06-12’,’2019-03-12’,’2018-03-05’,’2014-02-22’] 去重且排序\"></a>对数组 [‘2018-03-05’, ‘2013-06-12’,’2019-03-12’,’2018-03-05’,’2014-02-22’] 去重且排序</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//很好理解, Set 具有值唯一性(但不是所有值,等会我抛出我的另外一篇文章)</span></span><br><span class=\"line\"><span class=\"comment\">// 结合...解构,可以把可迭代(比如 arguments/nodelist 等)的转为数组</span></span><br><span class=\"line\"><span class=\"comment\">// sort 里面传入 两个值比较,返回-1和1是因为1代表这个数大排后(相对),-1代表小(相对),0为相等</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [</span><br><span class=\"line\">  ...new <span class=\"built_in\">Set</span>([</span><br><span class=\"line\">    <span class=\"string\">&#x27;2018-03-05&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;2013-06-12&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;2019-03-12&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;2018-03-05&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;2014-02-22&#x27;</span></span><br><span class=\"line\">  ])</span><br><span class=\"line\">].sort(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a &lt; b ? -<span class=\"number\">1</span> : <span class=\"number\">1</span> <span class=\"comment\">// 这里返回的是升序的,降序改下返回值就好了.所以是相对</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// [&quot;2013-06-12&quot;, &quot;2014-02-22&quot;, &quot;2018-03-05&quot;, &quot;2019-03-12&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"对数组-1-2-3-4-5-’6’-7-’8’-’a’-’b’-’z’-进行乱序\"><a href=\"#对数组-1-2-3-4-5-’6’-7-’8’-’a’-’b’-’z’-进行乱序\" class=\"headerlink\" title=\"对数组[1,2,3,4,5,’6’,7,’8’,’a’,’b’,’z’]进行乱序\"></a>对数组[1,2,3,4,5,’6’,7,’8’,’a’,’b’,’z’]进行乱序</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 我们依旧可以用上面的 sort 的原理实现乱序</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> tempArr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"string\">&#x27;6&#x27;</span>, <span class=\"number\">7</span>, <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;z&#x27;</span>].sort(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.random() &gt; <span class=\"number\">0.5</span> ? -<span class=\"number\">1</span> : <span class=\"number\">1</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 因为里面有随机数,所以答案没有标准答案,我这边跑了一次是输出这个</span></span><br><span class=\"line\"><span class=\"comment\">//[&quot;6&quot;, &quot;z&quot;, 3, &quot;b&quot;, 5, 2, 7, &quot;8&quot;, &quot;a&quot;, 1, 4]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"求-1-10-11-1-’-5’-12-13-14-15-2-3-4-7-8-9-内最大值与最小值之差\"><a href=\"#求-1-10-11-1-’-5’-12-13-14-15-2-3-4-7-8-9-内最大值与最小值之差\" class=\"headerlink\" title=\"求[1, 10, 11, -1,’-5’,12, 13, 14, 15, 2, 3, 4, 7, 8, 9]内最大值与最小值之差\"></a>求[1, 10, 11, -1,’-5’,12, 13, 14, 15, 2, 3, 4, 7, 8, 9]内最大值与最小值之差</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 来一个很粗糙的版本,只当传入是数组且可以隐性转为数字的</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MaxMinPlus</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 返回最大值与最小值之差</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.isArray(arr)</span><br><span class=\"line\">    ? <span class=\"built_in\">Math</span>.max.apply(<span class=\"built_in\">Math</span>, arr) - <span class=\"built_in\">Math</span>.min.apply(<span class=\"built_in\">Math</span>, arr)</span><br><span class=\"line\">    : <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;传入的不是数组亦或者未能解决的错误&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 结果是 20</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 若是要完善的话,要考虑传入的是非数组,</span></span><br><span class=\"line\"><span class=\"comment\">//传入字符串的时候要判断,然后切割为数组..</span></span><br><span class=\"line\"><span class=\"comment\">// 都要考虑进去代码量不短</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"JS-的作用域是什么-有什么特别之处么\"><a href=\"#JS-的作用域是什么-有什么特别之处么\" class=\"headerlink\" title=\"JS 的作用域是什么?有什么特别之处么\"></a>JS 的作用域是什么?有什么特别之处么</h2><p>作用域就是有它自身的上下文区域(比如函数内),内部会有变量声明提升,函数声明提升这些;</p>\n<p>函数声明提升优于变量声明提升..</p>\n<p>作用域有全局作用域和块级作用域(局部,比如用 let 或者单纯花括号的);</p>\n<p>作用域会影响 this 的指向</p>\n<h3 id=\"作用域链\"><a href=\"#作用域链\" class=\"headerlink\" title=\"作用域链\"></a>作用域链</h3><p>当访问一个变量时，解释器会首先在当前作用域查找标示符，如果没有找到，就去父作用域找，直到找到该变量的标示符或者不在父作用域中，这就是作用域链</p>\n<p>作用域链和原型继承查找时的区别：如果去查找一个普通对象的属性，但是在当前对象和其原型中都找不到时，会返回 undefined；但查找的属性在作用域链中不存在的话就会抛出 ReferenceError。</p>\n<p>作用域链的顶端是全局对象，在全局环境中定义的变量就会绑定到全局对象中。</p>\n<h2 id=\"javascript-里面的继承怎么实现，如何避免原型链上面的对象共享\"><a href=\"#javascript-里面的继承怎么实现，如何避免原型链上面的对象共享\" class=\"headerlink\" title=\"javascript 里面的继承怎么实现，如何避免原型链上面的对象共享\"></a>javascript 里面的继承怎么实现，如何避免原型链上面的对象共享</h2><ul>\n<li>ES5:寄生组合式继承:通过借用构造函数来继承属性和原型链来实现子继承父。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ParentClass</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ParentClass.prototype.sayHello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m parent!&quot;</span> + <span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubClass</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//若是要多个参数可以用apply 结合 ...解构</span></span><br><span class=\"line\">  ParentClass.call(<span class=\"built_in\">this</span>, name)</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">SubClass.prototype = <span class=\"built_in\">Object</span>.create(ParentClass.prototype)</span><br><span class=\"line\">SubClass.prototype.constructor = SubClass</span><br><span class=\"line\">SubClass.prototype.sayChildHello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m child &quot;</span> + <span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> testA = <span class=\"keyword\">new</span> SubClass(<span class=\"string\">&#x27;CRPER&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Object.create()的polyfill</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    function pureObject(o)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">        //定义了一个临时构造函数</span></span><br><span class=\"line\"><span class=\"comment\">         function F() &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">         //将这个临时构造函数的原型指向了传入进来的对象。</span></span><br><span class=\"line\"><span class=\"comment\">         F.prototype = obj;</span></span><br><span class=\"line\"><span class=\"comment\">         //返回这个构造函数的一个实例。该实例拥有obj的所有属性和方法。</span></span><br><span class=\"line\"><span class=\"comment\">         //因为该实例的原型是obj对象。</span></span><br><span class=\"line\"><span class=\"comment\">         return new F();</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ES6: 其实就是 ES5 的语法糖,不过可读性很强</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ParentClass</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayHello</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m parent!&quot;</span> + <span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SubClass</span> <span class=\"keyword\">extends</span> <span class=\"title\">ParentClass</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayChildHello</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m child &quot;</span> + <span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 重新声明父类同名方法会覆写,ES5的话就是直接操作自己的原型链上</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayHello</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;override parent method !,I&#x27;m sayHello Method&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> testA = <span class=\"keyword\">new</span> SubClass(<span class=\"string\">&#x27;CRPER&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"渲染海量数据且给每条内容添加监听事件\"><a href=\"#渲染海量数据且给每条内容添加监听事件\" class=\"headerlink\" title=\"渲染海量数据且给每条内容添加监听事件\"></a>渲染海量数据且给每条内容添加监听事件</h2><p>现在浏览器提供了<code>requestAnimationFrame</code>API 来解决非常耗时的代码段对渲染阻塞问题。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> ndContainer = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;js-list&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!ndContainer) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> total = <span class=\"number\">30000</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> batchSize = <span class=\"number\">4</span> <span class=\"comment\">// 每批插入的节点次数，越大越卡</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> batchCount = total / batchSize <span class=\"comment\">// 需要批量处理多少次</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> batchDone = <span class=\"number\">0</span> <span class=\"comment\">// 已经完成的批处理个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">appendItems</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//这是掘金答案，可是个人觉得innerHTML会更好，经测试是真的更好</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> fragment = <span class=\"built_in\">document</span>.createDocumentFragment()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; batchSize; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> ndItem = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;li&#x27;</span>)</span><br><span class=\"line\">      ndItem.innerText = batchDone * batchSize + i + <span class=\"number\">1</span></span><br><span class=\"line\">      fragment.appendChild(ndItem)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 每次批处理只修改 1 次 DOM</span></span><br><span class=\"line\">    ndContainer.appendChild(fragment)</span><br><span class=\"line\"></span><br><span class=\"line\">    batchDone += <span class=\"number\">1</span></span><br><span class=\"line\">    doBatchAppend()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doBatchAppend</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (batchDone &lt; batchCount) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.requestAnimationFrame(appendItems)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// kickoff</span></span><br><span class=\"line\">  doBatchAppend()</span><br><span class=\"line\"></span><br><span class=\"line\">  ndContainer.addEventListener(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> target = e.target</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (target.tagName === <span class=\"string\">&#x27;LI&#x27;</span>) &#123;</span><br><span class=\"line\">      alert(target.innerHTML)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"vue-中-watch-和计算属性的区别\"><a href=\"#vue-中-watch-和计算属性的区别\" class=\"headerlink\" title=\"vue 中 watch 和计算属性的区别\"></a>vue 中 watch 和计算属性的区别</h2><ul>\n<li>计算属性是自动监听依赖值的变化，从而动态返回内容，监听到值变化时，可以出发一次回调，并做一些事情，若是仅需要动态值就使用计算属性</li>\n<li>需要知道值改变后执行业务逻辑，才用 watch</li>\n</ul>\n<h2 id=\"为什么通常在发送数据买点请求的时候使用的是-1-1-像素的透明-gif-图片。\"><a href=\"#为什么通常在发送数据买点请求的时候使用的是-1-1-像素的透明-gif-图片。\" class=\"headerlink\" title=\"为什么通常在发送数据买点请求的时候使用的是 1*1 像素的透明 gif 图片。\"></a>为什么通常在发送数据买点请求的时候使用的是 1*1 像素的透明 gif 图片。</h2><ol>\n<li>没有跨域问题，一般这种数据上报，代码要写通用的</li>\n<li>不会阻塞页面加载，影响用户体验，只要 new image 对象就好了</li>\n<li>在所有图片中，体积最小</li>\n<li>相比 XMLHttpRequest 对象发送 GET 请求，性能上更好。</li>\n</ol>\n<p>另外该脚本的位置一般放在页面最后以免阻塞页面渲染,并且一般情况下也不需要 append 到 DOM 中。通过它的 onerror 和 onload 事件来检测发送状态</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> thisPage = location.href</span><br><span class=\"line\"><span class=\"keyword\">var</span> referringPage = <span class=\"built_in\">document</span>.referrer ? <span class=\"built_in\">document</span>.referrer : <span class=\"string\">&#x27;none&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> beacon = <span class=\"keyword\">new</span> Image()</span><br><span class=\"line\">beacon.src =</span><br><span class=\"line\">  <span class=\"string\">&#x27;http://www.example.com/logger/beacon.gif?page=&#x27;</span> +</span><br><span class=\"line\">  <span class=\"built_in\">encodeURI</span>(thisPage) +</span><br><span class=\"line\">  <span class=\"string\">&#x27;&amp;ref=&#x27;</span> +</span><br><span class=\"line\">  <span class=\"built_in\">encodeURI</span>(referringPage)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"input-搜索如何防抖，如何处理中文输入\"><a href=\"#input-搜索如何防抖，如何处理中文输入\" class=\"headerlink\" title=\"input 搜索如何防抖，如何处理中文输入\"></a>input 搜索如何防抖，如何处理中文输入</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这个是用来获取当前时间戳的</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">now</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 防抖函数，返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;function&#125;</span> </span>func        回调函数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;number&#125;</span>   </span>wait        表示时间窗口的间隔</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;boolean&#125;</span>  </span>immediate   设置为ture时，是否立即调用函数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return <span class=\"type\">&#123;function&#125;</span>             </span>返回客户调用函数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">func, wait = <span class=\"number\">50</span>, immediate = <span class=\"literal\">true</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer, context, args</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 延迟执行函数</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> later = <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 延迟函数执行完毕，清空缓存的定时器序号</span></span><br><span class=\"line\">      timer = <span class=\"literal\">null</span></span><br><span class=\"line\">      <span class=\"comment\">// 延迟执行的情况下，函数会在延迟函数中执行</span></span><br><span class=\"line\">      <span class=\"comment\">// 使用到之前缓存的参数和上下文</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!immediate) &#123;</span><br><span class=\"line\">        func.apply(context, args)</span><br><span class=\"line\">        context = args = <span class=\"literal\">null</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, wait)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 这里返回的函数是每次实际调用的函数</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">...params</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果没有创建延迟执行函数（later），就创建一个</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!timer) &#123;</span><br><span class=\"line\">      timer = later()</span><br><span class=\"line\">      <span class=\"comment\">// 如果是立即执行，调用函数</span></span><br><span class=\"line\">      <span class=\"comment\">// 否则缓存参数和调用上下文</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (immediate) &#123;</span><br><span class=\"line\">        func.apply(<span class=\"built_in\">this</span>, params)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        context = <span class=\"built_in\">this</span></span><br><span class=\"line\">        args = params</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 如果已有延迟执行函数（later），调用的时候清除原来的并重新设定一个</span></span><br><span class=\"line\">      <span class=\"comment\">// 这样做延迟函数会重新计时</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">clearTimeout</span>(timer)</span><br><span class=\"line\">      timer = later()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有兼容问题</p>\n<h2 id=\"DNS-预解析\"><a href=\"#DNS-预解析\" class=\"headerlink\" title=\"DNS 预解析\"></a>DNS 预解析</h2><p>DNS 解析也是需要时间的，可以通过与解析的方式来蔚县获得域名所对应的 IP<br><code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//yuchengkai.cn&quot; /&gt;</code></p>"},{"title":"工作中所遇到的问题","date":"2019-03-11T08:06:45.000Z","_content":"\n记录一下自己在工作中所遇到的问题及及解决方案\n\n<!--more-->\n\n## 本地开发 跨域 (基础)\n\n在本地开发 请求线上的接口时 会遇到跨域的问题 那时如何解决的呢？\n\n-   使用 `chrome` 浏览器的跨域设置 （适用与不使用 webpack 打包的项目）\n-   webpack 配置 `proxyConfig`设置代理\n-   使用 Nginx 等反向代理工具\n-   使用 fiddler 等拦截转发工具\n\n## 查找对象或者中是否有存在某个值\n\n1. `indexOf(1)`;\n   对于浅数组使用好用，对于复杂数组，数组嵌套对象再嵌套数组 且是动态取值比较的 用 indexOf 就难比较，因为 indexOf 计较的值一旦索引发生了改变就没有办法比较是否存在某一个对象了。这种情况 将数组进行 JSON.stringfy 后再 indexOf 就可以解决了\n2. `arr.find()`\n   数组实例的`find()`用于查找目标元素，查不到返回 `undefined`\n3. 对象中直接使用`array[kry]`调用，若没有则会返回`undefined`且不会报错。\n\n## 用 jQuery 实现多品类购买的购物车\n\n1. 在页面中能对单个物品进行加减并加入到购物车的操作，保证购物车物品的唯一，最新的特性，考虑到这个情况，是用一下思路解决的：\n\n    - 在点击物品时将物品的单个信息对象保存下来，加减时操作信息对象\n    - 点击加入购物车时，将信息对象的 id 拿出来当成对象的 key 值添加到对象中，利用对象 key 的唯一性，且能更好的进行覆盖和删除操作。\n    - 在整个流程中利用数组对象的指针特性，改变其中的某一个值影响到原本的对象，保证了多个视图层的数据统一性。\n\n2. 考虑到页面中能进行筛选和搜索（都是从后台重新拿取的数据），重新渲染物品列表导致原本的购物数量的信息丢失。\n\n    - 在从接口获取数组列表时，就比对原本的购物车列表，再进行刷新渲染\n\n3. 因为使用的 jquery,所以想封装一个组件，组件中 监听一个 click 事件 并且可以执行相应的回调， 当时用的事件委托 ，暂时还不知道怎么封装，类似于商品列表的加减器和购物车列表的加减器\n\n## 通过 script 单独引入 vue.js\n\n最开始接触 vue.js 时，最开始有两个使用途径，一个是 vue-cli 脚手架的单页应用，一个是通过 script 单链引入的形式。\n\n在使用单链的时候在进入首屏时，遇到过如下问题：\n\n-   页面中会出现 vue 的未解析的符号，例如&#123;&#123;&#125;&#125;和初始样式。\n-   当 js 判断再引入主题皮肤 css 时，会有很大一段时间是原始样式在突然过度到皮肤样式，不够美观，而且很奇怪\n\n当时没有想清楚，然后搁置之后就忘记了这个问题，如今又要负责这种单链的页面，又遭遇了一样的问题，才惊觉其原因：\n首先我们将 vue.min.js 在 body 后面才引入的，把 vue.min.js 放在 head 中就可以解决了出现未解析的符号这个问题。是由于加载 html 之后还没有加载 js 对页面进行解析才出现了这个问题\n\n那未初始化的样式该如何解决呢？\n在以前是通过操作 css 来解决的，\n\n-   最开始默认样式是 display：none 通过 js 控制 class 而不是直接通过 v-show 操作。相当于 v-show v-if 全部不用。（好痛苦啊这种方案）。\n-   还有一种是加 loading，在 creat 里面 loading 结束。\n\nv-show\\v-if 是无法操作 css 样式为 display：none 的元素的。\n\n而且单链的形式都没有办法用 es6 和封装组件，没有成熟的生态圈。这种开发方式太痛苦了，最可怕的是单链 vue+前后不分离。。。。我选择死亡。而且单链这种模式如何封装组件呢？这是个问题。\n\n## 前端导出表格\n\n很早就做过导出表格的功能，也有考虑过前端是否能导出 excel 表格。现在看到了一个纯前端导出文件的插件——`SheetJS`\n\n纯前端的实现方案能够在不依赖服务端能力和网络的情况下完成数据导出。虽然如此，数据量较大的时候，站在性能及用户体验的角度，在服务端完成会是更优雅的解法。\n\n## window.open 浏览器拦截\n\nwindow.open 可以实现打开一个新浏览器窗口。\n\n```javascript\nvar btn = $(\"#btn\");\nbtn.click(function() {\n    //不会被拦截\n    window.open(\"http://www.baidu.com\");\n});\n```\n\n如果是用户触发的时候，是不会拦截的，可以正常打开新窗口，所以，如果是用户主动触发弹窗，浏览器一般不会拦截。\n\n```javascript\nvar btn = $(\"#btn\");\nbtn.click(function() {\n    $.ajax({\n        url: \"ooxx\",\n        success: function(url) {\n            //会被拦截\n            window.open(url);\n        }\n    });\n});\n```\n\n如上用户没有直接触发 window.open,而是发出一个 ajax 请求，window.open 方法被放在了 ajax 的回调函数里，这样的情况是会被拦截的\n\n-   当浏览器检测到非用户操作产生的新弹出窗口，则会对其进行阻止。因为浏览器认为这不是用户希望看到的页面\n-   在 chrome 的安全机制里面，非用户触发的 window.open 方法，是会被拦截的。\n\n如何解决弹窗被拦截的问题，可以先打开一个不被拦截的空窗口，在异步请求后将 href 替换。如下：\n\n```javascript\nvar btn = $(\"#btn\");\nbtn.click(function() {\n    //打开一个不被拦截的新窗口\n    var newWindow = window.open();\n    $.ajax({\n        url: \"ooxx\",\n        success: function(url) {\n            //修改新窗口的url\n            newWindow.location.href = url;\n        }\n    });\n});\n```\n\n## 银行卡号加空格\n\n给用户输入的银行卡号 每隔 4 位加一个空格，切只能输入数字\n\n### 方案一\n\n```html\n<input\n    type=\"text\"\n    onkeypress=\"return (function(key,that){return (key>47&&key<58) && ((that.value.length%5==0)?that.value+=' ':1)})(event.keyCode,this)\"\n/>\n```\n\n在 chrome 上输入数字的体验特别良好，输入中文时就会出现不触发 onKeypress 事件， 更重要的是无法兼容移动端，在华为浏览器上就死在第一步，所以就直接抛弃。\n\n### 方案二\n\n```JavaScript\n<input\n    type=\"text\"\n    id=\"bankId\"\n    maxlength=\"23\"\n    placeholder=\"请输入银行卡号\"\n    oninput=\"value=value.replace(/[^\\d\\s]/g,'')\"\n/>;\n\ninput.on(\"keyup\", function(e) {\n    v = this.value;\n    v = v.replace(/\\s*/g, \"\");\n    if (/\\S{5}/.test(v)) {\n        this.value = v.replace(/(\\d{4})(?=\\d)/g, \"$1 \");\n    }\n});\n```\n\n暂时没有发现什么 BUG,后记：是有BUG的，比如一直输入中文\n\n### 方案三\n\n```javascript\ninput.on(\"keyup\", function(e) {\n    var value = this.value;\n    value = value.replace(/\\s*/g, \"\");\n    var result = [];\n    for (var i = 0; i < value.length; i++) {\n        if (i % 4 == 0 && i != 0) {\n            result.push(\" \" + value.charAt(i));\n        } else {\n            result.push(value.charAt(i));\n        }\n    }\n    this.value = result.join(\"\");\n});\n```\n\n暂时也没有发现什么 BUG\n\n## 通过script 单独引入vue.js\n\n最开始接触vue.js时，最开始有两个使用途径，一个是vue-cli 脚手架的单页应用，一个是通过script 单链引入的形式。\n\n在使用单链的时候在进入首屏时，遇到过如下问题：\n- 页面中会出现vue 的未解析的符号，例如&#123;&#123;&#125;&#125;和初始样式。\n- 当js判断再引入主题皮肤css 时，会有很大一段时间是原始样式在突然过度到皮肤样式，不够美观，而且很奇怪\n\n当时没有想清楚，然后搁置之后就忘记了这个问题，如今又要负责这种单链的页面，又遭遇了一样的问题，才惊觉其原因：\n首先我们将vue.min.js在body 后面才引入的，把vue.min.js放在head中就可以解决了出现未解析的符号这个问题。是由于加载html之后还没有加载js对页面进行解析才出现了这个问题\n\n那未初始化的样式该如何解决呢？\n在以前是通过操作css 来解决的，\n- 最开始默认样式是display：none 通过js控制class 而不是直接通过v-show操作。相当于v-show v-if 全部不用。（好痛苦啊这种方案）。\n- 还有一种是加loading，在creat里面loading结束。\n\n\nv-show\\v-if 是无法操作css样式为display：none的元素的。\n\n而且单链的形式都没有办法用es6和封装组件，没有成熟的生态圈。这种开发方式太痛苦了。\n\n","source":"_posts/工作中所遇到的问题.md","raw":"---\ntitle: 工作中所遇到的问题\ndate: 2019-03-11 16:06:45\ncategories: JavaScript\n---\n\n记录一下自己在工作中所遇到的问题及及解决方案\n\n<!--more-->\n\n## 本地开发 跨域 (基础)\n\n在本地开发 请求线上的接口时 会遇到跨域的问题 那时如何解决的呢？\n\n-   使用 `chrome` 浏览器的跨域设置 （适用与不使用 webpack 打包的项目）\n-   webpack 配置 `proxyConfig`设置代理\n-   使用 Nginx 等反向代理工具\n-   使用 fiddler 等拦截转发工具\n\n## 查找对象或者中是否有存在某个值\n\n1. `indexOf(1)`;\n   对于浅数组使用好用，对于复杂数组，数组嵌套对象再嵌套数组 且是动态取值比较的 用 indexOf 就难比较，因为 indexOf 计较的值一旦索引发生了改变就没有办法比较是否存在某一个对象了。这种情况 将数组进行 JSON.stringfy 后再 indexOf 就可以解决了\n2. `arr.find()`\n   数组实例的`find()`用于查找目标元素，查不到返回 `undefined`\n3. 对象中直接使用`array[kry]`调用，若没有则会返回`undefined`且不会报错。\n\n## 用 jQuery 实现多品类购买的购物车\n\n1. 在页面中能对单个物品进行加减并加入到购物车的操作，保证购物车物品的唯一，最新的特性，考虑到这个情况，是用一下思路解决的：\n\n    - 在点击物品时将物品的单个信息对象保存下来，加减时操作信息对象\n    - 点击加入购物车时，将信息对象的 id 拿出来当成对象的 key 值添加到对象中，利用对象 key 的唯一性，且能更好的进行覆盖和删除操作。\n    - 在整个流程中利用数组对象的指针特性，改变其中的某一个值影响到原本的对象，保证了多个视图层的数据统一性。\n\n2. 考虑到页面中能进行筛选和搜索（都是从后台重新拿取的数据），重新渲染物品列表导致原本的购物数量的信息丢失。\n\n    - 在从接口获取数组列表时，就比对原本的购物车列表，再进行刷新渲染\n\n3. 因为使用的 jquery,所以想封装一个组件，组件中 监听一个 click 事件 并且可以执行相应的回调， 当时用的事件委托 ，暂时还不知道怎么封装，类似于商品列表的加减器和购物车列表的加减器\n\n## 通过 script 单独引入 vue.js\n\n最开始接触 vue.js 时，最开始有两个使用途径，一个是 vue-cli 脚手架的单页应用，一个是通过 script 单链引入的形式。\n\n在使用单链的时候在进入首屏时，遇到过如下问题：\n\n-   页面中会出现 vue 的未解析的符号，例如&#123;&#123;&#125;&#125;和初始样式。\n-   当 js 判断再引入主题皮肤 css 时，会有很大一段时间是原始样式在突然过度到皮肤样式，不够美观，而且很奇怪\n\n当时没有想清楚，然后搁置之后就忘记了这个问题，如今又要负责这种单链的页面，又遭遇了一样的问题，才惊觉其原因：\n首先我们将 vue.min.js 在 body 后面才引入的，把 vue.min.js 放在 head 中就可以解决了出现未解析的符号这个问题。是由于加载 html 之后还没有加载 js 对页面进行解析才出现了这个问题\n\n那未初始化的样式该如何解决呢？\n在以前是通过操作 css 来解决的，\n\n-   最开始默认样式是 display：none 通过 js 控制 class 而不是直接通过 v-show 操作。相当于 v-show v-if 全部不用。（好痛苦啊这种方案）。\n-   还有一种是加 loading，在 creat 里面 loading 结束。\n\nv-show\\v-if 是无法操作 css 样式为 display：none 的元素的。\n\n而且单链的形式都没有办法用 es6 和封装组件，没有成熟的生态圈。这种开发方式太痛苦了，最可怕的是单链 vue+前后不分离。。。。我选择死亡。而且单链这种模式如何封装组件呢？这是个问题。\n\n## 前端导出表格\n\n很早就做过导出表格的功能，也有考虑过前端是否能导出 excel 表格。现在看到了一个纯前端导出文件的插件——`SheetJS`\n\n纯前端的实现方案能够在不依赖服务端能力和网络的情况下完成数据导出。虽然如此，数据量较大的时候，站在性能及用户体验的角度，在服务端完成会是更优雅的解法。\n\n## window.open 浏览器拦截\n\nwindow.open 可以实现打开一个新浏览器窗口。\n\n```javascript\nvar btn = $(\"#btn\");\nbtn.click(function() {\n    //不会被拦截\n    window.open(\"http://www.baidu.com\");\n});\n```\n\n如果是用户触发的时候，是不会拦截的，可以正常打开新窗口，所以，如果是用户主动触发弹窗，浏览器一般不会拦截。\n\n```javascript\nvar btn = $(\"#btn\");\nbtn.click(function() {\n    $.ajax({\n        url: \"ooxx\",\n        success: function(url) {\n            //会被拦截\n            window.open(url);\n        }\n    });\n});\n```\n\n如上用户没有直接触发 window.open,而是发出一个 ajax 请求，window.open 方法被放在了 ajax 的回调函数里，这样的情况是会被拦截的\n\n-   当浏览器检测到非用户操作产生的新弹出窗口，则会对其进行阻止。因为浏览器认为这不是用户希望看到的页面\n-   在 chrome 的安全机制里面，非用户触发的 window.open 方法，是会被拦截的。\n\n如何解决弹窗被拦截的问题，可以先打开一个不被拦截的空窗口，在异步请求后将 href 替换。如下：\n\n```javascript\nvar btn = $(\"#btn\");\nbtn.click(function() {\n    //打开一个不被拦截的新窗口\n    var newWindow = window.open();\n    $.ajax({\n        url: \"ooxx\",\n        success: function(url) {\n            //修改新窗口的url\n            newWindow.location.href = url;\n        }\n    });\n});\n```\n\n## 银行卡号加空格\n\n给用户输入的银行卡号 每隔 4 位加一个空格，切只能输入数字\n\n### 方案一\n\n```html\n<input\n    type=\"text\"\n    onkeypress=\"return (function(key,that){return (key>47&&key<58) && ((that.value.length%5==0)?that.value+=' ':1)})(event.keyCode,this)\"\n/>\n```\n\n在 chrome 上输入数字的体验特别良好，输入中文时就会出现不触发 onKeypress 事件， 更重要的是无法兼容移动端，在华为浏览器上就死在第一步，所以就直接抛弃。\n\n### 方案二\n\n```JavaScript\n<input\n    type=\"text\"\n    id=\"bankId\"\n    maxlength=\"23\"\n    placeholder=\"请输入银行卡号\"\n    oninput=\"value=value.replace(/[^\\d\\s]/g,'')\"\n/>;\n\ninput.on(\"keyup\", function(e) {\n    v = this.value;\n    v = v.replace(/\\s*/g, \"\");\n    if (/\\S{5}/.test(v)) {\n        this.value = v.replace(/(\\d{4})(?=\\d)/g, \"$1 \");\n    }\n});\n```\n\n暂时没有发现什么 BUG,后记：是有BUG的，比如一直输入中文\n\n### 方案三\n\n```javascript\ninput.on(\"keyup\", function(e) {\n    var value = this.value;\n    value = value.replace(/\\s*/g, \"\");\n    var result = [];\n    for (var i = 0; i < value.length; i++) {\n        if (i % 4 == 0 && i != 0) {\n            result.push(\" \" + value.charAt(i));\n        } else {\n            result.push(value.charAt(i));\n        }\n    }\n    this.value = result.join(\"\");\n});\n```\n\n暂时也没有发现什么 BUG\n\n## 通过script 单独引入vue.js\n\n最开始接触vue.js时，最开始有两个使用途径，一个是vue-cli 脚手架的单页应用，一个是通过script 单链引入的形式。\n\n在使用单链的时候在进入首屏时，遇到过如下问题：\n- 页面中会出现vue 的未解析的符号，例如&#123;&#123;&#125;&#125;和初始样式。\n- 当js判断再引入主题皮肤css 时，会有很大一段时间是原始样式在突然过度到皮肤样式，不够美观，而且很奇怪\n\n当时没有想清楚，然后搁置之后就忘记了这个问题，如今又要负责这种单链的页面，又遭遇了一样的问题，才惊觉其原因：\n首先我们将vue.min.js在body 后面才引入的，把vue.min.js放在head中就可以解决了出现未解析的符号这个问题。是由于加载html之后还没有加载js对页面进行解析才出现了这个问题\n\n那未初始化的样式该如何解决呢？\n在以前是通过操作css 来解决的，\n- 最开始默认样式是display：none 通过js控制class 而不是直接通过v-show操作。相当于v-show v-if 全部不用。（好痛苦啊这种方案）。\n- 还有一种是加loading，在creat里面loading结束。\n\n\nv-show\\v-if 是无法操作css样式为display：none的元素的。\n\n而且单链的形式都没有办法用es6和封装组件，没有成熟的生态圈。这种开发方式太痛苦了。\n\n","slug":"工作中所遇到的问题","published":1,"updated":"2021-02-27T12:24:38.489Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xe002il5v02kbj4oyo","content":"<p>记录一下自己在工作中所遇到的问题及及解决方案</p>\n<span id=\"more\"></span>\n\n<h2 id=\"本地开发-跨域-基础\"><a href=\"#本地开发-跨域-基础\" class=\"headerlink\" title=\"本地开发 跨域 (基础)\"></a>本地开发 跨域 (基础)</h2><p>在本地开发 请求线上的接口时 会遇到跨域的问题 那时如何解决的呢？</p>\n<ul>\n<li>  使用 <code>chrome</code> 浏览器的跨域设置 （适用与不使用 webpack 打包的项目）</li>\n<li>  webpack 配置 <code>proxyConfig</code>设置代理</li>\n<li>  使用 Nginx 等反向代理工具</li>\n<li>  使用 fiddler 等拦截转发工具</li>\n</ul>\n<h2 id=\"查找对象或者中是否有存在某个值\"><a href=\"#查找对象或者中是否有存在某个值\" class=\"headerlink\" title=\"查找对象或者中是否有存在某个值\"></a>查找对象或者中是否有存在某个值</h2><ol>\n<li><code>indexOf(1)</code>;<br>对于浅数组使用好用，对于复杂数组，数组嵌套对象再嵌套数组 且是动态取值比较的 用 indexOf 就难比较，因为 indexOf 计较的值一旦索引发生了改变就没有办法比较是否存在某一个对象了。这种情况 将数组进行 JSON.stringfy 后再 indexOf 就可以解决了</li>\n<li><code>arr.find()</code><br>数组实例的<code>find()</code>用于查找目标元素，查不到返回 <code>undefined</code></li>\n<li>对象中直接使用<code>array[kry]</code>调用，若没有则会返回<code>undefined</code>且不会报错。</li>\n</ol>\n<h2 id=\"用-jQuery-实现多品类购买的购物车\"><a href=\"#用-jQuery-实现多品类购买的购物车\" class=\"headerlink\" title=\"用 jQuery 实现多品类购买的购物车\"></a>用 jQuery 实现多品类购买的购物车</h2><ol>\n<li><p>在页面中能对单个物品进行加减并加入到购物车的操作，保证购物车物品的唯一，最新的特性，考虑到这个情况，是用一下思路解决的：</p>\n<ul>\n<li>在点击物品时将物品的单个信息对象保存下来，加减时操作信息对象</li>\n<li>点击加入购物车时，将信息对象的 id 拿出来当成对象的 key 值添加到对象中，利用对象 key 的唯一性，且能更好的进行覆盖和删除操作。</li>\n<li>在整个流程中利用数组对象的指针特性，改变其中的某一个值影响到原本的对象，保证了多个视图层的数据统一性。</li>\n</ul>\n</li>\n<li><p>考虑到页面中能进行筛选和搜索（都是从后台重新拿取的数据），重新渲染物品列表导致原本的购物数量的信息丢失。</p>\n<ul>\n<li>在从接口获取数组列表时，就比对原本的购物车列表，再进行刷新渲染</li>\n</ul>\n</li>\n<li><p>因为使用的 jquery,所以想封装一个组件，组件中 监听一个 click 事件 并且可以执行相应的回调， 当时用的事件委托 ，暂时还不知道怎么封装，类似于商品列表的加减器和购物车列表的加减器</p>\n</li>\n</ol>\n<h2 id=\"通过-script-单独引入-vue-js\"><a href=\"#通过-script-单独引入-vue-js\" class=\"headerlink\" title=\"通过 script 单独引入 vue.js\"></a>通过 script 单独引入 vue.js</h2><p>最开始接触 vue.js 时，最开始有两个使用途径，一个是 vue-cli 脚手架的单页应用，一个是通过 script 单链引入的形式。</p>\n<p>在使用单链的时候在进入首屏时，遇到过如下问题：</p>\n<ul>\n<li>  页面中会出现 vue 的未解析的符号，例如&#123;&#123;&#125;&#125;和初始样式。</li>\n<li>  当 js 判断再引入主题皮肤 css 时，会有很大一段时间是原始样式在突然过度到皮肤样式，不够美观，而且很奇怪</li>\n</ul>\n<p>当时没有想清楚，然后搁置之后就忘记了这个问题，如今又要负责这种单链的页面，又遭遇了一样的问题，才惊觉其原因：<br>首先我们将 vue.min.js 在 body 后面才引入的，把 vue.min.js 放在 head 中就可以解决了出现未解析的符号这个问题。是由于加载 html 之后还没有加载 js 对页面进行解析才出现了这个问题</p>\n<p>那未初始化的样式该如何解决呢？<br>在以前是通过操作 css 来解决的，</p>\n<ul>\n<li>  最开始默认样式是 display：none 通过 js 控制 class 而不是直接通过 v-show 操作。相当于 v-show v-if 全部不用。（好痛苦啊这种方案）。</li>\n<li>  还有一种是加 loading，在 creat 里面 loading 结束。</li>\n</ul>\n<p>v-show\\v-if 是无法操作 css 样式为 display：none 的元素的。</p>\n<p>而且单链的形式都没有办法用 es6 和封装组件，没有成熟的生态圈。这种开发方式太痛苦了，最可怕的是单链 vue+前后不分离。。。。我选择死亡。而且单链这种模式如何封装组件呢？这是个问题。</p>\n<h2 id=\"前端导出表格\"><a href=\"#前端导出表格\" class=\"headerlink\" title=\"前端导出表格\"></a>前端导出表格</h2><p>很早就做过导出表格的功能，也有考虑过前端是否能导出 excel 表格。现在看到了一个纯前端导出文件的插件——<code>SheetJS</code></p>\n<p>纯前端的实现方案能够在不依赖服务端能力和网络的情况下完成数据导出。虽然如此，数据量较大的时候，站在性能及用户体验的角度，在服务端完成会是更优雅的解法。</p>\n<h2 id=\"window-open-浏览器拦截\"><a href=\"#window-open-浏览器拦截\" class=\"headerlink\" title=\"window.open 浏览器拦截\"></a>window.open 浏览器拦截</h2><p>window.open 可以实现打开一个新浏览器窗口。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = $(<span class=\"string\">&quot;#btn&quot;</span>);</span><br><span class=\"line\">btn.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//不会被拦截</span></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.open(<span class=\"string\">&quot;http://www.baidu.com&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>如果是用户触发的时候，是不会拦截的，可以正常打开新窗口，所以，如果是用户主动触发弹窗，浏览器一般不会拦截。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = $(<span class=\"string\">&quot;#btn&quot;</span>);</span><br><span class=\"line\">btn.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    $.ajax(&#123;</span><br><span class=\"line\">        url: <span class=\"string\">&quot;ooxx&quot;</span>,</span><br><span class=\"line\">        success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//会被拦截</span></span><br><span class=\"line\">            <span class=\"built_in\">window</span>.open(url);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>如上用户没有直接触发 window.open,而是发出一个 ajax 请求，window.open 方法被放在了 ajax 的回调函数里，这样的情况是会被拦截的</p>\n<ul>\n<li>  当浏览器检测到非用户操作产生的新弹出窗口，则会对其进行阻止。因为浏览器认为这不是用户希望看到的页面</li>\n<li>  在 chrome 的安全机制里面，非用户触发的 window.open 方法，是会被拦截的。</li>\n</ul>\n<p>如何解决弹窗被拦截的问题，可以先打开一个不被拦截的空窗口，在异步请求后将 href 替换。如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = $(<span class=\"string\">&quot;#btn&quot;</span>);</span><br><span class=\"line\">btn.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//打开一个不被拦截的新窗口</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> newWindow = <span class=\"built_in\">window</span>.open();</span><br><span class=\"line\">    $.ajax(&#123;</span><br><span class=\"line\">        url: <span class=\"string\">&quot;ooxx&quot;</span>,</span><br><span class=\"line\">        success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//修改新窗口的url</span></span><br><span class=\"line\">            newWindow.location.href = url;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"银行卡号加空格\"><a href=\"#银行卡号加空格\" class=\"headerlink\" title=\"银行卡号加空格\"></a>银行卡号加空格</h2><p>给用户输入的银行卡号 每隔 4 位加一个空格，切只能输入数字</p>\n<h3 id=\"方案一\"><a href=\"#方案一\" class=\"headerlink\" title=\"方案一\"></a>方案一</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input</span><br><span class=\"line\">    type=&quot;text&quot;</span><br><span class=\"line\">    onkeypress=&quot;return (function(key,that)&#123;return (key&gt;47&amp;&amp;key&lt;58) &amp;&amp; ((that.value.length%5==0)?that.value+=&#x27; &#x27;:1)&#125;)(event.keyCode,this)&quot;</span><br><span class=\"line\">/&gt;</span><br></pre></td></tr></table></figure>\n\n<p>在 chrome 上输入数字的体验特别良好，输入中文时就会出现不触发 onKeypress 事件， 更重要的是无法兼容移动端，在华为浏览器上就死在第一步，所以就直接抛弃。</p>\n<h3 id=\"方案二\"><a href=\"#方案二\" class=\"headerlink\" title=\"方案二\"></a>方案二</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input</span><br><span class=\"line\">    type=<span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">    id=<span class=\"string\">&quot;bankId&quot;</span></span><br><span class=\"line\">    maxlength=<span class=\"string\">&quot;23&quot;</span></span><br><span class=\"line\">    placeholder=<span class=\"string\">&quot;请输入银行卡号&quot;</span></span><br><span class=\"line\">    oninput=<span class=\"string\">&quot;value=value.replace(/[^\\d\\s]/g,&#x27;&#x27;)&quot;</span></span><br><span class=\"line\">/&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\">input.on(<span class=\"string\">&quot;keyup&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    v = <span class=\"built_in\">this</span>.value;</span><br><span class=\"line\">    v = v.replace(<span class=\"regexp\">/\\s*/g</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"regexp\">/\\S&#123;5&#125;/</span>.test(v)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = v.replace(<span class=\"regexp\">/(\\d&#123;4&#125;)(?=\\d)/g</span>, <span class=\"string\">&quot;$1 &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>暂时没有发现什么 BUG,后记：是有BUG的，比如一直输入中文</p>\n<h3 id=\"方案三\"><a href=\"#方案三\" class=\"headerlink\" title=\"方案三\"></a>方案三</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input.on(<span class=\"string\">&quot;keyup&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = <span class=\"built_in\">this</span>.value;</span><br><span class=\"line\">    value = value.replace(<span class=\"regexp\">/\\s*/g</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; value.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i % <span class=\"number\">4</span> == <span class=\"number\">0</span> &amp;&amp; i != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            result.push(<span class=\"string\">&quot; &quot;</span> + value.charAt(i));</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result.push(value.charAt(i));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.value = result.join(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>暂时也没有发现什么 BUG</p>\n<h2 id=\"通过script-单独引入vue-js\"><a href=\"#通过script-单独引入vue-js\" class=\"headerlink\" title=\"通过script 单独引入vue.js\"></a>通过script 单独引入vue.js</h2><p>最开始接触vue.js时，最开始有两个使用途径，一个是vue-cli 脚手架的单页应用，一个是通过script 单链引入的形式。</p>\n<p>在使用单链的时候在进入首屏时，遇到过如下问题：</p>\n<ul>\n<li>页面中会出现vue 的未解析的符号，例如&#123;&#123;&#125;&#125;和初始样式。</li>\n<li>当js判断再引入主题皮肤css 时，会有很大一段时间是原始样式在突然过度到皮肤样式，不够美观，而且很奇怪</li>\n</ul>\n<p>当时没有想清楚，然后搁置之后就忘记了这个问题，如今又要负责这种单链的页面，又遭遇了一样的问题，才惊觉其原因：<br>首先我们将vue.min.js在body 后面才引入的，把vue.min.js放在head中就可以解决了出现未解析的符号这个问题。是由于加载html之后还没有加载js对页面进行解析才出现了这个问题</p>\n<p>那未初始化的样式该如何解决呢？<br>在以前是通过操作css 来解决的，</p>\n<ul>\n<li>最开始默认样式是display：none 通过js控制class 而不是直接通过v-show操作。相当于v-show v-if 全部不用。（好痛苦啊这种方案）。</li>\n<li>还有一种是加loading，在creat里面loading结束。</li>\n</ul>\n<p>v-show\\v-if 是无法操作css样式为display：none的元素的。</p>\n<p>而且单链的形式都没有办法用es6和封装组件，没有成熟的生态圈。这种开发方式太痛苦了。</p>\n","site":{"data":{}},"excerpt":"<p>记录一下自己在工作中所遇到的问题及及解决方案</p>","more":"<h2 id=\"本地开发-跨域-基础\"><a href=\"#本地开发-跨域-基础\" class=\"headerlink\" title=\"本地开发 跨域 (基础)\"></a>本地开发 跨域 (基础)</h2><p>在本地开发 请求线上的接口时 会遇到跨域的问题 那时如何解决的呢？</p>\n<ul>\n<li>  使用 <code>chrome</code> 浏览器的跨域设置 （适用与不使用 webpack 打包的项目）</li>\n<li>  webpack 配置 <code>proxyConfig</code>设置代理</li>\n<li>  使用 Nginx 等反向代理工具</li>\n<li>  使用 fiddler 等拦截转发工具</li>\n</ul>\n<h2 id=\"查找对象或者中是否有存在某个值\"><a href=\"#查找对象或者中是否有存在某个值\" class=\"headerlink\" title=\"查找对象或者中是否有存在某个值\"></a>查找对象或者中是否有存在某个值</h2><ol>\n<li><code>indexOf(1)</code>;<br>对于浅数组使用好用，对于复杂数组，数组嵌套对象再嵌套数组 且是动态取值比较的 用 indexOf 就难比较，因为 indexOf 计较的值一旦索引发生了改变就没有办法比较是否存在某一个对象了。这种情况 将数组进行 JSON.stringfy 后再 indexOf 就可以解决了</li>\n<li><code>arr.find()</code><br>数组实例的<code>find()</code>用于查找目标元素，查不到返回 <code>undefined</code></li>\n<li>对象中直接使用<code>array[kry]</code>调用，若没有则会返回<code>undefined</code>且不会报错。</li>\n</ol>\n<h2 id=\"用-jQuery-实现多品类购买的购物车\"><a href=\"#用-jQuery-实现多品类购买的购物车\" class=\"headerlink\" title=\"用 jQuery 实现多品类购买的购物车\"></a>用 jQuery 实现多品类购买的购物车</h2><ol>\n<li><p>在页面中能对单个物品进行加减并加入到购物车的操作，保证购物车物品的唯一，最新的特性，考虑到这个情况，是用一下思路解决的：</p>\n<ul>\n<li>在点击物品时将物品的单个信息对象保存下来，加减时操作信息对象</li>\n<li>点击加入购物车时，将信息对象的 id 拿出来当成对象的 key 值添加到对象中，利用对象 key 的唯一性，且能更好的进行覆盖和删除操作。</li>\n<li>在整个流程中利用数组对象的指针特性，改变其中的某一个值影响到原本的对象，保证了多个视图层的数据统一性。</li>\n</ul>\n</li>\n<li><p>考虑到页面中能进行筛选和搜索（都是从后台重新拿取的数据），重新渲染物品列表导致原本的购物数量的信息丢失。</p>\n<ul>\n<li>在从接口获取数组列表时，就比对原本的购物车列表，再进行刷新渲染</li>\n</ul>\n</li>\n<li><p>因为使用的 jquery,所以想封装一个组件，组件中 监听一个 click 事件 并且可以执行相应的回调， 当时用的事件委托 ，暂时还不知道怎么封装，类似于商品列表的加减器和购物车列表的加减器</p>\n</li>\n</ol>\n<h2 id=\"通过-script-单独引入-vue-js\"><a href=\"#通过-script-单独引入-vue-js\" class=\"headerlink\" title=\"通过 script 单独引入 vue.js\"></a>通过 script 单独引入 vue.js</h2><p>最开始接触 vue.js 时，最开始有两个使用途径，一个是 vue-cli 脚手架的单页应用，一个是通过 script 单链引入的形式。</p>\n<p>在使用单链的时候在进入首屏时，遇到过如下问题：</p>\n<ul>\n<li>  页面中会出现 vue 的未解析的符号，例如&#123;&#123;&#125;&#125;和初始样式。</li>\n<li>  当 js 判断再引入主题皮肤 css 时，会有很大一段时间是原始样式在突然过度到皮肤样式，不够美观，而且很奇怪</li>\n</ul>\n<p>当时没有想清楚，然后搁置之后就忘记了这个问题，如今又要负责这种单链的页面，又遭遇了一样的问题，才惊觉其原因：<br>首先我们将 vue.min.js 在 body 后面才引入的，把 vue.min.js 放在 head 中就可以解决了出现未解析的符号这个问题。是由于加载 html 之后还没有加载 js 对页面进行解析才出现了这个问题</p>\n<p>那未初始化的样式该如何解决呢？<br>在以前是通过操作 css 来解决的，</p>\n<ul>\n<li>  最开始默认样式是 display：none 通过 js 控制 class 而不是直接通过 v-show 操作。相当于 v-show v-if 全部不用。（好痛苦啊这种方案）。</li>\n<li>  还有一种是加 loading，在 creat 里面 loading 结束。</li>\n</ul>\n<p>v-show\\v-if 是无法操作 css 样式为 display：none 的元素的。</p>\n<p>而且单链的形式都没有办法用 es6 和封装组件，没有成熟的生态圈。这种开发方式太痛苦了，最可怕的是单链 vue+前后不分离。。。。我选择死亡。而且单链这种模式如何封装组件呢？这是个问题。</p>\n<h2 id=\"前端导出表格\"><a href=\"#前端导出表格\" class=\"headerlink\" title=\"前端导出表格\"></a>前端导出表格</h2><p>很早就做过导出表格的功能，也有考虑过前端是否能导出 excel 表格。现在看到了一个纯前端导出文件的插件——<code>SheetJS</code></p>\n<p>纯前端的实现方案能够在不依赖服务端能力和网络的情况下完成数据导出。虽然如此，数据量较大的时候，站在性能及用户体验的角度，在服务端完成会是更优雅的解法。</p>\n<h2 id=\"window-open-浏览器拦截\"><a href=\"#window-open-浏览器拦截\" class=\"headerlink\" title=\"window.open 浏览器拦截\"></a>window.open 浏览器拦截</h2><p>window.open 可以实现打开一个新浏览器窗口。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = $(<span class=\"string\">&quot;#btn&quot;</span>);</span><br><span class=\"line\">btn.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//不会被拦截</span></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.open(<span class=\"string\">&quot;http://www.baidu.com&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>如果是用户触发的时候，是不会拦截的，可以正常打开新窗口，所以，如果是用户主动触发弹窗，浏览器一般不会拦截。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = $(<span class=\"string\">&quot;#btn&quot;</span>);</span><br><span class=\"line\">btn.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    $.ajax(&#123;</span><br><span class=\"line\">        url: <span class=\"string\">&quot;ooxx&quot;</span>,</span><br><span class=\"line\">        success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//会被拦截</span></span><br><span class=\"line\">            <span class=\"built_in\">window</span>.open(url);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>如上用户没有直接触发 window.open,而是发出一个 ajax 请求，window.open 方法被放在了 ajax 的回调函数里，这样的情况是会被拦截的</p>\n<ul>\n<li>  当浏览器检测到非用户操作产生的新弹出窗口，则会对其进行阻止。因为浏览器认为这不是用户希望看到的页面</li>\n<li>  在 chrome 的安全机制里面，非用户触发的 window.open 方法，是会被拦截的。</li>\n</ul>\n<p>如何解决弹窗被拦截的问题，可以先打开一个不被拦截的空窗口，在异步请求后将 href 替换。如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> btn = $(<span class=\"string\">&quot;#btn&quot;</span>);</span><br><span class=\"line\">btn.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//打开一个不被拦截的新窗口</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> newWindow = <span class=\"built_in\">window</span>.open();</span><br><span class=\"line\">    $.ajax(&#123;</span><br><span class=\"line\">        url: <span class=\"string\">&quot;ooxx&quot;</span>,</span><br><span class=\"line\">        success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//修改新窗口的url</span></span><br><span class=\"line\">            newWindow.location.href = url;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"银行卡号加空格\"><a href=\"#银行卡号加空格\" class=\"headerlink\" title=\"银行卡号加空格\"></a>银行卡号加空格</h2><p>给用户输入的银行卡号 每隔 4 位加一个空格，切只能输入数字</p>\n<h3 id=\"方案一\"><a href=\"#方案一\" class=\"headerlink\" title=\"方案一\"></a>方案一</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input</span><br><span class=\"line\">    type=&quot;text&quot;</span><br><span class=\"line\">    onkeypress=&quot;return (function(key,that)&#123;return (key&gt;47&amp;&amp;key&lt;58) &amp;&amp; ((that.value.length%5==0)?that.value+=&#x27; &#x27;:1)&#125;)(event.keyCode,this)&quot;</span><br><span class=\"line\">/&gt;</span><br></pre></td></tr></table></figure>\n\n<p>在 chrome 上输入数字的体验特别良好，输入中文时就会出现不触发 onKeypress 事件， 更重要的是无法兼容移动端，在华为浏览器上就死在第一步，所以就直接抛弃。</p>\n<h3 id=\"方案二\"><a href=\"#方案二\" class=\"headerlink\" title=\"方案二\"></a>方案二</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input</span><br><span class=\"line\">    type=<span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">    id=<span class=\"string\">&quot;bankId&quot;</span></span><br><span class=\"line\">    maxlength=<span class=\"string\">&quot;23&quot;</span></span><br><span class=\"line\">    placeholder=<span class=\"string\">&quot;请输入银行卡号&quot;</span></span><br><span class=\"line\">    oninput=<span class=\"string\">&quot;value=value.replace(/[^\\d\\s]/g,&#x27;&#x27;)&quot;</span></span><br><span class=\"line\">/&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\">input.on(<span class=\"string\">&quot;keyup&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    v = <span class=\"built_in\">this</span>.value;</span><br><span class=\"line\">    v = v.replace(<span class=\"regexp\">/\\s*/g</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"regexp\">/\\S&#123;5&#125;/</span>.test(v)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = v.replace(<span class=\"regexp\">/(\\d&#123;4&#125;)(?=\\d)/g</span>, <span class=\"string\">&quot;$1 &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>暂时没有发现什么 BUG,后记：是有BUG的，比如一直输入中文</p>\n<h3 id=\"方案三\"><a href=\"#方案三\" class=\"headerlink\" title=\"方案三\"></a>方案三</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input.on(<span class=\"string\">&quot;keyup&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = <span class=\"built_in\">this</span>.value;</span><br><span class=\"line\">    value = value.replace(<span class=\"regexp\">/\\s*/g</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; value.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i % <span class=\"number\">4</span> == <span class=\"number\">0</span> &amp;&amp; i != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            result.push(<span class=\"string\">&quot; &quot;</span> + value.charAt(i));</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result.push(value.charAt(i));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.value = result.join(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>暂时也没有发现什么 BUG</p>\n<h2 id=\"通过script-单独引入vue-js\"><a href=\"#通过script-单独引入vue-js\" class=\"headerlink\" title=\"通过script 单独引入vue.js\"></a>通过script 单独引入vue.js</h2><p>最开始接触vue.js时，最开始有两个使用途径，一个是vue-cli 脚手架的单页应用，一个是通过script 单链引入的形式。</p>\n<p>在使用单链的时候在进入首屏时，遇到过如下问题：</p>\n<ul>\n<li>页面中会出现vue 的未解析的符号，例如&#123;&#123;&#125;&#125;和初始样式。</li>\n<li>当js判断再引入主题皮肤css 时，会有很大一段时间是原始样式在突然过度到皮肤样式，不够美观，而且很奇怪</li>\n</ul>\n<p>当时没有想清楚，然后搁置之后就忘记了这个问题，如今又要负责这种单链的页面，又遭遇了一样的问题，才惊觉其原因：<br>首先我们将vue.min.js在body 后面才引入的，把vue.min.js放在head中就可以解决了出现未解析的符号这个问题。是由于加载html之后还没有加载js对页面进行解析才出现了这个问题</p>\n<p>那未初始化的样式该如何解决呢？<br>在以前是通过操作css 来解决的，</p>\n<ul>\n<li>最开始默认样式是display：none 通过js控制class 而不是直接通过v-show操作。相当于v-show v-if 全部不用。（好痛苦啊这种方案）。</li>\n<li>还有一种是加loading，在creat里面loading结束。</li>\n</ul>\n<p>v-show\\v-if 是无法操作css样式为display：none的元素的。</p>\n<p>而且单链的形式都没有办法用es6和封装组件，没有成熟的生态圈。这种开发方式太痛苦了。</p>"},{"title":"常见的四种post方式","date":"2019-07-16T02:21:57.000Z","_content":"自己常常在开发过程中被后台研发要求的数据格式搞的十分混乱，常常觉得自己记错了，常常不确定怎么设置header。所以现在进行一个彻底的总结。\n\n<!--more-->\n\n\n# 常见的四种post方式\n\n1. application/x-www-form-urlencoded\n2. multipart/form-data\n3. text-plain\n4. application/json\n\n## 一个form标签中的enctype有三种类型\n\n1. application/x-www-form-urlencoded\n2. multipart/form-data\n3. text-plain\n\nenctype 属性规定在发送到服务器之前应该如何对表单数据进行编码，默认的情况下是 application/x-www-urlencoded,就是说，在发送到服务器之前，所有的字符都会进行编码。当表单使用POST请求时，数据会被以x-www-urlencoded，当表单使用POST请求时，数据会被以x-www-urlencoede方式编码到Body中来传送。\n\n而如果是get请求，则是附在url链接后面来传送。\n\nget请求只支持ASCLL字符集，因此，如果我们要发送更大字符集的内容，我们应使用POST请求。\n\n## 注意\n\n如果要发送大量的二进制数据（non-ASCLL）,\"application/x-www-form-urlencoded\"是最低效的，因为它需要用3个字符来表示一个non-ASCLL的字符。因此这时就要使用\"multipart/form-data\"。\n\n## application/x-www-form-urlencoded\n**在发送前编码所有字符**\n\n在通过HTTP向服务器发送POST请求数据，都是通过form表单形式提交的，代码如下：\n\n```html\n<form method=\"post\" action=\"http://w.sohu.com\">\n    <input type =\"text\" name=\"text1\">\n    <input type=\"text\" name=\"text2\">\n</form>\n```\n提交数据时会向服务器端发出这样的数据\n\n```\nPOST / HTTP/1.1\nContent-Type:application/x-www-form-urlencoded\nAccept-Encoding: gzip, deflate\nHost: w.sohu.com\nContent-Length: 21\nConnection: Keep-Alive\nCache-Control: no-cache\n\ntxt1=hello&txt2=world\n\n```\n\n对于普通的HTML Form POST 请求，它会在头信息里使用Content-Length 注明长度。\n请求头信息每行一条，空行之后便是Body,即内容。内容格式是在头信息中的Content-Type，如上是application/x-www-form-urlencoded。这也意味着消息内容会经过URL格式编码，就像是GET请求时URL中的QueryString。`text1=hello&text2=world`\n\n## multipart/form-data\n**不对字符编码，在使用包含文件上传的表单时，必须使用该值**\n\n通过form 表单提交文件操作如下：\n```html\n<FORM method=\"POST\" action=\"http://w.sohu.com/t2/upload.do\" enctype=\"multipart/form-data\">\n    <INPUT type=\"text\" name=\"city\" value=\"Santa colo\">\n    <INPUT type=\"text\" name=\"desc\">\n    <INPUT type=\"file\" name=\"pic\">\n</FORM>\n```\n浏览器将会发送以下数据：\n\n```\nPOST /t2/upload.do HTTP/1.1\nUser-Agent: SOHUWapRebot\nAccept-Language: zh-cn,zh;q=0.5\nAccept-Charset: GBK,utf-8;q=0.7,*;q=0.7\nConnection: keep-alive\nContent-Length: 60408\nContent-Type:multipart/form-data; boundary=ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC\nHost: w.sohu.com\n\n--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC\nContent-Disposition: form-data; name=\"city\"\n\nSanta colo\n--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC\nContent-Disposition: form-data;name=\"desc\"\nContent-Type: text/plain; charset=UTF-8\nContent-Transfer-Encoding: 8bit\n \n...\n--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC\nContent-Disposition: form-data;name=\"pic\"; filename=\"photo.jpg\"\nContent-Type: application/octet-stream\nContent-Transfer-Encoding: binary\n \n... binary data of the jpg ...\n--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC--\n```\n\n从上面的 multipart/form-data 格式发送的请求来看，他包含了多个parts，每个part都包含头部信息部分，part头信息中必须包含一个Content-disposition 头，其他的头信息则为可选项，比如：Content-Type 等。\n\n## text/plain\n\n**空格转换为“+”加号，但不对特殊字符编码\n```javascript\n<form action=\"/example/html/form_action.asp\" method=\"get\" enctype=\"text/plain\">\n  First name: <input type=\"text\" name=\"fname\" /><br />\n  Last name: <input type=\"text\" name=\"lname\" /><br />\n  <input type=\"submit\" value=\"Submit\" />\n</form>\n```\n\n## application/json\n最终发送的请求是：\n```\nBASHPOST http://www.example.com HTTP/1.1 \nContent-Type: application/json;charset=utf-8\n\n{\"title\":\"test\",\"sub\":[1,2,3]}\n```\n\n## Boundary 分隔符\n\n每个部分使用 --boundary 分割开来，最后一行使用--boundary--结尾\n\n\n\n# ajax 解读\n\n```javascript\n\nvar xhr = new XMLHTTPRequest();\n\nxhr.open(\"method\", \"url\", \"async\");\n\nxhr.send(null);\n\nxhr.onreadystatechange = function(){\n\n    if(xhr.readystate == 4){\n\n　　　if(xhr.status == 200){\n\n　　　　　console.log(xhr.responseText)\n\n　　　}\n\n　　}\n}\n```\n\n- XMLHTTPRequest对象\n- 常用方法：\n    - `open(\"method\",'url','async')`\n        - method 表示通过什么方式进行服务器访问，包括post和get\n        - url 表示访问服务器的地址\n        - async 表示是否异步，包括true(异步)和false\n    - `send(content)`\n        - content 表示向服务器发送的数据。\n\n\n## 原生 JS 的封装\n\n```javascript\n\n//可以以下步骤代替上面的open、setRequestHeader、send三行，此处对GET和POST做了很好的区分\nfunction ajax(){ \n  var ajaxData = { \n    type: (arguments[0].type || \"GET\").toUpperCase(), \n    url: arguments[0].url || \"\", \n    async: arguments[0].async || \"true\", \n    data: arguments[0].data || null, \n    dataType: arguments[0].dataType || \"json\", \n    contentType: arguments[0].contentType || \"application/x-www-form-urlencoded; charset=utf-8\", \n    beforeSend: arguments[0].beforeSend || function(){}, \n    success: arguments[0].success || function(){}, \n    error: arguments[0].error || function(){} \n  } \n\n  ajaxData.beforeSend() \n  var xhr = createxmlHttpRequest();  \n  xhr.responseType=ajaxData.dataType; \n\n  xhr.open(ajaxData.type,ajaxData.url,ajaxData.async);  \n  xhr.setRequestHeader(\"Content-Type\",ajaxData.contentType);  \n  xhr.send(convertData(ajaxData.data));  \n\n  xhr.onreadystatechange = function() {  \n    if (xhr.readyState == 4) {  \n      if(xhr.status == 200){ \n        ajaxData.success(xhr.response) \n      }else{ \n        ajaxData.error() \n      }  \n    } \n  }  \n} \n\nfunction createxmlHttpRequest() {  \n  if (window.ActiveXObject) {  \n    return new ActiveXObject(\"Microsoft.XMLHTTP\");  \n  } else if (window.XMLHttpRequest) {  \n    return new XMLHttpRequest();  \n  }  \n} \n  \nfunction convertData(data){ \n  if( typeof data === 'object' ){ \n    var convertResult = \"\" ;  \n    for(var c in data){  \n      convertResult+= c + \"=\" + data[c] + \"&\";  \n    }  \n    convertResult=convertResult.substring(0,convertResult.length-1) \n    return convertResult; \n  }else{ \n    return data; \n  } \n}\n\najax({ \n  type:\"POST\", \n  url:\"ajax.php\", \n  dataType:\"json\", \n  data:{\n    \"name\":\"abc\",\n    \"age\":123,\n    \"id\":\"456\"\n　}, \n  beforeSend:function(){ \n    //some js code \n  }, \n  success:function(msg){ \n    console.log(msg) \n  }, \n  error:function(){ \n    console.log(\"error\") \n  } \n})\n```","source":"_posts/常见的四种post方式.md","raw":"---\ntitle: 常见的四种post方式\ndate: 2019-07-16 10:21:57\ncategories: Web\n---\n自己常常在开发过程中被后台研发要求的数据格式搞的十分混乱，常常觉得自己记错了，常常不确定怎么设置header。所以现在进行一个彻底的总结。\n\n<!--more-->\n\n\n# 常见的四种post方式\n\n1. application/x-www-form-urlencoded\n2. multipart/form-data\n3. text-plain\n4. application/json\n\n## 一个form标签中的enctype有三种类型\n\n1. application/x-www-form-urlencoded\n2. multipart/form-data\n3. text-plain\n\nenctype 属性规定在发送到服务器之前应该如何对表单数据进行编码，默认的情况下是 application/x-www-urlencoded,就是说，在发送到服务器之前，所有的字符都会进行编码。当表单使用POST请求时，数据会被以x-www-urlencoded，当表单使用POST请求时，数据会被以x-www-urlencoede方式编码到Body中来传送。\n\n而如果是get请求，则是附在url链接后面来传送。\n\nget请求只支持ASCLL字符集，因此，如果我们要发送更大字符集的内容，我们应使用POST请求。\n\n## 注意\n\n如果要发送大量的二进制数据（non-ASCLL）,\"application/x-www-form-urlencoded\"是最低效的，因为它需要用3个字符来表示一个non-ASCLL的字符。因此这时就要使用\"multipart/form-data\"。\n\n## application/x-www-form-urlencoded\n**在发送前编码所有字符**\n\n在通过HTTP向服务器发送POST请求数据，都是通过form表单形式提交的，代码如下：\n\n```html\n<form method=\"post\" action=\"http://w.sohu.com\">\n    <input type =\"text\" name=\"text1\">\n    <input type=\"text\" name=\"text2\">\n</form>\n```\n提交数据时会向服务器端发出这样的数据\n\n```\nPOST / HTTP/1.1\nContent-Type:application/x-www-form-urlencoded\nAccept-Encoding: gzip, deflate\nHost: w.sohu.com\nContent-Length: 21\nConnection: Keep-Alive\nCache-Control: no-cache\n\ntxt1=hello&txt2=world\n\n```\n\n对于普通的HTML Form POST 请求，它会在头信息里使用Content-Length 注明长度。\n请求头信息每行一条，空行之后便是Body,即内容。内容格式是在头信息中的Content-Type，如上是application/x-www-form-urlencoded。这也意味着消息内容会经过URL格式编码，就像是GET请求时URL中的QueryString。`text1=hello&text2=world`\n\n## multipart/form-data\n**不对字符编码，在使用包含文件上传的表单时，必须使用该值**\n\n通过form 表单提交文件操作如下：\n```html\n<FORM method=\"POST\" action=\"http://w.sohu.com/t2/upload.do\" enctype=\"multipart/form-data\">\n    <INPUT type=\"text\" name=\"city\" value=\"Santa colo\">\n    <INPUT type=\"text\" name=\"desc\">\n    <INPUT type=\"file\" name=\"pic\">\n</FORM>\n```\n浏览器将会发送以下数据：\n\n```\nPOST /t2/upload.do HTTP/1.1\nUser-Agent: SOHUWapRebot\nAccept-Language: zh-cn,zh;q=0.5\nAccept-Charset: GBK,utf-8;q=0.7,*;q=0.7\nConnection: keep-alive\nContent-Length: 60408\nContent-Type:multipart/form-data; boundary=ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC\nHost: w.sohu.com\n\n--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC\nContent-Disposition: form-data; name=\"city\"\n\nSanta colo\n--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC\nContent-Disposition: form-data;name=\"desc\"\nContent-Type: text/plain; charset=UTF-8\nContent-Transfer-Encoding: 8bit\n \n...\n--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC\nContent-Disposition: form-data;name=\"pic\"; filename=\"photo.jpg\"\nContent-Type: application/octet-stream\nContent-Transfer-Encoding: binary\n \n... binary data of the jpg ...\n--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC--\n```\n\n从上面的 multipart/form-data 格式发送的请求来看，他包含了多个parts，每个part都包含头部信息部分，part头信息中必须包含一个Content-disposition 头，其他的头信息则为可选项，比如：Content-Type 等。\n\n## text/plain\n\n**空格转换为“+”加号，但不对特殊字符编码\n```javascript\n<form action=\"/example/html/form_action.asp\" method=\"get\" enctype=\"text/plain\">\n  First name: <input type=\"text\" name=\"fname\" /><br />\n  Last name: <input type=\"text\" name=\"lname\" /><br />\n  <input type=\"submit\" value=\"Submit\" />\n</form>\n```\n\n## application/json\n最终发送的请求是：\n```\nBASHPOST http://www.example.com HTTP/1.1 \nContent-Type: application/json;charset=utf-8\n\n{\"title\":\"test\",\"sub\":[1,2,3]}\n```\n\n## Boundary 分隔符\n\n每个部分使用 --boundary 分割开来，最后一行使用--boundary--结尾\n\n\n\n# ajax 解读\n\n```javascript\n\nvar xhr = new XMLHTTPRequest();\n\nxhr.open(\"method\", \"url\", \"async\");\n\nxhr.send(null);\n\nxhr.onreadystatechange = function(){\n\n    if(xhr.readystate == 4){\n\n　　　if(xhr.status == 200){\n\n　　　　　console.log(xhr.responseText)\n\n　　　}\n\n　　}\n}\n```\n\n- XMLHTTPRequest对象\n- 常用方法：\n    - `open(\"method\",'url','async')`\n        - method 表示通过什么方式进行服务器访问，包括post和get\n        - url 表示访问服务器的地址\n        - async 表示是否异步，包括true(异步)和false\n    - `send(content)`\n        - content 表示向服务器发送的数据。\n\n\n## 原生 JS 的封装\n\n```javascript\n\n//可以以下步骤代替上面的open、setRequestHeader、send三行，此处对GET和POST做了很好的区分\nfunction ajax(){ \n  var ajaxData = { \n    type: (arguments[0].type || \"GET\").toUpperCase(), \n    url: arguments[0].url || \"\", \n    async: arguments[0].async || \"true\", \n    data: arguments[0].data || null, \n    dataType: arguments[0].dataType || \"json\", \n    contentType: arguments[0].contentType || \"application/x-www-form-urlencoded; charset=utf-8\", \n    beforeSend: arguments[0].beforeSend || function(){}, \n    success: arguments[0].success || function(){}, \n    error: arguments[0].error || function(){} \n  } \n\n  ajaxData.beforeSend() \n  var xhr = createxmlHttpRequest();  \n  xhr.responseType=ajaxData.dataType; \n\n  xhr.open(ajaxData.type,ajaxData.url,ajaxData.async);  \n  xhr.setRequestHeader(\"Content-Type\",ajaxData.contentType);  \n  xhr.send(convertData(ajaxData.data));  \n\n  xhr.onreadystatechange = function() {  \n    if (xhr.readyState == 4) {  \n      if(xhr.status == 200){ \n        ajaxData.success(xhr.response) \n      }else{ \n        ajaxData.error() \n      }  \n    } \n  }  \n} \n\nfunction createxmlHttpRequest() {  \n  if (window.ActiveXObject) {  \n    return new ActiveXObject(\"Microsoft.XMLHTTP\");  \n  } else if (window.XMLHttpRequest) {  \n    return new XMLHttpRequest();  \n  }  \n} \n  \nfunction convertData(data){ \n  if( typeof data === 'object' ){ \n    var convertResult = \"\" ;  \n    for(var c in data){  \n      convertResult+= c + \"=\" + data[c] + \"&\";  \n    }  \n    convertResult=convertResult.substring(0,convertResult.length-1) \n    return convertResult; \n  }else{ \n    return data; \n  } \n}\n\najax({ \n  type:\"POST\", \n  url:\"ajax.php\", \n  dataType:\"json\", \n  data:{\n    \"name\":\"abc\",\n    \"age\":123,\n    \"id\":\"456\"\n　}, \n  beforeSend:function(){ \n    //some js code \n  }, \n  success:function(msg){ \n    console.log(msg) \n  }, \n  error:function(){ \n    console.log(\"error\") \n  } \n})\n```","slug":"常见的四种post方式","published":1,"updated":"2021-04-03T03:30:49.129Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xe002kl5v03kto599g","content":"<p>自己常常在开发过程中被后台研发要求的数据格式搞的十分混乱，常常觉得自己记错了，常常不确定怎么设置header。所以现在进行一个彻底的总结。</p>\n<span id=\"more\"></span>\n\n\n<h1 id=\"常见的四种post方式\"><a href=\"#常见的四种post方式\" class=\"headerlink\" title=\"常见的四种post方式\"></a>常见的四种post方式</h1><ol>\n<li>application/x-www-form-urlencoded</li>\n<li>multipart/form-data</li>\n<li>text-plain</li>\n<li>application/json</li>\n</ol>\n<h2 id=\"一个form标签中的enctype有三种类型\"><a href=\"#一个form标签中的enctype有三种类型\" class=\"headerlink\" title=\"一个form标签中的enctype有三种类型\"></a>一个form标签中的enctype有三种类型</h2><ol>\n<li>application/x-www-form-urlencoded</li>\n<li>multipart/form-data</li>\n<li>text-plain</li>\n</ol>\n<p>enctype 属性规定在发送到服务器之前应该如何对表单数据进行编码，默认的情况下是 application/x-www-urlencoded,就是说，在发送到服务器之前，所有的字符都会进行编码。当表单使用POST请求时，数据会被以x-www-urlencoded，当表单使用POST请求时，数据会被以x-www-urlencoede方式编码到Body中来传送。</p>\n<p>而如果是get请求，则是附在url链接后面来传送。</p>\n<p>get请求只支持ASCLL字符集，因此，如果我们要发送更大字符集的内容，我们应使用POST请求。</p>\n<h2 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p>如果要发送大量的二进制数据（non-ASCLL）,”application/x-www-form-urlencoded”是最低效的，因为它需要用3个字符来表示一个non-ASCLL的字符。因此这时就要使用”multipart/form-data”。</p>\n<h2 id=\"application-x-www-form-urlencoded\"><a href=\"#application-x-www-form-urlencoded\" class=\"headerlink\" title=\"application/x-www-form-urlencoded\"></a>application/x-www-form-urlencoded</h2><p><strong>在发送前编码所有字符</strong></p>\n<p>在通过HTTP向服务器发送POST请求数据，都是通过form表单形式提交的，代码如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;http://w.sohu.com&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span> =<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;text1&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;text2&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>提交数据时会向服务器端发出这样的数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F; HTTP&#x2F;1.1</span><br><span class=\"line\">Content-Type:application&#x2F;x-www-form-urlencoded</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Host: w.sohu.com</span><br><span class=\"line\">Content-Length: 21</span><br><span class=\"line\">Connection: Keep-Alive</span><br><span class=\"line\">Cache-Control: no-cache</span><br><span class=\"line\"></span><br><span class=\"line\">txt1&#x3D;hello&amp;txt2&#x3D;world</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>对于普通的HTML Form POST 请求，它会在头信息里使用Content-Length 注明长度。<br>请求头信息每行一条，空行之后便是Body,即内容。内容格式是在头信息中的Content-Type，如上是application/x-www-form-urlencoded。这也意味着消息内容会经过URL格式编码，就像是GET请求时URL中的QueryString。<code>text1=hello&amp;text2=world</code></p>\n<h2 id=\"multipart-form-data\"><a href=\"#multipart-form-data\" class=\"headerlink\" title=\"multipart/form-data\"></a>multipart/form-data</h2><p><strong>不对字符编码，在使用包含文件上传的表单时，必须使用该值</strong></p>\n<p>通过form 表单提交文件操作如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">FORM</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;POST&quot;</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;http://w.sohu.com/t2/upload.do&quot;</span> <span class=\"attr\">enctype</span>=<span class=\"string\">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">INPUT</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;city&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Santa colo&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">INPUT</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;desc&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">INPUT</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;pic&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">FORM</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>浏览器将会发送以下数据：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F;t2&#x2F;upload.do HTTP&#x2F;1.1</span><br><span class=\"line\">User-Agent: SOHUWapRebot</span><br><span class=\"line\">Accept-Language: zh-cn,zh;q&#x3D;0.5</span><br><span class=\"line\">Accept-Charset: GBK,utf-8;q&#x3D;0.7,*;q&#x3D;0.7</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">Content-Length: 60408</span><br><span class=\"line\">Content-Type:multipart&#x2F;form-data; boundary&#x3D;ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class=\"line\">Host: w.sohu.com</span><br><span class=\"line\"></span><br><span class=\"line\">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class=\"line\">Content-Disposition: form-data; name&#x3D;&quot;city&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Santa colo</span><br><span class=\"line\">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class=\"line\">Content-Disposition: form-data;name&#x3D;&quot;desc&quot;</span><br><span class=\"line\">Content-Type: text&#x2F;plain; charset&#x3D;UTF-8</span><br><span class=\"line\">Content-Transfer-Encoding: 8bit</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class=\"line\">Content-Disposition: form-data;name&#x3D;&quot;pic&quot;; filename&#x3D;&quot;photo.jpg&quot;</span><br><span class=\"line\">Content-Type: application&#x2F;octet-stream</span><br><span class=\"line\">Content-Transfer-Encoding: binary</span><br><span class=\"line\"> </span><br><span class=\"line\">... binary data of the jpg ...</span><br><span class=\"line\">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC--</span><br></pre></td></tr></table></figure>\n\n<p>从上面的 multipart/form-data 格式发送的请求来看，他包含了多个parts，每个part都包含头部信息部分，part头信息中必须包含一个Content-disposition 头，其他的头信息则为可选项，比如：Content-Type 等。</p>\n<h2 id=\"text-plain\"><a href=\"#text-plain\" class=\"headerlink\" title=\"text/plain\"></a>text/plain</h2><p>**空格转换为“+”加号，但不对特殊字符编码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;form action=<span class=\"string\">&quot;/example/html/form_action.asp&quot;</span> method=<span class=\"string\">&quot;get&quot;</span> enctype=<span class=\"string\">&quot;text/plain&quot;</span>&gt;</span><br><span class=\"line\">  First name: <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;fname&quot;</span> /&gt;</span></span><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span></span></span><br><span class=\"line\">  Last name: <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;lname&quot;</span> /&gt;</span></span><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span></span></span><br><span class=\"line\">  &lt;input type=<span class=\"string\">&quot;submit&quot;</span> value=<span class=\"string\">&quot;Submit&quot;</span> /&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"application-json\"><a href=\"#application-json\" class=\"headerlink\" title=\"application/json\"></a>application/json</h2><p>最终发送的请求是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BASHPOST http:&#x2F;&#x2F;www.example.com HTTP&#x2F;1.1 </span><br><span class=\"line\">Content-Type: application&#x2F;json;charset&#x3D;utf-8</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;title&quot;:&quot;test&quot;,&quot;sub&quot;:[1,2,3]&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Boundary-分隔符\"><a href=\"#Boundary-分隔符\" class=\"headerlink\" title=\"Boundary 分隔符\"></a>Boundary 分隔符</h2><p>每个部分使用 –boundary 分割开来，最后一行使用–boundary–结尾</p>\n<h1 id=\"ajax-解读\"><a href=\"#ajax-解读\" class=\"headerlink\" title=\"ajax 解读\"></a>ajax 解读</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHTTPRequest();</span><br><span class=\"line\"></span><br><span class=\"line\">xhr.open(<span class=\"string\">&quot;method&quot;</span>, <span class=\"string\">&quot;url&quot;</span>, <span class=\"string\">&quot;async&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">xhr.send(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(xhr.readystate == <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">　　　<span class=\"keyword\">if</span>(xhr.status == <span class=\"number\">200</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">　　　　　<span class=\"built_in\">console</span>.log(xhr.responseText)</span><br><span class=\"line\"></span><br><span class=\"line\">　　　&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">　　&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>XMLHTTPRequest对象</li>\n<li>常用方法：<ul>\n<li><code>open(&quot;method&quot;,&#39;url&#39;,&#39;async&#39;)</code><ul>\n<li>method 表示通过什么方式进行服务器访问，包括post和get</li>\n<li>url 表示访问服务器的地址</li>\n<li>async 表示是否异步，包括true(异步)和false</li>\n</ul>\n</li>\n<li><code>send(content)</code><ul>\n<li>content 表示向服务器发送的数据。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"原生-JS-的封装\"><a href=\"#原生-JS-的封装\" class=\"headerlink\" title=\"原生 JS 的封装\"></a>原生 JS 的封装</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//可以以下步骤代替上面的open、setRequestHeader、send三行，此处对GET和POST做了很好的区分</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ajax</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> ajaxData = &#123; </span><br><span class=\"line\">    type: (<span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].type || <span class=\"string\">&quot;GET&quot;</span>).toUpperCase(), </span><br><span class=\"line\">    url: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].url || <span class=\"string\">&quot;&quot;</span>, </span><br><span class=\"line\">    <span class=\"keyword\">async</span>: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].async || <span class=\"string\">&quot;true&quot;</span>, </span><br><span class=\"line\">    data: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].data || <span class=\"literal\">null</span>, </span><br><span class=\"line\">    dataType: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].dataType || <span class=\"string\">&quot;json&quot;</span>, </span><br><span class=\"line\">    contentType: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].contentType || <span class=\"string\">&quot;application/x-www-form-urlencoded; charset=utf-8&quot;</span>, </span><br><span class=\"line\">    beforeSend: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].beforeSend || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;, </span><br><span class=\"line\">    success: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].success || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;, </span><br><span class=\"line\">    error: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].error || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125; </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">  ajaxData.beforeSend() </span><br><span class=\"line\">  <span class=\"keyword\">var</span> xhr = createxmlHttpRequest();  </span><br><span class=\"line\">  xhr.responseType=ajaxData.dataType; </span><br><span class=\"line\"></span><br><span class=\"line\">  xhr.open(ajaxData.type,ajaxData.url,ajaxData.async);  </span><br><span class=\"line\">  xhr.setRequestHeader(<span class=\"string\">&quot;Content-Type&quot;</span>,ajaxData.contentType);  </span><br><span class=\"line\">  xhr.send(convertData(ajaxData.data));  </span><br><span class=\"line\"></span><br><span class=\"line\">  xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (xhr.readyState == <span class=\"number\">4</span>) &#123;  </span><br><span class=\"line\">      <span class=\"keyword\">if</span>(xhr.status == <span class=\"number\">200</span>)&#123; </span><br><span class=\"line\">        ajaxData.success(xhr.response) </span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span>&#123; </span><br><span class=\"line\">        ajaxData.error() </span><br><span class=\"line\">      &#125;  </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createxmlHttpRequest</span>(<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.ActiveXObject) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">&quot;Microsoft.XMLHTTP&quot;</span>);  </span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.XMLHttpRequest) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> XMLHttpRequest();  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">&#125; </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">convertData</span>(<span class=\"params\">data</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"keyword\">typeof</span> data === <span class=\"string\">&#x27;object&#x27;</span> )&#123; </span><br><span class=\"line\">    <span class=\"keyword\">var</span> convertResult = <span class=\"string\">&quot;&quot;</span> ;  </span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> c <span class=\"keyword\">in</span> data)&#123;  </span><br><span class=\"line\">      convertResult+= c + <span class=\"string\">&quot;=&quot;</span> + data[c] + <span class=\"string\">&quot;&amp;&quot;</span>;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    convertResult=convertResult.substring(<span class=\"number\">0</span>,convertResult.length-<span class=\"number\">1</span>) </span><br><span class=\"line\">    <span class=\"keyword\">return</span> convertResult; </span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> data; </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ajax(&#123; </span><br><span class=\"line\">  type:<span class=\"string\">&quot;POST&quot;</span>, </span><br><span class=\"line\">  url:<span class=\"string\">&quot;ajax.php&quot;</span>, </span><br><span class=\"line\">  dataType:<span class=\"string\">&quot;json&quot;</span>, </span><br><span class=\"line\">  data:&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;abc&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;age&quot;</span>:<span class=\"number\">123</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;456&quot;</span></span><br><span class=\"line\">　&#125;, </span><br><span class=\"line\">  beforeSend:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">//some js code </span></span><br><span class=\"line\">  &#125;, </span><br><span class=\"line\">  success:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg</span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(msg) </span><br><span class=\"line\">  &#125;, </span><br><span class=\"line\">  error:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;error&quot;</span>) </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>自己常常在开发过程中被后台研发要求的数据格式搞的十分混乱，常常觉得自己记错了，常常不确定怎么设置header。所以现在进行一个彻底的总结。</p>","more":"<h1 id=\"常见的四种post方式\"><a href=\"#常见的四种post方式\" class=\"headerlink\" title=\"常见的四种post方式\"></a>常见的四种post方式</h1><ol>\n<li>application/x-www-form-urlencoded</li>\n<li>multipart/form-data</li>\n<li>text-plain</li>\n<li>application/json</li>\n</ol>\n<h2 id=\"一个form标签中的enctype有三种类型\"><a href=\"#一个form标签中的enctype有三种类型\" class=\"headerlink\" title=\"一个form标签中的enctype有三种类型\"></a>一个form标签中的enctype有三种类型</h2><ol>\n<li>application/x-www-form-urlencoded</li>\n<li>multipart/form-data</li>\n<li>text-plain</li>\n</ol>\n<p>enctype 属性规定在发送到服务器之前应该如何对表单数据进行编码，默认的情况下是 application/x-www-urlencoded,就是说，在发送到服务器之前，所有的字符都会进行编码。当表单使用POST请求时，数据会被以x-www-urlencoded，当表单使用POST请求时，数据会被以x-www-urlencoede方式编码到Body中来传送。</p>\n<p>而如果是get请求，则是附在url链接后面来传送。</p>\n<p>get请求只支持ASCLL字符集，因此，如果我们要发送更大字符集的内容，我们应使用POST请求。</p>\n<h2 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p>如果要发送大量的二进制数据（non-ASCLL）,”application/x-www-form-urlencoded”是最低效的，因为它需要用3个字符来表示一个non-ASCLL的字符。因此这时就要使用”multipart/form-data”。</p>\n<h2 id=\"application-x-www-form-urlencoded\"><a href=\"#application-x-www-form-urlencoded\" class=\"headerlink\" title=\"application/x-www-form-urlencoded\"></a>application/x-www-form-urlencoded</h2><p><strong>在发送前编码所有字符</strong></p>\n<p>在通过HTTP向服务器发送POST请求数据，都是通过form表单形式提交的，代码如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;http://w.sohu.com&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span> =<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;text1&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;text2&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>提交数据时会向服务器端发出这样的数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F; HTTP&#x2F;1.1</span><br><span class=\"line\">Content-Type:application&#x2F;x-www-form-urlencoded</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Host: w.sohu.com</span><br><span class=\"line\">Content-Length: 21</span><br><span class=\"line\">Connection: Keep-Alive</span><br><span class=\"line\">Cache-Control: no-cache</span><br><span class=\"line\"></span><br><span class=\"line\">txt1&#x3D;hello&amp;txt2&#x3D;world</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>对于普通的HTML Form POST 请求，它会在头信息里使用Content-Length 注明长度。<br>请求头信息每行一条，空行之后便是Body,即内容。内容格式是在头信息中的Content-Type，如上是application/x-www-form-urlencoded。这也意味着消息内容会经过URL格式编码，就像是GET请求时URL中的QueryString。<code>text1=hello&amp;text2=world</code></p>\n<h2 id=\"multipart-form-data\"><a href=\"#multipart-form-data\" class=\"headerlink\" title=\"multipart/form-data\"></a>multipart/form-data</h2><p><strong>不对字符编码，在使用包含文件上传的表单时，必须使用该值</strong></p>\n<p>通过form 表单提交文件操作如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">FORM</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;POST&quot;</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;http://w.sohu.com/t2/upload.do&quot;</span> <span class=\"attr\">enctype</span>=<span class=\"string\">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">INPUT</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;city&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Santa colo&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">INPUT</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;desc&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">INPUT</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;pic&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">FORM</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>浏览器将会发送以下数据：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F;t2&#x2F;upload.do HTTP&#x2F;1.1</span><br><span class=\"line\">User-Agent: SOHUWapRebot</span><br><span class=\"line\">Accept-Language: zh-cn,zh;q&#x3D;0.5</span><br><span class=\"line\">Accept-Charset: GBK,utf-8;q&#x3D;0.7,*;q&#x3D;0.7</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">Content-Length: 60408</span><br><span class=\"line\">Content-Type:multipart&#x2F;form-data; boundary&#x3D;ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class=\"line\">Host: w.sohu.com</span><br><span class=\"line\"></span><br><span class=\"line\">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class=\"line\">Content-Disposition: form-data; name&#x3D;&quot;city&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Santa colo</span><br><span class=\"line\">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class=\"line\">Content-Disposition: form-data;name&#x3D;&quot;desc&quot;</span><br><span class=\"line\">Content-Type: text&#x2F;plain; charset&#x3D;UTF-8</span><br><span class=\"line\">Content-Transfer-Encoding: 8bit</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class=\"line\">Content-Disposition: form-data;name&#x3D;&quot;pic&quot;; filename&#x3D;&quot;photo.jpg&quot;</span><br><span class=\"line\">Content-Type: application&#x2F;octet-stream</span><br><span class=\"line\">Content-Transfer-Encoding: binary</span><br><span class=\"line\"> </span><br><span class=\"line\">... binary data of the jpg ...</span><br><span class=\"line\">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC--</span><br></pre></td></tr></table></figure>\n\n<p>从上面的 multipart/form-data 格式发送的请求来看，他包含了多个parts，每个part都包含头部信息部分，part头信息中必须包含一个Content-disposition 头，其他的头信息则为可选项，比如：Content-Type 等。</p>\n<h2 id=\"text-plain\"><a href=\"#text-plain\" class=\"headerlink\" title=\"text/plain\"></a>text/plain</h2><p>**空格转换为“+”加号，但不对特殊字符编码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;form action=<span class=\"string\">&quot;/example/html/form_action.asp&quot;</span> method=<span class=\"string\">&quot;get&quot;</span> enctype=<span class=\"string\">&quot;text/plain&quot;</span>&gt;</span><br><span class=\"line\">  First name: <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;fname&quot;</span> /&gt;</span></span><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span></span></span><br><span class=\"line\">  Last name: <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;lname&quot;</span> /&gt;</span></span><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span></span></span><br><span class=\"line\">  &lt;input type=<span class=\"string\">&quot;submit&quot;</span> value=<span class=\"string\">&quot;Submit&quot;</span> /&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"application-json\"><a href=\"#application-json\" class=\"headerlink\" title=\"application/json\"></a>application/json</h2><p>最终发送的请求是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BASHPOST http:&#x2F;&#x2F;www.example.com HTTP&#x2F;1.1 </span><br><span class=\"line\">Content-Type: application&#x2F;json;charset&#x3D;utf-8</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;title&quot;:&quot;test&quot;,&quot;sub&quot;:[1,2,3]&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Boundary-分隔符\"><a href=\"#Boundary-分隔符\" class=\"headerlink\" title=\"Boundary 分隔符\"></a>Boundary 分隔符</h2><p>每个部分使用 –boundary 分割开来，最后一行使用–boundary–结尾</p>\n<h1 id=\"ajax-解读\"><a href=\"#ajax-解读\" class=\"headerlink\" title=\"ajax 解读\"></a>ajax 解读</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHTTPRequest();</span><br><span class=\"line\"></span><br><span class=\"line\">xhr.open(<span class=\"string\">&quot;method&quot;</span>, <span class=\"string\">&quot;url&quot;</span>, <span class=\"string\">&quot;async&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">xhr.send(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(xhr.readystate == <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">　　　<span class=\"keyword\">if</span>(xhr.status == <span class=\"number\">200</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">　　　　　<span class=\"built_in\">console</span>.log(xhr.responseText)</span><br><span class=\"line\"></span><br><span class=\"line\">　　　&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">　　&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>XMLHTTPRequest对象</li>\n<li>常用方法：<ul>\n<li><code>open(&quot;method&quot;,&#39;url&#39;,&#39;async&#39;)</code><ul>\n<li>method 表示通过什么方式进行服务器访问，包括post和get</li>\n<li>url 表示访问服务器的地址</li>\n<li>async 表示是否异步，包括true(异步)和false</li>\n</ul>\n</li>\n<li><code>send(content)</code><ul>\n<li>content 表示向服务器发送的数据。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"原生-JS-的封装\"><a href=\"#原生-JS-的封装\" class=\"headerlink\" title=\"原生 JS 的封装\"></a>原生 JS 的封装</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//可以以下步骤代替上面的open、setRequestHeader、send三行，此处对GET和POST做了很好的区分</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ajax</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> ajaxData = &#123; </span><br><span class=\"line\">    type: (<span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].type || <span class=\"string\">&quot;GET&quot;</span>).toUpperCase(), </span><br><span class=\"line\">    url: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].url || <span class=\"string\">&quot;&quot;</span>, </span><br><span class=\"line\">    <span class=\"keyword\">async</span>: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].async || <span class=\"string\">&quot;true&quot;</span>, </span><br><span class=\"line\">    data: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].data || <span class=\"literal\">null</span>, </span><br><span class=\"line\">    dataType: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].dataType || <span class=\"string\">&quot;json&quot;</span>, </span><br><span class=\"line\">    contentType: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].contentType || <span class=\"string\">&quot;application/x-www-form-urlencoded; charset=utf-8&quot;</span>, </span><br><span class=\"line\">    beforeSend: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].beforeSend || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;, </span><br><span class=\"line\">    success: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].success || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;, </span><br><span class=\"line\">    error: <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>].error || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125; </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">  ajaxData.beforeSend() </span><br><span class=\"line\">  <span class=\"keyword\">var</span> xhr = createxmlHttpRequest();  </span><br><span class=\"line\">  xhr.responseType=ajaxData.dataType; </span><br><span class=\"line\"></span><br><span class=\"line\">  xhr.open(ajaxData.type,ajaxData.url,ajaxData.async);  </span><br><span class=\"line\">  xhr.setRequestHeader(<span class=\"string\">&quot;Content-Type&quot;</span>,ajaxData.contentType);  </span><br><span class=\"line\">  xhr.send(convertData(ajaxData.data));  </span><br><span class=\"line\"></span><br><span class=\"line\">  xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (xhr.readyState == <span class=\"number\">4</span>) &#123;  </span><br><span class=\"line\">      <span class=\"keyword\">if</span>(xhr.status == <span class=\"number\">200</span>)&#123; </span><br><span class=\"line\">        ajaxData.success(xhr.response) </span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span>&#123; </span><br><span class=\"line\">        ajaxData.error() </span><br><span class=\"line\">      &#125;  </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createxmlHttpRequest</span>(<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.ActiveXObject) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">&quot;Microsoft.XMLHTTP&quot;</span>);  </span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.XMLHttpRequest) &#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> XMLHttpRequest();  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">&#125; </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">convertData</span>(<span class=\"params\">data</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"keyword\">typeof</span> data === <span class=\"string\">&#x27;object&#x27;</span> )&#123; </span><br><span class=\"line\">    <span class=\"keyword\">var</span> convertResult = <span class=\"string\">&quot;&quot;</span> ;  </span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> c <span class=\"keyword\">in</span> data)&#123;  </span><br><span class=\"line\">      convertResult+= c + <span class=\"string\">&quot;=&quot;</span> + data[c] + <span class=\"string\">&quot;&amp;&quot;</span>;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    convertResult=convertResult.substring(<span class=\"number\">0</span>,convertResult.length-<span class=\"number\">1</span>) </span><br><span class=\"line\">    <span class=\"keyword\">return</span> convertResult; </span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> data; </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ajax(&#123; </span><br><span class=\"line\">  type:<span class=\"string\">&quot;POST&quot;</span>, </span><br><span class=\"line\">  url:<span class=\"string\">&quot;ajax.php&quot;</span>, </span><br><span class=\"line\">  dataType:<span class=\"string\">&quot;json&quot;</span>, </span><br><span class=\"line\">  data:&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;abc&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;age&quot;</span>:<span class=\"number\">123</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;456&quot;</span></span><br><span class=\"line\">　&#125;, </span><br><span class=\"line\">  beforeSend:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">//some js code </span></span><br><span class=\"line\">  &#125;, </span><br><span class=\"line\">  success:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg</span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(msg) </span><br><span class=\"line\">  &#125;, </span><br><span class=\"line\">  error:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;error&quot;</span>) </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>"},{"title":"彻底贯通原型链","date":"2018-01-18T02:15:34.000Z","_content":"\n原型链的串联及扩展\n\n<!--more-->\n\n## 原型\n\n原型：每一个对象都从原型继承属性。**每个对象都有 _proto_ 属性 , 每个对象都有原对象，但只有函数对象才有 prototype 属性**, 但是除却 function.prototype,function.prototype 也是函数对象，但是没有 prototype。可以使用 p.isPrototype(o) 来检查 p 是否是 o 的原型。\n\n## 原型模式\n\n1. **proto**、 constructor 属性是对象所独有的；\n2. prototype 属性是函数独有的；\n3. 上面说过 js 中函数也是对象的一种，那么函数同样也有属性**proto**、 constructor；\n\n```javascript\nfunction a() {}\nvar b = new a()\nconsole.log(b.prototype) //undefined\nconsole.log(b instanceof Function) //false\nconsole.log(b instanceof Object) //true\n```\n\n原型模式是 js 对继承的一种实现\n\n- prototype：构造函数中的属性，指向该构造函数的原型对象。\n\n- constructor ：原型对象中的属性，指向该原型对象的构造函数\n\n- _proto_：实例中的属性，指向 new 这个实例的构造函数的原型对象，对象可以通过`_proto_`来寻找不属于该对象的属性，`_proto_`将对象连接起来组成原型链。所有引用类型的*proto*属性值均指向它的构造函数的 prototype 的属性值。当试图得到一个对象的某个属性时，如果这个对象本身没有这个属性，那么会去他的*proto*（即它的构造函数的 prototype）中寻找\n\n## prototype 属性的引入\n\n**prototype 是一个对象**\n\n每一个 new 出的实例都有自己的属性和方法的副本，无法做到属性、方法共享，因此 Brendan Eich 决定为构造函数设置一个 prototype 属性。\n\n这个对象包含一个对象（以下简称 “prototype 对象 ”），所有实例对象需要共享的属性及方法，都放在这个对象里面，那些不需要共享的属性及方法，就放在构造函数里面。\n\n实例对象一旦创建，就自动引用 prototype 对象的属性和方法。也就是说。实例对象的属性和方法，分成两种，一种是本地的，一种是引用的。\n\n```javascript\nfunction DOG(name) {\n  this.name = name\n}\nDOG.prototype = { species: '犬科' }\n\nvar dogA = new DOG('大毛')\nvar dogB = new DOG('二毛')\n\nalert(dogA.species)\n// 其实是通过dogA._proto_.species 来访问DOG.prototype.species\nalert(dogB.species)\n// 犬科\nDOG.prototype\n//{species:''犬科',constructor:fDOG(name),_proto_:Object}\nDOG.prototype.constructor === DOG\n//true\n```\n\n现在，species 属性放在 prototype 对象里，是两个实例对象共享的。只要修改了 prototype 对象，就会同时影响到两个实例对象。\n\n![network](/images/prototype/1.png)\n\n### 一张图读懂完整的原型链关系\\*\\*\n\n![network](/images/prototype/prototype.image)\n\n### 原型链的作用：对象属性的访问修改和删除。\n\n- 访问。优先在对象本身查找，没有则顺着原型链向上查找\n- 修改。只能修改跟删除自身属性，不会影响到原型链上的其他对象。\n\n## constructor\n\nconstructor 属性获取创造自己的构造函数\n\n```javascript\nvar Parent = function () {}\n//定义一个函数，那它只是一个普通的函数，下面我们让这个函数变得不普通\nvar p1 = new Parent()\n//这时这个Parent就不是普通的函数了，它现在是一个构造函数。因为通过new关键字调用了它\n//创建了一个Parent构造函数的实例 p1\n```\n\n![network](/images/prototype/constructor.png)\n\n## _proto_ （原型指针）\n\n\\_proto** 和 prototype 的关系是 **proto\\_\\_ 是 prototype 的属性\n\n```javascript\nfunction Person(name, age, job) {\n  this.name = name\n  this.age = age\n  this.job = job\n  this.sayName = function () {\n    alert(this.name)\n  }\n}\nvar person1 = new Person('Zaxlct', 28, 'Software Engineer')\nvar person2 = new Person('Mick', 23, 'Doctor')\nperson1.__proto__ == Person.prototype\n//person1.__proto__  = person1.constructor.prototype , person1.constructor = Person\nPerson.__proto__\n//Person.constructor = Function => Person.__proto__  = Function.prototype\nPerson.prototype.__proto__\n// Person.prototype 是一个普通对象（原型对象），普通函数的构造函数是Object => Person.prototype.__proto__ =  Object.prototype\nObject.__proto__\n//普通对象 同上\nObject.prototype.__proto__\n//对象也有proto属性，但它比较特殊，为null,因为null处于原型链的顶端\n```\n\nJS 在创建对象（不论是普通对象还是函数对象）的时候，都有一个叫做 _proto_ 的内置属性，**用于指向创建它的构造函数的原型对象** ，原型链继承是通过 _proto_ 这个原型指针来完成的\n\n## 原型链图\n\n褐色的线为原型链 ![network](/images/prototype/2.png)\n\n够造函数、原型和实例的关系：\n\n1.  每个构造函数都有一个原型对象（x.prototype)\n2.  原型对象都包含一个指向构造函数的指针（x.prototype.constructor === x)\n3.  实例都包含一个指向原型对象的内部指针（a._proto_ ）\n\n** 所有函数的默认原型都是 Object 的实例**\n\n## instanceof\n\n[instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的原型链上——MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof)\n\ninstanceof 表示某个变量是否是某个对象的实例\n\n```javascript\nfunction Car(make, model, year) {\n  this.make = make\n  this.model = model\n  this.year = year\n}\nconst auto = new Car('Honda', 'Accord', 1998)\n\nconsole.log(auto instanceof Car)\n// expected output: true\n\nconsole.log(auto instanceof Object)\n// expected output: true\n```\n\ninstanceof 可以正确的判断对象类型，因为内部机制是通过对象的原型链中是不是能找到类型的 prototype\n\n```javascript\nconsole.log([] instanceof Arrage) //true\nconsole.log({} instanceof Object) //true\nconsole.log(function () {} instanceof Function) //true\nconsole.log(1 instanceof NUmber) //true\n```\n\n![network](/images/prototype/instanceof.image)\n\n### null instanceof Object 为 false\n\n```javascript\nconsole.log(typeof null) //Object\nconsole.log(null instanceof Object) //false\n```\n\n这是历史遗留的问题，对于 null 值，typeof null 是出了 BUG，但是本质上 null 和 Object 不是同一个类型，null 值并不是以 Object 为原型创建的，恰恰相反`Object.prototype.__proto__ = null`\n\n### instanceof 的底层实现原理\n\n```js\nfunction instanceof(l, r) {\n  let o = r.prototype\n  l = l._proto_\n  while (true) {\n    if (l === Null) {\n      return false\n    }\n    if (l === o) {\n      return false\n    }\n    l = l._proto_\n  }\n}\n```\n\n### instanceof 与 constructor 的区别\n\n```javascript\nconsole.log((1).constructor === Number) //true\nconsole.log('1'.constructor === String) //true\nconsole.log(function () {}.constructor === Function) //true\nconsole.log([].constructor === Array) //true\nconsole.log({}.constructor === Object) //true\nfunction Func() {}\n\nFunc.prototype = new Array()\n\nconst f = new Func()\n\nconsole.log(f.constructor === Function) //false\nconsole.log(f.constructor === Array) //true\nconsole.log(f instanceof Function) //true\nconsole.log(f instanceof Array) //false\n```\n\n## Object.prototype.toString.call\n\n使用 Object 对象的原型方法 toString,返回值是[object 类型]字符串,该方法基本上能判断所有的数据类型.\n\n```javascript\nvar toString = Object.prototype.toString\n\ntoString.call({})\n//\"[object Object]\"\ntoString.call([])\n//\"[object Array]\"\ntoString.call(null)\n//\"[object Null]\"\ntoString.call(undefined)\n//\"[object Undefined]\"\ntoString.call(function () {})\n//\"[object Function]\"\ntoString.call(NaN)\n//\"[object Number]\"\n```\n\n## 特殊的箭头函数\n\n箭头函数没有自己的 this,arguments,super 或 new.target。箭头函数表达式更实用于那些需要匿名函数的地方，并且它不能用作构造函数，和 new 一起用会抛出错误，箭头函数没有 prototype 属性。\n\n箭头函数是有`-proto-`属性的，所以箭头函数本身是存在原型链的，他也是有自己的构造函数的，但是因为没有 prototype 属性，他的实例`-proto-`没法指向，所以箭头函数也就无法作为构造函数。\n\n同时箭头函数由于没有 this 指针，通过 call()和 apply 方法调用一个函数时，只能传递参数，不能绑定 this。\n\n```javascript\nvar a = () => {\n  this.name = 'a'\n}\nvar b = function () {\n  this.name = 'b'\n}\nvar c = new a() //TypeError: a is not a constructor\nvar d = new b()\ntypeof a //function\nconsole.log(a.prototype) //undefined\nconsole.log(d._proto_) //{constructor: ƒ}\nconsole.log(a._proto_) //ƒ () { [native code] }\na instanceof Object //true\na instance of Function //true\n```\n\n## 文章扩展\n\n- [深入理解 javascript 原型和闭包](https://www.cnblogs.com/wangfupeng1988/p/3977924.html)\n","source":"_posts/彻底贯通原型链.md","raw":"---\ntitle: 彻底贯通原型链\ndate: 2018-01-18 10:15:34\ncategories: JavaScript\n---\n\n原型链的串联及扩展\n\n<!--more-->\n\n## 原型\n\n原型：每一个对象都从原型继承属性。**每个对象都有 _proto_ 属性 , 每个对象都有原对象，但只有函数对象才有 prototype 属性**, 但是除却 function.prototype,function.prototype 也是函数对象，但是没有 prototype。可以使用 p.isPrototype(o) 来检查 p 是否是 o 的原型。\n\n## 原型模式\n\n1. **proto**、 constructor 属性是对象所独有的；\n2. prototype 属性是函数独有的；\n3. 上面说过 js 中函数也是对象的一种，那么函数同样也有属性**proto**、 constructor；\n\n```javascript\nfunction a() {}\nvar b = new a()\nconsole.log(b.prototype) //undefined\nconsole.log(b instanceof Function) //false\nconsole.log(b instanceof Object) //true\n```\n\n原型模式是 js 对继承的一种实现\n\n- prototype：构造函数中的属性，指向该构造函数的原型对象。\n\n- constructor ：原型对象中的属性，指向该原型对象的构造函数\n\n- _proto_：实例中的属性，指向 new 这个实例的构造函数的原型对象，对象可以通过`_proto_`来寻找不属于该对象的属性，`_proto_`将对象连接起来组成原型链。所有引用类型的*proto*属性值均指向它的构造函数的 prototype 的属性值。当试图得到一个对象的某个属性时，如果这个对象本身没有这个属性，那么会去他的*proto*（即它的构造函数的 prototype）中寻找\n\n## prototype 属性的引入\n\n**prototype 是一个对象**\n\n每一个 new 出的实例都有自己的属性和方法的副本，无法做到属性、方法共享，因此 Brendan Eich 决定为构造函数设置一个 prototype 属性。\n\n这个对象包含一个对象（以下简称 “prototype 对象 ”），所有实例对象需要共享的属性及方法，都放在这个对象里面，那些不需要共享的属性及方法，就放在构造函数里面。\n\n实例对象一旦创建，就自动引用 prototype 对象的属性和方法。也就是说。实例对象的属性和方法，分成两种，一种是本地的，一种是引用的。\n\n```javascript\nfunction DOG(name) {\n  this.name = name\n}\nDOG.prototype = { species: '犬科' }\n\nvar dogA = new DOG('大毛')\nvar dogB = new DOG('二毛')\n\nalert(dogA.species)\n// 其实是通过dogA._proto_.species 来访问DOG.prototype.species\nalert(dogB.species)\n// 犬科\nDOG.prototype\n//{species:''犬科',constructor:fDOG(name),_proto_:Object}\nDOG.prototype.constructor === DOG\n//true\n```\n\n现在，species 属性放在 prototype 对象里，是两个实例对象共享的。只要修改了 prototype 对象，就会同时影响到两个实例对象。\n\n![network](/images/prototype/1.png)\n\n### 一张图读懂完整的原型链关系\\*\\*\n\n![network](/images/prototype/prototype.image)\n\n### 原型链的作用：对象属性的访问修改和删除。\n\n- 访问。优先在对象本身查找，没有则顺着原型链向上查找\n- 修改。只能修改跟删除自身属性，不会影响到原型链上的其他对象。\n\n## constructor\n\nconstructor 属性获取创造自己的构造函数\n\n```javascript\nvar Parent = function () {}\n//定义一个函数，那它只是一个普通的函数，下面我们让这个函数变得不普通\nvar p1 = new Parent()\n//这时这个Parent就不是普通的函数了，它现在是一个构造函数。因为通过new关键字调用了它\n//创建了一个Parent构造函数的实例 p1\n```\n\n![network](/images/prototype/constructor.png)\n\n## _proto_ （原型指针）\n\n\\_proto** 和 prototype 的关系是 **proto\\_\\_ 是 prototype 的属性\n\n```javascript\nfunction Person(name, age, job) {\n  this.name = name\n  this.age = age\n  this.job = job\n  this.sayName = function () {\n    alert(this.name)\n  }\n}\nvar person1 = new Person('Zaxlct', 28, 'Software Engineer')\nvar person2 = new Person('Mick', 23, 'Doctor')\nperson1.__proto__ == Person.prototype\n//person1.__proto__  = person1.constructor.prototype , person1.constructor = Person\nPerson.__proto__\n//Person.constructor = Function => Person.__proto__  = Function.prototype\nPerson.prototype.__proto__\n// Person.prototype 是一个普通对象（原型对象），普通函数的构造函数是Object => Person.prototype.__proto__ =  Object.prototype\nObject.__proto__\n//普通对象 同上\nObject.prototype.__proto__\n//对象也有proto属性，但它比较特殊，为null,因为null处于原型链的顶端\n```\n\nJS 在创建对象（不论是普通对象还是函数对象）的时候，都有一个叫做 _proto_ 的内置属性，**用于指向创建它的构造函数的原型对象** ，原型链继承是通过 _proto_ 这个原型指针来完成的\n\n## 原型链图\n\n褐色的线为原型链 ![network](/images/prototype/2.png)\n\n够造函数、原型和实例的关系：\n\n1.  每个构造函数都有一个原型对象（x.prototype)\n2.  原型对象都包含一个指向构造函数的指针（x.prototype.constructor === x)\n3.  实例都包含一个指向原型对象的内部指针（a._proto_ ）\n\n** 所有函数的默认原型都是 Object 的实例**\n\n## instanceof\n\n[instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的原型链上——MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof)\n\ninstanceof 表示某个变量是否是某个对象的实例\n\n```javascript\nfunction Car(make, model, year) {\n  this.make = make\n  this.model = model\n  this.year = year\n}\nconst auto = new Car('Honda', 'Accord', 1998)\n\nconsole.log(auto instanceof Car)\n// expected output: true\n\nconsole.log(auto instanceof Object)\n// expected output: true\n```\n\ninstanceof 可以正确的判断对象类型，因为内部机制是通过对象的原型链中是不是能找到类型的 prototype\n\n```javascript\nconsole.log([] instanceof Arrage) //true\nconsole.log({} instanceof Object) //true\nconsole.log(function () {} instanceof Function) //true\nconsole.log(1 instanceof NUmber) //true\n```\n\n![network](/images/prototype/instanceof.image)\n\n### null instanceof Object 为 false\n\n```javascript\nconsole.log(typeof null) //Object\nconsole.log(null instanceof Object) //false\n```\n\n这是历史遗留的问题，对于 null 值，typeof null 是出了 BUG，但是本质上 null 和 Object 不是同一个类型，null 值并不是以 Object 为原型创建的，恰恰相反`Object.prototype.__proto__ = null`\n\n### instanceof 的底层实现原理\n\n```js\nfunction instanceof(l, r) {\n  let o = r.prototype\n  l = l._proto_\n  while (true) {\n    if (l === Null) {\n      return false\n    }\n    if (l === o) {\n      return false\n    }\n    l = l._proto_\n  }\n}\n```\n\n### instanceof 与 constructor 的区别\n\n```javascript\nconsole.log((1).constructor === Number) //true\nconsole.log('1'.constructor === String) //true\nconsole.log(function () {}.constructor === Function) //true\nconsole.log([].constructor === Array) //true\nconsole.log({}.constructor === Object) //true\nfunction Func() {}\n\nFunc.prototype = new Array()\n\nconst f = new Func()\n\nconsole.log(f.constructor === Function) //false\nconsole.log(f.constructor === Array) //true\nconsole.log(f instanceof Function) //true\nconsole.log(f instanceof Array) //false\n```\n\n## Object.prototype.toString.call\n\n使用 Object 对象的原型方法 toString,返回值是[object 类型]字符串,该方法基本上能判断所有的数据类型.\n\n```javascript\nvar toString = Object.prototype.toString\n\ntoString.call({})\n//\"[object Object]\"\ntoString.call([])\n//\"[object Array]\"\ntoString.call(null)\n//\"[object Null]\"\ntoString.call(undefined)\n//\"[object Undefined]\"\ntoString.call(function () {})\n//\"[object Function]\"\ntoString.call(NaN)\n//\"[object Number]\"\n```\n\n## 特殊的箭头函数\n\n箭头函数没有自己的 this,arguments,super 或 new.target。箭头函数表达式更实用于那些需要匿名函数的地方，并且它不能用作构造函数，和 new 一起用会抛出错误，箭头函数没有 prototype 属性。\n\n箭头函数是有`-proto-`属性的，所以箭头函数本身是存在原型链的，他也是有自己的构造函数的，但是因为没有 prototype 属性，他的实例`-proto-`没法指向，所以箭头函数也就无法作为构造函数。\n\n同时箭头函数由于没有 this 指针，通过 call()和 apply 方法调用一个函数时，只能传递参数，不能绑定 this。\n\n```javascript\nvar a = () => {\n  this.name = 'a'\n}\nvar b = function () {\n  this.name = 'b'\n}\nvar c = new a() //TypeError: a is not a constructor\nvar d = new b()\ntypeof a //function\nconsole.log(a.prototype) //undefined\nconsole.log(d._proto_) //{constructor: ƒ}\nconsole.log(a._proto_) //ƒ () { [native code] }\na instanceof Object //true\na instance of Function //true\n```\n\n## 文章扩展\n\n- [深入理解 javascript 原型和闭包](https://www.cnblogs.com/wangfupeng1988/p/3977924.html)\n","slug":"彻底贯通原型链","published":1,"updated":"2021-05-26T13:59:07.447Z","_id":"ckon1h1xf002ml5v0hd799706","comments":1,"layout":"post","photos":[],"link":"","content":"<p>原型链的串联及扩展</p>\n<span id=\"more\"></span>\n\n<h2 id=\"原型\"><a href=\"#原型\" class=\"headerlink\" title=\"原型\"></a>原型</h2><p>原型：每一个对象都从原型继承属性。<strong>每个对象都有 <em>proto</em> 属性 , 每个对象都有原对象，但只有函数对象才有 prototype 属性</strong>, 但是除却 function.prototype,function.prototype 也是函数对象，但是没有 prototype。可以使用 p.isPrototype(o) 来检查 p 是否是 o 的原型。</p>\n<h2 id=\"原型模式\"><a href=\"#原型模式\" class=\"headerlink\" title=\"原型模式\"></a>原型模式</h2><ol>\n<li><strong>proto</strong>、 constructor 属性是对象所独有的；</li>\n<li>prototype 属性是函数独有的；</li>\n<li>上面说过 js 中函数也是对象的一种，那么函数同样也有属性<strong>proto</strong>、 constructor；</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> a()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.prototype) <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Function</span>) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<p>原型模式是 js 对继承的一种实现</p>\n<ul>\n<li><p>prototype：构造函数中的属性，指向该构造函数的原型对象。</p>\n</li>\n<li><p>constructor ：原型对象中的属性，指向该原型对象的构造函数</p>\n</li>\n<li><p>_proto_：实例中的属性，指向 new 这个实例的构造函数的原型对象，对象可以通过<code>_proto_</code>来寻找不属于该对象的属性，<code>_proto_</code>将对象连接起来组成原型链。所有引用类型的<em>proto</em>属性值均指向它的构造函数的 prototype 的属性值。当试图得到一个对象的某个属性时，如果这个对象本身没有这个属性，那么会去他的<em>proto</em>（即它的构造函数的 prototype）中寻找</p>\n</li>\n</ul>\n<h2 id=\"prototype-属性的引入\"><a href=\"#prototype-属性的引入\" class=\"headerlink\" title=\"prototype 属性的引入\"></a>prototype 属性的引入</h2><p><strong>prototype 是一个对象</strong></p>\n<p>每一个 new 出的实例都有自己的属性和方法的副本，无法做到属性、方法共享，因此 Brendan Eich 决定为构造函数设置一个 prototype 属性。</p>\n<p>这个对象包含一个对象（以下简称 “prototype 对象 ”），所有实例对象需要共享的属性及方法，都放在这个对象里面，那些不需要共享的属性及方法，就放在构造函数里面。</p>\n<p>实例对象一旦创建，就自动引用 prototype 对象的属性和方法。也就是说。实例对象的属性和方法，分成两种，一种是本地的，一种是引用的。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">DOG</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">DOG.prototype = &#123; <span class=\"attr\">species</span>: <span class=\"string\">&#x27;犬科&#x27;</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> dogA = <span class=\"keyword\">new</span> DOG(<span class=\"string\">&#x27;大毛&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> dogB = <span class=\"keyword\">new</span> DOG(<span class=\"string\">&#x27;二毛&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">alert(dogA.species)</span><br><span class=\"line\"><span class=\"comment\">// 其实是通过dogA._proto_.species 来访问DOG.prototype.species</span></span><br><span class=\"line\">alert(dogB.species)</span><br><span class=\"line\"><span class=\"comment\">// 犬科</span></span><br><span class=\"line\">DOG.prototype</span><br><span class=\"line\"><span class=\"comment\">//&#123;species:&#x27;&#x27;犬科&#x27;,constructor:fDOG(name),_proto_:Object&#125;</span></span><br><span class=\"line\">DOG.prototype.constructor === DOG</span><br><span class=\"line\"><span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<p>现在，species 属性放在 prototype 对象里，是两个实例对象共享的。只要修改了 prototype 对象，就会同时影响到两个实例对象。</p>\n<p><img src=\"/images/prototype/1.png\" alt=\"network\"></p>\n<h3 id=\"一张图读懂完整的原型链关系\"><a href=\"#一张图读懂完整的原型链关系\" class=\"headerlink\" title=\"一张图读懂完整的原型链关系**\"></a>一张图读懂完整的原型链关系**</h3><p><img src=\"/images/prototype/prototype.image\" alt=\"network\"></p>\n<h3 id=\"原型链的作用：对象属性的访问修改和删除。\"><a href=\"#原型链的作用：对象属性的访问修改和删除。\" class=\"headerlink\" title=\"原型链的作用：对象属性的访问修改和删除。\"></a>原型链的作用：对象属性的访问修改和删除。</h3><ul>\n<li>访问。优先在对象本身查找，没有则顺着原型链向上查找</li>\n<li>修改。只能修改跟删除自身属性，不会影响到原型链上的其他对象。</li>\n</ul>\n<h2 id=\"constructor-NaN\"><a href=\"#constructor-NaN\" class=\"headerlink\" title=\"constructor\"></a>constructor</h2><p>constructor 属性获取创造自己的构造函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Parent = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"comment\">//定义一个函数，那它只是一个普通的函数，下面我们让这个函数变得不普通</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> Parent()</span><br><span class=\"line\"><span class=\"comment\">//这时这个Parent就不是普通的函数了，它现在是一个构造函数。因为通过new关键字调用了它</span></span><br><span class=\"line\"><span class=\"comment\">//创建了一个Parent构造函数的实例 p1</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/prototype/constructor.png\" alt=\"network\"></p>\n<h2 id=\"proto-（原型指针）\"><a href=\"#proto-（原型指针）\" class=\"headerlink\" title=\"proto （原型指针）\"></a><em>proto</em> （原型指针）</h2><p>_proto** 和 prototype 的关系是 **proto__ 是 prototype 的属性</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, job</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.job = job</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sayName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person1 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Zaxlct&#x27;</span>, <span class=\"number\">28</span>, <span class=\"string\">&#x27;Software Engineer&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> person2 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Mick&#x27;</span>, <span class=\"number\">23</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>)</span><br><span class=\"line\">person1.__proto__ == Person.prototype</span><br><span class=\"line\"><span class=\"comment\">//person1.__proto__  = person1.constructor.prototype , person1.constructor = Person</span></span><br><span class=\"line\">Person.__proto__</span><br><span class=\"line\"><span class=\"comment\">//Person.constructor = Function =&gt; Person.__proto__  = Function.prototype</span></span><br><span class=\"line\">Person.prototype.__proto__</span><br><span class=\"line\"><span class=\"comment\">// Person.prototype 是一个普通对象（原型对象），普通函数的构造函数是Object =&gt; Person.prototype.__proto__ =  Object.prototype</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.__proto__</span><br><span class=\"line\"><span class=\"comment\">//普通对象 同上</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.__proto__</span><br><span class=\"line\"><span class=\"comment\">//对象也有proto属性，但它比较特殊，为null,因为null处于原型链的顶端</span></span><br></pre></td></tr></table></figure>\n\n<p>JS 在创建对象（不论是普通对象还是函数对象）的时候，都有一个叫做 <em>proto</em> 的内置属性，<strong>用于指向创建它的构造函数的原型对象</strong> ，原型链继承是通过 <em>proto</em> 这个原型指针来完成的</p>\n<h2 id=\"原型链图\"><a href=\"#原型链图\" class=\"headerlink\" title=\"原型链图\"></a>原型链图</h2><p>褐色的线为原型链 <img src=\"/images/prototype/2.png\" alt=\"network\"></p>\n<p>够造函数、原型和实例的关系：</p>\n<ol>\n<li> 每个构造函数都有一个原型对象（x.prototype)</li>\n<li> 原型对象都包含一个指向构造函数的指针（x.prototype.constructor === x)</li>\n<li> 实例都包含一个指向原型对象的内部指针（a.<em>proto</em> ）</li>\n</ol>\n<p>** 所有函数的默认原型都是 Object 的实例**</p>\n<h2 id=\"instanceof\"><a href=\"#instanceof\" class=\"headerlink\" title=\"instanceof\"></a>instanceof</h2><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof\">instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的原型链上——MDN</a></p>\n<p>instanceof 表示某个变量是否是某个对象的实例</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Car</span>(<span class=\"params\">make, model, year</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.make = make</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.model = model</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.year = year</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> auto = <span class=\"keyword\">new</span> Car(<span class=\"string\">&#x27;Honda&#x27;</span>, <span class=\"string\">&#x27;Accord&#x27;</span>, <span class=\"number\">1998</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(auto <span class=\"keyword\">instanceof</span> Car)</span><br><span class=\"line\"><span class=\"comment\">// expected output: true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(auto <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>)</span><br><span class=\"line\"><span class=\"comment\">// expected output: true</span></span><br></pre></td></tr></table></figure>\n\n<p>instanceof 可以正确的判断对象类型，因为内部机制是通过对象的原型链中是不是能找到类型的 prototype</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log([] <span class=\"keyword\">instanceof</span> Arrage) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(&#123;&#125; <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125; <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Function</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span> <span class=\"keyword\">instanceof</span> NUmber) <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/prototype/instanceof.image\" alt=\"network\"></p>\n<h3 id=\"null-instanceof-Object-为-false\"><a href=\"#null-instanceof-Object-为-false\" class=\"headerlink\" title=\"null instanceof Object 为 false\"></a>null instanceof Object 为 false</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> <span class=\"literal\">null</span>) <span class=\"comment\">//Object</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"literal\">null</span> <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<p>这是历史遗留的问题，对于 null 值，typeof null 是出了 BUG，但是本质上 null 和 Object 不是同一个类型，null 值并不是以 Object 为原型创建的，恰恰相反<code>Object.prototype.__proto__ = null</code></p>\n<h3 id=\"instanceof-的底层实现原理\"><a href=\"#instanceof-的底层实现原理\" class=\"headerlink\" title=\"instanceof 的底层实现原理\"></a>instanceof 的底层实现原理</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">instanceof</span>(<span class=\"params\">l, r</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> o = r.prototype</span><br><span class=\"line\">  l = l._proto_</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l === Null) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l === o) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    l = l._proto_</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"instanceof-与-constructor-的区别\"><a href=\"#instanceof-与-constructor-的区别\" class=\"headerlink\" title=\"instanceof 与 constructor 的区别\"></a>instanceof 与 constructor 的区别</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log((<span class=\"number\">1</span>).constructor === <span class=\"built_in\">Number</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;1&#x27;</span>.constructor === <span class=\"built_in\">String</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;.constructor === <span class=\"built_in\">Function</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log([].constructor === <span class=\"built_in\">Array</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(&#123;&#125;.constructor === <span class=\"built_in\">Object</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Func</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Func.prototype = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> f = <span class=\"keyword\">new</span> Func()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.constructor === <span class=\"built_in\">Function</span>) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.constructor === <span class=\"built_in\">Array</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Function</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span>) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Object-prototype-toString-call\"><a href=\"#Object-prototype-toString-call\" class=\"headerlink\" title=\"Object.prototype.toString.call\"></a>Object.prototype.toString.call</h2><p>使用 Object 对象的原型方法 toString,返回值是[object 类型]字符串,该方法基本上能判断所有的数据类型.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> toString = <span class=\"built_in\">Object</span>.prototype.toString</span><br><span class=\"line\"></span><br><span class=\"line\">toString.call(&#123;&#125;)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Object]&quot;</span></span><br><span class=\"line\">toString.call([])</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Array]&quot;</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">null</span>)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Null]&quot;</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">undefined</span>)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Undefined]&quot;</span></span><br><span class=\"line\">toString.call(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Function]&quot;</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">NaN</span>)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Number]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"特殊的箭头函数\"><a href=\"#特殊的箭头函数\" class=\"headerlink\" title=\"特殊的箭头函数\"></a>特殊的箭头函数</h2><p>箭头函数没有自己的 this,arguments,super 或 new.target。箭头函数表达式更实用于那些需要匿名函数的地方，并且它不能用作构造函数，和 new 一起用会抛出错误，箭头函数没有 prototype 属性。</p>\n<p>箭头函数是有<code>-proto-</code>属性的，所以箭头函数本身是存在原型链的，他也是有自己的构造函数的，但是因为没有 prototype 属性，他的实例<code>-proto-</code>没法指向，所以箭头函数也就无法作为构造函数。</p>\n<p>同时箭头函数由于没有 this 指针，通过 call()和 apply 方法调用一个函数时，只能传递参数，不能绑定 this。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;a&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;b&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> a() <span class=\"comment\">//TypeError: a is not a constructor</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> d = <span class=\"keyword\">new</span> b()</span><br><span class=\"line\"><span class=\"keyword\">typeof</span> a <span class=\"comment\">//function</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.prototype) <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(d._proto_) <span class=\"comment\">//&#123;constructor: ƒ&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a._proto_) <span class=\"comment\">//ƒ () &#123; [native code] &#125;</span></span><br><span class=\"line\">a <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span> <span class=\"comment\">//true</span></span><br><span class=\"line\">a instance <span class=\"keyword\">of</span> <span class=\"built_in\">Function</span> <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"文章扩展\"><a href=\"#文章扩展\" class=\"headerlink\" title=\"文章扩展\"></a>文章扩展</h2><ul>\n<li><a href=\"https://www.cnblogs.com/wangfupeng1988/p/3977924.html\">深入理解 javascript 原型和闭包</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>原型链的串联及扩展</p>","more":"<h2 id=\"原型\"><a href=\"#原型\" class=\"headerlink\" title=\"原型\"></a>原型</h2><p>原型：每一个对象都从原型继承属性。<strong>每个对象都有 <em>proto</em> 属性 , 每个对象都有原对象，但只有函数对象才有 prototype 属性</strong>, 但是除却 function.prototype,function.prototype 也是函数对象，但是没有 prototype。可以使用 p.isPrototype(o) 来检查 p 是否是 o 的原型。</p>\n<h2 id=\"原型模式\"><a href=\"#原型模式\" class=\"headerlink\" title=\"原型模式\"></a>原型模式</h2><ol>\n<li><strong>proto</strong>、 constructor 属性是对象所独有的；</li>\n<li>prototype 属性是函数独有的；</li>\n<li>上面说过 js 中函数也是对象的一种，那么函数同样也有属性<strong>proto</strong>、 constructor；</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> a()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.prototype) <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Function</span>) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<p>原型模式是 js 对继承的一种实现</p>\n<ul>\n<li><p>prototype：构造函数中的属性，指向该构造函数的原型对象。</p>\n</li>\n<li><p>constructor ：原型对象中的属性，指向该原型对象的构造函数</p>\n</li>\n<li><p>_proto_：实例中的属性，指向 new 这个实例的构造函数的原型对象，对象可以通过<code>_proto_</code>来寻找不属于该对象的属性，<code>_proto_</code>将对象连接起来组成原型链。所有引用类型的<em>proto</em>属性值均指向它的构造函数的 prototype 的属性值。当试图得到一个对象的某个属性时，如果这个对象本身没有这个属性，那么会去他的<em>proto</em>（即它的构造函数的 prototype）中寻找</p>\n</li>\n</ul>\n<h2 id=\"prototype-属性的引入\"><a href=\"#prototype-属性的引入\" class=\"headerlink\" title=\"prototype 属性的引入\"></a>prototype 属性的引入</h2><p><strong>prototype 是一个对象</strong></p>\n<p>每一个 new 出的实例都有自己的属性和方法的副本，无法做到属性、方法共享，因此 Brendan Eich 决定为构造函数设置一个 prototype 属性。</p>\n<p>这个对象包含一个对象（以下简称 “prototype 对象 ”），所有实例对象需要共享的属性及方法，都放在这个对象里面，那些不需要共享的属性及方法，就放在构造函数里面。</p>\n<p>实例对象一旦创建，就自动引用 prototype 对象的属性和方法。也就是说。实例对象的属性和方法，分成两种，一种是本地的，一种是引用的。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">DOG</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">DOG.prototype = &#123; <span class=\"attr\">species</span>: <span class=\"string\">&#x27;犬科&#x27;</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> dogA = <span class=\"keyword\">new</span> DOG(<span class=\"string\">&#x27;大毛&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> dogB = <span class=\"keyword\">new</span> DOG(<span class=\"string\">&#x27;二毛&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">alert(dogA.species)</span><br><span class=\"line\"><span class=\"comment\">// 其实是通过dogA._proto_.species 来访问DOG.prototype.species</span></span><br><span class=\"line\">alert(dogB.species)</span><br><span class=\"line\"><span class=\"comment\">// 犬科</span></span><br><span class=\"line\">DOG.prototype</span><br><span class=\"line\"><span class=\"comment\">//&#123;species:&#x27;&#x27;犬科&#x27;,constructor:fDOG(name),_proto_:Object&#125;</span></span><br><span class=\"line\">DOG.prototype.constructor === DOG</span><br><span class=\"line\"><span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<p>现在，species 属性放在 prototype 对象里，是两个实例对象共享的。只要修改了 prototype 对象，就会同时影响到两个实例对象。</p>\n<p><img src=\"/images/prototype/1.png\" alt=\"network\"></p>\n<h3 id=\"一张图读懂完整的原型链关系\"><a href=\"#一张图读懂完整的原型链关系\" class=\"headerlink\" title=\"一张图读懂完整的原型链关系**\"></a>一张图读懂完整的原型链关系**</h3><p><img src=\"/images/prototype/prototype.image\" alt=\"network\"></p>\n<h3 id=\"原型链的作用：对象属性的访问修改和删除。\"><a href=\"#原型链的作用：对象属性的访问修改和删除。\" class=\"headerlink\" title=\"原型链的作用：对象属性的访问修改和删除。\"></a>原型链的作用：对象属性的访问修改和删除。</h3><ul>\n<li>访问。优先在对象本身查找，没有则顺着原型链向上查找</li>\n<li>修改。只能修改跟删除自身属性，不会影响到原型链上的其他对象。</li>\n</ul>\n<h2 id=\"constructor-NaN\"><a href=\"#constructor-NaN\" class=\"headerlink\" title=\"constructor\"></a>constructor</h2><p>constructor 属性获取创造自己的构造函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Parent = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"comment\">//定义一个函数，那它只是一个普通的函数，下面我们让这个函数变得不普通</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p1 = <span class=\"keyword\">new</span> Parent()</span><br><span class=\"line\"><span class=\"comment\">//这时这个Parent就不是普通的函数了，它现在是一个构造函数。因为通过new关键字调用了它</span></span><br><span class=\"line\"><span class=\"comment\">//创建了一个Parent构造函数的实例 p1</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/prototype/constructor.png\" alt=\"network\"></p>\n<h2 id=\"proto-（原型指针）\"><a href=\"#proto-（原型指针）\" class=\"headerlink\" title=\"proto （原型指针）\"></a><em>proto</em> （原型指针）</h2><p>_proto** 和 prototype 的关系是 **proto__ 是 prototype 的属性</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, job</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.job = job</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sayName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person1 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Zaxlct&#x27;</span>, <span class=\"number\">28</span>, <span class=\"string\">&#x27;Software Engineer&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> person2 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Mick&#x27;</span>, <span class=\"number\">23</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>)</span><br><span class=\"line\">person1.__proto__ == Person.prototype</span><br><span class=\"line\"><span class=\"comment\">//person1.__proto__  = person1.constructor.prototype , person1.constructor = Person</span></span><br><span class=\"line\">Person.__proto__</span><br><span class=\"line\"><span class=\"comment\">//Person.constructor = Function =&gt; Person.__proto__  = Function.prototype</span></span><br><span class=\"line\">Person.prototype.__proto__</span><br><span class=\"line\"><span class=\"comment\">// Person.prototype 是一个普通对象（原型对象），普通函数的构造函数是Object =&gt; Person.prototype.__proto__ =  Object.prototype</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.__proto__</span><br><span class=\"line\"><span class=\"comment\">//普通对象 同上</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.__proto__</span><br><span class=\"line\"><span class=\"comment\">//对象也有proto属性，但它比较特殊，为null,因为null处于原型链的顶端</span></span><br></pre></td></tr></table></figure>\n\n<p>JS 在创建对象（不论是普通对象还是函数对象）的时候，都有一个叫做 <em>proto</em> 的内置属性，<strong>用于指向创建它的构造函数的原型对象</strong> ，原型链继承是通过 <em>proto</em> 这个原型指针来完成的</p>\n<h2 id=\"原型链图\"><a href=\"#原型链图\" class=\"headerlink\" title=\"原型链图\"></a>原型链图</h2><p>褐色的线为原型链 <img src=\"/images/prototype/2.png\" alt=\"network\"></p>\n<p>够造函数、原型和实例的关系：</p>\n<ol>\n<li> 每个构造函数都有一个原型对象（x.prototype)</li>\n<li> 原型对象都包含一个指向构造函数的指针（x.prototype.constructor === x)</li>\n<li> 实例都包含一个指向原型对象的内部指针（a.<em>proto</em> ）</li>\n</ol>\n<p>** 所有函数的默认原型都是 Object 的实例**</p>\n<h2 id=\"instanceof\"><a href=\"#instanceof\" class=\"headerlink\" title=\"instanceof\"></a>instanceof</h2><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof\">instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的原型链上——MDN</a></p>\n<p>instanceof 表示某个变量是否是某个对象的实例</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Car</span>(<span class=\"params\">make, model, year</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.make = make</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.model = model</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.year = year</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> auto = <span class=\"keyword\">new</span> Car(<span class=\"string\">&#x27;Honda&#x27;</span>, <span class=\"string\">&#x27;Accord&#x27;</span>, <span class=\"number\">1998</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(auto <span class=\"keyword\">instanceof</span> Car)</span><br><span class=\"line\"><span class=\"comment\">// expected output: true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(auto <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>)</span><br><span class=\"line\"><span class=\"comment\">// expected output: true</span></span><br></pre></td></tr></table></figure>\n\n<p>instanceof 可以正确的判断对象类型，因为内部机制是通过对象的原型链中是不是能找到类型的 prototype</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log([] <span class=\"keyword\">instanceof</span> Arrage) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(&#123;&#125; <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125; <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Function</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span> <span class=\"keyword\">instanceof</span> NUmber) <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/prototype/instanceof.image\" alt=\"network\"></p>\n<h3 id=\"null-instanceof-Object-为-false\"><a href=\"#null-instanceof-Object-为-false\" class=\"headerlink\" title=\"null instanceof Object 为 false\"></a>null instanceof Object 为 false</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> <span class=\"literal\">null</span>) <span class=\"comment\">//Object</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"literal\">null</span> <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span>) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<p>这是历史遗留的问题，对于 null 值，typeof null 是出了 BUG，但是本质上 null 和 Object 不是同一个类型，null 值并不是以 Object 为原型创建的，恰恰相反<code>Object.prototype.__proto__ = null</code></p>\n<h3 id=\"instanceof-的底层实现原理\"><a href=\"#instanceof-的底层实现原理\" class=\"headerlink\" title=\"instanceof 的底层实现原理\"></a>instanceof 的底层实现原理</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">instanceof</span>(<span class=\"params\">l, r</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> o = r.prototype</span><br><span class=\"line\">  l = l._proto_</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l === Null) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l === o) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    l = l._proto_</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"instanceof-与-constructor-的区别\"><a href=\"#instanceof-与-constructor-的区别\" class=\"headerlink\" title=\"instanceof 与 constructor 的区别\"></a>instanceof 与 constructor 的区别</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log((<span class=\"number\">1</span>).constructor === <span class=\"built_in\">Number</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;1&#x27;</span>.constructor === <span class=\"built_in\">String</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;.constructor === <span class=\"built_in\">Function</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log([].constructor === <span class=\"built_in\">Array</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(&#123;&#125;.constructor === <span class=\"built_in\">Object</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Func</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Func.prototype = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> f = <span class=\"keyword\">new</span> Func()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.constructor === <span class=\"built_in\">Function</span>) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f.constructor === <span class=\"built_in\">Array</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Function</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(f <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span>) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Object-prototype-toString-call\"><a href=\"#Object-prototype-toString-call\" class=\"headerlink\" title=\"Object.prototype.toString.call\"></a>Object.prototype.toString.call</h2><p>使用 Object 对象的原型方法 toString,返回值是[object 类型]字符串,该方法基本上能判断所有的数据类型.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> toString = <span class=\"built_in\">Object</span>.prototype.toString</span><br><span class=\"line\"></span><br><span class=\"line\">toString.call(&#123;&#125;)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Object]&quot;</span></span><br><span class=\"line\">toString.call([])</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Array]&quot;</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">null</span>)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Null]&quot;</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">undefined</span>)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Undefined]&quot;</span></span><br><span class=\"line\">toString.call(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Function]&quot;</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">NaN</span>)</span><br><span class=\"line\"><span class=\"comment\">//&quot;[object Number]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"特殊的箭头函数\"><a href=\"#特殊的箭头函数\" class=\"headerlink\" title=\"特殊的箭头函数\"></a>特殊的箭头函数</h2><p>箭头函数没有自己的 this,arguments,super 或 new.target。箭头函数表达式更实用于那些需要匿名函数的地方，并且它不能用作构造函数，和 new 一起用会抛出错误，箭头函数没有 prototype 属性。</p>\n<p>箭头函数是有<code>-proto-</code>属性的，所以箭头函数本身是存在原型链的，他也是有自己的构造函数的，但是因为没有 prototype 属性，他的实例<code>-proto-</code>没法指向，所以箭头函数也就无法作为构造函数。</p>\n<p>同时箭头函数由于没有 this 指针，通过 call()和 apply 方法调用一个函数时，只能传递参数，不能绑定 this。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;a&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;b&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"keyword\">new</span> a() <span class=\"comment\">//TypeError: a is not a constructor</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> d = <span class=\"keyword\">new</span> b()</span><br><span class=\"line\"><span class=\"keyword\">typeof</span> a <span class=\"comment\">//function</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.prototype) <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(d._proto_) <span class=\"comment\">//&#123;constructor: ƒ&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a._proto_) <span class=\"comment\">//ƒ () &#123; [native code] &#125;</span></span><br><span class=\"line\">a <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span> <span class=\"comment\">//true</span></span><br><span class=\"line\">a instance <span class=\"keyword\">of</span> <span class=\"built_in\">Function</span> <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"文章扩展\"><a href=\"#文章扩展\" class=\"headerlink\" title=\"文章扩展\"></a>文章扩展</h2><ul>\n<li><a href=\"https://www.cnblogs.com/wangfupeng1988/p/3977924.html\">深入理解 javascript 原型和闭包</a></li>\n</ul>"},{"title":"数组操作方法","date":"2017-11-01T08:52:42.000Z","_content":"\n**数组原形方法有以下几种**:\n\n`join()`,`push()`,`pop()`,`sort()`,`reverse()`,`concat()`,`slice()`,`splice()`,`indexOf()`,`lastIndexOf()`,`forEach()`,`map()`, `filter()`,`every()`,`some()`,`reduce()`,`reduceRigh()`\n\n<!--more-->\n\n## join()，不改变原数组。\n\njoin(separator): 将数组的元素组成一个字符串，以 separator 为分隔符，省略则默认为逗号，该方法只接受一个参数。\n\n```javascript\nvar arr = [1, 2, 3];\nconsole.log(arr.join()); // 1,2,3\nconsole.log(arr.join(\"-\")); // 1-2-3\nconsole.log(arr); // [1, 2, 3]（原数组不变）\n```\n\n## push() 与 pop()，改变元素组\n\n* push(): 可以接受任意数量的数组，把它们，把他们逐个添加到数组末尾，**并返回修改后数组的长度**。\n* pop(): 数组末尾移除最后一项，减少数组的 length 的值，然后返回移除的项。\n\n```javascript\nvar arr = [\"Lily\", \"lucy\", \"Tom\"];\nvar count = arr.push(\"Jack\", \"Sean\");\nconsole.log(count); // 5\nconsole.log(arr); // [\"Lily\", \"lucy\", \"Tom\", \"Jack\", \"Sean\"]\nvar item = arr.pop();\nconsole.log(item); // Sean\nconsole.log(arr); // [\"Lily\", \"lucy\", \"Tom\", \"Jack\"]\n```\n\n## shift() 和 unshift()，改变原数组\n\n* shift(): 删除原数组的第一项，并返回删除元素的值，如果为空则返回 undefined。\n* unshift(): 将参数添加到原数组开头，**并返回数组的长度**。\n\n```javascript\nvar arr = [\"Lily\", \"lucy\", \"Tom\"];\nvar count = arr.unshift(\"Jack\", \"Sean\");\nconsole.log(count); // 5\nconsole.log(arr); //[\"Jack\", \"Sean\", \"Lily\", \"lucy\", \"Tom\"]\nvar item = arr.shift();\nconsole.log(item); // Jack\nconsole.log(arr); // [\"Sean\", \"Lily\", \"lucy\", \"Tom\"]\n```\n\n## sort(), 改变原数组\n\n按升序列排序数组系那个（从小到大），在排序时，sort() 方法会调用每个数组的 toString() 转型方法，**然后比较得到的字符串**，已确定如何排序。即使数组中每一个都是数值 ,sort() 方法比较的意识字符串，因此会出现以下情况：\n\n```javascript\nvar arr1 = [\"a\", \"d\", \"c\", \"b\"];\nconsole.log(arr1.sort()); // [\"a\", \"b\", \"c\", \"d\"]\narr2 = [13, 24, 51, 3];\nconsole.log(arr2.sort()); // [13, 24, 3, 51]\nconsole.log(arr2); // [13, 24, 3, 51](元数组被改变)\nvar scores = [1, 10, 21, 2];\nscores.sort(); // [1, 10, 2, 21] 注意10在2之前  因为在 Unicode 指针顺序中\"10\"在\"2\"之前\n```\n\n为了解决上述问题，sort() 方法可以接受一个参数，以便指定哪个值位于哪个值前面。比较函数接受两个参数，如果第一个参数应该位于第二个之前则返回一个负数，如果两个参数相等则返回 0，如果第一个参数应该位于第二个参数之后则返回一个正数。一下是比较函数：\n\n```javascript\nfunction compare(value1, value2) {\n  if (value1 < value2) {\n    return -1;\n  } else if (value1 > value2) {\n    return 1;\n  } else {\n    return 0;\n  }\n}\narr2 = [13, 24, 51, 3];\nconsole.log(arr2.sort(compare)); // [3, 13, 24, 51]\n```\n\n如果需要通过比较函数产生降序排序的结果，只要交换比较函数的返回值即可。\n\n## reverse() ，改变原数组\n\nreverse(): 反转数组项的顺序\n\n```javascript\nreverse()：反转数组项的顺序。\n?\n1\n2\n3\nvar arr = [13, 24, 51, 3];\nconsole.log(arr.reverse()); //[3, 51, 24, 13]\nconsole.log(arr); //[3, 51, 24, 13](原数组改变)\n```\n\n## concat()，不改变原数组\n\nconcat()：将参数添加到元素组中，这个方法会先创建当前数组的一个副本，然后将接受到的参数添加到这个副本的末尾，最后返回新构建的数组，**在没有给 concat() 方法传递一个参数的情况下，它只是复制当前数组并返回副本。**\n\n```javascript\nvar arr = [1, 3, 5, 7];\nvar arrCopy = arr.concat(9, [11, 13]);\nconsole.log(arrCopy); //[1, 3, 5, 7, 9, 11, 13]\nconsole.log(arr); // [1, 3, 5, 7](原数组未被修改)\n```\n\n上面的测试中发现，传入的不是数组，则是直接将数组添加到数组后面，**如果传入的是数组，则将数组中的各个项添加到数组中，但如果是二维数组呢？**\n\n```javascript\nvar arrCopy2 = arr.concat([9, [11, 13]]);\nconsole.log(arrCopy2); //[1, 3, 5, 7, 9, Array[2]]\nconsole.log(arrCopy2[5]); //[11, 13]\n```\n\n## slice() 不改变原数组\n\nslice(): 返回从原数组中指定开始下标到结束下标之间的项组成的新数组。slice() 方法可以接受一或是两个参数，即要返回项的起始和结束位置。在只有一个参数的情况下，slice() 方法返回从该参数指定位置到当前数组末尾的所有项。如果有两个参数，就会返回起始和结束位置之前的项 - 但不包括结束位置的项。\n\n```javascript\nvar arr = [1, 3, 5, 7, 9, 11];\nvar arrCopy = arr.slice(1);\nvar arrCopy2 = arr.slice(1, 4);\nvar arrCopy3 = arr.slice(1, -2);\nvar arrCopy4 = arr.slice(-4, -1);\nconsole.log(arr); //[1, 3, 5, 7, 9, 11](原数组没变)\nconsole.log(arrCopy); //[3, 5, 7, 9, 11]\nconsole.log(arrCopy2); //[3, 5, 7]\nconsole.log(arrCopy3); //[3, 5, 7]\nconsole.log(arrCopy4); //[5, 7, 9]\n```\n\n## splice() 可以实现删除、插入和替换 改变原数组\n\n* 删除：可以删除任意数量的项，只需要提供两个参数，要删除的个一个项的位置和要删除的橡树。例如，splice(0,2) 会删除数组中的前两项。\n* 插入：可以向指定位置插入任意数量的项，需要 3 个参数，起始位置、0 （要删除的项数）和要插入的项，例如 splice(2,0,4,6) 会在当前数组的位置 2 开始插入 4 和 6\n* 替换：可以向指定的位置插入任意的项，同时删除任意数量的项。需要 3 个参数，只需要指定 3 个参数，起始位置、要删除的项数和要插入的任意数量的项。插入的项数不必与删除的项数相等，例如 splice(2,1,4,6) 会删除当前数组位置 2 的项，然后再从位置 2 开始插入 4 和 6。\n\n```javascript\nvar arr = [1, 3, 5, 7, 9, 11];\nvar arrRemoved = arr.splice(0, 2);\nconsole.log(arr); //[5, 7, 9, 11]\nconsole.log(arrRemoved); //[1, 3]\nvar arrRemoved2 = arr.splice(2, 0, 4, 6);\nconsole.log(arr); // [5, 7, 4, 6, 9, 11]\nconsole.log(arrRemoved2); // []\nvar arrRemoved3 = arr.splice(1, 1, 2, 4);\nconsole.log(arr); // [5, 2, 4, 4, 6, 9, 11]\nconsole.log(arrRemoved3); //[7]\n```\n\n## indexOf() 和 lastIndexOf()\n\n* indexOf()：接受两个参数，要查找的项和（可选的）表示查找七点位置的索引。从数组的开头开始查找。\n* lastIndexOf() ：接受两个参数：要查找的项和（可选的）表示查找起点位置的索引。从数组的末尾开始查找\n\n```javascript\nvar arr = [1, 3, 5, 7, 7, 5, 3, 1];\nconsole.log(arr.indexOf(5)); //2\nconsole.log(arr.lastIndexOf(5)); //5\nconsole.log(arr.indexOf(5, 2)); //2\nconsole.log(arr.lastIndexOf(5, 4)); //2\nconsole.log(arr.indexOf(\"5\")); //-1\n```\n\n## forEach() 遍历\n\n对数组进行遍历循环遍历，对数组的每一项运行给定函数，这个方法没有返回值，参数都是 function 类型，默认参数分别有：遍历数组内容、对应的数组索引、数组本身。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5];\narr.forEach(function(x, index, a) {\n  console.log(x + \"|\" + index + \"|\" + (a === arr));\n});\n// 输出为：\n// 1|0|true\n// 2|1|true\n// 3|2|true\n// 4|3|true\n// 5|4|true\n```\n\n## map()\n\nmap() ：指 “ 映射 ”，对数组中的每一项运行给定函数，返回每一次函数调用的结果组成的数组。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5];\nvar arr2 = arr.map(function(item) {\n  return item * item;\n});\nconsole.log(arr2); //[1, 4, 9, 16, 25]\n```\n\n## filter()\n\nfilter(): “ 过滤功能 ”，数组中的每一项运行给定函数，返回满足过滤条件组成的数组。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\nvar arr2 = arr.filter(function(x, index) {\nreturn index % 3 === 0 || x >= 8;\n});\nconsole.log(arr2); //[1, 4, 7, 8, 9, 10]\n```\n\n## every()\n\nevery() ，判断数组中每一项都是满足条件，只有所有项都满足条件才会返回 true。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5];\nvar arr2 = arr.every(function(x) {\n  return x < 10;\n});\nconsole.log(arr2); //true\nvar arr3 = arr.every(function(x) {\n  return x < 3;\n});\nconsole.log(arr3); // false\n```\n\n## some()\n\nsome() ：判断数组中是否存在满足条件的项，只要有一项满足，就会返回 true。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5];\nvar arr2 = arr.some(function(x) {\n  return x < 3;\n});\nconsole.log(arr2); //true\nvar arr3 = arr.some(function(x) {\n  return x < 1;\n});\nconsole.log(arr3); // false\n```\n\n## reduce() 和 reduceRight()\n\nreduce:对每个数组中的每个元素执行一个由您提供的reducer函数，将其结果汇总为单个返回值\n\n这两个都会实现迭代数组所有项，然后构建一个最终返回的值。reduce() 方法从数组的第一项开始，逐个遍历到最后，然而 reduceRight() 则是从数组的最后一项开始，向前遍历到第一项。下面代码实现了数组求和：\n\n```javascript\nvar values = [1, 2, 3, 4, 5];\nvar sum = values.reduceRight(function(prev, cur, index, array) {\n  return prev + cur;\n}, 10);\nconsole.log(sum); //25\n```\n\nreduce() 方法接收一个函数作为累加器。每个值（从左到右开始缩减），直到计算最后一个值。\n\nreduce() 作为空数组是不会执行回调函数的。\n\n```javascript\nvar numbers = [65, 44, 12, 4];\n\nfunction getSum(total, num) {\n  return total + num;\n}\nfunction myFunction(item) {\n  document.getElementById(\"demo\").innerHTML = numbers.reduce(getSum);\n}\n```","source":"_posts/数组操作方法.md","raw":"---\ntitle: 数组操作方法\ndate: 2017-11-1 16:52:42\ncategories: JavaScript\n---\n\n**数组原形方法有以下几种**:\n\n`join()`,`push()`,`pop()`,`sort()`,`reverse()`,`concat()`,`slice()`,`splice()`,`indexOf()`,`lastIndexOf()`,`forEach()`,`map()`, `filter()`,`every()`,`some()`,`reduce()`,`reduceRigh()`\n\n<!--more-->\n\n## join()，不改变原数组。\n\njoin(separator): 将数组的元素组成一个字符串，以 separator 为分隔符，省略则默认为逗号，该方法只接受一个参数。\n\n```javascript\nvar arr = [1, 2, 3];\nconsole.log(arr.join()); // 1,2,3\nconsole.log(arr.join(\"-\")); // 1-2-3\nconsole.log(arr); // [1, 2, 3]（原数组不变）\n```\n\n## push() 与 pop()，改变元素组\n\n* push(): 可以接受任意数量的数组，把它们，把他们逐个添加到数组末尾，**并返回修改后数组的长度**。\n* pop(): 数组末尾移除最后一项，减少数组的 length 的值，然后返回移除的项。\n\n```javascript\nvar arr = [\"Lily\", \"lucy\", \"Tom\"];\nvar count = arr.push(\"Jack\", \"Sean\");\nconsole.log(count); // 5\nconsole.log(arr); // [\"Lily\", \"lucy\", \"Tom\", \"Jack\", \"Sean\"]\nvar item = arr.pop();\nconsole.log(item); // Sean\nconsole.log(arr); // [\"Lily\", \"lucy\", \"Tom\", \"Jack\"]\n```\n\n## shift() 和 unshift()，改变原数组\n\n* shift(): 删除原数组的第一项，并返回删除元素的值，如果为空则返回 undefined。\n* unshift(): 将参数添加到原数组开头，**并返回数组的长度**。\n\n```javascript\nvar arr = [\"Lily\", \"lucy\", \"Tom\"];\nvar count = arr.unshift(\"Jack\", \"Sean\");\nconsole.log(count); // 5\nconsole.log(arr); //[\"Jack\", \"Sean\", \"Lily\", \"lucy\", \"Tom\"]\nvar item = arr.shift();\nconsole.log(item); // Jack\nconsole.log(arr); // [\"Sean\", \"Lily\", \"lucy\", \"Tom\"]\n```\n\n## sort(), 改变原数组\n\n按升序列排序数组系那个（从小到大），在排序时，sort() 方法会调用每个数组的 toString() 转型方法，**然后比较得到的字符串**，已确定如何排序。即使数组中每一个都是数值 ,sort() 方法比较的意识字符串，因此会出现以下情况：\n\n```javascript\nvar arr1 = [\"a\", \"d\", \"c\", \"b\"];\nconsole.log(arr1.sort()); // [\"a\", \"b\", \"c\", \"d\"]\narr2 = [13, 24, 51, 3];\nconsole.log(arr2.sort()); // [13, 24, 3, 51]\nconsole.log(arr2); // [13, 24, 3, 51](元数组被改变)\nvar scores = [1, 10, 21, 2];\nscores.sort(); // [1, 10, 2, 21] 注意10在2之前  因为在 Unicode 指针顺序中\"10\"在\"2\"之前\n```\n\n为了解决上述问题，sort() 方法可以接受一个参数，以便指定哪个值位于哪个值前面。比较函数接受两个参数，如果第一个参数应该位于第二个之前则返回一个负数，如果两个参数相等则返回 0，如果第一个参数应该位于第二个参数之后则返回一个正数。一下是比较函数：\n\n```javascript\nfunction compare(value1, value2) {\n  if (value1 < value2) {\n    return -1;\n  } else if (value1 > value2) {\n    return 1;\n  } else {\n    return 0;\n  }\n}\narr2 = [13, 24, 51, 3];\nconsole.log(arr2.sort(compare)); // [3, 13, 24, 51]\n```\n\n如果需要通过比较函数产生降序排序的结果，只要交换比较函数的返回值即可。\n\n## reverse() ，改变原数组\n\nreverse(): 反转数组项的顺序\n\n```javascript\nreverse()：反转数组项的顺序。\n?\n1\n2\n3\nvar arr = [13, 24, 51, 3];\nconsole.log(arr.reverse()); //[3, 51, 24, 13]\nconsole.log(arr); //[3, 51, 24, 13](原数组改变)\n```\n\n## concat()，不改变原数组\n\nconcat()：将参数添加到元素组中，这个方法会先创建当前数组的一个副本，然后将接受到的参数添加到这个副本的末尾，最后返回新构建的数组，**在没有给 concat() 方法传递一个参数的情况下，它只是复制当前数组并返回副本。**\n\n```javascript\nvar arr = [1, 3, 5, 7];\nvar arrCopy = arr.concat(9, [11, 13]);\nconsole.log(arrCopy); //[1, 3, 5, 7, 9, 11, 13]\nconsole.log(arr); // [1, 3, 5, 7](原数组未被修改)\n```\n\n上面的测试中发现，传入的不是数组，则是直接将数组添加到数组后面，**如果传入的是数组，则将数组中的各个项添加到数组中，但如果是二维数组呢？**\n\n```javascript\nvar arrCopy2 = arr.concat([9, [11, 13]]);\nconsole.log(arrCopy2); //[1, 3, 5, 7, 9, Array[2]]\nconsole.log(arrCopy2[5]); //[11, 13]\n```\n\n## slice() 不改变原数组\n\nslice(): 返回从原数组中指定开始下标到结束下标之间的项组成的新数组。slice() 方法可以接受一或是两个参数，即要返回项的起始和结束位置。在只有一个参数的情况下，slice() 方法返回从该参数指定位置到当前数组末尾的所有项。如果有两个参数，就会返回起始和结束位置之前的项 - 但不包括结束位置的项。\n\n```javascript\nvar arr = [1, 3, 5, 7, 9, 11];\nvar arrCopy = arr.slice(1);\nvar arrCopy2 = arr.slice(1, 4);\nvar arrCopy3 = arr.slice(1, -2);\nvar arrCopy4 = arr.slice(-4, -1);\nconsole.log(arr); //[1, 3, 5, 7, 9, 11](原数组没变)\nconsole.log(arrCopy); //[3, 5, 7, 9, 11]\nconsole.log(arrCopy2); //[3, 5, 7]\nconsole.log(arrCopy3); //[3, 5, 7]\nconsole.log(arrCopy4); //[5, 7, 9]\n```\n\n## splice() 可以实现删除、插入和替换 改变原数组\n\n* 删除：可以删除任意数量的项，只需要提供两个参数，要删除的个一个项的位置和要删除的橡树。例如，splice(0,2) 会删除数组中的前两项。\n* 插入：可以向指定位置插入任意数量的项，需要 3 个参数，起始位置、0 （要删除的项数）和要插入的项，例如 splice(2,0,4,6) 会在当前数组的位置 2 开始插入 4 和 6\n* 替换：可以向指定的位置插入任意的项，同时删除任意数量的项。需要 3 个参数，只需要指定 3 个参数，起始位置、要删除的项数和要插入的任意数量的项。插入的项数不必与删除的项数相等，例如 splice(2,1,4,6) 会删除当前数组位置 2 的项，然后再从位置 2 开始插入 4 和 6。\n\n```javascript\nvar arr = [1, 3, 5, 7, 9, 11];\nvar arrRemoved = arr.splice(0, 2);\nconsole.log(arr); //[5, 7, 9, 11]\nconsole.log(arrRemoved); //[1, 3]\nvar arrRemoved2 = arr.splice(2, 0, 4, 6);\nconsole.log(arr); // [5, 7, 4, 6, 9, 11]\nconsole.log(arrRemoved2); // []\nvar arrRemoved3 = arr.splice(1, 1, 2, 4);\nconsole.log(arr); // [5, 2, 4, 4, 6, 9, 11]\nconsole.log(arrRemoved3); //[7]\n```\n\n## indexOf() 和 lastIndexOf()\n\n* indexOf()：接受两个参数，要查找的项和（可选的）表示查找七点位置的索引。从数组的开头开始查找。\n* lastIndexOf() ：接受两个参数：要查找的项和（可选的）表示查找起点位置的索引。从数组的末尾开始查找\n\n```javascript\nvar arr = [1, 3, 5, 7, 7, 5, 3, 1];\nconsole.log(arr.indexOf(5)); //2\nconsole.log(arr.lastIndexOf(5)); //5\nconsole.log(arr.indexOf(5, 2)); //2\nconsole.log(arr.lastIndexOf(5, 4)); //2\nconsole.log(arr.indexOf(\"5\")); //-1\n```\n\n## forEach() 遍历\n\n对数组进行遍历循环遍历，对数组的每一项运行给定函数，这个方法没有返回值，参数都是 function 类型，默认参数分别有：遍历数组内容、对应的数组索引、数组本身。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5];\narr.forEach(function(x, index, a) {\n  console.log(x + \"|\" + index + \"|\" + (a === arr));\n});\n// 输出为：\n// 1|0|true\n// 2|1|true\n// 3|2|true\n// 4|3|true\n// 5|4|true\n```\n\n## map()\n\nmap() ：指 “ 映射 ”，对数组中的每一项运行给定函数，返回每一次函数调用的结果组成的数组。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5];\nvar arr2 = arr.map(function(item) {\n  return item * item;\n});\nconsole.log(arr2); //[1, 4, 9, 16, 25]\n```\n\n## filter()\n\nfilter(): “ 过滤功能 ”，数组中的每一项运行给定函数，返回满足过滤条件组成的数组。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\nvar arr2 = arr.filter(function(x, index) {\nreturn index % 3 === 0 || x >= 8;\n});\nconsole.log(arr2); //[1, 4, 7, 8, 9, 10]\n```\n\n## every()\n\nevery() ，判断数组中每一项都是满足条件，只有所有项都满足条件才会返回 true。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5];\nvar arr2 = arr.every(function(x) {\n  return x < 10;\n});\nconsole.log(arr2); //true\nvar arr3 = arr.every(function(x) {\n  return x < 3;\n});\nconsole.log(arr3); // false\n```\n\n## some()\n\nsome() ：判断数组中是否存在满足条件的项，只要有一项满足，就会返回 true。\n\n```javascript\nvar arr = [1, 2, 3, 4, 5];\nvar arr2 = arr.some(function(x) {\n  return x < 3;\n});\nconsole.log(arr2); //true\nvar arr3 = arr.some(function(x) {\n  return x < 1;\n});\nconsole.log(arr3); // false\n```\n\n## reduce() 和 reduceRight()\n\nreduce:对每个数组中的每个元素执行一个由您提供的reducer函数，将其结果汇总为单个返回值\n\n这两个都会实现迭代数组所有项，然后构建一个最终返回的值。reduce() 方法从数组的第一项开始，逐个遍历到最后，然而 reduceRight() 则是从数组的最后一项开始，向前遍历到第一项。下面代码实现了数组求和：\n\n```javascript\nvar values = [1, 2, 3, 4, 5];\nvar sum = values.reduceRight(function(prev, cur, index, array) {\n  return prev + cur;\n}, 10);\nconsole.log(sum); //25\n```\n\nreduce() 方法接收一个函数作为累加器。每个值（从左到右开始缩减），直到计算最后一个值。\n\nreduce() 作为空数组是不会执行回调函数的。\n\n```javascript\nvar numbers = [65, 44, 12, 4];\n\nfunction getSum(total, num) {\n  return total + num;\n}\nfunction myFunction(item) {\n  document.getElementById(\"demo\").innerHTML = numbers.reduce(getSum);\n}\n```","slug":"数组操作方法","published":1,"updated":"2021-04-03T07:41:44.889Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xf002ol5v0hasrfg1z","content":"<p><strong>数组原形方法有以下几种</strong>:</p>\n<p><code>join()</code>,<code>push()</code>,<code>pop()</code>,<code>sort()</code>,<code>reverse()</code>,<code>concat()</code>,<code>slice()</code>,<code>splice()</code>,<code>indexOf()</code>,<code>lastIndexOf()</code>,<code>forEach()</code>,<code>map()</code>, <code>filter()</code>,<code>every()</code>,<code>some()</code>,<code>reduce()</code>,<code>reduceRigh()</code></p>\n<span id=\"more\"></span>\n\n<h2 id=\"join-，不改变原数组。\"><a href=\"#join-，不改变原数组。\" class=\"headerlink\" title=\"join()，不改变原数组。\"></a>join()，不改变原数组。</h2><p>join(separator): 将数组的元素组成一个字符串，以 separator 为分隔符，省略则默认为逗号，该方法只接受一个参数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.join()); <span class=\"comment\">// 1,2,3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.join(<span class=\"string\">&quot;-&quot;</span>)); <span class=\"comment\">// 1-2-3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [1, 2, 3]（原数组不变）</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"push-与-pop-，改变元素组\"><a href=\"#push-与-pop-，改变元素组\" class=\"headerlink\" title=\"push() 与 pop()，改变元素组\"></a>push() 与 pop()，改变元素组</h2><ul>\n<li>push(): 可以接受任意数量的数组，把它们，把他们逐个添加到数组末尾，<strong>并返回修改后数组的长度</strong>。</li>\n<li>pop(): 数组末尾移除最后一项，减少数组的 length 的值，然后返回移除的项。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"string\">&quot;Lily&quot;</span>, <span class=\"string\">&quot;lucy&quot;</span>, <span class=\"string\">&quot;Tom&quot;</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> count = arr.push(<span class=\"string\">&quot;Jack&quot;</span>, <span class=\"string\">&quot;Sean&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(count); <span class=\"comment\">// 5</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [&quot;Lily&quot;, &quot;lucy&quot;, &quot;Tom&quot;, &quot;Jack&quot;, &quot;Sean&quot;]</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> item = arr.pop();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(item); <span class=\"comment\">// Sean</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [&quot;Lily&quot;, &quot;lucy&quot;, &quot;Tom&quot;, &quot;Jack&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"shift-和-unshift-，改变原数组\"><a href=\"#shift-和-unshift-，改变原数组\" class=\"headerlink\" title=\"shift() 和 unshift()，改变原数组\"></a>shift() 和 unshift()，改变原数组</h2><ul>\n<li>shift(): 删除原数组的第一项，并返回删除元素的值，如果为空则返回 undefined。</li>\n<li>unshift(): 将参数添加到原数组开头，<strong>并返回数组的长度</strong>。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"string\">&quot;Lily&quot;</span>, <span class=\"string\">&quot;lucy&quot;</span>, <span class=\"string\">&quot;Tom&quot;</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> count = arr.unshift(<span class=\"string\">&quot;Jack&quot;</span>, <span class=\"string\">&quot;Sean&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(count); <span class=\"comment\">// 5</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">//[&quot;Jack&quot;, &quot;Sean&quot;, &quot;Lily&quot;, &quot;lucy&quot;, &quot;Tom&quot;]</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> item = arr.shift();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(item); <span class=\"comment\">// Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [&quot;Sean&quot;, &quot;Lily&quot;, &quot;lucy&quot;, &quot;Tom&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"sort-改变原数组\"><a href=\"#sort-改变原数组\" class=\"headerlink\" title=\"sort(), 改变原数组\"></a>sort(), 改变原数组</h2><p>按升序列排序数组系那个（从小到大），在排序时，sort() 方法会调用每个数组的 toString() 转型方法，<strong>然后比较得到的字符串</strong>，已确定如何排序。即使数组中每一个都是数值 ,sort() 方法比较的意识字符串，因此会出现以下情况：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr1 = [<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;b&quot;</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr1.sort()); <span class=\"comment\">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</span></span><br><span class=\"line\">arr2 = [<span class=\"number\">13</span>, <span class=\"number\">24</span>, <span class=\"number\">51</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2.sort()); <span class=\"comment\">// [13, 24, 3, 51]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">// [13, 24, 3, 51](元数组被改变)</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> scores = [<span class=\"number\">1</span>, <span class=\"number\">10</span>, <span class=\"number\">21</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">scores.sort(); <span class=\"comment\">// [1, 10, 2, 21] 注意10在2之前  因为在 Unicode 指针顺序中&quot;10&quot;在&quot;2&quot;之前</span></span><br></pre></td></tr></table></figure>\n\n<p>为了解决上述问题，sort() 方法可以接受一个参数，以便指定哪个值位于哪个值前面。比较函数接受两个参数，如果第一个参数应该位于第二个之前则返回一个负数，如果两个参数相等则返回 0，如果第一个参数应该位于第二个参数之后则返回一个正数。一下是比较函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">compare</span>(<span class=\"params\">value1, value2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (value1 &lt; value2) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (value1 &gt; value2) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">arr2 = [<span class=\"number\">13</span>, <span class=\"number\">24</span>, <span class=\"number\">51</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2.sort(compare)); <span class=\"comment\">// [3, 13, 24, 51]</span></span><br></pre></td></tr></table></figure>\n\n<p>如果需要通过比较函数产生降序排序的结果，只要交换比较函数的返回值即可。</p>\n<h2 id=\"reverse-，改变原数组\"><a href=\"#reverse-，改变原数组\" class=\"headerlink\" title=\"reverse() ，改变原数组\"></a>reverse() ，改变原数组</h2><p>reverse(): 反转数组项的顺序</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reverse()：反转数组项的顺序。</span><br><span class=\"line\">?</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">13</span>, <span class=\"number\">24</span>, <span class=\"number\">51</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.reverse()); <span class=\"comment\">//[3, 51, 24, 13]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">//[3, 51, 24, 13](原数组改变)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"concat-，不改变原数组\"><a href=\"#concat-，不改变原数组\" class=\"headerlink\" title=\"concat()，不改变原数组\"></a>concat()，不改变原数组</h2><p>concat()：将参数添加到元素组中，这个方法会先创建当前数组的一个副本，然后将接受到的参数添加到这个副本的末尾，最后返回新构建的数组，<strong>在没有给 concat() 方法传递一个参数的情况下，它只是复制当前数组并返回副本。</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy = arr.concat(<span class=\"number\">9</span>, [<span class=\"number\">11</span>, <span class=\"number\">13</span>]);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy); <span class=\"comment\">//[1, 3, 5, 7, 9, 11, 13]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [1, 3, 5, 7](原数组未被修改)</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的测试中发现，传入的不是数组，则是直接将数组添加到数组后面，<strong>如果传入的是数组，则将数组中的各个项添加到数组中，但如果是二维数组呢？</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arrCopy2 = arr.concat([<span class=\"number\">9</span>, [<span class=\"number\">11</span>, <span class=\"number\">13</span>]]);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy2); <span class=\"comment\">//[1, 3, 5, 7, 9, Array[2]]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy2[<span class=\"number\">5</span>]); <span class=\"comment\">//[11, 13]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"slice-不改变原数组\"><a href=\"#slice-不改变原数组\" class=\"headerlink\" title=\"slice() 不改变原数组\"></a>slice() 不改变原数组</h2><p>slice(): 返回从原数组中指定开始下标到结束下标之间的项组成的新数组。slice() 方法可以接受一或是两个参数，即要返回项的起始和结束位置。在只有一个参数的情况下，slice() 方法返回从该参数指定位置到当前数组末尾的所有项。如果有两个参数，就会返回起始和结束位置之前的项 - 但不包括结束位置的项。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">11</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy = arr.slice(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy2 = arr.slice(<span class=\"number\">1</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy3 = arr.slice(<span class=\"number\">1</span>, -<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy4 = arr.slice(-<span class=\"number\">4</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">//[1, 3, 5, 7, 9, 11](原数组没变)</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy); <span class=\"comment\">//[3, 5, 7, 9, 11]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy2); <span class=\"comment\">//[3, 5, 7]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy3); <span class=\"comment\">//[3, 5, 7]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy4); <span class=\"comment\">//[5, 7, 9]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"splice-可以实现删除、插入和替换-改变原数组\"><a href=\"#splice-可以实现删除、插入和替换-改变原数组\" class=\"headerlink\" title=\"splice() 可以实现删除、插入和替换 改变原数组\"></a>splice() 可以实现删除、插入和替换 改变原数组</h2><ul>\n<li>删除：可以删除任意数量的项，只需要提供两个参数，要删除的个一个项的位置和要删除的橡树。例如，splice(0,2) 会删除数组中的前两项。</li>\n<li>插入：可以向指定位置插入任意数量的项，需要 3 个参数，起始位置、0 （要删除的项数）和要插入的项，例如 splice(2,0,4,6) 会在当前数组的位置 2 开始插入 4 和 6</li>\n<li>替换：可以向指定的位置插入任意的项，同时删除任意数量的项。需要 3 个参数，只需要指定 3 个参数，起始位置、要删除的项数和要插入的任意数量的项。插入的项数不必与删除的项数相等，例如 splice(2,1,4,6) 会删除当前数组位置 2 的项，然后再从位置 2 开始插入 4 和 6。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">11</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrRemoved = arr.splice(<span class=\"number\">0</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">//[5, 7, 9, 11]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrRemoved); <span class=\"comment\">//[1, 3]</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrRemoved2 = arr.splice(<span class=\"number\">2</span>, <span class=\"number\">0</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [5, 7, 4, 6, 9, 11]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrRemoved2); <span class=\"comment\">// []</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrRemoved3 = arr.splice(<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [5, 2, 4, 4, 6, 9, 11]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrRemoved3); <span class=\"comment\">//[7]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"indexOf-和-lastIndexOf\"><a href=\"#indexOf-和-lastIndexOf\" class=\"headerlink\" title=\"indexOf() 和 lastIndexOf()\"></a>indexOf() 和 lastIndexOf()</h2><ul>\n<li>indexOf()：接受两个参数，要查找的项和（可选的）表示查找七点位置的索引。从数组的开头开始查找。</li>\n<li>lastIndexOf() ：接受两个参数：要查找的项和（可选的）表示查找起点位置的索引。从数组的末尾开始查找</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">7</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"number\">5</span>)); <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.lastIndexOf(<span class=\"number\">5</span>)); <span class=\"comment\">//5</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"number\">5</span>, <span class=\"number\">2</span>)); <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.lastIndexOf(<span class=\"number\">5</span>, <span class=\"number\">4</span>)); <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"string\">&quot;5&quot;</span>)); <span class=\"comment\">//-1</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"forEach-遍历\"><a href=\"#forEach-遍历\" class=\"headerlink\" title=\"forEach() 遍历\"></a>forEach() 遍历</h2><p>对数组进行遍历循环遍历，对数组的每一项运行给定函数，这个方法没有返回值，参数都是 function 类型，默认参数分别有：遍历数组内容、对应的数组索引、数组本身。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\">arr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, index, a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x + <span class=\"string\">&quot;|&quot;</span> + index + <span class=\"string\">&quot;|&quot;</span> + (a === arr));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 输出为：</span></span><br><span class=\"line\"><span class=\"comment\">// 1|0|true</span></span><br><span class=\"line\"><span class=\"comment\">// 2|1|true</span></span><br><span class=\"line\"><span class=\"comment\">// 3|2|true</span></span><br><span class=\"line\"><span class=\"comment\">// 4|3|true</span></span><br><span class=\"line\"><span class=\"comment\">// 5|4|true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map()\"></a>map()</h2><p>map() ：指 “ 映射 ”，对数组中的每一项运行给定函数，返回每一次函数调用的结果组成的数组。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = arr.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item * item;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">//[1, 4, 9, 16, 25]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter()\"></a>filter()</h2><p>filter(): “ 过滤功能 ”，数组中的每一项运行给定函数，返回满足过滤条件组成的数组。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = arr.filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, index</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">return</span> index % <span class=\"number\">3</span> === <span class=\"number\">0</span> || x &gt;= <span class=\"number\">8</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">//[1, 4, 7, 8, 9, 10]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"every\"><a href=\"#every\" class=\"headerlink\" title=\"every()\"></a>every()</h2><p>every() ，判断数组中每一项都是满足条件，只有所有项都满足条件才会返回 true。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = arr.every(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x &lt; <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = arr.every(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x &lt; <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr3); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"some\"><a href=\"#some\" class=\"headerlink\" title=\"some()\"></a>some()</h2><p>some() ：判断数组中是否存在满足条件的项，只要有一项满足，就会返回 true。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = arr.some(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x &lt; <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = arr.some(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x &lt; <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr3); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"reduce-和-reduceRight\"><a href=\"#reduce-和-reduceRight\" class=\"headerlink\" title=\"reduce() 和 reduceRight()\"></a>reduce() 和 reduceRight()</h2><p>reduce:对每个数组中的每个元素执行一个由您提供的reducer函数，将其结果汇总为单个返回值</p>\n<p>这两个都会实现迭代数组所有项，然后构建一个最终返回的值。reduce() 方法从数组的第一项开始，逐个遍历到最后，然而 reduceRight() 则是从数组的最后一项开始，向前遍历到第一项。下面代码实现了数组求和：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> values = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> sum = values.reduceRight(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prev, cur, index, array</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> prev + cur;</span><br><span class=\"line\">&#125;, <span class=\"number\">10</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(sum); <span class=\"comment\">//25</span></span><br></pre></td></tr></table></figure>\n\n<p>reduce() 方法接收一个函数作为累加器。每个值（从左到右开始缩减），直到计算最后一个值。</p>\n<p>reduce() 作为空数组是不会执行回调函数的。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> numbers = [<span class=\"number\">65</span>, <span class=\"number\">44</span>, <span class=\"number\">12</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getSum</span>(<span class=\"params\">total, num</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> total + num;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunction</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;demo&quot;</span>).innerHTML = numbers.reduce(getSum);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p><strong>数组原形方法有以下几种</strong>:</p>\n<p><code>join()</code>,<code>push()</code>,<code>pop()</code>,<code>sort()</code>,<code>reverse()</code>,<code>concat()</code>,<code>slice()</code>,<code>splice()</code>,<code>indexOf()</code>,<code>lastIndexOf()</code>,<code>forEach()</code>,<code>map()</code>, <code>filter()</code>,<code>every()</code>,<code>some()</code>,<code>reduce()</code>,<code>reduceRigh()</code></p>","more":"<h2 id=\"join-，不改变原数组。\"><a href=\"#join-，不改变原数组。\" class=\"headerlink\" title=\"join()，不改变原数组。\"></a>join()，不改变原数组。</h2><p>join(separator): 将数组的元素组成一个字符串，以 separator 为分隔符，省略则默认为逗号，该方法只接受一个参数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.join()); <span class=\"comment\">// 1,2,3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.join(<span class=\"string\">&quot;-&quot;</span>)); <span class=\"comment\">// 1-2-3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [1, 2, 3]（原数组不变）</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"push-与-pop-，改变元素组\"><a href=\"#push-与-pop-，改变元素组\" class=\"headerlink\" title=\"push() 与 pop()，改变元素组\"></a>push() 与 pop()，改变元素组</h2><ul>\n<li>push(): 可以接受任意数量的数组，把它们，把他们逐个添加到数组末尾，<strong>并返回修改后数组的长度</strong>。</li>\n<li>pop(): 数组末尾移除最后一项，减少数组的 length 的值，然后返回移除的项。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"string\">&quot;Lily&quot;</span>, <span class=\"string\">&quot;lucy&quot;</span>, <span class=\"string\">&quot;Tom&quot;</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> count = arr.push(<span class=\"string\">&quot;Jack&quot;</span>, <span class=\"string\">&quot;Sean&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(count); <span class=\"comment\">// 5</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [&quot;Lily&quot;, &quot;lucy&quot;, &quot;Tom&quot;, &quot;Jack&quot;, &quot;Sean&quot;]</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> item = arr.pop();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(item); <span class=\"comment\">// Sean</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [&quot;Lily&quot;, &quot;lucy&quot;, &quot;Tom&quot;, &quot;Jack&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"shift-和-unshift-，改变原数组\"><a href=\"#shift-和-unshift-，改变原数组\" class=\"headerlink\" title=\"shift() 和 unshift()，改变原数组\"></a>shift() 和 unshift()，改变原数组</h2><ul>\n<li>shift(): 删除原数组的第一项，并返回删除元素的值，如果为空则返回 undefined。</li>\n<li>unshift(): 将参数添加到原数组开头，<strong>并返回数组的长度</strong>。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"string\">&quot;Lily&quot;</span>, <span class=\"string\">&quot;lucy&quot;</span>, <span class=\"string\">&quot;Tom&quot;</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> count = arr.unshift(<span class=\"string\">&quot;Jack&quot;</span>, <span class=\"string\">&quot;Sean&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(count); <span class=\"comment\">// 5</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">//[&quot;Jack&quot;, &quot;Sean&quot;, &quot;Lily&quot;, &quot;lucy&quot;, &quot;Tom&quot;]</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> item = arr.shift();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(item); <span class=\"comment\">// Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [&quot;Sean&quot;, &quot;Lily&quot;, &quot;lucy&quot;, &quot;Tom&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"sort-改变原数组\"><a href=\"#sort-改变原数组\" class=\"headerlink\" title=\"sort(), 改变原数组\"></a>sort(), 改变原数组</h2><p>按升序列排序数组系那个（从小到大），在排序时，sort() 方法会调用每个数组的 toString() 转型方法，<strong>然后比较得到的字符串</strong>，已确定如何排序。即使数组中每一个都是数值 ,sort() 方法比较的意识字符串，因此会出现以下情况：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr1 = [<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;b&quot;</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr1.sort()); <span class=\"comment\">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</span></span><br><span class=\"line\">arr2 = [<span class=\"number\">13</span>, <span class=\"number\">24</span>, <span class=\"number\">51</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2.sort()); <span class=\"comment\">// [13, 24, 3, 51]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">// [13, 24, 3, 51](元数组被改变)</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> scores = [<span class=\"number\">1</span>, <span class=\"number\">10</span>, <span class=\"number\">21</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">scores.sort(); <span class=\"comment\">// [1, 10, 2, 21] 注意10在2之前  因为在 Unicode 指针顺序中&quot;10&quot;在&quot;2&quot;之前</span></span><br></pre></td></tr></table></figure>\n\n<p>为了解决上述问题，sort() 方法可以接受一个参数，以便指定哪个值位于哪个值前面。比较函数接受两个参数，如果第一个参数应该位于第二个之前则返回一个负数，如果两个参数相等则返回 0，如果第一个参数应该位于第二个参数之后则返回一个正数。一下是比较函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">compare</span>(<span class=\"params\">value1, value2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (value1 &lt; value2) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (value1 &gt; value2) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">arr2 = [<span class=\"number\">13</span>, <span class=\"number\">24</span>, <span class=\"number\">51</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2.sort(compare)); <span class=\"comment\">// [3, 13, 24, 51]</span></span><br></pre></td></tr></table></figure>\n\n<p>如果需要通过比较函数产生降序排序的结果，只要交换比较函数的返回值即可。</p>\n<h2 id=\"reverse-，改变原数组\"><a href=\"#reverse-，改变原数组\" class=\"headerlink\" title=\"reverse() ，改变原数组\"></a>reverse() ，改变原数组</h2><p>reverse(): 反转数组项的顺序</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reverse()：反转数组项的顺序。</span><br><span class=\"line\">?</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">13</span>, <span class=\"number\">24</span>, <span class=\"number\">51</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.reverse()); <span class=\"comment\">//[3, 51, 24, 13]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">//[3, 51, 24, 13](原数组改变)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"concat-，不改变原数组\"><a href=\"#concat-，不改变原数组\" class=\"headerlink\" title=\"concat()，不改变原数组\"></a>concat()，不改变原数组</h2><p>concat()：将参数添加到元素组中，这个方法会先创建当前数组的一个副本，然后将接受到的参数添加到这个副本的末尾，最后返回新构建的数组，<strong>在没有给 concat() 方法传递一个参数的情况下，它只是复制当前数组并返回副本。</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy = arr.concat(<span class=\"number\">9</span>, [<span class=\"number\">11</span>, <span class=\"number\">13</span>]);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy); <span class=\"comment\">//[1, 3, 5, 7, 9, 11, 13]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [1, 3, 5, 7](原数组未被修改)</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的测试中发现，传入的不是数组，则是直接将数组添加到数组后面，<strong>如果传入的是数组，则将数组中的各个项添加到数组中，但如果是二维数组呢？</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arrCopy2 = arr.concat([<span class=\"number\">9</span>, [<span class=\"number\">11</span>, <span class=\"number\">13</span>]]);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy2); <span class=\"comment\">//[1, 3, 5, 7, 9, Array[2]]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy2[<span class=\"number\">5</span>]); <span class=\"comment\">//[11, 13]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"slice-不改变原数组\"><a href=\"#slice-不改变原数组\" class=\"headerlink\" title=\"slice() 不改变原数组\"></a>slice() 不改变原数组</h2><p>slice(): 返回从原数组中指定开始下标到结束下标之间的项组成的新数组。slice() 方法可以接受一或是两个参数，即要返回项的起始和结束位置。在只有一个参数的情况下，slice() 方法返回从该参数指定位置到当前数组末尾的所有项。如果有两个参数，就会返回起始和结束位置之前的项 - 但不包括结束位置的项。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">11</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy = arr.slice(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy2 = arr.slice(<span class=\"number\">1</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy3 = arr.slice(<span class=\"number\">1</span>, -<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrCopy4 = arr.slice(-<span class=\"number\">4</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">//[1, 3, 5, 7, 9, 11](原数组没变)</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy); <span class=\"comment\">//[3, 5, 7, 9, 11]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy2); <span class=\"comment\">//[3, 5, 7]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy3); <span class=\"comment\">//[3, 5, 7]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrCopy4); <span class=\"comment\">//[5, 7, 9]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"splice-可以实现删除、插入和替换-改变原数组\"><a href=\"#splice-可以实现删除、插入和替换-改变原数组\" class=\"headerlink\" title=\"splice() 可以实现删除、插入和替换 改变原数组\"></a>splice() 可以实现删除、插入和替换 改变原数组</h2><ul>\n<li>删除：可以删除任意数量的项，只需要提供两个参数，要删除的个一个项的位置和要删除的橡树。例如，splice(0,2) 会删除数组中的前两项。</li>\n<li>插入：可以向指定位置插入任意数量的项，需要 3 个参数，起始位置、0 （要删除的项数）和要插入的项，例如 splice(2,0,4,6) 会在当前数组的位置 2 开始插入 4 和 6</li>\n<li>替换：可以向指定的位置插入任意的项，同时删除任意数量的项。需要 3 个参数，只需要指定 3 个参数，起始位置、要删除的项数和要插入的任意数量的项。插入的项数不必与删除的项数相等，例如 splice(2,1,4,6) 会删除当前数组位置 2 的项，然后再从位置 2 开始插入 4 和 6。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">11</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arrRemoved = arr.splice(<span class=\"number\">0</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">//[5, 7, 9, 11]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrRemoved); <span class=\"comment\">//[1, 3]</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrRemoved2 = arr.splice(<span class=\"number\">2</span>, <span class=\"number\">0</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [5, 7, 4, 6, 9, 11]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrRemoved2); <span class=\"comment\">// []</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrRemoved3 = arr.splice(<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [5, 2, 4, 4, 6, 9, 11]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arrRemoved3); <span class=\"comment\">//[7]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"indexOf-和-lastIndexOf\"><a href=\"#indexOf-和-lastIndexOf\" class=\"headerlink\" title=\"indexOf() 和 lastIndexOf()\"></a>indexOf() 和 lastIndexOf()</h2><ul>\n<li>indexOf()：接受两个参数，要查找的项和（可选的）表示查找七点位置的索引。从数组的开头开始查找。</li>\n<li>lastIndexOf() ：接受两个参数：要查找的项和（可选的）表示查找起点位置的索引。从数组的末尾开始查找</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">7</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"number\">5</span>)); <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.lastIndexOf(<span class=\"number\">5</span>)); <span class=\"comment\">//5</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"number\">5</span>, <span class=\"number\">2</span>)); <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.lastIndexOf(<span class=\"number\">5</span>, <span class=\"number\">4</span>)); <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"string\">&quot;5&quot;</span>)); <span class=\"comment\">//-1</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"forEach-遍历\"><a href=\"#forEach-遍历\" class=\"headerlink\" title=\"forEach() 遍历\"></a>forEach() 遍历</h2><p>对数组进行遍历循环遍历，对数组的每一项运行给定函数，这个方法没有返回值，参数都是 function 类型，默认参数分别有：遍历数组内容、对应的数组索引、数组本身。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\">arr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, index, a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x + <span class=\"string\">&quot;|&quot;</span> + index + <span class=\"string\">&quot;|&quot;</span> + (a === arr));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 输出为：</span></span><br><span class=\"line\"><span class=\"comment\">// 1|0|true</span></span><br><span class=\"line\"><span class=\"comment\">// 2|1|true</span></span><br><span class=\"line\"><span class=\"comment\">// 3|2|true</span></span><br><span class=\"line\"><span class=\"comment\">// 4|3|true</span></span><br><span class=\"line\"><span class=\"comment\">// 5|4|true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map()\"></a>map()</h2><p>map() ：指 “ 映射 ”，对数组中的每一项运行给定函数，返回每一次函数调用的结果组成的数组。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = arr.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item * item;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">//[1, 4, 9, 16, 25]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter()\"></a>filter()</h2><p>filter(): “ 过滤功能 ”，数组中的每一项运行给定函数，返回满足过滤条件组成的数组。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = arr.filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x, index</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">return</span> index % <span class=\"number\">3</span> === <span class=\"number\">0</span> || x &gt;= <span class=\"number\">8</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">//[1, 4, 7, 8, 9, 10]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"every\"><a href=\"#every\" class=\"headerlink\" title=\"every()\"></a>every()</h2><p>every() ，判断数组中每一项都是满足条件，只有所有项都满足条件才会返回 true。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = arr.every(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x &lt; <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = arr.every(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x &lt; <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr3); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"some\"><a href=\"#some\" class=\"headerlink\" title=\"some()\"></a>some()</h2><p>some() ：判断数组中是否存在满足条件的项，只要有一项满足，就会返回 true。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = arr.some(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x &lt; <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr2); <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = arr.some(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x &lt; <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr3); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"reduce-和-reduceRight\"><a href=\"#reduce-和-reduceRight\" class=\"headerlink\" title=\"reduce() 和 reduceRight()\"></a>reduce() 和 reduceRight()</h2><p>reduce:对每个数组中的每个元素执行一个由您提供的reducer函数，将其结果汇总为单个返回值</p>\n<p>这两个都会实现迭代数组所有项，然后构建一个最终返回的值。reduce() 方法从数组的第一项开始，逐个遍历到最后，然而 reduceRight() 则是从数组的最后一项开始，向前遍历到第一项。下面代码实现了数组求和：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> values = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> sum = values.reduceRight(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prev, cur, index, array</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> prev + cur;</span><br><span class=\"line\">&#125;, <span class=\"number\">10</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(sum); <span class=\"comment\">//25</span></span><br></pre></td></tr></table></figure>\n\n<p>reduce() 方法接收一个函数作为累加器。每个值（从左到右开始缩减），直到计算最后一个值。</p>\n<p>reduce() 作为空数组是不会执行回调函数的。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> numbers = [<span class=\"number\">65</span>, <span class=\"number\">44</span>, <span class=\"number\">12</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getSum</span>(<span class=\"params\">total, num</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> total + num;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunction</span>(<span class=\"params\">item</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;demo&quot;</span>).innerHTML = numbers.reduce(getSum);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"有趣JS题","date":"2018-03-08T07:57:30.000Z","_content":"\n一些出乎意料的题及面试题的积累\n\n<!--more-->\n\n## 变量提升\n\n```javascript\nif (!\"abc\" in window) {\n    var abc = 10;\n}\nconsole.log(abc); //undefined\n//因为先变量声明提升 所以提升之后abc的值系统默认会赋值为undefined。 !abc为false ,in是检查对象中是否存在某个属性。很显然 false属于是一个布尔类型。不存在对象中。所以没有走if里面的变量赋值。\n\nconsole.log(a); //undefined\nif (!(\"a\" in window)) {\n    var a = 10;\n}\nconsole.log(a); //undefined\n//因为先变量声明提升 所以提升之后a的值系统默认会赋值为undefined。 变量提升会存在GO中也就是window。所以(\"a\" in window)肯定为true。!去反一下就为false。所以不走赋值。\n\nvar x = 1;\nif (function f() {}) {\n    x += typeof f;\n}\nconsole.log(x); //1undefined\n//因为函数题在()中会以表达式去运行。最后转换为true,不会存在函数整体声明提升。所以typeof为undefined\n```\n\n## 闭包\n\n```javascript\nfor (var i = 0; i < liListlength; i++) {\n    var ele = document.querySelectorAll(\"ul > li\")[i];\n    ele.addEventListener(\n        \"click\",\n        (function(i) {\n            return function() {\n                console.log(\"index is :\" + i);\n            };\n        })(i)\n    );\n}\n```\n\n```javascript\nfunction fun(n, o) {\n    console.log(o);\n    return {\n        fun: function(m) {\n            return fun(m, n);\n        }\n    };\n}\nvar a = fun(0);\na.fun(1);\na.fun(2);\na.fun(3); //输出什么 undefined 0 0 0\nvar b = fun(0)\n    .fun(1)\n    .fun(2)\n    .fun(3); //输出什么 undefined 0 1 2\nvar c = fun(0).fun(1);\nc.fun(2);\nc.fun(3); //输出什么 undefined 0 1 1\n\n//答案很显而易见。换一个形式看着道题\n\nfunction fun(n, o) {\n    console.log(o);\n    return {\n        fun: function(m) {\n            return fun(m, n);\n        }\n    };\n}\nvar a = fun(0);\na.fun(1);\na.fun(2);\na.fun(3); //输出什么 undefined 0 0 0\n```\n\n## 综合(1)\n\n```javascript\nfunction Foo() {\n    getName = function() {\n        alert(1);\n    };\n    return this;\n}\n\nFoo.getName = function() {\n    alert(2);\n};\nFoo.prototype.getName = function() {\n    alert(3);\n};\nvar getName = function() {\n    alert(4);\n};\nfunction getName() {\n    alert(5);\n}\n\n//请写出以下输出结果,先写以下SB作者的答案，然后接受残酷的事实\nFoo.getName(); //alert(2);\ngetName(); //alert(5);\nFoo().getName(); //alert(5);\ngetName(); //alert(5);\nnew Foo.getName(); //function(){alert(2);}\nnew Foo().getName(); //function getName {alert{5}}\nnew new Foo.getName()(); //function(){alert(2);}\n```\n\n首先定义了一个叫 Foo 的函数，然后为 Foo 创建了一个叫 getName 的静态属性存储了一个匿名函数，之后为 Foo 的原型对象创建了一个叫 getName 的匿名函数。之后又通过函数变量表达式创建了一个 getName 的函数，最后声明一个叫做 getName 函数。\n\n### Foo.getName();\n\n**答案： 2**\n\nFoo.getName()访问的 Foo 函数上存储的静态属性\n\n```javascript\nfunction User(name) {\n    var name = name; //私有属性\n    this.name = name; //公有属性\n    function getName() {\n        //私有方法\n        return name;\n    }\n}\n\nUser.prototype.getName = function() {\n    //公有方法\n    return this.name;\n};\n\nUser.name = \"Wscats\"; //静态属性\nUser.getName = function() {\n    //静态方法\n    return this.name;\n};\nvar Wscat = new User(\"Wscats\"); //实例化\n```\n\n注意以下几点：\n\n-   调用公有方法，公有属性，我们必须要实例化对象，也就是用 new 操作符实例化对象，就可构造函数实例化对象的方法和属性，并且公有方法是不能调用私有方法和静态方法的。\n-   静态方法和静态属性就是我们无需实例化就可以调用。\n-   而对象的私有方法和属性，外部是不可以访问的。\n\n### getName()\n\n**答案是 4**\n\n直接调用 getName 函数。既然是直接调用，那么就是访问当前作用域内的 getName 的函数，所以这里应该是 4 或者 5.这里的坑有，一是变量声明提升，而是函数表达式和函数声明的区别。答案是 4，5 的函数声明被 4 的函数表达式覆盖了。\n\n#### 函数声明与函数表达式\n\n```javascript\n\n  getName()\n  //oaoaafly 函数被提升 这里受函数声明的影响，虽然函数声在最后但可以被提升到最前面了 而此时的函数表达式还没有被赋值（赋值是顺序执行）。\n\n  var getName = function(){\n    console.log('wscat');\n  }\n//函数表达式此时才开始覆盖函数声明的定义。\n\n  getName()//wscat\n\n  funtion getName(){\n    console.log('oaoafly');\n  }\n  getName()//wscat 这里就执行函数表达式的值\n```\n\n-   **JS 解释器中存在一种变量被提升的机制，也就是说函数声明会被提升到作用域的最前面，即使写在代码的最后面，也会被提升到最前面。**\n\n-   **而用函数表达式创建的函数是在运行时被赋值，且要等到表达式赋值完成后才能调用。**\n\n### Foo().getName()\n\n**答案是：1**\n\nFoo().getName();先执行了 Foo 函数，然后调用 Foo 函数的返回对象的 getName 属性函数。\n\nFoo 函数的第一句`getName = function(){alert(1);};`是一句函数赋值语句，注意它没有 var 声明，所以先向当前 Foo 函数作用域内寻找 getName 变量，没有，再项当前函数的作用域上层，及外层的作用于内寻找是否含有 getName 变量，找到了，也就是第二问中的 alert(4)函数，将此变量的值赋值为`function(){alert(1)}`。此处实际上是将外层作用域内的 getName 函数覆盖了。\n\n注意：此处若依然没有找到会一直向上查找到 window 对象，若 window 对象中也没有 getName 属性，就在 window 对象中创建一个 getName 变量。\n\n之后就返回了 this，此时的 this 是指向的 window 对象。所以相当于执行了 window.getName()。\n\n### getName()\n\n**答案是：1**\n\n直接调用 getName 函数，相当于 window.getName()，因为这个变量已经被 Foo 函数执行时修改了，遂结果与第三问相同，为 1，也就是说 Foo 执行后把全局的 getName 函数给重写了一次，所以结果就是 Foo()执行重写的那个 getName 函数\n\n### new Foo.getName()\n\n**答案是：2**\n\n此处考察的是 JS 的运算符优先级的问题。[MDN 运算符优先级](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence)\n\n-   点的优先级比 new 高 所以 Foo.getName 是一起的.\n-   因为有()，因此是 new 有参数列表，new 的有参数列表为 18 比函数调用（17）高 ，所以是 new Foo.getName\n-   所以最后是(new Foo.getName)();\n-   最后弹出 2\n\n### new Foo().getName()\n\n**答案是：3**\n\nnew 的有参数列表跟点的优先级都是 18,同级的话按照从左向右的执行顺序，所以先执行 new 的有参数列表，再执行点的优先级，最后进行函数调用。(new Foo()).getName(); new 之后就调用公用办法，调用原型链上的 getName，因此是 3。\n\n### new new Foo.getName()\n\n**答案是：3**\n等同于：new ((new Foo()).getName)();\n\n## 综合(2)\n\n```javascript\nfunction Foo() {\n    this.getName = function() {\n        console.log(3);\n        return {\n            getName: getName //这个就是第六问中涉及的构造函数的返回值问题\n        };\n    }; //这个就是第六问中涉及到的，JS构造函数公有方法和原型链方法的优先级\n    getName = function() {\n        console.log(1);\n    };\n    return this;\n}\nFoo.getName = function() {\n    console.log(2);\n};\nFoo.prototype.getName = function() {\n    console.log(6);\n};\nvar getName = function() {\n    console.log(4);\n};\n\nfunction getName() {\n    console.log(5);\n} //答案：\nFoo.getName(); //2\ngetName(); //4\nconsole.log(Foo());\nFoo().getName(); //1\ngetName(); //1\nnew Foo.getName(); //2\nnew Foo().getName(); //3\n//多了一问\nnew Foo().getName().getName(); //3 1\nnew new Foo().getName(); //3\n```\n\n## 异步和单线程\n\n```javascript\nvar a = true;\nsetTimeout(function() {\n    a = false;\n}, 100);\nwhile (a) {\n    console.log(\"while执行了\");\n}\n```\n\n由于 js 是一个单线程。所以进入到 while 循环之后，就没有现成去完成定时器，所以这是一个死循环。\n\n## JS 赋值\n\n```javascript\nvar a = { n: 1 };\nvar b = a;\na.x = a = { n: 2 };\nconsole.log(a.x); //undefined\nconsole.log(b.x); //{n:2}\n```\n\n本人的错误思路：`a={n:2}`=>`a.x=a`=>`a.x={n:2}`\n\n-   错误点 1：不考虑其他，也应该是`a={n:2},a.x={n:2}`,\n-   错误点 2：.的优先级比=高，所以先执行`a.x`,由于 a 引用的`{n:1}`=>`{n:1,x:undefined}`=> b=`{n:1,x:undeined}`\n    `a.x = a = { n: 2 };` =>`{n:1,x:undeined} = a ={ n: 2 }`=>`a={n:1};{n:1,x:{n:2}}`\n-   最重要的一点 3：`a={n:2}`已经改变了引用了地址，然而 a 改变引用地址和 b 并没有任何关系，b 仍然指向的`{n:1,x:{n:2}}`\n\n所以 a.x = undefined b.x ={n:2}\n\n## 下面 a 在什么情况下会打印 1\n\n```javascript\nvar a = \"\"; //?\nif (a == 1 && a == 2 && a == 3) {\n    console.log(1);\n}\n```\n\n因为==会进行隐式转化 所以我们重写了 toString 方法就可以\n\n```javascript\nvar a = {\n  i:1,\n  toString(){\n    return:a.i++\n  }\n};\nif(a==1&&a==2&&a==3){\n console.log(1)\n}\n```\n\n## 实现（5）.add(3).minus(2)=>6;\n\n```javascript\nNumber.prototype.add = function(n) {\n    return this.valueOf() + n;\n};\nNumber.prototype.minus = function(n) {\n    return this.valueOf() - n;\n};\n```\n\n## 实现 promise.all\n\n```javascript\nPromise.all = function(promises) {\n    return new Promise((resolve, reject) => {\n        promises = Array.form(promises);\n        if (promises.length === 0) {\n            resolve([]);\n        }\n        else{\n          let result =[];\n          let index = 0;\n          for(let i = 0;i<promises.length;i++){\n            Promise.resolve(promises[i]).then(data=>{\n              result[i] = data;\n              if(++index===promise.length){\n                resolve(result);\n              }\n            },err=>[\n              reject(err);\n              return;\n            ])\n          }\n        }\n    });\n};\n```\n","source":"_posts/有趣JS题.md","raw":"---\ntitle: 有趣JS题\ndate: 2018-03-08 15:57:30\ncategories: JavaScript\n---\n\n一些出乎意料的题及面试题的积累\n\n<!--more-->\n\n## 变量提升\n\n```javascript\nif (!\"abc\" in window) {\n    var abc = 10;\n}\nconsole.log(abc); //undefined\n//因为先变量声明提升 所以提升之后abc的值系统默认会赋值为undefined。 !abc为false ,in是检查对象中是否存在某个属性。很显然 false属于是一个布尔类型。不存在对象中。所以没有走if里面的变量赋值。\n\nconsole.log(a); //undefined\nif (!(\"a\" in window)) {\n    var a = 10;\n}\nconsole.log(a); //undefined\n//因为先变量声明提升 所以提升之后a的值系统默认会赋值为undefined。 变量提升会存在GO中也就是window。所以(\"a\" in window)肯定为true。!去反一下就为false。所以不走赋值。\n\nvar x = 1;\nif (function f() {}) {\n    x += typeof f;\n}\nconsole.log(x); //1undefined\n//因为函数题在()中会以表达式去运行。最后转换为true,不会存在函数整体声明提升。所以typeof为undefined\n```\n\n## 闭包\n\n```javascript\nfor (var i = 0; i < liListlength; i++) {\n    var ele = document.querySelectorAll(\"ul > li\")[i];\n    ele.addEventListener(\n        \"click\",\n        (function(i) {\n            return function() {\n                console.log(\"index is :\" + i);\n            };\n        })(i)\n    );\n}\n```\n\n```javascript\nfunction fun(n, o) {\n    console.log(o);\n    return {\n        fun: function(m) {\n            return fun(m, n);\n        }\n    };\n}\nvar a = fun(0);\na.fun(1);\na.fun(2);\na.fun(3); //输出什么 undefined 0 0 0\nvar b = fun(0)\n    .fun(1)\n    .fun(2)\n    .fun(3); //输出什么 undefined 0 1 2\nvar c = fun(0).fun(1);\nc.fun(2);\nc.fun(3); //输出什么 undefined 0 1 1\n\n//答案很显而易见。换一个形式看着道题\n\nfunction fun(n, o) {\n    console.log(o);\n    return {\n        fun: function(m) {\n            return fun(m, n);\n        }\n    };\n}\nvar a = fun(0);\na.fun(1);\na.fun(2);\na.fun(3); //输出什么 undefined 0 0 0\n```\n\n## 综合(1)\n\n```javascript\nfunction Foo() {\n    getName = function() {\n        alert(1);\n    };\n    return this;\n}\n\nFoo.getName = function() {\n    alert(2);\n};\nFoo.prototype.getName = function() {\n    alert(3);\n};\nvar getName = function() {\n    alert(4);\n};\nfunction getName() {\n    alert(5);\n}\n\n//请写出以下输出结果,先写以下SB作者的答案，然后接受残酷的事实\nFoo.getName(); //alert(2);\ngetName(); //alert(5);\nFoo().getName(); //alert(5);\ngetName(); //alert(5);\nnew Foo.getName(); //function(){alert(2);}\nnew Foo().getName(); //function getName {alert{5}}\nnew new Foo.getName()(); //function(){alert(2);}\n```\n\n首先定义了一个叫 Foo 的函数，然后为 Foo 创建了一个叫 getName 的静态属性存储了一个匿名函数，之后为 Foo 的原型对象创建了一个叫 getName 的匿名函数。之后又通过函数变量表达式创建了一个 getName 的函数，最后声明一个叫做 getName 函数。\n\n### Foo.getName();\n\n**答案： 2**\n\nFoo.getName()访问的 Foo 函数上存储的静态属性\n\n```javascript\nfunction User(name) {\n    var name = name; //私有属性\n    this.name = name; //公有属性\n    function getName() {\n        //私有方法\n        return name;\n    }\n}\n\nUser.prototype.getName = function() {\n    //公有方法\n    return this.name;\n};\n\nUser.name = \"Wscats\"; //静态属性\nUser.getName = function() {\n    //静态方法\n    return this.name;\n};\nvar Wscat = new User(\"Wscats\"); //实例化\n```\n\n注意以下几点：\n\n-   调用公有方法，公有属性，我们必须要实例化对象，也就是用 new 操作符实例化对象，就可构造函数实例化对象的方法和属性，并且公有方法是不能调用私有方法和静态方法的。\n-   静态方法和静态属性就是我们无需实例化就可以调用。\n-   而对象的私有方法和属性，外部是不可以访问的。\n\n### getName()\n\n**答案是 4**\n\n直接调用 getName 函数。既然是直接调用，那么就是访问当前作用域内的 getName 的函数，所以这里应该是 4 或者 5.这里的坑有，一是变量声明提升，而是函数表达式和函数声明的区别。答案是 4，5 的函数声明被 4 的函数表达式覆盖了。\n\n#### 函数声明与函数表达式\n\n```javascript\n\n  getName()\n  //oaoaafly 函数被提升 这里受函数声明的影响，虽然函数声在最后但可以被提升到最前面了 而此时的函数表达式还没有被赋值（赋值是顺序执行）。\n\n  var getName = function(){\n    console.log('wscat');\n  }\n//函数表达式此时才开始覆盖函数声明的定义。\n\n  getName()//wscat\n\n  funtion getName(){\n    console.log('oaoafly');\n  }\n  getName()//wscat 这里就执行函数表达式的值\n```\n\n-   **JS 解释器中存在一种变量被提升的机制，也就是说函数声明会被提升到作用域的最前面，即使写在代码的最后面，也会被提升到最前面。**\n\n-   **而用函数表达式创建的函数是在运行时被赋值，且要等到表达式赋值完成后才能调用。**\n\n### Foo().getName()\n\n**答案是：1**\n\nFoo().getName();先执行了 Foo 函数，然后调用 Foo 函数的返回对象的 getName 属性函数。\n\nFoo 函数的第一句`getName = function(){alert(1);};`是一句函数赋值语句，注意它没有 var 声明，所以先向当前 Foo 函数作用域内寻找 getName 变量，没有，再项当前函数的作用域上层，及外层的作用于内寻找是否含有 getName 变量，找到了，也就是第二问中的 alert(4)函数，将此变量的值赋值为`function(){alert(1)}`。此处实际上是将外层作用域内的 getName 函数覆盖了。\n\n注意：此处若依然没有找到会一直向上查找到 window 对象，若 window 对象中也没有 getName 属性，就在 window 对象中创建一个 getName 变量。\n\n之后就返回了 this，此时的 this 是指向的 window 对象。所以相当于执行了 window.getName()。\n\n### getName()\n\n**答案是：1**\n\n直接调用 getName 函数，相当于 window.getName()，因为这个变量已经被 Foo 函数执行时修改了，遂结果与第三问相同，为 1，也就是说 Foo 执行后把全局的 getName 函数给重写了一次，所以结果就是 Foo()执行重写的那个 getName 函数\n\n### new Foo.getName()\n\n**答案是：2**\n\n此处考察的是 JS 的运算符优先级的问题。[MDN 运算符优先级](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence)\n\n-   点的优先级比 new 高 所以 Foo.getName 是一起的.\n-   因为有()，因此是 new 有参数列表，new 的有参数列表为 18 比函数调用（17）高 ，所以是 new Foo.getName\n-   所以最后是(new Foo.getName)();\n-   最后弹出 2\n\n### new Foo().getName()\n\n**答案是：3**\n\nnew 的有参数列表跟点的优先级都是 18,同级的话按照从左向右的执行顺序，所以先执行 new 的有参数列表，再执行点的优先级，最后进行函数调用。(new Foo()).getName(); new 之后就调用公用办法，调用原型链上的 getName，因此是 3。\n\n### new new Foo.getName()\n\n**答案是：3**\n等同于：new ((new Foo()).getName)();\n\n## 综合(2)\n\n```javascript\nfunction Foo() {\n    this.getName = function() {\n        console.log(3);\n        return {\n            getName: getName //这个就是第六问中涉及的构造函数的返回值问题\n        };\n    }; //这个就是第六问中涉及到的，JS构造函数公有方法和原型链方法的优先级\n    getName = function() {\n        console.log(1);\n    };\n    return this;\n}\nFoo.getName = function() {\n    console.log(2);\n};\nFoo.prototype.getName = function() {\n    console.log(6);\n};\nvar getName = function() {\n    console.log(4);\n};\n\nfunction getName() {\n    console.log(5);\n} //答案：\nFoo.getName(); //2\ngetName(); //4\nconsole.log(Foo());\nFoo().getName(); //1\ngetName(); //1\nnew Foo.getName(); //2\nnew Foo().getName(); //3\n//多了一问\nnew Foo().getName().getName(); //3 1\nnew new Foo().getName(); //3\n```\n\n## 异步和单线程\n\n```javascript\nvar a = true;\nsetTimeout(function() {\n    a = false;\n}, 100);\nwhile (a) {\n    console.log(\"while执行了\");\n}\n```\n\n由于 js 是一个单线程。所以进入到 while 循环之后，就没有现成去完成定时器，所以这是一个死循环。\n\n## JS 赋值\n\n```javascript\nvar a = { n: 1 };\nvar b = a;\na.x = a = { n: 2 };\nconsole.log(a.x); //undefined\nconsole.log(b.x); //{n:2}\n```\n\n本人的错误思路：`a={n:2}`=>`a.x=a`=>`a.x={n:2}`\n\n-   错误点 1：不考虑其他，也应该是`a={n:2},a.x={n:2}`,\n-   错误点 2：.的优先级比=高，所以先执行`a.x`,由于 a 引用的`{n:1}`=>`{n:1,x:undefined}`=> b=`{n:1,x:undeined}`\n    `a.x = a = { n: 2 };` =>`{n:1,x:undeined} = a ={ n: 2 }`=>`a={n:1};{n:1,x:{n:2}}`\n-   最重要的一点 3：`a={n:2}`已经改变了引用了地址，然而 a 改变引用地址和 b 并没有任何关系，b 仍然指向的`{n:1,x:{n:2}}`\n\n所以 a.x = undefined b.x ={n:2}\n\n## 下面 a 在什么情况下会打印 1\n\n```javascript\nvar a = \"\"; //?\nif (a == 1 && a == 2 && a == 3) {\n    console.log(1);\n}\n```\n\n因为==会进行隐式转化 所以我们重写了 toString 方法就可以\n\n```javascript\nvar a = {\n  i:1,\n  toString(){\n    return:a.i++\n  }\n};\nif(a==1&&a==2&&a==3){\n console.log(1)\n}\n```\n\n## 实现（5）.add(3).minus(2)=>6;\n\n```javascript\nNumber.prototype.add = function(n) {\n    return this.valueOf() + n;\n};\nNumber.prototype.minus = function(n) {\n    return this.valueOf() - n;\n};\n```\n\n## 实现 promise.all\n\n```javascript\nPromise.all = function(promises) {\n    return new Promise((resolve, reject) => {\n        promises = Array.form(promises);\n        if (promises.length === 0) {\n            resolve([]);\n        }\n        else{\n          let result =[];\n          let index = 0;\n          for(let i = 0;i<promises.length;i++){\n            Promise.resolve(promises[i]).then(data=>{\n              result[i] = data;\n              if(++index===promise.length){\n                resolve(result);\n              }\n            },err=>[\n              reject(err);\n              return;\n            ])\n          }\n        }\n    });\n};\n```\n","slug":"有趣JS题","published":1,"updated":"2021-02-28T08:15:36.225Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xg002ql5v0cdq5crr4","content":"<p>一些出乎意料的题及面试题的积累</p>\n<span id=\"more\"></span>\n\n<h2 id=\"变量提升\"><a href=\"#变量提升\" class=\"headerlink\" title=\"变量提升\"></a>变量提升</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"string\">&quot;abc&quot;</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> abc = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(abc); <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"comment\">//因为先变量声明提升 所以提升之后abc的值系统默认会赋值为undefined。 !abc为false ,in是检查对象中是否存在某个属性。很显然 false属于是一个布尔类型。不存在对象中。所以没有走if里面的变量赋值。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a); <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!(<span class=\"string\">&quot;a&quot;</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a); <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"comment\">//因为先变量声明提升 所以提升之后a的值系统默认会赋值为undefined。 变量提升会存在GO中也就是window。所以(&quot;a&quot; in window)肯定为true。!去反一下就为false。所以不走赋值。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;&#125;) &#123;</span><br><span class=\"line\">    x += <span class=\"keyword\">typeof</span> f;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(x); <span class=\"comment\">//1undefined</span></span><br><span class=\"line\"><span class=\"comment\">//因为函数题在()中会以表达式去运行。最后转换为true,不会存在函数整体声明提升。所以typeof为undefined</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; liListlength; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ele = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">&quot;ul &gt; li&quot;</span>)[i];</span><br><span class=\"line\">    ele.addEventListener(</span><br><span class=\"line\">        <span class=\"string\">&quot;click&quot;</span>,</span><br><span class=\"line\">        (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;index is :&quot;</span> + i);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;)(i)</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fun</span>(<span class=\"params\">n, o</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(o);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        fun: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">m</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fun(m, n);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = fun(<span class=\"number\">0</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">1</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">2</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">3</span>); <span class=\"comment\">//输出什么 undefined 0 0 0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = fun(<span class=\"number\">0</span>)</span><br><span class=\"line\">    .fun(<span class=\"number\">1</span>)</span><br><span class=\"line\">    .fun(<span class=\"number\">2</span>)</span><br><span class=\"line\">    .fun(<span class=\"number\">3</span>); <span class=\"comment\">//输出什么 undefined 0 1 2</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = fun(<span class=\"number\">0</span>).fun(<span class=\"number\">1</span>);</span><br><span class=\"line\">c.fun(<span class=\"number\">2</span>);</span><br><span class=\"line\">c.fun(<span class=\"number\">3</span>); <span class=\"comment\">//输出什么 undefined 0 1 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//答案很显而易见。换一个形式看着道题</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fun</span>(<span class=\"params\">n, o</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(o);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        fun: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">m</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fun(m, n);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = fun(<span class=\"number\">0</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">1</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">2</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">3</span>); <span class=\"comment\">//输出什么 undefined 0 0 0</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"综合-1\"><a href=\"#综合-1\" class=\"headerlink\" title=\"综合(1)\"></a>综合(1)</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        alert(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Foo.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Foo.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">3</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//请写出以下输出结果,先写以下SB作者的答案，然后接受残酷的事实</span></span><br><span class=\"line\">Foo.getName(); <span class=\"comment\">//alert(2);</span></span><br><span class=\"line\">getName(); <span class=\"comment\">//alert(5);</span></span><br><span class=\"line\">Foo().getName(); <span class=\"comment\">//alert(5);</span></span><br><span class=\"line\">getName(); <span class=\"comment\">//alert(5);</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo.getName(); <span class=\"comment\">//function()&#123;alert(2);&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">//function getName &#123;alert&#123;5&#125;&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"keyword\">new</span> Foo.getName()(); <span class=\"comment\">//function()&#123;alert(2);&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>首先定义了一个叫 Foo 的函数，然后为 Foo 创建了一个叫 getName 的静态属性存储了一个匿名函数，之后为 Foo 的原型对象创建了一个叫 getName 的匿名函数。之后又通过函数变量表达式创建了一个 getName 的函数，最后声明一个叫做 getName 函数。</p>\n<h3 id=\"Foo-getName\"><a href=\"#Foo-getName\" class=\"headerlink\" title=\"Foo.getName();\"></a>Foo.getName();</h3><p><strong>答案： 2</strong></p>\n<p>Foo.getName()访问的 Foo 函数上存储的静态属性</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">User</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name = name; <span class=\"comment\">//私有属性</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name; <span class=\"comment\">//公有属性</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//私有方法</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">User.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//公有方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">User.name = <span class=\"string\">&quot;Wscats&quot;</span>; <span class=\"comment\">//静态属性</span></span><br><span class=\"line\">User.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//静态方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Wscat = <span class=\"keyword\">new</span> User(<span class=\"string\">&quot;Wscats&quot;</span>); <span class=\"comment\">//实例化</span></span><br></pre></td></tr></table></figure>\n\n<p>注意以下几点：</p>\n<ul>\n<li>  调用公有方法，公有属性，我们必须要实例化对象，也就是用 new 操作符实例化对象，就可构造函数实例化对象的方法和属性，并且公有方法是不能调用私有方法和静态方法的。</li>\n<li>  静态方法和静态属性就是我们无需实例化就可以调用。</li>\n<li>  而对象的私有方法和属性，外部是不可以访问的。</li>\n</ul>\n<h3 id=\"getName\"><a href=\"#getName\" class=\"headerlink\" title=\"getName()\"></a>getName()</h3><p><strong>答案是 4</strong></p>\n<p>直接调用 getName 函数。既然是直接调用，那么就是访问当前作用域内的 getName 的函数，所以这里应该是 4 或者 5.这里的坑有，一是变量声明提升，而是函数表达式和函数声明的区别。答案是 4，5 的函数声明被 4 的函数表达式覆盖了。</p>\n<h4 id=\"函数声明与函数表达式\"><a href=\"#函数声明与函数表达式\" class=\"headerlink\" title=\"函数声明与函数表达式\"></a>函数声明与函数表达式</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">  getName()</span><br><span class=\"line\">  <span class=\"comment\">//oaoaafly 函数被提升 这里受函数声明的影响，虽然函数声在最后但可以被提升到最前面了 而此时的函数表达式还没有被赋值（赋值是顺序执行）。</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;wscat&#x27;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"comment\">//函数表达式此时才开始覆盖函数声明的定义。</span></span><br><span class=\"line\"></span><br><span class=\"line\">  getName()<span class=\"comment\">//wscat</span></span><br><span class=\"line\"></span><br><span class=\"line\">  funtion <span class=\"function\"><span class=\"title\">getName</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;oaoafly&#x27;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  getName()<span class=\"comment\">//wscat 这里就执行函数表达式的值</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>  <strong>JS 解释器中存在一种变量被提升的机制，也就是说函数声明会被提升到作用域的最前面，即使写在代码的最后面，也会被提升到最前面。</strong></p>\n</li>\n<li><p>  <strong>而用函数表达式创建的函数是在运行时被赋值，且要等到表达式赋值完成后才能调用。</strong></p>\n</li>\n</ul>\n<h3 id=\"Foo-getName-1\"><a href=\"#Foo-getName-1\" class=\"headerlink\" title=\"Foo().getName()\"></a>Foo().getName()</h3><p><strong>答案是：1</strong></p>\n<p>Foo().getName();先执行了 Foo 函数，然后调用 Foo 函数的返回对象的 getName 属性函数。</p>\n<p>Foo 函数的第一句<code>getName = function()&#123;alert(1);&#125;;</code>是一句函数赋值语句，注意它没有 var 声明，所以先向当前 Foo 函数作用域内寻找 getName 变量，没有，再项当前函数的作用域上层，及外层的作用于内寻找是否含有 getName 变量，找到了，也就是第二问中的 alert(4)函数，将此变量的值赋值为<code>function()&#123;alert(1)&#125;</code>。此处实际上是将外层作用域内的 getName 函数覆盖了。</p>\n<p>注意：此处若依然没有找到会一直向上查找到 window 对象，若 window 对象中也没有 getName 属性，就在 window 对象中创建一个 getName 变量。</p>\n<p>之后就返回了 this，此时的 this 是指向的 window 对象。所以相当于执行了 window.getName()。</p>\n<h3 id=\"getName-1\"><a href=\"#getName-1\" class=\"headerlink\" title=\"getName()\"></a>getName()</h3><p><strong>答案是：1</strong></p>\n<p>直接调用 getName 函数，相当于 window.getName()，因为这个变量已经被 Foo 函数执行时修改了，遂结果与第三问相同，为 1，也就是说 Foo 执行后把全局的 getName 函数给重写了一次，所以结果就是 Foo()执行重写的那个 getName 函数</p>\n<h3 id=\"new-Foo-getName\"><a href=\"#new-Foo-getName\" class=\"headerlink\" title=\"new Foo.getName()\"></a>new Foo.getName()</h3><p><strong>答案是：2</strong></p>\n<p>此处考察的是 JS 的运算符优先级的问题。<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence\">MDN 运算符优先级</a></p>\n<ul>\n<li>  点的优先级比 new 高 所以 Foo.getName 是一起的.</li>\n<li>  因为有()，因此是 new 有参数列表，new 的有参数列表为 18 比函数调用（17）高 ，所以是 new Foo.getName</li>\n<li>  所以最后是(new Foo.getName)();</li>\n<li>  最后弹出 2</li>\n</ul>\n<h3 id=\"new-Foo-getName-1\"><a href=\"#new-Foo-getName-1\" class=\"headerlink\" title=\"new Foo().getName()\"></a>new Foo().getName()</h3><p><strong>答案是：3</strong></p>\n<p>new 的有参数列表跟点的优先级都是 18,同级的话按照从左向右的执行顺序，所以先执行 new 的有参数列表，再执行点的优先级，最后进行函数调用。(new Foo()).getName(); new 之后就调用公用办法，调用原型链上的 getName，因此是 3。</p>\n<h3 id=\"new-new-Foo-getName\"><a href=\"#new-new-Foo-getName\" class=\"headerlink\" title=\"new new Foo.getName()\"></a>new new Foo.getName()</h3><p><strong>答案是：3</strong><br>等同于：new ((new Foo()).getName)();</p>\n<h2 id=\"综合-2\"><a href=\"#综合-2\" class=\"headerlink\" title=\"综合(2)\"></a>综合(2)</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            getName: getName <span class=\"comment\">//这个就是第六问中涉及的构造函数的返回值问题</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;; <span class=\"comment\">//这个就是第六问中涉及到的，JS构造函数公有方法和原型链方法的优先级</span></span><br><span class=\"line\">    getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Foo.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Foo.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">6</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125; <span class=\"comment\">//答案：</span></span><br><span class=\"line\">Foo.getName(); <span class=\"comment\">//2</span></span><br><span class=\"line\">getName(); <span class=\"comment\">//4</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(Foo());</span><br><span class=\"line\">Foo().getName(); <span class=\"comment\">//1</span></span><br><span class=\"line\">getName(); <span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo.getName(); <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">//3</span></span><br><span class=\"line\"><span class=\"comment\">//多了一问</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName().getName(); <span class=\"comment\">//3 1</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">//3</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"异步和单线程\"><a href=\"#异步和单线程\" class=\"headerlink\" title=\"异步和单线程\"></a>异步和单线程</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    a = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">while</span> (a) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;while执行了&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>由于 js 是一个单线程。所以进入到 while 循环之后，就没有现成去完成定时器，所以这是一个死循环。</p>\n<h2 id=\"JS-赋值\"><a href=\"#JS-赋值\" class=\"headerlink\" title=\"JS 赋值\"></a>JS 赋值</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"attr\">n</span>: <span class=\"number\">1</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a;</span><br><span class=\"line\">a.x = a = &#123; <span class=\"attr\">n</span>: <span class=\"number\">2</span> &#125;;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.x); <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.x); <span class=\"comment\">//&#123;n:2&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>本人的错误思路：<code>a=&#123;n:2&#125;</code>=&gt;<code>a.x=a</code>=&gt;<code>a.x=&#123;n:2&#125;</code></p>\n<ul>\n<li>  错误点 1：不考虑其他，也应该是<code>a=&#123;n:2&#125;,a.x=&#123;n:2&#125;</code>,</li>\n<li>错误点 2：.的优先级比=高，所以先执行<code>a.x</code>,由于 a 引用的<code>&#123;n:1&#125;</code>=&gt;<code>&#123;n:1,x:undefined&#125;</code>=&gt; b=<code>&#123;n:1,x:undeined&#125;</code><br>  <code>a.x = a = &#123; n: 2 &#125;;</code> =&gt;<code>&#123;n:1,x:undeined&#125; = a =&#123; n: 2 &#125;</code>=&gt;<code>a=&#123;n:1&#125;;&#123;n:1,x:&#123;n:2&#125;&#125;</code></li>\n<li>  最重要的一点 3：<code>a=&#123;n:2&#125;</code>已经改变了引用了地址，然而 a 改变引用地址和 b 并没有任何关系，b 仍然指向的<code>&#123;n:1,x:&#123;n:2&#125;&#125;</code></li>\n</ul>\n<p>所以 a.x = undefined b.x ={n:2}</p>\n<h2 id=\"下面-a-在什么情况下会打印-1\"><a href=\"#下面-a-在什么情况下会打印-1\" class=\"headerlink\" title=\"下面 a 在什么情况下会打印 1\"></a>下面 a 在什么情况下会打印 1</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&quot;&quot;</span>; <span class=\"comment\">//?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (a == <span class=\"number\">1</span> &amp;&amp; a == <span class=\"number\">2</span> &amp;&amp; a == <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为==会进行隐式转化 所以我们重写了 toString 方法就可以</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  i:<span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>:a.i++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(a==<span class=\"number\">1</span>&amp;&amp;a==<span class=\"number\">2</span>&amp;&amp;a==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\"> <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实现（5）-add-3-minus-2-gt-6\"><a href=\"#实现（5）-add-3-minus-2-gt-6\" class=\"headerlink\" title=\"实现（5）.add(3).minus(2)=&gt;6;\"></a>实现（5）.add(3).minus(2)=&gt;6;</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Number</span>.prototype.add = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.valueOf() + n;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Number</span>.prototype.minus = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.valueOf() - n;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实现-promise-all\"><a href=\"#实现-promise-all\" class=\"headerlink\" title=\"实现 promise.all\"></a>实现 promise.all</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.all = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">promises</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        promises = <span class=\"built_in\">Array</span>.form(promises);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (promises.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            resolve([]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> result =[];</span><br><span class=\"line\">          <span class=\"keyword\">let</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">          <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>;i&lt;promises.length;i++)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">Promise</span>.resolve(promises[i]).then(<span class=\"function\"><span class=\"params\">data</span>=&gt;</span>&#123;</span><br><span class=\"line\">              result[i] = data;</span><br><span class=\"line\">              <span class=\"keyword\">if</span>(++index===promise.length)&#123;</span><br><span class=\"line\">                resolve(result);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;,<span class=\"function\"><span class=\"params\">err</span>=&gt;</span>[</span><br><span class=\"line\">              reject(err);</span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            ])</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>一些出乎意料的题及面试题的积累</p>","more":"<h2 id=\"变量提升\"><a href=\"#变量提升\" class=\"headerlink\" title=\"变量提升\"></a>变量提升</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"string\">&quot;abc&quot;</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> abc = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(abc); <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"comment\">//因为先变量声明提升 所以提升之后abc的值系统默认会赋值为undefined。 !abc为false ,in是检查对象中是否存在某个属性。很显然 false属于是一个布尔类型。不存在对象中。所以没有走if里面的变量赋值。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a); <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!(<span class=\"string\">&quot;a&quot;</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a); <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"comment\">//因为先变量声明提升 所以提升之后a的值系统默认会赋值为undefined。 变量提升会存在GO中也就是window。所以(&quot;a&quot; in window)肯定为true。!去反一下就为false。所以不走赋值。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;&#125;) &#123;</span><br><span class=\"line\">    x += <span class=\"keyword\">typeof</span> f;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(x); <span class=\"comment\">//1undefined</span></span><br><span class=\"line\"><span class=\"comment\">//因为函数题在()中会以表达式去运行。最后转换为true,不会存在函数整体声明提升。所以typeof为undefined</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; liListlength; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ele = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">&quot;ul &gt; li&quot;</span>)[i];</span><br><span class=\"line\">    ele.addEventListener(</span><br><span class=\"line\">        <span class=\"string\">&quot;click&quot;</span>,</span><br><span class=\"line\">        (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;index is :&quot;</span> + i);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;)(i)</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fun</span>(<span class=\"params\">n, o</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(o);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        fun: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">m</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fun(m, n);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = fun(<span class=\"number\">0</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">1</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">2</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">3</span>); <span class=\"comment\">//输出什么 undefined 0 0 0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = fun(<span class=\"number\">0</span>)</span><br><span class=\"line\">    .fun(<span class=\"number\">1</span>)</span><br><span class=\"line\">    .fun(<span class=\"number\">2</span>)</span><br><span class=\"line\">    .fun(<span class=\"number\">3</span>); <span class=\"comment\">//输出什么 undefined 0 1 2</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = fun(<span class=\"number\">0</span>).fun(<span class=\"number\">1</span>);</span><br><span class=\"line\">c.fun(<span class=\"number\">2</span>);</span><br><span class=\"line\">c.fun(<span class=\"number\">3</span>); <span class=\"comment\">//输出什么 undefined 0 1 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//答案很显而易见。换一个形式看着道题</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fun</span>(<span class=\"params\">n, o</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(o);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        fun: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">m</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fun(m, n);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = fun(<span class=\"number\">0</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">1</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">2</span>);</span><br><span class=\"line\">a.fun(<span class=\"number\">3</span>); <span class=\"comment\">//输出什么 undefined 0 0 0</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"综合-1\"><a href=\"#综合-1\" class=\"headerlink\" title=\"综合(1)\"></a>综合(1)</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        alert(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Foo.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Foo.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">3</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//请写出以下输出结果,先写以下SB作者的答案，然后接受残酷的事实</span></span><br><span class=\"line\">Foo.getName(); <span class=\"comment\">//alert(2);</span></span><br><span class=\"line\">getName(); <span class=\"comment\">//alert(5);</span></span><br><span class=\"line\">Foo().getName(); <span class=\"comment\">//alert(5);</span></span><br><span class=\"line\">getName(); <span class=\"comment\">//alert(5);</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo.getName(); <span class=\"comment\">//function()&#123;alert(2);&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">//function getName &#123;alert&#123;5&#125;&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"keyword\">new</span> Foo.getName()(); <span class=\"comment\">//function()&#123;alert(2);&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>首先定义了一个叫 Foo 的函数，然后为 Foo 创建了一个叫 getName 的静态属性存储了一个匿名函数，之后为 Foo 的原型对象创建了一个叫 getName 的匿名函数。之后又通过函数变量表达式创建了一个 getName 的函数，最后声明一个叫做 getName 函数。</p>\n<h3 id=\"Foo-getName\"><a href=\"#Foo-getName\" class=\"headerlink\" title=\"Foo.getName();\"></a>Foo.getName();</h3><p><strong>答案： 2</strong></p>\n<p>Foo.getName()访问的 Foo 函数上存储的静态属性</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">User</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name = name; <span class=\"comment\">//私有属性</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name; <span class=\"comment\">//公有属性</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//私有方法</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">User.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//公有方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">User.name = <span class=\"string\">&quot;Wscats&quot;</span>; <span class=\"comment\">//静态属性</span></span><br><span class=\"line\">User.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//静态方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Wscat = <span class=\"keyword\">new</span> User(<span class=\"string\">&quot;Wscats&quot;</span>); <span class=\"comment\">//实例化</span></span><br></pre></td></tr></table></figure>\n\n<p>注意以下几点：</p>\n<ul>\n<li>  调用公有方法，公有属性，我们必须要实例化对象，也就是用 new 操作符实例化对象，就可构造函数实例化对象的方法和属性，并且公有方法是不能调用私有方法和静态方法的。</li>\n<li>  静态方法和静态属性就是我们无需实例化就可以调用。</li>\n<li>  而对象的私有方法和属性，外部是不可以访问的。</li>\n</ul>\n<h3 id=\"getName\"><a href=\"#getName\" class=\"headerlink\" title=\"getName()\"></a>getName()</h3><p><strong>答案是 4</strong></p>\n<p>直接调用 getName 函数。既然是直接调用，那么就是访问当前作用域内的 getName 的函数，所以这里应该是 4 或者 5.这里的坑有，一是变量声明提升，而是函数表达式和函数声明的区别。答案是 4，5 的函数声明被 4 的函数表达式覆盖了。</p>\n<h4 id=\"函数声明与函数表达式\"><a href=\"#函数声明与函数表达式\" class=\"headerlink\" title=\"函数声明与函数表达式\"></a>函数声明与函数表达式</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">  getName()</span><br><span class=\"line\">  <span class=\"comment\">//oaoaafly 函数被提升 这里受函数声明的影响，虽然函数声在最后但可以被提升到最前面了 而此时的函数表达式还没有被赋值（赋值是顺序执行）。</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;wscat&#x27;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"comment\">//函数表达式此时才开始覆盖函数声明的定义。</span></span><br><span class=\"line\"></span><br><span class=\"line\">  getName()<span class=\"comment\">//wscat</span></span><br><span class=\"line\"></span><br><span class=\"line\">  funtion <span class=\"function\"><span class=\"title\">getName</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;oaoafly&#x27;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  getName()<span class=\"comment\">//wscat 这里就执行函数表达式的值</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>  <strong>JS 解释器中存在一种变量被提升的机制，也就是说函数声明会被提升到作用域的最前面，即使写在代码的最后面，也会被提升到最前面。</strong></p>\n</li>\n<li><p>  <strong>而用函数表达式创建的函数是在运行时被赋值，且要等到表达式赋值完成后才能调用。</strong></p>\n</li>\n</ul>\n<h3 id=\"Foo-getName-1\"><a href=\"#Foo-getName-1\" class=\"headerlink\" title=\"Foo().getName()\"></a>Foo().getName()</h3><p><strong>答案是：1</strong></p>\n<p>Foo().getName();先执行了 Foo 函数，然后调用 Foo 函数的返回对象的 getName 属性函数。</p>\n<p>Foo 函数的第一句<code>getName = function()&#123;alert(1);&#125;;</code>是一句函数赋值语句，注意它没有 var 声明，所以先向当前 Foo 函数作用域内寻找 getName 变量，没有，再项当前函数的作用域上层，及外层的作用于内寻找是否含有 getName 变量，找到了，也就是第二问中的 alert(4)函数，将此变量的值赋值为<code>function()&#123;alert(1)&#125;</code>。此处实际上是将外层作用域内的 getName 函数覆盖了。</p>\n<p>注意：此处若依然没有找到会一直向上查找到 window 对象，若 window 对象中也没有 getName 属性，就在 window 对象中创建一个 getName 变量。</p>\n<p>之后就返回了 this，此时的 this 是指向的 window 对象。所以相当于执行了 window.getName()。</p>\n<h3 id=\"getName-1\"><a href=\"#getName-1\" class=\"headerlink\" title=\"getName()\"></a>getName()</h3><p><strong>答案是：1</strong></p>\n<p>直接调用 getName 函数，相当于 window.getName()，因为这个变量已经被 Foo 函数执行时修改了，遂结果与第三问相同，为 1，也就是说 Foo 执行后把全局的 getName 函数给重写了一次，所以结果就是 Foo()执行重写的那个 getName 函数</p>\n<h3 id=\"new-Foo-getName\"><a href=\"#new-Foo-getName\" class=\"headerlink\" title=\"new Foo.getName()\"></a>new Foo.getName()</h3><p><strong>答案是：2</strong></p>\n<p>此处考察的是 JS 的运算符优先级的问题。<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence\">MDN 运算符优先级</a></p>\n<ul>\n<li>  点的优先级比 new 高 所以 Foo.getName 是一起的.</li>\n<li>  因为有()，因此是 new 有参数列表，new 的有参数列表为 18 比函数调用（17）高 ，所以是 new Foo.getName</li>\n<li>  所以最后是(new Foo.getName)();</li>\n<li>  最后弹出 2</li>\n</ul>\n<h3 id=\"new-Foo-getName-1\"><a href=\"#new-Foo-getName-1\" class=\"headerlink\" title=\"new Foo().getName()\"></a>new Foo().getName()</h3><p><strong>答案是：3</strong></p>\n<p>new 的有参数列表跟点的优先级都是 18,同级的话按照从左向右的执行顺序，所以先执行 new 的有参数列表，再执行点的优先级，最后进行函数调用。(new Foo()).getName(); new 之后就调用公用办法，调用原型链上的 getName，因此是 3。</p>\n<h3 id=\"new-new-Foo-getName\"><a href=\"#new-new-Foo-getName\" class=\"headerlink\" title=\"new new Foo.getName()\"></a>new new Foo.getName()</h3><p><strong>答案是：3</strong><br>等同于：new ((new Foo()).getName)();</p>\n<h2 id=\"综合-2\"><a href=\"#综合-2\" class=\"headerlink\" title=\"综合(2)\"></a>综合(2)</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            getName: getName <span class=\"comment\">//这个就是第六问中涉及的构造函数的返回值问题</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;; <span class=\"comment\">//这个就是第六问中涉及到的，JS构造函数公有方法和原型链方法的优先级</span></span><br><span class=\"line\">    getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Foo.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Foo.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">6</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> getName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>);</span><br><span class=\"line\">&#125; <span class=\"comment\">//答案：</span></span><br><span class=\"line\">Foo.getName(); <span class=\"comment\">//2</span></span><br><span class=\"line\">getName(); <span class=\"comment\">//4</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(Foo());</span><br><span class=\"line\">Foo().getName(); <span class=\"comment\">//1</span></span><br><span class=\"line\">getName(); <span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo.getName(); <span class=\"comment\">//2</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">//3</span></span><br><span class=\"line\"><span class=\"comment\">//多了一问</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName().getName(); <span class=\"comment\">//3 1</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">//3</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"异步和单线程\"><a href=\"#异步和单线程\" class=\"headerlink\" title=\"异步和单线程\"></a>异步和单线程</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    a = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">while</span> (a) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;while执行了&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>由于 js 是一个单线程。所以进入到 while 循环之后，就没有现成去完成定时器，所以这是一个死循环。</p>\n<h2 id=\"JS-赋值\"><a href=\"#JS-赋值\" class=\"headerlink\" title=\"JS 赋值\"></a>JS 赋值</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"attr\">n</span>: <span class=\"number\">1</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a;</span><br><span class=\"line\">a.x = a = &#123; <span class=\"attr\">n</span>: <span class=\"number\">2</span> &#125;;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.x); <span class=\"comment\">//undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.x); <span class=\"comment\">//&#123;n:2&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>本人的错误思路：<code>a=&#123;n:2&#125;</code>=&gt;<code>a.x=a</code>=&gt;<code>a.x=&#123;n:2&#125;</code></p>\n<ul>\n<li>  错误点 1：不考虑其他，也应该是<code>a=&#123;n:2&#125;,a.x=&#123;n:2&#125;</code>,</li>\n<li>错误点 2：.的优先级比=高，所以先执行<code>a.x</code>,由于 a 引用的<code>&#123;n:1&#125;</code>=&gt;<code>&#123;n:1,x:undefined&#125;</code>=&gt; b=<code>&#123;n:1,x:undeined&#125;</code><br>  <code>a.x = a = &#123; n: 2 &#125;;</code> =&gt;<code>&#123;n:1,x:undeined&#125; = a =&#123; n: 2 &#125;</code>=&gt;<code>a=&#123;n:1&#125;;&#123;n:1,x:&#123;n:2&#125;&#125;</code></li>\n<li>  最重要的一点 3：<code>a=&#123;n:2&#125;</code>已经改变了引用了地址，然而 a 改变引用地址和 b 并没有任何关系，b 仍然指向的<code>&#123;n:1,x:&#123;n:2&#125;&#125;</code></li>\n</ul>\n<p>所以 a.x = undefined b.x ={n:2}</p>\n<h2 id=\"下面-a-在什么情况下会打印-1\"><a href=\"#下面-a-在什么情况下会打印-1\" class=\"headerlink\" title=\"下面 a 在什么情况下会打印 1\"></a>下面 a 在什么情况下会打印 1</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&quot;&quot;</span>; <span class=\"comment\">//?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (a == <span class=\"number\">1</span> &amp;&amp; a == <span class=\"number\">2</span> &amp;&amp; a == <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>因为==会进行隐式转化 所以我们重写了 toString 方法就可以</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  i:<span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>:a.i++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(a==<span class=\"number\">1</span>&amp;&amp;a==<span class=\"number\">2</span>&amp;&amp;a==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\"> <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实现（5）-add-3-minus-2-gt-6\"><a href=\"#实现（5）-add-3-minus-2-gt-6\" class=\"headerlink\" title=\"实现（5）.add(3).minus(2)=&gt;6;\"></a>实现（5）.add(3).minus(2)=&gt;6;</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Number</span>.prototype.add = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.valueOf() + n;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Number</span>.prototype.minus = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.valueOf() - n;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实现-promise-all\"><a href=\"#实现-promise-all\" class=\"headerlink\" title=\"实现 promise.all\"></a>实现 promise.all</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.all = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">promises</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        promises = <span class=\"built_in\">Array</span>.form(promises);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (promises.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            resolve([]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> result =[];</span><br><span class=\"line\">          <span class=\"keyword\">let</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">          <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>;i&lt;promises.length;i++)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">Promise</span>.resolve(promises[i]).then(<span class=\"function\"><span class=\"params\">data</span>=&gt;</span>&#123;</span><br><span class=\"line\">              result[i] = data;</span><br><span class=\"line\">              <span class=\"keyword\">if</span>(++index===promise.length)&#123;</span><br><span class=\"line\">                resolve(result);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;,<span class=\"function\"><span class=\"params\">err</span>=&gt;</span>[</span><br><span class=\"line\">              reject(err);</span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            ])</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"正则表达式","date":"2019-08-12T08:56:17.000Z","_content":"正则表达式的特点是：1. 灵活性、逻辑性和功能性非常的强；2. 可以迅速地用极简单的方式达到字符串的复杂控制。3. 对于刚接触的人来说，比较晦涩难懂。\n\n<!--more-->\n\n[正则表达式全集](http://tool.oschina.net/uploads/apidocs/jquery/regexp.html);\n\n# 字面量字符( Literal Characters )\n字符  |\t描述  |\t描述\n-|-|-\nf\t |    换页符 |\t(u000C)\nn\t |    换行符 |\t(u000A)\nn\t |    换行符 |\t(u000A)\nr\t |    回车 |\t(u000D)\no\t |    NUL字符 |\t(u0000)\nt\t |   制表符 |\t(u0009)\nv\t |  垂直制表符 |\t(u000B)\nxnn\t |由十六进制数nn指定的拉丁字符 |\tx0A等价于n\nuxxxx |\t由十六进行xxxx指定的Unicode字符 |\tu0009等价与t\ncX\t控制字符(X的值必须是A-Z或a-z) |\tcJ等价于换行符n\n\n# 字符类( Character Classes )\n\n字符 |\t描述 |\t示例\n-|-|-\n[xyz] |\t匹配位于括号内的任意字符 |\t[abc]匹配'plain'中的a\n[^xyz] |\t匹配不在括号之中的任意字符\t[^abc] | 匹配'plain'中的p\nw |\t等价于[a-zA-Z0-9_] |\tw匹配'sina'中的s\nW |\t等价于[^a-zA-Z0-9_] |\tw不能匹配'sina'\ns |\t任何Unicode空白符 |\t[ fnrtv]\nS |\t任何非空白字符 |\t[^ fnrtv]\nd |\t等价于[0-9] |\td匹配'sina123'中的1\nD |\t等价于[^0-9] |\tD不能匹配'sina1'中的1\n[b] |\t退格直接量(特例) \n\n# 重复\n\n\n字符 | \t描述 | \t                    示例\n-|-|-\n{n,m} | \t匹配至少n次,但不超过m次,n和m必须是非负整数,且n<=m |  `/\\d{4,6}/`匹配4-6位0-9的数字\n{n,} |  匹配至少n次\to{2,} |  不匹配'Bob'中的'o',但匹配'food'中的 o. \t   \n{n} | \t    恰好匹配n次\to{2} |  不匹配'Bob'中的'o',但匹配'food'中的o.\n? | \t    匹配0次或1次,等价于{0,1} | \tzo? 匹配 \"z\" and \"zo\", 但不匹配\"zoo\".\n+ | \t    匹配1次或多次,等价于{1,} | \tzo+ 匹配 \"zo\" and \"zoo\", 但不匹配 \"z\".\n* | \t    匹配0次或多次,等价于{0,} | \tzo* 匹配 \"z\" 和 \"zoo\".\n\n# 非贪婪的重复\n当？紧跟在其他限制符（*,+,?,{n},{n,},{n,m}）后面时，匹配模式是非贪婪的。非贪婪模式是尽可能少的匹配所搜索的字符串。例如字符串\"ooooo\",\"o+?\"将匹配单个\"o\",而o+匹配所有o","source":"_posts/正则表达式.md","raw":"---\ntitle: 正则表达式\ndate: 2019-08-12 16:56:17\ncategories: JavaScript\n---\n正则表达式的特点是：1. 灵活性、逻辑性和功能性非常的强；2. 可以迅速地用极简单的方式达到字符串的复杂控制。3. 对于刚接触的人来说，比较晦涩难懂。\n\n<!--more-->\n\n[正则表达式全集](http://tool.oschina.net/uploads/apidocs/jquery/regexp.html);\n\n# 字面量字符( Literal Characters )\n字符  |\t描述  |\t描述\n-|-|-\nf\t |    换页符 |\t(u000C)\nn\t |    换行符 |\t(u000A)\nn\t |    换行符 |\t(u000A)\nr\t |    回车 |\t(u000D)\no\t |    NUL字符 |\t(u0000)\nt\t |   制表符 |\t(u0009)\nv\t |  垂直制表符 |\t(u000B)\nxnn\t |由十六进制数nn指定的拉丁字符 |\tx0A等价于n\nuxxxx |\t由十六进行xxxx指定的Unicode字符 |\tu0009等价与t\ncX\t控制字符(X的值必须是A-Z或a-z) |\tcJ等价于换行符n\n\n# 字符类( Character Classes )\n\n字符 |\t描述 |\t示例\n-|-|-\n[xyz] |\t匹配位于括号内的任意字符 |\t[abc]匹配'plain'中的a\n[^xyz] |\t匹配不在括号之中的任意字符\t[^abc] | 匹配'plain'中的p\nw |\t等价于[a-zA-Z0-9_] |\tw匹配'sina'中的s\nW |\t等价于[^a-zA-Z0-9_] |\tw不能匹配'sina'\ns |\t任何Unicode空白符 |\t[ fnrtv]\nS |\t任何非空白字符 |\t[^ fnrtv]\nd |\t等价于[0-9] |\td匹配'sina123'中的1\nD |\t等价于[^0-9] |\tD不能匹配'sina1'中的1\n[b] |\t退格直接量(特例) \n\n# 重复\n\n\n字符 | \t描述 | \t                    示例\n-|-|-\n{n,m} | \t匹配至少n次,但不超过m次,n和m必须是非负整数,且n<=m |  `/\\d{4,6}/`匹配4-6位0-9的数字\n{n,} |  匹配至少n次\to{2,} |  不匹配'Bob'中的'o',但匹配'food'中的 o. \t   \n{n} | \t    恰好匹配n次\to{2} |  不匹配'Bob'中的'o',但匹配'food'中的o.\n? | \t    匹配0次或1次,等价于{0,1} | \tzo? 匹配 \"z\" and \"zo\", 但不匹配\"zoo\".\n+ | \t    匹配1次或多次,等价于{1,} | \tzo+ 匹配 \"zo\" and \"zoo\", 但不匹配 \"z\".\n* | \t    匹配0次或多次,等价于{0,} | \tzo* 匹配 \"z\" 和 \"zoo\".\n\n# 非贪婪的重复\n当？紧跟在其他限制符（*,+,?,{n},{n,},{n,m}）后面时，匹配模式是非贪婪的。非贪婪模式是尽可能少的匹配所搜索的字符串。例如字符串\"ooooo\",\"o+?\"将匹配单个\"o\",而o+匹配所有o","slug":"正则表达式","published":1,"updated":"2021-02-28T08:15:40.333Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xg002sl5v0345k85z5","content":"<p>正则表达式的特点是：1. 灵活性、逻辑性和功能性非常的强；2. 可以迅速地用极简单的方式达到字符串的复杂控制。3. 对于刚接触的人来说，比较晦涩难懂。</p>\n<span id=\"more\"></span>\n\n<p><a href=\"http://tool.oschina.net/uploads/apidocs/jquery/regexp.html\">正则表达式全集</a>;</p>\n<h1 id=\"字面量字符-Literal-Characters\"><a href=\"#字面量字符-Literal-Characters\" class=\"headerlink\" title=\"字面量字符( Literal Characters )\"></a>字面量字符( Literal Characters )</h1><table>\n<thead>\n<tr>\n<th>字符</th>\n<th>描述</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>f</td>\n<td>换页符</td>\n<td>(u000C)</td>\n</tr>\n<tr>\n<td>n</td>\n<td>换行符</td>\n<td>(u000A)</td>\n</tr>\n<tr>\n<td>n</td>\n<td>换行符</td>\n<td>(u000A)</td>\n</tr>\n<tr>\n<td>r</td>\n<td>回车</td>\n<td>(u000D)</td>\n</tr>\n<tr>\n<td>o</td>\n<td>NUL字符</td>\n<td>(u0000)</td>\n</tr>\n<tr>\n<td>t</td>\n<td>制表符</td>\n<td>(u0009)</td>\n</tr>\n<tr>\n<td>v</td>\n<td>垂直制表符</td>\n<td>(u000B)</td>\n</tr>\n<tr>\n<td>xnn</td>\n<td>由十六进制数nn指定的拉丁字符</td>\n<td>x0A等价于n</td>\n</tr>\n<tr>\n<td>uxxxx</td>\n<td>由十六进行xxxx指定的Unicode字符</td>\n<td>u0009等价与t</td>\n</tr>\n<tr>\n<td>cX    控制字符(X的值必须是A-Z或a-z)</td>\n<td>cJ等价于换行符n</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"字符类-Character-Classes\"><a href=\"#字符类-Character-Classes\" class=\"headerlink\" title=\"字符类( Character Classes )\"></a>字符类( Character Classes )</h1><table>\n<thead>\n<tr>\n<th>字符</th>\n<th>描述</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>[xyz]</td>\n<td>匹配位于括号内的任意字符</td>\n<td>[abc]匹配’plain’中的a</td>\n</tr>\n<tr>\n<td>[^xyz]</td>\n<td>匹配不在括号之中的任意字符    [^abc]</td>\n<td>匹配’plain’中的p</td>\n</tr>\n<tr>\n<td>w</td>\n<td>等价于[a-zA-Z0-9_]</td>\n<td>w匹配’sina’中的s</td>\n</tr>\n<tr>\n<td>W</td>\n<td>等价于[^a-zA-Z0-9_]</td>\n<td>w不能匹配’sina’</td>\n</tr>\n<tr>\n<td>s</td>\n<td>任何Unicode空白符</td>\n<td>[ fnrtv]</td>\n</tr>\n<tr>\n<td>S</td>\n<td>任何非空白字符</td>\n<td>[^ fnrtv]</td>\n</tr>\n<tr>\n<td>d</td>\n<td>等价于[0-9]</td>\n<td>d匹配’sina123’中的1</td>\n</tr>\n<tr>\n<td>D</td>\n<td>等价于[^0-9]</td>\n<td>D不能匹配’sina1’中的1</td>\n</tr>\n<tr>\n<td>[b]</td>\n<td>退格直接量(特例)</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"重复\"><a href=\"#重复\" class=\"headerlink\" title=\"重复\"></a>重复</h1><table>\n<thead>\n<tr>\n<th>字符</th>\n<th>描述</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>{n,m}</td>\n<td>匹配至少n次,但不超过m次,n和m必须是非负整数,且n&lt;=m</td>\n<td><code>/\\d&#123;4,6&#125;/</code>匹配4-6位0-9的数字</td>\n</tr>\n<tr>\n<td>{n,}</td>\n<td>匹配至少n次    o{2,}</td>\n<td>不匹配’Bob’中的’o’,但匹配’food’中的 o.</td>\n</tr>\n<tr>\n<td>{n}</td>\n<td>恰好匹配n次    o{2}</td>\n<td>不匹配’Bob’中的’o’,但匹配’food’中的o.</td>\n</tr>\n<tr>\n<td>?</td>\n<td>匹配0次或1次,等价于{0,1}</td>\n<td>zo? 匹配 “z” and “zo”, 但不匹配”zoo”.</td>\n</tr>\n</tbody></table>\n<ul>\n<li>|         匹配1次或多次,等价于{1,} |     zo+ 匹配 “zo” and “zoo”, 但不匹配 “z”.</li>\n</ul>\n<ul>\n<li>|         匹配0次或多次,等价于{0,} |     zo* 匹配 “z” 和 “zoo”.</li>\n</ul>\n<h1 id=\"非贪婪的重复\"><a href=\"#非贪婪的重复\" class=\"headerlink\" title=\"非贪婪的重复\"></a>非贪婪的重复</h1><p>当？紧跟在其他限制符（*,+,?,{n},{n,},{n,m}）后面时，匹配模式是非贪婪的。非贪婪模式是尽可能少的匹配所搜索的字符串。例如字符串”ooooo”,”o+?”将匹配单个”o”,而o+匹配所有o</p>\n","site":{"data":{}},"excerpt":"<p>正则表达式的特点是：1. 灵活性、逻辑性和功能性非常的强；2. 可以迅速地用极简单的方式达到字符串的复杂控制。3. 对于刚接触的人来说，比较晦涩难懂。</p>","more":"<p><a href=\"http://tool.oschina.net/uploads/apidocs/jquery/regexp.html\">正则表达式全集</a>;</p>\n<h1 id=\"字面量字符-Literal-Characters\"><a href=\"#字面量字符-Literal-Characters\" class=\"headerlink\" title=\"字面量字符( Literal Characters )\"></a>字面量字符( Literal Characters )</h1><table>\n<thead>\n<tr>\n<th>字符</th>\n<th>描述</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>f</td>\n<td>换页符</td>\n<td>(u000C)</td>\n</tr>\n<tr>\n<td>n</td>\n<td>换行符</td>\n<td>(u000A)</td>\n</tr>\n<tr>\n<td>n</td>\n<td>换行符</td>\n<td>(u000A)</td>\n</tr>\n<tr>\n<td>r</td>\n<td>回车</td>\n<td>(u000D)</td>\n</tr>\n<tr>\n<td>o</td>\n<td>NUL字符</td>\n<td>(u0000)</td>\n</tr>\n<tr>\n<td>t</td>\n<td>制表符</td>\n<td>(u0009)</td>\n</tr>\n<tr>\n<td>v</td>\n<td>垂直制表符</td>\n<td>(u000B)</td>\n</tr>\n<tr>\n<td>xnn</td>\n<td>由十六进制数nn指定的拉丁字符</td>\n<td>x0A等价于n</td>\n</tr>\n<tr>\n<td>uxxxx</td>\n<td>由十六进行xxxx指定的Unicode字符</td>\n<td>u0009等价与t</td>\n</tr>\n<tr>\n<td>cX    控制字符(X的值必须是A-Z或a-z)</td>\n<td>cJ等价于换行符n</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"字符类-Character-Classes\"><a href=\"#字符类-Character-Classes\" class=\"headerlink\" title=\"字符类( Character Classes )\"></a>字符类( Character Classes )</h1><table>\n<thead>\n<tr>\n<th>字符</th>\n<th>描述</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>[xyz]</td>\n<td>匹配位于括号内的任意字符</td>\n<td>[abc]匹配’plain’中的a</td>\n</tr>\n<tr>\n<td>[^xyz]</td>\n<td>匹配不在括号之中的任意字符    [^abc]</td>\n<td>匹配’plain’中的p</td>\n</tr>\n<tr>\n<td>w</td>\n<td>等价于[a-zA-Z0-9_]</td>\n<td>w匹配’sina’中的s</td>\n</tr>\n<tr>\n<td>W</td>\n<td>等价于[^a-zA-Z0-9_]</td>\n<td>w不能匹配’sina’</td>\n</tr>\n<tr>\n<td>s</td>\n<td>任何Unicode空白符</td>\n<td>[ fnrtv]</td>\n</tr>\n<tr>\n<td>S</td>\n<td>任何非空白字符</td>\n<td>[^ fnrtv]</td>\n</tr>\n<tr>\n<td>d</td>\n<td>等价于[0-9]</td>\n<td>d匹配’sina123’中的1</td>\n</tr>\n<tr>\n<td>D</td>\n<td>等价于[^0-9]</td>\n<td>D不能匹配’sina1’中的1</td>\n</tr>\n<tr>\n<td>[b]</td>\n<td>退格直接量(特例)</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"重复\"><a href=\"#重复\" class=\"headerlink\" title=\"重复\"></a>重复</h1><table>\n<thead>\n<tr>\n<th>字符</th>\n<th>描述</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>{n,m}</td>\n<td>匹配至少n次,但不超过m次,n和m必须是非负整数,且n&lt;=m</td>\n<td><code>/\\d&#123;4,6&#125;/</code>匹配4-6位0-9的数字</td>\n</tr>\n<tr>\n<td>{n,}</td>\n<td>匹配至少n次    o{2,}</td>\n<td>不匹配’Bob’中的’o’,但匹配’food’中的 o.</td>\n</tr>\n<tr>\n<td>{n}</td>\n<td>恰好匹配n次    o{2}</td>\n<td>不匹配’Bob’中的’o’,但匹配’food’中的o.</td>\n</tr>\n<tr>\n<td>?</td>\n<td>匹配0次或1次,等价于{0,1}</td>\n<td>zo? 匹配 “z” and “zo”, 但不匹配”zoo”.</td>\n</tr>\n</tbody></table>\n<ul>\n<li>|         匹配1次或多次,等价于{1,} |     zo+ 匹配 “zo” and “zoo”, 但不匹配 “z”.</li>\n</ul>\n<ul>\n<li>|         匹配0次或多次,等价于{0,} |     zo* 匹配 “z” 和 “zoo”.</li>\n</ul>\n<h1 id=\"非贪婪的重复\"><a href=\"#非贪婪的重复\" class=\"headerlink\" title=\"非贪婪的重复\"></a>非贪婪的重复</h1><p>当？紧跟在其他限制符（*,+,?,{n},{n,},{n,m}）后面时，匹配模式是非贪婪的。非贪婪模式是尽可能少的匹配所搜索的字符串。例如字符串”ooooo”,”o+?”将匹配单个”o”,而o+匹配所有o</p>"},{"title":"浏览器存储机制","date":"2018-04-25T02:21:57.000Z","_content":"\nHTML5 中 Web Storage 的出现，主要是为了弥补使用 Cookie 作为本地存储的不足。**Cookie 存储的数据量非常小，而且数据会自动携带到请求头里，但服务器端可能并不关心这些数据，所以会造成带宽的浪费**。\n\nweb storage 提供了两个存储对象：localStorage 和 sessionStorage。\n\n<!--more-->\n\n## localStorage 的基本使用\n\n有两点需要注意一下。在 setItem 时，可能会达到大小限制，最好加上错误捕捉 ：\n\n```javascript\ntry {\n  localStorage.setItem(key, value);\n} catch(e) {\n  if (isQuotaExceeded(e)) {\n    // Storage full, maybe notify user or do some clean-up\n  }\n}\n\nfunction isQuotaExceeded(e) {\n  var quotaExceeded = false;\n  if (e) {\n    if (e.code) {\n      switch (e.code) {\n        case 22:\n          quotaExceeded = true;\n          break;\n        case 1014:\n          // Firefox\n          if (e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n            quotaExceeded = true;\n          }\n          break;\n      }\n    } else if (e.number === -2147024882) {\n      // Internet Explorer 8\n      quotaExceeded = true;\n    }\n  }\n  return quotaExceeded;\n```\n\n另外在存储容量快满时，会造成 getItem 性能急剧下降\n\n## sessionStorage,localStorage,cookie 区别\n\n**区别如下：**\n\n1. 都会在浏览器端保存，有大小限制，同源限制。\n2. cookie 会在请求时发送到服务器，作为会话标识，服务器可修改 cookie；web storage 不会发送到服务器，cookie 有 path 概念，子路径可以访问父路径 cookie，父路径不能访问子路径 cookie。\n3. localStorage 的修改会促发其他文档窗口的`update`事件，localStorage 可以永久存储，而且同源下数据多窗口可以共享。\n4. cookie 有 secure 属性要求 HTTPS 传输。\n5. 共享:sessionStorage 不能共享，localStorage 在同源文档之间共享，cookie 在同源且符合 path 规则的文档之间共享\n6. 浏览器不能保存超过 300 个 cookie，单个服务器不能超过 20 个，每个 cookie 不能超过 4k。web storage 大小支持能达到 5M。\n7. sessionStorage 存储的数据仅在本次会话有用，会话结束之后会自动失效，而且数据仅在当前窗口有效，同一源下新窗口也访问不到其他窗口基于 sessionStorage 存储的数据。也是由这些特性导致 sessionStorage 的使用场景较少。\n8. 有效期：cookie 在设置的有效期内有效，默认为浏览器关闭；sessionStorage 在窗口关闭前有效，localStorage 长期有效，直到用户删除\n\ncookie 和 session 都是用来跟踪浏览器用户身份的会话方式。\n\n## cookie 机制\n\n- cookie 数据始终在同源的 http 请求中携带（即使不需要），即 cookie 在浏览器和服务器间来回传递。cookie 数据还有路径（path）的概念，可以限制 cookie 只属于某个路径下\n- 如果不在浏览器中设置过期时间，cookie 会被保存在内存中，生命周期随浏览器的关闭而结束，这种 cookie 称为会话 cookie，如果设置了 cookie 过期时间会保存在硬盘中，关闭浏览器之后，cookie 数据仍然存在，直到过期时间结束才消失。\n- cookie 是服务器发给客户端的特殊信息，cookie 是以文本的方式保存在客户端，每次请求时会带上它。\n\n### 第一方 cookie 和 第三方 cookie 的区别\n\n第一方 cookie 是由地址栏中列出的网站域设置的 Cookie，而第三方 cookie 来自于在网页上嵌入广告或图片等项的其他域来源。\n\n访问 www.a.com 这个网址，这个网站设置了一个 Cookie，这个 cookie 也只能被 www.a.com 这个域下面的网页读取，这就是第一方 cookie。\n\n如果访问 www.a.com 这个网站，这个网站有用到 www.b.com 的图片，浏览器在 www.b.com 请求图片的时候，www.b.com 设置了一个 cookie，那这个 cookie 只能被 www.b.com 这个域访问，反而不能被 www.a.com 的域访问，这个就是第三方 cookie。\n\n### 需注意的 cookie 的安全性\n\n- value：用于保存用户登录态，应该将该值加密，不能使用明文的用户标识\n- http-only：不能通过 JS 访问 Cookie，减少 XSS 攻击\n- secure：只能在协议为 https 的请求中携带\n- same-site：规定浏览器不能在跨域请求携带 cookie，减少 CSRF 攻击\n\n## session 机制\n\n当服务器收到请求需要创建 seesion 对象时，首先会检查客户端请求是否包含 sessionId。如果有 seesionId,服务器将根据该 id 返回对象的 session 对象，如果没有 sessionid,服务器将会创建新的 session 对象，并把 sessionid 再本次响应中返回给客户端。通常使用 cookie 方式存储 sessionid 到客户端，再交互中浏览器按照规则将 sessionid 发给服务端。如果用户禁用 cookie，则要使用 URL 重写，可以通过 response.encodeURL(url)进行实现；API 对 encodeURL 的结束为，当浏览器支持 Cookie 时，url 不做任何处理；当浏览器不支持 Cookie 时，url 不做任何处理；当浏览器不支持 Cookie 的时候，将会重写 URL 将 seesionid 拼接到访问地址之后。\n\n## 存储内容\n\ncookie 只能保存字符串，以文本的方式；session 通过类型与 Hashtable 的数据结构来保存，能支持任何类型的对象（session 中可含有多个对象）。\n\n## 存储的大小\n\n- cookie:单个 cookie 保存的数据不能超过 4kb;\n- session:大小没有限制。\n\n## sessionStorage\n\n是一个 HTML5 新增的一个会话储存对象，用于临时保存同一个窗口（或标签页）的数据，再关闭窗口或关闭标签页之后会将删除这些数据。\n\n在 JavaScript 中可以通过 window。sessionStorage 或 sessionStrorage\n\n非常适合 SPA，可以方便再各业务模块进行传值\n\n不在不同的浏览器窗口中共享，即使是同一个页面；\n\n## localStorage\n\nlocalStorage 存储的数据是永久性的。\n\n## Service Worker\n\n`Service Worker`本质上充当 web 应用程序与浏览器之间的代理服务器，也可以在网络可用是作为浏览器和网络之间的代理。他们旨在是的能够创建有效的离线体验。拦截网络请求并给予网络是否可用以及更新的资源是否驻留在服务器上来采取适当的动作。他们还允许访问推送通知和后台同步 API\n\n## 浏览器缓存读取规则\n\n可以分成 Service Worker、Memory Cache、Disk Cache 和 Push Cache，那请求的时候 from memory cache 和 from disk cache 的依据是什么，哪些数据什么时候存放在 Memory Cache 和 Disk Cache 中？\n\n总的来说:\n\n1. 如果开启了 service worker 首先会从 service worker 中拿\n2. 如果新开一个以前打开过的页面的缓存会从 disk cache 中拿（前提是命中强缓存）\n3. 刷新当前页面时浏览器会根据当前运行环境内存来决定是从 memory cache 还是 disk cache 中拿\n","source":"_posts/浏览器存储机制.md","raw":"---\ntitle: 浏览器存储机制\ndate: 2018-04-25 10:21:57\ncategories: Web\n---\n\nHTML5 中 Web Storage 的出现，主要是为了弥补使用 Cookie 作为本地存储的不足。**Cookie 存储的数据量非常小，而且数据会自动携带到请求头里，但服务器端可能并不关心这些数据，所以会造成带宽的浪费**。\n\nweb storage 提供了两个存储对象：localStorage 和 sessionStorage。\n\n<!--more-->\n\n## localStorage 的基本使用\n\n有两点需要注意一下。在 setItem 时，可能会达到大小限制，最好加上错误捕捉 ：\n\n```javascript\ntry {\n  localStorage.setItem(key, value);\n} catch(e) {\n  if (isQuotaExceeded(e)) {\n    // Storage full, maybe notify user or do some clean-up\n  }\n}\n\nfunction isQuotaExceeded(e) {\n  var quotaExceeded = false;\n  if (e) {\n    if (e.code) {\n      switch (e.code) {\n        case 22:\n          quotaExceeded = true;\n          break;\n        case 1014:\n          // Firefox\n          if (e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n            quotaExceeded = true;\n          }\n          break;\n      }\n    } else if (e.number === -2147024882) {\n      // Internet Explorer 8\n      quotaExceeded = true;\n    }\n  }\n  return quotaExceeded;\n```\n\n另外在存储容量快满时，会造成 getItem 性能急剧下降\n\n## sessionStorage,localStorage,cookie 区别\n\n**区别如下：**\n\n1. 都会在浏览器端保存，有大小限制，同源限制。\n2. cookie 会在请求时发送到服务器，作为会话标识，服务器可修改 cookie；web storage 不会发送到服务器，cookie 有 path 概念，子路径可以访问父路径 cookie，父路径不能访问子路径 cookie。\n3. localStorage 的修改会促发其他文档窗口的`update`事件，localStorage 可以永久存储，而且同源下数据多窗口可以共享。\n4. cookie 有 secure 属性要求 HTTPS 传输。\n5. 共享:sessionStorage 不能共享，localStorage 在同源文档之间共享，cookie 在同源且符合 path 规则的文档之间共享\n6. 浏览器不能保存超过 300 个 cookie，单个服务器不能超过 20 个，每个 cookie 不能超过 4k。web storage 大小支持能达到 5M。\n7. sessionStorage 存储的数据仅在本次会话有用，会话结束之后会自动失效，而且数据仅在当前窗口有效，同一源下新窗口也访问不到其他窗口基于 sessionStorage 存储的数据。也是由这些特性导致 sessionStorage 的使用场景较少。\n8. 有效期：cookie 在设置的有效期内有效，默认为浏览器关闭；sessionStorage 在窗口关闭前有效，localStorage 长期有效，直到用户删除\n\ncookie 和 session 都是用来跟踪浏览器用户身份的会话方式。\n\n## cookie 机制\n\n- cookie 数据始终在同源的 http 请求中携带（即使不需要），即 cookie 在浏览器和服务器间来回传递。cookie 数据还有路径（path）的概念，可以限制 cookie 只属于某个路径下\n- 如果不在浏览器中设置过期时间，cookie 会被保存在内存中，生命周期随浏览器的关闭而结束，这种 cookie 称为会话 cookie，如果设置了 cookie 过期时间会保存在硬盘中，关闭浏览器之后，cookie 数据仍然存在，直到过期时间结束才消失。\n- cookie 是服务器发给客户端的特殊信息，cookie 是以文本的方式保存在客户端，每次请求时会带上它。\n\n### 第一方 cookie 和 第三方 cookie 的区别\n\n第一方 cookie 是由地址栏中列出的网站域设置的 Cookie，而第三方 cookie 来自于在网页上嵌入广告或图片等项的其他域来源。\n\n访问 www.a.com 这个网址，这个网站设置了一个 Cookie，这个 cookie 也只能被 www.a.com 这个域下面的网页读取，这就是第一方 cookie。\n\n如果访问 www.a.com 这个网站，这个网站有用到 www.b.com 的图片，浏览器在 www.b.com 请求图片的时候，www.b.com 设置了一个 cookie，那这个 cookie 只能被 www.b.com 这个域访问，反而不能被 www.a.com 的域访问，这个就是第三方 cookie。\n\n### 需注意的 cookie 的安全性\n\n- value：用于保存用户登录态，应该将该值加密，不能使用明文的用户标识\n- http-only：不能通过 JS 访问 Cookie，减少 XSS 攻击\n- secure：只能在协议为 https 的请求中携带\n- same-site：规定浏览器不能在跨域请求携带 cookie，减少 CSRF 攻击\n\n## session 机制\n\n当服务器收到请求需要创建 seesion 对象时，首先会检查客户端请求是否包含 sessionId。如果有 seesionId,服务器将根据该 id 返回对象的 session 对象，如果没有 sessionid,服务器将会创建新的 session 对象，并把 sessionid 再本次响应中返回给客户端。通常使用 cookie 方式存储 sessionid 到客户端，再交互中浏览器按照规则将 sessionid 发给服务端。如果用户禁用 cookie，则要使用 URL 重写，可以通过 response.encodeURL(url)进行实现；API 对 encodeURL 的结束为，当浏览器支持 Cookie 时，url 不做任何处理；当浏览器不支持 Cookie 时，url 不做任何处理；当浏览器不支持 Cookie 的时候，将会重写 URL 将 seesionid 拼接到访问地址之后。\n\n## 存储内容\n\ncookie 只能保存字符串，以文本的方式；session 通过类型与 Hashtable 的数据结构来保存，能支持任何类型的对象（session 中可含有多个对象）。\n\n## 存储的大小\n\n- cookie:单个 cookie 保存的数据不能超过 4kb;\n- session:大小没有限制。\n\n## sessionStorage\n\n是一个 HTML5 新增的一个会话储存对象，用于临时保存同一个窗口（或标签页）的数据，再关闭窗口或关闭标签页之后会将删除这些数据。\n\n在 JavaScript 中可以通过 window。sessionStorage 或 sessionStrorage\n\n非常适合 SPA，可以方便再各业务模块进行传值\n\n不在不同的浏览器窗口中共享，即使是同一个页面；\n\n## localStorage\n\nlocalStorage 存储的数据是永久性的。\n\n## Service Worker\n\n`Service Worker`本质上充当 web 应用程序与浏览器之间的代理服务器，也可以在网络可用是作为浏览器和网络之间的代理。他们旨在是的能够创建有效的离线体验。拦截网络请求并给予网络是否可用以及更新的资源是否驻留在服务器上来采取适当的动作。他们还允许访问推送通知和后台同步 API\n\n## 浏览器缓存读取规则\n\n可以分成 Service Worker、Memory Cache、Disk Cache 和 Push Cache，那请求的时候 from memory cache 和 from disk cache 的依据是什么，哪些数据什么时候存放在 Memory Cache 和 Disk Cache 中？\n\n总的来说:\n\n1. 如果开启了 service worker 首先会从 service worker 中拿\n2. 如果新开一个以前打开过的页面的缓存会从 disk cache 中拿（前提是命中强缓存）\n3. 刷新当前页面时浏览器会根据当前运行环境内存来决定是从 memory cache 还是 disk cache 中拿\n","slug":"浏览器存储机制","published":1,"updated":"2021-04-13T12:53:53.873Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xh002ul5v0eugh5cg6","content":"<p>HTML5 中 Web Storage 的出现，主要是为了弥补使用 Cookie 作为本地存储的不足。<strong>Cookie 存储的数据量非常小，而且数据会自动携带到请求头里，但服务器端可能并不关心这些数据，所以会造成带宽的浪费</strong>。</p>\n<p>web storage 提供了两个存储对象：localStorage 和 sessionStorage。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"localStorage-的基本使用\"><a href=\"#localStorage-的基本使用\" class=\"headerlink\" title=\"localStorage 的基本使用\"></a>localStorage 的基本使用</h2><p>有两点需要注意一下。在 setItem 时，可能会达到大小限制，最好加上错误捕捉 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">localStorage</span>.setItem(key, value);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span>(e) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isQuotaExceeded(e)) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Storage full, maybe notify user or do some clean-up</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isQuotaExceeded</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> quotaExceeded = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.code) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (e.code) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">22</span>:</span><br><span class=\"line\">          quotaExceeded = <span class=\"literal\">true</span>;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1014</span>:</span><br><span class=\"line\">          <span class=\"comment\">// Firefox</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (e.name === <span class=\"string\">&#x27;NS_ERROR_DOM_QUOTA_REACHED&#x27;</span>) &#123;</span><br><span class=\"line\">            quotaExceeded = <span class=\"literal\">true</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e.number === -<span class=\"number\">2147024882</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Internet Explorer 8</span></span><br><span class=\"line\">      quotaExceeded = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> quotaExceeded;</span><br></pre></td></tr></table></figure>\n\n<p>另外在存储容量快满时，会造成 getItem 性能急剧下降</p>\n<h2 id=\"sessionStorage-localStorage-cookie-区别\"><a href=\"#sessionStorage-localStorage-cookie-区别\" class=\"headerlink\" title=\"sessionStorage,localStorage,cookie 区别\"></a>sessionStorage,localStorage,cookie 区别</h2><p><strong>区别如下：</strong></p>\n<ol>\n<li>都会在浏览器端保存，有大小限制，同源限制。</li>\n<li>cookie 会在请求时发送到服务器，作为会话标识，服务器可修改 cookie；web storage 不会发送到服务器，cookie 有 path 概念，子路径可以访问父路径 cookie，父路径不能访问子路径 cookie。</li>\n<li>localStorage 的修改会促发其他文档窗口的<code>update</code>事件，localStorage 可以永久存储，而且同源下数据多窗口可以共享。</li>\n<li>cookie 有 secure 属性要求 HTTPS 传输。</li>\n<li>共享:sessionStorage 不能共享，localStorage 在同源文档之间共享，cookie 在同源且符合 path 规则的文档之间共享</li>\n<li>浏览器不能保存超过 300 个 cookie，单个服务器不能超过 20 个，每个 cookie 不能超过 4k。web storage 大小支持能达到 5M。</li>\n<li>sessionStorage 存储的数据仅在本次会话有用，会话结束之后会自动失效，而且数据仅在当前窗口有效，同一源下新窗口也访问不到其他窗口基于 sessionStorage 存储的数据。也是由这些特性导致 sessionStorage 的使用场景较少。</li>\n<li>有效期：cookie 在设置的有效期内有效，默认为浏览器关闭；sessionStorage 在窗口关闭前有效，localStorage 长期有效，直到用户删除</li>\n</ol>\n<p>cookie 和 session 都是用来跟踪浏览器用户身份的会话方式。</p>\n<h2 id=\"cookie-机制\"><a href=\"#cookie-机制\" class=\"headerlink\" title=\"cookie 机制\"></a>cookie 机制</h2><ul>\n<li>cookie 数据始终在同源的 http 请求中携带（即使不需要），即 cookie 在浏览器和服务器间来回传递。cookie 数据还有路径（path）的概念，可以限制 cookie 只属于某个路径下</li>\n<li>如果不在浏览器中设置过期时间，cookie 会被保存在内存中，生命周期随浏览器的关闭而结束，这种 cookie 称为会话 cookie，如果设置了 cookie 过期时间会保存在硬盘中，关闭浏览器之后，cookie 数据仍然存在，直到过期时间结束才消失。</li>\n<li>cookie 是服务器发给客户端的特殊信息，cookie 是以文本的方式保存在客户端，每次请求时会带上它。</li>\n</ul>\n<h3 id=\"第一方-cookie-和-第三方-cookie-的区别\"><a href=\"#第一方-cookie-和-第三方-cookie-的区别\" class=\"headerlink\" title=\"第一方 cookie 和 第三方 cookie 的区别\"></a>第一方 cookie 和 第三方 cookie 的区别</h3><p>第一方 cookie 是由地址栏中列出的网站域设置的 Cookie，而第三方 cookie 来自于在网页上嵌入广告或图片等项的其他域来源。</p>\n<p>访问 <a href=\"http://www.a.com/\">www.a.com</a> 这个网址，这个网站设置了一个 Cookie，这个 cookie 也只能被 <a href=\"http://www.a.com/\">www.a.com</a> 这个域下面的网页读取，这就是第一方 cookie。</p>\n<p>如果访问 <a href=\"http://www.a.com/\">www.a.com</a> 这个网站，这个网站有用到 <a href=\"http://www.b.com/\">www.b.com</a> 的图片，浏览器在 <a href=\"http://www.b.com/\">www.b.com</a> 请求图片的时候，<a href=\"http://www.b.com/\">www.b.com</a> 设置了一个 cookie，那这个 cookie 只能被 <a href=\"http://www.b.com/\">www.b.com</a> 这个域访问，反而不能被 <a href=\"http://www.a.com/\">www.a.com</a> 的域访问，这个就是第三方 cookie。</p>\n<h3 id=\"需注意的-cookie-的安全性\"><a href=\"#需注意的-cookie-的安全性\" class=\"headerlink\" title=\"需注意的 cookie 的安全性\"></a>需注意的 cookie 的安全性</h3><ul>\n<li>value：用于保存用户登录态，应该将该值加密，不能使用明文的用户标识</li>\n<li>http-only：不能通过 JS 访问 Cookie，减少 XSS 攻击</li>\n<li>secure：只能在协议为 https 的请求中携带</li>\n<li>same-site：规定浏览器不能在跨域请求携带 cookie，减少 CSRF 攻击</li>\n</ul>\n<h2 id=\"session-机制\"><a href=\"#session-机制\" class=\"headerlink\" title=\"session 机制\"></a>session 机制</h2><p>当服务器收到请求需要创建 seesion 对象时，首先会检查客户端请求是否包含 sessionId。如果有 seesionId,服务器将根据该 id 返回对象的 session 对象，如果没有 sessionid,服务器将会创建新的 session 对象，并把 sessionid 再本次响应中返回给客户端。通常使用 cookie 方式存储 sessionid 到客户端，再交互中浏览器按照规则将 sessionid 发给服务端。如果用户禁用 cookie，则要使用 URL 重写，可以通过 response.encodeURL(url)进行实现；API 对 encodeURL 的结束为，当浏览器支持 Cookie 时，url 不做任何处理；当浏览器不支持 Cookie 时，url 不做任何处理；当浏览器不支持 Cookie 的时候，将会重写 URL 将 seesionid 拼接到访问地址之后。</p>\n<h2 id=\"存储内容\"><a href=\"#存储内容\" class=\"headerlink\" title=\"存储内容\"></a>存储内容</h2><p>cookie 只能保存字符串，以文本的方式；session 通过类型与 Hashtable 的数据结构来保存，能支持任何类型的对象（session 中可含有多个对象）。</p>\n<h2 id=\"存储的大小\"><a href=\"#存储的大小\" class=\"headerlink\" title=\"存储的大小\"></a>存储的大小</h2><ul>\n<li>cookie:单个 cookie 保存的数据不能超过 4kb;</li>\n<li>session:大小没有限制。</li>\n</ul>\n<h2 id=\"sessionStorage\"><a href=\"#sessionStorage\" class=\"headerlink\" title=\"sessionStorage\"></a>sessionStorage</h2><p>是一个 HTML5 新增的一个会话储存对象，用于临时保存同一个窗口（或标签页）的数据，再关闭窗口或关闭标签页之后会将删除这些数据。</p>\n<p>在 JavaScript 中可以通过 window。sessionStorage 或 sessionStrorage</p>\n<p>非常适合 SPA，可以方便再各业务模块进行传值</p>\n<p>不在不同的浏览器窗口中共享，即使是同一个页面；</p>\n<h2 id=\"localStorage\"><a href=\"#localStorage\" class=\"headerlink\" title=\"localStorage\"></a>localStorage</h2><p>localStorage 存储的数据是永久性的。</p>\n<h2 id=\"Service-Worker\"><a href=\"#Service-Worker\" class=\"headerlink\" title=\"Service Worker\"></a>Service Worker</h2><p><code>Service Worker</code>本质上充当 web 应用程序与浏览器之间的代理服务器，也可以在网络可用是作为浏览器和网络之间的代理。他们旨在是的能够创建有效的离线体验。拦截网络请求并给予网络是否可用以及更新的资源是否驻留在服务器上来采取适当的动作。他们还允许访问推送通知和后台同步 API</p>\n<h2 id=\"浏览器缓存读取规则\"><a href=\"#浏览器缓存读取规则\" class=\"headerlink\" title=\"浏览器缓存读取规则\"></a>浏览器缓存读取规则</h2><p>可以分成 Service Worker、Memory Cache、Disk Cache 和 Push Cache，那请求的时候 from memory cache 和 from disk cache 的依据是什么，哪些数据什么时候存放在 Memory Cache 和 Disk Cache 中？</p>\n<p>总的来说:</p>\n<ol>\n<li>如果开启了 service worker 首先会从 service worker 中拿</li>\n<li>如果新开一个以前打开过的页面的缓存会从 disk cache 中拿（前提是命中强缓存）</li>\n<li>刷新当前页面时浏览器会根据当前运行环境内存来决定是从 memory cache 还是 disk cache 中拿</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>HTML5 中 Web Storage 的出现，主要是为了弥补使用 Cookie 作为本地存储的不足。<strong>Cookie 存储的数据量非常小，而且数据会自动携带到请求头里，但服务器端可能并不关心这些数据，所以会造成带宽的浪费</strong>。</p>\n<p>web storage 提供了两个存储对象：localStorage 和 sessionStorage。</p>","more":"<h2 id=\"localStorage-的基本使用\"><a href=\"#localStorage-的基本使用\" class=\"headerlink\" title=\"localStorage 的基本使用\"></a>localStorage 的基本使用</h2><p>有两点需要注意一下。在 setItem 时，可能会达到大小限制，最好加上错误捕捉 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">localStorage</span>.setItem(key, value);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span>(e) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isQuotaExceeded(e)) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Storage full, maybe notify user or do some clean-up</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isQuotaExceeded</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> quotaExceeded = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (e.code) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (e.code) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">22</span>:</span><br><span class=\"line\">          quotaExceeded = <span class=\"literal\">true</span>;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1014</span>:</span><br><span class=\"line\">          <span class=\"comment\">// Firefox</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (e.name === <span class=\"string\">&#x27;NS_ERROR_DOM_QUOTA_REACHED&#x27;</span>) &#123;</span><br><span class=\"line\">            quotaExceeded = <span class=\"literal\">true</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e.number === -<span class=\"number\">2147024882</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Internet Explorer 8</span></span><br><span class=\"line\">      quotaExceeded = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> quotaExceeded;</span><br></pre></td></tr></table></figure>\n\n<p>另外在存储容量快满时，会造成 getItem 性能急剧下降</p>\n<h2 id=\"sessionStorage-localStorage-cookie-区别\"><a href=\"#sessionStorage-localStorage-cookie-区别\" class=\"headerlink\" title=\"sessionStorage,localStorage,cookie 区别\"></a>sessionStorage,localStorage,cookie 区别</h2><p><strong>区别如下：</strong></p>\n<ol>\n<li>都会在浏览器端保存，有大小限制，同源限制。</li>\n<li>cookie 会在请求时发送到服务器，作为会话标识，服务器可修改 cookie；web storage 不会发送到服务器，cookie 有 path 概念，子路径可以访问父路径 cookie，父路径不能访问子路径 cookie。</li>\n<li>localStorage 的修改会促发其他文档窗口的<code>update</code>事件，localStorage 可以永久存储，而且同源下数据多窗口可以共享。</li>\n<li>cookie 有 secure 属性要求 HTTPS 传输。</li>\n<li>共享:sessionStorage 不能共享，localStorage 在同源文档之间共享，cookie 在同源且符合 path 规则的文档之间共享</li>\n<li>浏览器不能保存超过 300 个 cookie，单个服务器不能超过 20 个，每个 cookie 不能超过 4k。web storage 大小支持能达到 5M。</li>\n<li>sessionStorage 存储的数据仅在本次会话有用，会话结束之后会自动失效，而且数据仅在当前窗口有效，同一源下新窗口也访问不到其他窗口基于 sessionStorage 存储的数据。也是由这些特性导致 sessionStorage 的使用场景较少。</li>\n<li>有效期：cookie 在设置的有效期内有效，默认为浏览器关闭；sessionStorage 在窗口关闭前有效，localStorage 长期有效，直到用户删除</li>\n</ol>\n<p>cookie 和 session 都是用来跟踪浏览器用户身份的会话方式。</p>\n<h2 id=\"cookie-机制\"><a href=\"#cookie-机制\" class=\"headerlink\" title=\"cookie 机制\"></a>cookie 机制</h2><ul>\n<li>cookie 数据始终在同源的 http 请求中携带（即使不需要），即 cookie 在浏览器和服务器间来回传递。cookie 数据还有路径（path）的概念，可以限制 cookie 只属于某个路径下</li>\n<li>如果不在浏览器中设置过期时间，cookie 会被保存在内存中，生命周期随浏览器的关闭而结束，这种 cookie 称为会话 cookie，如果设置了 cookie 过期时间会保存在硬盘中，关闭浏览器之后，cookie 数据仍然存在，直到过期时间结束才消失。</li>\n<li>cookie 是服务器发给客户端的特殊信息，cookie 是以文本的方式保存在客户端，每次请求时会带上它。</li>\n</ul>\n<h3 id=\"第一方-cookie-和-第三方-cookie-的区别\"><a href=\"#第一方-cookie-和-第三方-cookie-的区别\" class=\"headerlink\" title=\"第一方 cookie 和 第三方 cookie 的区别\"></a>第一方 cookie 和 第三方 cookie 的区别</h3><p>第一方 cookie 是由地址栏中列出的网站域设置的 Cookie，而第三方 cookie 来自于在网页上嵌入广告或图片等项的其他域来源。</p>\n<p>访问 <a href=\"http://www.a.com/\">www.a.com</a> 这个网址，这个网站设置了一个 Cookie，这个 cookie 也只能被 <a href=\"http://www.a.com/\">www.a.com</a> 这个域下面的网页读取，这就是第一方 cookie。</p>\n<p>如果访问 <a href=\"http://www.a.com/\">www.a.com</a> 这个网站，这个网站有用到 <a href=\"http://www.b.com/\">www.b.com</a> 的图片，浏览器在 <a href=\"http://www.b.com/\">www.b.com</a> 请求图片的时候，<a href=\"http://www.b.com/\">www.b.com</a> 设置了一个 cookie，那这个 cookie 只能被 <a href=\"http://www.b.com/\">www.b.com</a> 这个域访问，反而不能被 <a href=\"http://www.a.com/\">www.a.com</a> 的域访问，这个就是第三方 cookie。</p>\n<h3 id=\"需注意的-cookie-的安全性\"><a href=\"#需注意的-cookie-的安全性\" class=\"headerlink\" title=\"需注意的 cookie 的安全性\"></a>需注意的 cookie 的安全性</h3><ul>\n<li>value：用于保存用户登录态，应该将该值加密，不能使用明文的用户标识</li>\n<li>http-only：不能通过 JS 访问 Cookie，减少 XSS 攻击</li>\n<li>secure：只能在协议为 https 的请求中携带</li>\n<li>same-site：规定浏览器不能在跨域请求携带 cookie，减少 CSRF 攻击</li>\n</ul>\n<h2 id=\"session-机制\"><a href=\"#session-机制\" class=\"headerlink\" title=\"session 机制\"></a>session 机制</h2><p>当服务器收到请求需要创建 seesion 对象时，首先会检查客户端请求是否包含 sessionId。如果有 seesionId,服务器将根据该 id 返回对象的 session 对象，如果没有 sessionid,服务器将会创建新的 session 对象，并把 sessionid 再本次响应中返回给客户端。通常使用 cookie 方式存储 sessionid 到客户端，再交互中浏览器按照规则将 sessionid 发给服务端。如果用户禁用 cookie，则要使用 URL 重写，可以通过 response.encodeURL(url)进行实现；API 对 encodeURL 的结束为，当浏览器支持 Cookie 时，url 不做任何处理；当浏览器不支持 Cookie 时，url 不做任何处理；当浏览器不支持 Cookie 的时候，将会重写 URL 将 seesionid 拼接到访问地址之后。</p>\n<h2 id=\"存储内容\"><a href=\"#存储内容\" class=\"headerlink\" title=\"存储内容\"></a>存储内容</h2><p>cookie 只能保存字符串，以文本的方式；session 通过类型与 Hashtable 的数据结构来保存，能支持任何类型的对象（session 中可含有多个对象）。</p>\n<h2 id=\"存储的大小\"><a href=\"#存储的大小\" class=\"headerlink\" title=\"存储的大小\"></a>存储的大小</h2><ul>\n<li>cookie:单个 cookie 保存的数据不能超过 4kb;</li>\n<li>session:大小没有限制。</li>\n</ul>\n<h2 id=\"sessionStorage\"><a href=\"#sessionStorage\" class=\"headerlink\" title=\"sessionStorage\"></a>sessionStorage</h2><p>是一个 HTML5 新增的一个会话储存对象，用于临时保存同一个窗口（或标签页）的数据，再关闭窗口或关闭标签页之后会将删除这些数据。</p>\n<p>在 JavaScript 中可以通过 window。sessionStorage 或 sessionStrorage</p>\n<p>非常适合 SPA，可以方便再各业务模块进行传值</p>\n<p>不在不同的浏览器窗口中共享，即使是同一个页面；</p>\n<h2 id=\"localStorage\"><a href=\"#localStorage\" class=\"headerlink\" title=\"localStorage\"></a>localStorage</h2><p>localStorage 存储的数据是永久性的。</p>\n<h2 id=\"Service-Worker\"><a href=\"#Service-Worker\" class=\"headerlink\" title=\"Service Worker\"></a>Service Worker</h2><p><code>Service Worker</code>本质上充当 web 应用程序与浏览器之间的代理服务器，也可以在网络可用是作为浏览器和网络之间的代理。他们旨在是的能够创建有效的离线体验。拦截网络请求并给予网络是否可用以及更新的资源是否驻留在服务器上来采取适当的动作。他们还允许访问推送通知和后台同步 API</p>\n<h2 id=\"浏览器缓存读取规则\"><a href=\"#浏览器缓存读取规则\" class=\"headerlink\" title=\"浏览器缓存读取规则\"></a>浏览器缓存读取规则</h2><p>可以分成 Service Worker、Memory Cache、Disk Cache 和 Push Cache，那请求的时候 from memory cache 和 from disk cache 的依据是什么，哪些数据什么时候存放在 Memory Cache 和 Disk Cache 中？</p>\n<p>总的来说:</p>\n<ol>\n<li>如果开启了 service worker 首先会从 service worker 中拿</li>\n<li>如果新开一个以前打开过的页面的缓存会从 disk cache 中拿（前提是命中强缓存）</li>\n<li>刷新当前页面时浏览器会根据当前运行环境内存来决定是从 memory cache 还是 disk cache 中拿</li>\n</ol>"},{"title":"浏览器渲染与解析","date":"2018-05-17T01:47:28.000Z","_content":"\n以前在项目中遇到过‘监听浏览器的前进后退重新执行 JS’的需求的场景，所以现在综合一些资料和自己的测试进行总结一下。\n\n<!--more-->\n\n## 客户端渲染机制\n\n浏览器的渲染机制一般分为以下几个步骤\n\n1. 处理 HTML 并构建 DOM 树\n2. 处理CSS标记并构建CSSOM树\n3. 将DOM与CSSOM合成一颗渲染树\n4. 根据渲染树布局，以计算每个节点的几何信息\n5. 将各个节点绘制到屏幕上\n\n## 浏览器的线程\n\n浏览器是多线程的，他们在内核控制下相互配合以保持同步，一个浏览器至少实现三个常驻线程：javascript引擎线程、GUI渲染线程、浏览器事件触发线程\n- GUI渲染线程：负责渲染浏览器界面的HTML元素，当界面需要重绘或者回流时，该线程就会执行，在javascript引擎运行脚本期间，GUI渲染线程都是出于挂起转态的，也就是说被冻结了\n- javascript引擎线程：主要负责处理javascript脚本程序\n- 定时器触发线程：浏览器定时器并不是由javascript引擎计数的，javascript引擎是单线程的，如果处于阻塞线程状态就会影响计时的准确，因此浏览器通过单独线程来计时并触发定时\n- 事件触发线程：当一个事件被触发时该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理。这些事件包含当前执行的代码，例如定时任务，流量亲耐内核的其他线程如鼠标点击、ajax异步请求等。由于JS的单线程关系所有这些世间都得排队等待JS引擎处理。定时块任何和ajax请求等这些异步队列，事件触发线程只是在到达定时事件或者ajax请求成功后，把回调函数放到事件队列当中\n- 异步HTTP请求线程：在XMLHttpRequests在链接后通过浏览器新开一个线程请求，将检测到状态变更时，如果设置有回调函数，异步线程就产生个状态变成事件放到javascript引擎处理队列中等待处理，在发起一个异步请求时，http请求线程负责去请求服务器，有了响应后，事件触发线程再把回调函数放到事件队列当中\n\n## 构建DOM树与CSSOM树\n浏览器凶网络或硬盘中获得HTML字节数据后会经过一个流程讲直接解析成DOM树\n\n- 编码：先将HTML的原始字节数据转换为文件指定编码的字符\n- 令牌化：然后浏览器会根据HTML规范来将字符串转换成各种令牌（如`<html>、<body>`这样的标签以及标签中的字符串和属性等都会转化为令牌，每个令牌具有特殊含义和一组规则）。令牌记录了标签的开始与结束，通过这个特性可以轻松判断一个标签是否为子标签（假设有<html>与<body>两个标签，当<html>标签的令牌还未遇到它的结束令牌</html>就遇见了<body>标签令牌，那么<body>就是<html>的子标签）。\n- 生成对象：接下来每个令牌都会被转换成定义其属性和规则对象（这个对象就是节点对象）\n- 构建完毕：DOM树构建完成，整个对象集合就像是一颗属性结构。\n\n## 构建渲染树\n在构建了DOM树和CSSOM树之后，浏览器只是拥有了两个互相独立的对象集合，DOM树描述了文档的结构和内容，CSSOM树则描述了对文档应用的样式规则，想要渲染页面，就需要将DOM树与CSSOM树结合在一起\n![network](/images/common/render.png)\n\n\n## 布局与绘制\ncss采用一种叫做盒子思维模型的思维模型来表示每个节点与其他元素之间的距离，盒子模型包括外边距（margin），内边距（padding），边框（border），内容（content），页面中的每一个标签都是一个个的盒子\n\n![network](/images/common/box.png)\n布局阶段会从渲染树的根节点开始遍历，然后确定每个节点对象在页面上的确切大小与位置，布局阶段的输出是一个盒子模型，它会精确地捕捉每个元素在屏幕内的确切位置与大小，所有相对的测量值也都会被转换成屏幕内的绝对像素值\n\n当Layout布局事件完成后，浏览器会立即发出Paint Setup与Paint事件，开始将渲染树绘制成像素，绘制所需的时间跟CSS样式的复杂度成正比\n## 浏览器前进、后退使用机制\n\n用户点击浏览器工具栏中的后退按钮，或者是移动设备上的返回键的时候，或者是 JS 执行`history.go(-1)`的时候，浏览器会在当前窗口“打开”历史记录中的前一个页面。不同的浏览器在“打开”前一个页面的表现并不同意，这和浏览器的实现以及页面本身的设置都有关系。在浏览器中，“后退到前一个页面”意味着：前一个页面的 html/js/css 等等的静态资源的请求（甚至是 ajax 动态接口请求）根本不会重新发送，直接使用缓存的响应，而不管这些金泰资源响应的缓存策略是否被设置了禁用状态。\n\n\n## history 中的操作\n\n1.  `window.history.back()`:后退\n2.  `window.history.dorward()`:前进\n3.  `window.history.go(num)`:前进或后退指定数量历史记录\n4.  `window.history.pushState(state,title,url)`:在页面中创建一个 histor 实体，直接天剑到历史记录。\n    - state:存储一个对象，可以添加相关信息，可以使用 history.state 读取其中的内容。\n    - title:历史记录的标题。\n    - url:创建的历史记录的链接，进行历史记录操作时会跳转到改链接。\n5.  `window.history.replaceState()`:修改当前的 history 实体。\n6.  `popstate`事件:history 实体改变时触发的事件。\n7.  `window.history.state`:会获得 history 实体中的 state 对象。\n\n## popstate\n\npopstate 只会在浏览器某些行为下触发，比如点击后退、前进按钮。\n\n在微信浏览器中，从一个 HTML 跳到另一个 HTML 页面后，点击浏览器返回按钮，或者在第二个页面中调用`history.back()`等返回上一页的方法，在安卓中会直接返回上一页(相当于重新加载上一页的所有内容，js 会重新执行一遍)，但苹果手机中，范湖上一页是，浏览器会读取缓存中的页面内容，js 不会重新执行，在此进入这个页面不会触发 onload 事件。\n\n```javascript\n//强制刷新：\nwindow.addEventListener(\n  'popstate',\n  function(e) {\n    //检测到用户点击浏览器返回按钮，进行操作\n    console.log(document.referrer);\n\n    //使用href的形式去用跳转的形式，跳转到上一页\n    document.location.href = document.referrer;\n  },\n  false\n);\nvar state = {\n  title: '',\n  url: ''\n};\nwindow.history.pushState(state, '', '');\n```\n\n## pageshow\n\nonpageshow 事件在页面显示时触发，如果页面不在“往返缓存”中，改时间会在 onload 后触发，在 onpageshow 事件中，可以利用 event.persisted\n\n```javascript\n    window.addEventListener('pageshow'.function(evernt){\n        alert(event.persisted);\n        if(event.persisted) location.reload();//如果检测到页面是从“往返缓存”中读取的，刷新页面。\n    });\n```\n\n## unload\n\n指定 unload 事件处理程序的页面会被自动排除在“往返缓存”之外，即使事件处理程序是空白的，原因在于，unload 最长用于撤销 load 中所执行的操作，而跳过 load 后再次显示页面很有可能会导致页面不正常。\n\n## 从输入 URL 到 页面加载发生了什么\n\n发生过程：\n\n- 查看 web 缓存\n- DNS 解析\n- TCP 连接\n- 发送 HTTP 请求\n- 服务器处理请求并返回 HTTP 报文\n- 浏览器解析渲染页面\n- 连接结束\n\n### 查看 web 缓存\n\n浏览器获取了这个UR,就先去缓存当中查看，从浏览器缓存-系统缓存-路由缓存当中查。看到有个人的笔记是DNS 解析在前，但是不管是路由还是转发都应该是先从缓存中查看的\n\n当浏览器再次访问一个已经访问过的资源时，它会：\n\n1. 通过Cache-control 和 Expires 来检查是否命中强缓存，命中则直接取本地磁盘的html（状态码为200 from disk(or memory) cache,内存or磁盘）\n2. 如果没有命中强缓存，就发送请求到服务器发起请求（先进性下一步的TCP链接），服务器通过Etag 和 Last-Modify来与服务器确认返回的响应是否被更改（协商缓存）。\n3. 如果命中协商缓存，访问服务器，服务器返回 304 not modified 告诉浏览器使用本地缓存。\n4. 否则，请求网络返回最新资源。\n\n浏览器缓存的位置：\n\n1. service worker :它可以让我们自由控制哪些文件、如何匹配缓存，如何读取缓存，并且缓存是持续性的。\n2. memory cache:内存缓存，读取内存中的数据肯定比磁盘块，但是内存缓存虽然读取高效，可是缓存持续性很短，会随着进程的释放而释放，一旦关闭了 tap 页，内存中的缓存也得到了释放。\n3. disk cache：也就是存储在硬盘中的缓存，读取速度慢点，但是什么都能存储到磁盘中，比如 memory cache 胜在容量和存储时效性上。\n\n缓存实现：强缓存和协商缓存都是根据 HTTP Header 来实现的。\n\n#### 浏览器缓存机制\n\n![network](/images/problem/2.png)\n\n##### 当前缓存是否过期。\n\n如果浏览器通过某些条件 ( 条件之后再说 ) 判断出来，ok 现在这个缓存没有过期可以用，那么连请求都不会发的，直接是启用之前浏览器缓存下来的那份文件 (from memory cache). 浏览器直接通过缓存读取了出来，注意这个时候是不会向浏览器请求的！ 如果过期了就会向服务器重新发起请求，但是不一定就会重新拉取文件！\n\n##### 服务器中的文件是否改动。\n\n1. 缓存过期，文件有改动：如果服务器发现这个文件改变了那么你肯定不能再用以前浏览器的缓存了，那就返回个 200 并且带上新的文件。\n\n2. 缓存过期，文件无改动：同时如果发现虽然那个缓存虽然过期了，可你在服务器端的文件没有变过，那么服务器只会给你返回一个头信息 (304)，让你继续用你那过期的缓存，这样就节省了很多传输文件的时间带宽啥的\n\n过期了的缓存需要请求一次服务器，若服务器判断说这个文件没有改变还能用，那就返回 304。浏览器认识 304，它就会去读取过期缓存。否则就真的传一份新文件到浏览器。\n\n### DNS 解析\n\n浏览器查找域名对应的 IP 地址。互联网上每一台计算机的唯一识别是它的 IP 地址，DNS 解析就是讲网址转换为 IP 地址。\n\n查找过程：\n\n1. 浏览器搜索自己的 DNS 缓存（维护一张域名与 IP 地址的对应表）\n2. 搜索操作系统中的 DNS 缓存（维护一张域名与 IP 地址的对应表）\n3. 搜索操作系统的 host 文件（Windows 环境下，维护一张域名与 IP 地址的对应表）\n4. 操作系统间根域名发送至 LDNS（本地域名服务器），首先查找自己的缓存若是失败：\n   - 向根域名服务器发起请求，此处根域名服务器返回 com 域的 sing 机域名服务器地址。\n   - LDNS 向 com 域的顶级域名服务器发起请求，得到 www.baidu.com 的地址。\n   - LONS 向 baidu.com 域名服务器发起请求，得到 www.baidu.com 的 IP 地址。\n5. LDNS 将得到的 IP 地址返回给操作系统，同时将 IP 地址缓存起来；\n6. 操作系统将 IP 地址返回给浏览器，同时自己也缓存起来；\n\n此时浏览器得到了域名对应的 IP 地址。\n\n### TCP 连接\n\n浏览器根据 IP 地址与服务器建立 socket 连接 。\nTCP协议通过三次握手建立连接。\n- 客户端通过SYN报文段发送连接请求，确定服务器端是否开启端口准备连接，状态设置为SYN_SEND\n- 服务器如果有开着的端口并且决定结接受连接，就会返回一个SYN+ACK报文段给客户端，状态设置为SYN_RECV\n- 客户端收到服务器的SYN+ACK报文段，向服务器发送ACK报文段表示确认。此时客户端和服务器端都设置为ESTABLISHED 状态。连接建立，可以开始数据传输了。\n\n\n### 发送 HTTP 请求\n\n1. 浏览器根据 URL 内容生成 HTTP 请求，请求中包含文件的位置，请求文件的方式等。\n2. 服务器接到请求后，会根据 HTTP 请求中的内容来决定如何获取相应的 HTML 文件。\n\n#### http 状态码\n\n1. 200 form memory cache 不访问服务器，直接读缓存 ，此时的缓存是缓存在内存中的，当 kill 进程之后数据就会不存在。这种方式只能缓存派生资源。\n2. 200 OK (from cache) 是浏览器没有跟服务器确认，直接用了浏览器缓存。\n3. 304 Not Modified 是浏览器和服务器多确认了一次缓存有效性，再用的缓存。200(from cache) 是速度最快的 , 因为不需要访问远程服务器 , 直接使用本地缓存 .304 的过程是 , 先请求服务器 , 然后服务器告诉我们这个资源没变 , 浏览器再使用本地缓存。\n4. 200 from dist cache 不访问服务器，直接度缓存，当进程 kill 时，数据依旧存在。只能缓存派生资源。\n\n![network](/images/problem/1.png)\n\n### 浏览器解析渲染页面\n\n现代浏览器渲染页面过程是：解码（字节流到字符流） ——> 分词（此法分析） ——> 解析（语法分析）——> 构建 DOM 树 ——> 构建渲染树 ——> 布局渲染树 ——> 绘制渲染树\n\n### 连接结束\n\n断开连接 --4 次挥手\n\n- 为什么服务器在接到断开请求时不立即同意断开：当服务器收到断开连接的请求时，可能仍然有数据未发送完毕，所以服务器先发送确认信号，等所有数据发送完毕后再同意断开。\n\n- 第四次握手后，主机发送确认信号后并没有立即断开连接，而是等待了 2 个报文传送周期，原因是：如果第四次握手的确认信息丢失，服务器将会重新发送第三次握手的断开连接的信号，而服务器发觉丢包与重新发送的断开连接到达主机的时间正好为 2 个报文传输周期。\n","source":"_posts/浏览器渲染与解析.md","raw":"---\ntitle: 浏览器渲染与解析\ndate: 2018-05-17 09:47:28\ncategories: Web\n---\n\n以前在项目中遇到过‘监听浏览器的前进后退重新执行 JS’的需求的场景，所以现在综合一些资料和自己的测试进行总结一下。\n\n<!--more-->\n\n## 客户端渲染机制\n\n浏览器的渲染机制一般分为以下几个步骤\n\n1. 处理 HTML 并构建 DOM 树\n2. 处理CSS标记并构建CSSOM树\n3. 将DOM与CSSOM合成一颗渲染树\n4. 根据渲染树布局，以计算每个节点的几何信息\n5. 将各个节点绘制到屏幕上\n\n## 浏览器的线程\n\n浏览器是多线程的，他们在内核控制下相互配合以保持同步，一个浏览器至少实现三个常驻线程：javascript引擎线程、GUI渲染线程、浏览器事件触发线程\n- GUI渲染线程：负责渲染浏览器界面的HTML元素，当界面需要重绘或者回流时，该线程就会执行，在javascript引擎运行脚本期间，GUI渲染线程都是出于挂起转态的，也就是说被冻结了\n- javascript引擎线程：主要负责处理javascript脚本程序\n- 定时器触发线程：浏览器定时器并不是由javascript引擎计数的，javascript引擎是单线程的，如果处于阻塞线程状态就会影响计时的准确，因此浏览器通过单独线程来计时并触发定时\n- 事件触发线程：当一个事件被触发时该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理。这些事件包含当前执行的代码，例如定时任务，流量亲耐内核的其他线程如鼠标点击、ajax异步请求等。由于JS的单线程关系所有这些世间都得排队等待JS引擎处理。定时块任何和ajax请求等这些异步队列，事件触发线程只是在到达定时事件或者ajax请求成功后，把回调函数放到事件队列当中\n- 异步HTTP请求线程：在XMLHttpRequests在链接后通过浏览器新开一个线程请求，将检测到状态变更时，如果设置有回调函数，异步线程就产生个状态变成事件放到javascript引擎处理队列中等待处理，在发起一个异步请求时，http请求线程负责去请求服务器，有了响应后，事件触发线程再把回调函数放到事件队列当中\n\n## 构建DOM树与CSSOM树\n浏览器凶网络或硬盘中获得HTML字节数据后会经过一个流程讲直接解析成DOM树\n\n- 编码：先将HTML的原始字节数据转换为文件指定编码的字符\n- 令牌化：然后浏览器会根据HTML规范来将字符串转换成各种令牌（如`<html>、<body>`这样的标签以及标签中的字符串和属性等都会转化为令牌，每个令牌具有特殊含义和一组规则）。令牌记录了标签的开始与结束，通过这个特性可以轻松判断一个标签是否为子标签（假设有<html>与<body>两个标签，当<html>标签的令牌还未遇到它的结束令牌</html>就遇见了<body>标签令牌，那么<body>就是<html>的子标签）。\n- 生成对象：接下来每个令牌都会被转换成定义其属性和规则对象（这个对象就是节点对象）\n- 构建完毕：DOM树构建完成，整个对象集合就像是一颗属性结构。\n\n## 构建渲染树\n在构建了DOM树和CSSOM树之后，浏览器只是拥有了两个互相独立的对象集合，DOM树描述了文档的结构和内容，CSSOM树则描述了对文档应用的样式规则，想要渲染页面，就需要将DOM树与CSSOM树结合在一起\n![network](/images/common/render.png)\n\n\n## 布局与绘制\ncss采用一种叫做盒子思维模型的思维模型来表示每个节点与其他元素之间的距离，盒子模型包括外边距（margin），内边距（padding），边框（border），内容（content），页面中的每一个标签都是一个个的盒子\n\n![network](/images/common/box.png)\n布局阶段会从渲染树的根节点开始遍历，然后确定每个节点对象在页面上的确切大小与位置，布局阶段的输出是一个盒子模型，它会精确地捕捉每个元素在屏幕内的确切位置与大小，所有相对的测量值也都会被转换成屏幕内的绝对像素值\n\n当Layout布局事件完成后，浏览器会立即发出Paint Setup与Paint事件，开始将渲染树绘制成像素，绘制所需的时间跟CSS样式的复杂度成正比\n## 浏览器前进、后退使用机制\n\n用户点击浏览器工具栏中的后退按钮，或者是移动设备上的返回键的时候，或者是 JS 执行`history.go(-1)`的时候，浏览器会在当前窗口“打开”历史记录中的前一个页面。不同的浏览器在“打开”前一个页面的表现并不同意，这和浏览器的实现以及页面本身的设置都有关系。在浏览器中，“后退到前一个页面”意味着：前一个页面的 html/js/css 等等的静态资源的请求（甚至是 ajax 动态接口请求）根本不会重新发送，直接使用缓存的响应，而不管这些金泰资源响应的缓存策略是否被设置了禁用状态。\n\n\n## history 中的操作\n\n1.  `window.history.back()`:后退\n2.  `window.history.dorward()`:前进\n3.  `window.history.go(num)`:前进或后退指定数量历史记录\n4.  `window.history.pushState(state,title,url)`:在页面中创建一个 histor 实体，直接天剑到历史记录。\n    - state:存储一个对象，可以添加相关信息，可以使用 history.state 读取其中的内容。\n    - title:历史记录的标题。\n    - url:创建的历史记录的链接，进行历史记录操作时会跳转到改链接。\n5.  `window.history.replaceState()`:修改当前的 history 实体。\n6.  `popstate`事件:history 实体改变时触发的事件。\n7.  `window.history.state`:会获得 history 实体中的 state 对象。\n\n## popstate\n\npopstate 只会在浏览器某些行为下触发，比如点击后退、前进按钮。\n\n在微信浏览器中，从一个 HTML 跳到另一个 HTML 页面后，点击浏览器返回按钮，或者在第二个页面中调用`history.back()`等返回上一页的方法，在安卓中会直接返回上一页(相当于重新加载上一页的所有内容，js 会重新执行一遍)，但苹果手机中，范湖上一页是，浏览器会读取缓存中的页面内容，js 不会重新执行，在此进入这个页面不会触发 onload 事件。\n\n```javascript\n//强制刷新：\nwindow.addEventListener(\n  'popstate',\n  function(e) {\n    //检测到用户点击浏览器返回按钮，进行操作\n    console.log(document.referrer);\n\n    //使用href的形式去用跳转的形式，跳转到上一页\n    document.location.href = document.referrer;\n  },\n  false\n);\nvar state = {\n  title: '',\n  url: ''\n};\nwindow.history.pushState(state, '', '');\n```\n\n## pageshow\n\nonpageshow 事件在页面显示时触发，如果页面不在“往返缓存”中，改时间会在 onload 后触发，在 onpageshow 事件中，可以利用 event.persisted\n\n```javascript\n    window.addEventListener('pageshow'.function(evernt){\n        alert(event.persisted);\n        if(event.persisted) location.reload();//如果检测到页面是从“往返缓存”中读取的，刷新页面。\n    });\n```\n\n## unload\n\n指定 unload 事件处理程序的页面会被自动排除在“往返缓存”之外，即使事件处理程序是空白的，原因在于，unload 最长用于撤销 load 中所执行的操作，而跳过 load 后再次显示页面很有可能会导致页面不正常。\n\n## 从输入 URL 到 页面加载发生了什么\n\n发生过程：\n\n- 查看 web 缓存\n- DNS 解析\n- TCP 连接\n- 发送 HTTP 请求\n- 服务器处理请求并返回 HTTP 报文\n- 浏览器解析渲染页面\n- 连接结束\n\n### 查看 web 缓存\n\n浏览器获取了这个UR,就先去缓存当中查看，从浏览器缓存-系统缓存-路由缓存当中查。看到有个人的笔记是DNS 解析在前，但是不管是路由还是转发都应该是先从缓存中查看的\n\n当浏览器再次访问一个已经访问过的资源时，它会：\n\n1. 通过Cache-control 和 Expires 来检查是否命中强缓存，命中则直接取本地磁盘的html（状态码为200 from disk(or memory) cache,内存or磁盘）\n2. 如果没有命中强缓存，就发送请求到服务器发起请求（先进性下一步的TCP链接），服务器通过Etag 和 Last-Modify来与服务器确认返回的响应是否被更改（协商缓存）。\n3. 如果命中协商缓存，访问服务器，服务器返回 304 not modified 告诉浏览器使用本地缓存。\n4. 否则，请求网络返回最新资源。\n\n浏览器缓存的位置：\n\n1. service worker :它可以让我们自由控制哪些文件、如何匹配缓存，如何读取缓存，并且缓存是持续性的。\n2. memory cache:内存缓存，读取内存中的数据肯定比磁盘块，但是内存缓存虽然读取高效，可是缓存持续性很短，会随着进程的释放而释放，一旦关闭了 tap 页，内存中的缓存也得到了释放。\n3. disk cache：也就是存储在硬盘中的缓存，读取速度慢点，但是什么都能存储到磁盘中，比如 memory cache 胜在容量和存储时效性上。\n\n缓存实现：强缓存和协商缓存都是根据 HTTP Header 来实现的。\n\n#### 浏览器缓存机制\n\n![network](/images/problem/2.png)\n\n##### 当前缓存是否过期。\n\n如果浏览器通过某些条件 ( 条件之后再说 ) 判断出来，ok 现在这个缓存没有过期可以用，那么连请求都不会发的，直接是启用之前浏览器缓存下来的那份文件 (from memory cache). 浏览器直接通过缓存读取了出来，注意这个时候是不会向浏览器请求的！ 如果过期了就会向服务器重新发起请求，但是不一定就会重新拉取文件！\n\n##### 服务器中的文件是否改动。\n\n1. 缓存过期，文件有改动：如果服务器发现这个文件改变了那么你肯定不能再用以前浏览器的缓存了，那就返回个 200 并且带上新的文件。\n\n2. 缓存过期，文件无改动：同时如果发现虽然那个缓存虽然过期了，可你在服务器端的文件没有变过，那么服务器只会给你返回一个头信息 (304)，让你继续用你那过期的缓存，这样就节省了很多传输文件的时间带宽啥的\n\n过期了的缓存需要请求一次服务器，若服务器判断说这个文件没有改变还能用，那就返回 304。浏览器认识 304，它就会去读取过期缓存。否则就真的传一份新文件到浏览器。\n\n### DNS 解析\n\n浏览器查找域名对应的 IP 地址。互联网上每一台计算机的唯一识别是它的 IP 地址，DNS 解析就是讲网址转换为 IP 地址。\n\n查找过程：\n\n1. 浏览器搜索自己的 DNS 缓存（维护一张域名与 IP 地址的对应表）\n2. 搜索操作系统中的 DNS 缓存（维护一张域名与 IP 地址的对应表）\n3. 搜索操作系统的 host 文件（Windows 环境下，维护一张域名与 IP 地址的对应表）\n4. 操作系统间根域名发送至 LDNS（本地域名服务器），首先查找自己的缓存若是失败：\n   - 向根域名服务器发起请求，此处根域名服务器返回 com 域的 sing 机域名服务器地址。\n   - LDNS 向 com 域的顶级域名服务器发起请求，得到 www.baidu.com 的地址。\n   - LONS 向 baidu.com 域名服务器发起请求，得到 www.baidu.com 的 IP 地址。\n5. LDNS 将得到的 IP 地址返回给操作系统，同时将 IP 地址缓存起来；\n6. 操作系统将 IP 地址返回给浏览器，同时自己也缓存起来；\n\n此时浏览器得到了域名对应的 IP 地址。\n\n### TCP 连接\n\n浏览器根据 IP 地址与服务器建立 socket 连接 。\nTCP协议通过三次握手建立连接。\n- 客户端通过SYN报文段发送连接请求，确定服务器端是否开启端口准备连接，状态设置为SYN_SEND\n- 服务器如果有开着的端口并且决定结接受连接，就会返回一个SYN+ACK报文段给客户端，状态设置为SYN_RECV\n- 客户端收到服务器的SYN+ACK报文段，向服务器发送ACK报文段表示确认。此时客户端和服务器端都设置为ESTABLISHED 状态。连接建立，可以开始数据传输了。\n\n\n### 发送 HTTP 请求\n\n1. 浏览器根据 URL 内容生成 HTTP 请求，请求中包含文件的位置，请求文件的方式等。\n2. 服务器接到请求后，会根据 HTTP 请求中的内容来决定如何获取相应的 HTML 文件。\n\n#### http 状态码\n\n1. 200 form memory cache 不访问服务器，直接读缓存 ，此时的缓存是缓存在内存中的，当 kill 进程之后数据就会不存在。这种方式只能缓存派生资源。\n2. 200 OK (from cache) 是浏览器没有跟服务器确认，直接用了浏览器缓存。\n3. 304 Not Modified 是浏览器和服务器多确认了一次缓存有效性，再用的缓存。200(from cache) 是速度最快的 , 因为不需要访问远程服务器 , 直接使用本地缓存 .304 的过程是 , 先请求服务器 , 然后服务器告诉我们这个资源没变 , 浏览器再使用本地缓存。\n4. 200 from dist cache 不访问服务器，直接度缓存，当进程 kill 时，数据依旧存在。只能缓存派生资源。\n\n![network](/images/problem/1.png)\n\n### 浏览器解析渲染页面\n\n现代浏览器渲染页面过程是：解码（字节流到字符流） ——> 分词（此法分析） ——> 解析（语法分析）——> 构建 DOM 树 ——> 构建渲染树 ——> 布局渲染树 ——> 绘制渲染树\n\n### 连接结束\n\n断开连接 --4 次挥手\n\n- 为什么服务器在接到断开请求时不立即同意断开：当服务器收到断开连接的请求时，可能仍然有数据未发送完毕，所以服务器先发送确认信号，等所有数据发送完毕后再同意断开。\n\n- 第四次握手后，主机发送确认信号后并没有立即断开连接，而是等待了 2 个报文传送周期，原因是：如果第四次握手的确认信息丢失，服务器将会重新发送第三次握手的断开连接的信号，而服务器发觉丢包与重新发送的断开连接到达主机的时间正好为 2 个报文传输周期。\n","slug":"浏览器渲染与解析","published":1,"updated":"2021-04-12T12:28:33.658Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xi002wl5v0hnau0sug","content":"<p>以前在项目中遇到过‘监听浏览器的前进后退重新执行 JS’的需求的场景，所以现在综合一些资料和自己的测试进行总结一下。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"客户端渲染机制\"><a href=\"#客户端渲染机制\" class=\"headerlink\" title=\"客户端渲染机制\"></a>客户端渲染机制</h2><p>浏览器的渲染机制一般分为以下几个步骤</p>\n<ol>\n<li>处理 HTML 并构建 DOM 树</li>\n<li>处理CSS标记并构建CSSOM树</li>\n<li>将DOM与CSSOM合成一颗渲染树</li>\n<li>根据渲染树布局，以计算每个节点的几何信息</li>\n<li>将各个节点绘制到屏幕上</li>\n</ol>\n<h2 id=\"浏览器的线程\"><a href=\"#浏览器的线程\" class=\"headerlink\" title=\"浏览器的线程\"></a>浏览器的线程</h2><p>浏览器是多线程的，他们在内核控制下相互配合以保持同步，一个浏览器至少实现三个常驻线程：javascript引擎线程、GUI渲染线程、浏览器事件触发线程</p>\n<ul>\n<li>GUI渲染线程：负责渲染浏览器界面的HTML元素，当界面需要重绘或者回流时，该线程就会执行，在javascript引擎运行脚本期间，GUI渲染线程都是出于挂起转态的，也就是说被冻结了</li>\n<li>javascript引擎线程：主要负责处理javascript脚本程序</li>\n<li>定时器触发线程：浏览器定时器并不是由javascript引擎计数的，javascript引擎是单线程的，如果处于阻塞线程状态就会影响计时的准确，因此浏览器通过单独线程来计时并触发定时</li>\n<li>事件触发线程：当一个事件被触发时该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理。这些事件包含当前执行的代码，例如定时任务，流量亲耐内核的其他线程如鼠标点击、ajax异步请求等。由于JS的单线程关系所有这些世间都得排队等待JS引擎处理。定时块任何和ajax请求等这些异步队列，事件触发线程只是在到达定时事件或者ajax请求成功后，把回调函数放到事件队列当中</li>\n<li>异步HTTP请求线程：在XMLHttpRequests在链接后通过浏览器新开一个线程请求，将检测到状态变更时，如果设置有回调函数，异步线程就产生个状态变成事件放到javascript引擎处理队列中等待处理，在发起一个异步请求时，http请求线程负责去请求服务器，有了响应后，事件触发线程再把回调函数放到事件队列当中</li>\n</ul>\n<h2 id=\"构建DOM树与CSSOM树\"><a href=\"#构建DOM树与CSSOM树\" class=\"headerlink\" title=\"构建DOM树与CSSOM树\"></a>构建DOM树与CSSOM树</h2><p>浏览器凶网络或硬盘中获得HTML字节数据后会经过一个流程讲直接解析成DOM树</p>\n<ul>\n<li>编码：先将HTML的原始字节数据转换为文件指定编码的字符</li>\n<li>令牌化：然后浏览器会根据HTML规范来将字符串转换成各种令牌（如<code>&lt;html&gt;、&lt;body&gt;</code>这样的标签以及标签中的字符串和属性等都会转化为令牌，每个令牌具有特殊含义和一组规则）。令牌记录了标签的开始与结束，通过这个特性可以轻松判断一个标签是否为子标签（假设有<html>与<body>两个标签，当<html>标签的令牌还未遇到它的结束令牌</html>就遇见了<body>标签令牌，那么<body>就是<html>的子标签）。</li>\n<li>生成对象：接下来每个令牌都会被转换成定义其属性和规则对象（这个对象就是节点对象）</li>\n<li>构建完毕：DOM树构建完成，整个对象集合就像是一颗属性结构。</li>\n</ul>\n<h2 id=\"构建渲染树\"><a href=\"#构建渲染树\" class=\"headerlink\" title=\"构建渲染树\"></a>构建渲染树</h2><p>在构建了DOM树和CSSOM树之后，浏览器只是拥有了两个互相独立的对象集合，DOM树描述了文档的结构和内容，CSSOM树则描述了对文档应用的样式规则，想要渲染页面，就需要将DOM树与CSSOM树结合在一起<br><img src=\"/images/common/render.png\" alt=\"network\"></p>\n<h2 id=\"布局与绘制\"><a href=\"#布局与绘制\" class=\"headerlink\" title=\"布局与绘制\"></a>布局与绘制</h2><p>css采用一种叫做盒子思维模型的思维模型来表示每个节点与其他元素之间的距离，盒子模型包括外边距（margin），内边距（padding），边框（border），内容（content），页面中的每一个标签都是一个个的盒子</p>\n<p><img src=\"/images/common/box.png\" alt=\"network\"><br>布局阶段会从渲染树的根节点开始遍历，然后确定每个节点对象在页面上的确切大小与位置，布局阶段的输出是一个盒子模型，它会精确地捕捉每个元素在屏幕内的确切位置与大小，所有相对的测量值也都会被转换成屏幕内的绝对像素值</p>\n<p>当Layout布局事件完成后，浏览器会立即发出Paint Setup与Paint事件，开始将渲染树绘制成像素，绘制所需的时间跟CSS样式的复杂度成正比</p>\n<h2 id=\"浏览器前进、后退使用机制\"><a href=\"#浏览器前进、后退使用机制\" class=\"headerlink\" title=\"浏览器前进、后退使用机制\"></a>浏览器前进、后退使用机制</h2><p>用户点击浏览器工具栏中的后退按钮，或者是移动设备上的返回键的时候，或者是 JS 执行<code>history.go(-1)</code>的时候，浏览器会在当前窗口“打开”历史记录中的前一个页面。不同的浏览器在“打开”前一个页面的表现并不同意，这和浏览器的实现以及页面本身的设置都有关系。在浏览器中，“后退到前一个页面”意味着：前一个页面的 html/js/css 等等的静态资源的请求（甚至是 ajax 动态接口请求）根本不会重新发送，直接使用缓存的响应，而不管这些金泰资源响应的缓存策略是否被设置了禁用状态。</p>\n<h2 id=\"history-中的操作\"><a href=\"#history-中的操作\" class=\"headerlink\" title=\"history 中的操作\"></a>history 中的操作</h2><ol>\n<li> <code>window.history.back()</code>:后退</li>\n<li> <code>window.history.dorward()</code>:前进</li>\n<li> <code>window.history.go(num)</code>:前进或后退指定数量历史记录</li>\n<li><code>window.history.pushState(state,title,url)</code>:在页面中创建一个 histor 实体，直接天剑到历史记录。<ul>\n<li>state:存储一个对象，可以添加相关信息，可以使用 history.state 读取其中的内容。</li>\n<li>title:历史记录的标题。</li>\n<li>url:创建的历史记录的链接，进行历史记录操作时会跳转到改链接。</li>\n</ul>\n</li>\n<li> <code>window.history.replaceState()</code>:修改当前的 history 实体。</li>\n<li> <code>popstate</code>事件:history 实体改变时触发的事件。</li>\n<li> <code>window.history.state</code>:会获得 history 实体中的 state 对象。</li>\n</ol>\n<h2 id=\"popstate\"><a href=\"#popstate\" class=\"headerlink\" title=\"popstate\"></a>popstate</h2><p>popstate 只会在浏览器某些行为下触发，比如点击后退、前进按钮。</p>\n<p>在微信浏览器中，从一个 HTML 跳到另一个 HTML 页面后，点击浏览器返回按钮，或者在第二个页面中调用<code>history.back()</code>等返回上一页的方法，在安卓中会直接返回上一页(相当于重新加载上一页的所有内容，js 会重新执行一遍)，但苹果手机中，范湖上一页是，浏览器会读取缓存中的页面内容，js 不会重新执行，在此进入这个页面不会触发 onload 事件。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//强制刷新：</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(</span><br><span class=\"line\">  <span class=\"string\">&#x27;popstate&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//检测到用户点击浏览器返回按钮，进行操作</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">document</span>.referrer);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//使用href的形式去用跳转的形式，跳转到上一页</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.location.href = <span class=\"built_in\">document</span>.referrer;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"literal\">false</span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"keyword\">var</span> state = &#123;</span><br><span class=\"line\">  title: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">  url: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.history.pushState(state, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"pageshow\"><a href=\"#pageshow\" class=\"headerlink\" title=\"pageshow\"></a>pageshow</h2><p>onpageshow 事件在页面显示时触发，如果页面不在“往返缓存”中，改时间会在 onload 后触发，在 onpageshow 事件中，可以利用 event.persisted</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;pageshow&#x27;</span>.function(evernt)&#123;</span><br><span class=\"line\">    alert(event.persisted);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(event.persisted) location.reload();<span class=\"comment\">//如果检测到页面是从“往返缓存”中读取的，刷新页面。</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"unload\"><a href=\"#unload\" class=\"headerlink\" title=\"unload\"></a>unload</h2><p>指定 unload 事件处理程序的页面会被自动排除在“往返缓存”之外，即使事件处理程序是空白的，原因在于，unload 最长用于撤销 load 中所执行的操作，而跳过 load 后再次显示页面很有可能会导致页面不正常。</p>\n<h2 id=\"从输入-URL-到-页面加载发生了什么\"><a href=\"#从输入-URL-到-页面加载发生了什么\" class=\"headerlink\" title=\"从输入 URL 到 页面加载发生了什么\"></a>从输入 URL 到 页面加载发生了什么</h2><p>发生过程：</p>\n<ul>\n<li>查看 web 缓存</li>\n<li>DNS 解析</li>\n<li>TCP 连接</li>\n<li>发送 HTTP 请求</li>\n<li>服务器处理请求并返回 HTTP 报文</li>\n<li>浏览器解析渲染页面</li>\n<li>连接结束</li>\n</ul>\n<h3 id=\"查看-web-缓存\"><a href=\"#查看-web-缓存\" class=\"headerlink\" title=\"查看 web 缓存\"></a>查看 web 缓存</h3><p>浏览器获取了这个UR,就先去缓存当中查看，从浏览器缓存-系统缓存-路由缓存当中查。看到有个人的笔记是DNS 解析在前，但是不管是路由还是转发都应该是先从缓存中查看的</p>\n<p>当浏览器再次访问一个已经访问过的资源时，它会：</p>\n<ol>\n<li>通过Cache-control 和 Expires 来检查是否命中强缓存，命中则直接取本地磁盘的html（状态码为200 from disk(or memory) cache,内存or磁盘）</li>\n<li>如果没有命中强缓存，就发送请求到服务器发起请求（先进性下一步的TCP链接），服务器通过Etag 和 Last-Modify来与服务器确认返回的响应是否被更改（协商缓存）。</li>\n<li>如果命中协商缓存，访问服务器，服务器返回 304 not modified 告诉浏览器使用本地缓存。</li>\n<li>否则，请求网络返回最新资源。</li>\n</ol>\n<p>浏览器缓存的位置：</p>\n<ol>\n<li>service worker :它可以让我们自由控制哪些文件、如何匹配缓存，如何读取缓存，并且缓存是持续性的。</li>\n<li>memory cache:内存缓存，读取内存中的数据肯定比磁盘块，但是内存缓存虽然读取高效，可是缓存持续性很短，会随着进程的释放而释放，一旦关闭了 tap 页，内存中的缓存也得到了释放。</li>\n<li>disk cache：也就是存储在硬盘中的缓存，读取速度慢点，但是什么都能存储到磁盘中，比如 memory cache 胜在容量和存储时效性上。</li>\n</ol>\n<p>缓存实现：强缓存和协商缓存都是根据 HTTP Header 来实现的。</p>\n<h4 id=\"浏览器缓存机制\"><a href=\"#浏览器缓存机制\" class=\"headerlink\" title=\"浏览器缓存机制\"></a>浏览器缓存机制</h4><p><img src=\"/images/problem/2.png\" alt=\"network\"></p>\n<h5 id=\"当前缓存是否过期。\"><a href=\"#当前缓存是否过期。\" class=\"headerlink\" title=\"当前缓存是否过期。\"></a>当前缓存是否过期。</h5><p>如果浏览器通过某些条件 ( 条件之后再说 ) 判断出来，ok 现在这个缓存没有过期可以用，那么连请求都不会发的，直接是启用之前浏览器缓存下来的那份文件 (from memory cache). 浏览器直接通过缓存读取了出来，注意这个时候是不会向浏览器请求的！ 如果过期了就会向服务器重新发起请求，但是不一定就会重新拉取文件！</p>\n<h5 id=\"服务器中的文件是否改动。\"><a href=\"#服务器中的文件是否改动。\" class=\"headerlink\" title=\"服务器中的文件是否改动。\"></a>服务器中的文件是否改动。</h5><ol>\n<li><p>缓存过期，文件有改动：如果服务器发现这个文件改变了那么你肯定不能再用以前浏览器的缓存了，那就返回个 200 并且带上新的文件。</p>\n</li>\n<li><p>缓存过期，文件无改动：同时如果发现虽然那个缓存虽然过期了，可你在服务器端的文件没有变过，那么服务器只会给你返回一个头信息 (304)，让你继续用你那过期的缓存，这样就节省了很多传输文件的时间带宽啥的</p>\n</li>\n</ol>\n<p>过期了的缓存需要请求一次服务器，若服务器判断说这个文件没有改变还能用，那就返回 304。浏览器认识 304，它就会去读取过期缓存。否则就真的传一份新文件到浏览器。</p>\n<h3 id=\"DNS-解析\"><a href=\"#DNS-解析\" class=\"headerlink\" title=\"DNS 解析\"></a>DNS 解析</h3><p>浏览器查找域名对应的 IP 地址。互联网上每一台计算机的唯一识别是它的 IP 地址，DNS 解析就是讲网址转换为 IP 地址。</p>\n<p>查找过程：</p>\n<ol>\n<li>浏览器搜索自己的 DNS 缓存（维护一张域名与 IP 地址的对应表）</li>\n<li>搜索操作系统中的 DNS 缓存（维护一张域名与 IP 地址的对应表）</li>\n<li>搜索操作系统的 host 文件（Windows 环境下，维护一张域名与 IP 地址的对应表）</li>\n<li>操作系统间根域名发送至 LDNS（本地域名服务器），首先查找自己的缓存若是失败：<ul>\n<li>向根域名服务器发起请求，此处根域名服务器返回 com 域的 sing 机域名服务器地址。</li>\n<li>LDNS 向 com 域的顶级域名服务器发起请求，得到 <a href=\"http://www.baidu.com/\">www.baidu.com</a> 的地址。</li>\n<li>LONS 向 baidu.com 域名服务器发起请求，得到 <a href=\"http://www.baidu.com/\">www.baidu.com</a> 的 IP 地址。</li>\n</ul>\n</li>\n<li>LDNS 将得到的 IP 地址返回给操作系统，同时将 IP 地址缓存起来；</li>\n<li>操作系统将 IP 地址返回给浏览器，同时自己也缓存起来；</li>\n</ol>\n<p>此时浏览器得到了域名对应的 IP 地址。</p>\n<h3 id=\"TCP-连接\"><a href=\"#TCP-连接\" class=\"headerlink\" title=\"TCP 连接\"></a>TCP 连接</h3><p>浏览器根据 IP 地址与服务器建立 socket 连接 。<br>TCP协议通过三次握手建立连接。</p>\n<ul>\n<li>客户端通过SYN报文段发送连接请求，确定服务器端是否开启端口准备连接，状态设置为SYN_SEND</li>\n<li>服务器如果有开着的端口并且决定结接受连接，就会返回一个SYN+ACK报文段给客户端，状态设置为SYN_RECV</li>\n<li>客户端收到服务器的SYN+ACK报文段，向服务器发送ACK报文段表示确认。此时客户端和服务器端都设置为ESTABLISHED 状态。连接建立，可以开始数据传输了。</li>\n</ul>\n<h3 id=\"发送-HTTP-请求\"><a href=\"#发送-HTTP-请求\" class=\"headerlink\" title=\"发送 HTTP 请求\"></a>发送 HTTP 请求</h3><ol>\n<li>浏览器根据 URL 内容生成 HTTP 请求，请求中包含文件的位置，请求文件的方式等。</li>\n<li>服务器接到请求后，会根据 HTTP 请求中的内容来决定如何获取相应的 HTML 文件。</li>\n</ol>\n<h4 id=\"http-状态码\"><a href=\"#http-状态码\" class=\"headerlink\" title=\"http 状态码\"></a>http 状态码</h4><ol>\n<li>200 form memory cache 不访问服务器，直接读缓存 ，此时的缓存是缓存在内存中的，当 kill 进程之后数据就会不存在。这种方式只能缓存派生资源。</li>\n<li>200 OK (from cache) 是浏览器没有跟服务器确认，直接用了浏览器缓存。</li>\n<li>304 Not Modified 是浏览器和服务器多确认了一次缓存有效性，再用的缓存。200(from cache) 是速度最快的 , 因为不需要访问远程服务器 , 直接使用本地缓存 .304 的过程是 , 先请求服务器 , 然后服务器告诉我们这个资源没变 , 浏览器再使用本地缓存。</li>\n<li>200 from dist cache 不访问服务器，直接度缓存，当进程 kill 时，数据依旧存在。只能缓存派生资源。</li>\n</ol>\n<p><img src=\"/images/problem/1.png\" alt=\"network\"></p>\n<h3 id=\"浏览器解析渲染页面\"><a href=\"#浏览器解析渲染页面\" class=\"headerlink\" title=\"浏览器解析渲染页面\"></a>浏览器解析渲染页面</h3><p>现代浏览器渲染页面过程是：解码（字节流到字符流） ——&gt; 分词（此法分析） ——&gt; 解析（语法分析）——&gt; 构建 DOM 树 ——&gt; 构建渲染树 ——&gt; 布局渲染树 ——&gt; 绘制渲染树</p>\n<h3 id=\"连接结束\"><a href=\"#连接结束\" class=\"headerlink\" title=\"连接结束\"></a>连接结束</h3><p>断开连接 –4 次挥手</p>\n<ul>\n<li><p>为什么服务器在接到断开请求时不立即同意断开：当服务器收到断开连接的请求时，可能仍然有数据未发送完毕，所以服务器先发送确认信号，等所有数据发送完毕后再同意断开。</p>\n</li>\n<li><p>第四次握手后，主机发送确认信号后并没有立即断开连接，而是等待了 2 个报文传送周期，原因是：如果第四次握手的确认信息丢失，服务器将会重新发送第三次握手的断开连接的信号，而服务器发觉丢包与重新发送的断开连接到达主机的时间正好为 2 个报文传输周期。</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>以前在项目中遇到过‘监听浏览器的前进后退重新执行 JS’的需求的场景，所以现在综合一些资料和自己的测试进行总结一下。</p>","more":"<h2 id=\"客户端渲染机制\"><a href=\"#客户端渲染机制\" class=\"headerlink\" title=\"客户端渲染机制\"></a>客户端渲染机制</h2><p>浏览器的渲染机制一般分为以下几个步骤</p>\n<ol>\n<li>处理 HTML 并构建 DOM 树</li>\n<li>处理CSS标记并构建CSSOM树</li>\n<li>将DOM与CSSOM合成一颗渲染树</li>\n<li>根据渲染树布局，以计算每个节点的几何信息</li>\n<li>将各个节点绘制到屏幕上</li>\n</ol>\n<h2 id=\"浏览器的线程\"><a href=\"#浏览器的线程\" class=\"headerlink\" title=\"浏览器的线程\"></a>浏览器的线程</h2><p>浏览器是多线程的，他们在内核控制下相互配合以保持同步，一个浏览器至少实现三个常驻线程：javascript引擎线程、GUI渲染线程、浏览器事件触发线程</p>\n<ul>\n<li>GUI渲染线程：负责渲染浏览器界面的HTML元素，当界面需要重绘或者回流时，该线程就会执行，在javascript引擎运行脚本期间，GUI渲染线程都是出于挂起转态的，也就是说被冻结了</li>\n<li>javascript引擎线程：主要负责处理javascript脚本程序</li>\n<li>定时器触发线程：浏览器定时器并不是由javascript引擎计数的，javascript引擎是单线程的，如果处于阻塞线程状态就会影响计时的准确，因此浏览器通过单独线程来计时并触发定时</li>\n<li>事件触发线程：当一个事件被触发时该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理。这些事件包含当前执行的代码，例如定时任务，流量亲耐内核的其他线程如鼠标点击、ajax异步请求等。由于JS的单线程关系所有这些世间都得排队等待JS引擎处理。定时块任何和ajax请求等这些异步队列，事件触发线程只是在到达定时事件或者ajax请求成功后，把回调函数放到事件队列当中</li>\n<li>异步HTTP请求线程：在XMLHttpRequests在链接后通过浏览器新开一个线程请求，将检测到状态变更时，如果设置有回调函数，异步线程就产生个状态变成事件放到javascript引擎处理队列中等待处理，在发起一个异步请求时，http请求线程负责去请求服务器，有了响应后，事件触发线程再把回调函数放到事件队列当中</li>\n</ul>\n<h2 id=\"构建DOM树与CSSOM树\"><a href=\"#构建DOM树与CSSOM树\" class=\"headerlink\" title=\"构建DOM树与CSSOM树\"></a>构建DOM树与CSSOM树</h2><p>浏览器凶网络或硬盘中获得HTML字节数据后会经过一个流程讲直接解析成DOM树</p>\n<ul>\n<li>编码：先将HTML的原始字节数据转换为文件指定编码的字符</li>\n<li>令牌化：然后浏览器会根据HTML规范来将字符串转换成各种令牌（如<code>&lt;html&gt;、&lt;body&gt;</code>这样的标签以及标签中的字符串和属性等都会转化为令牌，每个令牌具有特殊含义和一组规则）。令牌记录了标签的开始与结束，通过这个特性可以轻松判断一个标签是否为子标签（假设有<html>与<body>两个标签，当<html>标签的令牌还未遇到它的结束令牌</html>就遇见了<body>标签令牌，那么<body>就是<html>的子标签）。</li>\n<li>生成对象：接下来每个令牌都会被转换成定义其属性和规则对象（这个对象就是节点对象）</li>\n<li>构建完毕：DOM树构建完成，整个对象集合就像是一颗属性结构。</li>\n</ul>\n<h2 id=\"构建渲染树\"><a href=\"#构建渲染树\" class=\"headerlink\" title=\"构建渲染树\"></a>构建渲染树</h2><p>在构建了DOM树和CSSOM树之后，浏览器只是拥有了两个互相独立的对象集合，DOM树描述了文档的结构和内容，CSSOM树则描述了对文档应用的样式规则，想要渲染页面，就需要将DOM树与CSSOM树结合在一起<br><img src=\"/images/common/render.png\" alt=\"network\"></p>\n<h2 id=\"布局与绘制\"><a href=\"#布局与绘制\" class=\"headerlink\" title=\"布局与绘制\"></a>布局与绘制</h2><p>css采用一种叫做盒子思维模型的思维模型来表示每个节点与其他元素之间的距离，盒子模型包括外边距（margin），内边距（padding），边框（border），内容（content），页面中的每一个标签都是一个个的盒子</p>\n<p><img src=\"/images/common/box.png\" alt=\"network\"><br>布局阶段会从渲染树的根节点开始遍历，然后确定每个节点对象在页面上的确切大小与位置，布局阶段的输出是一个盒子模型，它会精确地捕捉每个元素在屏幕内的确切位置与大小，所有相对的测量值也都会被转换成屏幕内的绝对像素值</p>\n<p>当Layout布局事件完成后，浏览器会立即发出Paint Setup与Paint事件，开始将渲染树绘制成像素，绘制所需的时间跟CSS样式的复杂度成正比</p>\n<h2 id=\"浏览器前进、后退使用机制\"><a href=\"#浏览器前进、后退使用机制\" class=\"headerlink\" title=\"浏览器前进、后退使用机制\"></a>浏览器前进、后退使用机制</h2><p>用户点击浏览器工具栏中的后退按钮，或者是移动设备上的返回键的时候，或者是 JS 执行<code>history.go(-1)</code>的时候，浏览器会在当前窗口“打开”历史记录中的前一个页面。不同的浏览器在“打开”前一个页面的表现并不同意，这和浏览器的实现以及页面本身的设置都有关系。在浏览器中，“后退到前一个页面”意味着：前一个页面的 html/js/css 等等的静态资源的请求（甚至是 ajax 动态接口请求）根本不会重新发送，直接使用缓存的响应，而不管这些金泰资源响应的缓存策略是否被设置了禁用状态。</p>\n<h2 id=\"history-中的操作\"><a href=\"#history-中的操作\" class=\"headerlink\" title=\"history 中的操作\"></a>history 中的操作</h2><ol>\n<li> <code>window.history.back()</code>:后退</li>\n<li> <code>window.history.dorward()</code>:前进</li>\n<li> <code>window.history.go(num)</code>:前进或后退指定数量历史记录</li>\n<li><code>window.history.pushState(state,title,url)</code>:在页面中创建一个 histor 实体，直接天剑到历史记录。<ul>\n<li>state:存储一个对象，可以添加相关信息，可以使用 history.state 读取其中的内容。</li>\n<li>title:历史记录的标题。</li>\n<li>url:创建的历史记录的链接，进行历史记录操作时会跳转到改链接。</li>\n</ul>\n</li>\n<li> <code>window.history.replaceState()</code>:修改当前的 history 实体。</li>\n<li> <code>popstate</code>事件:history 实体改变时触发的事件。</li>\n<li> <code>window.history.state</code>:会获得 history 实体中的 state 对象。</li>\n</ol>\n<h2 id=\"popstate\"><a href=\"#popstate\" class=\"headerlink\" title=\"popstate\"></a>popstate</h2><p>popstate 只会在浏览器某些行为下触发，比如点击后退、前进按钮。</p>\n<p>在微信浏览器中，从一个 HTML 跳到另一个 HTML 页面后，点击浏览器返回按钮，或者在第二个页面中调用<code>history.back()</code>等返回上一页的方法，在安卓中会直接返回上一页(相当于重新加载上一页的所有内容，js 会重新执行一遍)，但苹果手机中，范湖上一页是，浏览器会读取缓存中的页面内容，js 不会重新执行，在此进入这个页面不会触发 onload 事件。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//强制刷新：</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(</span><br><span class=\"line\">  <span class=\"string\">&#x27;popstate&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//检测到用户点击浏览器返回按钮，进行操作</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">document</span>.referrer);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//使用href的形式去用跳转的形式，跳转到上一页</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.location.href = <span class=\"built_in\">document</span>.referrer;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"literal\">false</span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"keyword\">var</span> state = &#123;</span><br><span class=\"line\">  title: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">  url: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">window</span>.history.pushState(state, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"pageshow\"><a href=\"#pageshow\" class=\"headerlink\" title=\"pageshow\"></a>pageshow</h2><p>onpageshow 事件在页面显示时触发，如果页面不在“往返缓存”中，改时间会在 onload 后触发，在 onpageshow 事件中，可以利用 event.persisted</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;pageshow&#x27;</span>.function(evernt)&#123;</span><br><span class=\"line\">    alert(event.persisted);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(event.persisted) location.reload();<span class=\"comment\">//如果检测到页面是从“往返缓存”中读取的，刷新页面。</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"unload\"><a href=\"#unload\" class=\"headerlink\" title=\"unload\"></a>unload</h2><p>指定 unload 事件处理程序的页面会被自动排除在“往返缓存”之外，即使事件处理程序是空白的，原因在于，unload 最长用于撤销 load 中所执行的操作，而跳过 load 后再次显示页面很有可能会导致页面不正常。</p>\n<h2 id=\"从输入-URL-到-页面加载发生了什么\"><a href=\"#从输入-URL-到-页面加载发生了什么\" class=\"headerlink\" title=\"从输入 URL 到 页面加载发生了什么\"></a>从输入 URL 到 页面加载发生了什么</h2><p>发生过程：</p>\n<ul>\n<li>查看 web 缓存</li>\n<li>DNS 解析</li>\n<li>TCP 连接</li>\n<li>发送 HTTP 请求</li>\n<li>服务器处理请求并返回 HTTP 报文</li>\n<li>浏览器解析渲染页面</li>\n<li>连接结束</li>\n</ul>\n<h3 id=\"查看-web-缓存\"><a href=\"#查看-web-缓存\" class=\"headerlink\" title=\"查看 web 缓存\"></a>查看 web 缓存</h3><p>浏览器获取了这个UR,就先去缓存当中查看，从浏览器缓存-系统缓存-路由缓存当中查。看到有个人的笔记是DNS 解析在前，但是不管是路由还是转发都应该是先从缓存中查看的</p>\n<p>当浏览器再次访问一个已经访问过的资源时，它会：</p>\n<ol>\n<li>通过Cache-control 和 Expires 来检查是否命中强缓存，命中则直接取本地磁盘的html（状态码为200 from disk(or memory) cache,内存or磁盘）</li>\n<li>如果没有命中强缓存，就发送请求到服务器发起请求（先进性下一步的TCP链接），服务器通过Etag 和 Last-Modify来与服务器确认返回的响应是否被更改（协商缓存）。</li>\n<li>如果命中协商缓存，访问服务器，服务器返回 304 not modified 告诉浏览器使用本地缓存。</li>\n<li>否则，请求网络返回最新资源。</li>\n</ol>\n<p>浏览器缓存的位置：</p>\n<ol>\n<li>service worker :它可以让我们自由控制哪些文件、如何匹配缓存，如何读取缓存，并且缓存是持续性的。</li>\n<li>memory cache:内存缓存，读取内存中的数据肯定比磁盘块，但是内存缓存虽然读取高效，可是缓存持续性很短，会随着进程的释放而释放，一旦关闭了 tap 页，内存中的缓存也得到了释放。</li>\n<li>disk cache：也就是存储在硬盘中的缓存，读取速度慢点，但是什么都能存储到磁盘中，比如 memory cache 胜在容量和存储时效性上。</li>\n</ol>\n<p>缓存实现：强缓存和协商缓存都是根据 HTTP Header 来实现的。</p>\n<h4 id=\"浏览器缓存机制\"><a href=\"#浏览器缓存机制\" class=\"headerlink\" title=\"浏览器缓存机制\"></a>浏览器缓存机制</h4><p><img src=\"/images/problem/2.png\" alt=\"network\"></p>\n<h5 id=\"当前缓存是否过期。\"><a href=\"#当前缓存是否过期。\" class=\"headerlink\" title=\"当前缓存是否过期。\"></a>当前缓存是否过期。</h5><p>如果浏览器通过某些条件 ( 条件之后再说 ) 判断出来，ok 现在这个缓存没有过期可以用，那么连请求都不会发的，直接是启用之前浏览器缓存下来的那份文件 (from memory cache). 浏览器直接通过缓存读取了出来，注意这个时候是不会向浏览器请求的！ 如果过期了就会向服务器重新发起请求，但是不一定就会重新拉取文件！</p>\n<h5 id=\"服务器中的文件是否改动。\"><a href=\"#服务器中的文件是否改动。\" class=\"headerlink\" title=\"服务器中的文件是否改动。\"></a>服务器中的文件是否改动。</h5><ol>\n<li><p>缓存过期，文件有改动：如果服务器发现这个文件改变了那么你肯定不能再用以前浏览器的缓存了，那就返回个 200 并且带上新的文件。</p>\n</li>\n<li><p>缓存过期，文件无改动：同时如果发现虽然那个缓存虽然过期了，可你在服务器端的文件没有变过，那么服务器只会给你返回一个头信息 (304)，让你继续用你那过期的缓存，这样就节省了很多传输文件的时间带宽啥的</p>\n</li>\n</ol>\n<p>过期了的缓存需要请求一次服务器，若服务器判断说这个文件没有改变还能用，那就返回 304。浏览器认识 304，它就会去读取过期缓存。否则就真的传一份新文件到浏览器。</p>\n<h3 id=\"DNS-解析\"><a href=\"#DNS-解析\" class=\"headerlink\" title=\"DNS 解析\"></a>DNS 解析</h3><p>浏览器查找域名对应的 IP 地址。互联网上每一台计算机的唯一识别是它的 IP 地址，DNS 解析就是讲网址转换为 IP 地址。</p>\n<p>查找过程：</p>\n<ol>\n<li>浏览器搜索自己的 DNS 缓存（维护一张域名与 IP 地址的对应表）</li>\n<li>搜索操作系统中的 DNS 缓存（维护一张域名与 IP 地址的对应表）</li>\n<li>搜索操作系统的 host 文件（Windows 环境下，维护一张域名与 IP 地址的对应表）</li>\n<li>操作系统间根域名发送至 LDNS（本地域名服务器），首先查找自己的缓存若是失败：<ul>\n<li>向根域名服务器发起请求，此处根域名服务器返回 com 域的 sing 机域名服务器地址。</li>\n<li>LDNS 向 com 域的顶级域名服务器发起请求，得到 <a href=\"http://www.baidu.com/\">www.baidu.com</a> 的地址。</li>\n<li>LONS 向 baidu.com 域名服务器发起请求，得到 <a href=\"http://www.baidu.com/\">www.baidu.com</a> 的 IP 地址。</li>\n</ul>\n</li>\n<li>LDNS 将得到的 IP 地址返回给操作系统，同时将 IP 地址缓存起来；</li>\n<li>操作系统将 IP 地址返回给浏览器，同时自己也缓存起来；</li>\n</ol>\n<p>此时浏览器得到了域名对应的 IP 地址。</p>\n<h3 id=\"TCP-连接\"><a href=\"#TCP-连接\" class=\"headerlink\" title=\"TCP 连接\"></a>TCP 连接</h3><p>浏览器根据 IP 地址与服务器建立 socket 连接 。<br>TCP协议通过三次握手建立连接。</p>\n<ul>\n<li>客户端通过SYN报文段发送连接请求，确定服务器端是否开启端口准备连接，状态设置为SYN_SEND</li>\n<li>服务器如果有开着的端口并且决定结接受连接，就会返回一个SYN+ACK报文段给客户端，状态设置为SYN_RECV</li>\n<li>客户端收到服务器的SYN+ACK报文段，向服务器发送ACK报文段表示确认。此时客户端和服务器端都设置为ESTABLISHED 状态。连接建立，可以开始数据传输了。</li>\n</ul>\n<h3 id=\"发送-HTTP-请求\"><a href=\"#发送-HTTP-请求\" class=\"headerlink\" title=\"发送 HTTP 请求\"></a>发送 HTTP 请求</h3><ol>\n<li>浏览器根据 URL 内容生成 HTTP 请求，请求中包含文件的位置，请求文件的方式等。</li>\n<li>服务器接到请求后，会根据 HTTP 请求中的内容来决定如何获取相应的 HTML 文件。</li>\n</ol>\n<h4 id=\"http-状态码\"><a href=\"#http-状态码\" class=\"headerlink\" title=\"http 状态码\"></a>http 状态码</h4><ol>\n<li>200 form memory cache 不访问服务器，直接读缓存 ，此时的缓存是缓存在内存中的，当 kill 进程之后数据就会不存在。这种方式只能缓存派生资源。</li>\n<li>200 OK (from cache) 是浏览器没有跟服务器确认，直接用了浏览器缓存。</li>\n<li>304 Not Modified 是浏览器和服务器多确认了一次缓存有效性，再用的缓存。200(from cache) 是速度最快的 , 因为不需要访问远程服务器 , 直接使用本地缓存 .304 的过程是 , 先请求服务器 , 然后服务器告诉我们这个资源没变 , 浏览器再使用本地缓存。</li>\n<li>200 from dist cache 不访问服务器，直接度缓存，当进程 kill 时，数据依旧存在。只能缓存派生资源。</li>\n</ol>\n<p><img src=\"/images/problem/1.png\" alt=\"network\"></p>\n<h3 id=\"浏览器解析渲染页面\"><a href=\"#浏览器解析渲染页面\" class=\"headerlink\" title=\"浏览器解析渲染页面\"></a>浏览器解析渲染页面</h3><p>现代浏览器渲染页面过程是：解码（字节流到字符流） ——&gt; 分词（此法分析） ——&gt; 解析（语法分析）——&gt; 构建 DOM 树 ——&gt; 构建渲染树 ——&gt; 布局渲染树 ——&gt; 绘制渲染树</p>\n<h3 id=\"连接结束\"><a href=\"#连接结束\" class=\"headerlink\" title=\"连接结束\"></a>连接结束</h3><p>断开连接 –4 次挥手</p>\n<ul>\n<li><p>为什么服务器在接到断开请求时不立即同意断开：当服务器收到断开连接的请求时，可能仍然有数据未发送完毕，所以服务器先发送确认信号，等所有数据发送完毕后再同意断开。</p>\n</li>\n<li><p>第四次握手后，主机发送确认信号后并没有立即断开连接，而是等待了 2 个报文传送周期，原因是：如果第四次握手的确认信息丢失，服务器将会重新发送第三次握手的断开连接的信号，而服务器发觉丢包与重新发送的断开连接到达主机的时间正好为 2 个报文传输周期。</p>\n</li>\n</ul>"},{"title":"疑难杂问整理（原生JS）","date":"2018-01-19T02:12:08.000Z","_content":"\n在学习原生的过程中的困惑与解惑的总结\n\n<!--more-->\n\n## 工厂模式\n\n```javascript\nfunction createPerson(name, age, job) {\n  var o = new Object();\n  o.name = name;\n  o.age = age;\n  o.job = job;\n  o.sayName = function() {\n    alert(this.name);\n  };\n  return 0;\n}\n\nvar person1 = createPerson('Nicholas', 29, 'Software Engineer');\nvar person2 = createPerson('Greg', 27, 'Doctor');\n\nperson1; // Person {name: \"Zaxlct\", age: 28, job: \"Software Engineer\", sayName: ƒ}\nperson2; // Person {name: \"Mick\", age: 23, job: \"Doctor\", sayName: ƒ}\n```\n\n## 构造函数\n\n```javascript\nfunction Person(name, age, job) {\n  this.name = name;\n  this.age = age;\n  this.job = job;\n  this.sayName = function() {\n    alert(this.name);\n  };\n}\nvar person1 = new Person('Zaxlct', 28, 'Software Engineer');\nvar person2 = new Person('Mick', 23, 'Doctor');\nvar person3 = new Person('Mick', 23, 'Doctor');\nperson1; // Person {name: \"Zaxlct\", age: 28, job: \"Software Engineer\", sayName: ƒ}\nperson2; // Person {name: \"Mick\", age: 23, job: \"Doctor\", sayName: ƒ}\nperson2 === person3; //false\nperson1.constructor == Person; //true\nPerson.prototype; // {constructor: ƒ}  为原型对象\nperson1.prototype; //undefined\nPerson.prototype.prototype; //undefined\nperson1.constructor == Person; //true\nPerson.prototype.constructor == Person; //true\n```\n\n实例的构造函数属性（constructor ）指向构造函数。所有的原型对象都会自动获得一个 constructor （构造函数属性）属性\n\n```javascript\nfunction Person(name, age, job) {\n  this.name = name;\n  this.age = age;\n  this.job = job;\n  this.sayName = function() {\n    alert(this.name);\n  };\n  return this;\n}\nvar person1 = Person('Zaxlct', 28, 'Software Engineer');\nvar person2 = Person('Mick', 23, 'Doctor');\nperson1; // this 指向window 且被person2覆盖\nperson2; // this 指向window\n```\n\n**与工厂模式的区别**\n\n- 没有显示创建对象（new 运算符创建并实例化新对象）。\n- 直接将属性和方法赋给了 this 对象。\n- 没有 return 语句。\n- 要创建新实例必须要使用 new 运算符，否者属性和方法将会被添加到 window 对象\n- 可以使用 instanceof 操作符检测对象类型。\n\n构造函数的问题：构造函数的内部方法会被重复构建，不同实例内的同名函数是不相等的。\n\n## html 页面的渲染过程\n\n当用户请求页面时，浏览器获取 HTML 并构造 DOM。然后获取 CSS 并构造 CSSOM。然后通过匹配 DOM 和 CSSDOM 生成渲染树。如果有任何的 javascript 需要解决，浏览器将不会开始渲染页面，知道 javascript 解决完毕。\n\n## 事件模型是什么\n\nw3c 中定义的事件发生过程中的 3 个阶段：捕获阶段，目标阶段，冒泡阶段\n\n## 为什么操作真实 DOM 有性能问题\n\n因为 DOM 是属于渲染引擎中的东西，而 JS 又是 JS 引擎中的东西。当通过 JS 操作 DOM 的时候，其实这个操作涉及到了两个线程之间的通信，那么势必会带来一些性能能上的损耗。操作 DOM 次数一多，也就等同于一直在进行进程之间的通信，并且操作 DOM 可能还会带来重绘回流的情况，所以就导致一些性能上的问题。\n","source":"_posts/疑难杂问整理（原生JS）.md","raw":"---\ntitle: 疑难杂问整理（原生JS）\ndate: 2018-01-19 10:12:08\ncategories: JavaScript\n---\n\n在学习原生的过程中的困惑与解惑的总结\n\n<!--more-->\n\n## 工厂模式\n\n```javascript\nfunction createPerson(name, age, job) {\n  var o = new Object();\n  o.name = name;\n  o.age = age;\n  o.job = job;\n  o.sayName = function() {\n    alert(this.name);\n  };\n  return 0;\n}\n\nvar person1 = createPerson('Nicholas', 29, 'Software Engineer');\nvar person2 = createPerson('Greg', 27, 'Doctor');\n\nperson1; // Person {name: \"Zaxlct\", age: 28, job: \"Software Engineer\", sayName: ƒ}\nperson2; // Person {name: \"Mick\", age: 23, job: \"Doctor\", sayName: ƒ}\n```\n\n## 构造函数\n\n```javascript\nfunction Person(name, age, job) {\n  this.name = name;\n  this.age = age;\n  this.job = job;\n  this.sayName = function() {\n    alert(this.name);\n  };\n}\nvar person1 = new Person('Zaxlct', 28, 'Software Engineer');\nvar person2 = new Person('Mick', 23, 'Doctor');\nvar person3 = new Person('Mick', 23, 'Doctor');\nperson1; // Person {name: \"Zaxlct\", age: 28, job: \"Software Engineer\", sayName: ƒ}\nperson2; // Person {name: \"Mick\", age: 23, job: \"Doctor\", sayName: ƒ}\nperson2 === person3; //false\nperson1.constructor == Person; //true\nPerson.prototype; // {constructor: ƒ}  为原型对象\nperson1.prototype; //undefined\nPerson.prototype.prototype; //undefined\nperson1.constructor == Person; //true\nPerson.prototype.constructor == Person; //true\n```\n\n实例的构造函数属性（constructor ）指向构造函数。所有的原型对象都会自动获得一个 constructor （构造函数属性）属性\n\n```javascript\nfunction Person(name, age, job) {\n  this.name = name;\n  this.age = age;\n  this.job = job;\n  this.sayName = function() {\n    alert(this.name);\n  };\n  return this;\n}\nvar person1 = Person('Zaxlct', 28, 'Software Engineer');\nvar person2 = Person('Mick', 23, 'Doctor');\nperson1; // this 指向window 且被person2覆盖\nperson2; // this 指向window\n```\n\n**与工厂模式的区别**\n\n- 没有显示创建对象（new 运算符创建并实例化新对象）。\n- 直接将属性和方法赋给了 this 对象。\n- 没有 return 语句。\n- 要创建新实例必须要使用 new 运算符，否者属性和方法将会被添加到 window 对象\n- 可以使用 instanceof 操作符检测对象类型。\n\n构造函数的问题：构造函数的内部方法会被重复构建，不同实例内的同名函数是不相等的。\n\n## html 页面的渲染过程\n\n当用户请求页面时，浏览器获取 HTML 并构造 DOM。然后获取 CSS 并构造 CSSOM。然后通过匹配 DOM 和 CSSDOM 生成渲染树。如果有任何的 javascript 需要解决，浏览器将不会开始渲染页面，知道 javascript 解决完毕。\n\n## 事件模型是什么\n\nw3c 中定义的事件发生过程中的 3 个阶段：捕获阶段，目标阶段，冒泡阶段\n\n## 为什么操作真实 DOM 有性能问题\n\n因为 DOM 是属于渲染引擎中的东西，而 JS 又是 JS 引擎中的东西。当通过 JS 操作 DOM 的时候，其实这个操作涉及到了两个线程之间的通信，那么势必会带来一些性能能上的损耗。操作 DOM 次数一多，也就等同于一直在进行进程之间的通信，并且操作 DOM 可能还会带来重绘回流的情况，所以就导致一些性能上的问题。\n","slug":"疑难杂问整理（原生JS）","published":1,"updated":"2021-02-27T13:04:25.417Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xi002yl5v03qh39x1k","content":"<p>在学习原生的过程中的困惑与解惑的总结</p>\n<span id=\"more\"></span>\n\n<h2 id=\"工厂模式\"><a href=\"#工厂模式\" class=\"headerlink\" title=\"工厂模式\"></a>工厂模式</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createPerson</span>(<span class=\"params\">name, age, job</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> o = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>();</span><br><span class=\"line\">  o.name = name;</span><br><span class=\"line\">  o.age = age;</span><br><span class=\"line\">  o.job = job;</span><br><span class=\"line\">  o.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> person1 = createPerson(<span class=\"string\">&#x27;Nicholas&#x27;</span>, <span class=\"number\">29</span>, <span class=\"string\">&#x27;Software Engineer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> person2 = createPerson(<span class=\"string\">&#x27;Greg&#x27;</span>, <span class=\"number\">27</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">person1; <span class=\"comment\">// Person &#123;name: &quot;Zaxlct&quot;, age: 28, job: &quot;Software Engineer&quot;, sayName: ƒ&#125;</span></span><br><span class=\"line\">person2; <span class=\"comment\">// Person &#123;name: &quot;Mick&quot;, age: 23, job: &quot;Doctor&quot;, sayName: ƒ&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, job</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.job = job;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person1 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Zaxlct&#x27;</span>, <span class=\"number\">28</span>, <span class=\"string\">&#x27;Software Engineer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> person2 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Mick&#x27;</span>, <span class=\"number\">23</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> person3 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Mick&#x27;</span>, <span class=\"number\">23</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>);</span><br><span class=\"line\">person1; <span class=\"comment\">// Person &#123;name: &quot;Zaxlct&quot;, age: 28, job: &quot;Software Engineer&quot;, sayName: ƒ&#125;</span></span><br><span class=\"line\">person2; <span class=\"comment\">// Person &#123;name: &quot;Mick&quot;, age: 23, job: &quot;Doctor&quot;, sayName: ƒ&#125;</span></span><br><span class=\"line\">person2 === person3; <span class=\"comment\">//false</span></span><br><span class=\"line\">person1.constructor == Person; <span class=\"comment\">//true</span></span><br><span class=\"line\">Person.prototype; <span class=\"comment\">// &#123;constructor: ƒ&#125;  为原型对象</span></span><br><span class=\"line\">person1.prototype; <span class=\"comment\">//undefined</span></span><br><span class=\"line\">Person.prototype.prototype; <span class=\"comment\">//undefined</span></span><br><span class=\"line\">person1.constructor == Person; <span class=\"comment\">//true</span></span><br><span class=\"line\">Person.prototype.constructor == Person; <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<p>实例的构造函数属性（constructor ）指向构造函数。所有的原型对象都会自动获得一个 constructor （构造函数属性）属性</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, job</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.job = job;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person1 = Person(<span class=\"string\">&#x27;Zaxlct&#x27;</span>, <span class=\"number\">28</span>, <span class=\"string\">&#x27;Software Engineer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> person2 = Person(<span class=\"string\">&#x27;Mick&#x27;</span>, <span class=\"number\">23</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>);</span><br><span class=\"line\">person1; <span class=\"comment\">// this 指向window 且被person2覆盖</span></span><br><span class=\"line\">person2; <span class=\"comment\">// this 指向window</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>与工厂模式的区别</strong></p>\n<ul>\n<li>没有显示创建对象（new 运算符创建并实例化新对象）。</li>\n<li>直接将属性和方法赋给了 this 对象。</li>\n<li>没有 return 语句。</li>\n<li>要创建新实例必须要使用 new 运算符，否者属性和方法将会被添加到 window 对象</li>\n<li>可以使用 instanceof 操作符检测对象类型。</li>\n</ul>\n<p>构造函数的问题：构造函数的内部方法会被重复构建，不同实例内的同名函数是不相等的。</p>\n<h2 id=\"html-页面的渲染过程\"><a href=\"#html-页面的渲染过程\" class=\"headerlink\" title=\"html 页面的渲染过程\"></a>html 页面的渲染过程</h2><p>当用户请求页面时，浏览器获取 HTML 并构造 DOM。然后获取 CSS 并构造 CSSOM。然后通过匹配 DOM 和 CSSDOM 生成渲染树。如果有任何的 javascript 需要解决，浏览器将不会开始渲染页面，知道 javascript 解决完毕。</p>\n<h2 id=\"事件模型是什么\"><a href=\"#事件模型是什么\" class=\"headerlink\" title=\"事件模型是什么\"></a>事件模型是什么</h2><p>w3c 中定义的事件发生过程中的 3 个阶段：捕获阶段，目标阶段，冒泡阶段</p>\n<h2 id=\"为什么操作真实-DOM-有性能问题\"><a href=\"#为什么操作真实-DOM-有性能问题\" class=\"headerlink\" title=\"为什么操作真实 DOM 有性能问题\"></a>为什么操作真实 DOM 有性能问题</h2><p>因为 DOM 是属于渲染引擎中的东西，而 JS 又是 JS 引擎中的东西。当通过 JS 操作 DOM 的时候，其实这个操作涉及到了两个线程之间的通信，那么势必会带来一些性能能上的损耗。操作 DOM 次数一多，也就等同于一直在进行进程之间的通信，并且操作 DOM 可能还会带来重绘回流的情况，所以就导致一些性能上的问题。</p>\n","site":{"data":{}},"excerpt":"<p>在学习原生的过程中的困惑与解惑的总结</p>","more":"<h2 id=\"工厂模式\"><a href=\"#工厂模式\" class=\"headerlink\" title=\"工厂模式\"></a>工厂模式</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createPerson</span>(<span class=\"params\">name, age, job</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> o = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>();</span><br><span class=\"line\">  o.name = name;</span><br><span class=\"line\">  o.age = age;</span><br><span class=\"line\">  o.job = job;</span><br><span class=\"line\">  o.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> person1 = createPerson(<span class=\"string\">&#x27;Nicholas&#x27;</span>, <span class=\"number\">29</span>, <span class=\"string\">&#x27;Software Engineer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> person2 = createPerson(<span class=\"string\">&#x27;Greg&#x27;</span>, <span class=\"number\">27</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">person1; <span class=\"comment\">// Person &#123;name: &quot;Zaxlct&quot;, age: 28, job: &quot;Software Engineer&quot;, sayName: ƒ&#125;</span></span><br><span class=\"line\">person2; <span class=\"comment\">// Person &#123;name: &quot;Mick&quot;, age: 23, job: &quot;Doctor&quot;, sayName: ƒ&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, job</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.job = job;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person1 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Zaxlct&#x27;</span>, <span class=\"number\">28</span>, <span class=\"string\">&#x27;Software Engineer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> person2 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Mick&#x27;</span>, <span class=\"number\">23</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> person3 = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;Mick&#x27;</span>, <span class=\"number\">23</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>);</span><br><span class=\"line\">person1; <span class=\"comment\">// Person &#123;name: &quot;Zaxlct&quot;, age: 28, job: &quot;Software Engineer&quot;, sayName: ƒ&#125;</span></span><br><span class=\"line\">person2; <span class=\"comment\">// Person &#123;name: &quot;Mick&quot;, age: 23, job: &quot;Doctor&quot;, sayName: ƒ&#125;</span></span><br><span class=\"line\">person2 === person3; <span class=\"comment\">//false</span></span><br><span class=\"line\">person1.constructor == Person; <span class=\"comment\">//true</span></span><br><span class=\"line\">Person.prototype; <span class=\"comment\">// &#123;constructor: ƒ&#125;  为原型对象</span></span><br><span class=\"line\">person1.prototype; <span class=\"comment\">//undefined</span></span><br><span class=\"line\">Person.prototype.prototype; <span class=\"comment\">//undefined</span></span><br><span class=\"line\">person1.constructor == Person; <span class=\"comment\">//true</span></span><br><span class=\"line\">Person.prototype.constructor == Person; <span class=\"comment\">//true</span></span><br></pre></td></tr></table></figure>\n\n<p>实例的构造函数属性（constructor ）指向构造函数。所有的原型对象都会自动获得一个 constructor （构造函数属性）属性</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age, job</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.job = job;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person1 = Person(<span class=\"string\">&#x27;Zaxlct&#x27;</span>, <span class=\"number\">28</span>, <span class=\"string\">&#x27;Software Engineer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> person2 = Person(<span class=\"string\">&#x27;Mick&#x27;</span>, <span class=\"number\">23</span>, <span class=\"string\">&#x27;Doctor&#x27;</span>);</span><br><span class=\"line\">person1; <span class=\"comment\">// this 指向window 且被person2覆盖</span></span><br><span class=\"line\">person2; <span class=\"comment\">// this 指向window</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>与工厂模式的区别</strong></p>\n<ul>\n<li>没有显示创建对象（new 运算符创建并实例化新对象）。</li>\n<li>直接将属性和方法赋给了 this 对象。</li>\n<li>没有 return 语句。</li>\n<li>要创建新实例必须要使用 new 运算符，否者属性和方法将会被添加到 window 对象</li>\n<li>可以使用 instanceof 操作符检测对象类型。</li>\n</ul>\n<p>构造函数的问题：构造函数的内部方法会被重复构建，不同实例内的同名函数是不相等的。</p>\n<h2 id=\"html-页面的渲染过程\"><a href=\"#html-页面的渲染过程\" class=\"headerlink\" title=\"html 页面的渲染过程\"></a>html 页面的渲染过程</h2><p>当用户请求页面时，浏览器获取 HTML 并构造 DOM。然后获取 CSS 并构造 CSSOM。然后通过匹配 DOM 和 CSSDOM 生成渲染树。如果有任何的 javascript 需要解决，浏览器将不会开始渲染页面，知道 javascript 解决完毕。</p>\n<h2 id=\"事件模型是什么\"><a href=\"#事件模型是什么\" class=\"headerlink\" title=\"事件模型是什么\"></a>事件模型是什么</h2><p>w3c 中定义的事件发生过程中的 3 个阶段：捕获阶段，目标阶段，冒泡阶段</p>\n<h2 id=\"为什么操作真实-DOM-有性能问题\"><a href=\"#为什么操作真实-DOM-有性能问题\" class=\"headerlink\" title=\"为什么操作真实 DOM 有性能问题\"></a>为什么操作真实 DOM 有性能问题</h2><p>因为 DOM 是属于渲染引擎中的东西，而 JS 又是 JS 引擎中的东西。当通过 JS 操作 DOM 的时候，其实这个操作涉及到了两个线程之间的通信，那么势必会带来一些性能能上的损耗。操作 DOM 次数一多，也就等同于一直在进行进程之间的通信，并且操作 DOM 可能还会带来重绘回流的情况，所以就导致一些性能上的问题。</p>"},{"title":"移动端监听返回键","date":"2019-12-10T16:00:00.000Z","_content":"\n一直以为监听返回按键是 H5 做不到的事情，其实是可以做到的。所以记录一下，深究一下。\n最近在工作中也接触到这个需求，需要在不同的情况下达到能正常返回或是跳转到其他页面(但是我想这个只能在多页应用实现，单页应用应该是不可以的，没有去尝试过)。\n\n<!--more-->\n\n```javascript\nfunction pushHistory() {\n  var state = {\n    title: 'title',\n    url: '#'\n  }\n  window.history.pushState(state, 'title', '#')\n}\n\nwindow.addEventListener(\n  'popstate',\n  function (e) {\n    //监听到返回时间 执行自己的js\n  },\n  false\n)\n```\n\n这样实现的代码在移动端可以监听浏览器返回按键、物理返回按键、虚拟返回按键、手势返回按键等。\nhistory.state 中包含了 state 的 一份拷贝，可以使用 history.state 读取其中的内容。\n\n## history.pushState\n\n在当前页面创建并激活新的历史记录。\n\n当调用 history.pushSate 或者是 history.replaceSate()不会触发 popstate 事件。只有做出后退的动作（执行 history.back()、history.go(-1)）时才会执行该事件。另外，该事件只针对同一个文档，如果浏览历史的切换，导致加载不同的文档，该事件也不会触发。\n\n在百度的控制台输入以下代码：\n\n`window.history.pushState(null, null, \"https://www.baidu.com/?name=orange\");`\n地址显示是https://www.baidu.com/name/orange，注意这里的url是不支持跨域的，跨域会报错.\n\nhistory.pushState()只会改变当前地址的路径，并不会更新页面内容，只是产生了浏览器历史记录，此时点击返回按钮就返回到本页面，且也没有刷新，而且可以前进到https://www.baidu.com/?name=orange 页面\n\n当我们在历史记录中切换的时候就会触发 popstate 事件。\n\npushSate 三个参数：\n\n- state，状态对象，状态对象 state 是一个 JS 对象，通过 pushSate()创建新的历史记录条目。无论什么时候用户导航到新的状态，popstate 时间就会被触发，且该时间的 state 属性包含该历史记录条目状态对象的副本。\n- title，历史记录的标题\n- url，创建的历史记录的链接。进行历史记录操作时会跳转到该链接。\n\n## popstate\n\npopstate 事件，history 实体(hostory.state)改变时触发的事件。\n\n当活动的历史条目被更改时，将触发 popstate 事件。如果被激活的历史记录条目是通过对 history.pushState()的调用创建的，或者受到 history.replaceSate()的调用的影响，popstate 的 state 属性包含历史条目的状态的对象的副本——MDN\n\npopstate 每当活动历史记录在同一个文档的两个历史记录条目之间发生变化时，就会将事件分派到窗口。如果激活的历史记录条目是通过调用 history.pushState()创建的，或者受到 history.replaceState()调用的影响，则该 popstate 事件的 state 属性包含历史记录项的状态对象的副本。\n\n注意：用于处理 popstate 事件的浏览器在页面加载时的方式不同，但现在它们的行为相同。Firefox 从未在页面加载时发出 popstate 事件，Chrome 直到版本 34 才可以，而 Safari 一直到版本 10.0。\n\n## 往返缓存\n\n默认情况下，浏览器会在当前会话(session)缓存页面，当用户点击“前进”或“后退”按钮时，浏览器就会从缓存中加载页面（除去 meta 中加 no-cache 的情况）。\n\n浏览器有一个特性叫“往返缓存”(back-forward cache 或 bfcache)，可以在用户使用浏览器的“后退”和“前进”按钮时加快页面的转换速度。这个缓存中不仅保存着页面数据，还保存了 DOM 和 javascript 的状态；实际上是将整个页面都保存在了内存里。如果页面位于 bfcache 中，那么再次打开该页面时就不会触发 load 事件\n\n## 注意事项\n\n1. 每次返回都会消耗一个 history 实体，若用户选择取消离开，则需要继续 pushSate 一个实体\n2. pushState 只能一个实体，多个实体返回会报错。使用 window.history.state 查询是否存在添加的实体。\n\n例如，运行以下代码的http://example.com/example.html中的页面将按照指示生成警报：\n\n```javascript\nwindow.onpopstate = function (event) {\n  alert(\n    'location: ' + document.location + ', state: ' + JSON.stringify(event.state)\n  )\n}\nhistory.pushState({ page: 1 }, 'title 1', '?page=1')\nhistory.pushState({ page: 2 }, 'title 2', '?page=2')\nhistory.replaceState({ page: 3 }, 'title 3', '?page=3')\nhistory.back() // alerts \"location: http://example.com/example.html?page=1, state: {\"page\":1}\"\nhistory.back() // alerts \"location: http://example.com/example.html, state: null history.go(2);\n// alerts \"location: http://example.com/example.html?page=3, state: {\"page\":3}\n```\n\n请注意，即使原始历史记录项（for http://example.com/example.html）没有与其关联的状态对象，但当我们在第二次调用history.back()后激活该现时，仍然会触发一个popstate事件。\n\n## 填坑史\n\n这种东西一看就不靠谱，一用果然不靠谱，在移动端兼容好像还可以，目前没有发现在什么低端手机上完全不支持的。\n\n需求是根据不同的情况来跳转，但是若是由接口返回参数进行判断的话则有可能用户在接口还没有反应的时候就进行了跳转，因此是使用的判断 cookies 的方式执行的 js。\n\n业务场景：\n\n页面 A->B->C，C 返回至 B 时页面返回时需要返回到指定的其他页面，比如跳到百度。\n\n### IOS 端 popstate 的怪异行为\n\n由于 ios 的性能在缓存页面比较好，所以一般页面的后退都会保存之前的历史页面，不会触发页面上的 js 等，所以可以触发到 popstate 事件，而 webkit 的某些版本对 popstate 的理解与官方标准不一致，导致每次访问页面都会同步为访问了这个页面的历史纪录，所以 popstate 就被触发了。\n\n问题：在 ios 上，页面 C 返回时，立即执行了 popstate 事件，导致直接跳转到百度了。\n\n解决方法：通过 pageshow 事件处理\n\n```javascript\nvar bool = false //定义一个变量\nwindow.addEventListener('pageshow', function () {\n  bool = false //进入页面时bool置为false，防止ios立即执行popstate\n  setTimeout(function () {\n    //定时器延迟将bool置为true\n    bool = true\n  }, 500)\n})\n\npushHistory()\n\nwindow.addEventListener(\n  'popstate',\n  function (e) {\n    if (bool) {\n      window.location.href = 'http://www.baidu.com'\n    }\n  },\n  false\n)\n\nfunction pushHistory() {\n  var state = { title: 'title', url: '#' }\n  window.history.pushState(state, 'title', '#')\n}\n```\n\n### 刷新时反复 pushState\n\n因为刷新时重复 pushState，所以跳转到 baidu.com 时无法正常返回。\n\n```javascript\nif (!history.state || history.state.url !== '#') {\n  //避免刷新是反复pushSate\n  pushHistory()\n}\n\nif (!history.state || history.state.url !== '#') {\n  //避免刷新是反复pushSate\n  pushHistory()\n}\n```\n\n感觉就是很不靠谱，所以使用的时候慎重加多测。\n","source":"_posts/移动端监听返回键.md","raw":"---\ntitle: 移动端监听返回键\ndate: 2019-12-11\ncategories: JavaScript\n---\n\n一直以为监听返回按键是 H5 做不到的事情，其实是可以做到的。所以记录一下，深究一下。\n最近在工作中也接触到这个需求，需要在不同的情况下达到能正常返回或是跳转到其他页面(但是我想这个只能在多页应用实现，单页应用应该是不可以的，没有去尝试过)。\n\n<!--more-->\n\n```javascript\nfunction pushHistory() {\n  var state = {\n    title: 'title',\n    url: '#'\n  }\n  window.history.pushState(state, 'title', '#')\n}\n\nwindow.addEventListener(\n  'popstate',\n  function (e) {\n    //监听到返回时间 执行自己的js\n  },\n  false\n)\n```\n\n这样实现的代码在移动端可以监听浏览器返回按键、物理返回按键、虚拟返回按键、手势返回按键等。\nhistory.state 中包含了 state 的 一份拷贝，可以使用 history.state 读取其中的内容。\n\n## history.pushState\n\n在当前页面创建并激活新的历史记录。\n\n当调用 history.pushSate 或者是 history.replaceSate()不会触发 popstate 事件。只有做出后退的动作（执行 history.back()、history.go(-1)）时才会执行该事件。另外，该事件只针对同一个文档，如果浏览历史的切换，导致加载不同的文档，该事件也不会触发。\n\n在百度的控制台输入以下代码：\n\n`window.history.pushState(null, null, \"https://www.baidu.com/?name=orange\");`\n地址显示是https://www.baidu.com/name/orange，注意这里的url是不支持跨域的，跨域会报错.\n\nhistory.pushState()只会改变当前地址的路径，并不会更新页面内容，只是产生了浏览器历史记录，此时点击返回按钮就返回到本页面，且也没有刷新，而且可以前进到https://www.baidu.com/?name=orange 页面\n\n当我们在历史记录中切换的时候就会触发 popstate 事件。\n\npushSate 三个参数：\n\n- state，状态对象，状态对象 state 是一个 JS 对象，通过 pushSate()创建新的历史记录条目。无论什么时候用户导航到新的状态，popstate 时间就会被触发，且该时间的 state 属性包含该历史记录条目状态对象的副本。\n- title，历史记录的标题\n- url，创建的历史记录的链接。进行历史记录操作时会跳转到该链接。\n\n## popstate\n\npopstate 事件，history 实体(hostory.state)改变时触发的事件。\n\n当活动的历史条目被更改时，将触发 popstate 事件。如果被激活的历史记录条目是通过对 history.pushState()的调用创建的，或者受到 history.replaceSate()的调用的影响，popstate 的 state 属性包含历史条目的状态的对象的副本——MDN\n\npopstate 每当活动历史记录在同一个文档的两个历史记录条目之间发生变化时，就会将事件分派到窗口。如果激活的历史记录条目是通过调用 history.pushState()创建的，或者受到 history.replaceState()调用的影响，则该 popstate 事件的 state 属性包含历史记录项的状态对象的副本。\n\n注意：用于处理 popstate 事件的浏览器在页面加载时的方式不同，但现在它们的行为相同。Firefox 从未在页面加载时发出 popstate 事件，Chrome 直到版本 34 才可以，而 Safari 一直到版本 10.0。\n\n## 往返缓存\n\n默认情况下，浏览器会在当前会话(session)缓存页面，当用户点击“前进”或“后退”按钮时，浏览器就会从缓存中加载页面（除去 meta 中加 no-cache 的情况）。\n\n浏览器有一个特性叫“往返缓存”(back-forward cache 或 bfcache)，可以在用户使用浏览器的“后退”和“前进”按钮时加快页面的转换速度。这个缓存中不仅保存着页面数据，还保存了 DOM 和 javascript 的状态；实际上是将整个页面都保存在了内存里。如果页面位于 bfcache 中，那么再次打开该页面时就不会触发 load 事件\n\n## 注意事项\n\n1. 每次返回都会消耗一个 history 实体，若用户选择取消离开，则需要继续 pushSate 一个实体\n2. pushState 只能一个实体，多个实体返回会报错。使用 window.history.state 查询是否存在添加的实体。\n\n例如，运行以下代码的http://example.com/example.html中的页面将按照指示生成警报：\n\n```javascript\nwindow.onpopstate = function (event) {\n  alert(\n    'location: ' + document.location + ', state: ' + JSON.stringify(event.state)\n  )\n}\nhistory.pushState({ page: 1 }, 'title 1', '?page=1')\nhistory.pushState({ page: 2 }, 'title 2', '?page=2')\nhistory.replaceState({ page: 3 }, 'title 3', '?page=3')\nhistory.back() // alerts \"location: http://example.com/example.html?page=1, state: {\"page\":1}\"\nhistory.back() // alerts \"location: http://example.com/example.html, state: null history.go(2);\n// alerts \"location: http://example.com/example.html?page=3, state: {\"page\":3}\n```\n\n请注意，即使原始历史记录项（for http://example.com/example.html）没有与其关联的状态对象，但当我们在第二次调用history.back()后激活该现时，仍然会触发一个popstate事件。\n\n## 填坑史\n\n这种东西一看就不靠谱，一用果然不靠谱，在移动端兼容好像还可以，目前没有发现在什么低端手机上完全不支持的。\n\n需求是根据不同的情况来跳转，但是若是由接口返回参数进行判断的话则有可能用户在接口还没有反应的时候就进行了跳转，因此是使用的判断 cookies 的方式执行的 js。\n\n业务场景：\n\n页面 A->B->C，C 返回至 B 时页面返回时需要返回到指定的其他页面，比如跳到百度。\n\n### IOS 端 popstate 的怪异行为\n\n由于 ios 的性能在缓存页面比较好，所以一般页面的后退都会保存之前的历史页面，不会触发页面上的 js 等，所以可以触发到 popstate 事件，而 webkit 的某些版本对 popstate 的理解与官方标准不一致，导致每次访问页面都会同步为访问了这个页面的历史纪录，所以 popstate 就被触发了。\n\n问题：在 ios 上，页面 C 返回时，立即执行了 popstate 事件，导致直接跳转到百度了。\n\n解决方法：通过 pageshow 事件处理\n\n```javascript\nvar bool = false //定义一个变量\nwindow.addEventListener('pageshow', function () {\n  bool = false //进入页面时bool置为false，防止ios立即执行popstate\n  setTimeout(function () {\n    //定时器延迟将bool置为true\n    bool = true\n  }, 500)\n})\n\npushHistory()\n\nwindow.addEventListener(\n  'popstate',\n  function (e) {\n    if (bool) {\n      window.location.href = 'http://www.baidu.com'\n    }\n  },\n  false\n)\n\nfunction pushHistory() {\n  var state = { title: 'title', url: '#' }\n  window.history.pushState(state, 'title', '#')\n}\n```\n\n### 刷新时反复 pushState\n\n因为刷新时重复 pushState，所以跳转到 baidu.com 时无法正常返回。\n\n```javascript\nif (!history.state || history.state.url !== '#') {\n  //避免刷新是反复pushSate\n  pushHistory()\n}\n\nif (!history.state || history.state.url !== '#') {\n  //避免刷新是反复pushSate\n  pushHistory()\n}\n```\n\n感觉就是很不靠谱，所以使用的时候慎重加多测。\n","slug":"移动端监听返回键","published":1,"updated":"2021-04-24T15:38:16.550Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xj0030l5v0a7tq9al2","content":"<p>一直以为监听返回按键是 H5 做不到的事情，其实是可以做到的。所以记录一下，深究一下。<br>最近在工作中也接触到这个需求，需要在不同的情况下达到能正常返回或是跳转到其他页面(但是我想这个只能在多页应用实现，单页应用应该是不可以的，没有去尝试过)。</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushHistory</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> state = &#123;</span><br><span class=\"line\">    title: <span class=\"string\">&#x27;title&#x27;</span>,</span><br><span class=\"line\">    url: <span class=\"string\">&#x27;#&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.history.pushState(state, <span class=\"string\">&#x27;title&#x27;</span>, <span class=\"string\">&#x27;#&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(</span><br><span class=\"line\">  <span class=\"string\">&#x27;popstate&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//监听到返回时间 执行自己的js</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"literal\">false</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>这样实现的代码在移动端可以监听浏览器返回按键、物理返回按键、虚拟返回按键、手势返回按键等。<br>history.state 中包含了 state 的 一份拷贝，可以使用 history.state 读取其中的内容。</p>\n<h2 id=\"history-pushState\"><a href=\"#history-pushState\" class=\"headerlink\" title=\"history.pushState\"></a>history.pushState</h2><p>在当前页面创建并激活新的历史记录。</p>\n<p>当调用 history.pushSate 或者是 history.replaceSate()不会触发 popstate 事件。只有做出后退的动作（执行 history.back()、history.go(-1)）时才会执行该事件。另外，该事件只针对同一个文档，如果浏览历史的切换，导致加载不同的文档，该事件也不会触发。</p>\n<p>在百度的控制台输入以下代码：</p>\n<p><code>window.history.pushState(null, null, &quot;https://www.baidu.com/?name=orange&quot;);</code><br>地址显示是<a href=\"https://www.baidu.com/name/orange%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%E7%9A%84url%E6%98%AF%E4%B8%8D%E6%94%AF%E6%8C%81%E8%B7%A8%E5%9F%9F%E7%9A%84%EF%BC%8C%E8%B7%A8%E5%9F%9F%E4%BC%9A%E6%8A%A5%E9%94%99\">https://www.baidu.com/name/orange，注意这里的url是不支持跨域的，跨域会报错</a>.</p>\n<p>history.pushState()只会改变当前地址的路径，并不会更新页面内容，只是产生了浏览器历史记录，此时点击返回按钮就返回到本页面，且也没有刷新，而且可以前进到<a href=\"https://www.baidu.com/?name=orange\">https://www.baidu.com/?name=orange</a> 页面</p>\n<p>当我们在历史记录中切换的时候就会触发 popstate 事件。</p>\n<p>pushSate 三个参数：</p>\n<ul>\n<li>state，状态对象，状态对象 state 是一个 JS 对象，通过 pushSate()创建新的历史记录条目。无论什么时候用户导航到新的状态，popstate 时间就会被触发，且该时间的 state 属性包含该历史记录条目状态对象的副本。</li>\n<li>title，历史记录的标题</li>\n<li>url，创建的历史记录的链接。进行历史记录操作时会跳转到该链接。</li>\n</ul>\n<h2 id=\"popstate\"><a href=\"#popstate\" class=\"headerlink\" title=\"popstate\"></a>popstate</h2><p>popstate 事件，history 实体(hostory.state)改变时触发的事件。</p>\n<p>当活动的历史条目被更改时，将触发 popstate 事件。如果被激活的历史记录条目是通过对 history.pushState()的调用创建的，或者受到 history.replaceSate()的调用的影响，popstate 的 state 属性包含历史条目的状态的对象的副本——MDN</p>\n<p>popstate 每当活动历史记录在同一个文档的两个历史记录条目之间发生变化时，就会将事件分派到窗口。如果激活的历史记录条目是通过调用 history.pushState()创建的，或者受到 history.replaceState()调用的影响，则该 popstate 事件的 state 属性包含历史记录项的状态对象的副本。</p>\n<p>注意：用于处理 popstate 事件的浏览器在页面加载时的方式不同，但现在它们的行为相同。Firefox 从未在页面加载时发出 popstate 事件，Chrome 直到版本 34 才可以，而 Safari 一直到版本 10.0。</p>\n<h2 id=\"往返缓存\"><a href=\"#往返缓存\" class=\"headerlink\" title=\"往返缓存\"></a>往返缓存</h2><p>默认情况下，浏览器会在当前会话(session)缓存页面，当用户点击“前进”或“后退”按钮时，浏览器就会从缓存中加载页面（除去 meta 中加 no-cache 的情况）。</p>\n<p>浏览器有一个特性叫“往返缓存”(back-forward cache 或 bfcache)，可以在用户使用浏览器的“后退”和“前进”按钮时加快页面的转换速度。这个缓存中不仅保存着页面数据，还保存了 DOM 和 javascript 的状态；实际上是将整个页面都保存在了内存里。如果页面位于 bfcache 中，那么再次打开该页面时就不会触发 load 事件</p>\n<h2 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h2><ol>\n<li>每次返回都会消耗一个 history 实体，若用户选择取消离开，则需要继续 pushSate 一个实体</li>\n<li>pushState 只能一个实体，多个实体返回会报错。使用 window.history.state 查询是否存在添加的实体。</li>\n</ol>\n<p>例如，运行以下代码的<a href=\"http://example.com/example.html%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%B0%86%E6%8C%89%E7%85%A7%E6%8C%87%E7%A4%BA%E7%94%9F%E6%88%90%E8%AD%A6%E6%8A%A5%EF%BC%9A\">http://example.com/example.html中的页面将按照指示生成警报：</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onpopstate = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  alert(</span><br><span class=\"line\">    <span class=\"string\">&#x27;location: &#x27;</span> + <span class=\"built_in\">document</span>.location + <span class=\"string\">&#x27;, state: &#x27;</span> + <span class=\"built_in\">JSON</span>.stringify(event.state)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">history.pushState(&#123; <span class=\"attr\">page</span>: <span class=\"number\">1</span> &#125;, <span class=\"string\">&#x27;title 1&#x27;</span>, <span class=\"string\">&#x27;?page=1&#x27;</span>)</span><br><span class=\"line\">history.pushState(&#123; <span class=\"attr\">page</span>: <span class=\"number\">2</span> &#125;, <span class=\"string\">&#x27;title 2&#x27;</span>, <span class=\"string\">&#x27;?page=2&#x27;</span>)</span><br><span class=\"line\">history.replaceState(&#123; <span class=\"attr\">page</span>: <span class=\"number\">3</span> &#125;, <span class=\"string\">&#x27;title 3&#x27;</span>, <span class=\"string\">&#x27;?page=3&#x27;</span>)</span><br><span class=\"line\">history.back() <span class=\"comment\">// alerts &quot;location: http://example.com/example.html?page=1, state: &#123;&quot;page&quot;:1&#125;&quot;</span></span><br><span class=\"line\">history.back() <span class=\"comment\">// alerts &quot;location: http://example.com/example.html, state: null history.go(2);</span></span><br><span class=\"line\"><span class=\"comment\">// alerts &quot;location: http://example.com/example.html?page=3, state: &#123;&quot;page&quot;:3&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>请注意，即使原始历史记录项（for <a href=\"http://example.com/example.html%EF%BC%89%E6%B2%A1%E6%9C%89%E4%B8%8E%E5%85%B6%E5%85%B3%E8%81%94%E7%9A%84%E7%8A%B6%E6%80%81%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%BD%86%E5%BD%93%E6%88%91%E4%BB%AC%E5%9C%A8%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%B0%83%E7%94%A8history.back()%E5%90%8E%E6%BF%80%E6%B4%BB%E8%AF%A5%E7%8E%B0%E6%97%B6%EF%BC%8C%E4%BB%8D%E7%84%B6%E4%BC%9A%E8%A7%A6%E5%8F%91%E4%B8%80%E4%B8%AApopstate%E4%BA%8B%E4%BB%B6%E3%80%82\">http://example.com/example.html）没有与其关联的状态对象，但当我们在第二次调用history.back()后激活该现时，仍然会触发一个popstate事件。</a></p>\n<h2 id=\"填坑史\"><a href=\"#填坑史\" class=\"headerlink\" title=\"填坑史\"></a>填坑史</h2><p>这种东西一看就不靠谱，一用果然不靠谱，在移动端兼容好像还可以，目前没有发现在什么低端手机上完全不支持的。</p>\n<p>需求是根据不同的情况来跳转，但是若是由接口返回参数进行判断的话则有可能用户在接口还没有反应的时候就进行了跳转，因此是使用的判断 cookies 的方式执行的 js。</p>\n<p>业务场景：</p>\n<p>页面 A-&gt;B-&gt;C，C 返回至 B 时页面返回时需要返回到指定的其他页面，比如跳到百度。</p>\n<h3 id=\"IOS-端-popstate-的怪异行为\"><a href=\"#IOS-端-popstate-的怪异行为\" class=\"headerlink\" title=\"IOS 端 popstate 的怪异行为\"></a>IOS 端 popstate 的怪异行为</h3><p>由于 ios 的性能在缓存页面比较好，所以一般页面的后退都会保存之前的历史页面，不会触发页面上的 js 等，所以可以触发到 popstate 事件，而 webkit 的某些版本对 popstate 的理解与官方标准不一致，导致每次访问页面都会同步为访问了这个页面的历史纪录，所以 popstate 就被触发了。</p>\n<p>问题：在 ios 上，页面 C 返回时，立即执行了 popstate 事件，导致直接跳转到百度了。</p>\n<p>解决方法：通过 pageshow 事件处理</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> bool = <span class=\"literal\">false</span> <span class=\"comment\">//定义一个变量</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;pageshow&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  bool = <span class=\"literal\">false</span> <span class=\"comment\">//进入页面时bool置为false，防止ios立即执行popstate</span></span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//定时器延迟将bool置为true</span></span><br><span class=\"line\">    bool = <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;, <span class=\"number\">500</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">pushHistory()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(</span><br><span class=\"line\">  <span class=\"string\">&#x27;popstate&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bool) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.location.href = <span class=\"string\">&#x27;http://www.baidu.com&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"literal\">false</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushHistory</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> state = &#123; <span class=\"attr\">title</span>: <span class=\"string\">&#x27;title&#x27;</span>, <span class=\"attr\">url</span>: <span class=\"string\">&#x27;#&#x27;</span> &#125;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.history.pushState(state, <span class=\"string\">&#x27;title&#x27;</span>, <span class=\"string\">&#x27;#&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"刷新时反复-pushState\"><a href=\"#刷新时反复-pushState\" class=\"headerlink\" title=\"刷新时反复 pushState\"></a>刷新时反复 pushState</h3><p>因为刷新时重复 pushState，所以跳转到 baidu.com 时无法正常返回。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!history.state || history.state.url !== <span class=\"string\">&#x27;#&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//避免刷新是反复pushSate</span></span><br><span class=\"line\">  pushHistory()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!history.state || history.state.url !== <span class=\"string\">&#x27;#&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//避免刷新是反复pushSate</span></span><br><span class=\"line\">  pushHistory()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>感觉就是很不靠谱，所以使用的时候慎重加多测。</p>\n","site":{"data":{}},"excerpt":"<p>一直以为监听返回按键是 H5 做不到的事情，其实是可以做到的。所以记录一下，深究一下。<br>最近在工作中也接触到这个需求，需要在不同的情况下达到能正常返回或是跳转到其他页面(但是我想这个只能在多页应用实现，单页应用应该是不可以的，没有去尝试过)。</p>","more":"<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushHistory</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> state = &#123;</span><br><span class=\"line\">    title: <span class=\"string\">&#x27;title&#x27;</span>,</span><br><span class=\"line\">    url: <span class=\"string\">&#x27;#&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.history.pushState(state, <span class=\"string\">&#x27;title&#x27;</span>, <span class=\"string\">&#x27;#&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(</span><br><span class=\"line\">  <span class=\"string\">&#x27;popstate&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//监听到返回时间 执行自己的js</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"literal\">false</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>这样实现的代码在移动端可以监听浏览器返回按键、物理返回按键、虚拟返回按键、手势返回按键等。<br>history.state 中包含了 state 的 一份拷贝，可以使用 history.state 读取其中的内容。</p>\n<h2 id=\"history-pushState\"><a href=\"#history-pushState\" class=\"headerlink\" title=\"history.pushState\"></a>history.pushState</h2><p>在当前页面创建并激活新的历史记录。</p>\n<p>当调用 history.pushSate 或者是 history.replaceSate()不会触发 popstate 事件。只有做出后退的动作（执行 history.back()、history.go(-1)）时才会执行该事件。另外，该事件只针对同一个文档，如果浏览历史的切换，导致加载不同的文档，该事件也不会触发。</p>\n<p>在百度的控制台输入以下代码：</p>\n<p><code>window.history.pushState(null, null, &quot;https://www.baidu.com/?name=orange&quot;);</code><br>地址显示是<a href=\"https://www.baidu.com/name/orange%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%E7%9A%84url%E6%98%AF%E4%B8%8D%E6%94%AF%E6%8C%81%E8%B7%A8%E5%9F%9F%E7%9A%84%EF%BC%8C%E8%B7%A8%E5%9F%9F%E4%BC%9A%E6%8A%A5%E9%94%99\">https://www.baidu.com/name/orange，注意这里的url是不支持跨域的，跨域会报错</a>.</p>\n<p>history.pushState()只会改变当前地址的路径，并不会更新页面内容，只是产生了浏览器历史记录，此时点击返回按钮就返回到本页面，且也没有刷新，而且可以前进到<a href=\"https://www.baidu.com/?name=orange\">https://www.baidu.com/?name=orange</a> 页面</p>\n<p>当我们在历史记录中切换的时候就会触发 popstate 事件。</p>\n<p>pushSate 三个参数：</p>\n<ul>\n<li>state，状态对象，状态对象 state 是一个 JS 对象，通过 pushSate()创建新的历史记录条目。无论什么时候用户导航到新的状态，popstate 时间就会被触发，且该时间的 state 属性包含该历史记录条目状态对象的副本。</li>\n<li>title，历史记录的标题</li>\n<li>url，创建的历史记录的链接。进行历史记录操作时会跳转到该链接。</li>\n</ul>\n<h2 id=\"popstate\"><a href=\"#popstate\" class=\"headerlink\" title=\"popstate\"></a>popstate</h2><p>popstate 事件，history 实体(hostory.state)改变时触发的事件。</p>\n<p>当活动的历史条目被更改时，将触发 popstate 事件。如果被激活的历史记录条目是通过对 history.pushState()的调用创建的，或者受到 history.replaceSate()的调用的影响，popstate 的 state 属性包含历史条目的状态的对象的副本——MDN</p>\n<p>popstate 每当活动历史记录在同一个文档的两个历史记录条目之间发生变化时，就会将事件分派到窗口。如果激活的历史记录条目是通过调用 history.pushState()创建的，或者受到 history.replaceState()调用的影响，则该 popstate 事件的 state 属性包含历史记录项的状态对象的副本。</p>\n<p>注意：用于处理 popstate 事件的浏览器在页面加载时的方式不同，但现在它们的行为相同。Firefox 从未在页面加载时发出 popstate 事件，Chrome 直到版本 34 才可以，而 Safari 一直到版本 10.0。</p>\n<h2 id=\"往返缓存\"><a href=\"#往返缓存\" class=\"headerlink\" title=\"往返缓存\"></a>往返缓存</h2><p>默认情况下，浏览器会在当前会话(session)缓存页面，当用户点击“前进”或“后退”按钮时，浏览器就会从缓存中加载页面（除去 meta 中加 no-cache 的情况）。</p>\n<p>浏览器有一个特性叫“往返缓存”(back-forward cache 或 bfcache)，可以在用户使用浏览器的“后退”和“前进”按钮时加快页面的转换速度。这个缓存中不仅保存着页面数据，还保存了 DOM 和 javascript 的状态；实际上是将整个页面都保存在了内存里。如果页面位于 bfcache 中，那么再次打开该页面时就不会触发 load 事件</p>\n<h2 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h2><ol>\n<li>每次返回都会消耗一个 history 实体，若用户选择取消离开，则需要继续 pushSate 一个实体</li>\n<li>pushState 只能一个实体，多个实体返回会报错。使用 window.history.state 查询是否存在添加的实体。</li>\n</ol>\n<p>例如，运行以下代码的<a href=\"http://example.com/example.html%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%B0%86%E6%8C%89%E7%85%A7%E6%8C%87%E7%A4%BA%E7%94%9F%E6%88%90%E8%AD%A6%E6%8A%A5%EF%BC%9A\">http://example.com/example.html中的页面将按照指示生成警报：</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onpopstate = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  alert(</span><br><span class=\"line\">    <span class=\"string\">&#x27;location: &#x27;</span> + <span class=\"built_in\">document</span>.location + <span class=\"string\">&#x27;, state: &#x27;</span> + <span class=\"built_in\">JSON</span>.stringify(event.state)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">history.pushState(&#123; <span class=\"attr\">page</span>: <span class=\"number\">1</span> &#125;, <span class=\"string\">&#x27;title 1&#x27;</span>, <span class=\"string\">&#x27;?page=1&#x27;</span>)</span><br><span class=\"line\">history.pushState(&#123; <span class=\"attr\">page</span>: <span class=\"number\">2</span> &#125;, <span class=\"string\">&#x27;title 2&#x27;</span>, <span class=\"string\">&#x27;?page=2&#x27;</span>)</span><br><span class=\"line\">history.replaceState(&#123; <span class=\"attr\">page</span>: <span class=\"number\">3</span> &#125;, <span class=\"string\">&#x27;title 3&#x27;</span>, <span class=\"string\">&#x27;?page=3&#x27;</span>)</span><br><span class=\"line\">history.back() <span class=\"comment\">// alerts &quot;location: http://example.com/example.html?page=1, state: &#123;&quot;page&quot;:1&#125;&quot;</span></span><br><span class=\"line\">history.back() <span class=\"comment\">// alerts &quot;location: http://example.com/example.html, state: null history.go(2);</span></span><br><span class=\"line\"><span class=\"comment\">// alerts &quot;location: http://example.com/example.html?page=3, state: &#123;&quot;page&quot;:3&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>请注意，即使原始历史记录项（for <a href=\"http://example.com/example.html%EF%BC%89%E6%B2%A1%E6%9C%89%E4%B8%8E%E5%85%B6%E5%85%B3%E8%81%94%E7%9A%84%E7%8A%B6%E6%80%81%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%BD%86%E5%BD%93%E6%88%91%E4%BB%AC%E5%9C%A8%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%B0%83%E7%94%A8history.back()%E5%90%8E%E6%BF%80%E6%B4%BB%E8%AF%A5%E7%8E%B0%E6%97%B6%EF%BC%8C%E4%BB%8D%E7%84%B6%E4%BC%9A%E8%A7%A6%E5%8F%91%E4%B8%80%E4%B8%AApopstate%E4%BA%8B%E4%BB%B6%E3%80%82\">http://example.com/example.html）没有与其关联的状态对象，但当我们在第二次调用history.back()后激活该现时，仍然会触发一个popstate事件。</a></p>\n<h2 id=\"填坑史\"><a href=\"#填坑史\" class=\"headerlink\" title=\"填坑史\"></a>填坑史</h2><p>这种东西一看就不靠谱，一用果然不靠谱，在移动端兼容好像还可以，目前没有发现在什么低端手机上完全不支持的。</p>\n<p>需求是根据不同的情况来跳转，但是若是由接口返回参数进行判断的话则有可能用户在接口还没有反应的时候就进行了跳转，因此是使用的判断 cookies 的方式执行的 js。</p>\n<p>业务场景：</p>\n<p>页面 A-&gt;B-&gt;C，C 返回至 B 时页面返回时需要返回到指定的其他页面，比如跳到百度。</p>\n<h3 id=\"IOS-端-popstate-的怪异行为\"><a href=\"#IOS-端-popstate-的怪异行为\" class=\"headerlink\" title=\"IOS 端 popstate 的怪异行为\"></a>IOS 端 popstate 的怪异行为</h3><p>由于 ios 的性能在缓存页面比较好，所以一般页面的后退都会保存之前的历史页面，不会触发页面上的 js 等，所以可以触发到 popstate 事件，而 webkit 的某些版本对 popstate 的理解与官方标准不一致，导致每次访问页面都会同步为访问了这个页面的历史纪录，所以 popstate 就被触发了。</p>\n<p>问题：在 ios 上，页面 C 返回时，立即执行了 popstate 事件，导致直接跳转到百度了。</p>\n<p>解决方法：通过 pageshow 事件处理</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> bool = <span class=\"literal\">false</span> <span class=\"comment\">//定义一个变量</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;pageshow&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  bool = <span class=\"literal\">false</span> <span class=\"comment\">//进入页面时bool置为false，防止ios立即执行popstate</span></span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//定时器延迟将bool置为true</span></span><br><span class=\"line\">    bool = <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;, <span class=\"number\">500</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">pushHistory()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(</span><br><span class=\"line\">  <span class=\"string\">&#x27;popstate&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (bool) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">window</span>.location.href = <span class=\"string\">&#x27;http://www.baidu.com&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"literal\">false</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushHistory</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> state = &#123; <span class=\"attr\">title</span>: <span class=\"string\">&#x27;title&#x27;</span>, <span class=\"attr\">url</span>: <span class=\"string\">&#x27;#&#x27;</span> &#125;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.history.pushState(state, <span class=\"string\">&#x27;title&#x27;</span>, <span class=\"string\">&#x27;#&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"刷新时反复-pushState\"><a href=\"#刷新时反复-pushState\" class=\"headerlink\" title=\"刷新时反复 pushState\"></a>刷新时反复 pushState</h3><p>因为刷新时重复 pushState，所以跳转到 baidu.com 时无法正常返回。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!history.state || history.state.url !== <span class=\"string\">&#x27;#&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//避免刷新是反复pushSate</span></span><br><span class=\"line\">  pushHistory()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!history.state || history.state.url !== <span class=\"string\">&#x27;#&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//避免刷新是反复pushSate</span></span><br><span class=\"line\">  pushHistory()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>感觉就是很不靠谱，所以使用的时候慎重加多测。</p>"},{"title":"跨域-解决方案","date":"2018-04-19T01:55:30.000Z","_content":"\n具体概念如下：只要协议、域名、端口有任何一个不同，都被当作是不同的域。\n\n**凡是拥有 “src” 这个属性的标签都有跨域的能力**\n\n<!--more-->\n\n## 跨域\n\n浏览器请求（js,css,图片,form 表单提交）和 Ajax 请求都携带 Cookie 信息。但浏览器规定，静态资源请求和提交表单不受同源政策的限制，Ajax 请求受同源策略限制。\n\n**如果是协议和端口造成的跨域问题。则前台无法解决。** 同源策略具体分为以下几类：\n\n- 不同域名\n- 相同域名不同端口号，如`https://www.oschina.net:8000`和`https://www.oschina.net:8001`\n- 同一个域名不同协议，如`http://www.oschina.net/`和`https://www.oschina.net/`\n- 域名和域名对应的的 IP，如`http://b.qq.com/`和 `http://10.198.7.85`\n- 主域和子域，如`http://www.oschina.net/`和`https://test.oschina.net`\n- 子域和子域，如`https://test1.oschina.net`和`https://test2.oschina.net` 以上情况只要出现了，那么就会产生跨域问题。那么如果解决跨域问题呢，下面的小节会总结一些解决跨域常用的方法。\n\n## JSONP 带 callback 的 json\n\nJSONP:只支持 GET,不支持 POST 请求代理\n\n原理：浏览器只对 XHR(XMLHttpRequest) 请求有同源限制，二队 script 标签的 src 属性、link 的 ref 和 img 的 src 属性没有这种限制，利用这个就可以解决跨域请求问题\n\n有个通俗易懂的解释 -JSONP（JSON with Padding ）是数据格式 JSON 的一种 “ 使用模式 ”，可以让网页从别的网域要数据。利用`<script>`标签没有跨域限制，来达到与第 3 方通讯的目的。\n\n** jsonp 的客户端具体实现：**\n\n1. 远程服务器 remoteserver.com 根目录下有个 remote.js 文件代码如下：\n\n```javascript\nalert('我是远程文件')\n```\n\n2. 本地服务器 localserver.com 下有个 jsonp.html 页面代码如下：\n\n```javascript\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <title></title>\n    <script type=\"text/javascript\" src=\"http://remoteserver.com/remote.js\"></script>\n</head>\n<body>\n\n</body>\n</html>\n```\n\n页面将会弹出一个提示窗体，显示跨域调用成功。\n\n3. 现在我们在 jsonp.html 页面定义一个函数，然后在远程 remote.js 中传入数据进行调用。\n\njsonp.html 页面代码如下：\n\n```javascript\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <title></title>\n    <script type=\"text/javascript\">\n    var localHandler = function(data){\n        alert('我是本地函数，可以被跨域的remote.js文件调用，远程js带来的数据是：' + data.result);\n    };\n    </script>\n    <script type=\"text/javascript\" src=\"http://remoteserver.com/remote.js\"></script>\n</head>\n<body>\n\n</body>\n</html>\n```\n\n4. remote.js 文件代码如下：\n\n```javascript\nlocalHandler({ result: '我是远程js带来的数据' })\n```\n\n**要注意的是他支持 GET 这一种 HTTP 请求类型**\n\n## 跨域资源共享（CORS-Cross Origin Resource Sharing ）\n\n跨域资源共享（ CORS ）机制允许 Web 应用服务器进行跨域访问控制，从而使跨域数据传输得以安全进行。\n\nCORS 除了 GET 要求方法以外也支持其他的 HTTP 要求。浏览器 CORS 请求分成两种：\n\n1. 简单请求\n2. 协商模型 / 预检请求（Preflighted Request ），即非简单请求如何区分请求具体属于哪一种呢，下面我总结了几点：\n   1. 请求方式：\n   - GET\n   - HEAD\n   - POST\n   2. HTTP 的头信息子段\n   - Accept\n   - Accept-Language\n   - Content-Language\n   - Last-Event-ID\n   - Content-Type：只限于三个值 application/x-www-form-urlencoded、multipart/form-data 、 text/plain，其中 'text/plain' 默认支持，其他两种则需要预检请求和服务器协商。\n\n满足以上两大点的即为简单请求，否则为非简单请求。\n\n假如站点 `http://foo.example` 的网页应用想要访问 `http://bar.other` 的资源。`http://foo.example` 的网页中可能包含类似于下面的 JavaScript 代码：\n\n```javascript\nvar invocation = new XMLHttpRequest()\nvar url = 'http://bar.other/resources/public-data/'\n\nfunction callOtherDomain() {\n  if (invocation) {\n    invocation.open('GET', url, true)\n    invocation.onreadystatechange = handler\n    invocation.send()\n  }\n}\n```\n\n## document.domain+iframe （适用于主域名相同的情况）\n\n比如，有一个页面，它的地址是http://www.damonare.cn/a.html ， 在这个页面里面有一个 iframe，它的 src 是http://damonare.cn/b.html, 很显然，这个页面与它里面的 iframe 框架是不同域的，所以我们是无法通过在页面中书写 js 代码来获取 iframe 中的东西的：\n\n```javascript\n<script type=\"text/javascript\">\n    function test(){\n        var iframe = document.getElementById('￼ifame');\n        var win = iframe.contentWindow;//可以获取到iframe里的window对象，但该window对象的属性和方法几乎是不可用的\n        var doc = win.document;//这里获取不到iframe里的document对象\n        var name = win.name;//这里同样获取不到window对象的name属性\n    }\n</script>\n<iframe id = \"iframe\" src=\"http://damonare.cn/b.html\" onload = \"test()\"><\\/iframe>\n```\n\n这时只要把`http://www.damonare.cn/a.html`和`http://damonare.cn/b.html`这两个页面的 document.domain 都设成相同的域名就可以了。但要注意的是，document.domain 的设置是有限制的，我们只能把 document.domain 设置成自身或更高一级的父域，且主域必须相同。\n\n- 在页面`http://www.damonare.cn/a.html` 中设置 document.domain:\n\n```javascript\n<iframe id = \"iframe\" src=\"http://damonare.cn/b.html\" onload = \"test()\"></iframe>\n<script type=\"text/javascript\">\n    document.domain = 'damonare.cn';//设置成主域\n    function test(){\n        alert(document.getElementById('￼iframe').contentWindow);//contentWindow 可取得子窗口的 window 对象\n    }\n</script>\n```\n\n- 在页面`http://damonare.cn/b.html` 中也设置 document.domain:\n\n```html\n<script type=\"text/javascript\">\n  document.domain = 'damonare.cn' //在iframe载入这个页面也设置document.domain，使之与主页面的document.domain相同\n</script>\n```\n\n修改 document.domain 的方法只适用于不同子域的框架间的交互。\n\n## 通过 location.hash 跨域\n\n此方法的原理就是改变 URL 的 hash 部分来进行双向通信。每个 window 通过改变其他 window 的 location 来发送消息（由于两个页面不在同一个域下 IE、Chrome 不允许修改 parent.location.hash 的值，所以要借助于父窗口域名下的一个代理 iframe），并通过监听自己的 URL 的变化来接收消息。这个方式的通信会造成一些不必要的浏览器历史记录，而且有些浏览器不支持 onhashchange 事件，需要轮询来获知 URL 的改变，最后，这样做也存在缺点，诸如数据直接暴露在了 url 中，数据容量和类型都有限等。\n\n## 通过 HTML5 的 postMessage 方法跨域\n\n这个功能主要包括接受信息的 ”message” 事件和发送消息的 ”postMessage” 方法。比如`http://damonare.cn`域的 A 页面通过 iframe 嵌入了一个`http://google.com`域的 B 页面，可以通过以下方法实现 A 和 B 的通信\n\nA 页面通过 postMessage 方法发送消息：\n\n```javascript\nwindow.onload = function () {\n  var ifr = document.getElementById('ifr')\n  var targetOrigin = 'http://www.google.com'\n  ifr.contentWindow.postMessage('hello world!', targetOrigin)\n}\n```\n\n**postMessage 的使用方法**\n\notherWindow.postMessage(message, targetOrigin);\n\n- otherWindow: 指目标窗口，也就是给哪个 window 发消息，是 window.frames 属性的成员或者由 window.open 方法创建的窗口\n- message: 是要发送的消息，类型为 String、Object (IE8 、 9 不支持 )\n- targetOrigin: 是限定消息接收范围，不限制请使用 ‘\\*\n\nB 页面通过 message 事件监听并接受消息 :\n\n```javascript\nvar onmessage = function (event) {\n  var data = event.data //消息\n  var origin = event.origin //消息来源地址\n  var source = event.source //源Window对象\n  if (origin == 'http://www.baidu.com') {\n    console.log(data) //hello world!\n  }\n}\nif (typeof window.addEventListener != 'undefined') {\n  window.addEventListener('message', onmessage, false)\n} else if (typeof window.attachEvent != 'undefined') {\n  //for ie\n  window.attachEvent('onmessage', onmessage)\n}\n```\n\n## 通过 window.name 跨域\n\n在一个窗口生命周期内，窗口载入的所有的页面都是共享一个 window.name 的，每一个页面对 window.name 都有读写的权限，window.name 是持久的存在于一个窗口载入的所有页面，并不会因为新的页面的载入而被重置。\n\n下面为 a.html 中代码\n\n```javascript\nwindow.name = '我是页面a中设置的值'\nsetInterval(function () {\n  window.location = 'b.html'\n}, 2000) //两秒后把一个新页面b.html载入到当前的window中\n```\n\nb.html 中的代码\n\n```javascript\n<script>console.log(window.name);//读取window.name的值</script>\n```\n\n## 服务器端设置 http header\n\n这是需要在服务器端设置的，作为前端工程师我们不用详细掌握，但是要知道有这么个解决方案。而且，现在推崇的跨域解决方案是这一种，比 JSONP 简单许多。\n\n```javascript\nresponse.setHeader('Access-Control-Allow-Origin', 'http://m.juejin.com/') // 第二个参数填写允许跨域的域名称，不建议直接写 \"*\"\nresponse.setHeader('Access-Control-Allow-Headers', 'X-Requested-With')\nresponse.setHeader(\n  'Access-Control-Allow-Methods',\n  'PUT,POST,GET,DELETE,OPTIONS'\n)\n\n// 接收跨域的cookie\nresponse.setHeader('Access-Control-Allow-Credentials', 'true')\n```\n\n## XMLHttpRequest Level 2 使用指南\n\nXMLHttpRequest 是一个浏览器接口，是的 Javascript 可以进行 HTTP(S)通信。\n\n### 老版本的 XMLHttpRequest 对象\n\n```javascript\n//首先 ，新建一个XMLHttpRequest 的实例。\nvar xhr = new XMLHttpRequest()\n\n//然后向主机发送一个HTTP请求。\nxhr.open('GET', 'example.php')\nxhr.send()\n\n//接着，就等待远程主机做出回应。这时需要监控XMLHttpRequest对象的状态变化，指定回调函数。\n\nxhr.onreadystatechange = function () {\n  if (xhr.readyState == 4 && xhr.status == 200) {\n    alert(xhr.responseText)\n  } else {\n    alert(xhr.statusText)\n  }\n}\n```\n\n### 老版本的 XMLHttpRequest 的缺点\n\n- 只支持文本数据的传送，无法用来读取和上传二进制文件。\n- 传送和接收数据时，没有进度信息，只能提示有没有完成。\n- 受到\"同源限制\"，只能向同一域名的服务器请求数据。\n\n### 新版本的功能\n\n- 可以设置 HTTP 请求发的时限。\n- 可以使用 FormData 对象管理表单数据。\n- 可以上传文件。\n- 可以请求不同域名下的数据。（跨域请求）\n- 可以获取服务器端的二进制数据。\n- 可以获的数据传输的进度信息。\n","source":"_posts/跨域-解决方案.md","raw":"---\ntitle: 跨域-解决方案\ndate: 2018-04-19 09:55:30\ncategories: Web\n---\n\n具体概念如下：只要协议、域名、端口有任何一个不同，都被当作是不同的域。\n\n**凡是拥有 “src” 这个属性的标签都有跨域的能力**\n\n<!--more-->\n\n## 跨域\n\n浏览器请求（js,css,图片,form 表单提交）和 Ajax 请求都携带 Cookie 信息。但浏览器规定，静态资源请求和提交表单不受同源政策的限制，Ajax 请求受同源策略限制。\n\n**如果是协议和端口造成的跨域问题。则前台无法解决。** 同源策略具体分为以下几类：\n\n- 不同域名\n- 相同域名不同端口号，如`https://www.oschina.net:8000`和`https://www.oschina.net:8001`\n- 同一个域名不同协议，如`http://www.oschina.net/`和`https://www.oschina.net/`\n- 域名和域名对应的的 IP，如`http://b.qq.com/`和 `http://10.198.7.85`\n- 主域和子域，如`http://www.oschina.net/`和`https://test.oschina.net`\n- 子域和子域，如`https://test1.oschina.net`和`https://test2.oschina.net` 以上情况只要出现了，那么就会产生跨域问题。那么如果解决跨域问题呢，下面的小节会总结一些解决跨域常用的方法。\n\n## JSONP 带 callback 的 json\n\nJSONP:只支持 GET,不支持 POST 请求代理\n\n原理：浏览器只对 XHR(XMLHttpRequest) 请求有同源限制，二队 script 标签的 src 属性、link 的 ref 和 img 的 src 属性没有这种限制，利用这个就可以解决跨域请求问题\n\n有个通俗易懂的解释 -JSONP（JSON with Padding ）是数据格式 JSON 的一种 “ 使用模式 ”，可以让网页从别的网域要数据。利用`<script>`标签没有跨域限制，来达到与第 3 方通讯的目的。\n\n** jsonp 的客户端具体实现：**\n\n1. 远程服务器 remoteserver.com 根目录下有个 remote.js 文件代码如下：\n\n```javascript\nalert('我是远程文件')\n```\n\n2. 本地服务器 localserver.com 下有个 jsonp.html 页面代码如下：\n\n```javascript\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <title></title>\n    <script type=\"text/javascript\" src=\"http://remoteserver.com/remote.js\"></script>\n</head>\n<body>\n\n</body>\n</html>\n```\n\n页面将会弹出一个提示窗体，显示跨域调用成功。\n\n3. 现在我们在 jsonp.html 页面定义一个函数，然后在远程 remote.js 中传入数据进行调用。\n\njsonp.html 页面代码如下：\n\n```javascript\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <title></title>\n    <script type=\"text/javascript\">\n    var localHandler = function(data){\n        alert('我是本地函数，可以被跨域的remote.js文件调用，远程js带来的数据是：' + data.result);\n    };\n    </script>\n    <script type=\"text/javascript\" src=\"http://remoteserver.com/remote.js\"></script>\n</head>\n<body>\n\n</body>\n</html>\n```\n\n4. remote.js 文件代码如下：\n\n```javascript\nlocalHandler({ result: '我是远程js带来的数据' })\n```\n\n**要注意的是他支持 GET 这一种 HTTP 请求类型**\n\n## 跨域资源共享（CORS-Cross Origin Resource Sharing ）\n\n跨域资源共享（ CORS ）机制允许 Web 应用服务器进行跨域访问控制，从而使跨域数据传输得以安全进行。\n\nCORS 除了 GET 要求方法以外也支持其他的 HTTP 要求。浏览器 CORS 请求分成两种：\n\n1. 简单请求\n2. 协商模型 / 预检请求（Preflighted Request ），即非简单请求如何区分请求具体属于哪一种呢，下面我总结了几点：\n   1. 请求方式：\n   - GET\n   - HEAD\n   - POST\n   2. HTTP 的头信息子段\n   - Accept\n   - Accept-Language\n   - Content-Language\n   - Last-Event-ID\n   - Content-Type：只限于三个值 application/x-www-form-urlencoded、multipart/form-data 、 text/plain，其中 'text/plain' 默认支持，其他两种则需要预检请求和服务器协商。\n\n满足以上两大点的即为简单请求，否则为非简单请求。\n\n假如站点 `http://foo.example` 的网页应用想要访问 `http://bar.other` 的资源。`http://foo.example` 的网页中可能包含类似于下面的 JavaScript 代码：\n\n```javascript\nvar invocation = new XMLHttpRequest()\nvar url = 'http://bar.other/resources/public-data/'\n\nfunction callOtherDomain() {\n  if (invocation) {\n    invocation.open('GET', url, true)\n    invocation.onreadystatechange = handler\n    invocation.send()\n  }\n}\n```\n\n## document.domain+iframe （适用于主域名相同的情况）\n\n比如，有一个页面，它的地址是http://www.damonare.cn/a.html ， 在这个页面里面有一个 iframe，它的 src 是http://damonare.cn/b.html, 很显然，这个页面与它里面的 iframe 框架是不同域的，所以我们是无法通过在页面中书写 js 代码来获取 iframe 中的东西的：\n\n```javascript\n<script type=\"text/javascript\">\n    function test(){\n        var iframe = document.getElementById('￼ifame');\n        var win = iframe.contentWindow;//可以获取到iframe里的window对象，但该window对象的属性和方法几乎是不可用的\n        var doc = win.document;//这里获取不到iframe里的document对象\n        var name = win.name;//这里同样获取不到window对象的name属性\n    }\n</script>\n<iframe id = \"iframe\" src=\"http://damonare.cn/b.html\" onload = \"test()\"><\\/iframe>\n```\n\n这时只要把`http://www.damonare.cn/a.html`和`http://damonare.cn/b.html`这两个页面的 document.domain 都设成相同的域名就可以了。但要注意的是，document.domain 的设置是有限制的，我们只能把 document.domain 设置成自身或更高一级的父域，且主域必须相同。\n\n- 在页面`http://www.damonare.cn/a.html` 中设置 document.domain:\n\n```javascript\n<iframe id = \"iframe\" src=\"http://damonare.cn/b.html\" onload = \"test()\"></iframe>\n<script type=\"text/javascript\">\n    document.domain = 'damonare.cn';//设置成主域\n    function test(){\n        alert(document.getElementById('￼iframe').contentWindow);//contentWindow 可取得子窗口的 window 对象\n    }\n</script>\n```\n\n- 在页面`http://damonare.cn/b.html` 中也设置 document.domain:\n\n```html\n<script type=\"text/javascript\">\n  document.domain = 'damonare.cn' //在iframe载入这个页面也设置document.domain，使之与主页面的document.domain相同\n</script>\n```\n\n修改 document.domain 的方法只适用于不同子域的框架间的交互。\n\n## 通过 location.hash 跨域\n\n此方法的原理就是改变 URL 的 hash 部分来进行双向通信。每个 window 通过改变其他 window 的 location 来发送消息（由于两个页面不在同一个域下 IE、Chrome 不允许修改 parent.location.hash 的值，所以要借助于父窗口域名下的一个代理 iframe），并通过监听自己的 URL 的变化来接收消息。这个方式的通信会造成一些不必要的浏览器历史记录，而且有些浏览器不支持 onhashchange 事件，需要轮询来获知 URL 的改变，最后，这样做也存在缺点，诸如数据直接暴露在了 url 中，数据容量和类型都有限等。\n\n## 通过 HTML5 的 postMessage 方法跨域\n\n这个功能主要包括接受信息的 ”message” 事件和发送消息的 ”postMessage” 方法。比如`http://damonare.cn`域的 A 页面通过 iframe 嵌入了一个`http://google.com`域的 B 页面，可以通过以下方法实现 A 和 B 的通信\n\nA 页面通过 postMessage 方法发送消息：\n\n```javascript\nwindow.onload = function () {\n  var ifr = document.getElementById('ifr')\n  var targetOrigin = 'http://www.google.com'\n  ifr.contentWindow.postMessage('hello world!', targetOrigin)\n}\n```\n\n**postMessage 的使用方法**\n\notherWindow.postMessage(message, targetOrigin);\n\n- otherWindow: 指目标窗口，也就是给哪个 window 发消息，是 window.frames 属性的成员或者由 window.open 方法创建的窗口\n- message: 是要发送的消息，类型为 String、Object (IE8 、 9 不支持 )\n- targetOrigin: 是限定消息接收范围，不限制请使用 ‘\\*\n\nB 页面通过 message 事件监听并接受消息 :\n\n```javascript\nvar onmessage = function (event) {\n  var data = event.data //消息\n  var origin = event.origin //消息来源地址\n  var source = event.source //源Window对象\n  if (origin == 'http://www.baidu.com') {\n    console.log(data) //hello world!\n  }\n}\nif (typeof window.addEventListener != 'undefined') {\n  window.addEventListener('message', onmessage, false)\n} else if (typeof window.attachEvent != 'undefined') {\n  //for ie\n  window.attachEvent('onmessage', onmessage)\n}\n```\n\n## 通过 window.name 跨域\n\n在一个窗口生命周期内，窗口载入的所有的页面都是共享一个 window.name 的，每一个页面对 window.name 都有读写的权限，window.name 是持久的存在于一个窗口载入的所有页面，并不会因为新的页面的载入而被重置。\n\n下面为 a.html 中代码\n\n```javascript\nwindow.name = '我是页面a中设置的值'\nsetInterval(function () {\n  window.location = 'b.html'\n}, 2000) //两秒后把一个新页面b.html载入到当前的window中\n```\n\nb.html 中的代码\n\n```javascript\n<script>console.log(window.name);//读取window.name的值</script>\n```\n\n## 服务器端设置 http header\n\n这是需要在服务器端设置的，作为前端工程师我们不用详细掌握，但是要知道有这么个解决方案。而且，现在推崇的跨域解决方案是这一种，比 JSONP 简单许多。\n\n```javascript\nresponse.setHeader('Access-Control-Allow-Origin', 'http://m.juejin.com/') // 第二个参数填写允许跨域的域名称，不建议直接写 \"*\"\nresponse.setHeader('Access-Control-Allow-Headers', 'X-Requested-With')\nresponse.setHeader(\n  'Access-Control-Allow-Methods',\n  'PUT,POST,GET,DELETE,OPTIONS'\n)\n\n// 接收跨域的cookie\nresponse.setHeader('Access-Control-Allow-Credentials', 'true')\n```\n\n## XMLHttpRequest Level 2 使用指南\n\nXMLHttpRequest 是一个浏览器接口，是的 Javascript 可以进行 HTTP(S)通信。\n\n### 老版本的 XMLHttpRequest 对象\n\n```javascript\n//首先 ，新建一个XMLHttpRequest 的实例。\nvar xhr = new XMLHttpRequest()\n\n//然后向主机发送一个HTTP请求。\nxhr.open('GET', 'example.php')\nxhr.send()\n\n//接着，就等待远程主机做出回应。这时需要监控XMLHttpRequest对象的状态变化，指定回调函数。\n\nxhr.onreadystatechange = function () {\n  if (xhr.readyState == 4 && xhr.status == 200) {\n    alert(xhr.responseText)\n  } else {\n    alert(xhr.statusText)\n  }\n}\n```\n\n### 老版本的 XMLHttpRequest 的缺点\n\n- 只支持文本数据的传送，无法用来读取和上传二进制文件。\n- 传送和接收数据时，没有进度信息，只能提示有没有完成。\n- 受到\"同源限制\"，只能向同一域名的服务器请求数据。\n\n### 新版本的功能\n\n- 可以设置 HTTP 请求发的时限。\n- 可以使用 FormData 对象管理表单数据。\n- 可以上传文件。\n- 可以请求不同域名下的数据。（跨域请求）\n- 可以获取服务器端的二进制数据。\n- 可以获的数据传输的进度信息。\n","slug":"跨域-解决方案","published":1,"updated":"2021-05-26T14:36:16.233Z","_id":"ckon1h1xj0032l5v04hg8ase5","comments":1,"layout":"post","photos":[],"link":"","content":"<p>具体概念如下：只要协议、域名、端口有任何一个不同，都被当作是不同的域。</p>\n<p><strong>凡是拥有 “src” 这个属性的标签都有跨域的能力</strong></p>\n<span id=\"more\"></span>\n\n<h2 id=\"跨域\"><a href=\"#跨域\" class=\"headerlink\" title=\"跨域\"></a>跨域</h2><p>浏览器请求（js,css,图片,form 表单提交）和 Ajax 请求都携带 Cookie 信息。但浏览器规定，静态资源请求和提交表单不受同源政策的限制，Ajax 请求受同源策略限制。</p>\n<p><strong>如果是协议和端口造成的跨域问题。则前台无法解决。</strong> 同源策略具体分为以下几类：</p>\n<ul>\n<li>不同域名</li>\n<li>相同域名不同端口号，如<code>https://www.oschina.net:8000</code>和<code>https://www.oschina.net:8001</code></li>\n<li>同一个域名不同协议，如<code>http://www.oschina.net/</code>和<code>https://www.oschina.net/</code></li>\n<li>域名和域名对应的的 IP，如<code>http://b.qq.com/</code>和 <code>http://10.198.7.85</code></li>\n<li>主域和子域，如<code>http://www.oschina.net/</code>和<code>https://test.oschina.net</code></li>\n<li>子域和子域，如<code>https://test1.oschina.net</code>和<code>https://test2.oschina.net</code> 以上情况只要出现了，那么就会产生跨域问题。那么如果解决跨域问题呢，下面的小节会总结一些解决跨域常用的方法。</li>\n</ul>\n<h2 id=\"JSONP-带-callback-的-json\"><a href=\"#JSONP-带-callback-的-json\" class=\"headerlink\" title=\"JSONP 带 callback 的 json\"></a>JSONP 带 callback 的 json</h2><p>JSONP:只支持 GET,不支持 POST 请求代理</p>\n<p>原理：浏览器只对 XHR(XMLHttpRequest) 请求有同源限制，二队 script 标签的 src 属性、link 的 ref 和 img 的 src 属性没有这种限制，利用这个就可以解决跨域请求问题</p>\n<p>有个通俗易懂的解释 -JSONP（JSON with Padding ）是数据格式 JSON 的一种 “ 使用模式 ”，可以让网页从别的网域要数据。利用<code>&lt;script&gt;</code>标签没有跨域限制，来达到与第 3 方通讯的目的。</p>\n<p>** jsonp 的客户端具体实现：**</p>\n<ol>\n<li>远程服务器 remoteserver.com 根目录下有个 remote.js 文件代码如下：</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alert(<span class=\"string\">&#x27;我是远程文件&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>本地服务器 localserver.com 下有个 jsonp.html 页面代码如下：</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html PUBLIC <span class=\"string\">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class=\"string\">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span><br><span class=\"line\">&lt;html xmlns=<span class=\"string\">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">    &lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> src=<span class=\"string\">&quot;http://remoteserver.com/remote.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>页面将会弹出一个提示窗体，显示跨域调用成功。</p>\n<ol start=\"3\">\n<li>现在我们在 jsonp.html 页面定义一个函数，然后在远程 remote.js 中传入数据进行调用。</li>\n</ol>\n<p>jsonp.html 页面代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html PUBLIC <span class=\"string\">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class=\"string\">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span><br><span class=\"line\">&lt;html xmlns=<span class=\"string\">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">    &lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> localHandler = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">        alert(<span class=\"string\">&#x27;我是本地函数，可以被跨域的remote.js文件调用，远程js带来的数据是：&#x27;</span> + data.result);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">    &lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> src=<span class=\"string\">&quot;http://remoteserver.com/remote.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>remote.js 文件代码如下：</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">localHandler(&#123; <span class=\"attr\">result</span>: <span class=\"string\">&#x27;我是远程js带来的数据&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>要注意的是他支持 GET 这一种 HTTP 请求类型</strong></p>\n<h2 id=\"跨域资源共享（CORS-Cross-Origin-Resource-Sharing-）\"><a href=\"#跨域资源共享（CORS-Cross-Origin-Resource-Sharing-）\" class=\"headerlink\" title=\"跨域资源共享（CORS-Cross Origin Resource Sharing ）\"></a>跨域资源共享（CORS-Cross Origin Resource Sharing ）</h2><p>跨域资源共享（ CORS ）机制允许 Web 应用服务器进行跨域访问控制，从而使跨域数据传输得以安全进行。</p>\n<p>CORS 除了 GET 要求方法以外也支持其他的 HTTP 要求。浏览器 CORS 请求分成两种：</p>\n<ol>\n<li>简单请求</li>\n<li>协商模型 / 预检请求（Preflighted Request ），即非简单请求如何区分请求具体属于哪一种呢，下面我总结了几点：<ol>\n<li>请求方式：</li>\n</ol>\n<ul>\n<li>GET</li>\n<li>HEAD</li>\n<li>POST</li>\n</ul>\n<ol start=\"2\">\n<li>HTTP 的头信息子段</li>\n</ol>\n<ul>\n<li>Accept</li>\n<li>Accept-Language</li>\n<li>Content-Language</li>\n<li>Last-Event-ID</li>\n<li>Content-Type：只限于三个值 application/x-www-form-urlencoded、multipart/form-data 、 text/plain，其中 ‘text/plain’ 默认支持，其他两种则需要预检请求和服务器协商。</li>\n</ul>\n</li>\n</ol>\n<p>满足以上两大点的即为简单请求，否则为非简单请求。</p>\n<p>假如站点 <code>http://foo.example</code> 的网页应用想要访问 <code>http://bar.other</code> 的资源。<code>http://foo.example</code> 的网页中可能包含类似于下面的 JavaScript 代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> invocation = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"string\">&#x27;http://bar.other/resources/public-data/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">callOtherDomain</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (invocation) &#123;</span><br><span class=\"line\">    invocation.open(<span class=\"string\">&#x27;GET&#x27;</span>, url, <span class=\"literal\">true</span>)</span><br><span class=\"line\">    invocation.onreadystatechange = handler</span><br><span class=\"line\">    invocation.send()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"document-domain-iframe-（适用于主域名相同的情况）\"><a href=\"#document-domain-iframe-（适用于主域名相同的情况）\" class=\"headerlink\" title=\"document.domain+iframe （适用于主域名相同的情况）\"></a>document.domain+iframe （适用于主域名相同的情况）</h2><p>比如，有一个页面，它的地址是<a href=\"http://www.damonare.cn/a.html\">http://www.damonare.cn/a.html</a> ， 在这个页面里面有一个 iframe，它的 src 是<a href=\"http://damonare.cn/b.html\">http://damonare.cn/b.html</a>, 很显然，这个页面与它里面的 iframe 框架是不同域的，所以我们是无法通过在页面中书写 js 代码来获取 iframe 中的东西的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> iframe = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;￼ifame&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> win = iframe.contentWindow;<span class=\"comment\">//可以获取到iframe里的window对象，但该window对象的属性和方法几乎是不可用的</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> doc = win.document;<span class=\"comment\">//这里获取不到iframe里的document对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> name = win.name;<span class=\"comment\">//这里同样获取不到window对象的name属性</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;iframe id = <span class=\"string\">&quot;iframe&quot;</span> src=<span class=\"string\">&quot;http://damonare.cn/b.html&quot;</span> onload = <span class=\"string\">&quot;test()&quot;</span>&gt;<span class=\"xml\">&lt;\\/iframe&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这时只要把<code>http://www.damonare.cn/a.html</code>和<code>http://damonare.cn/b.html</code>这两个页面的 document.domain 都设成相同的域名就可以了。但要注意的是，document.domain 的设置是有限制的，我们只能把 document.domain 设置成自身或更高一级的父域，且主域必须相同。</p>\n<ul>\n<li>在页面<code>http://www.damonare.cn/a.html</code> 中设置 document.domain:</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;iframe id = <span class=\"string\">&quot;iframe&quot;</span> src=<span class=\"string\">&quot;http://damonare.cn/b.html&quot;</span> onload = <span class=\"string\">&quot;test()&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.domain = <span class=\"string\">&#x27;damonare.cn&#x27;</span>;<span class=\"comment\">//设置成主域</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        alert(<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;￼iframe&#x27;</span>).contentWindow);<span class=\"comment\">//contentWindow 可取得子窗口的 window 对象</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>在页面<code>http://damonare.cn/b.html</code> 中也设置 document.domain:</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"built_in\">document</span>.domain = <span class=\"string\">&#x27;damonare.cn&#x27;</span> <span class=\"comment\">//在iframe载入这个页面也设置document.domain，使之与主页面的document.domain相同</span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>修改 document.domain 的方法只适用于不同子域的框架间的交互。</p>\n<h2 id=\"通过-location-hash-跨域\"><a href=\"#通过-location-hash-跨域\" class=\"headerlink\" title=\"通过 location.hash 跨域\"></a>通过 location.hash 跨域</h2><p>此方法的原理就是改变 URL 的 hash 部分来进行双向通信。每个 window 通过改变其他 window 的 location 来发送消息（由于两个页面不在同一个域下 IE、Chrome 不允许修改 parent.location.hash 的值，所以要借助于父窗口域名下的一个代理 iframe），并通过监听自己的 URL 的变化来接收消息。这个方式的通信会造成一些不必要的浏览器历史记录，而且有些浏览器不支持 onhashchange 事件，需要轮询来获知 URL 的改变，最后，这样做也存在缺点，诸如数据直接暴露在了 url 中，数据容量和类型都有限等。</p>\n<h2 id=\"通过-HTML5-的-postMessage-方法跨域\"><a href=\"#通过-HTML5-的-postMessage-方法跨域\" class=\"headerlink\" title=\"通过 HTML5 的 postMessage 方法跨域\"></a>通过 HTML5 的 postMessage 方法跨域</h2><p>这个功能主要包括接受信息的 ”message” 事件和发送消息的 ”postMessage” 方法。比如<code>http://damonare.cn</code>域的 A 页面通过 iframe 嵌入了一个<code>http://google.com</code>域的 B 页面，可以通过以下方法实现 A 和 B 的通信</p>\n<p>A 页面通过 postMessage 方法发送消息：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> ifr = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;ifr&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> targetOrigin = <span class=\"string\">&#x27;http://www.google.com&#x27;</span></span><br><span class=\"line\">  ifr.contentWindow.postMessage(<span class=\"string\">&#x27;hello world!&#x27;</span>, targetOrigin)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>postMessage 的使用方法</strong></p>\n<p>otherWindow.postMessage(message, targetOrigin);</p>\n<ul>\n<li>otherWindow: 指目标窗口，也就是给哪个 window 发消息，是 window.frames 属性的成员或者由 window.open 方法创建的窗口</li>\n<li>message: 是要发送的消息，类型为 String、Object (IE8 、 9 不支持 )</li>\n<li>targetOrigin: 是限定消息接收范围，不限制请使用 ‘*</li>\n</ul>\n<p>B 页面通过 message 事件监听并接受消息 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> data = event.data <span class=\"comment\">//消息</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> origin = event.origin <span class=\"comment\">//消息来源地址</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> source = event.source <span class=\"comment\">//源Window对象</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (origin == <span class=\"string\">&#x27;http://www.baidu.com&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data) <span class=\"comment\">//hello world!</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.addEventListener != <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;message&#x27;</span>, onmessage, <span class=\"literal\">false</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.attachEvent != <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//for ie</span></span><br><span class=\"line\">  <span class=\"built_in\">window</span>.attachEvent(<span class=\"string\">&#x27;onmessage&#x27;</span>, onmessage)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"通过-window-name-跨域\"><a href=\"#通过-window-name-跨域\" class=\"headerlink\" title=\"通过 window.name 跨域\"></a>通过 window.name 跨域</h2><p>在一个窗口生命周期内，窗口载入的所有的页面都是共享一个 window.name 的，每一个页面对 window.name 都有读写的权限，window.name 是持久的存在于一个窗口载入的所有页面，并不会因为新的页面的载入而被重置。</p>\n<p>下面为 a.html 中代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.name = <span class=\"string\">&#x27;我是页面a中设置的值&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">setInterval</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location = <span class=\"string\">&#x27;b.html&#x27;</span></span><br><span class=\"line\">&#125;, <span class=\"number\">2000</span>) <span class=\"comment\">//两秒后把一个新页面b.html载入到当前的window中</span></span><br></pre></td></tr></table></figure>\n\n<p>b.html 中的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;<span class=\"built_in\">console</span>.log(<span class=\"built_in\">window</span>.name);<span class=\"comment\">//读取window.name的值&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"服务器端设置-http-header\"><a href=\"#服务器端设置-http-header\" class=\"headerlink\" title=\"服务器端设置 http header\"></a>服务器端设置 http header</h2><p>这是需要在服务器端设置的，作为前端工程师我们不用详细掌握，但是要知道有这么个解决方案。而且，现在推崇的跨域解决方案是这一种，比 JSONP 简单许多。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response.setHeader(<span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class=\"string\">&#x27;http://m.juejin.com/&#x27;</span>) <span class=\"comment\">// 第二个参数填写允许跨域的域名称，不建议直接写 &quot;*&quot;</span></span><br><span class=\"line\">response.setHeader(<span class=\"string\">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class=\"string\">&#x27;X-Requested-With&#x27;</span>)</span><br><span class=\"line\">response.setHeader(</span><br><span class=\"line\">  <span class=\"string\">&#x27;Access-Control-Allow-Methods&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;PUT,POST,GET,DELETE,OPTIONS&#x27;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 接收跨域的cookie</span></span><br><span class=\"line\">response.setHeader(<span class=\"string\">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class=\"string\">&#x27;true&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"XMLHttpRequest-Level-2-使用指南\"><a href=\"#XMLHttpRequest-Level-2-使用指南\" class=\"headerlink\" title=\"XMLHttpRequest Level 2 使用指南\"></a>XMLHttpRequest Level 2 使用指南</h2><p>XMLHttpRequest 是一个浏览器接口，是的 Javascript 可以进行 HTTP(S)通信。</p>\n<h3 id=\"老版本的-XMLHttpRequest-对象\"><a href=\"#老版本的-XMLHttpRequest-对象\" class=\"headerlink\" title=\"老版本的 XMLHttpRequest 对象\"></a>老版本的 XMLHttpRequest 对象</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//首先 ，新建一个XMLHttpRequest 的实例。</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//然后向主机发送一个HTTP请求。</span></span><br><span class=\"line\">xhr.open(<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;example.php&#x27;</span>)</span><br><span class=\"line\">xhr.send()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//接着，就等待远程主机做出回应。这时需要监控XMLHttpRequest对象的状态变化，指定回调函数。</span></span><br><span class=\"line\"></span><br><span class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (xhr.readyState == <span class=\"number\">4</span> &amp;&amp; xhr.status == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">    alert(xhr.responseText)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    alert(xhr.statusText)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"老版本的-XMLHttpRequest-的缺点\"><a href=\"#老版本的-XMLHttpRequest-的缺点\" class=\"headerlink\" title=\"老版本的 XMLHttpRequest 的缺点\"></a>老版本的 XMLHttpRequest 的缺点</h3><ul>\n<li>只支持文本数据的传送，无法用来读取和上传二进制文件。</li>\n<li>传送和接收数据时，没有进度信息，只能提示有没有完成。</li>\n<li>受到”同源限制”，只能向同一域名的服务器请求数据。</li>\n</ul>\n<h3 id=\"新版本的功能\"><a href=\"#新版本的功能\" class=\"headerlink\" title=\"新版本的功能\"></a>新版本的功能</h3><ul>\n<li>可以设置 HTTP 请求发的时限。</li>\n<li>可以使用 FormData 对象管理表单数据。</li>\n<li>可以上传文件。</li>\n<li>可以请求不同域名下的数据。（跨域请求）</li>\n<li>可以获取服务器端的二进制数据。</li>\n<li>可以获的数据传输的进度信息。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>具体概念如下：只要协议、域名、端口有任何一个不同，都被当作是不同的域。</p>\n<p><strong>凡是拥有 “src” 这个属性的标签都有跨域的能力</strong></p>","more":"<h2 id=\"跨域\"><a href=\"#跨域\" class=\"headerlink\" title=\"跨域\"></a>跨域</h2><p>浏览器请求（js,css,图片,form 表单提交）和 Ajax 请求都携带 Cookie 信息。但浏览器规定，静态资源请求和提交表单不受同源政策的限制，Ajax 请求受同源策略限制。</p>\n<p><strong>如果是协议和端口造成的跨域问题。则前台无法解决。</strong> 同源策略具体分为以下几类：</p>\n<ul>\n<li>不同域名</li>\n<li>相同域名不同端口号，如<code>https://www.oschina.net:8000</code>和<code>https://www.oschina.net:8001</code></li>\n<li>同一个域名不同协议，如<code>http://www.oschina.net/</code>和<code>https://www.oschina.net/</code></li>\n<li>域名和域名对应的的 IP，如<code>http://b.qq.com/</code>和 <code>http://10.198.7.85</code></li>\n<li>主域和子域，如<code>http://www.oschina.net/</code>和<code>https://test.oschina.net</code></li>\n<li>子域和子域，如<code>https://test1.oschina.net</code>和<code>https://test2.oschina.net</code> 以上情况只要出现了，那么就会产生跨域问题。那么如果解决跨域问题呢，下面的小节会总结一些解决跨域常用的方法。</li>\n</ul>\n<h2 id=\"JSONP-带-callback-的-json\"><a href=\"#JSONP-带-callback-的-json\" class=\"headerlink\" title=\"JSONP 带 callback 的 json\"></a>JSONP 带 callback 的 json</h2><p>JSONP:只支持 GET,不支持 POST 请求代理</p>\n<p>原理：浏览器只对 XHR(XMLHttpRequest) 请求有同源限制，二队 script 标签的 src 属性、link 的 ref 和 img 的 src 属性没有这种限制，利用这个就可以解决跨域请求问题</p>\n<p>有个通俗易懂的解释 -JSONP（JSON with Padding ）是数据格式 JSON 的一种 “ 使用模式 ”，可以让网页从别的网域要数据。利用<code>&lt;script&gt;</code>标签没有跨域限制，来达到与第 3 方通讯的目的。</p>\n<p>** jsonp 的客户端具体实现：**</p>\n<ol>\n<li>远程服务器 remoteserver.com 根目录下有个 remote.js 文件代码如下：</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alert(<span class=\"string\">&#x27;我是远程文件&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>本地服务器 localserver.com 下有个 jsonp.html 页面代码如下：</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html PUBLIC <span class=\"string\">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class=\"string\">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span><br><span class=\"line\">&lt;html xmlns=<span class=\"string\">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">    &lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> src=<span class=\"string\">&quot;http://remoteserver.com/remote.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>页面将会弹出一个提示窗体，显示跨域调用成功。</p>\n<ol start=\"3\">\n<li>现在我们在 jsonp.html 页面定义一个函数，然后在远程 remote.js 中传入数据进行调用。</li>\n</ol>\n<p>jsonp.html 页面代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html PUBLIC <span class=\"string\">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class=\"string\">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span><br><span class=\"line\">&lt;html xmlns=<span class=\"string\">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;title&gt;&lt;/title&gt;</span><br><span class=\"line\">    &lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> localHandler = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">        alert(<span class=\"string\">&#x27;我是本地函数，可以被跨域的remote.js文件调用，远程js带来的数据是：&#x27;</span> + data.result);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">    &lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> src=<span class=\"string\">&quot;http://remoteserver.com/remote.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>remote.js 文件代码如下：</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">localHandler(&#123; <span class=\"attr\">result</span>: <span class=\"string\">&#x27;我是远程js带来的数据&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>要注意的是他支持 GET 这一种 HTTP 请求类型</strong></p>\n<h2 id=\"跨域资源共享（CORS-Cross-Origin-Resource-Sharing-）\"><a href=\"#跨域资源共享（CORS-Cross-Origin-Resource-Sharing-）\" class=\"headerlink\" title=\"跨域资源共享（CORS-Cross Origin Resource Sharing ）\"></a>跨域资源共享（CORS-Cross Origin Resource Sharing ）</h2><p>跨域资源共享（ CORS ）机制允许 Web 应用服务器进行跨域访问控制，从而使跨域数据传输得以安全进行。</p>\n<p>CORS 除了 GET 要求方法以外也支持其他的 HTTP 要求。浏览器 CORS 请求分成两种：</p>\n<ol>\n<li>简单请求</li>\n<li>协商模型 / 预检请求（Preflighted Request ），即非简单请求如何区分请求具体属于哪一种呢，下面我总结了几点：<ol>\n<li>请求方式：</li>\n</ol>\n<ul>\n<li>GET</li>\n<li>HEAD</li>\n<li>POST</li>\n</ul>\n<ol start=\"2\">\n<li>HTTP 的头信息子段</li>\n</ol>\n<ul>\n<li>Accept</li>\n<li>Accept-Language</li>\n<li>Content-Language</li>\n<li>Last-Event-ID</li>\n<li>Content-Type：只限于三个值 application/x-www-form-urlencoded、multipart/form-data 、 text/plain，其中 ‘text/plain’ 默认支持，其他两种则需要预检请求和服务器协商。</li>\n</ul>\n</li>\n</ol>\n<p>满足以上两大点的即为简单请求，否则为非简单请求。</p>\n<p>假如站点 <code>http://foo.example</code> 的网页应用想要访问 <code>http://bar.other</code> 的资源。<code>http://foo.example</code> 的网页中可能包含类似于下面的 JavaScript 代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> invocation = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"string\">&#x27;http://bar.other/resources/public-data/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">callOtherDomain</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (invocation) &#123;</span><br><span class=\"line\">    invocation.open(<span class=\"string\">&#x27;GET&#x27;</span>, url, <span class=\"literal\">true</span>)</span><br><span class=\"line\">    invocation.onreadystatechange = handler</span><br><span class=\"line\">    invocation.send()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"document-domain-iframe-（适用于主域名相同的情况）\"><a href=\"#document-domain-iframe-（适用于主域名相同的情况）\" class=\"headerlink\" title=\"document.domain+iframe （适用于主域名相同的情况）\"></a>document.domain+iframe （适用于主域名相同的情况）</h2><p>比如，有一个页面，它的地址是<a href=\"http://www.damonare.cn/a.html\">http://www.damonare.cn/a.html</a> ， 在这个页面里面有一个 iframe，它的 src 是<a href=\"http://damonare.cn/b.html\">http://damonare.cn/b.html</a>, 很显然，这个页面与它里面的 iframe 框架是不同域的，所以我们是无法通过在页面中书写 js 代码来获取 iframe 中的东西的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> iframe = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;￼ifame&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> win = iframe.contentWindow;<span class=\"comment\">//可以获取到iframe里的window对象，但该window对象的属性和方法几乎是不可用的</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> doc = win.document;<span class=\"comment\">//这里获取不到iframe里的document对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> name = win.name;<span class=\"comment\">//这里同样获取不到window对象的name属性</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;iframe id = <span class=\"string\">&quot;iframe&quot;</span> src=<span class=\"string\">&quot;http://damonare.cn/b.html&quot;</span> onload = <span class=\"string\">&quot;test()&quot;</span>&gt;<span class=\"xml\">&lt;\\/iframe&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>这时只要把<code>http://www.damonare.cn/a.html</code>和<code>http://damonare.cn/b.html</code>这两个页面的 document.domain 都设成相同的域名就可以了。但要注意的是，document.domain 的设置是有限制的，我们只能把 document.domain 设置成自身或更高一级的父域，且主域必须相同。</p>\n<ul>\n<li>在页面<code>http://www.damonare.cn/a.html</code> 中设置 document.domain:</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;iframe id = <span class=\"string\">&quot;iframe&quot;</span> src=<span class=\"string\">&quot;http://damonare.cn/b.html&quot;</span> onload = <span class=\"string\">&quot;test()&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.domain = <span class=\"string\">&#x27;damonare.cn&#x27;</span>;<span class=\"comment\">//设置成主域</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        alert(<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;￼iframe&#x27;</span>).contentWindow);<span class=\"comment\">//contentWindow 可取得子窗口的 window 对象</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>在页面<code>http://damonare.cn/b.html</code> 中也设置 document.domain:</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"built_in\">document</span>.domain = <span class=\"string\">&#x27;damonare.cn&#x27;</span> <span class=\"comment\">//在iframe载入这个页面也设置document.domain，使之与主页面的document.domain相同</span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>修改 document.domain 的方法只适用于不同子域的框架间的交互。</p>\n<h2 id=\"通过-location-hash-跨域\"><a href=\"#通过-location-hash-跨域\" class=\"headerlink\" title=\"通过 location.hash 跨域\"></a>通过 location.hash 跨域</h2><p>此方法的原理就是改变 URL 的 hash 部分来进行双向通信。每个 window 通过改变其他 window 的 location 来发送消息（由于两个页面不在同一个域下 IE、Chrome 不允许修改 parent.location.hash 的值，所以要借助于父窗口域名下的一个代理 iframe），并通过监听自己的 URL 的变化来接收消息。这个方式的通信会造成一些不必要的浏览器历史记录，而且有些浏览器不支持 onhashchange 事件，需要轮询来获知 URL 的改变，最后，这样做也存在缺点，诸如数据直接暴露在了 url 中，数据容量和类型都有限等。</p>\n<h2 id=\"通过-HTML5-的-postMessage-方法跨域\"><a href=\"#通过-HTML5-的-postMessage-方法跨域\" class=\"headerlink\" title=\"通过 HTML5 的 postMessage 方法跨域\"></a>通过 HTML5 的 postMessage 方法跨域</h2><p>这个功能主要包括接受信息的 ”message” 事件和发送消息的 ”postMessage” 方法。比如<code>http://damonare.cn</code>域的 A 页面通过 iframe 嵌入了一个<code>http://google.com</code>域的 B 页面，可以通过以下方法实现 A 和 B 的通信</p>\n<p>A 页面通过 postMessage 方法发送消息：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> ifr = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;ifr&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> targetOrigin = <span class=\"string\">&#x27;http://www.google.com&#x27;</span></span><br><span class=\"line\">  ifr.contentWindow.postMessage(<span class=\"string\">&#x27;hello world!&#x27;</span>, targetOrigin)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>postMessage 的使用方法</strong></p>\n<p>otherWindow.postMessage(message, targetOrigin);</p>\n<ul>\n<li>otherWindow: 指目标窗口，也就是给哪个 window 发消息，是 window.frames 属性的成员或者由 window.open 方法创建的窗口</li>\n<li>message: 是要发送的消息，类型为 String、Object (IE8 、 9 不支持 )</li>\n<li>targetOrigin: 是限定消息接收范围，不限制请使用 ‘*</li>\n</ul>\n<p>B 页面通过 message 事件监听并接受消息 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> data = event.data <span class=\"comment\">//消息</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> origin = event.origin <span class=\"comment\">//消息来源地址</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> source = event.source <span class=\"comment\">//源Window对象</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (origin == <span class=\"string\">&#x27;http://www.baidu.com&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(data) <span class=\"comment\">//hello world!</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.addEventListener != <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;message&#x27;</span>, onmessage, <span class=\"literal\">false</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.attachEvent != <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//for ie</span></span><br><span class=\"line\">  <span class=\"built_in\">window</span>.attachEvent(<span class=\"string\">&#x27;onmessage&#x27;</span>, onmessage)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"通过-window-name-跨域\"><a href=\"#通过-window-name-跨域\" class=\"headerlink\" title=\"通过 window.name 跨域\"></a>通过 window.name 跨域</h2><p>在一个窗口生命周期内，窗口载入的所有的页面都是共享一个 window.name 的，每一个页面对 window.name 都有读写的权限，window.name 是持久的存在于一个窗口载入的所有页面，并不会因为新的页面的载入而被重置。</p>\n<p>下面为 a.html 中代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.name = <span class=\"string\">&#x27;我是页面a中设置的值&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">setInterval</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location = <span class=\"string\">&#x27;b.html&#x27;</span></span><br><span class=\"line\">&#125;, <span class=\"number\">2000</span>) <span class=\"comment\">//两秒后把一个新页面b.html载入到当前的window中</span></span><br></pre></td></tr></table></figure>\n\n<p>b.html 中的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;<span class=\"built_in\">console</span>.log(<span class=\"built_in\">window</span>.name);<span class=\"comment\">//读取window.name的值&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"服务器端设置-http-header\"><a href=\"#服务器端设置-http-header\" class=\"headerlink\" title=\"服务器端设置 http header\"></a>服务器端设置 http header</h2><p>这是需要在服务器端设置的，作为前端工程师我们不用详细掌握，但是要知道有这么个解决方案。而且，现在推崇的跨域解决方案是这一种，比 JSONP 简单许多。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response.setHeader(<span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class=\"string\">&#x27;http://m.juejin.com/&#x27;</span>) <span class=\"comment\">// 第二个参数填写允许跨域的域名称，不建议直接写 &quot;*&quot;</span></span><br><span class=\"line\">response.setHeader(<span class=\"string\">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class=\"string\">&#x27;X-Requested-With&#x27;</span>)</span><br><span class=\"line\">response.setHeader(</span><br><span class=\"line\">  <span class=\"string\">&#x27;Access-Control-Allow-Methods&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;PUT,POST,GET,DELETE,OPTIONS&#x27;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 接收跨域的cookie</span></span><br><span class=\"line\">response.setHeader(<span class=\"string\">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class=\"string\">&#x27;true&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"XMLHttpRequest-Level-2-使用指南\"><a href=\"#XMLHttpRequest-Level-2-使用指南\" class=\"headerlink\" title=\"XMLHttpRequest Level 2 使用指南\"></a>XMLHttpRequest Level 2 使用指南</h2><p>XMLHttpRequest 是一个浏览器接口，是的 Javascript 可以进行 HTTP(S)通信。</p>\n<h3 id=\"老版本的-XMLHttpRequest-对象\"><a href=\"#老版本的-XMLHttpRequest-对象\" class=\"headerlink\" title=\"老版本的 XMLHttpRequest 对象\"></a>老版本的 XMLHttpRequest 对象</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//首先 ，新建一个XMLHttpRequest 的实例。</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//然后向主机发送一个HTTP请求。</span></span><br><span class=\"line\">xhr.open(<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;example.php&#x27;</span>)</span><br><span class=\"line\">xhr.send()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//接着，就等待远程主机做出回应。这时需要监控XMLHttpRequest对象的状态变化，指定回调函数。</span></span><br><span class=\"line\"></span><br><span class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (xhr.readyState == <span class=\"number\">4</span> &amp;&amp; xhr.status == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">    alert(xhr.responseText)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    alert(xhr.statusText)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"老版本的-XMLHttpRequest-的缺点\"><a href=\"#老版本的-XMLHttpRequest-的缺点\" class=\"headerlink\" title=\"老版本的 XMLHttpRequest 的缺点\"></a>老版本的 XMLHttpRequest 的缺点</h3><ul>\n<li>只支持文本数据的传送，无法用来读取和上传二进制文件。</li>\n<li>传送和接收数据时，没有进度信息，只能提示有没有完成。</li>\n<li>受到”同源限制”，只能向同一域名的服务器请求数据。</li>\n</ul>\n<h3 id=\"新版本的功能\"><a href=\"#新版本的功能\" class=\"headerlink\" title=\"新版本的功能\"></a>新版本的功能</h3><ul>\n<li>可以设置 HTTP 请求发的时限。</li>\n<li>可以使用 FormData 对象管理表单数据。</li>\n<li>可以上传文件。</li>\n<li>可以请求不同域名下的数据。（跨域请求）</li>\n<li>可以获取服务器端的二进制数据。</li>\n<li>可以获的数据传输的进度信息。</li>\n</ul>"},{"title":"闭包","date":"2019-04-08T09:26:54.000Z","_content":"\n闭包一直都理解的比较零散，而且在实际运中中并不是很熟练，在此记录一下，并且希望在以后能够更加深入。\n\n<!--more-->\n红宝书上对于闭包的定义：闭包是指有权访问另外一个函数作用域中的变量的函数的关键在于以下两点：\n- 是一个函数\n- 能访问另外一个函数作用域的变量（即使外部函数已经返回）仍能访问外部变量。\n\n闭包主要有 2 个应用场景：\n\n- 函数作为返回值\n- 函数作为参数传递\n\n```javascript\nfunction F1() {\n  var a = 100;\n  return function() {\n    console.log(a);\n  };\n}\nvar f1 = F1();\nvar a = 200;\nf1(); //100\n```\n\n## 闭包\n\n闭包的定义非常简单：函数 A 返回一个函数 B，并且函数 B 中使用函数 A 中的变量，函数 B 被称为闭包。\n\n```javascript\nfunction A() {\n  let a = 1;\n  function B() {\n    console.log(a);\n  }\n  return B;\n}\n```\n\n你是否会疑惑为什么函数 A 已经弹出调用栈了，为什么函数 B 还能引用函数 A 中的变量，因为函数 A 中的变量这时候是存储在堆上的。现在的 JS 引擎可以通过逃逸分析辨别出那些变量需要存储在堆上，哪些需要存储在栈上。\n\n创建闭包最常见的方式就是在一个函数内部创建另一个函数。通常，函数的作用域及其所有变量都会在函数执行结束后被销毁。但是，在创建了一个闭包以后，这个函数的作用域就会一直保存到闭包不存在为止。\n\n```javascript\nfunction test() {\n  for (var i = 0; i < 4; i++) {\n    console.log('i:' + i);\n    (function(e) {\n      setTimeout(function() {\n        console.log(e);\n      }, 0);\n    })(i);\n  }\n}\ntest(); //i:0 => i:1 => i:2=> i:3=>  0 => 1=> 2 => 3\n```\n\n循环当中，匿名函数会立即执行，并且会将循环当前的 i 作为参数传入，将其作为当前匿名函数中的形参 e 的指向，即会保存对 i 的引用，它是不会被循环改变的。\n\n```javascript\nfunction makeAdder(x) {\n  console.log('x:' + x);\n  return function(y) {\n    console.log('y:' + y);\n    return x + y;\n  };\n}\n\nvar add5 = makeAdder(5);\n//x:5 undefined\nadd5;\n//f(y){  console.log('y:' + y) return x + y}\nvar add10 = makeAdder(10);\n\nconsole.log(add5(2)); // y:2 => 7\nconsole.log(add10(2)); // 12\n\n// 释放对闭包的引用\nadd5 = null;\nadd10 = null;\n```\n\nadd5 和 add10 都是闭包。他们共享相同的函数定义，但是保存了不同的环境。在 add5 中，x 为 5，在 add10 中，x 则为 10 ，最后通过 null 释放对闭包的引用。\n\n在 javascript 中，如果一个对象不再被引用，那么这个对象就会被垃圾回收机制回收； 如果两个对象互相引用，而不再被第 3 者所引用，那么这两个互相引用的对象也会被回收。\n\n**闭包只能取得包含函数中任何变量的最后一个值，这是因为闭包所保存的是整个变量对象，而不是某个特殊的变量**\n\n```javascript\nfunction test() {\n  var arr = [];\n  for (var i = 0; i < 10; i++) {\n    //作用域1\n    arr[i] = function() {\n      //作用域2 声明arr[]()\n      return i;\n    };\n  }\n  for (var a = 0; a < 10; a++) {\n    console.log(arr[a]());\n  }\n}\ntest();\n// 毫无疑问连续打印 10 个 10。因为在for循环中 a[i] 为一个函数声明\n//1.执行完for之后，在for作用域中i的值为10\n```\n\n改动一下\n\n```javascript\nfunction test() {\n  var arr = [];\n  //块1作用域\n  for (let i = 0; i < 10; i++) {\n    //块2作用域\n    arr[i] = function() {\n      //块3作用域\n      return i;\n    };\n  }\n  //块1作用域\n  for (var a = 0; a < 10; a++) {\n    console.log(arr[a]());\n  }\n}\ntest(); // 连续打印 0 到 9\n```\n\n**实现原因 :**\n\n- 当用 var 的时候 函数 2 作用域中没有 i 就向函数作用域 1 中去找，而执行到 `console.log(arr[a]())` 时 i 已经循环完毕，因此 i 全为 10。\n\n* 当使用 let 时，每次迭代 i 都被**重新声明**，即每层迭代会生成一个块作用域，并且变量 i 被定义为上一次结算的值。\n* var 是函数作用域，for 循环无论执行多少次，都是去最近的函数里面找，而不是块中找，所以只有一个 i，现在的 i 是 10。\n\n### 闭包中的 this 对象\n\n```javascript\nvar name = 'The Window';\n\nvar obj = {\n  name: 'My Object',\n\n  getName: function() {\n    return function() {\n      return this.name;\n    };\n  }\n};\n\nconsole.log(obj.getName()()); // The Window\n```\n\nobj.getName()() 实际上是在全局作用域中调用了匿名函数，this 指向了 window。这里要理解函数名与函数功能（或者称函数值）是分割开的，不要认为函数在哪里，其内部的 this 就指向哪里。匿名函数的执行环境具有全局性，因此其 this 对象通常指向 window。\n\n### 闭包的应用\n\n**应用闭包的主要场合是：设计私有的方法和变量。** 闭包的作用：\n\n- 访问函数的内部变量\n- 让被引用的变量值始终保存在内存中\n\n```javascript\nfunction fun(n, o) {\n  console.log(o);\n  return {\n    fun: function(m) {\n      return fun(m, n);\n    }\n  };\n}\n\nvar a = fun(0); // undefined\na.fun(1); // 0\na.fun(2); // 0\na.fun(3); // 0\n\nvar b = fun(0)\n  .fun(1)\n  .fun(2)\n  .fun(3); // undefined,0,1,2\n\nvar c = fun(0).fun(1); // undefined,0\nc.fun(2); // 1\nc.fun(3); // 1\n```\n\n```javascript\nfunction fn1() {\n  var a = 1;\n  return function() {\n    console.log(++a);\n  };\n}\n\nvar fn2 = fn1();\n\nfn2(); //输出2\n\nfn2(); //输出3\n```\n","source":"_posts/闭包.md","raw":"---\ntitle: 闭包\ndate: 2019-04-08 17:26:54\ncategories: JavaScript\n---\n\n闭包一直都理解的比较零散，而且在实际运中中并不是很熟练，在此记录一下，并且希望在以后能够更加深入。\n\n<!--more-->\n红宝书上对于闭包的定义：闭包是指有权访问另外一个函数作用域中的变量的函数的关键在于以下两点：\n- 是一个函数\n- 能访问另外一个函数作用域的变量（即使外部函数已经返回）仍能访问外部变量。\n\n闭包主要有 2 个应用场景：\n\n- 函数作为返回值\n- 函数作为参数传递\n\n```javascript\nfunction F1() {\n  var a = 100;\n  return function() {\n    console.log(a);\n  };\n}\nvar f1 = F1();\nvar a = 200;\nf1(); //100\n```\n\n## 闭包\n\n闭包的定义非常简单：函数 A 返回一个函数 B，并且函数 B 中使用函数 A 中的变量，函数 B 被称为闭包。\n\n```javascript\nfunction A() {\n  let a = 1;\n  function B() {\n    console.log(a);\n  }\n  return B;\n}\n```\n\n你是否会疑惑为什么函数 A 已经弹出调用栈了，为什么函数 B 还能引用函数 A 中的变量，因为函数 A 中的变量这时候是存储在堆上的。现在的 JS 引擎可以通过逃逸分析辨别出那些变量需要存储在堆上，哪些需要存储在栈上。\n\n创建闭包最常见的方式就是在一个函数内部创建另一个函数。通常，函数的作用域及其所有变量都会在函数执行结束后被销毁。但是，在创建了一个闭包以后，这个函数的作用域就会一直保存到闭包不存在为止。\n\n```javascript\nfunction test() {\n  for (var i = 0; i < 4; i++) {\n    console.log('i:' + i);\n    (function(e) {\n      setTimeout(function() {\n        console.log(e);\n      }, 0);\n    })(i);\n  }\n}\ntest(); //i:0 => i:1 => i:2=> i:3=>  0 => 1=> 2 => 3\n```\n\n循环当中，匿名函数会立即执行，并且会将循环当前的 i 作为参数传入，将其作为当前匿名函数中的形参 e 的指向，即会保存对 i 的引用，它是不会被循环改变的。\n\n```javascript\nfunction makeAdder(x) {\n  console.log('x:' + x);\n  return function(y) {\n    console.log('y:' + y);\n    return x + y;\n  };\n}\n\nvar add5 = makeAdder(5);\n//x:5 undefined\nadd5;\n//f(y){  console.log('y:' + y) return x + y}\nvar add10 = makeAdder(10);\n\nconsole.log(add5(2)); // y:2 => 7\nconsole.log(add10(2)); // 12\n\n// 释放对闭包的引用\nadd5 = null;\nadd10 = null;\n```\n\nadd5 和 add10 都是闭包。他们共享相同的函数定义，但是保存了不同的环境。在 add5 中，x 为 5，在 add10 中，x 则为 10 ，最后通过 null 释放对闭包的引用。\n\n在 javascript 中，如果一个对象不再被引用，那么这个对象就会被垃圾回收机制回收； 如果两个对象互相引用，而不再被第 3 者所引用，那么这两个互相引用的对象也会被回收。\n\n**闭包只能取得包含函数中任何变量的最后一个值，这是因为闭包所保存的是整个变量对象，而不是某个特殊的变量**\n\n```javascript\nfunction test() {\n  var arr = [];\n  for (var i = 0; i < 10; i++) {\n    //作用域1\n    arr[i] = function() {\n      //作用域2 声明arr[]()\n      return i;\n    };\n  }\n  for (var a = 0; a < 10; a++) {\n    console.log(arr[a]());\n  }\n}\ntest();\n// 毫无疑问连续打印 10 个 10。因为在for循环中 a[i] 为一个函数声明\n//1.执行完for之后，在for作用域中i的值为10\n```\n\n改动一下\n\n```javascript\nfunction test() {\n  var arr = [];\n  //块1作用域\n  for (let i = 0; i < 10; i++) {\n    //块2作用域\n    arr[i] = function() {\n      //块3作用域\n      return i;\n    };\n  }\n  //块1作用域\n  for (var a = 0; a < 10; a++) {\n    console.log(arr[a]());\n  }\n}\ntest(); // 连续打印 0 到 9\n```\n\n**实现原因 :**\n\n- 当用 var 的时候 函数 2 作用域中没有 i 就向函数作用域 1 中去找，而执行到 `console.log(arr[a]())` 时 i 已经循环完毕，因此 i 全为 10。\n\n* 当使用 let 时，每次迭代 i 都被**重新声明**，即每层迭代会生成一个块作用域，并且变量 i 被定义为上一次结算的值。\n* var 是函数作用域，for 循环无论执行多少次，都是去最近的函数里面找，而不是块中找，所以只有一个 i，现在的 i 是 10。\n\n### 闭包中的 this 对象\n\n```javascript\nvar name = 'The Window';\n\nvar obj = {\n  name: 'My Object',\n\n  getName: function() {\n    return function() {\n      return this.name;\n    };\n  }\n};\n\nconsole.log(obj.getName()()); // The Window\n```\n\nobj.getName()() 实际上是在全局作用域中调用了匿名函数，this 指向了 window。这里要理解函数名与函数功能（或者称函数值）是分割开的，不要认为函数在哪里，其内部的 this 就指向哪里。匿名函数的执行环境具有全局性，因此其 this 对象通常指向 window。\n\n### 闭包的应用\n\n**应用闭包的主要场合是：设计私有的方法和变量。** 闭包的作用：\n\n- 访问函数的内部变量\n- 让被引用的变量值始终保存在内存中\n\n```javascript\nfunction fun(n, o) {\n  console.log(o);\n  return {\n    fun: function(m) {\n      return fun(m, n);\n    }\n  };\n}\n\nvar a = fun(0); // undefined\na.fun(1); // 0\na.fun(2); // 0\na.fun(3); // 0\n\nvar b = fun(0)\n  .fun(1)\n  .fun(2)\n  .fun(3); // undefined,0,1,2\n\nvar c = fun(0).fun(1); // undefined,0\nc.fun(2); // 1\nc.fun(3); // 1\n```\n\n```javascript\nfunction fn1() {\n  var a = 1;\n  return function() {\n    console.log(++a);\n  };\n}\n\nvar fn2 = fn1();\n\nfn2(); //输出2\n\nfn2(); //输出3\n```\n","slug":"闭包","published":1,"updated":"2021-02-27T12:24:38.493Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xk0034l5v003v39a91","content":"<p>闭包一直都理解的比较零散，而且在实际运中中并不是很熟练，在此记录一下，并且希望在以后能够更加深入。</p>\n<span id=\"more\"></span>\n<p>红宝书上对于闭包的定义：闭包是指有权访问另外一个函数作用域中的变量的函数的关键在于以下两点：</p>\n<ul>\n<li>是一个函数</li>\n<li>能访问另外一个函数作用域的变量（即使外部函数已经返回）仍能访问外部变量。</li>\n</ul>\n<p>闭包主要有 2 个应用场景：</p>\n<ul>\n<li>函数作为返回值</li>\n<li>函数作为参数传递</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F1</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">100</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = F1();</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">200</span>;</span><br><span class=\"line\">f1(); <span class=\"comment\">//100</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h2><p>闭包的定义非常简单：函数 A 返回一个函数 B，并且函数 B 中使用函数 A 中的变量，函数 B 被称为闭包。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> B;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>你是否会疑惑为什么函数 A 已经弹出调用栈了，为什么函数 B 还能引用函数 A 中的变量，因为函数 A 中的变量这时候是存储在堆上的。现在的 JS 引擎可以通过逃逸分析辨别出那些变量需要存储在堆上，哪些需要存储在栈上。</p>\n<p>创建闭包最常见的方式就是在一个函数内部创建另一个函数。通常，函数的作用域及其所有变量都会在函数执行结束后被销毁。但是，在创建了一个闭包以后，这个函数的作用域就会一直保存到闭包不存在为止。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;i:&#x27;</span> + i);</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e);</span><br><span class=\"line\">      &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;)(i);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test(); <span class=\"comment\">//i:0 =&gt; i:1 =&gt; i:2=&gt; i:3=&gt;  0 =&gt; 1=&gt; 2 =&gt; 3</span></span><br></pre></td></tr></table></figure>\n\n<p>循环当中，匿名函数会立即执行，并且会将循环当前的 i 作为参数传入，将其作为当前匿名函数中的形参 e 的指向，即会保存对 i 的引用，它是不会被循环改变的。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeAdder</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;x:&#x27;</span> + x);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;y:&#x27;</span> + y);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> add5 = makeAdder(<span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"comment\">//x:5 undefined</span></span><br><span class=\"line\">add5;</span><br><span class=\"line\"><span class=\"comment\">//f(y)&#123;  console.log(&#x27;y:&#x27; + y) return x + y&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> add10 = makeAdder(<span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(add5(<span class=\"number\">2</span>)); <span class=\"comment\">// y:2 =&gt; 7</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(add10(<span class=\"number\">2</span>)); <span class=\"comment\">// 12</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 释放对闭包的引用</span></span><br><span class=\"line\">add5 = <span class=\"literal\">null</span>;</span><br><span class=\"line\">add10 = <span class=\"literal\">null</span>;</span><br></pre></td></tr></table></figure>\n\n<p>add5 和 add10 都是闭包。他们共享相同的函数定义，但是保存了不同的环境。在 add5 中，x 为 5，在 add10 中，x 则为 10 ，最后通过 null 释放对闭包的引用。</p>\n<p>在 javascript 中，如果一个对象不再被引用，那么这个对象就会被垃圾回收机制回收； 如果两个对象互相引用，而不再被第 3 者所引用，那么这两个互相引用的对象也会被回收。</p>\n<p><strong>闭包只能取得包含函数中任何变量的最后一个值，这是因为闭包所保存的是整个变量对象，而不是某个特殊的变量</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//作用域1</span></span><br><span class=\"line\">    arr[i] = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//作用域2 声明arr[]()</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> a = <span class=\"number\">0</span>; a &lt; <span class=\"number\">10</span>; a++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arr[a]());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test();</span><br><span class=\"line\"><span class=\"comment\">// 毫无疑问连续打印 10 个 10。因为在for循环中 a[i] 为一个函数声明</span></span><br><span class=\"line\"><span class=\"comment\">//1.执行完for之后，在for作用域中i的值为10</span></span><br></pre></td></tr></table></figure>\n\n<p>改动一下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">  <span class=\"comment\">//块1作用域</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//块2作用域</span></span><br><span class=\"line\">    arr[i] = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//块3作用域</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//块1作用域</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> a = <span class=\"number\">0</span>; a &lt; <span class=\"number\">10</span>; a++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arr[a]());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test(); <span class=\"comment\">// 连续打印 0 到 9</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>实现原因 :</strong></p>\n<ul>\n<li>当用 var 的时候 函数 2 作用域中没有 i 就向函数作用域 1 中去找，而执行到 <code>console.log(arr[a]())</code> 时 i 已经循环完毕，因此 i 全为 10。</li>\n</ul>\n<ul>\n<li>当使用 let 时，每次迭代 i 都被<strong>重新声明</strong>，即每层迭代会生成一个块作用域，并且变量 i 被定义为上一次结算的值。</li>\n<li>var 是函数作用域，for 循环无论执行多少次，都是去最近的函数里面找，而不是块中找，所以只有一个 i，现在的 i 是 10。</li>\n</ul>\n<h3 id=\"闭包中的-this-对象\"><a href=\"#闭包中的-this-对象\" class=\"headerlink\" title=\"闭包中的 this 对象\"></a>闭包中的 this 对象</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;The Window&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;My Object&#x27;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">  getName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj.getName()()); <span class=\"comment\">// The Window</span></span><br></pre></td></tr></table></figure>\n\n<p>obj.getName()() 实际上是在全局作用域中调用了匿名函数，this 指向了 window。这里要理解函数名与函数功能（或者称函数值）是分割开的，不要认为函数在哪里，其内部的 this 就指向哪里。匿名函数的执行环境具有全局性，因此其 this 对象通常指向 window。</p>\n<h3 id=\"闭包的应用\"><a href=\"#闭包的应用\" class=\"headerlink\" title=\"闭包的应用\"></a>闭包的应用</h3><p><strong>应用闭包的主要场合是：设计私有的方法和变量。</strong> 闭包的作用：</p>\n<ul>\n<li>访问函数的内部变量</li>\n<li>让被引用的变量值始终保存在内存中</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fun</span>(<span class=\"params\">n, o</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(o);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    fun: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">m</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> fun(m, n);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = fun(<span class=\"number\">0</span>); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">a.fun(<span class=\"number\">1</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\">a.fun(<span class=\"number\">2</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\">a.fun(<span class=\"number\">3</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = fun(<span class=\"number\">0</span>)</span><br><span class=\"line\">  .fun(<span class=\"number\">1</span>)</span><br><span class=\"line\">  .fun(<span class=\"number\">2</span>)</span><br><span class=\"line\">  .fun(<span class=\"number\">3</span>); <span class=\"comment\">// undefined,0,1,2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = fun(<span class=\"number\">0</span>).fun(<span class=\"number\">1</span>); <span class=\"comment\">// undefined,0</span></span><br><span class=\"line\">c.fun(<span class=\"number\">2</span>); <span class=\"comment\">// 1</span></span><br><span class=\"line\">c.fun(<span class=\"number\">3</span>); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn1</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(++a);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> fn2 = fn1();</span><br><span class=\"line\"></span><br><span class=\"line\">fn2(); <span class=\"comment\">//输出2</span></span><br><span class=\"line\"></span><br><span class=\"line\">fn2(); <span class=\"comment\">//输出3</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>闭包一直都理解的比较零散，而且在实际运中中并不是很熟练，在此记录一下，并且希望在以后能够更加深入。</p>","more":"<p>红宝书上对于闭包的定义：闭包是指有权访问另外一个函数作用域中的变量的函数的关键在于以下两点：</p>\n<ul>\n<li>是一个函数</li>\n<li>能访问另外一个函数作用域的变量（即使外部函数已经返回）仍能访问外部变量。</li>\n</ul>\n<p>闭包主要有 2 个应用场景：</p>\n<ul>\n<li>函数作为返回值</li>\n<li>函数作为参数传递</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F1</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">100</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> f1 = F1();</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">200</span>;</span><br><span class=\"line\">f1(); <span class=\"comment\">//100</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h2><p>闭包的定义非常简单：函数 A 返回一个函数 B，并且函数 B 中使用函数 A 中的变量，函数 B 被称为闭包。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> B;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>你是否会疑惑为什么函数 A 已经弹出调用栈了，为什么函数 B 还能引用函数 A 中的变量，因为函数 A 中的变量这时候是存储在堆上的。现在的 JS 引擎可以通过逃逸分析辨别出那些变量需要存储在堆上，哪些需要存储在栈上。</p>\n<p>创建闭包最常见的方式就是在一个函数内部创建另一个函数。通常，函数的作用域及其所有变量都会在函数执行结束后被销毁。但是，在创建了一个闭包以后，这个函数的作用域就会一直保存到闭包不存在为止。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;i:&#x27;</span> + i);</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e);</span><br><span class=\"line\">      &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;)(i);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test(); <span class=\"comment\">//i:0 =&gt; i:1 =&gt; i:2=&gt; i:3=&gt;  0 =&gt; 1=&gt; 2 =&gt; 3</span></span><br></pre></td></tr></table></figure>\n\n<p>循环当中，匿名函数会立即执行，并且会将循环当前的 i 作为参数传入，将其作为当前匿名函数中的形参 e 的指向，即会保存对 i 的引用，它是不会被循环改变的。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeAdder</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;x:&#x27;</span> + x);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;y:&#x27;</span> + y);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> add5 = makeAdder(<span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"comment\">//x:5 undefined</span></span><br><span class=\"line\">add5;</span><br><span class=\"line\"><span class=\"comment\">//f(y)&#123;  console.log(&#x27;y:&#x27; + y) return x + y&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> add10 = makeAdder(<span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(add5(<span class=\"number\">2</span>)); <span class=\"comment\">// y:2 =&gt; 7</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(add10(<span class=\"number\">2</span>)); <span class=\"comment\">// 12</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 释放对闭包的引用</span></span><br><span class=\"line\">add5 = <span class=\"literal\">null</span>;</span><br><span class=\"line\">add10 = <span class=\"literal\">null</span>;</span><br></pre></td></tr></table></figure>\n\n<p>add5 和 add10 都是闭包。他们共享相同的函数定义，但是保存了不同的环境。在 add5 中，x 为 5，在 add10 中，x 则为 10 ，最后通过 null 释放对闭包的引用。</p>\n<p>在 javascript 中，如果一个对象不再被引用，那么这个对象就会被垃圾回收机制回收； 如果两个对象互相引用，而不再被第 3 者所引用，那么这两个互相引用的对象也会被回收。</p>\n<p><strong>闭包只能取得包含函数中任何变量的最后一个值，这是因为闭包所保存的是整个变量对象，而不是某个特殊的变量</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//作用域1</span></span><br><span class=\"line\">    arr[i] = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//作用域2 声明arr[]()</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> a = <span class=\"number\">0</span>; a &lt; <span class=\"number\">10</span>; a++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arr[a]());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test();</span><br><span class=\"line\"><span class=\"comment\">// 毫无疑问连续打印 10 个 10。因为在for循环中 a[i] 为一个函数声明</span></span><br><span class=\"line\"><span class=\"comment\">//1.执行完for之后，在for作用域中i的值为10</span></span><br></pre></td></tr></table></figure>\n\n<p>改动一下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">  <span class=\"comment\">//块1作用域</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//块2作用域</span></span><br><span class=\"line\">    arr[i] = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//块3作用域</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//块1作用域</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> a = <span class=\"number\">0</span>; a &lt; <span class=\"number\">10</span>; a++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arr[a]());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test(); <span class=\"comment\">// 连续打印 0 到 9</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>实现原因 :</strong></p>\n<ul>\n<li>当用 var 的时候 函数 2 作用域中没有 i 就向函数作用域 1 中去找，而执行到 <code>console.log(arr[a]())</code> 时 i 已经循环完毕，因此 i 全为 10。</li>\n</ul>\n<ul>\n<li>当使用 let 时，每次迭代 i 都被<strong>重新声明</strong>，即每层迭代会生成一个块作用域，并且变量 i 被定义为上一次结算的值。</li>\n<li>var 是函数作用域，for 循环无论执行多少次，都是去最近的函数里面找，而不是块中找，所以只有一个 i，现在的 i 是 10。</li>\n</ul>\n<h3 id=\"闭包中的-this-对象\"><a href=\"#闭包中的-this-对象\" class=\"headerlink\" title=\"闭包中的 this 对象\"></a>闭包中的 this 对象</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;The Window&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;My Object&#x27;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">  getName: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj.getName()()); <span class=\"comment\">// The Window</span></span><br></pre></td></tr></table></figure>\n\n<p>obj.getName()() 实际上是在全局作用域中调用了匿名函数，this 指向了 window。这里要理解函数名与函数功能（或者称函数值）是分割开的，不要认为函数在哪里，其内部的 this 就指向哪里。匿名函数的执行环境具有全局性，因此其 this 对象通常指向 window。</p>\n<h3 id=\"闭包的应用\"><a href=\"#闭包的应用\" class=\"headerlink\" title=\"闭包的应用\"></a>闭包的应用</h3><p><strong>应用闭包的主要场合是：设计私有的方法和变量。</strong> 闭包的作用：</p>\n<ul>\n<li>访问函数的内部变量</li>\n<li>让被引用的变量值始终保存在内存中</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fun</span>(<span class=\"params\">n, o</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(o);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    fun: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">m</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> fun(m, n);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = fun(<span class=\"number\">0</span>); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">a.fun(<span class=\"number\">1</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\">a.fun(<span class=\"number\">2</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\">a.fun(<span class=\"number\">3</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = fun(<span class=\"number\">0</span>)</span><br><span class=\"line\">  .fun(<span class=\"number\">1</span>)</span><br><span class=\"line\">  .fun(<span class=\"number\">2</span>)</span><br><span class=\"line\">  .fun(<span class=\"number\">3</span>); <span class=\"comment\">// undefined,0,1,2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c = fun(<span class=\"number\">0</span>).fun(<span class=\"number\">1</span>); <span class=\"comment\">// undefined,0</span></span><br><span class=\"line\">c.fun(<span class=\"number\">2</span>); <span class=\"comment\">// 1</span></span><br><span class=\"line\">c.fun(<span class=\"number\">3</span>); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn1</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(++a);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> fn2 = fn1();</span><br><span class=\"line\"></span><br><span class=\"line\">fn2(); <span class=\"comment\">//输出2</span></span><br><span class=\"line\"></span><br><span class=\"line\">fn2(); <span class=\"comment\">//输出3</span></span><br></pre></td></tr></table></figure>"},{"title":"JS原生-ES6","date":"2018-01-24T02:51:11.000Z","_content":"\n发现自己对于 javascript 的底层 API 所知甚少，在这里记录一下所遇到的有趣又实在的 API 用法。\n\nES6 的更新内容主要分为以下几点\n\n- 表达式：声明、解构赋值\n- 内置对象：字符串扩展、数值扩展、对象扩展、数组扩展、函数扩展、正则扩展、Symbol、Set、Map、Proxy、Reflect\n- 语句与运算：Class、Module、lterator(迭代)\n- 异步编程：Promise、Generator、Async\n\n<!--more-->\n\n## var 与 let 的区别\n\n使用 var 关键字来声明变量，会出现重复声明导致变量被覆盖不会报错的问题；\n在 ES6 中引入了 let 来解决 var 关键字带来的潜在问题，若是重复声明则会在控制台报错。\n\n## `Symbol`数据类型\n\n`Symbol`是通过`Symbol`函数生成的，凡是属性名属于`symbol`类型，就都是独一无二的，可以保证不会与其他属性名冲突。\n\n### 使用 Symbol 来作为唯一标志\n\n```javascript\nconst PROP_NAME = Symbol() //解救无意义的赋值\nconst PROP_AGE = Symbol()\n\nlet obj = {\n  [PROP_NAME]: '一斤代码', //对象key值或是常量使用，原理相同\n}\nobj[PROP_AGE] = 18\n\nobj[PROP_NAME] // '一斤代码'\nobj[PROP_AGE] // 18\n```\n\n### 使用 Symbol 定义类的私有属性\n\n在 JS 中是没有私有变量的，雷伤所有定义的属性或是方法都是公开访问的。因此可能存在污染等情况，而有了 Symbol 以及模块化机制，类的私有属性和方法才能变成可能。\n\n在文件 a.js 中\n\n```javascript\nconst PASSWORD = Symbol()\n\nclass Login {\n  constructor(username, password) {\n    this.username = username\n    this[PASSWORD] = password\n  }\n\n  checkPassword(pwd) {\n    return this[PASSWORD] === pwd\n  }\n}\n\nexport default Login\n```\n\n在文件 b.js 中\n\n```javascript\nimport Login from './a'\n\nconst login = new Login('admin', '123456')\n\nlogin.checkPassword('admin') // true\n\nlogin.PASSWORD // oh!no!\nlogin[PASSWORD] // oh!no!\nlogin['PASSWORD'] // oh!no!\n```\n\n由于 Symbol 常量 PASSWORD 被定义在 a.js 所在的模块中，外面的模块获取不到这个 Symbol,也不可能在创建一个一个一样的 Symbol 出来，所以这个 PASSWORD 只能被限制在 a.js 内部使用，达到一个私有化的效果\n\n### 注册和获取全局 Symbol\n\nSymbol 在不同 window 中创建的 Symbol 实例总是唯一的，如果应用涉及到多个 window（ifram），并需要这些 window 使用的是同一个，那就不能使用 Symbol()了（若是微前端里面又是什么样的呢？有时间试试），这时可以使用 Symbol.for()，它来注册或获取一个 window 间全局的 Symbol 实例：\n\n```javascript\nlet gs1 = Symbol.for('global_symbol_1') //注册一个全局Symbol\nlet gs2 = Symbol.for('global_symbol_1') //获取全局Symbol\n\ngs1 === gs2 // true\n```\n\n这时，在多个相关 window 间也是唯一的。\n\n### Symbol.iterator\n\n在 Symbol.iterator 出现后，JS 可以定义自己的迭代器\niterator 模式总是用同一种逻辑来遍历集合\n\n```javascript\nfor(Iterator it = c.iterater(); it.hasNext(); ) { ... }\n//这样就在一定程度上解决了不同的数据类型需要不同的遍历方法\n```\n\n```javascript\nlet students = {\n  [Symbol.iterator]: function* () {\n    for (var i = 0; i <= 100; i++) {\n      yield i\n    }\n  },\n}\nfor (var s of students) {\n  console.log(s)\n}\n//这个yield其实最后返回的就是iterator函数\n```\n\n## yield\n\nyield 关键字用来暂停和恢复一个生成器函数.yield 关键字只能在生成器函数内部使用，用在其他地方会抛出错误。类似函数的 return 关键字，yield 关键字必须直接位于生成器函数定义中，出现在嵌套的非生成器函数中会抛出语法错误\n\nyield 关键字实际返回一个 IteratorResult 对象，它有两个属性，value 和 done。value 属性是对 yield 表达式求值的结果，而 done 是 false，表示生成器函数尚未完全完成。\n\n```javascript\nfunction* countAppleSales() {\n  var saleList = [3, 7, 5]\n  for (var i = 0; i < saleList.length; i++) {\n    yield saleList[i]\n  }\n}\n//一旦生成器函数已定义，可以通过一个构造一个迭代器来使用它\n\nvar appleStore = countAppleSales() // Generator { }\nconsole.log(appleStore.next()) // { value: 3, done: false }\nconsole.log(appleStore.next()) // { value: 7, done: false }\nconsole.log(appleStore.next()) // { value: 5, done: false }\nconsole.log(appleStore.next()) // { value: undefined, done: true }\n```\n\n## 类 class\n\n面向对象编程中的一个核心概念就是类（多态、封装、继承）。可以把事物都抽象成一个个的类来描述他们的信息和行为。\n\nJavaScript 是一个基于对象的语言，而不是面对对象的语言，它是一个基于 prototype 的语言。它的语法中没有像 Java 之类典型面向对象语言中定义一个类的语法，因此在 ES6 中，提供了一个面向对象风格的类定义方式：使用 class 关键字。\n\n类里面所有的方法都定义在类的 prototype 上面\n\n**注意：类必须使用 new 调用，否则会报错。这是它和普通函数的一个主要区别，后者不用 new 也可以执行**\n\n```javascript\nclass Person {\n  constructor(name, age) {\n    this.name = name\n    this.age = age\n  }\n\n  walk() {\n    console.log(\"I'm walking...\")\n  }\n\n  static create(name, age) {\n    //定义静态方法\n    return new Person(name, age)\n  }\n}\n```\n\n### constructor\n\n- 是类的默认方法，通过 new 命令生成对象实例时，自动调用该方法，一个类必须有 constructor 方法，如果没有显示定义，一个空的 constructor 方法会被默认添加\n- 执行这个 constructor 方法默认返回实例对象（this）\n### 类的 prototype 属性\n\n类的所有方法都定义在类的 prototype 属性上面\n\n```javascript\nclass Point {\n  constructor() {}\n  toString() {}\n}\n\n//等同于\nPoint.prototype = {\n  constructor(){},\n  toString()\n}\n```\n\n### class 的静态方法\n\n如果在一个方法前，加上 static 关键字，就表示该方法不会被实例继承，而是直接通过类来调用，就是称为“静态方法”\n\n**注意：如果静态方法包含 this 关键字，这个 this 指向的是类，而不是实例**\n\n```javascript\nclass Foo {\n  static classMethod() {\n    return 'hello'\n  }\n}\n\nFoo.classMethod() // 'hello'\n\nvar foo = new Foo()\nfoo.classMethod()\n```\n### super\n\nsuper 关键字用于访问和调用一个对象的父对象的函数。( 只能在 class 内部用 )\n\n在构造函数中使用时，super 关键字将单独出现，并且必须在使用 this 之前使用。\n\nsuper 关键字也可以用来调用父对象上的函数。\n\n```javascript\nsuper([arguments])\n// 调用 父对象/父类 的构造函数\n\nsuper.functionOnParent([arguments])\n// 调用 父对象/父类 上的方法\n```\n\n```javascript\nclass Polygon {\n  construector(height, width) {\n    this.name = 'Polygon'\n    this.height = height\n    this.width = width\n  }\n  sayName() {\n    console.log('Hi,I am a', this.name + '.')\n  }\n  class Square extends Polygon{\n    constructor(length){\n      this.height;\n      // ReferenceError ,super 需要先被调用！\n\n      /*\n       这里，它调用父类的构造函数的length,\n       作为Polygon 的 width 和 height\n       */\n       super(length,length)\n       /*\n       注意，在派生的类中，在你可以使用this之前，必须 先调用super()。忽略这，这将导致引用错误。\n       */\n       this.name = 'Square'\n    }\n    get area(){\n      return this.height * this.width\n    }\n    set area(value){\n      this.area = value\n    }\n  }\n}\n```\n\n**使用 super 调用父类的静态方法。**\n\n```javascript\nclass Human{}\n  constructor(){}\n    static ping(){\n      return 'ping'\n  }\n}\n\nclass computer eatends Human{ //使用extend 实现继承另一个类\n  constructor(){}\n  static pingpong(){\n    return super.ping()+'pong'\n  }\n}\n\nComputer.pingpong()\n```\n\n**原始 class 实现方式**\n\n```javascript\nfunction Parent(name) {\n  this.name = name\n}\nParent.prototype.getName = function () {\n  return this.name\n}\nfunction Child(name, age) {\n  Parent.call(this, name)\n  this.age = age\n}\n//实现继承\nChild.prototype = new Parent()\nChild.prototype.constructor = Child\n\nChild.prototype.getAge = function () {\n  return this.Age\n}\nvar people = new Child('lily', 20)\nconsole.log(people.getName())\n```\n\n**语法糖**\n\n```javascript\nclass Parent {\n  construtor(name) {\n    this.name = name\n  }\n  getAge() {\n    return this.age\n  }\n  const people = new Child(\"lily\",20);\n  console.log(people.getName())\n}\n```\n\n## 异步函数\n\n除了 javascript Promise , 异步函数进一步重写了传统的异步代码结构。\n\n### 一个以 async 为前缀的常规函数\n\n```javascript\nasync function fetchdata(url) {}\n```\n\n### 在异步函数（Async function ）内，使用 await 关键字调用异步操作函数\n\n```javascript\nfunction getaSync(url) {\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest()\n    xhr.open('GET', url)\n    xhr.onload = () => resolve(xhr.responseText)\n    xhr.onerror = () => reject(xhr.statusText)\n    xhr.send()\n  })\n}\n\nasync function fetchdata() {\n  var text1 = await getasync('test.txt')\n  console.logtex(text1)\n  var text2 = await getasync('test2.text')\n  console.log(text2)\n  var text3 = await getasync('text3.text')\n  console.log(text3)\n  return 'Finished'\n}\n\nfetchdata().then((msg) => {\n  console.log(msg) //“test.txt”，“test2.txt”，“test3.txt”\n})\n```\n\n在异步函数中，我们把异步函数 getasync() 当做是同步函数，没有 then() 方法或回调函数通知下一步。无论何时遇到关键字 await , 执行都会停止，直到 getasync() 解决，然后再转到异步函数中的下一行。结果与纯粹的基于 Promise , 使用一串 then 方法的方式一样\n\n## 解构\n\nES6 解构并非一个新的功能，而是一个新的复制语法，可以快速解压缩对象属性和数组中的值，并将它们分配给各个变量。\n\n```javascript\nvar profile = { name: 'georage', age: 39, hobby: 'Tennis' }\nvar { name, hobby } = profile\nconsole.log(name) //'georage'\nconsole.log(hobby) //'Tennis'\n```\n\n这里我用解构快速提取 profile 对象的 name 和 hobby 属性。\n\n使用别名，你可以使用与你正在提取值的对象属性不同的变量名：\n\n```javascript\nvar profile = { name: 'georage', age: 39, hobby: 'Tennis' }\nvar { name: n, hobby: h } = profile\nconsole.log(n) //'georage'\nconsole.log(h) //'Tennis'\n```\n\n---\n\n### 嵌套对象解构\n\n解构也可以与嵌套对象一起工作，可以使用它来快速解开来自复杂的 JSON 请求的值。\n\n```javascript\nvar jsondata = {\n  title: 'XX',\n  details: {\n    data: {\n      created: '2017/09/19',\n      modified: '2017/09/20',\n    },\n    catrgory: 'js',\n  },\n  url: '/baidu/',\n}\nvar {\n  title,\n  details: {\n    data: { created, modified },\n  },\n} = jsondata\nconsole.log(title)\nconsole.log(created)\nconsole.log(modified)\n```\n\n---\n\n### 解构数组\n\n数组的解构与对象上的工作方式类似，除了左边的花括号使用**方括号**代替：\n\n```javascript\nvar soccerteam = ['George', 'Dennis', 'Sandy']\nvar [a, b] = soccerteam\nconsole.log(a) // \"George\"\nconsole.log(b) // \"Dennis\"\n```\n\n你可以跳过某些数组元素，通过使用 (,)\n\n```javascript\nvar var soccerteam = ['George', 'Dennis', 'Sandy']\nvar [a,,b] = soccerteam\nconsole.log(a) // \"George\"\nconsole.log(b) // \"Sandy\"\n```\n\n---\n\n### 解构赋值\n\n```javascript\nlet [a, b, c] = [1, 2, 3];\n//定义了三个变量，并对应赋了值；如果值的个数与变量名个数不匹配，没有对应上的变量值为 undefined\n\nlet [a, b, c='default'] = [1, 2];\n//指定默认值，在定义变量时就指定了默认值，如果赋值时，没有给定内容，则会取默认值\n\nlet [a, …b] = [1,2,3];\n//这里 b 的值为[2，3]，这样可以快速使用剩余的数据赋值给变量，\n//但实际使用中为了避免代码阅读的歧义，不推荐这么使用，仅作了解即可\n\nlet [a,b,c] = 'yes';\nconsole.log(a);//y\nconsole.log(b);//e\nconsole.log(c);//s\n```\n\n字符串的结构赋值会以单个字符串的方式进行赋值。\n\n```javascript\nlet { length } = 'yes'\nconsole.log(length) //3\n```\n\n以对象赋值的方法，如果名称是字符串的自带属性，则会获得属性值\n\n```javascript\nlet arr = [1, 2]\nlet obj = { a: 1, b: 2 }\nfunction test({ a = 10, b, c = 10 }) {\n  console.log(arguments) //{ a: 1, b: 2 }\n  console.log(a) //1\n  console.log(b) //2\n  console.log(c) //10\n}\ntest(obj)\n```\n\n## Spread 操作符\n\nspread(...)操作符也称作展开操作符，作用是讲可迭代的对象进行展开\n\n```javascript\nvar fruits = ['apple', 'orange', 'peach']\nvar shoppingList = ['t-shirt', ...fruits, 'egg']\n\n// shoppingList的值：[\"t-shirt\", \"apple\", \"organe\", \"peach\", \"egg\"]\n```\n\nSpread 操作符可以展开 Iterable 的对象，这样的话，除了数组之外，所有实现了 Symbol.iterator 的对象，如：Set, Map 和 Generator 等等，都可以使用 Spread 操作符。\n\n```javascript\nvar map = new Map()\nmap.set('a', 1)\nmap.set('b', 2)\nvar arr1 = [...map] //[[\"a\", 1], [\"b\", 2]]\n\nvar set = new Set()\nset.add(1)\nset.add(2)\nset.add(1)\nset.add(3)\nvar arr2 = [...set] //[1, 2, 3]\n\nfunction* myGen() {\n  yield 'hello'\n  yield 'world'\n}\nvar arr2 = [...myGen()] //[\"hello\", \"world\"]\n```\n\n## 默认和剩余参数\n\n### 默认参数\n\n在这之前我们都使用：\n\n```javascript\nfunction getarea(w, h) {\n  var w = w || 10\n  var h = h || 15\n  return w * h\n}\n```\n\n有了 ES6 对默认参数的支持后\n\n```javascript\nfunction getarea(w = 10, h = 15) {\n  return w * h\n}\ngetarea(5) //75\n```\n\n### 剩余参数 （Rest Parameters）\n\nES6 中的 Rest Parameters 使得将函数参数转换成数组的操作变得简单。\n\n```javascript\nfunction addit(...theNumber) {\n  //get the sum of the array elements\n  return theNumber.reduce((prevnum.curnum) => prevnu + curnum, 0)\n}\naddit(1, 2, 3, 4) //10\n```\n\n通过在命名参数前添加 3 个点。在该位置和之后输入到函数中的参数将自动转换为数组。\n\n没有 Rest Parameters 则会手动将参数转换为数组 :\n\n```javascript\nfunction addit(theNumbers) {\n  // force arguments object into array\n  var numArray = Array.prototype.slice.call(arguments)\n  return numArray.reduce((prevnum, curnum) => prevnum + curnum, 0)\n}\n\naddit(1, 2, 3, 4) // returns 10\n```\n\n```javascript\nfunction f(...[a, b, c]) {\n  return a + b + c\n}\n\nf(1) // NaN (b and c are undefined)\nf(1, 2, 3) // 6\nf(1, 2, 3, 4) //6 (the fourth parameter is not destructured)\n```\n\n## Generator 函数\n\nGenerator 函数是协程在 ES6 的实现，最大特点就是可以交出函数的执行权（即暂停执行）。协程：多个现成互相协作，完成异步任务。\n\n协程有点像函数，又有点想线程。他的运行流程大致如下：\n\n- 第一步，协程 A 开始执行。\n- 第二步，协程执行懂啊一半，进入暂停，执行权转移到协程 B。\n- 第三步，一段时间后协程 B 交换执行权。\n- 第四步，协程 A 恢复执行。\n\n```javascript\nfunction* gen(x) {\n  var y = yield x + 2\n  return y\n}\n```\n\n上面整个代码就是一个封装的异步任务，或者说是异步任务的容器。异步操作需要暂停的地方，都用 yield 语句注明。Generator 函数的执行方法如下。\n\n```javascript\nvar g = gen(1)\ng.next() // { value: 3, done: false }\ng.next() // { value: undefined, done: true }\n```\n\nnext 方法的作用是分阶段执行 Generator 函数。每次调用 next 方法，返回一个对象，表示当前阶段的信息（value 和 done 属性）。value 属性是 yield 语法后面表达式的值。表示当前阶段的值；done 属性是一个布尔值，表示 Generator 函数是否执行完毕，即是否还有下一个阶段。\n\n这是一个生成器的例子：\n\n```javascript\nfunction* genFn() {\n  console.log('begin')\n  var value = yield 'a'\n  console.log(value) // 'B'\n  return 'end'\n}\n\nvar gen = genFn()\nconsole.log(typeof gen) // 'object'\nvar g1 = gen.next()\ng1.value // 'a'\ng1.done // false\nvar g2 = gen.next('B')\ng2.value // 'end'\ng2.done // true\n```\n\n## 字符串扩展\n\n### 字符串内容测试\n\n```javascript\n'abcdef'.includes('c') //true\n'abcdef'.includes('ye') //false\n'abcdef'.startsWith('a') //true\n'abcdef'.endswidth('f') //true\n//includes(), startsWith(), endsWith() 都支持第二个参数，\n//类型为数字类型，意为从第 n 个字符开始，endsWith()的第二个参数有点不一样\n'abcdef'.includes('c', 4) //false 从第5个字符开始查找是否有 'c' 这个字符\n'abcdef'.startsWith('d', 3) //true 从第4个字符开始查找是否是以 'd' 字符为开头\n'abcdef'.endsWith('d', 4) //true 前面的4个字符里，是否以 'd' 字符为结尾\n```\n\n**字符串重复输出：**\n这个方法接受一个整数参数，表示要将字符串复制多少次，然后返回拼接所有副本后的结果\n\n```javascript\n'a'.repeat(5) //aaaaa 重复输出5遍\n```\n\n### 模板字符串(``)\n\n```javascript\nfunction authorize(user, action) {\n  if (!user.hasPrivilege(action)) {\n    throw new Error(`用户 ${user.name} 未被授权执行 ${action} 操作。`)\n  }\n}\n```\n\n在这个示例中，`${user.name}`,`${action}`被称为模板占位符，javascript 将把 user.name 和 action 的值插入到最终生成的字符串中。\n\n```javascript\n$('#warning').html(`\n  <h1>小心！>/h1>\n  <p>未经授权打冰球可能受罚\n  将近${maxPenalty}分钟。</p>\n`)\n```\n\n模板字符串中所有的空格、新进、缩进，都会原样输出在生成的字符串中。\n\n### 原生支持模板语言\n\n```javascript\n//es5\n$('#result').append(\n  'There are <b>' +\n    basket.count +\n    '</b> ' +\n    'items in your basket, ' +\n    '<em>' +\n    basket.onSale +\n    '</em> are on sale!'\n)\n//es6\n//在es6中，内容模板，可以定义在 `` 包起来的字符串中，其中的内容会保持原有格式\n//另外可以在字符串中直接使用模板语言进行变量填充，优雅而简洁\n$('#result').append(`\n  There are <b>${basket.count}</b> items\n   in your basket, <em>${basket.onSale}</em>\n  are on sale!\n`)\n```\n\n### 字符串遍历输出\n\n```javascript\n//for ...of 格式为 es6 中的 Iterator 迭代器的输出方式\nfor (let c of 'abc') {\n  console.log(c)\n}\n//a\n//b\n//c\n```\n\n### 字符串补全\n\n```javascript\n//参数1：[number] 目标字符串长度\n//参数2：[string] 进行补全的字符串\n'12345'.padStart(7, '0') //0012345 - 字符串不足7位，在头部补充不足长度的目标字符串\n'12345'.padEnd(7, '0') //1234500 - 在尾部进行字符串补全\n```\n\n### 字符串迭代与结构\n\n```javascript\nlet message = 'abc'\nlet stringIterator = message[Symbol.iterator]()\nstringIterator.next() //{value:a,done:false}\nstringIterator.next() //{value:b,done:false}\n```\n\n或是用 for of\n\n## 数组扩展\n\n### Array.from()\n\n从一个类似数组或可迭代对象中创建一个新的数组实例。\n\n### 合并数组\n\n```javascript\nlet a = [1, 2]\nlet b = [3]\nlet c = [2, 4]\nlet d = [...a, ...b, ...c] //[1, 2, 3, 2, 4] 所有内容合并，但并不会去除重复\n```\n\n### 快速转换为数组\n\n```javascript\nArray.of(3, 4, 5) //[3,4,5]\n```\n\n### 内容过滤\n\n```javascript\n//判断对象是否为数组\nif(Array.isArray(obj)){...}\n\n[1,2,3].includes(5);//false，检索数据中是否有5\n\n//找出第一个匹配表达式的结果，注意是只要匹配到一项，函数即会返回\nlet a = [1, 3, -4, 10].find(function(value, index, arr){\n  return value < 0;\n});\nconsole.log(a);//-4\n\n//找出第一个匹配表达式的结果下标\nlet a = [1, 3, -4, 10].findIndex(function(value, index, arr){\n  return value < 0;\n});\nconsole.log(a);//2\n\n//排除负数内容\nlet a = [1, 3, -4, 10].filter(function(item){\n  return item > 0;\n});\nconsole.log(a);//[1, 3, 10]\n```\n\n## 对象扩展\n\n### 可计算属性\n\n```javascript\nlet nameKey = 'name'\nlet ageKey = '27'\nlet jobKey = 'job'\nlet person = {\n  [nameKey]: 'matt',\n  [ageKey]: 27,\n  [jobKey]: 'software engineer',\n}\n```\n\n可变 key 是在申明时进行值赋值，而不是地址赋值，就算使用对象作为 key 值，key 值在之后也不是可变的\n\n### 属性的简洁表示\n\n```javascript\n//直接使用变量/常量的名称个为对象属性的名称\nlet a = 'abc'\nlet b = { a } //{a: 'abc'}\n\nfunction f(x, y) {\n  return { x, y }\n}\n//等效于\nfunction f(x, y) {\n  return { x: x, y: y }\n}\n\nlet o = {\n  f() {\n    return 1\n  },\n}\n//等效于\nlet o = {\n  f: function () {\n    return 1\n  },\n}\n```\n\n### 对象内容合并\n\n```javascript\nlet a = { a: 1, b: 2 },\n  b = { b: 3 },\n  c = { b: 4, c: 5 }\nlet d = Object.assign(a, b, c)\nconsole.log(d) //{a:1,b:4,c:5}\nconsole.log(a) //{a:1,b:4}\n//上面的合并方式会同时更新 a 对象的内容，a 的属性如果有多次合并会被更新数据，\n//但自身没有的属性，其它对象有的属性不会被添加到 a 身上；\n//参数列中的对象只会影响第一个，后面的参数对象不会被修改数据\n\n//推荐使用这种方式进行对象数据合并\nlet a = { a: 1, b: 2 },\n  b = { b: 3 },\n  c = { b: 4, c: 5 }\nlet d = Object.assign({}, a, b, c) //第一个参数增加一个空对象，在合并时让它被更新，不影响实际的对象变量内容\nconsole.log(d) //{a:1,b:4,c:5}//与上面的方式合并结果一致，使用这种方式, a 对象的内容就不会被影响了\n```\n\n对象内容合并的方向是从参数顺序的后向前合并\n\n### 对象内容集合\n\n#### Object.keys()\n\n获取对象中所有的键名，以数组的形式返回\n\n```javascript\nvar obj = { a: 1, b: 2 }\nvar name = Object.keys(obj) //['a','b,]\n```\n\n#### Object.values()\n\n获取对象中所有值内容，以数组的形式返回\n\n```javascript\nvar obj = { a: 1, b: 2 }\nvar values = Object.values(obj) //[1,2]\n```\n\n#### Object.entries()\n\n获得对象中所有成员的数据，以数组的形式返回，成员的内容也是数组形式\n\n```javascript\nvar obj = { a: 1, b: 2 }\nvar values = Object.entries(obj) //[['a',1],['b',2]]\n```\n\n#### 对象内容测试\n\n```javascript\n//判断对象是否为数组对象\nif (Object.isArray(someobj)) {\n}\n//判断目标对象是否为空对象\nif (someobj && Object.keys(someobj).length);\n```\n\n### Map\n\nMap 的用法和普通对象基本一致，但是主要差异是，Map 实例会维护键值对的插入顺序，因此可以根据插入顺序执行迭代操作。\n\n对象和映射之间存在着显著的内存和性能问题：\n\n- 在给定固定大小的内存时，Map 大约可以比 Object 多存储 50% 的键/值对。\n- Map 在所有的浏览器中一般会比 Object 的插入速度快\n- 从大型 Object 和 Map 中查找键/值对，则 Object 有时候速度会更快。在把 Object 当成数组使用的情况下（比如使用连续整数作为属性），浏览器引擎可以进行优化，在内存中使用更高效的布局。对于这两个类型而言，查找书读不会随着键/值对数量增加而现行增加，如果代码设计大量查找操作，那么某些情况下可能选 Object 更好\n- Object 的 delete 性能很差，在现在很多浏览器依然如此，Map 的 delete 操作都比插入和查找更快，如果代码涉及大量删除操作，那么毫无以为应该选择 map\n\n(思考：vue 中的 data 数据使用 Map 是什么样的呢？)\n\n先看一下它能用非法字符串或者数字作为 key 的特性。\n\n```javascript\nconst map = Map()\nconst obj = { p: 'hellow' }\nmap.set(obj, 'ok') //ok\nconsole.log(obj) //{ p: 'hellow' }\nmap.get(obj) //ok\nmap.has(obj) //true\nmap.delete(obj) //true\nmap.has(obj) //false\n```\n\n需要使用 new Map()初始化一个实例。\n\n- size:获取成员数量\n- set:设置成员 key 和 value\n- get:获取成员属性值\n- has:判断成员是否存在\n- delete:删除成员\n- clear:清空所有\n- keys():返回键名的遍历器\n- values():返回键值的遍历器\n- entries():返回所有成员的遍历器\n- forEach():遍历 Map 的所有成员\n\n### set 对象 （可用于去重）\n\nset 独享允许你存储任何类型唯一值，无论是原始值或是对象。NaN 之间视为相同的值。\n\n```javascript\nconst set1 = new Set([1, 1, 2, NaN, NaN, 5])\n\nconsole.log(set1.has(1)) // expected output: true\n\nconsole.log(set1.has(5)) // expected output: true\n\nconsole.log(set1.has(6)) // expected output:false\n\nconsole.log(Array.from(set1)) // Array [1, 2, 3, 4, NaN, 5]\n```\n\n### 定型数组\n\n所谓定型数组，就是将任何数字转换成一个包含数字比特的数组，随后就可以通过 JS 数组进一步处理\n\n在 JavaScript 中，数字类型变量都是以 64 位浮点型数据格式存储；比如新建一个只需要 8 比特的整数，也需要为其开辟 64 位存储空间，浪费资源，效率也低。而 CanvasFloatArray 需要的是 Float32Array\n\n所有与定型数组有关的操作和对象都集中在这 8 个数据类型上，但是在使用他们之前，需要穿件一个数组缓冲区存储这些数据\n\n数据缓冲区是所有定型数组的根基，它是一段可以包含特定数量字节的内存地址。\n\n## isInteger 与安全整数\n\nisInteger 用于判断一个数值是否为整数。\n\n```javascript\nconsole.log(Number.isInteger(1)) //  true\nconsole.log(Number.isInteger(1.0)) //true\nconsole.log(Nmber.isInteger(1.01)) //false\n```\n\n为了鉴别整数是否在安全范围科研使用 Number.isSafeInteger()方法\n\n## 生成器\n\n```javascript\nfunction* generatorFn() {\n  yield 'foo'\n  yield 'bar'\n  return 'baz'\n}\nlet generatorObject1 = generatorFn()\nlet generatorObject2 = generatorFn()\nconsole.log(generatorObject1.next()) //{done:false,value:'foo'}\nconsole.log(generatorObject2.next()) //{done:false,value:'foo'}\nconsole.log(generatorObject2.next()) //{done:false,value:'bar'}\nconsole.log(generatorObject1.next()) //{done:false,value:'bar'}\n```\n\n**也可以用 for of 对 generatorObject1 进行迭代，那这个可以结合 promise 使用吗？是可以的，就是用 yield 实现了 await**。async 和 await，比起星号和 yield，语义更清楚了。async 表示函数里有异步操作，await 表示紧跟在后面的表达式需要等待结果。co 函数库约定，yield 命令后面只能是 Thunk 函数或 Promise 对象，而 async 函数的 await 命令后面，可以跟 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。\n\n### 使用 yield\\* 实现递归算法\n\nyield\\* 表达式迭代操作数，并产生它返回的每个值\n\nyield\\* 表达式本身的值是当迭代器关闭时返回的值（即 done 为 true）时\n\nyield\\*最有用的地方是实现递归操作，此时生成器可以产生自身：\n\n```javascript\nfunction* nTimes(n) {\n  if (n > 0) {\n    yield* nTimes(n - 1)\n    yield n - 1\n  }\n}\n\nfor (const x of nTimes(3)) {\n  console.log(x)\n}\n//0\n//1\n//2\n```\n\n## 箭头函数\n\n**箭头函数不能作为构造函数**：\n\n箭头函数没有自己的 this,arguments,super 或 new.target。箭头函数表达式更实用于那些需要匿名函数的地方，并且它不能用作构造函数，和 new 一起用会抛出错误，箭头函数没有 prototype 属性。\n\n箭头函数是有*proto*属性的，所以箭头函数本身是存在原型链的，他也是有自己的构造函数的，但是因为没有 prototype 属性，他的实例*proto*没法指向，所以箭头函数也就无法作为构造函数。\n\n同时箭头函数由于没有 this 指针，通过 call()和 apply 方法调用一个函数时，只能传递参数，不能绑定 this。\n","source":"_posts/JS原生-ES6.md","raw":"---\ntitle: JS原生-ES6\ndate: 2018-01-24 10:51:11\ncategories: JavaScript\n---\n\n发现自己对于 javascript 的底层 API 所知甚少，在这里记录一下所遇到的有趣又实在的 API 用法。\n\nES6 的更新内容主要分为以下几点\n\n- 表达式：声明、解构赋值\n- 内置对象：字符串扩展、数值扩展、对象扩展、数组扩展、函数扩展、正则扩展、Symbol、Set、Map、Proxy、Reflect\n- 语句与运算：Class、Module、lterator(迭代)\n- 异步编程：Promise、Generator、Async\n\n<!--more-->\n\n## var 与 let 的区别\n\n使用 var 关键字来声明变量，会出现重复声明导致变量被覆盖不会报错的问题；\n在 ES6 中引入了 let 来解决 var 关键字带来的潜在问题，若是重复声明则会在控制台报错。\n\n## `Symbol`数据类型\n\n`Symbol`是通过`Symbol`函数生成的，凡是属性名属于`symbol`类型，就都是独一无二的，可以保证不会与其他属性名冲突。\n\n### 使用 Symbol 来作为唯一标志\n\n```javascript\nconst PROP_NAME = Symbol() //解救无意义的赋值\nconst PROP_AGE = Symbol()\n\nlet obj = {\n  [PROP_NAME]: '一斤代码', //对象key值或是常量使用，原理相同\n}\nobj[PROP_AGE] = 18\n\nobj[PROP_NAME] // '一斤代码'\nobj[PROP_AGE] // 18\n```\n\n### 使用 Symbol 定义类的私有属性\n\n在 JS 中是没有私有变量的，雷伤所有定义的属性或是方法都是公开访问的。因此可能存在污染等情况，而有了 Symbol 以及模块化机制，类的私有属性和方法才能变成可能。\n\n在文件 a.js 中\n\n```javascript\nconst PASSWORD = Symbol()\n\nclass Login {\n  constructor(username, password) {\n    this.username = username\n    this[PASSWORD] = password\n  }\n\n  checkPassword(pwd) {\n    return this[PASSWORD] === pwd\n  }\n}\n\nexport default Login\n```\n\n在文件 b.js 中\n\n```javascript\nimport Login from './a'\n\nconst login = new Login('admin', '123456')\n\nlogin.checkPassword('admin') // true\n\nlogin.PASSWORD // oh!no!\nlogin[PASSWORD] // oh!no!\nlogin['PASSWORD'] // oh!no!\n```\n\n由于 Symbol 常量 PASSWORD 被定义在 a.js 所在的模块中，外面的模块获取不到这个 Symbol,也不可能在创建一个一个一样的 Symbol 出来，所以这个 PASSWORD 只能被限制在 a.js 内部使用，达到一个私有化的效果\n\n### 注册和获取全局 Symbol\n\nSymbol 在不同 window 中创建的 Symbol 实例总是唯一的，如果应用涉及到多个 window（ifram），并需要这些 window 使用的是同一个，那就不能使用 Symbol()了（若是微前端里面又是什么样的呢？有时间试试），这时可以使用 Symbol.for()，它来注册或获取一个 window 间全局的 Symbol 实例：\n\n```javascript\nlet gs1 = Symbol.for('global_symbol_1') //注册一个全局Symbol\nlet gs2 = Symbol.for('global_symbol_1') //获取全局Symbol\n\ngs1 === gs2 // true\n```\n\n这时，在多个相关 window 间也是唯一的。\n\n### Symbol.iterator\n\n在 Symbol.iterator 出现后，JS 可以定义自己的迭代器\niterator 模式总是用同一种逻辑来遍历集合\n\n```javascript\nfor(Iterator it = c.iterater(); it.hasNext(); ) { ... }\n//这样就在一定程度上解决了不同的数据类型需要不同的遍历方法\n```\n\n```javascript\nlet students = {\n  [Symbol.iterator]: function* () {\n    for (var i = 0; i <= 100; i++) {\n      yield i\n    }\n  },\n}\nfor (var s of students) {\n  console.log(s)\n}\n//这个yield其实最后返回的就是iterator函数\n```\n\n## yield\n\nyield 关键字用来暂停和恢复一个生成器函数.yield 关键字只能在生成器函数内部使用，用在其他地方会抛出错误。类似函数的 return 关键字，yield 关键字必须直接位于生成器函数定义中，出现在嵌套的非生成器函数中会抛出语法错误\n\nyield 关键字实际返回一个 IteratorResult 对象，它有两个属性，value 和 done。value 属性是对 yield 表达式求值的结果，而 done 是 false，表示生成器函数尚未完全完成。\n\n```javascript\nfunction* countAppleSales() {\n  var saleList = [3, 7, 5]\n  for (var i = 0; i < saleList.length; i++) {\n    yield saleList[i]\n  }\n}\n//一旦生成器函数已定义，可以通过一个构造一个迭代器来使用它\n\nvar appleStore = countAppleSales() // Generator { }\nconsole.log(appleStore.next()) // { value: 3, done: false }\nconsole.log(appleStore.next()) // { value: 7, done: false }\nconsole.log(appleStore.next()) // { value: 5, done: false }\nconsole.log(appleStore.next()) // { value: undefined, done: true }\n```\n\n## 类 class\n\n面向对象编程中的一个核心概念就是类（多态、封装、继承）。可以把事物都抽象成一个个的类来描述他们的信息和行为。\n\nJavaScript 是一个基于对象的语言，而不是面对对象的语言，它是一个基于 prototype 的语言。它的语法中没有像 Java 之类典型面向对象语言中定义一个类的语法，因此在 ES6 中，提供了一个面向对象风格的类定义方式：使用 class 关键字。\n\n类里面所有的方法都定义在类的 prototype 上面\n\n**注意：类必须使用 new 调用，否则会报错。这是它和普通函数的一个主要区别，后者不用 new 也可以执行**\n\n```javascript\nclass Person {\n  constructor(name, age) {\n    this.name = name\n    this.age = age\n  }\n\n  walk() {\n    console.log(\"I'm walking...\")\n  }\n\n  static create(name, age) {\n    //定义静态方法\n    return new Person(name, age)\n  }\n}\n```\n\n### constructor\n\n- 是类的默认方法，通过 new 命令生成对象实例时，自动调用该方法，一个类必须有 constructor 方法，如果没有显示定义，一个空的 constructor 方法会被默认添加\n- 执行这个 constructor 方法默认返回实例对象（this）\n### 类的 prototype 属性\n\n类的所有方法都定义在类的 prototype 属性上面\n\n```javascript\nclass Point {\n  constructor() {}\n  toString() {}\n}\n\n//等同于\nPoint.prototype = {\n  constructor(){},\n  toString()\n}\n```\n\n### class 的静态方法\n\n如果在一个方法前，加上 static 关键字，就表示该方法不会被实例继承，而是直接通过类来调用，就是称为“静态方法”\n\n**注意：如果静态方法包含 this 关键字，这个 this 指向的是类，而不是实例**\n\n```javascript\nclass Foo {\n  static classMethod() {\n    return 'hello'\n  }\n}\n\nFoo.classMethod() // 'hello'\n\nvar foo = new Foo()\nfoo.classMethod()\n```\n### super\n\nsuper 关键字用于访问和调用一个对象的父对象的函数。( 只能在 class 内部用 )\n\n在构造函数中使用时，super 关键字将单独出现，并且必须在使用 this 之前使用。\n\nsuper 关键字也可以用来调用父对象上的函数。\n\n```javascript\nsuper([arguments])\n// 调用 父对象/父类 的构造函数\n\nsuper.functionOnParent([arguments])\n// 调用 父对象/父类 上的方法\n```\n\n```javascript\nclass Polygon {\n  construector(height, width) {\n    this.name = 'Polygon'\n    this.height = height\n    this.width = width\n  }\n  sayName() {\n    console.log('Hi,I am a', this.name + '.')\n  }\n  class Square extends Polygon{\n    constructor(length){\n      this.height;\n      // ReferenceError ,super 需要先被调用！\n\n      /*\n       这里，它调用父类的构造函数的length,\n       作为Polygon 的 width 和 height\n       */\n       super(length,length)\n       /*\n       注意，在派生的类中，在你可以使用this之前，必须 先调用super()。忽略这，这将导致引用错误。\n       */\n       this.name = 'Square'\n    }\n    get area(){\n      return this.height * this.width\n    }\n    set area(value){\n      this.area = value\n    }\n  }\n}\n```\n\n**使用 super 调用父类的静态方法。**\n\n```javascript\nclass Human{}\n  constructor(){}\n    static ping(){\n      return 'ping'\n  }\n}\n\nclass computer eatends Human{ //使用extend 实现继承另一个类\n  constructor(){}\n  static pingpong(){\n    return super.ping()+'pong'\n  }\n}\n\nComputer.pingpong()\n```\n\n**原始 class 实现方式**\n\n```javascript\nfunction Parent(name) {\n  this.name = name\n}\nParent.prototype.getName = function () {\n  return this.name\n}\nfunction Child(name, age) {\n  Parent.call(this, name)\n  this.age = age\n}\n//实现继承\nChild.prototype = new Parent()\nChild.prototype.constructor = Child\n\nChild.prototype.getAge = function () {\n  return this.Age\n}\nvar people = new Child('lily', 20)\nconsole.log(people.getName())\n```\n\n**语法糖**\n\n```javascript\nclass Parent {\n  construtor(name) {\n    this.name = name\n  }\n  getAge() {\n    return this.age\n  }\n  const people = new Child(\"lily\",20);\n  console.log(people.getName())\n}\n```\n\n## 异步函数\n\n除了 javascript Promise , 异步函数进一步重写了传统的异步代码结构。\n\n### 一个以 async 为前缀的常规函数\n\n```javascript\nasync function fetchdata(url) {}\n```\n\n### 在异步函数（Async function ）内，使用 await 关键字调用异步操作函数\n\n```javascript\nfunction getaSync(url) {\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest()\n    xhr.open('GET', url)\n    xhr.onload = () => resolve(xhr.responseText)\n    xhr.onerror = () => reject(xhr.statusText)\n    xhr.send()\n  })\n}\n\nasync function fetchdata() {\n  var text1 = await getasync('test.txt')\n  console.logtex(text1)\n  var text2 = await getasync('test2.text')\n  console.log(text2)\n  var text3 = await getasync('text3.text')\n  console.log(text3)\n  return 'Finished'\n}\n\nfetchdata().then((msg) => {\n  console.log(msg) //“test.txt”，“test2.txt”，“test3.txt”\n})\n```\n\n在异步函数中，我们把异步函数 getasync() 当做是同步函数，没有 then() 方法或回调函数通知下一步。无论何时遇到关键字 await , 执行都会停止，直到 getasync() 解决，然后再转到异步函数中的下一行。结果与纯粹的基于 Promise , 使用一串 then 方法的方式一样\n\n## 解构\n\nES6 解构并非一个新的功能，而是一个新的复制语法，可以快速解压缩对象属性和数组中的值，并将它们分配给各个变量。\n\n```javascript\nvar profile = { name: 'georage', age: 39, hobby: 'Tennis' }\nvar { name, hobby } = profile\nconsole.log(name) //'georage'\nconsole.log(hobby) //'Tennis'\n```\n\n这里我用解构快速提取 profile 对象的 name 和 hobby 属性。\n\n使用别名，你可以使用与你正在提取值的对象属性不同的变量名：\n\n```javascript\nvar profile = { name: 'georage', age: 39, hobby: 'Tennis' }\nvar { name: n, hobby: h } = profile\nconsole.log(n) //'georage'\nconsole.log(h) //'Tennis'\n```\n\n---\n\n### 嵌套对象解构\n\n解构也可以与嵌套对象一起工作，可以使用它来快速解开来自复杂的 JSON 请求的值。\n\n```javascript\nvar jsondata = {\n  title: 'XX',\n  details: {\n    data: {\n      created: '2017/09/19',\n      modified: '2017/09/20',\n    },\n    catrgory: 'js',\n  },\n  url: '/baidu/',\n}\nvar {\n  title,\n  details: {\n    data: { created, modified },\n  },\n} = jsondata\nconsole.log(title)\nconsole.log(created)\nconsole.log(modified)\n```\n\n---\n\n### 解构数组\n\n数组的解构与对象上的工作方式类似，除了左边的花括号使用**方括号**代替：\n\n```javascript\nvar soccerteam = ['George', 'Dennis', 'Sandy']\nvar [a, b] = soccerteam\nconsole.log(a) // \"George\"\nconsole.log(b) // \"Dennis\"\n```\n\n你可以跳过某些数组元素，通过使用 (,)\n\n```javascript\nvar var soccerteam = ['George', 'Dennis', 'Sandy']\nvar [a,,b] = soccerteam\nconsole.log(a) // \"George\"\nconsole.log(b) // \"Sandy\"\n```\n\n---\n\n### 解构赋值\n\n```javascript\nlet [a, b, c] = [1, 2, 3];\n//定义了三个变量，并对应赋了值；如果值的个数与变量名个数不匹配，没有对应上的变量值为 undefined\n\nlet [a, b, c='default'] = [1, 2];\n//指定默认值，在定义变量时就指定了默认值，如果赋值时，没有给定内容，则会取默认值\n\nlet [a, …b] = [1,2,3];\n//这里 b 的值为[2，3]，这样可以快速使用剩余的数据赋值给变量，\n//但实际使用中为了避免代码阅读的歧义，不推荐这么使用，仅作了解即可\n\nlet [a,b,c] = 'yes';\nconsole.log(a);//y\nconsole.log(b);//e\nconsole.log(c);//s\n```\n\n字符串的结构赋值会以单个字符串的方式进行赋值。\n\n```javascript\nlet { length } = 'yes'\nconsole.log(length) //3\n```\n\n以对象赋值的方法，如果名称是字符串的自带属性，则会获得属性值\n\n```javascript\nlet arr = [1, 2]\nlet obj = { a: 1, b: 2 }\nfunction test({ a = 10, b, c = 10 }) {\n  console.log(arguments) //{ a: 1, b: 2 }\n  console.log(a) //1\n  console.log(b) //2\n  console.log(c) //10\n}\ntest(obj)\n```\n\n## Spread 操作符\n\nspread(...)操作符也称作展开操作符，作用是讲可迭代的对象进行展开\n\n```javascript\nvar fruits = ['apple', 'orange', 'peach']\nvar shoppingList = ['t-shirt', ...fruits, 'egg']\n\n// shoppingList的值：[\"t-shirt\", \"apple\", \"organe\", \"peach\", \"egg\"]\n```\n\nSpread 操作符可以展开 Iterable 的对象，这样的话，除了数组之外，所有实现了 Symbol.iterator 的对象，如：Set, Map 和 Generator 等等，都可以使用 Spread 操作符。\n\n```javascript\nvar map = new Map()\nmap.set('a', 1)\nmap.set('b', 2)\nvar arr1 = [...map] //[[\"a\", 1], [\"b\", 2]]\n\nvar set = new Set()\nset.add(1)\nset.add(2)\nset.add(1)\nset.add(3)\nvar arr2 = [...set] //[1, 2, 3]\n\nfunction* myGen() {\n  yield 'hello'\n  yield 'world'\n}\nvar arr2 = [...myGen()] //[\"hello\", \"world\"]\n```\n\n## 默认和剩余参数\n\n### 默认参数\n\n在这之前我们都使用：\n\n```javascript\nfunction getarea(w, h) {\n  var w = w || 10\n  var h = h || 15\n  return w * h\n}\n```\n\n有了 ES6 对默认参数的支持后\n\n```javascript\nfunction getarea(w = 10, h = 15) {\n  return w * h\n}\ngetarea(5) //75\n```\n\n### 剩余参数 （Rest Parameters）\n\nES6 中的 Rest Parameters 使得将函数参数转换成数组的操作变得简单。\n\n```javascript\nfunction addit(...theNumber) {\n  //get the sum of the array elements\n  return theNumber.reduce((prevnum.curnum) => prevnu + curnum, 0)\n}\naddit(1, 2, 3, 4) //10\n```\n\n通过在命名参数前添加 3 个点。在该位置和之后输入到函数中的参数将自动转换为数组。\n\n没有 Rest Parameters 则会手动将参数转换为数组 :\n\n```javascript\nfunction addit(theNumbers) {\n  // force arguments object into array\n  var numArray = Array.prototype.slice.call(arguments)\n  return numArray.reduce((prevnum, curnum) => prevnum + curnum, 0)\n}\n\naddit(1, 2, 3, 4) // returns 10\n```\n\n```javascript\nfunction f(...[a, b, c]) {\n  return a + b + c\n}\n\nf(1) // NaN (b and c are undefined)\nf(1, 2, 3) // 6\nf(1, 2, 3, 4) //6 (the fourth parameter is not destructured)\n```\n\n## Generator 函数\n\nGenerator 函数是协程在 ES6 的实现，最大特点就是可以交出函数的执行权（即暂停执行）。协程：多个现成互相协作，完成异步任务。\n\n协程有点像函数，又有点想线程。他的运行流程大致如下：\n\n- 第一步，协程 A 开始执行。\n- 第二步，协程执行懂啊一半，进入暂停，执行权转移到协程 B。\n- 第三步，一段时间后协程 B 交换执行权。\n- 第四步，协程 A 恢复执行。\n\n```javascript\nfunction* gen(x) {\n  var y = yield x + 2\n  return y\n}\n```\n\n上面整个代码就是一个封装的异步任务，或者说是异步任务的容器。异步操作需要暂停的地方，都用 yield 语句注明。Generator 函数的执行方法如下。\n\n```javascript\nvar g = gen(1)\ng.next() // { value: 3, done: false }\ng.next() // { value: undefined, done: true }\n```\n\nnext 方法的作用是分阶段执行 Generator 函数。每次调用 next 方法，返回一个对象，表示当前阶段的信息（value 和 done 属性）。value 属性是 yield 语法后面表达式的值。表示当前阶段的值；done 属性是一个布尔值，表示 Generator 函数是否执行完毕，即是否还有下一个阶段。\n\n这是一个生成器的例子：\n\n```javascript\nfunction* genFn() {\n  console.log('begin')\n  var value = yield 'a'\n  console.log(value) // 'B'\n  return 'end'\n}\n\nvar gen = genFn()\nconsole.log(typeof gen) // 'object'\nvar g1 = gen.next()\ng1.value // 'a'\ng1.done // false\nvar g2 = gen.next('B')\ng2.value // 'end'\ng2.done // true\n```\n\n## 字符串扩展\n\n### 字符串内容测试\n\n```javascript\n'abcdef'.includes('c') //true\n'abcdef'.includes('ye') //false\n'abcdef'.startsWith('a') //true\n'abcdef'.endswidth('f') //true\n//includes(), startsWith(), endsWith() 都支持第二个参数，\n//类型为数字类型，意为从第 n 个字符开始，endsWith()的第二个参数有点不一样\n'abcdef'.includes('c', 4) //false 从第5个字符开始查找是否有 'c' 这个字符\n'abcdef'.startsWith('d', 3) //true 从第4个字符开始查找是否是以 'd' 字符为开头\n'abcdef'.endsWith('d', 4) //true 前面的4个字符里，是否以 'd' 字符为结尾\n```\n\n**字符串重复输出：**\n这个方法接受一个整数参数，表示要将字符串复制多少次，然后返回拼接所有副本后的结果\n\n```javascript\n'a'.repeat(5) //aaaaa 重复输出5遍\n```\n\n### 模板字符串(``)\n\n```javascript\nfunction authorize(user, action) {\n  if (!user.hasPrivilege(action)) {\n    throw new Error(`用户 ${user.name} 未被授权执行 ${action} 操作。`)\n  }\n}\n```\n\n在这个示例中，`${user.name}`,`${action}`被称为模板占位符，javascript 将把 user.name 和 action 的值插入到最终生成的字符串中。\n\n```javascript\n$('#warning').html(`\n  <h1>小心！>/h1>\n  <p>未经授权打冰球可能受罚\n  将近${maxPenalty}分钟。</p>\n`)\n```\n\n模板字符串中所有的空格、新进、缩进，都会原样输出在生成的字符串中。\n\n### 原生支持模板语言\n\n```javascript\n//es5\n$('#result').append(\n  'There are <b>' +\n    basket.count +\n    '</b> ' +\n    'items in your basket, ' +\n    '<em>' +\n    basket.onSale +\n    '</em> are on sale!'\n)\n//es6\n//在es6中，内容模板，可以定义在 `` 包起来的字符串中，其中的内容会保持原有格式\n//另外可以在字符串中直接使用模板语言进行变量填充，优雅而简洁\n$('#result').append(`\n  There are <b>${basket.count}</b> items\n   in your basket, <em>${basket.onSale}</em>\n  are on sale!\n`)\n```\n\n### 字符串遍历输出\n\n```javascript\n//for ...of 格式为 es6 中的 Iterator 迭代器的输出方式\nfor (let c of 'abc') {\n  console.log(c)\n}\n//a\n//b\n//c\n```\n\n### 字符串补全\n\n```javascript\n//参数1：[number] 目标字符串长度\n//参数2：[string] 进行补全的字符串\n'12345'.padStart(7, '0') //0012345 - 字符串不足7位，在头部补充不足长度的目标字符串\n'12345'.padEnd(7, '0') //1234500 - 在尾部进行字符串补全\n```\n\n### 字符串迭代与结构\n\n```javascript\nlet message = 'abc'\nlet stringIterator = message[Symbol.iterator]()\nstringIterator.next() //{value:a,done:false}\nstringIterator.next() //{value:b,done:false}\n```\n\n或是用 for of\n\n## 数组扩展\n\n### Array.from()\n\n从一个类似数组或可迭代对象中创建一个新的数组实例。\n\n### 合并数组\n\n```javascript\nlet a = [1, 2]\nlet b = [3]\nlet c = [2, 4]\nlet d = [...a, ...b, ...c] //[1, 2, 3, 2, 4] 所有内容合并，但并不会去除重复\n```\n\n### 快速转换为数组\n\n```javascript\nArray.of(3, 4, 5) //[3,4,5]\n```\n\n### 内容过滤\n\n```javascript\n//判断对象是否为数组\nif(Array.isArray(obj)){...}\n\n[1,2,3].includes(5);//false，检索数据中是否有5\n\n//找出第一个匹配表达式的结果，注意是只要匹配到一项，函数即会返回\nlet a = [1, 3, -4, 10].find(function(value, index, arr){\n  return value < 0;\n});\nconsole.log(a);//-4\n\n//找出第一个匹配表达式的结果下标\nlet a = [1, 3, -4, 10].findIndex(function(value, index, arr){\n  return value < 0;\n});\nconsole.log(a);//2\n\n//排除负数内容\nlet a = [1, 3, -4, 10].filter(function(item){\n  return item > 0;\n});\nconsole.log(a);//[1, 3, 10]\n```\n\n## 对象扩展\n\n### 可计算属性\n\n```javascript\nlet nameKey = 'name'\nlet ageKey = '27'\nlet jobKey = 'job'\nlet person = {\n  [nameKey]: 'matt',\n  [ageKey]: 27,\n  [jobKey]: 'software engineer',\n}\n```\n\n可变 key 是在申明时进行值赋值，而不是地址赋值，就算使用对象作为 key 值，key 值在之后也不是可变的\n\n### 属性的简洁表示\n\n```javascript\n//直接使用变量/常量的名称个为对象属性的名称\nlet a = 'abc'\nlet b = { a } //{a: 'abc'}\n\nfunction f(x, y) {\n  return { x, y }\n}\n//等效于\nfunction f(x, y) {\n  return { x: x, y: y }\n}\n\nlet o = {\n  f() {\n    return 1\n  },\n}\n//等效于\nlet o = {\n  f: function () {\n    return 1\n  },\n}\n```\n\n### 对象内容合并\n\n```javascript\nlet a = { a: 1, b: 2 },\n  b = { b: 3 },\n  c = { b: 4, c: 5 }\nlet d = Object.assign(a, b, c)\nconsole.log(d) //{a:1,b:4,c:5}\nconsole.log(a) //{a:1,b:4}\n//上面的合并方式会同时更新 a 对象的内容，a 的属性如果有多次合并会被更新数据，\n//但自身没有的属性，其它对象有的属性不会被添加到 a 身上；\n//参数列中的对象只会影响第一个，后面的参数对象不会被修改数据\n\n//推荐使用这种方式进行对象数据合并\nlet a = { a: 1, b: 2 },\n  b = { b: 3 },\n  c = { b: 4, c: 5 }\nlet d = Object.assign({}, a, b, c) //第一个参数增加一个空对象，在合并时让它被更新，不影响实际的对象变量内容\nconsole.log(d) //{a:1,b:4,c:5}//与上面的方式合并结果一致，使用这种方式, a 对象的内容就不会被影响了\n```\n\n对象内容合并的方向是从参数顺序的后向前合并\n\n### 对象内容集合\n\n#### Object.keys()\n\n获取对象中所有的键名，以数组的形式返回\n\n```javascript\nvar obj = { a: 1, b: 2 }\nvar name = Object.keys(obj) //['a','b,]\n```\n\n#### Object.values()\n\n获取对象中所有值内容，以数组的形式返回\n\n```javascript\nvar obj = { a: 1, b: 2 }\nvar values = Object.values(obj) //[1,2]\n```\n\n#### Object.entries()\n\n获得对象中所有成员的数据，以数组的形式返回，成员的内容也是数组形式\n\n```javascript\nvar obj = { a: 1, b: 2 }\nvar values = Object.entries(obj) //[['a',1],['b',2]]\n```\n\n#### 对象内容测试\n\n```javascript\n//判断对象是否为数组对象\nif (Object.isArray(someobj)) {\n}\n//判断目标对象是否为空对象\nif (someobj && Object.keys(someobj).length);\n```\n\n### Map\n\nMap 的用法和普通对象基本一致，但是主要差异是，Map 实例会维护键值对的插入顺序，因此可以根据插入顺序执行迭代操作。\n\n对象和映射之间存在着显著的内存和性能问题：\n\n- 在给定固定大小的内存时，Map 大约可以比 Object 多存储 50% 的键/值对。\n- Map 在所有的浏览器中一般会比 Object 的插入速度快\n- 从大型 Object 和 Map 中查找键/值对，则 Object 有时候速度会更快。在把 Object 当成数组使用的情况下（比如使用连续整数作为属性），浏览器引擎可以进行优化，在内存中使用更高效的布局。对于这两个类型而言，查找书读不会随着键/值对数量增加而现行增加，如果代码设计大量查找操作，那么某些情况下可能选 Object 更好\n- Object 的 delete 性能很差，在现在很多浏览器依然如此，Map 的 delete 操作都比插入和查找更快，如果代码涉及大量删除操作，那么毫无以为应该选择 map\n\n(思考：vue 中的 data 数据使用 Map 是什么样的呢？)\n\n先看一下它能用非法字符串或者数字作为 key 的特性。\n\n```javascript\nconst map = Map()\nconst obj = { p: 'hellow' }\nmap.set(obj, 'ok') //ok\nconsole.log(obj) //{ p: 'hellow' }\nmap.get(obj) //ok\nmap.has(obj) //true\nmap.delete(obj) //true\nmap.has(obj) //false\n```\n\n需要使用 new Map()初始化一个实例。\n\n- size:获取成员数量\n- set:设置成员 key 和 value\n- get:获取成员属性值\n- has:判断成员是否存在\n- delete:删除成员\n- clear:清空所有\n- keys():返回键名的遍历器\n- values():返回键值的遍历器\n- entries():返回所有成员的遍历器\n- forEach():遍历 Map 的所有成员\n\n### set 对象 （可用于去重）\n\nset 独享允许你存储任何类型唯一值，无论是原始值或是对象。NaN 之间视为相同的值。\n\n```javascript\nconst set1 = new Set([1, 1, 2, NaN, NaN, 5])\n\nconsole.log(set1.has(1)) // expected output: true\n\nconsole.log(set1.has(5)) // expected output: true\n\nconsole.log(set1.has(6)) // expected output:false\n\nconsole.log(Array.from(set1)) // Array [1, 2, 3, 4, NaN, 5]\n```\n\n### 定型数组\n\n所谓定型数组，就是将任何数字转换成一个包含数字比特的数组，随后就可以通过 JS 数组进一步处理\n\n在 JavaScript 中，数字类型变量都是以 64 位浮点型数据格式存储；比如新建一个只需要 8 比特的整数，也需要为其开辟 64 位存储空间，浪费资源，效率也低。而 CanvasFloatArray 需要的是 Float32Array\n\n所有与定型数组有关的操作和对象都集中在这 8 个数据类型上，但是在使用他们之前，需要穿件一个数组缓冲区存储这些数据\n\n数据缓冲区是所有定型数组的根基，它是一段可以包含特定数量字节的内存地址。\n\n## isInteger 与安全整数\n\nisInteger 用于判断一个数值是否为整数。\n\n```javascript\nconsole.log(Number.isInteger(1)) //  true\nconsole.log(Number.isInteger(1.0)) //true\nconsole.log(Nmber.isInteger(1.01)) //false\n```\n\n为了鉴别整数是否在安全范围科研使用 Number.isSafeInteger()方法\n\n## 生成器\n\n```javascript\nfunction* generatorFn() {\n  yield 'foo'\n  yield 'bar'\n  return 'baz'\n}\nlet generatorObject1 = generatorFn()\nlet generatorObject2 = generatorFn()\nconsole.log(generatorObject1.next()) //{done:false,value:'foo'}\nconsole.log(generatorObject2.next()) //{done:false,value:'foo'}\nconsole.log(generatorObject2.next()) //{done:false,value:'bar'}\nconsole.log(generatorObject1.next()) //{done:false,value:'bar'}\n```\n\n**也可以用 for of 对 generatorObject1 进行迭代，那这个可以结合 promise 使用吗？是可以的，就是用 yield 实现了 await**。async 和 await，比起星号和 yield，语义更清楚了。async 表示函数里有异步操作，await 表示紧跟在后面的表达式需要等待结果。co 函数库约定，yield 命令后面只能是 Thunk 函数或 Promise 对象，而 async 函数的 await 命令后面，可以跟 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。\n\n### 使用 yield\\* 实现递归算法\n\nyield\\* 表达式迭代操作数，并产生它返回的每个值\n\nyield\\* 表达式本身的值是当迭代器关闭时返回的值（即 done 为 true）时\n\nyield\\*最有用的地方是实现递归操作，此时生成器可以产生自身：\n\n```javascript\nfunction* nTimes(n) {\n  if (n > 0) {\n    yield* nTimes(n - 1)\n    yield n - 1\n  }\n}\n\nfor (const x of nTimes(3)) {\n  console.log(x)\n}\n//0\n//1\n//2\n```\n\n## 箭头函数\n\n**箭头函数不能作为构造函数**：\n\n箭头函数没有自己的 this,arguments,super 或 new.target。箭头函数表达式更实用于那些需要匿名函数的地方，并且它不能用作构造函数，和 new 一起用会抛出错误，箭头函数没有 prototype 属性。\n\n箭头函数是有*proto*属性的，所以箭头函数本身是存在原型链的，他也是有自己的构造函数的，但是因为没有 prototype 属性，他的实例*proto*没法指向，所以箭头函数也就无法作为构造函数。\n\n同时箭头函数由于没有 this 指针，通过 call()和 apply 方法调用一个函数时，只能传递参数，不能绑定 this。\n","slug":"JS原生-ES6","published":1,"updated":"2021-04-09T13:24:52.977Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xq003cl5v0b824fzxp","content":"<p>发现自己对于 javascript 的底层 API 所知甚少，在这里记录一下所遇到的有趣又实在的 API 用法。</p>\n<p>ES6 的更新内容主要分为以下几点</p>\n<ul>\n<li>表达式：声明、解构赋值</li>\n<li>内置对象：字符串扩展、数值扩展、对象扩展、数组扩展、函数扩展、正则扩展、Symbol、Set、Map、Proxy、Reflect</li>\n<li>语句与运算：Class、Module、lterator(迭代)</li>\n<li>异步编程：Promise、Generator、Async</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"var-与-let-的区别\"><a href=\"#var-与-let-的区别\" class=\"headerlink\" title=\"var 与 let 的区别\"></a>var 与 let 的区别</h2><p>使用 var 关键字来声明变量，会出现重复声明导致变量被覆盖不会报错的问题；<br>在 ES6 中引入了 let 来解决 var 关键字带来的潜在问题，若是重复声明则会在控制台报错。</p>\n<h2 id=\"Symbol数据类型\"><a href=\"#Symbol数据类型\" class=\"headerlink\" title=\"Symbol数据类型\"></a><code>Symbol</code>数据类型</h2><p><code>Symbol</code>是通过<code>Symbol</code>函数生成的，凡是属性名属于<code>symbol</code>类型，就都是独一无二的，可以保证不会与其他属性名冲突。</p>\n<h3 id=\"使用-Symbol-来作为唯一标志\"><a href=\"#使用-Symbol-来作为唯一标志\" class=\"headerlink\" title=\"使用 Symbol 来作为唯一标志\"></a>使用 Symbol 来作为唯一标志</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PROP_NAME = <span class=\"built_in\">Symbol</span>() <span class=\"comment\">//解救无意义的赋值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> PROP_AGE = <span class=\"built_in\">Symbol</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">  [PROP_NAME]: <span class=\"string\">&#x27;一斤代码&#x27;</span>, <span class=\"comment\">//对象key值或是常量使用，原理相同</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj[PROP_AGE] = <span class=\"number\">18</span></span><br><span class=\"line\"></span><br><span class=\"line\">obj[PROP_NAME] <span class=\"comment\">// &#x27;一斤代码&#x27;</span></span><br><span class=\"line\">obj[PROP_AGE] <span class=\"comment\">// 18</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-Symbol-定义类的私有属性\"><a href=\"#使用-Symbol-定义类的私有属性\" class=\"headerlink\" title=\"使用 Symbol 定义类的私有属性\"></a>使用 Symbol 定义类的私有属性</h3><p>在 JS 中是没有私有变量的，雷伤所有定义的属性或是方法都是公开访问的。因此可能存在污染等情况，而有了 Symbol 以及模块化机制，类的私有属性和方法才能变成可能。</p>\n<p>在文件 a.js 中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PASSWORD = <span class=\"built_in\">Symbol</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Login</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">username, password</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.username = username</span><br><span class=\"line\">    <span class=\"built_in\">this</span>[PASSWORD] = password</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">checkPassword</span>(<span class=\"params\">pwd</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>[PASSWORD] === pwd</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Login</span><br></pre></td></tr></table></figure>\n\n<p>在文件 b.js 中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Login <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./a&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> login = <span class=\"keyword\">new</span> Login(<span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"string\">&#x27;123456&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">login.checkPassword(<span class=\"string\">&#x27;admin&#x27;</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\">login.PASSWORD <span class=\"comment\">// oh!no!</span></span><br><span class=\"line\">login[PASSWORD] <span class=\"comment\">// oh!no!</span></span><br><span class=\"line\">login[<span class=\"string\">&#x27;PASSWORD&#x27;</span>] <span class=\"comment\">// oh!no!</span></span><br></pre></td></tr></table></figure>\n\n<p>由于 Symbol 常量 PASSWORD 被定义在 a.js 所在的模块中，外面的模块获取不到这个 Symbol,也不可能在创建一个一个一样的 Symbol 出来，所以这个 PASSWORD 只能被限制在 a.js 内部使用，达到一个私有化的效果</p>\n<h3 id=\"注册和获取全局-Symbol\"><a href=\"#注册和获取全局-Symbol\" class=\"headerlink\" title=\"注册和获取全局 Symbol\"></a>注册和获取全局 Symbol</h3><p>Symbol 在不同 window 中创建的 Symbol 实例总是唯一的，如果应用涉及到多个 window（ifram），并需要这些 window 使用的是同一个，那就不能使用 Symbol()了（若是微前端里面又是什么样的呢？有时间试试），这时可以使用 Symbol.for()，它来注册或获取一个 window 间全局的 Symbol 实例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> gs1 = <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">&#x27;global_symbol_1&#x27;</span>) <span class=\"comment\">//注册一个全局Symbol</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> gs2 = <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">&#x27;global_symbol_1&#x27;</span>) <span class=\"comment\">//获取全局Symbol</span></span><br><span class=\"line\"></span><br><span class=\"line\">gs1 === gs2 <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>这时，在多个相关 window 间也是唯一的。</p>\n<h3 id=\"Symbol-iterator\"><a href=\"#Symbol-iterator\" class=\"headerlink\" title=\"Symbol.iterator\"></a>Symbol.iterator</h3><p>在 Symbol.iterator 出现后，JS 可以定义自己的迭代器<br>iterator 模式总是用同一种逻辑来遍历集合</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(Iterator it = c.iterater(); it.hasNext(); ) &#123; ... &#125;</span><br><span class=\"line\"><span class=\"comment\">//这样就在一定程度上解决了不同的数据类型需要不同的遍历方法</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> students = &#123;</span><br><span class=\"line\">  [<span class=\"built_in\">Symbol</span>.iterator]: <span class=\"function\"><span class=\"keyword\">function</span>* (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">yield</span> i</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> s <span class=\"keyword\">of</span> students) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(s)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//这个yield其实最后返回的就是iterator函数</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"yield\"><a href=\"#yield\" class=\"headerlink\" title=\"yield\"></a>yield</h2><p>yield 关键字用来暂停和恢复一个生成器函数.yield 关键字只能在生成器函数内部使用，用在其他地方会抛出错误。类似函数的 return 关键字，yield 关键字必须直接位于生成器函数定义中，出现在嵌套的非生成器函数中会抛出语法错误</p>\n<p>yield 关键字实际返回一个 IteratorResult 对象，它有两个属性，value 和 done。value 属性是对 yield 表达式求值的结果，而 done 是 false，表示生成器函数尚未完全完成。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">countAppleSales</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> saleList = [<span class=\"number\">3</span>, <span class=\"number\">7</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; saleList.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> saleList[i]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//一旦生成器函数已定义，可以通过一个构造一个迭代器来使用它</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> appleStore = countAppleSales() <span class=\"comment\">// Generator &#123; &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(appleStore.next()) <span class=\"comment\">// &#123; value: 3, done: false &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(appleStore.next()) <span class=\"comment\">// &#123; value: 7, done: false &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(appleStore.next()) <span class=\"comment\">// &#123; value: 5, done: false &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(appleStore.next()) <span class=\"comment\">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类-class\"><a href=\"#类-class\" class=\"headerlink\" title=\"类 class\"></a>类 class</h2><p>面向对象编程中的一个核心概念就是类（多态、封装、继承）。可以把事物都抽象成一个个的类来描述他们的信息和行为。</p>\n<p>JavaScript 是一个基于对象的语言，而不是面对对象的语言，它是一个基于 prototype 的语言。它的语法中没有像 Java 之类典型面向对象语言中定义一个类的语法，因此在 ES6 中，提供了一个面向对象风格的类定义方式：使用 class 关键字。</p>\n<p>类里面所有的方法都定义在类的 prototype 上面</p>\n<p><strong>注意：类必须使用 new 调用，否则会报错。这是它和普通函数的一个主要区别，后者不用 new 也可以执行</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name, age</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">walk</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m walking...&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">create</span>(<span class=\"params\">name, age</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//定义静态方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Person(name, age)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"constructor-NaN\"><a href=\"#constructor-NaN\" class=\"headerlink\" title=\"constructor\"></a>constructor</h3><ul>\n<li>是类的默认方法，通过 new 命令生成对象实例时，自动调用该方法，一个类必须有 constructor 方法，如果没有显示定义，一个空的 constructor 方法会被默认添加</li>\n<li>执行这个 constructor 方法默认返回实例对象（this）<h3 id=\"类的-prototype-属性\"><a href=\"#类的-prototype-属性\" class=\"headerlink\" title=\"类的 prototype 属性\"></a>类的 prototype 属性</h3></li>\n</ul>\n<p>类的所有方法都定义在类的 prototype 属性上面</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Point</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;&#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//等同于</span></span><br><span class=\"line\">Point.prototype = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span>&#123;&#125;,</span><br><span class=\"line\">  toString()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"class-的静态方法\"><a href=\"#class-的静态方法\" class=\"headerlink\" title=\"class 的静态方法\"></a>class 的静态方法</h3><p>如果在一个方法前，加上 static 关键字，就表示该方法不会被实例继承，而是直接通过类来调用，就是称为“静态方法”</p>\n<p><strong>注意：如果静态方法包含 this 关键字，这个 this 指向的是类，而不是实例</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Foo</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">classMethod</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Foo.classMethod() <span class=\"comment\">// &#x27;hello&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"keyword\">new</span> Foo()</span><br><span class=\"line\">foo.classMethod()</span><br></pre></td></tr></table></figure>\n<h3 id=\"super\"><a href=\"#super\" class=\"headerlink\" title=\"super\"></a>super</h3><p>super 关键字用于访问和调用一个对象的父对象的函数。( 只能在 class 内部用 )</p>\n<p>在构造函数中使用时，super 关键字将单独出现，并且必须在使用 this 之前使用。</p>\n<p>super 关键字也可以用来调用父对象上的函数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">super</span>([<span class=\"built_in\">arguments</span>])</span><br><span class=\"line\"><span class=\"comment\">// 调用 父对象/父类 的构造函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">super</span>.functionOnParent([<span class=\"built_in\">arguments</span>])</span><br><span class=\"line\"><span class=\"comment\">// 调用 父对象/父类 上的方法</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Polygon</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">construector</span>(<span class=\"params\">height, width</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;Polygon&#x27;</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.height = height</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.width = width</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayName</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Hi,I am a&#x27;</span>, <span class=\"built_in\">this</span>.name + <span class=\"string\">&#x27;.&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Square</span> <span class=\"keyword\">extends</span> <span class=\"title\">Polygon</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">length</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.height;</span><br><span class=\"line\">      <span class=\"comment\">// ReferenceError ,super 需要先被调用！</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       这里，它调用父类的构造函数的length,</span></span><br><span class=\"line\"><span class=\"comment\">       作为Polygon 的 width 和 height</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       <span class=\"built_in\">super</span>(length,length)</span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       注意，在派生的类中，在你可以使用this之前，必须 先调用super()。忽略这，这将导致引用错误。</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;Square&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> <span class=\"title\">area</span>()&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.height * <span class=\"built_in\">this</span>.width</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> <span class=\"title\">area</span>(<span class=\"params\">value</span>)&#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.area = value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>使用 super 调用父类的静态方法。</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Human</span></span>&#123;&#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">ping</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;ping&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">computer</span> <span class=\"title\">eatends</span> <span class=\"title\">Human</span></span>&#123; <span class=\"comment\">//使用extend 实现继承另一个类</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">pingpong</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.ping()+<span class=\"string\">&#x27;pong&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.pingpong()</span><br></pre></td></tr></table></figure>\n\n<p><strong>原始 class 实现方式</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Parent</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Parent.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Child</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  Parent.call(<span class=\"built_in\">this</span>, name)</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//实现继承</span></span><br><span class=\"line\">Child.prototype = <span class=\"keyword\">new</span> Parent()</span><br><span class=\"line\">Child.prototype.constructor = Child</span><br><span class=\"line\"></span><br><span class=\"line\">Child.prototype.getAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.Age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> people = <span class=\"keyword\">new</span> Child(<span class=\"string\">&#x27;lily&#x27;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(people.getName())</span><br></pre></td></tr></table></figure>\n\n<p><strong>语法糖</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">construtor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getAge</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.age</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> people = <span class=\"keyword\">new</span> Child(<span class=\"string\">&quot;lily&quot;</span>,<span class=\"number\">20</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(people.getName())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"异步函数\"><a href=\"#异步函数\" class=\"headerlink\" title=\"异步函数\"></a>异步函数</h2><p>除了 javascript Promise , 异步函数进一步重写了传统的异步代码结构。</p>\n<h3 id=\"一个以-async-为前缀的常规函数\"><a href=\"#一个以-async-为前缀的常规函数\" class=\"headerlink\" title=\"一个以 async 为前缀的常规函数\"></a>一个以 async 为前缀的常规函数</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchdata</span>(<span class=\"params\">url</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在异步函数（Async-function-）内，使用-await-关键字调用异步操作函数\"><a href=\"#在异步函数（Async-function-）内，使用-await-关键字调用异步操作函数\" class=\"headerlink\" title=\"在异步函数（Async function ）内，使用 await 关键字调用异步操作函数\"></a>在异步函数（Async function ）内，使用 await 关键字调用异步操作函数</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getaSync</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\">    xhr.open(<span class=\"string\">&#x27;GET&#x27;</span>, url)</span><br><span class=\"line\">    xhr.onload = <span class=\"function\">() =&gt;</span> resolve(xhr.responseText)</span><br><span class=\"line\">    xhr.onerror = <span class=\"function\">() =&gt;</span> reject(xhr.statusText)</span><br><span class=\"line\">    xhr.send()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchdata</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> text1 = <span class=\"keyword\">await</span> getasync(<span class=\"string\">&#x27;test.txt&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.logtex(text1)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> text2 = <span class=\"keyword\">await</span> getasync(<span class=\"string\">&#x27;test2.text&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(text2)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> text3 = <span class=\"keyword\">await</span> getasync(<span class=\"string\">&#x27;text3.text&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(text3)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Finished&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fetchdata().then(<span class=\"function\">(<span class=\"params\">msg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(msg) <span class=\"comment\">//“test.txt”，“test2.txt”，“test3.txt”</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>在异步函数中，我们把异步函数 getasync() 当做是同步函数，没有 then() 方法或回调函数通知下一步。无论何时遇到关键字 await , 执行都会停止，直到 getasync() 解决，然后再转到异步函数中的下一行。结果与纯粹的基于 Promise , 使用一串 then 方法的方式一样</p>\n<h2 id=\"解构\"><a href=\"#解构\" class=\"headerlink\" title=\"解构\"></a>解构</h2><p>ES6 解构并非一个新的功能，而是一个新的复制语法，可以快速解压缩对象属性和数组中的值，并将它们分配给各个变量。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> profile = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;georage&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">39</span>, <span class=\"attr\">hobby</span>: <span class=\"string\">&#x27;Tennis&#x27;</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> &#123; name, hobby &#125; = profile</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//&#x27;georage&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(hobby) <span class=\"comment\">//&#x27;Tennis&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>这里我用解构快速提取 profile 对象的 name 和 hobby 属性。</p>\n<p>使用别名，你可以使用与你正在提取值的对象属性不同的变量名：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> profile = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;georage&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">39</span>, <span class=\"attr\">hobby</span>: <span class=\"string\">&#x27;Tennis&#x27;</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> &#123; <span class=\"attr\">name</span>: n, <span class=\"attr\">hobby</span>: h &#125; = profile</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(n) <span class=\"comment\">//&#x27;georage&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(h) <span class=\"comment\">//&#x27;Tennis&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"嵌套对象解构\"><a href=\"#嵌套对象解构\" class=\"headerlink\" title=\"嵌套对象解构\"></a>嵌套对象解构</h3><p>解构也可以与嵌套对象一起工作，可以使用它来快速解开来自复杂的 JSON 请求的值。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> jsondata = &#123;</span><br><span class=\"line\">  title: <span class=\"string\">&#x27;XX&#x27;</span>,</span><br><span class=\"line\">  details: &#123;</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      created: <span class=\"string\">&#x27;2017/09/19&#x27;</span>,</span><br><span class=\"line\">      modified: <span class=\"string\">&#x27;2017/09/20&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    catrgory: <span class=\"string\">&#x27;js&#x27;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  url: <span class=\"string\">&#x27;/baidu/&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> &#123;</span><br><span class=\"line\">  title,</span><br><span class=\"line\">  details: &#123;</span><br><span class=\"line\">    data: &#123; created, modified &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125; = jsondata</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(title)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(created)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(modified)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"解构数组\"><a href=\"#解构数组\" class=\"headerlink\" title=\"解构数组\"></a>解构数组</h3><p>数组的解构与对象上的工作方式类似，除了左边的花括号使用<strong>方括号</strong>代替：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> soccerteam = [<span class=\"string\">&#x27;George&#x27;</span>, <span class=\"string\">&#x27;Dennis&#x27;</span>, <span class=\"string\">&#x27;Sandy&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> [a, b] = soccerteam</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a) <span class=\"comment\">// &quot;George&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b) <span class=\"comment\">// &quot;Dennis&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>你可以跳过某些数组元素，通过使用 (,)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"keyword\">var</span> soccerteam = [<span class=\"string\">&#x27;George&#x27;</span>, <span class=\"string\">&#x27;Dennis&#x27;</span>, <span class=\"string\">&#x27;Sandy&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> [a,,b] = soccerteam</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a) <span class=\"comment\">// &quot;George&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b) <span class=\"comment\">// &quot;Sandy&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"解构赋值\"><a href=\"#解构赋值\" class=\"headerlink\" title=\"解构赋值\"></a>解构赋值</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> [a, b, c] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"comment\">//定义了三个变量，并对应赋了值；如果值的个数与变量名个数不匹配，没有对应上的变量值为 undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> [a, b, c=<span class=\"string\">&#x27;default&#x27;</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"comment\">//指定默认值，在定义变量时就指定了默认值，如果赋值时，没有给定内容，则会取默认值</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> [a, …b] = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"comment\">//这里 b 的值为[2，3]，这样可以快速使用剩余的数据赋值给变量，</span></span><br><span class=\"line\"><span class=\"comment\">//但实际使用中为了避免代码阅读的歧义，不推荐这么使用，仅作了解即可</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> [a,b,c] = <span class=\"string\">&#x27;yes&#x27;</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);<span class=\"comment\">//y</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b);<span class=\"comment\">//e</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c);<span class=\"comment\">//s</span></span><br></pre></td></tr></table></figure>\n\n<p>字符串的结构赋值会以单个字符串的方式进行赋值。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> &#123; length &#125; = <span class=\"string\">&#x27;yes&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(length) <span class=\"comment\">//3</span></span><br></pre></td></tr></table></figure>\n\n<p>以对象赋值的方法，如果名称是字符串的自带属性，则会获得属性值</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">&#123; a = <span class=\"number\">10</span>, b, c = <span class=\"number\">10</span> &#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">arguments</span>) <span class=\"comment\">//&#123; a: 1, b: 2 &#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a) <span class=\"comment\">//1</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(b) <span class=\"comment\">//2</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(c) <span class=\"comment\">//10</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test(obj)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Spread-操作符\"><a href=\"#Spread-操作符\" class=\"headerlink\" title=\"Spread 操作符\"></a>Spread 操作符</h2><p>spread(…)操作符也称作展开操作符，作用是讲可迭代的对象进行展开</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fruits = [<span class=\"string\">&#x27;apple&#x27;</span>, <span class=\"string\">&#x27;orange&#x27;</span>, <span class=\"string\">&#x27;peach&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> shoppingList = [<span class=\"string\">&#x27;t-shirt&#x27;</span>, ...fruits, <span class=\"string\">&#x27;egg&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// shoppingList的值：[&quot;t-shirt&quot;, &quot;apple&quot;, &quot;organe&quot;, &quot;peach&quot;, &quot;egg&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<p>Spread 操作符可以展开 Iterable 的对象，这样的话，除了数组之外，所有实现了 Symbol.iterator 的对象，如：Set, Map 和 Generator 等等，都可以使用 Spread 操作符。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> map = <span class=\"keyword\">new</span> <span class=\"built_in\">Map</span>()</span><br><span class=\"line\">map.set(<span class=\"string\">&#x27;a&#x27;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">map.set(<span class=\"string\">&#x27;b&#x27;</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr1 = [...map] <span class=\"comment\">//[[&quot;a&quot;, 1], [&quot;b&quot;, 2]]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> set = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>()</span><br><span class=\"line\">set.add(<span class=\"number\">1</span>)</span><br><span class=\"line\">set.add(<span class=\"number\">2</span>)</span><br><span class=\"line\">set.add(<span class=\"number\">1</span>)</span><br><span class=\"line\">set.add(<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [...set] <span class=\"comment\">//[1, 2, 3]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">myGen</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;world&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [...myGen()] <span class=\"comment\">//[&quot;hello&quot;, &quot;world&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"默认和剩余参数\"><a href=\"#默认和剩余参数\" class=\"headerlink\" title=\"默认和剩余参数\"></a>默认和剩余参数</h2><h3 id=\"默认参数\"><a href=\"#默认参数\" class=\"headerlink\" title=\"默认参数\"></a>默认参数</h3><p>在这之前我们都使用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getarea</span>(<span class=\"params\">w, h</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = w || <span class=\"number\">10</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> h = h || <span class=\"number\">15</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> w * h</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有了 ES6 对默认参数的支持后</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getarea</span>(<span class=\"params\">w = <span class=\"number\">10</span>, h = <span class=\"number\">15</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> w * h</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getarea(<span class=\"number\">5</span>) <span class=\"comment\">//75</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"剩余参数-（Rest-Parameters）\"><a href=\"#剩余参数-（Rest-Parameters）\" class=\"headerlink\" title=\"剩余参数 （Rest Parameters）\"></a>剩余参数 （Rest Parameters）</h3><p>ES6 中的 Rest Parameters 使得将函数参数转换成数组的操作变得简单。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addit</span>(<span class=\"params\">...theNumber</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//get the sum of the array elements</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> theNumber.reduce(<span class=\"function\">(<span class=\"params\">prevnum.curnum</span>) =&gt;</span> prevnu + curnum, <span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">addit(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>) <span class=\"comment\">//10</span></span><br></pre></td></tr></table></figure>\n\n<p>通过在命名参数前添加 3 个点。在该位置和之后输入到函数中的参数将自动转换为数组。</p>\n<p>没有 Rest Parameters 则会手动将参数转换为数组 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addit</span>(<span class=\"params\">theNumbers</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// force arguments object into array</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> numArray = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> numArray.reduce(<span class=\"function\">(<span class=\"params\">prevnum, curnum</span>) =&gt;</span> prevnum + curnum, <span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">addit(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>) <span class=\"comment\">// returns 10</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">...[a, b, c]</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a + b + c</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">f(<span class=\"number\">1</span>) <span class=\"comment\">// NaN (b and c are undefined)</span></span><br><span class=\"line\">f(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">// 6</span></span><br><span class=\"line\">f(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>) <span class=\"comment\">//6 (the fourth parameter is not destructured)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Generator-函数\"><a href=\"#Generator-函数\" class=\"headerlink\" title=\"Generator 函数\"></a>Generator 函数</h2><p>Generator 函数是协程在 ES6 的实现，最大特点就是可以交出函数的执行权（即暂停执行）。协程：多个现成互相协作，完成异步任务。</p>\n<p>协程有点像函数，又有点想线程。他的运行流程大致如下：</p>\n<ul>\n<li>第一步，协程 A 开始执行。</li>\n<li>第二步，协程执行懂啊一半，进入暂停，执行权转移到协程 B。</li>\n<li>第三步，一段时间后协程 B 交换执行权。</li>\n<li>第四步，协程 A 恢复执行。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">gen</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> y = <span class=\"keyword\">yield</span> x + <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> y</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面整个代码就是一个封装的异步任务，或者说是异步任务的容器。异步操作需要暂停的地方，都用 yield 语句注明。Generator 函数的执行方法如下。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> g = gen(<span class=\"number\">1</span>)</span><br><span class=\"line\">g.next() <span class=\"comment\">// &#123; value: 3, done: false &#125;</span></span><br><span class=\"line\">g.next() <span class=\"comment\">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>next 方法的作用是分阶段执行 Generator 函数。每次调用 next 方法，返回一个对象，表示当前阶段的信息（value 和 done 属性）。value 属性是 yield 语法后面表达式的值。表示当前阶段的值；done 属性是一个布尔值，表示 Generator 函数是否执行完毕，即是否还有下一个阶段。</p>\n<p>这是一个生成器的例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">genFn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;begin&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value = <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;a&#x27;</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(value) <span class=\"comment\">// &#x27;B&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;end&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> gen = genFn()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> gen) <span class=\"comment\">// &#x27;object&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> g1 = gen.next()</span><br><span class=\"line\">g1.value <span class=\"comment\">// &#x27;a&#x27;</span></span><br><span class=\"line\">g1.done <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> g2 = gen.next(<span class=\"string\">&#x27;B&#x27;</span>)</span><br><span class=\"line\">g2.value <span class=\"comment\">// &#x27;end&#x27;</span></span><br><span class=\"line\">g2.done <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"字符串扩展\"><a href=\"#字符串扩展\" class=\"headerlink\" title=\"字符串扩展\"></a>字符串扩展</h2><h3 id=\"字符串内容测试\"><a href=\"#字符串内容测试\" class=\"headerlink\" title=\"字符串内容测试\"></a>字符串内容测试</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.includes(<span class=\"string\">&#x27;c&#x27;</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.includes(<span class=\"string\">&#x27;ye&#x27;</span>) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.startsWith(<span class=\"string\">&#x27;a&#x27;</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.endswidth(<span class=\"string\">&#x27;f&#x27;</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"comment\">//includes(), startsWith(), endsWith() 都支持第二个参数，</span></span><br><span class=\"line\"><span class=\"comment\">//类型为数字类型，意为从第 n 个字符开始，endsWith()的第二个参数有点不一样</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.includes(<span class=\"string\">&#x27;c&#x27;</span>, <span class=\"number\">4</span>) <span class=\"comment\">//false 从第5个字符开始查找是否有 &#x27;c&#x27; 这个字符</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.startsWith(<span class=\"string\">&#x27;d&#x27;</span>, <span class=\"number\">3</span>) <span class=\"comment\">//true 从第4个字符开始查找是否是以 &#x27;d&#x27; 字符为开头</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.endsWith(<span class=\"string\">&#x27;d&#x27;</span>, <span class=\"number\">4</span>) <span class=\"comment\">//true 前面的4个字符里，是否以 &#x27;d&#x27; 字符为结尾</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>字符串重复输出：</strong><br>这个方法接受一个整数参数，表示要将字符串复制多少次，然后返回拼接所有副本后的结果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;a&#x27;</span>.repeat(<span class=\"number\">5</span>) <span class=\"comment\">//aaaaa 重复输出5遍</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"模板字符串\"><a href=\"#模板字符串\" class=\"headerlink\" title=\"模板字符串(``)\"></a>模板字符串(``)</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">authorize</span>(<span class=\"params\">user, action</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!user.hasPrivilege(action)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">`用户 <span class=\"subst\">$&#123;user.name&#125;</span> 未被授权执行 <span class=\"subst\">$&#123;action&#125;</span> 操作。`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这个示例中，<code>$&#123;user.name&#125;</code>,<code>$&#123;action&#125;</code>被称为模板占位符，javascript 将把 user.name 和 action 的值插入到最终生成的字符串中。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;#warning&#x27;</span>).html(<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">  &lt;h1&gt;小心！&gt;/h1&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &lt;p&gt;未经授权打冰球可能受罚</span></span><br><span class=\"line\"><span class=\"string\">  将近<span class=\"subst\">$&#123;maxPenalty&#125;</span>分钟。&lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\">`</span>)</span><br></pre></td></tr></table></figure>\n\n<p>模板字符串中所有的空格、新进、缩进，都会原样输出在生成的字符串中。</p>\n<h3 id=\"原生支持模板语言\"><a href=\"#原生支持模板语言\" class=\"headerlink\" title=\"原生支持模板语言\"></a>原生支持模板语言</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//es5</span></span><br><span class=\"line\">$(<span class=\"string\">&#x27;#result&#x27;</span>).append(</span><br><span class=\"line\">  <span class=\"string\">&#x27;There are &lt;b&gt;&#x27;</span> +</span><br><span class=\"line\">    basket.count +</span><br><span class=\"line\">    <span class=\"string\">&#x27;&lt;/b&gt; &#x27;</span> +</span><br><span class=\"line\">    <span class=\"string\">&#x27;items in your basket, &#x27;</span> +</span><br><span class=\"line\">    <span class=\"string\">&#x27;&lt;em&gt;&#x27;</span> +</span><br><span class=\"line\">    basket.onSale +</span><br><span class=\"line\">    <span class=\"string\">&#x27;&lt;/em&gt; are on sale!&#x27;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"comment\">//es6</span></span><br><span class=\"line\"><span class=\"comment\">//在es6中，内容模板，可以定义在 `` 包起来的字符串中，其中的内容会保持原有格式</span></span><br><span class=\"line\"><span class=\"comment\">//另外可以在字符串中直接使用模板语言进行变量填充，优雅而简洁</span></span><br><span class=\"line\">$(<span class=\"string\">&#x27;#result&#x27;</span>).append(<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">  There are &lt;b&gt;<span class=\"subst\">$&#123;basket.count&#125;</span>&lt;/b&gt; items</span></span><br><span class=\"line\"><span class=\"string\">   in your basket, &lt;em&gt;<span class=\"subst\">$&#123;basket.onSale&#125;</span>&lt;/em&gt;</span></span><br><span class=\"line\"><span class=\"string\">  are on sale!</span></span><br><span class=\"line\"><span class=\"string\">`</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字符串遍历输出\"><a href=\"#字符串遍历输出\" class=\"headerlink\" title=\"字符串遍历输出\"></a>字符串遍历输出</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//for ...of 格式为 es6 中的 Iterator 迭代器的输出方式</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> c <span class=\"keyword\">of</span> <span class=\"string\">&#x27;abc&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(c)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//a</span></span><br><span class=\"line\"><span class=\"comment\">//b</span></span><br><span class=\"line\"><span class=\"comment\">//c</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字符串补全\"><a href=\"#字符串补全\" class=\"headerlink\" title=\"字符串补全\"></a>字符串补全</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//参数1：[number] 目标字符串长度</span></span><br><span class=\"line\"><span class=\"comment\">//参数2：[string] 进行补全的字符串</span></span><br><span class=\"line\"><span class=\"string\">&#x27;12345&#x27;</span>.padStart(<span class=\"number\">7</span>, <span class=\"string\">&#x27;0&#x27;</span>) <span class=\"comment\">//0012345 - 字符串不足7位，在头部补充不足长度的目标字符串</span></span><br><span class=\"line\"><span class=\"string\">&#x27;12345&#x27;</span>.padEnd(<span class=\"number\">7</span>, <span class=\"string\">&#x27;0&#x27;</span>) <span class=\"comment\">//1234500 - 在尾部进行字符串补全</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字符串迭代与结构\"><a href=\"#字符串迭代与结构\" class=\"headerlink\" title=\"字符串迭代与结构\"></a>字符串迭代与结构</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> message = <span class=\"string\">&#x27;abc&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> stringIterator = message[<span class=\"built_in\">Symbol</span>.iterator]()</span><br><span class=\"line\">stringIterator.next() <span class=\"comment\">//&#123;value:a,done:false&#125;</span></span><br><span class=\"line\">stringIterator.next() <span class=\"comment\">//&#123;value:b,done:false&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>或是用 for of</p>\n<h2 id=\"数组扩展\"><a href=\"#数组扩展\" class=\"headerlink\" title=\"数组扩展\"></a>数组扩展</h2><h3 id=\"Array-from\"><a href=\"#Array-from\" class=\"headerlink\" title=\"Array.from()\"></a>Array.from()</h3><p>从一个类似数组或可迭代对象中创建一个新的数组实例。</p>\n<h3 id=\"合并数组\"><a href=\"#合并数组\" class=\"headerlink\" title=\"合并数组\"></a>合并数组</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"keyword\">let</span> b = [<span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"keyword\">let</span> c = [<span class=\"number\">2</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"keyword\">let</span> d = [...a, ...b, ...c] <span class=\"comment\">//[1, 2, 3, 2, 4] 所有内容合并，但并不会去除重复</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"快速转换为数组\"><a href=\"#快速转换为数组\" class=\"headerlink\" title=\"快速转换为数组\"></a>快速转换为数组</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.of(<span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>) <span class=\"comment\">//[3,4,5]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"内容过滤\"><a href=\"#内容过滤\" class=\"headerlink\" title=\"内容过滤\"></a>内容过滤</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//判断对象是否为数组</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"built_in\">Array</span>.isArray(obj))&#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>].includes(<span class=\"number\">5</span>);<span class=\"comment\">//false，检索数据中是否有5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//找出第一个匹配表达式的结果，注意是只要匹配到一项，函数即会返回</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, -<span class=\"number\">4</span>, <span class=\"number\">10</span>].find(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value &lt; <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);<span class=\"comment\">//-4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//找出第一个匹配表达式的结果下标</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, -<span class=\"number\">4</span>, <span class=\"number\">10</span>].findIndex(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value &lt; <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);<span class=\"comment\">//2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//排除负数内容</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, -<span class=\"number\">4</span>, <span class=\"number\">10</span>].filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item &gt; <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);<span class=\"comment\">//[1, 3, 10]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"对象扩展\"><a href=\"#对象扩展\" class=\"headerlink\" title=\"对象扩展\"></a>对象扩展</h2><h3 id=\"可计算属性\"><a href=\"#可计算属性\" class=\"headerlink\" title=\"可计算属性\"></a>可计算属性</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> nameKey = <span class=\"string\">&#x27;name&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> ageKey = <span class=\"string\">&#x27;27&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> jobKey = <span class=\"string\">&#x27;job&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> person = &#123;</span><br><span class=\"line\">  [nameKey]: <span class=\"string\">&#x27;matt&#x27;</span>,</span><br><span class=\"line\">  [ageKey]: <span class=\"number\">27</span>,</span><br><span class=\"line\">  [jobKey]: <span class=\"string\">&#x27;software engineer&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可变 key 是在申明时进行值赋值，而不是地址赋值，就算使用对象作为 key 值，key 值在之后也不是可变的</p>\n<h3 id=\"属性的简洁表示\"><a href=\"#属性的简洁表示\" class=\"headerlink\" title=\"属性的简洁表示\"></a>属性的简洁表示</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//直接使用变量/常量的名称个为对象属性的名称</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"string\">&#x27;abc&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> b = &#123; a &#125; <span class=\"comment\">//&#123;a: &#x27;abc&#x27;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; x, y &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//等效于</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; <span class=\"attr\">x</span>: x, <span class=\"attr\">y</span>: y &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> o = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">f</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//等效于</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> o = &#123;</span><br><span class=\"line\">  f: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对象内容合并\"><a href=\"#对象内容合并\" class=\"headerlink\" title=\"对象内容合并\"></a>对象内容合并</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;,</span><br><span class=\"line\">  b = &#123; <span class=\"attr\">b</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">  c = &#123; <span class=\"attr\">b</span>: <span class=\"number\">4</span>, <span class=\"attr\">c</span>: <span class=\"number\">5</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> d = <span class=\"built_in\">Object</span>.assign(a, b, c)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(d) <span class=\"comment\">//&#123;a:1,b:4,c:5&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a) <span class=\"comment\">//&#123;a:1,b:4&#125;</span></span><br><span class=\"line\"><span class=\"comment\">//上面的合并方式会同时更新 a 对象的内容，a 的属性如果有多次合并会被更新数据，</span></span><br><span class=\"line\"><span class=\"comment\">//但自身没有的属性，其它对象有的属性不会被添加到 a 身上；</span></span><br><span class=\"line\"><span class=\"comment\">//参数列中的对象只会影响第一个，后面的参数对象不会被修改数据</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//推荐使用这种方式进行对象数据合并</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;,</span><br><span class=\"line\">  b = &#123; <span class=\"attr\">b</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">  c = &#123; <span class=\"attr\">b</span>: <span class=\"number\">4</span>, <span class=\"attr\">c</span>: <span class=\"number\">5</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> d = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, a, b, c) <span class=\"comment\">//第一个参数增加一个空对象，在合并时让它被更新，不影响实际的对象变量内容</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(d) <span class=\"comment\">//&#123;a:1,b:4,c:5&#125;//与上面的方式合并结果一致，使用这种方式, a 对象的内容就不会被影响了</span></span><br></pre></td></tr></table></figure>\n\n<p>对象内容合并的方向是从参数顺序的后向前合并</p>\n<h3 id=\"对象内容集合\"><a href=\"#对象内容集合\" class=\"headerlink\" title=\"对象内容集合\"></a>对象内容集合</h3><h4 id=\"Object-keys\"><a href=\"#Object-keys\" class=\"headerlink\" title=\"Object.keys()\"></a>Object.keys()</h4><p>获取对象中所有的键名，以数组的形式返回</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"built_in\">Object</span>.keys(obj) <span class=\"comment\">//[&#x27;a&#x27;,&#x27;b,]</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Object-values\"><a href=\"#Object-values\" class=\"headerlink\" title=\"Object.values()\"></a>Object.values()</h4><p>获取对象中所有值内容，以数组的形式返回</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> values = <span class=\"built_in\">Object</span>.values(obj) <span class=\"comment\">//[1,2]</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Object-entries\"><a href=\"#Object-entries\" class=\"headerlink\" title=\"Object.entries()\"></a>Object.entries()</h4><p>获得对象中所有成员的数据，以数组的形式返回，成员的内容也是数组形式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> values = <span class=\"built_in\">Object</span>.entries(obj) <span class=\"comment\">//[[&#x27;a&#x27;,1],[&#x27;b&#x27;,2]]</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"对象内容测试\"><a href=\"#对象内容测试\" class=\"headerlink\" title=\"对象内容测试\"></a>对象内容测试</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//判断对象是否为数组对象</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.isArray(someobj)) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//判断目标对象是否为空对象</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (someobj &amp;&amp; <span class=\"built_in\">Object</span>.keys(someobj).length);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Map\"><a href=\"#Map\" class=\"headerlink\" title=\"Map\"></a>Map</h3><p>Map 的用法和普通对象基本一致，但是主要差异是，Map 实例会维护键值对的插入顺序，因此可以根据插入顺序执行迭代操作。</p>\n<p>对象和映射之间存在着显著的内存和性能问题：</p>\n<ul>\n<li>在给定固定大小的内存时，Map 大约可以比 Object 多存储 50% 的键/值对。</li>\n<li>Map 在所有的浏览器中一般会比 Object 的插入速度快</li>\n<li>从大型 Object 和 Map 中查找键/值对，则 Object 有时候速度会更快。在把 Object 当成数组使用的情况下（比如使用连续整数作为属性），浏览器引擎可以进行优化，在内存中使用更高效的布局。对于这两个类型而言，查找书读不会随着键/值对数量增加而现行增加，如果代码设计大量查找操作，那么某些情况下可能选 Object 更好</li>\n<li>Object 的 delete 性能很差，在现在很多浏览器依然如此，Map 的 delete 操作都比插入和查找更快，如果代码涉及大量删除操作，那么毫无以为应该选择 map</li>\n</ul>\n<p>(思考：vue 中的 data 数据使用 Map 是什么样的呢？)</p>\n<p>先看一下它能用非法字符串或者数字作为 key 的特性。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> map = <span class=\"built_in\">Map</span>()</span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123; <span class=\"attr\">p</span>: <span class=\"string\">&#x27;hellow&#x27;</span> &#125;</span><br><span class=\"line\">map.set(obj, <span class=\"string\">&#x27;ok&#x27;</span>) <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj) <span class=\"comment\">//&#123; p: &#x27;hellow&#x27; &#125;</span></span><br><span class=\"line\">map.get(obj) <span class=\"comment\">//ok</span></span><br><span class=\"line\">map.has(obj) <span class=\"comment\">//true</span></span><br><span class=\"line\">map.delete(obj) <span class=\"comment\">//true</span></span><br><span class=\"line\">map.has(obj) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<p>需要使用 new Map()初始化一个实例。</p>\n<ul>\n<li>size:获取成员数量</li>\n<li>set:设置成员 key 和 value</li>\n<li>get:获取成员属性值</li>\n<li>has:判断成员是否存在</li>\n<li>delete:删除成员</li>\n<li>clear:清空所有</li>\n<li>keys():返回键名的遍历器</li>\n<li>values():返回键值的遍历器</li>\n<li>entries():返回所有成员的遍历器</li>\n<li>forEach():遍历 Map 的所有成员</li>\n</ul>\n<h3 id=\"set-对象-（可用于去重）\"><a href=\"#set-对象-（可用于去重）\" class=\"headerlink\" title=\"set 对象 （可用于去重）\"></a>set 对象 （可用于去重）</h3><p>set 独享允许你存储任何类型唯一值，无论是原始值或是对象。NaN 之间视为相同的值。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> set1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>([<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"literal\">NaN</span>, <span class=\"literal\">NaN</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.has(<span class=\"number\">1</span>)) <span class=\"comment\">// expected output: true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.has(<span class=\"number\">5</span>)) <span class=\"comment\">// expected output: true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.has(<span class=\"number\">6</span>)) <span class=\"comment\">// expected output:false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Array</span>.from(set1)) <span class=\"comment\">// Array [1, 2, 3, 4, NaN, 5]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"定型数组\"><a href=\"#定型数组\" class=\"headerlink\" title=\"定型数组\"></a>定型数组</h3><p>所谓定型数组，就是将任何数字转换成一个包含数字比特的数组，随后就可以通过 JS 数组进一步处理</p>\n<p>在 JavaScript 中，数字类型变量都是以 64 位浮点型数据格式存储；比如新建一个只需要 8 比特的整数，也需要为其开辟 64 位存储空间，浪费资源，效率也低。而 CanvasFloatArray 需要的是 Float32Array</p>\n<p>所有与定型数组有关的操作和对象都集中在这 8 个数据类型上，但是在使用他们之前，需要穿件一个数组缓冲区存储这些数据</p>\n<p>数据缓冲区是所有定型数组的根基，它是一段可以包含特定数量字节的内存地址。</p>\n<h2 id=\"isInteger-与安全整数\"><a href=\"#isInteger-与安全整数\" class=\"headerlink\" title=\"isInteger 与安全整数\"></a>isInteger 与安全整数</h2><p>isInteger 用于判断一个数值是否为整数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Number</span>.isInteger(<span class=\"number\">1</span>)) <span class=\"comment\">//  true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Number</span>.isInteger(<span class=\"number\">1.0</span>)) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(Nmber.isInteger(<span class=\"number\">1.01</span>)) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<p>为了鉴别整数是否在安全范围科研使用 Number.isSafeInteger()方法</p>\n<h2 id=\"生成器\"><a href=\"#生成器\" class=\"headerlink\" title=\"生成器\"></a>生成器</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">generatorFn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;foo&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;bar&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;baz&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> generatorObject1 = generatorFn()</span><br><span class=\"line\"><span class=\"keyword\">let</span> generatorObject2 = generatorFn()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(generatorObject1.next()) <span class=\"comment\">//&#123;done:false,value:&#x27;foo&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(generatorObject2.next()) <span class=\"comment\">//&#123;done:false,value:&#x27;foo&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(generatorObject2.next()) <span class=\"comment\">//&#123;done:false,value:&#x27;bar&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(generatorObject1.next()) <span class=\"comment\">//&#123;done:false,value:&#x27;bar&#x27;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>也可以用 for of 对 generatorObject1 进行迭代，那这个可以结合 promise 使用吗？是可以的，就是用 yield 实现了 await</strong>。async 和 await，比起星号和 yield，语义更清楚了。async 表示函数里有异步操作，await 表示紧跟在后面的表达式需要等待结果。co 函数库约定，yield 命令后面只能是 Thunk 函数或 Promise 对象，而 async 函数的 await 命令后面，可以跟 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。</p>\n<h3 id=\"使用-yield-实现递归算法\"><a href=\"#使用-yield-实现递归算法\" class=\"headerlink\" title=\"使用 yield* 实现递归算法\"></a>使用 yield* 实现递归算法</h3><p>yield* 表达式迭代操作数，并产生它返回的每个值</p>\n<p>yield* 表达式本身的值是当迭代器关闭时返回的值（即 done 为 true）时</p>\n<p>yield*最有用的地方是实现递归操作，此时生成器可以产生自身：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">nTimes</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span>* nTimes(n - <span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> n - <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> x <span class=\"keyword\">of</span> nTimes(<span class=\"number\">3</span>)) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//0</span></span><br><span class=\"line\"><span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"comment\">//2</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"箭头函数\"><a href=\"#箭头函数\" class=\"headerlink\" title=\"箭头函数\"></a>箭头函数</h2><p><strong>箭头函数不能作为构造函数</strong>：</p>\n<p>箭头函数没有自己的 this,arguments,super 或 new.target。箭头函数表达式更实用于那些需要匿名函数的地方，并且它不能用作构造函数，和 new 一起用会抛出错误，箭头函数没有 prototype 属性。</p>\n<p>箭头函数是有<em>proto</em>属性的，所以箭头函数本身是存在原型链的，他也是有自己的构造函数的，但是因为没有 prototype 属性，他的实例<em>proto</em>没法指向，所以箭头函数也就无法作为构造函数。</p>\n<p>同时箭头函数由于没有 this 指针，通过 call()和 apply 方法调用一个函数时，只能传递参数，不能绑定 this。</p>\n","site":{"data":{}},"excerpt":"<p>发现自己对于 javascript 的底层 API 所知甚少，在这里记录一下所遇到的有趣又实在的 API 用法。</p>\n<p>ES6 的更新内容主要分为以下几点</p>\n<ul>\n<li>表达式：声明、解构赋值</li>\n<li>内置对象：字符串扩展、数值扩展、对象扩展、数组扩展、函数扩展、正则扩展、Symbol、Set、Map、Proxy、Reflect</li>\n<li>语句与运算：Class、Module、lterator(迭代)</li>\n<li>异步编程：Promise、Generator、Async</li>\n</ul>","more":"<h2 id=\"var-与-let-的区别\"><a href=\"#var-与-let-的区别\" class=\"headerlink\" title=\"var 与 let 的区别\"></a>var 与 let 的区别</h2><p>使用 var 关键字来声明变量，会出现重复声明导致变量被覆盖不会报错的问题；<br>在 ES6 中引入了 let 来解决 var 关键字带来的潜在问题，若是重复声明则会在控制台报错。</p>\n<h2 id=\"Symbol数据类型\"><a href=\"#Symbol数据类型\" class=\"headerlink\" title=\"Symbol数据类型\"></a><code>Symbol</code>数据类型</h2><p><code>Symbol</code>是通过<code>Symbol</code>函数生成的，凡是属性名属于<code>symbol</code>类型，就都是独一无二的，可以保证不会与其他属性名冲突。</p>\n<h3 id=\"使用-Symbol-来作为唯一标志\"><a href=\"#使用-Symbol-来作为唯一标志\" class=\"headerlink\" title=\"使用 Symbol 来作为唯一标志\"></a>使用 Symbol 来作为唯一标志</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PROP_NAME = <span class=\"built_in\">Symbol</span>() <span class=\"comment\">//解救无意义的赋值</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> PROP_AGE = <span class=\"built_in\">Symbol</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">  [PROP_NAME]: <span class=\"string\">&#x27;一斤代码&#x27;</span>, <span class=\"comment\">//对象key值或是常量使用，原理相同</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj[PROP_AGE] = <span class=\"number\">18</span></span><br><span class=\"line\"></span><br><span class=\"line\">obj[PROP_NAME] <span class=\"comment\">// &#x27;一斤代码&#x27;</span></span><br><span class=\"line\">obj[PROP_AGE] <span class=\"comment\">// 18</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-Symbol-定义类的私有属性\"><a href=\"#使用-Symbol-定义类的私有属性\" class=\"headerlink\" title=\"使用 Symbol 定义类的私有属性\"></a>使用 Symbol 定义类的私有属性</h3><p>在 JS 中是没有私有变量的，雷伤所有定义的属性或是方法都是公开访问的。因此可能存在污染等情况，而有了 Symbol 以及模块化机制，类的私有属性和方法才能变成可能。</p>\n<p>在文件 a.js 中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PASSWORD = <span class=\"built_in\">Symbol</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Login</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">username, password</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.username = username</span><br><span class=\"line\">    <span class=\"built_in\">this</span>[PASSWORD] = password</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">checkPassword</span>(<span class=\"params\">pwd</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>[PASSWORD] === pwd</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Login</span><br></pre></td></tr></table></figure>\n\n<p>在文件 b.js 中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Login <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./a&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> login = <span class=\"keyword\">new</span> Login(<span class=\"string\">&#x27;admin&#x27;</span>, <span class=\"string\">&#x27;123456&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">login.checkPassword(<span class=\"string\">&#x27;admin&#x27;</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\">login.PASSWORD <span class=\"comment\">// oh!no!</span></span><br><span class=\"line\">login[PASSWORD] <span class=\"comment\">// oh!no!</span></span><br><span class=\"line\">login[<span class=\"string\">&#x27;PASSWORD&#x27;</span>] <span class=\"comment\">// oh!no!</span></span><br></pre></td></tr></table></figure>\n\n<p>由于 Symbol 常量 PASSWORD 被定义在 a.js 所在的模块中，外面的模块获取不到这个 Symbol,也不可能在创建一个一个一样的 Symbol 出来，所以这个 PASSWORD 只能被限制在 a.js 内部使用，达到一个私有化的效果</p>\n<h3 id=\"注册和获取全局-Symbol\"><a href=\"#注册和获取全局-Symbol\" class=\"headerlink\" title=\"注册和获取全局 Symbol\"></a>注册和获取全局 Symbol</h3><p>Symbol 在不同 window 中创建的 Symbol 实例总是唯一的，如果应用涉及到多个 window（ifram），并需要这些 window 使用的是同一个，那就不能使用 Symbol()了（若是微前端里面又是什么样的呢？有时间试试），这时可以使用 Symbol.for()，它来注册或获取一个 window 间全局的 Symbol 实例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> gs1 = <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">&#x27;global_symbol_1&#x27;</span>) <span class=\"comment\">//注册一个全局Symbol</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> gs2 = <span class=\"built_in\">Symbol</span>.for(<span class=\"string\">&#x27;global_symbol_1&#x27;</span>) <span class=\"comment\">//获取全局Symbol</span></span><br><span class=\"line\"></span><br><span class=\"line\">gs1 === gs2 <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>这时，在多个相关 window 间也是唯一的。</p>\n<h3 id=\"Symbol-iterator\"><a href=\"#Symbol-iterator\" class=\"headerlink\" title=\"Symbol.iterator\"></a>Symbol.iterator</h3><p>在 Symbol.iterator 出现后，JS 可以定义自己的迭代器<br>iterator 模式总是用同一种逻辑来遍历集合</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(Iterator it = c.iterater(); it.hasNext(); ) &#123; ... &#125;</span><br><span class=\"line\"><span class=\"comment\">//这样就在一定程度上解决了不同的数据类型需要不同的遍历方法</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> students = &#123;</span><br><span class=\"line\">  [<span class=\"built_in\">Symbol</span>.iterator]: <span class=\"function\"><span class=\"keyword\">function</span>* (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">yield</span> i</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> s <span class=\"keyword\">of</span> students) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(s)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//这个yield其实最后返回的就是iterator函数</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"yield\"><a href=\"#yield\" class=\"headerlink\" title=\"yield\"></a>yield</h2><p>yield 关键字用来暂停和恢复一个生成器函数.yield 关键字只能在生成器函数内部使用，用在其他地方会抛出错误。类似函数的 return 关键字，yield 关键字必须直接位于生成器函数定义中，出现在嵌套的非生成器函数中会抛出语法错误</p>\n<p>yield 关键字实际返回一个 IteratorResult 对象，它有两个属性，value 和 done。value 属性是对 yield 表达式求值的结果，而 done 是 false，表示生成器函数尚未完全完成。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">countAppleSales</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> saleList = [<span class=\"number\">3</span>, <span class=\"number\">7</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; saleList.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> saleList[i]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//一旦生成器函数已定义，可以通过一个构造一个迭代器来使用它</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> appleStore = countAppleSales() <span class=\"comment\">// Generator &#123; &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(appleStore.next()) <span class=\"comment\">// &#123; value: 3, done: false &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(appleStore.next()) <span class=\"comment\">// &#123; value: 7, done: false &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(appleStore.next()) <span class=\"comment\">// &#123; value: 5, done: false &#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(appleStore.next()) <span class=\"comment\">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类-class\"><a href=\"#类-class\" class=\"headerlink\" title=\"类 class\"></a>类 class</h2><p>面向对象编程中的一个核心概念就是类（多态、封装、继承）。可以把事物都抽象成一个个的类来描述他们的信息和行为。</p>\n<p>JavaScript 是一个基于对象的语言，而不是面对对象的语言，它是一个基于 prototype 的语言。它的语法中没有像 Java 之类典型面向对象语言中定义一个类的语法，因此在 ES6 中，提供了一个面向对象风格的类定义方式：使用 class 关键字。</p>\n<p>类里面所有的方法都定义在类的 prototype 上面</p>\n<p><strong>注意：类必须使用 new 调用，否则会报错。这是它和普通函数的一个主要区别，后者不用 new 也可以执行</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name, age</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">walk</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;I&#x27;m walking...&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">create</span>(<span class=\"params\">name, age</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//定义静态方法</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Person(name, age)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"constructor-NaN\"><a href=\"#constructor-NaN\" class=\"headerlink\" title=\"constructor\"></a>constructor</h3><ul>\n<li>是类的默认方法，通过 new 命令生成对象实例时，自动调用该方法，一个类必须有 constructor 方法，如果没有显示定义，一个空的 constructor 方法会被默认添加</li>\n<li>执行这个 constructor 方法默认返回实例对象（this）<h3 id=\"类的-prototype-属性\"><a href=\"#类的-prototype-属性\" class=\"headerlink\" title=\"类的 prototype 属性\"></a>类的 prototype 属性</h3></li>\n</ul>\n<p>类的所有方法都定义在类的 prototype 属性上面</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Point</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;&#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//等同于</span></span><br><span class=\"line\">Point.prototype = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span>&#123;&#125;,</span><br><span class=\"line\">  toString()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"class-的静态方法\"><a href=\"#class-的静态方法\" class=\"headerlink\" title=\"class 的静态方法\"></a>class 的静态方法</h3><p>如果在一个方法前，加上 static 关键字，就表示该方法不会被实例继承，而是直接通过类来调用，就是称为“静态方法”</p>\n<p><strong>注意：如果静态方法包含 this 关键字，这个 this 指向的是类，而不是实例</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Foo</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">classMethod</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Foo.classMethod() <span class=\"comment\">// &#x27;hello&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"keyword\">new</span> Foo()</span><br><span class=\"line\">foo.classMethod()</span><br></pre></td></tr></table></figure>\n<h3 id=\"super\"><a href=\"#super\" class=\"headerlink\" title=\"super\"></a>super</h3><p>super 关键字用于访问和调用一个对象的父对象的函数。( 只能在 class 内部用 )</p>\n<p>在构造函数中使用时，super 关键字将单独出现，并且必须在使用 this 之前使用。</p>\n<p>super 关键字也可以用来调用父对象上的函数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">super</span>([<span class=\"built_in\">arguments</span>])</span><br><span class=\"line\"><span class=\"comment\">// 调用 父对象/父类 的构造函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">super</span>.functionOnParent([<span class=\"built_in\">arguments</span>])</span><br><span class=\"line\"><span class=\"comment\">// 调用 父对象/父类 上的方法</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Polygon</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">construector</span>(<span class=\"params\">height, width</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;Polygon&#x27;</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.height = height</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.width = width</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayName</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Hi,I am a&#x27;</span>, <span class=\"built_in\">this</span>.name + <span class=\"string\">&#x27;.&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Square</span> <span class=\"keyword\">extends</span> <span class=\"title\">Polygon</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">length</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.height;</span><br><span class=\"line\">      <span class=\"comment\">// ReferenceError ,super 需要先被调用！</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       这里，它调用父类的构造函数的length,</span></span><br><span class=\"line\"><span class=\"comment\">       作为Polygon 的 width 和 height</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       <span class=\"built_in\">super</span>(length,length)</span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       注意，在派生的类中，在你可以使用this之前，必须 先调用super()。忽略这，这将导致引用错误。</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       <span class=\"built_in\">this</span>.name = <span class=\"string\">&#x27;Square&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> <span class=\"title\">area</span>()&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.height * <span class=\"built_in\">this</span>.width</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> <span class=\"title\">area</span>(<span class=\"params\">value</span>)&#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.area = value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>使用 super 调用父类的静态方法。</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Human</span></span>&#123;&#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">ping</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;ping&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">computer</span> <span class=\"title\">eatends</span> <span class=\"title\">Human</span></span>&#123; <span class=\"comment\">//使用extend 实现继承另一个类</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">pingpong</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.ping()+<span class=\"string\">&#x27;pong&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Computer.pingpong()</span><br></pre></td></tr></table></figure>\n\n<p><strong>原始 class 实现方式</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Parent</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Parent.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Child</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  Parent.call(<span class=\"built_in\">this</span>, name)</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//实现继承</span></span><br><span class=\"line\">Child.prototype = <span class=\"keyword\">new</span> Parent()</span><br><span class=\"line\">Child.prototype.constructor = Child</span><br><span class=\"line\"></span><br><span class=\"line\">Child.prototype.getAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.Age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> people = <span class=\"keyword\">new</span> Child(<span class=\"string\">&#x27;lily&#x27;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(people.getName())</span><br></pre></td></tr></table></figure>\n\n<p><strong>语法糖</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">construtor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getAge</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.age</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> people = <span class=\"keyword\">new</span> Child(<span class=\"string\">&quot;lily&quot;</span>,<span class=\"number\">20</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(people.getName())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"异步函数\"><a href=\"#异步函数\" class=\"headerlink\" title=\"异步函数\"></a>异步函数</h2><p>除了 javascript Promise , 异步函数进一步重写了传统的异步代码结构。</p>\n<h3 id=\"一个以-async-为前缀的常规函数\"><a href=\"#一个以-async-为前缀的常规函数\" class=\"headerlink\" title=\"一个以 async 为前缀的常规函数\"></a>一个以 async 为前缀的常规函数</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchdata</span>(<span class=\"params\">url</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在异步函数（Async-function-）内，使用-await-关键字调用异步操作函数\"><a href=\"#在异步函数（Async-function-）内，使用-await-关键字调用异步操作函数\" class=\"headerlink\" title=\"在异步函数（Async function ）内，使用 await 关键字调用异步操作函数\"></a>在异步函数（Async function ）内，使用 await 关键字调用异步操作函数</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getaSync</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\">    xhr.open(<span class=\"string\">&#x27;GET&#x27;</span>, url)</span><br><span class=\"line\">    xhr.onload = <span class=\"function\">() =&gt;</span> resolve(xhr.responseText)</span><br><span class=\"line\">    xhr.onerror = <span class=\"function\">() =&gt;</span> reject(xhr.statusText)</span><br><span class=\"line\">    xhr.send()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchdata</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> text1 = <span class=\"keyword\">await</span> getasync(<span class=\"string\">&#x27;test.txt&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.logtex(text1)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> text2 = <span class=\"keyword\">await</span> getasync(<span class=\"string\">&#x27;test2.text&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(text2)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> text3 = <span class=\"keyword\">await</span> getasync(<span class=\"string\">&#x27;text3.text&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(text3)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Finished&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fetchdata().then(<span class=\"function\">(<span class=\"params\">msg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(msg) <span class=\"comment\">//“test.txt”，“test2.txt”，“test3.txt”</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>在异步函数中，我们把异步函数 getasync() 当做是同步函数，没有 then() 方法或回调函数通知下一步。无论何时遇到关键字 await , 执行都会停止，直到 getasync() 解决，然后再转到异步函数中的下一行。结果与纯粹的基于 Promise , 使用一串 then 方法的方式一样</p>\n<h2 id=\"解构\"><a href=\"#解构\" class=\"headerlink\" title=\"解构\"></a>解构</h2><p>ES6 解构并非一个新的功能，而是一个新的复制语法，可以快速解压缩对象属性和数组中的值，并将它们分配给各个变量。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> profile = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;georage&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">39</span>, <span class=\"attr\">hobby</span>: <span class=\"string\">&#x27;Tennis&#x27;</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> &#123; name, hobby &#125; = profile</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//&#x27;georage&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(hobby) <span class=\"comment\">//&#x27;Tennis&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>这里我用解构快速提取 profile 对象的 name 和 hobby 属性。</p>\n<p>使用别名，你可以使用与你正在提取值的对象属性不同的变量名：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> profile = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;georage&#x27;</span>, <span class=\"attr\">age</span>: <span class=\"number\">39</span>, <span class=\"attr\">hobby</span>: <span class=\"string\">&#x27;Tennis&#x27;</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> &#123; <span class=\"attr\">name</span>: n, <span class=\"attr\">hobby</span>: h &#125; = profile</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(n) <span class=\"comment\">//&#x27;georage&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(h) <span class=\"comment\">//&#x27;Tennis&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"嵌套对象解构\"><a href=\"#嵌套对象解构\" class=\"headerlink\" title=\"嵌套对象解构\"></a>嵌套对象解构</h3><p>解构也可以与嵌套对象一起工作，可以使用它来快速解开来自复杂的 JSON 请求的值。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> jsondata = &#123;</span><br><span class=\"line\">  title: <span class=\"string\">&#x27;XX&#x27;</span>,</span><br><span class=\"line\">  details: &#123;</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      created: <span class=\"string\">&#x27;2017/09/19&#x27;</span>,</span><br><span class=\"line\">      modified: <span class=\"string\">&#x27;2017/09/20&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    catrgory: <span class=\"string\">&#x27;js&#x27;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  url: <span class=\"string\">&#x27;/baidu/&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> &#123;</span><br><span class=\"line\">  title,</span><br><span class=\"line\">  details: &#123;</span><br><span class=\"line\">    data: &#123; created, modified &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125; = jsondata</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(title)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(created)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(modified)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"解构数组\"><a href=\"#解构数组\" class=\"headerlink\" title=\"解构数组\"></a>解构数组</h3><p>数组的解构与对象上的工作方式类似，除了左边的花括号使用<strong>方括号</strong>代替：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> soccerteam = [<span class=\"string\">&#x27;George&#x27;</span>, <span class=\"string\">&#x27;Dennis&#x27;</span>, <span class=\"string\">&#x27;Sandy&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> [a, b] = soccerteam</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a) <span class=\"comment\">// &quot;George&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b) <span class=\"comment\">// &quot;Dennis&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>你可以跳过某些数组元素，通过使用 (,)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"keyword\">var</span> soccerteam = [<span class=\"string\">&#x27;George&#x27;</span>, <span class=\"string\">&#x27;Dennis&#x27;</span>, <span class=\"string\">&#x27;Sandy&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> [a,,b] = soccerteam</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a) <span class=\"comment\">// &quot;George&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b) <span class=\"comment\">// &quot;Sandy&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"解构赋值\"><a href=\"#解构赋值\" class=\"headerlink\" title=\"解构赋值\"></a>解构赋值</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> [a, b, c] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"comment\">//定义了三个变量，并对应赋了值；如果值的个数与变量名个数不匹配，没有对应上的变量值为 undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> [a, b, c=<span class=\"string\">&#x27;default&#x27;</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"comment\">//指定默认值，在定义变量时就指定了默认值，如果赋值时，没有给定内容，则会取默认值</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> [a, …b] = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"comment\">//这里 b 的值为[2，3]，这样可以快速使用剩余的数据赋值给变量，</span></span><br><span class=\"line\"><span class=\"comment\">//但实际使用中为了避免代码阅读的歧义，不推荐这么使用，仅作了解即可</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> [a,b,c] = <span class=\"string\">&#x27;yes&#x27;</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);<span class=\"comment\">//y</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b);<span class=\"comment\">//e</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c);<span class=\"comment\">//s</span></span><br></pre></td></tr></table></figure>\n\n<p>字符串的结构赋值会以单个字符串的方式进行赋值。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> &#123; length &#125; = <span class=\"string\">&#x27;yes&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(length) <span class=\"comment\">//3</span></span><br></pre></td></tr></table></figure>\n\n<p>以对象赋值的方法，如果名称是字符串的自带属性，则会获得属性值</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">&#123; a = <span class=\"number\">10</span>, b, c = <span class=\"number\">10</span> &#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">arguments</span>) <span class=\"comment\">//&#123; a: 1, b: 2 &#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a) <span class=\"comment\">//1</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(b) <span class=\"comment\">//2</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(c) <span class=\"comment\">//10</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test(obj)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Spread-操作符\"><a href=\"#Spread-操作符\" class=\"headerlink\" title=\"Spread 操作符\"></a>Spread 操作符</h2><p>spread(…)操作符也称作展开操作符，作用是讲可迭代的对象进行展开</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fruits = [<span class=\"string\">&#x27;apple&#x27;</span>, <span class=\"string\">&#x27;orange&#x27;</span>, <span class=\"string\">&#x27;peach&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> shoppingList = [<span class=\"string\">&#x27;t-shirt&#x27;</span>, ...fruits, <span class=\"string\">&#x27;egg&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// shoppingList的值：[&quot;t-shirt&quot;, &quot;apple&quot;, &quot;organe&quot;, &quot;peach&quot;, &quot;egg&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<p>Spread 操作符可以展开 Iterable 的对象，这样的话，除了数组之外，所有实现了 Symbol.iterator 的对象，如：Set, Map 和 Generator 等等，都可以使用 Spread 操作符。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> map = <span class=\"keyword\">new</span> <span class=\"built_in\">Map</span>()</span><br><span class=\"line\">map.set(<span class=\"string\">&#x27;a&#x27;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">map.set(<span class=\"string\">&#x27;b&#x27;</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr1 = [...map] <span class=\"comment\">//[[&quot;a&quot;, 1], [&quot;b&quot;, 2]]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> set = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>()</span><br><span class=\"line\">set.add(<span class=\"number\">1</span>)</span><br><span class=\"line\">set.add(<span class=\"number\">2</span>)</span><br><span class=\"line\">set.add(<span class=\"number\">1</span>)</span><br><span class=\"line\">set.add(<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [...set] <span class=\"comment\">//[1, 2, 3]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">myGen</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;world&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [...myGen()] <span class=\"comment\">//[&quot;hello&quot;, &quot;world&quot;]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"默认和剩余参数\"><a href=\"#默认和剩余参数\" class=\"headerlink\" title=\"默认和剩余参数\"></a>默认和剩余参数</h2><h3 id=\"默认参数\"><a href=\"#默认参数\" class=\"headerlink\" title=\"默认参数\"></a>默认参数</h3><p>在这之前我们都使用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getarea</span>(<span class=\"params\">w, h</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = w || <span class=\"number\">10</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> h = h || <span class=\"number\">15</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> w * h</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有了 ES6 对默认参数的支持后</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getarea</span>(<span class=\"params\">w = <span class=\"number\">10</span>, h = <span class=\"number\">15</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> w * h</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getarea(<span class=\"number\">5</span>) <span class=\"comment\">//75</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"剩余参数-（Rest-Parameters）\"><a href=\"#剩余参数-（Rest-Parameters）\" class=\"headerlink\" title=\"剩余参数 （Rest Parameters）\"></a>剩余参数 （Rest Parameters）</h3><p>ES6 中的 Rest Parameters 使得将函数参数转换成数组的操作变得简单。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addit</span>(<span class=\"params\">...theNumber</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//get the sum of the array elements</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> theNumber.reduce(<span class=\"function\">(<span class=\"params\">prevnum.curnum</span>) =&gt;</span> prevnu + curnum, <span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">addit(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>) <span class=\"comment\">//10</span></span><br></pre></td></tr></table></figure>\n\n<p>通过在命名参数前添加 3 个点。在该位置和之后输入到函数中的参数将自动转换为数组。</p>\n<p>没有 Rest Parameters 则会手动将参数转换为数组 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addit</span>(<span class=\"params\">theNumbers</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// force arguments object into array</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> numArray = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> numArray.reduce(<span class=\"function\">(<span class=\"params\">prevnum, curnum</span>) =&gt;</span> prevnum + curnum, <span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">addit(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>) <span class=\"comment\">// returns 10</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">...[a, b, c]</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a + b + c</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">f(<span class=\"number\">1</span>) <span class=\"comment\">// NaN (b and c are undefined)</span></span><br><span class=\"line\">f(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">// 6</span></span><br><span class=\"line\">f(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>) <span class=\"comment\">//6 (the fourth parameter is not destructured)</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Generator-函数\"><a href=\"#Generator-函数\" class=\"headerlink\" title=\"Generator 函数\"></a>Generator 函数</h2><p>Generator 函数是协程在 ES6 的实现，最大特点就是可以交出函数的执行权（即暂停执行）。协程：多个现成互相协作，完成异步任务。</p>\n<p>协程有点像函数，又有点想线程。他的运行流程大致如下：</p>\n<ul>\n<li>第一步，协程 A 开始执行。</li>\n<li>第二步，协程执行懂啊一半，进入暂停，执行权转移到协程 B。</li>\n<li>第三步，一段时间后协程 B 交换执行权。</li>\n<li>第四步，协程 A 恢复执行。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">gen</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> y = <span class=\"keyword\">yield</span> x + <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> y</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面整个代码就是一个封装的异步任务，或者说是异步任务的容器。异步操作需要暂停的地方，都用 yield 语句注明。Generator 函数的执行方法如下。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> g = gen(<span class=\"number\">1</span>)</span><br><span class=\"line\">g.next() <span class=\"comment\">// &#123; value: 3, done: false &#125;</span></span><br><span class=\"line\">g.next() <span class=\"comment\">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>next 方法的作用是分阶段执行 Generator 函数。每次调用 next 方法，返回一个对象，表示当前阶段的信息（value 和 done 属性）。value 属性是 yield 语法后面表达式的值。表示当前阶段的值；done 属性是一个布尔值，表示 Generator 函数是否执行完毕，即是否还有下一个阶段。</p>\n<p>这是一个生成器的例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">genFn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;begin&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value = <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;a&#x27;</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(value) <span class=\"comment\">// &#x27;B&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;end&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> gen = genFn()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> gen) <span class=\"comment\">// &#x27;object&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> g1 = gen.next()</span><br><span class=\"line\">g1.value <span class=\"comment\">// &#x27;a&#x27;</span></span><br><span class=\"line\">g1.done <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> g2 = gen.next(<span class=\"string\">&#x27;B&#x27;</span>)</span><br><span class=\"line\">g2.value <span class=\"comment\">// &#x27;end&#x27;</span></span><br><span class=\"line\">g2.done <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"字符串扩展\"><a href=\"#字符串扩展\" class=\"headerlink\" title=\"字符串扩展\"></a>字符串扩展</h2><h3 id=\"字符串内容测试\"><a href=\"#字符串内容测试\" class=\"headerlink\" title=\"字符串内容测试\"></a>字符串内容测试</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.includes(<span class=\"string\">&#x27;c&#x27;</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.includes(<span class=\"string\">&#x27;ye&#x27;</span>) <span class=\"comment\">//false</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.startsWith(<span class=\"string\">&#x27;a&#x27;</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.endswidth(<span class=\"string\">&#x27;f&#x27;</span>) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"comment\">//includes(), startsWith(), endsWith() 都支持第二个参数，</span></span><br><span class=\"line\"><span class=\"comment\">//类型为数字类型，意为从第 n 个字符开始，endsWith()的第二个参数有点不一样</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.includes(<span class=\"string\">&#x27;c&#x27;</span>, <span class=\"number\">4</span>) <span class=\"comment\">//false 从第5个字符开始查找是否有 &#x27;c&#x27; 这个字符</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.startsWith(<span class=\"string\">&#x27;d&#x27;</span>, <span class=\"number\">3</span>) <span class=\"comment\">//true 从第4个字符开始查找是否是以 &#x27;d&#x27; 字符为开头</span></span><br><span class=\"line\"><span class=\"string\">&#x27;abcdef&#x27;</span>.endsWith(<span class=\"string\">&#x27;d&#x27;</span>, <span class=\"number\">4</span>) <span class=\"comment\">//true 前面的4个字符里，是否以 &#x27;d&#x27; 字符为结尾</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>字符串重复输出：</strong><br>这个方法接受一个整数参数，表示要将字符串复制多少次，然后返回拼接所有副本后的结果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;a&#x27;</span>.repeat(<span class=\"number\">5</span>) <span class=\"comment\">//aaaaa 重复输出5遍</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"模板字符串\"><a href=\"#模板字符串\" class=\"headerlink\" title=\"模板字符串(``)\"></a>模板字符串(``)</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">authorize</span>(<span class=\"params\">user, action</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!user.hasPrivilege(action)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">`用户 <span class=\"subst\">$&#123;user.name&#125;</span> 未被授权执行 <span class=\"subst\">$&#123;action&#125;</span> 操作。`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这个示例中，<code>$&#123;user.name&#125;</code>,<code>$&#123;action&#125;</code>被称为模板占位符，javascript 将把 user.name 和 action 的值插入到最终生成的字符串中。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">&#x27;#warning&#x27;</span>).html(<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">  &lt;h1&gt;小心！&gt;/h1&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &lt;p&gt;未经授权打冰球可能受罚</span></span><br><span class=\"line\"><span class=\"string\">  将近<span class=\"subst\">$&#123;maxPenalty&#125;</span>分钟。&lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\">`</span>)</span><br></pre></td></tr></table></figure>\n\n<p>模板字符串中所有的空格、新进、缩进，都会原样输出在生成的字符串中。</p>\n<h3 id=\"原生支持模板语言\"><a href=\"#原生支持模板语言\" class=\"headerlink\" title=\"原生支持模板语言\"></a>原生支持模板语言</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//es5</span></span><br><span class=\"line\">$(<span class=\"string\">&#x27;#result&#x27;</span>).append(</span><br><span class=\"line\">  <span class=\"string\">&#x27;There are &lt;b&gt;&#x27;</span> +</span><br><span class=\"line\">    basket.count +</span><br><span class=\"line\">    <span class=\"string\">&#x27;&lt;/b&gt; &#x27;</span> +</span><br><span class=\"line\">    <span class=\"string\">&#x27;items in your basket, &#x27;</span> +</span><br><span class=\"line\">    <span class=\"string\">&#x27;&lt;em&gt;&#x27;</span> +</span><br><span class=\"line\">    basket.onSale +</span><br><span class=\"line\">    <span class=\"string\">&#x27;&lt;/em&gt; are on sale!&#x27;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"comment\">//es6</span></span><br><span class=\"line\"><span class=\"comment\">//在es6中，内容模板，可以定义在 `` 包起来的字符串中，其中的内容会保持原有格式</span></span><br><span class=\"line\"><span class=\"comment\">//另外可以在字符串中直接使用模板语言进行变量填充，优雅而简洁</span></span><br><span class=\"line\">$(<span class=\"string\">&#x27;#result&#x27;</span>).append(<span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">  There are &lt;b&gt;<span class=\"subst\">$&#123;basket.count&#125;</span>&lt;/b&gt; items</span></span><br><span class=\"line\"><span class=\"string\">   in your basket, &lt;em&gt;<span class=\"subst\">$&#123;basket.onSale&#125;</span>&lt;/em&gt;</span></span><br><span class=\"line\"><span class=\"string\">  are on sale!</span></span><br><span class=\"line\"><span class=\"string\">`</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字符串遍历输出\"><a href=\"#字符串遍历输出\" class=\"headerlink\" title=\"字符串遍历输出\"></a>字符串遍历输出</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//for ...of 格式为 es6 中的 Iterator 迭代器的输出方式</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> c <span class=\"keyword\">of</span> <span class=\"string\">&#x27;abc&#x27;</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(c)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//a</span></span><br><span class=\"line\"><span class=\"comment\">//b</span></span><br><span class=\"line\"><span class=\"comment\">//c</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字符串补全\"><a href=\"#字符串补全\" class=\"headerlink\" title=\"字符串补全\"></a>字符串补全</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//参数1：[number] 目标字符串长度</span></span><br><span class=\"line\"><span class=\"comment\">//参数2：[string] 进行补全的字符串</span></span><br><span class=\"line\"><span class=\"string\">&#x27;12345&#x27;</span>.padStart(<span class=\"number\">7</span>, <span class=\"string\">&#x27;0&#x27;</span>) <span class=\"comment\">//0012345 - 字符串不足7位，在头部补充不足长度的目标字符串</span></span><br><span class=\"line\"><span class=\"string\">&#x27;12345&#x27;</span>.padEnd(<span class=\"number\">7</span>, <span class=\"string\">&#x27;0&#x27;</span>) <span class=\"comment\">//1234500 - 在尾部进行字符串补全</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字符串迭代与结构\"><a href=\"#字符串迭代与结构\" class=\"headerlink\" title=\"字符串迭代与结构\"></a>字符串迭代与结构</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> message = <span class=\"string\">&#x27;abc&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> stringIterator = message[<span class=\"built_in\">Symbol</span>.iterator]()</span><br><span class=\"line\">stringIterator.next() <span class=\"comment\">//&#123;value:a,done:false&#125;</span></span><br><span class=\"line\">stringIterator.next() <span class=\"comment\">//&#123;value:b,done:false&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>或是用 for of</p>\n<h2 id=\"数组扩展\"><a href=\"#数组扩展\" class=\"headerlink\" title=\"数组扩展\"></a>数组扩展</h2><h3 id=\"Array-from\"><a href=\"#Array-from\" class=\"headerlink\" title=\"Array.from()\"></a>Array.from()</h3><p>从一个类似数组或可迭代对象中创建一个新的数组实例。</p>\n<h3 id=\"合并数组\"><a href=\"#合并数组\" class=\"headerlink\" title=\"合并数组\"></a>合并数组</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"keyword\">let</span> b = [<span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"keyword\">let</span> c = [<span class=\"number\">2</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"keyword\">let</span> d = [...a, ...b, ...c] <span class=\"comment\">//[1, 2, 3, 2, 4] 所有内容合并，但并不会去除重复</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"快速转换为数组\"><a href=\"#快速转换为数组\" class=\"headerlink\" title=\"快速转换为数组\"></a>快速转换为数组</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.of(<span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>) <span class=\"comment\">//[3,4,5]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"内容过滤\"><a href=\"#内容过滤\" class=\"headerlink\" title=\"内容过滤\"></a>内容过滤</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//判断对象是否为数组</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"built_in\">Array</span>.isArray(obj))&#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>].includes(<span class=\"number\">5</span>);<span class=\"comment\">//false，检索数据中是否有5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//找出第一个匹配表达式的结果，注意是只要匹配到一项，函数即会返回</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, -<span class=\"number\">4</span>, <span class=\"number\">10</span>].find(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value &lt; <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);<span class=\"comment\">//-4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//找出第一个匹配表达式的结果下标</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, -<span class=\"number\">4</span>, <span class=\"number\">10</span>].findIndex(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value &lt; <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);<span class=\"comment\">//2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//排除负数内容</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, -<span class=\"number\">4</span>, <span class=\"number\">10</span>].filter(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> item &gt; <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);<span class=\"comment\">//[1, 3, 10]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"对象扩展\"><a href=\"#对象扩展\" class=\"headerlink\" title=\"对象扩展\"></a>对象扩展</h2><h3 id=\"可计算属性\"><a href=\"#可计算属性\" class=\"headerlink\" title=\"可计算属性\"></a>可计算属性</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> nameKey = <span class=\"string\">&#x27;name&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> ageKey = <span class=\"string\">&#x27;27&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> jobKey = <span class=\"string\">&#x27;job&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> person = &#123;</span><br><span class=\"line\">  [nameKey]: <span class=\"string\">&#x27;matt&#x27;</span>,</span><br><span class=\"line\">  [ageKey]: <span class=\"number\">27</span>,</span><br><span class=\"line\">  [jobKey]: <span class=\"string\">&#x27;software engineer&#x27;</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可变 key 是在申明时进行值赋值，而不是地址赋值，就算使用对象作为 key 值，key 值在之后也不是可变的</p>\n<h3 id=\"属性的简洁表示\"><a href=\"#属性的简洁表示\" class=\"headerlink\" title=\"属性的简洁表示\"></a>属性的简洁表示</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//直接使用变量/常量的名称个为对象属性的名称</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"string\">&#x27;abc&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> b = &#123; a &#125; <span class=\"comment\">//&#123;a: &#x27;abc&#x27;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; x, y &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//等效于</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; <span class=\"attr\">x</span>: x, <span class=\"attr\">y</span>: y &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> o = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">f</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//等效于</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> o = &#123;</span><br><span class=\"line\">  f: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对象内容合并\"><a href=\"#对象内容合并\" class=\"headerlink\" title=\"对象内容合并\"></a>对象内容合并</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;,</span><br><span class=\"line\">  b = &#123; <span class=\"attr\">b</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">  c = &#123; <span class=\"attr\">b</span>: <span class=\"number\">4</span>, <span class=\"attr\">c</span>: <span class=\"number\">5</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> d = <span class=\"built_in\">Object</span>.assign(a, b, c)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(d) <span class=\"comment\">//&#123;a:1,b:4,c:5&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a) <span class=\"comment\">//&#123;a:1,b:4&#125;</span></span><br><span class=\"line\"><span class=\"comment\">//上面的合并方式会同时更新 a 对象的内容，a 的属性如果有多次合并会被更新数据，</span></span><br><span class=\"line\"><span class=\"comment\">//但自身没有的属性，其它对象有的属性不会被添加到 a 身上；</span></span><br><span class=\"line\"><span class=\"comment\">//参数列中的对象只会影响第一个，后面的参数对象不会被修改数据</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//推荐使用这种方式进行对象数据合并</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> a = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;,</span><br><span class=\"line\">  b = &#123; <span class=\"attr\">b</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">  c = &#123; <span class=\"attr\">b</span>: <span class=\"number\">4</span>, <span class=\"attr\">c</span>: <span class=\"number\">5</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> d = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, a, b, c) <span class=\"comment\">//第一个参数增加一个空对象，在合并时让它被更新，不影响实际的对象变量内容</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(d) <span class=\"comment\">//&#123;a:1,b:4,c:5&#125;//与上面的方式合并结果一致，使用这种方式, a 对象的内容就不会被影响了</span></span><br></pre></td></tr></table></figure>\n\n<p>对象内容合并的方向是从参数顺序的后向前合并</p>\n<h3 id=\"对象内容集合\"><a href=\"#对象内容集合\" class=\"headerlink\" title=\"对象内容集合\"></a>对象内容集合</h3><h4 id=\"Object-keys\"><a href=\"#Object-keys\" class=\"headerlink\" title=\"Object.keys()\"></a>Object.keys()</h4><p>获取对象中所有的键名，以数组的形式返回</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"built_in\">Object</span>.keys(obj) <span class=\"comment\">//[&#x27;a&#x27;,&#x27;b,]</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Object-values\"><a href=\"#Object-values\" class=\"headerlink\" title=\"Object.values()\"></a>Object.values()</h4><p>获取对象中所有值内容，以数组的形式返回</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> values = <span class=\"built_in\">Object</span>.values(obj) <span class=\"comment\">//[1,2]</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Object-entries\"><a href=\"#Object-entries\" class=\"headerlink\" title=\"Object.entries()\"></a>Object.entries()</h4><p>获得对象中所有成员的数据，以数组的形式返回，成员的内容也是数组形式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">1</span>, <span class=\"attr\">b</span>: <span class=\"number\">2</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> values = <span class=\"built_in\">Object</span>.entries(obj) <span class=\"comment\">//[[&#x27;a&#x27;,1],[&#x27;b&#x27;,2]]</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"对象内容测试\"><a href=\"#对象内容测试\" class=\"headerlink\" title=\"对象内容测试\"></a>对象内容测试</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//判断对象是否为数组对象</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.isArray(someobj)) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//判断目标对象是否为空对象</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (someobj &amp;&amp; <span class=\"built_in\">Object</span>.keys(someobj).length);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Map\"><a href=\"#Map\" class=\"headerlink\" title=\"Map\"></a>Map</h3><p>Map 的用法和普通对象基本一致，但是主要差异是，Map 实例会维护键值对的插入顺序，因此可以根据插入顺序执行迭代操作。</p>\n<p>对象和映射之间存在着显著的内存和性能问题：</p>\n<ul>\n<li>在给定固定大小的内存时，Map 大约可以比 Object 多存储 50% 的键/值对。</li>\n<li>Map 在所有的浏览器中一般会比 Object 的插入速度快</li>\n<li>从大型 Object 和 Map 中查找键/值对，则 Object 有时候速度会更快。在把 Object 当成数组使用的情况下（比如使用连续整数作为属性），浏览器引擎可以进行优化，在内存中使用更高效的布局。对于这两个类型而言，查找书读不会随着键/值对数量增加而现行增加，如果代码设计大量查找操作，那么某些情况下可能选 Object 更好</li>\n<li>Object 的 delete 性能很差，在现在很多浏览器依然如此，Map 的 delete 操作都比插入和查找更快，如果代码涉及大量删除操作，那么毫无以为应该选择 map</li>\n</ul>\n<p>(思考：vue 中的 data 数据使用 Map 是什么样的呢？)</p>\n<p>先看一下它能用非法字符串或者数字作为 key 的特性。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> map = <span class=\"built_in\">Map</span>()</span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123; <span class=\"attr\">p</span>: <span class=\"string\">&#x27;hellow&#x27;</span> &#125;</span><br><span class=\"line\">map.set(obj, <span class=\"string\">&#x27;ok&#x27;</span>) <span class=\"comment\">//ok</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj) <span class=\"comment\">//&#123; p: &#x27;hellow&#x27; &#125;</span></span><br><span class=\"line\">map.get(obj) <span class=\"comment\">//ok</span></span><br><span class=\"line\">map.has(obj) <span class=\"comment\">//true</span></span><br><span class=\"line\">map.delete(obj) <span class=\"comment\">//true</span></span><br><span class=\"line\">map.has(obj) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<p>需要使用 new Map()初始化一个实例。</p>\n<ul>\n<li>size:获取成员数量</li>\n<li>set:设置成员 key 和 value</li>\n<li>get:获取成员属性值</li>\n<li>has:判断成员是否存在</li>\n<li>delete:删除成员</li>\n<li>clear:清空所有</li>\n<li>keys():返回键名的遍历器</li>\n<li>values():返回键值的遍历器</li>\n<li>entries():返回所有成员的遍历器</li>\n<li>forEach():遍历 Map 的所有成员</li>\n</ul>\n<h3 id=\"set-对象-（可用于去重）\"><a href=\"#set-对象-（可用于去重）\" class=\"headerlink\" title=\"set 对象 （可用于去重）\"></a>set 对象 （可用于去重）</h3><p>set 独享允许你存储任何类型唯一值，无论是原始值或是对象。NaN 之间视为相同的值。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> set1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>([<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"literal\">NaN</span>, <span class=\"literal\">NaN</span>, <span class=\"number\">5</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.has(<span class=\"number\">1</span>)) <span class=\"comment\">// expected output: true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.has(<span class=\"number\">5</span>)) <span class=\"comment\">// expected output: true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(set1.has(<span class=\"number\">6</span>)) <span class=\"comment\">// expected output:false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Array</span>.from(set1)) <span class=\"comment\">// Array [1, 2, 3, 4, NaN, 5]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"定型数组\"><a href=\"#定型数组\" class=\"headerlink\" title=\"定型数组\"></a>定型数组</h3><p>所谓定型数组，就是将任何数字转换成一个包含数字比特的数组，随后就可以通过 JS 数组进一步处理</p>\n<p>在 JavaScript 中，数字类型变量都是以 64 位浮点型数据格式存储；比如新建一个只需要 8 比特的整数，也需要为其开辟 64 位存储空间，浪费资源，效率也低。而 CanvasFloatArray 需要的是 Float32Array</p>\n<p>所有与定型数组有关的操作和对象都集中在这 8 个数据类型上，但是在使用他们之前，需要穿件一个数组缓冲区存储这些数据</p>\n<p>数据缓冲区是所有定型数组的根基，它是一段可以包含特定数量字节的内存地址。</p>\n<h2 id=\"isInteger-与安全整数\"><a href=\"#isInteger-与安全整数\" class=\"headerlink\" title=\"isInteger 与安全整数\"></a>isInteger 与安全整数</h2><p>isInteger 用于判断一个数值是否为整数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Number</span>.isInteger(<span class=\"number\">1</span>)) <span class=\"comment\">//  true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">Number</span>.isInteger(<span class=\"number\">1.0</span>)) <span class=\"comment\">//true</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(Nmber.isInteger(<span class=\"number\">1.01</span>)) <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n\n<p>为了鉴别整数是否在安全范围科研使用 Number.isSafeInteger()方法</p>\n<h2 id=\"生成器\"><a href=\"#生成器\" class=\"headerlink\" title=\"生成器\"></a>生成器</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">generatorFn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;foo&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;bar&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;baz&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> generatorObject1 = generatorFn()</span><br><span class=\"line\"><span class=\"keyword\">let</span> generatorObject2 = generatorFn()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(generatorObject1.next()) <span class=\"comment\">//&#123;done:false,value:&#x27;foo&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(generatorObject2.next()) <span class=\"comment\">//&#123;done:false,value:&#x27;foo&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(generatorObject2.next()) <span class=\"comment\">//&#123;done:false,value:&#x27;bar&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(generatorObject1.next()) <span class=\"comment\">//&#123;done:false,value:&#x27;bar&#x27;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>也可以用 for of 对 generatorObject1 进行迭代，那这个可以结合 promise 使用吗？是可以的，就是用 yield 实现了 await</strong>。async 和 await，比起星号和 yield，语义更清楚了。async 表示函数里有异步操作，await 表示紧跟在后面的表达式需要等待结果。co 函数库约定，yield 命令后面只能是 Thunk 函数或 Promise 对象，而 async 函数的 await 命令后面，可以跟 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。</p>\n<h3 id=\"使用-yield-实现递归算法\"><a href=\"#使用-yield-实现递归算法\" class=\"headerlink\" title=\"使用 yield* 实现递归算法\"></a>使用 yield* 实现递归算法</h3><p>yield* 表达式迭代操作数，并产生它返回的每个值</p>\n<p>yield* 表达式本身的值是当迭代器关闭时返回的值（即 done 为 true）时</p>\n<p>yield*最有用的地方是实现递归操作，此时生成器可以产生自身：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">nTimes</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">yield</span>* nTimes(n - <span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> n - <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> x <span class=\"keyword\">of</span> nTimes(<span class=\"number\">3</span>)) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(x)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//0</span></span><br><span class=\"line\"><span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"comment\">//2</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"箭头函数\"><a href=\"#箭头函数\" class=\"headerlink\" title=\"箭头函数\"></a>箭头函数</h2><p><strong>箭头函数不能作为构造函数</strong>：</p>\n<p>箭头函数没有自己的 this,arguments,super 或 new.target。箭头函数表达式更实用于那些需要匿名函数的地方，并且它不能用作构造函数，和 new 一起用会抛出错误，箭头函数没有 prototype 属性。</p>\n<p>箭头函数是有<em>proto</em>属性的，所以箭头函数本身是存在原型链的，他也是有自己的构造函数的，但是因为没有 prototype 属性，他的实例<em>proto</em>没法指向，所以箭头函数也就无法作为构造函数。</p>\n<p>同时箭头函数由于没有 this 指针，通过 call()和 apply 方法调用一个函数时，只能传递参数，不能绑定 this。</p>"},{"title":"node中间层及简单api编写","date":"2021-04-20T06:49:27.000Z","_content":"\nNode.js 对前端来说无疑具有里程碑意义，尤其是在越来越流行的今天，掌握 Node.js 技术已经不仅仅是加分项，而是前端攻城师们需要去掌握的一项技能。\n\n<!--more-->\n\n## Node.js 是什么\n\n简单的说 Node.js 就是一个 javascript 运行环境。它让 javascript 可以开发后端程序，实现几乎其他后端语言实现的所有功能，可以与 PHP、Java、Python、.NET、Ruby 等后端语言一较高下。\n\nNode.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。\n\nNode.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。\n`Node.js = Runtime Environment + JavaScript Library`\n\n## Node.js 优势\n\n- **Nodejs 语法完全是 js 语法**\n  只要你懂 js 基础就可以学会 Nodejs 后端开发，对前端开发者友好。\n- **NodeJs 超强的高并发能力**\n  放弃了“为每一个用户连接创建一个新线程”的思想，通过非阻塞 I/O、事件驱动机制，让 Node.js 程序宏观上也是并行的。\n- **实现高性能服务器**\n  严格地说，Node.js 是一个用于开发各种 web 服务器的开发工具。在 Node.js 服务器中，运行的是高性能 V8 JavaScript 脚本语言，该语言是一种可以运行在服务器端的脚本语言。\n\n  Node.js 自身哲学，是话最小的硬件成本，追求更高的并发，更高的处理性能。\n\n## Node.js 特点\n\n异步事件驱动、非堵塞 I/O\n\n- **Node.js 使用事件驱动模型，当 web server 接收到请求，就把它关闭然后进行处理，然后去服务下一个 web 请求。**\n  当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。\n  这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。（这也被称之为非阻塞式 IO 或者事件驱动 IO）\n\n  在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数\n\n- **单线程**\n\n  Nodejs 跟 Nginx 一样都是单线程为基础的，这里的单线程指主线程为单线程，所有的阻塞的全部放入一个线程池中，然后主线程通过队列的方式跟线程池来协作。我们写 js 部分不需要关心线程的问题，简单了解就可以了，主要由一堆 callback 回调构成的，然后主线程在循环过在适当场合调用。\n\n- **性能出众**\n\n  底层选择用 c++和 v8 来实现的，上面第一点讲到过，nodejs 的事件驱动机制，这意味着面对大规模的 http 请求，nodejs 是凭借事件驱动来完成的，性能部分是不用担心的，并且很出色。\n\n## Node.js 应用实例\n\n```javascript\nconst http = require('http');\n\nconst hostname = '127.0.0.1';\nconst port = 3000;\n\nconst server = http.createServer((req, res) => {\n  res.statusCode = 200;\n  res.setHeader('Content-Type', 'text/plain');\n  res.end('Hello World');\n});\n\nserver.listen(port, hostname, () => {\n  console.log(`Server running at http://${hostname}:${port}/`);\n```\n\n## Express 简介\n\nExpress 是一个简洁而灵活的 node.js Web 应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。\n\n使用 Express 可以快速地搭建一个完整功能的网站。\n\nExpress 框架核心特性：\n\n- 可以设置中间件来响应 HTTP 请求。\n- 定义了路由表用于执行不同的 HTTP 请求动作。\n- 可以通过向模板传递参数来动态渲染 HTML 页面。\n- 介绍就先告一段落了，接下来通过一个项目实例来进行 node 搭建服务的讲解\n\n## Node 简单的 api 编写\n\n### 前言\n\n此章节采用项目实例直接演示如何实现简单 API 的编写。前端项目采用的技术栈是基于 Vue + Antdv，用 vue-cli 构建前端界面，后端项目采用的技术栈是基于 Node.js + Express + MySQL，用 Express 搭建的后端服务器。\n\n### 前端部分\n\n使用 Vue + antdv，用 vue-cli 构建前端项目\n\n#### 目录结构\n\n```m\n│ package.json // npm 包管理所需模块及配置信息\n│ vue.config.js // webpack 配置\n├─public\n│ favicon.ico // 图标\n│ index.html // 入口 html 文件\n└─src\n│ App.vue // 根组件\n│ main.js // 程序入口文件\n│ permission.js // 权限拦截\n│ globla.less // 全局样式\n├─api\n│ task.js // 任务模块接口\n│ user.js // 用户模块接口\n├─assets // 存放公共图片文件夹\n├─components\n│ ProLayout // Pro 布局组建\n├─layouts\n│ index.js // 布局整合\n│ UserLayout.vue // 用户布局\n│ BasicLayout.vue // 基本布局\n├─core\n│ lazy_use.js // 懒加载使用的 antd 等\n├─router\n│ index.js // 单页面路由注册组件\n├─store\n│ │ index.js // 状态管理仓库入口文件\n│ │ getters.js // getter\n│ │ mutation-types.js // store 使用的常量\n│ └─modules\n│ user.js // 用户模块状态管理文件\n├─utils\n│ axios.js // 安装 axios 插件\n│ domUtils.js // 操作页签 title\n│ request.js // axios 封装与拦截器配置\n└─views\nuser // 用户模块页面\ntask // 任务模块页面\n404.vue // 404 页面\n```\n\n### MySQL 与 Navicat\n\nMySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 是最好的 RDBMS(Relational Database Management System：关系数据库管理系统)应用软件之一。\n\nNavicat premium 是一款数据库管理工具,是一个可多重连线资料库的管理工具，它可以让你以单一程式同时连线到 MySQL、SQLite、Oracle 及 PostgreSQL 资料库，让管理不同类型的资料库更加的方便。\n\n#### 数据库设计部分\n\n使用 MYSQL，创建数据库 todo，创建 sys_user 用户表及创建 sys_task 任务表\n\n-创建数据库--\n\n`CREATE DATABASE `todo` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;`\n--创建用户表--\n\n```javascript\nDROP TABLE IF EXISTS `sys_user`;\nCREATE TABLE `sys_user` (\n`id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '唯一标识',\n`username` VARCHAR(50) NOT NULL COMMENT '登录帐号',\n`password` VARCHAR(64) NOT NULL  COMMENT '登录密码',\n`nickname` VARCHAR(50) NULL DEFAULT '' COMMENT '昵称',\n`avator` VARCHAR(50) NULL DEFAULT '' COMMENT '用户头像',\n`sex` int(3) NULL DEFAULT 0 COMMENT '性别：0:未知, 1:男, 2:女',\n`gmt_create` BIGINT(13) NOT NULL COMMENT '创建时间',\n`gmt_modify` BIGINT(13) NOT NULL COMMENT '修改时间',\n PRIMARY KEY (`id`) USING BTREE,\n UNIQUE KEY `username_UNIQUE` (`username`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 COMMENT='用户表';\n```\n\n--创建任务表--\n\n```javascript\nDROP TABLE IF EXISTS `sys_task`;\nCREATE TABLE `sys_task` (\n`id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '唯一标识',\n`title` varchar(100) NOT NULL COMMENT '任务名称',\n`description` varchar(255) NOT NULL COMMENT '任务内容',\n`status` int(3) NULL DEFAULT 0 COMMENT '任务状态：0:待办 1:完成 2:删除',\n`gmt_create` bigint(13) NOT NULL COMMENT '创建时间',\n`gmt_expire` bigint(13) NOT NULL COMMENT '截止日期',\nPRIMARY KEY (`id`) USING BTREE\n) ENGINE=InnoDB AUTO_INCREMENT=1 COMMENT='任务表';\n```\n\n### 后端部分\n\n使用 Node.js + Express + MySQL，搭建的后端服务器。\n\n#### 目录结构\n\n```m\n│  app.js                             // 入口文件\n│  package.json                       // npm包管理所需模块及配置信息\n│  bin\n│      www                            // start程序运行文件\n│  config\n│      db.js                          // mysql数据库基础配置\n├─db\n│      mysql.js                       // 封装连接mysql模块\n├─routes\n│      index.js                       // 初始化路由信息，引入auth中间件\n│      tasks.js                       // 任务路由模块\n│      users.js                       // 用户路由模块\n├─controllers\n│      index.js                 \t\t\t // 业务逻辑处理 - 入口\n│      tasks.js                 \t\t\t // 业务逻辑处理 - 任务相关接口\n│      users.js                 \t\t\t // 业务逻辑处理 - 用户相关接口\n└─utils\n        constant.js                   // 自定义常量\n        crypto.js                     // 加密标准实现方法\n        jwtAuth.js                    // jwt-token验证和解析函数\n        resHandler.js                 // 包装统一返回格式\n```\n\n#### 技术栈\n\n后端登录注册功能使用了 jwt-token 认证模式来实现。使用 express、express-validator、jsonwebtoken、express-jwt、mySQL 组件库来简化开发。\n\n- express：提供了创建 Web 服务器的最简单但功能最强大的方法之一。\n- express-validator：一个基于 Express 的数据验证中间件，可以方便的判断传入的表单数据是否合法。\n- jsonwebtoken：基于 jwt 的概念实现安全的加密方案库，实现加密 token 和解析 token 的功能。\n- express-jwt：express-jwt 是在 jsonwebtoken 的基础上做了上层封装，基于 Express 框架下认证 jwt 的中间件，来实现 jwt 的认证功能。\n- http-errors：轻松创建 Express，Koa，Connect 等的 HTTP 错误。\n- mysql：Node.js 连接 MySQL 数据库。\n- nodemon：实现实时热更新，自动重启项目。\n\n#### 功能模块\n\n- 用户模块：登录、注册\n- 任务模块：todoList 增删改查\n\n#### 代码实现\n\n- **安装全局依赖**\n\n```javascript\nnpm install express -g or yarn global add express\nnpm install express-generator -g or yarn global express-generator\n```\n\n- **使用 express-generator 生成 todo_api 项目**\n\n```javascript\nmkdir todo_api\ncd todo_api\nexpress\nnpm install or yarn install\nnpm start or yarn start\n```\n\n然后访问 localhost:3000，最简单的服务器就 👌 了\n\n- **添加自动重启服务**\n\n  每次修改 js 文件，我们都需要重启服务器，这样修改的内容才会生效，但是每次重启比较麻烦，影响开发效果。所以我们在开发环境中引入 nodemon 插件，实现实时热更新，自动重启项目。\n\n`yarn add nodemon -D`\n修改 package.json 文件中配置的 start 命令：\n\n```javascript\n  \"scripts\": {\n    \"start\": \"nodemon ./bin/www\"\n  },\n```\n\n- **安装相关依赖库**\n  `yarn add express-validator jsonwebtoken express-jwt mysql`\n  ** 修改目录结构**\n\n- **项目配置模块（Config）**\n  在根目录下 config 文件夹，并新增 db.js 文件，用于 mysql 数据库基础配置\n\n```javascript\n// 配置\nconst MYSQL_CONF = {\n  host: 'localhost',\n  user: 'root',\n  password: 'xzh123456',\n  port: '3306',\n  database: 'todo'\n}\n\nmodule.exports = {\n  MYSQL_CONF\n}\n```\n\n- **数据库模块（DB）**\n  在根目录下创建 db 文件夹，并创建 mysql.js 文件，用于封装连接 mysql 模块\n\n```javascript\nconst mysql = require('mysql')\nconst { MYSQL_CONF } = require('../config/db')\n\nconst connection = () => mysql.createConnection(MYSQL_CONF)\n\nconst querySql = (sql) => {\n  const conn = connection()\n  return new Promise((resolve, reject) => {\n    try {\n      conn.query(sql, (err, res) => {\n        if (err) {\n          reject(err)\n        } else {\n          resolve(res)\n        }\n      })\n    } catch (e) {\n      reject(e)\n    } finally {\n      // 释放连接\n      conn.end()\n    }\n  })\n}\n\nmodule.exports = {\n  querySql\n}\n```\n\n- **工具模块（Utils）**\n  在根目录下创建 utils 文件夹\n\n创建 constant.js 文件，用于自定义常量\n\n代码如下\n\n```javascript\nmodule.exports = {\n  CODE_ERROR: \"9999\", // 请求响应失败code码\n  CODE_SUCCESS: \"0000\", // 请求响应成功code码\n  PRIVATE_KEY: \"todo\", // 自定义jwt加密的私钥\n  JWT_EXPIRED: 60 * 60 * 24, // 过期时间24小时\n};\n创建crypto.js文件，用于加密标准实现方法\n```\n\n代码如下\n\n```javascript\nconst crypto = require('crypto') // 引入crypto加密模块\n\nconst md5 = (v) => {\n  return crypto\n    .createHash('md5')\n    .update('' + v)\n    .digest('hex')\n}\n\nmodule.exports = {\n  md5\n}\n\nconst crypto = require('crypto') // 引入crypto加密模块\n\nconst md5 = (v) => {\n  return crypto\n    .createHash('md5')\n    .update('' + v)\n    .digest('hex')\n}\n\nmodule.exports = {\n  md5\n}\n```\n\n创建 jwtAuth.js 文件，用于 jwt-token 验证和解析函数\n代码如下\n\n```javascript\nconst expressJwt = require('express-jwt') // 引入express-jwt模块\nconst { PRIVATE_KEY } = require('./constant') // 引入自定义的jwt密钥\n\n// 验证token是否过期\nconst jwtAuth = expressJwt({\n  // 设置密钥\n  secret: PRIVATE_KEY,\n  // 设置为true表示校验，false表示不校验\n  credentialsRequired: true,\n  algorithms: ['HS256'],\n  // 自定义获取token的函数\n  getToken: (req) => {\n    console.log(req.headers['access-token'])\n    if (req.headers['access-token']) {\n      return req.headers['access-token']\n    } else if (req.query && req.query.token) {\n      return req.query.token\n    }\n  }\n  // 设置jwt认证白名单，比如/api/user/login登录接口不需要拦截\n}).unless({\n  path: ['/', '/api/user/login', '/api/user/register']\n})\n\nmodule.exports = {\n  jwtAuth\n}\n```\n\n- **路由控制层（Routes）**\n  创建 index.js 文件，代码如下\n\n```javascript\nconst express = require('express')\nconst router = express.Router()\nconst userRouter = require('./users')\nconst taskRouter = require('./tasks')\n\nrouter.use('/api/user', userRouter)\nrouter.use('/api/task', taskRouter)\n\nmodule.exports = router\n```\n\n创建 users.js 文件，代码如下\n\n```javascript\nconst express = require('express')\nconst router = express.Router()\nconst { userController } = require('../controllers')\nconst { checkSchema } = require('express-validator')\n\nconst rules = {\n  loginValidator: checkSchema({\n    username: {\n      isLength: {\n        errorMessage: 'username长度至少5位',\n        options: { min: 5 }\n      }\n    },\n    password: {\n      isLength: {\n        errorMessage: 'password长度至少5位',\n        options: { min: 5 }\n      }\n    }\n  })\n}\n\n// 登录\nrouter.post('/login', rules.loginValidator, userController.login)\n\n// 注册\nrouter.post('/register', rules.loginValidator, userController.register)\n\nmodule.exports = router\n```\n\n- **创建 tasks.js 文件，代码如下**\n\n```javascript\nconst express = require('express')\nconst router = express.Router()\nconst { taskController } = require('../controllers')\n\n// 任务列表\nrouter.post('/list', taskController.getTaskList)\n\n// 任务添加\nrouter.post('/add', taskController.addTask)\n\n// 任务编辑\nrouter.post('/update', taskController.updateTask)\n\n// 任务删除\nrouter.get('/delete', taskController.deleteTask)\n\nmodule.exports = router\n```\n\n- **业务逻辑层（Controllers）**\n  在写业务逻辑层之前，我们先来看一下，sql 语句的一些返回值 数据库操作( CURD)\n\n  在根目录下创建 controlles 文件夹\n\n  创建 index.js 文件，代码如下\n\n```javascript\nconst userController = require('./users')\nconst taskController = require('./tasks')\n\nmodule.exports = {\n  userController,\n  taskController\n}\n```\n\n创建 users.js 文件，代码如下\n\n```javascript\nconst jwt = require('jsonwebtoken')\nconst { validationResult } = require('express-validator')\nconst { querySql } = require('../db/mysql')\nconst { md5 } = require('../utils/crypto')\nconst { PRIVATE_KEY, JWT_EXPIRED } = require('../utils/constant')\nconst { getErrorRes, getSuccessRes } = require('../utils/resHandler')\n\nclass UserController {\n  async login(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { username, password } = req.body\n      password = md5(password)\n      const sql = `select * from sys_user where username='${username}' and password='${password}'`\n      try {\n        const findRes = await querySql(sql)\n        console.log('--查询登录账号数据--', findRes)\n        if (findRes.length === 0) {\n          res.json(getErrorRes({ message: '用户名或密码错误' }))\n        } else {\n          // 登录成功，签发一个token并返回给前端\n          const token = jwt.sign(\n            // payload：签发的 token 里面要包含的一些数据。\n            { username },\n            // 私钥\n            PRIVATE_KEY,\n            { algorithm: 'HS256', expiresIn: JWT_EXPIRED }\n          )\n          let userData = {\n            id: findRes[0].id,\n            username: findRes[0].username,\n            nickname: findRes[0].nickname\n          }\n          const result = getSuccessRes({\n            message: '登录成功',\n            data: {\n              token,\n              userData\n            }\n          })\n          res.json(result)\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n\n  async register(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { username, password } = req.body\n      const sql = `select id, username from sys_user where username='${username}'`\n      try {\n        const findRes = await querySql(sql)\n        console.log('--查询用户是否已存在--', findRes)\n        if (findRes && findRes.length > 0) {\n          res.json(getErrorRes({ message: '用户已存在' }))\n        } else {\n          password = md5(password)\n          const sql = `insert into sys_user(username, password, gmt_create, gmt_modify) values('${username}', '${password}', '${new Date().getTime()}', '${new Date().getTime()}')`\n          const insertRes = await querySql(sql)\n          console.log('--注册用户--', insertRes)\n          res.json(getSuccessRes({ message: '注册成功' }))\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n}\n\nmodule.exports = new UserController()\n```\n\n创建 tasks.js 文件，代码如下\n\n```javascript\nconst { querySql } = require('../db/mysql')\nconst { validationResult } = require('express-validator')\nconst { getErrorRes, getSuccessRes } = require('../utils/resHandler')\n\nclass TaskController {\n  async getTaskList(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { pageNum, pageSize = 10 } = req.body\n      let query = `select d.id, d.title, d.description, d.status, d.gmt_create, d.gmt_expire from sys_task d where status != '2'`\n      try {\n        let findRes = await querySql(query)\n        console.log('--查询任务列表--', findRes)\n        let isLimit = findRes.length > pageSize\n        let limitRes = []\n        if (isLimit) {\n          let n = (pageNum - 1) * pageSize\n          limitRes = await querySql(query + ` limit ${n} , ${pageSize}`)\n        }\n        res.json(\n          getSuccessRes({\n            message: '查询数据成功',\n            data: {\n              total: findRes.length,\n              list: isLimit ? limitRes : findRes,\n              pageNum,\n              pageSize\n            }\n          })\n        )\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n\n  async addTask(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { title, description, gmt_expire } = req.body\n      const sql = `select id, title from sys_task where title='${title}' and status != 2`\n      try {\n        let findRes = await querySql(sql)\n        console.log('--addTask先查找同名任务--', findRes)\n        if (findRes && findRes.length > 0) {\n          res.json(getErrorRes({ message: '任务已存在' }))\n        } else {\n          const sql = `insert into sys_task(title, description, gmt_create, gmt_expire) values('${title}', '${description}', '${new Date().getTime()}', ${gmt_expire})`\n          let insertRes = await querySql(sql)\n          console.log('--添加task数据--', insertRes)\n          res.json(getSuccessRes({ message: '添加数据成功' }))\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n\n  async updateTask(req, res, next) {\n    const err = validationResult(req)\n    // 如果验证错误，empty不为空\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { id, title, description, status, gmt_expire } = req.body\n      const sql = `select id, title from sys_task where id != ${id} and title='${title}' and status != 2 `\n      try {\n        let findRes = await querySql(sql)\n        console.log('--查询不等于当前id的任务是否存在--', findRes)\n        if (findRes && findRes.length > 0) {\n          res.json(getErrorRes({ message: '任务已存在' }))\n        } else {\n          const sql = `update sys_task set title='${title}', description='${description}',status='${status}', gmt_expire='${gmt_expire}' where id='${id}'`\n          let updateRes = await querySql(sql)\n          console.log(`--更新当前${id}的任务数据--`, updateRes)\n          if (updateRes && updateRes.affectedRows > 0) {\n            res.json(getSuccessRes({ message: '更新数据成功' }))\n          } else {\n            res.json(getErrorRes({ message: '更新数据失败' }))\n          }\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n\n  async deleteTask(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { id, status } = req.query\n      const sql = `update sys_task set status='${status}' where id='${id}'`\n      try {\n        const deleteRes = await querySql(sql)\n        console.log(`--删除${id}的任务数据--`, deleteRes)\n        if (deleteRes && deleteRes.affectedRows > 0) {\n          res.json(getSuccessRes({ message: '删除数据成功' }))\n        } else {\n          res.json(getErrorRes({ message: '删除数据失败' }))\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n}\n\nmodule.exports = new TaskController()\n```\n\n- **入口文件配置**\n  在根目录 app.js 程序入口文件中，导入 Express 模块，再引入常用的中间件和自定义 routes 路由的中间件，代码如下：\n\n```javascript\nconst createError = require('http-errors')\nconst express = require('express')\nconst cookieParser = require('cookie-parser')\nconst logger = require('morgan')\nconst { getErrorRes } = require('./utils/resHandler')\n\nconst routes = require('./routes/index')\n\nconst app = express()\n\napp.use(logger('dev'))\napp.use(express.json())\napp.use(express.urlencoded({ extended: false }))\napp.use(cookieParser())\n\napp.use('/', routes)\n\n// catch 404 and forward to error handler\napp.use(function (req, res, next) {\n  next(createError(404))\n})\n\n// error handler\napp.use(function (err, req, res, next) {\n  // set locals, only providing error in development\n  res.locals.message = err.message\n  res.locals.error = req.app.get('env') === 'development' ? err : {}\n  res.status(err.status || 500)\n  if (err.status == 401) {\n    res.json(getErrorRes({ message: '用户未登录' }))\n  } else {\n    res.json(getErrorRes({ message: err.message || '服务器出错' }))\n  }\n})\n\nmodule.exports = app\n```\n\n到此基于 Vue + antdv + Express + Node.js + MySQL 实现的前后端功能已基本完成，此章节暂告一段落。\n\n## 什么是 BFF\n\nBFF，即 Backends For Frontends（服务于前端的后端）。在 2015 年，Sam Newman 对此提出了，Pattern: Backends For Frontends ，国内也俗称为粘合层。\n\n在 BFF 理念中，最重要的一点是： 服务自治，谁使用谁开发，即它应该由前端同学去维护。\n\n- 服务自治减少了沟通成本，带来了灵活和高效。\n- BFF 并不限制具体技术，团队根据自己的技术栈来选型： Java/Node/PHP/Python/Ruby...\n  PS：Serverless For Frontend\n\n### 为什么选择 Node 作为中间层\n\n![network](/images/common/bff.png)\n\n#### 业务驱动\n\nNode 有个突出的优势，他的开发者可以是前端，都会倾向于选择生态更优，语法更熟悉的 Node.js。\n\n前端对于页面所需要的数据有更好的理解，每个页面要用到哪些接口，每个接口要用到哪些字段前端是最清楚的。再加上实际业务开发中，前端页面需求经常会发生变化，需要修改字段或者数据结构，所以对接页面的这部分接口由前端直接开发非常合适，可以显著的减少沟通成本。\n\n#### 架构需要\n\n面向用户的接口由 Node 中间层负责以后，真正的服务端可以专注于提供基于领域模型的对内接口，做微服务。\n\n比如可以基于 Goods 模型，提供所有商品相关的接口；基于 Users 模型，提供所有用户相关接口。当一个接口需要商品+用户信息时，由 Node 分别查询组装。从整体业务代码维护角度来说，变得更容易，不会因为业务发展使得每个接口都异常繁杂。\n\n#### 性能满足\n\n如果仅仅是架构层面的需求，需要有一个中间层来沉淀业务，那用 Java，PHP 也可以做到，为什么说 Node 更适合做呢？\n\n因为 Node 天生异步！\n\n众所周知，js 是一门单线程语言，所以 Node 在实现的时候，需要借助 libuv 来实现异步。libuv 为 Node 提供了线程池，事件池，异步 I/O 等能力。正是因为其中网络 I/O 的异步能力，可以让 Node 做接口聚合时，能够更高效的异步并发处理。\n\n#### 成本较低\n\nNode 使用 js 开发，只需要学习简单的 api，前端开发者就可以无障碍使用，学习成本很低。\n\n而且，Node 具有活跃的社区和丰富的模块池，拥有很多现成的功能实现。框架方面，也有成熟的 koa，express 等基本框架和 egg 等二次封装框架，可根据需求选择上手也比较方便。\n\n**中间层能为我们做些什么？**\n![network](/images/common/bff-1.jpeg)\n\n- 代理：在开发环境下，我们可以利用代理来，解决最常见的跨域问题；在线上环境下，我们可以利用代理，转发请求到多个服务端。\n- 缓存：缓存其实是更靠近前端的需求，用户的动作触发数据的更新，node 中间层可以直接处理一部分缓存需求。\n- 限流：node 中间层，可以针对接口或者路由做响应的限流。\n- 日志：相比其他服务端语言，node 中间层的日志记录，能更方便快捷的定位问题（是在浏览器端还是服务端）。\n- 监控：擅长高并发的请求处理，做监控也是合适的选项。\n- 鉴权：有一个中间层去鉴权，也是一种单一职责的实现。\n- 路由：前端更需要掌握页面路由的权限和逻辑。\n- **服务端渲染：**node 中间层的解决方案更灵活，比如 SSR、模板直出、利用一些 JS 库做预渲染等等。\n  更多的可能性\n\n**中间层业务接口实践思路**\n非标准，只是一种参考\n![network](/images/common/bff-2.jpeg)\n","source":"_posts/node中间层及简单api编写.md","raw":"---\ntitle: node中间层及简单api编写\ndate: 2021-04-20 14:49:27\ncategories: Node\n---\n\nNode.js 对前端来说无疑具有里程碑意义，尤其是在越来越流行的今天，掌握 Node.js 技术已经不仅仅是加分项，而是前端攻城师们需要去掌握的一项技能。\n\n<!--more-->\n\n## Node.js 是什么\n\n简单的说 Node.js 就是一个 javascript 运行环境。它让 javascript 可以开发后端程序，实现几乎其他后端语言实现的所有功能，可以与 PHP、Java、Python、.NET、Ruby 等后端语言一较高下。\n\nNode.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。\n\nNode.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。\n`Node.js = Runtime Environment + JavaScript Library`\n\n## Node.js 优势\n\n- **Nodejs 语法完全是 js 语法**\n  只要你懂 js 基础就可以学会 Nodejs 后端开发，对前端开发者友好。\n- **NodeJs 超强的高并发能力**\n  放弃了“为每一个用户连接创建一个新线程”的思想，通过非阻塞 I/O、事件驱动机制，让 Node.js 程序宏观上也是并行的。\n- **实现高性能服务器**\n  严格地说，Node.js 是一个用于开发各种 web 服务器的开发工具。在 Node.js 服务器中，运行的是高性能 V8 JavaScript 脚本语言，该语言是一种可以运行在服务器端的脚本语言。\n\n  Node.js 自身哲学，是话最小的硬件成本，追求更高的并发，更高的处理性能。\n\n## Node.js 特点\n\n异步事件驱动、非堵塞 I/O\n\n- **Node.js 使用事件驱动模型，当 web server 接收到请求，就把它关闭然后进行处理，然后去服务下一个 web 请求。**\n  当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。\n  这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。（这也被称之为非阻塞式 IO 或者事件驱动 IO）\n\n  在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数\n\n- **单线程**\n\n  Nodejs 跟 Nginx 一样都是单线程为基础的，这里的单线程指主线程为单线程，所有的阻塞的全部放入一个线程池中，然后主线程通过队列的方式跟线程池来协作。我们写 js 部分不需要关心线程的问题，简单了解就可以了，主要由一堆 callback 回调构成的，然后主线程在循环过在适当场合调用。\n\n- **性能出众**\n\n  底层选择用 c++和 v8 来实现的，上面第一点讲到过，nodejs 的事件驱动机制，这意味着面对大规模的 http 请求，nodejs 是凭借事件驱动来完成的，性能部分是不用担心的，并且很出色。\n\n## Node.js 应用实例\n\n```javascript\nconst http = require('http');\n\nconst hostname = '127.0.0.1';\nconst port = 3000;\n\nconst server = http.createServer((req, res) => {\n  res.statusCode = 200;\n  res.setHeader('Content-Type', 'text/plain');\n  res.end('Hello World');\n});\n\nserver.listen(port, hostname, () => {\n  console.log(`Server running at http://${hostname}:${port}/`);\n```\n\n## Express 简介\n\nExpress 是一个简洁而灵活的 node.js Web 应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。\n\n使用 Express 可以快速地搭建一个完整功能的网站。\n\nExpress 框架核心特性：\n\n- 可以设置中间件来响应 HTTP 请求。\n- 定义了路由表用于执行不同的 HTTP 请求动作。\n- 可以通过向模板传递参数来动态渲染 HTML 页面。\n- 介绍就先告一段落了，接下来通过一个项目实例来进行 node 搭建服务的讲解\n\n## Node 简单的 api 编写\n\n### 前言\n\n此章节采用项目实例直接演示如何实现简单 API 的编写。前端项目采用的技术栈是基于 Vue + Antdv，用 vue-cli 构建前端界面，后端项目采用的技术栈是基于 Node.js + Express + MySQL，用 Express 搭建的后端服务器。\n\n### 前端部分\n\n使用 Vue + antdv，用 vue-cli 构建前端项目\n\n#### 目录结构\n\n```m\n│ package.json // npm 包管理所需模块及配置信息\n│ vue.config.js // webpack 配置\n├─public\n│ favicon.ico // 图标\n│ index.html // 入口 html 文件\n└─src\n│ App.vue // 根组件\n│ main.js // 程序入口文件\n│ permission.js // 权限拦截\n│ globla.less // 全局样式\n├─api\n│ task.js // 任务模块接口\n│ user.js // 用户模块接口\n├─assets // 存放公共图片文件夹\n├─components\n│ ProLayout // Pro 布局组建\n├─layouts\n│ index.js // 布局整合\n│ UserLayout.vue // 用户布局\n│ BasicLayout.vue // 基本布局\n├─core\n│ lazy_use.js // 懒加载使用的 antd 等\n├─router\n│ index.js // 单页面路由注册组件\n├─store\n│ │ index.js // 状态管理仓库入口文件\n│ │ getters.js // getter\n│ │ mutation-types.js // store 使用的常量\n│ └─modules\n│ user.js // 用户模块状态管理文件\n├─utils\n│ axios.js // 安装 axios 插件\n│ domUtils.js // 操作页签 title\n│ request.js // axios 封装与拦截器配置\n└─views\nuser // 用户模块页面\ntask // 任务模块页面\n404.vue // 404 页面\n```\n\n### MySQL 与 Navicat\n\nMySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 是最好的 RDBMS(Relational Database Management System：关系数据库管理系统)应用软件之一。\n\nNavicat premium 是一款数据库管理工具,是一个可多重连线资料库的管理工具，它可以让你以单一程式同时连线到 MySQL、SQLite、Oracle 及 PostgreSQL 资料库，让管理不同类型的资料库更加的方便。\n\n#### 数据库设计部分\n\n使用 MYSQL，创建数据库 todo，创建 sys_user 用户表及创建 sys_task 任务表\n\n-创建数据库--\n\n`CREATE DATABASE `todo` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;`\n--创建用户表--\n\n```javascript\nDROP TABLE IF EXISTS `sys_user`;\nCREATE TABLE `sys_user` (\n`id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '唯一标识',\n`username` VARCHAR(50) NOT NULL COMMENT '登录帐号',\n`password` VARCHAR(64) NOT NULL  COMMENT '登录密码',\n`nickname` VARCHAR(50) NULL DEFAULT '' COMMENT '昵称',\n`avator` VARCHAR(50) NULL DEFAULT '' COMMENT '用户头像',\n`sex` int(3) NULL DEFAULT 0 COMMENT '性别：0:未知, 1:男, 2:女',\n`gmt_create` BIGINT(13) NOT NULL COMMENT '创建时间',\n`gmt_modify` BIGINT(13) NOT NULL COMMENT '修改时间',\n PRIMARY KEY (`id`) USING BTREE,\n UNIQUE KEY `username_UNIQUE` (`username`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 COMMENT='用户表';\n```\n\n--创建任务表--\n\n```javascript\nDROP TABLE IF EXISTS `sys_task`;\nCREATE TABLE `sys_task` (\n`id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '唯一标识',\n`title` varchar(100) NOT NULL COMMENT '任务名称',\n`description` varchar(255) NOT NULL COMMENT '任务内容',\n`status` int(3) NULL DEFAULT 0 COMMENT '任务状态：0:待办 1:完成 2:删除',\n`gmt_create` bigint(13) NOT NULL COMMENT '创建时间',\n`gmt_expire` bigint(13) NOT NULL COMMENT '截止日期',\nPRIMARY KEY (`id`) USING BTREE\n) ENGINE=InnoDB AUTO_INCREMENT=1 COMMENT='任务表';\n```\n\n### 后端部分\n\n使用 Node.js + Express + MySQL，搭建的后端服务器。\n\n#### 目录结构\n\n```m\n│  app.js                             // 入口文件\n│  package.json                       // npm包管理所需模块及配置信息\n│  bin\n│      www                            // start程序运行文件\n│  config\n│      db.js                          // mysql数据库基础配置\n├─db\n│      mysql.js                       // 封装连接mysql模块\n├─routes\n│      index.js                       // 初始化路由信息，引入auth中间件\n│      tasks.js                       // 任务路由模块\n│      users.js                       // 用户路由模块\n├─controllers\n│      index.js                 \t\t\t // 业务逻辑处理 - 入口\n│      tasks.js                 \t\t\t // 业务逻辑处理 - 任务相关接口\n│      users.js                 \t\t\t // 业务逻辑处理 - 用户相关接口\n└─utils\n        constant.js                   // 自定义常量\n        crypto.js                     // 加密标准实现方法\n        jwtAuth.js                    // jwt-token验证和解析函数\n        resHandler.js                 // 包装统一返回格式\n```\n\n#### 技术栈\n\n后端登录注册功能使用了 jwt-token 认证模式来实现。使用 express、express-validator、jsonwebtoken、express-jwt、mySQL 组件库来简化开发。\n\n- express：提供了创建 Web 服务器的最简单但功能最强大的方法之一。\n- express-validator：一个基于 Express 的数据验证中间件，可以方便的判断传入的表单数据是否合法。\n- jsonwebtoken：基于 jwt 的概念实现安全的加密方案库，实现加密 token 和解析 token 的功能。\n- express-jwt：express-jwt 是在 jsonwebtoken 的基础上做了上层封装，基于 Express 框架下认证 jwt 的中间件，来实现 jwt 的认证功能。\n- http-errors：轻松创建 Express，Koa，Connect 等的 HTTP 错误。\n- mysql：Node.js 连接 MySQL 数据库。\n- nodemon：实现实时热更新，自动重启项目。\n\n#### 功能模块\n\n- 用户模块：登录、注册\n- 任务模块：todoList 增删改查\n\n#### 代码实现\n\n- **安装全局依赖**\n\n```javascript\nnpm install express -g or yarn global add express\nnpm install express-generator -g or yarn global express-generator\n```\n\n- **使用 express-generator 生成 todo_api 项目**\n\n```javascript\nmkdir todo_api\ncd todo_api\nexpress\nnpm install or yarn install\nnpm start or yarn start\n```\n\n然后访问 localhost:3000，最简单的服务器就 👌 了\n\n- **添加自动重启服务**\n\n  每次修改 js 文件，我们都需要重启服务器，这样修改的内容才会生效，但是每次重启比较麻烦，影响开发效果。所以我们在开发环境中引入 nodemon 插件，实现实时热更新，自动重启项目。\n\n`yarn add nodemon -D`\n修改 package.json 文件中配置的 start 命令：\n\n```javascript\n  \"scripts\": {\n    \"start\": \"nodemon ./bin/www\"\n  },\n```\n\n- **安装相关依赖库**\n  `yarn add express-validator jsonwebtoken express-jwt mysql`\n  ** 修改目录结构**\n\n- **项目配置模块（Config）**\n  在根目录下 config 文件夹，并新增 db.js 文件，用于 mysql 数据库基础配置\n\n```javascript\n// 配置\nconst MYSQL_CONF = {\n  host: 'localhost',\n  user: 'root',\n  password: 'xzh123456',\n  port: '3306',\n  database: 'todo'\n}\n\nmodule.exports = {\n  MYSQL_CONF\n}\n```\n\n- **数据库模块（DB）**\n  在根目录下创建 db 文件夹，并创建 mysql.js 文件，用于封装连接 mysql 模块\n\n```javascript\nconst mysql = require('mysql')\nconst { MYSQL_CONF } = require('../config/db')\n\nconst connection = () => mysql.createConnection(MYSQL_CONF)\n\nconst querySql = (sql) => {\n  const conn = connection()\n  return new Promise((resolve, reject) => {\n    try {\n      conn.query(sql, (err, res) => {\n        if (err) {\n          reject(err)\n        } else {\n          resolve(res)\n        }\n      })\n    } catch (e) {\n      reject(e)\n    } finally {\n      // 释放连接\n      conn.end()\n    }\n  })\n}\n\nmodule.exports = {\n  querySql\n}\n```\n\n- **工具模块（Utils）**\n  在根目录下创建 utils 文件夹\n\n创建 constant.js 文件，用于自定义常量\n\n代码如下\n\n```javascript\nmodule.exports = {\n  CODE_ERROR: \"9999\", // 请求响应失败code码\n  CODE_SUCCESS: \"0000\", // 请求响应成功code码\n  PRIVATE_KEY: \"todo\", // 自定义jwt加密的私钥\n  JWT_EXPIRED: 60 * 60 * 24, // 过期时间24小时\n};\n创建crypto.js文件，用于加密标准实现方法\n```\n\n代码如下\n\n```javascript\nconst crypto = require('crypto') // 引入crypto加密模块\n\nconst md5 = (v) => {\n  return crypto\n    .createHash('md5')\n    .update('' + v)\n    .digest('hex')\n}\n\nmodule.exports = {\n  md5\n}\n\nconst crypto = require('crypto') // 引入crypto加密模块\n\nconst md5 = (v) => {\n  return crypto\n    .createHash('md5')\n    .update('' + v)\n    .digest('hex')\n}\n\nmodule.exports = {\n  md5\n}\n```\n\n创建 jwtAuth.js 文件，用于 jwt-token 验证和解析函数\n代码如下\n\n```javascript\nconst expressJwt = require('express-jwt') // 引入express-jwt模块\nconst { PRIVATE_KEY } = require('./constant') // 引入自定义的jwt密钥\n\n// 验证token是否过期\nconst jwtAuth = expressJwt({\n  // 设置密钥\n  secret: PRIVATE_KEY,\n  // 设置为true表示校验，false表示不校验\n  credentialsRequired: true,\n  algorithms: ['HS256'],\n  // 自定义获取token的函数\n  getToken: (req) => {\n    console.log(req.headers['access-token'])\n    if (req.headers['access-token']) {\n      return req.headers['access-token']\n    } else if (req.query && req.query.token) {\n      return req.query.token\n    }\n  }\n  // 设置jwt认证白名单，比如/api/user/login登录接口不需要拦截\n}).unless({\n  path: ['/', '/api/user/login', '/api/user/register']\n})\n\nmodule.exports = {\n  jwtAuth\n}\n```\n\n- **路由控制层（Routes）**\n  创建 index.js 文件，代码如下\n\n```javascript\nconst express = require('express')\nconst router = express.Router()\nconst userRouter = require('./users')\nconst taskRouter = require('./tasks')\n\nrouter.use('/api/user', userRouter)\nrouter.use('/api/task', taskRouter)\n\nmodule.exports = router\n```\n\n创建 users.js 文件，代码如下\n\n```javascript\nconst express = require('express')\nconst router = express.Router()\nconst { userController } = require('../controllers')\nconst { checkSchema } = require('express-validator')\n\nconst rules = {\n  loginValidator: checkSchema({\n    username: {\n      isLength: {\n        errorMessage: 'username长度至少5位',\n        options: { min: 5 }\n      }\n    },\n    password: {\n      isLength: {\n        errorMessage: 'password长度至少5位',\n        options: { min: 5 }\n      }\n    }\n  })\n}\n\n// 登录\nrouter.post('/login', rules.loginValidator, userController.login)\n\n// 注册\nrouter.post('/register', rules.loginValidator, userController.register)\n\nmodule.exports = router\n```\n\n- **创建 tasks.js 文件，代码如下**\n\n```javascript\nconst express = require('express')\nconst router = express.Router()\nconst { taskController } = require('../controllers')\n\n// 任务列表\nrouter.post('/list', taskController.getTaskList)\n\n// 任务添加\nrouter.post('/add', taskController.addTask)\n\n// 任务编辑\nrouter.post('/update', taskController.updateTask)\n\n// 任务删除\nrouter.get('/delete', taskController.deleteTask)\n\nmodule.exports = router\n```\n\n- **业务逻辑层（Controllers）**\n  在写业务逻辑层之前，我们先来看一下，sql 语句的一些返回值 数据库操作( CURD)\n\n  在根目录下创建 controlles 文件夹\n\n  创建 index.js 文件，代码如下\n\n```javascript\nconst userController = require('./users')\nconst taskController = require('./tasks')\n\nmodule.exports = {\n  userController,\n  taskController\n}\n```\n\n创建 users.js 文件，代码如下\n\n```javascript\nconst jwt = require('jsonwebtoken')\nconst { validationResult } = require('express-validator')\nconst { querySql } = require('../db/mysql')\nconst { md5 } = require('../utils/crypto')\nconst { PRIVATE_KEY, JWT_EXPIRED } = require('../utils/constant')\nconst { getErrorRes, getSuccessRes } = require('../utils/resHandler')\n\nclass UserController {\n  async login(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { username, password } = req.body\n      password = md5(password)\n      const sql = `select * from sys_user where username='${username}' and password='${password}'`\n      try {\n        const findRes = await querySql(sql)\n        console.log('--查询登录账号数据--', findRes)\n        if (findRes.length === 0) {\n          res.json(getErrorRes({ message: '用户名或密码错误' }))\n        } else {\n          // 登录成功，签发一个token并返回给前端\n          const token = jwt.sign(\n            // payload：签发的 token 里面要包含的一些数据。\n            { username },\n            // 私钥\n            PRIVATE_KEY,\n            { algorithm: 'HS256', expiresIn: JWT_EXPIRED }\n          )\n          let userData = {\n            id: findRes[0].id,\n            username: findRes[0].username,\n            nickname: findRes[0].nickname\n          }\n          const result = getSuccessRes({\n            message: '登录成功',\n            data: {\n              token,\n              userData\n            }\n          })\n          res.json(result)\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n\n  async register(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { username, password } = req.body\n      const sql = `select id, username from sys_user where username='${username}'`\n      try {\n        const findRes = await querySql(sql)\n        console.log('--查询用户是否已存在--', findRes)\n        if (findRes && findRes.length > 0) {\n          res.json(getErrorRes({ message: '用户已存在' }))\n        } else {\n          password = md5(password)\n          const sql = `insert into sys_user(username, password, gmt_create, gmt_modify) values('${username}', '${password}', '${new Date().getTime()}', '${new Date().getTime()}')`\n          const insertRes = await querySql(sql)\n          console.log('--注册用户--', insertRes)\n          res.json(getSuccessRes({ message: '注册成功' }))\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n}\n\nmodule.exports = new UserController()\n```\n\n创建 tasks.js 文件，代码如下\n\n```javascript\nconst { querySql } = require('../db/mysql')\nconst { validationResult } = require('express-validator')\nconst { getErrorRes, getSuccessRes } = require('../utils/resHandler')\n\nclass TaskController {\n  async getTaskList(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { pageNum, pageSize = 10 } = req.body\n      let query = `select d.id, d.title, d.description, d.status, d.gmt_create, d.gmt_expire from sys_task d where status != '2'`\n      try {\n        let findRes = await querySql(query)\n        console.log('--查询任务列表--', findRes)\n        let isLimit = findRes.length > pageSize\n        let limitRes = []\n        if (isLimit) {\n          let n = (pageNum - 1) * pageSize\n          limitRes = await querySql(query + ` limit ${n} , ${pageSize}`)\n        }\n        res.json(\n          getSuccessRes({\n            message: '查询数据成功',\n            data: {\n              total: findRes.length,\n              list: isLimit ? limitRes : findRes,\n              pageNum,\n              pageSize\n            }\n          })\n        )\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n\n  async addTask(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { title, description, gmt_expire } = req.body\n      const sql = `select id, title from sys_task where title='${title}' and status != 2`\n      try {\n        let findRes = await querySql(sql)\n        console.log('--addTask先查找同名任务--', findRes)\n        if (findRes && findRes.length > 0) {\n          res.json(getErrorRes({ message: '任务已存在' }))\n        } else {\n          const sql = `insert into sys_task(title, description, gmt_create, gmt_expire) values('${title}', '${description}', '${new Date().getTime()}', ${gmt_expire})`\n          let insertRes = await querySql(sql)\n          console.log('--添加task数据--', insertRes)\n          res.json(getSuccessRes({ message: '添加数据成功' }))\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n\n  async updateTask(req, res, next) {\n    const err = validationResult(req)\n    // 如果验证错误，empty不为空\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { id, title, description, status, gmt_expire } = req.body\n      const sql = `select id, title from sys_task where id != ${id} and title='${title}' and status != 2 `\n      try {\n        let findRes = await querySql(sql)\n        console.log('--查询不等于当前id的任务是否存在--', findRes)\n        if (findRes && findRes.length > 0) {\n          res.json(getErrorRes({ message: '任务已存在' }))\n        } else {\n          const sql = `update sys_task set title='${title}', description='${description}',status='${status}', gmt_expire='${gmt_expire}' where id='${id}'`\n          let updateRes = await querySql(sql)\n          console.log(`--更新当前${id}的任务数据--`, updateRes)\n          if (updateRes && updateRes.affectedRows > 0) {\n            res.json(getSuccessRes({ message: '更新数据成功' }))\n          } else {\n            res.json(getErrorRes({ message: '更新数据失败' }))\n          }\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n\n  async deleteTask(req, res, next) {\n    const err = validationResult(req)\n    if (!err.isEmpty()) {\n      const [{ msg }] = err.errors\n      res.json(getErrorRes({ message: msg }))\n    } else {\n      let { id, status } = req.query\n      const sql = `update sys_task set status='${status}' where id='${id}'`\n      try {\n        const deleteRes = await querySql(sql)\n        console.log(`--删除${id}的任务数据--`, deleteRes)\n        if (deleteRes && deleteRes.affectedRows > 0) {\n          res.json(getSuccessRes({ message: '删除数据成功' }))\n        } else {\n          res.json(getErrorRes({ message: '删除数据失败' }))\n        }\n      } catch (error) {\n        return next({ message: error })\n      }\n    }\n  }\n}\n\nmodule.exports = new TaskController()\n```\n\n- **入口文件配置**\n  在根目录 app.js 程序入口文件中，导入 Express 模块，再引入常用的中间件和自定义 routes 路由的中间件，代码如下：\n\n```javascript\nconst createError = require('http-errors')\nconst express = require('express')\nconst cookieParser = require('cookie-parser')\nconst logger = require('morgan')\nconst { getErrorRes } = require('./utils/resHandler')\n\nconst routes = require('./routes/index')\n\nconst app = express()\n\napp.use(logger('dev'))\napp.use(express.json())\napp.use(express.urlencoded({ extended: false }))\napp.use(cookieParser())\n\napp.use('/', routes)\n\n// catch 404 and forward to error handler\napp.use(function (req, res, next) {\n  next(createError(404))\n})\n\n// error handler\napp.use(function (err, req, res, next) {\n  // set locals, only providing error in development\n  res.locals.message = err.message\n  res.locals.error = req.app.get('env') === 'development' ? err : {}\n  res.status(err.status || 500)\n  if (err.status == 401) {\n    res.json(getErrorRes({ message: '用户未登录' }))\n  } else {\n    res.json(getErrorRes({ message: err.message || '服务器出错' }))\n  }\n})\n\nmodule.exports = app\n```\n\n到此基于 Vue + antdv + Express + Node.js + MySQL 实现的前后端功能已基本完成，此章节暂告一段落。\n\n## 什么是 BFF\n\nBFF，即 Backends For Frontends（服务于前端的后端）。在 2015 年，Sam Newman 对此提出了，Pattern: Backends For Frontends ，国内也俗称为粘合层。\n\n在 BFF 理念中，最重要的一点是： 服务自治，谁使用谁开发，即它应该由前端同学去维护。\n\n- 服务自治减少了沟通成本，带来了灵活和高效。\n- BFF 并不限制具体技术，团队根据自己的技术栈来选型： Java/Node/PHP/Python/Ruby...\n  PS：Serverless For Frontend\n\n### 为什么选择 Node 作为中间层\n\n![network](/images/common/bff.png)\n\n#### 业务驱动\n\nNode 有个突出的优势，他的开发者可以是前端，都会倾向于选择生态更优，语法更熟悉的 Node.js。\n\n前端对于页面所需要的数据有更好的理解，每个页面要用到哪些接口，每个接口要用到哪些字段前端是最清楚的。再加上实际业务开发中，前端页面需求经常会发生变化，需要修改字段或者数据结构，所以对接页面的这部分接口由前端直接开发非常合适，可以显著的减少沟通成本。\n\n#### 架构需要\n\n面向用户的接口由 Node 中间层负责以后，真正的服务端可以专注于提供基于领域模型的对内接口，做微服务。\n\n比如可以基于 Goods 模型，提供所有商品相关的接口；基于 Users 模型，提供所有用户相关接口。当一个接口需要商品+用户信息时，由 Node 分别查询组装。从整体业务代码维护角度来说，变得更容易，不会因为业务发展使得每个接口都异常繁杂。\n\n#### 性能满足\n\n如果仅仅是架构层面的需求，需要有一个中间层来沉淀业务，那用 Java，PHP 也可以做到，为什么说 Node 更适合做呢？\n\n因为 Node 天生异步！\n\n众所周知，js 是一门单线程语言，所以 Node 在实现的时候，需要借助 libuv 来实现异步。libuv 为 Node 提供了线程池，事件池，异步 I/O 等能力。正是因为其中网络 I/O 的异步能力，可以让 Node 做接口聚合时，能够更高效的异步并发处理。\n\n#### 成本较低\n\nNode 使用 js 开发，只需要学习简单的 api，前端开发者就可以无障碍使用，学习成本很低。\n\n而且，Node 具有活跃的社区和丰富的模块池，拥有很多现成的功能实现。框架方面，也有成熟的 koa，express 等基本框架和 egg 等二次封装框架，可根据需求选择上手也比较方便。\n\n**中间层能为我们做些什么？**\n![network](/images/common/bff-1.jpeg)\n\n- 代理：在开发环境下，我们可以利用代理来，解决最常见的跨域问题；在线上环境下，我们可以利用代理，转发请求到多个服务端。\n- 缓存：缓存其实是更靠近前端的需求，用户的动作触发数据的更新，node 中间层可以直接处理一部分缓存需求。\n- 限流：node 中间层，可以针对接口或者路由做响应的限流。\n- 日志：相比其他服务端语言，node 中间层的日志记录，能更方便快捷的定位问题（是在浏览器端还是服务端）。\n- 监控：擅长高并发的请求处理，做监控也是合适的选项。\n- 鉴权：有一个中间层去鉴权，也是一种单一职责的实现。\n- 路由：前端更需要掌握页面路由的权限和逻辑。\n- **服务端渲染：**node 中间层的解决方案更灵活，比如 SSR、模板直出、利用一些 JS 库做预渲染等等。\n  更多的可能性\n\n**中间层业务接口实践思路**\n非标准，只是一种参考\n![network](/images/common/bff-2.jpeg)\n","slug":"node中间层及简单api编写","published":1,"updated":"2021-04-24T15:38:16.548Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xq003dl5v059dhe6lp","content":"<p>Node.js 对前端来说无疑具有里程碑意义，尤其是在越来越流行的今天，掌握 Node.js 技术已经不仅仅是加分项，而是前端攻城师们需要去掌握的一项技能。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Node-js-是什么\"><a href=\"#Node-js-是什么\" class=\"headerlink\" title=\"Node.js 是什么\"></a>Node.js 是什么</h2><p>简单的说 Node.js 就是一个 javascript 运行环境。它让 javascript 可以开发后端程序，实现几乎其他后端语言实现的所有功能，可以与 PHP、Java、Python、.NET、Ruby 等后端语言一较高下。</p>\n<p>Node.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。</p>\n<p>Node.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。<br><code>Node.js = Runtime Environment + JavaScript Library</code></p>\n<h2 id=\"Node-js-优势\"><a href=\"#Node-js-优势\" class=\"headerlink\" title=\"Node.js 优势\"></a>Node.js 优势</h2><ul>\n<li><p><strong>Nodejs 语法完全是 js 语法</strong><br>只要你懂 js 基础就可以学会 Nodejs 后端开发，对前端开发者友好。</p>\n</li>\n<li><p><strong>NodeJs 超强的高并发能力</strong><br>放弃了“为每一个用户连接创建一个新线程”的思想，通过非阻塞 I/O、事件驱动机制，让 Node.js 程序宏观上也是并行的。</p>\n</li>\n<li><p><strong>实现高性能服务器</strong><br>严格地说，Node.js 是一个用于开发各种 web 服务器的开发工具。在 Node.js 服务器中，运行的是高性能 V8 JavaScript 脚本语言，该语言是一种可以运行在服务器端的脚本语言。</p>\n<p>Node.js 自身哲学，是话最小的硬件成本，追求更高的并发，更高的处理性能。</p>\n</li>\n</ul>\n<h2 id=\"Node-js-特点\"><a href=\"#Node-js-特点\" class=\"headerlink\" title=\"Node.js 特点\"></a>Node.js 特点</h2><p>异步事件驱动、非堵塞 I/O</p>\n<ul>\n<li><p><strong>Node.js 使用事件驱动模型，当 web server 接收到请求，就把它关闭然后进行处理，然后去服务下一个 web 请求。</strong><br>当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。<br>这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。（这也被称之为非阻塞式 IO 或者事件驱动 IO）</p>\n<p>在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数</p>\n</li>\n<li><p><strong>单线程</strong></p>\n<p>Nodejs 跟 Nginx 一样都是单线程为基础的，这里的单线程指主线程为单线程，所有的阻塞的全部放入一个线程池中，然后主线程通过队列的方式跟线程池来协作。我们写 js 部分不需要关心线程的问题，简单了解就可以了，主要由一堆 callback 回调构成的，然后主线程在循环过在适当场合调用。</p>\n</li>\n<li><p><strong>性能出众</strong></p>\n<p>底层选择用 c++和 v8 来实现的，上面第一点讲到过，nodejs 的事件驱动机制，这意味着面对大规模的 http 请求，nodejs 是凭借事件驱动来完成的，性能部分是不用担心的，并且很出色。</p>\n</li>\n</ul>\n<h2 id=\"Node-js-应用实例\"><a href=\"#Node-js-应用实例\" class=\"headerlink\" title=\"Node.js 应用实例\"></a>Node.js 应用实例</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hostname = <span class=\"string\">&#x27;127.0.0.1&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = <span class=\"number\">3000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.createServer(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  res.statusCode = <span class=\"number\">200</span>;</span><br><span class=\"line\">  res.setHeader(<span class=\"string\">&#x27;Content-Type&#x27;</span>, <span class=\"string\">&#x27;text/plain&#x27;</span>);</span><br><span class=\"line\">  res.end(<span class=\"string\">&#x27;Hello World&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(port, hostname, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">`Server running at http://<span class=\"subst\">$&#123;hostname&#125;</span>:<span class=\"subst\">$&#123;port&#125;</span>/`</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Express-简介\"><a href=\"#Express-简介\" class=\"headerlink\" title=\"Express 简介\"></a>Express 简介</h2><p>Express 是一个简洁而灵活的 node.js Web 应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。</p>\n<p>使用 Express 可以快速地搭建一个完整功能的网站。</p>\n<p>Express 框架核心特性：</p>\n<ul>\n<li>可以设置中间件来响应 HTTP 请求。</li>\n<li>定义了路由表用于执行不同的 HTTP 请求动作。</li>\n<li>可以通过向模板传递参数来动态渲染 HTML 页面。</li>\n<li>介绍就先告一段落了，接下来通过一个项目实例来进行 node 搭建服务的讲解</li>\n</ul>\n<h2 id=\"Node-简单的-api-编写\"><a href=\"#Node-简单的-api-编写\" class=\"headerlink\" title=\"Node 简单的 api 编写\"></a>Node 简单的 api 编写</h2><h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>此章节采用项目实例直接演示如何实现简单 API 的编写。前端项目采用的技术栈是基于 Vue + Antdv，用 vue-cli 构建前端界面，后端项目采用的技术栈是基于 Node.js + Express + MySQL，用 Express 搭建的后端服务器。</p>\n<h3 id=\"前端部分\"><a href=\"#前端部分\" class=\"headerlink\" title=\"前端部分\"></a>前端部分</h3><p>使用 Vue + antdv，用 vue-cli 构建前端项目</p>\n<h4 id=\"目录结构\"><a href=\"#目录结构\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h4><figure class=\"highlight m\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">│ package.json // npm 包管理所需模块及配置信息</span><br><span class=\"line\">│ vue.config.js // webpack 配置</span><br><span class=\"line\">├─public</span><br><span class=\"line\">│ favicon.ico // 图标</span><br><span class=\"line\">│ index.html // 入口 html 文件</span><br><span class=\"line\">└─src</span><br><span class=\"line\">│ App.vue // 根组件</span><br><span class=\"line\">│ main.js // 程序入口文件</span><br><span class=\"line\">│ permission.js // 权限拦截</span><br><span class=\"line\">│ globla.less // 全局样式</span><br><span class=\"line\">├─api</span><br><span class=\"line\">│ task.js // 任务模块接口</span><br><span class=\"line\">│ user.js // 用户模块接口</span><br><span class=\"line\">├─assets // 存放公共图片文件夹</span><br><span class=\"line\">├─components</span><br><span class=\"line\">│ ProLayout // Pro 布局组建</span><br><span class=\"line\">├─layouts</span><br><span class=\"line\">│ index.js // 布局整合</span><br><span class=\"line\">│ UserLayout.vue // 用户布局</span><br><span class=\"line\">│ BasicLayout.vue // 基本布局</span><br><span class=\"line\">├─core</span><br><span class=\"line\">│ lazy_use.js // 懒加载使用的 antd 等</span><br><span class=\"line\">├─router</span><br><span class=\"line\">│ index.js // 单页面路由注册组件</span><br><span class=\"line\">├─store</span><br><span class=\"line\">│ │ index.js // 状态管理仓库入口文件</span><br><span class=\"line\">│ │ getters.js // getter</span><br><span class=\"line\">│ │ mutation-types.js // store 使用的常量</span><br><span class=\"line\">│ └─modules</span><br><span class=\"line\">│ user.js // 用户模块状态管理文件</span><br><span class=\"line\">├─utils</span><br><span class=\"line\">│ axios.js // 安装 axios 插件</span><br><span class=\"line\">│ domUtils.js // 操作页签 title</span><br><span class=\"line\">│ request.js // axios 封装与拦截器配置</span><br><span class=\"line\">└─views</span><br><span class=\"line\">user // 用户模块页面</span><br><span class=\"line\">task // 任务模块页面</span><br><span class=\"line\"><span class=\"number\">404</span>.vue // <span class=\"number\">404</span> 页面</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"MySQL-与-Navicat\"><a href=\"#MySQL-与-Navicat\" class=\"headerlink\" title=\"MySQL 与 Navicat\"></a>MySQL 与 Navicat</h3><p>MySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 是最好的 RDBMS(Relational Database Management System：关系数据库管理系统)应用软件之一。</p>\n<p>Navicat premium 是一款数据库管理工具,是一个可多重连线资料库的管理工具，它可以让你以单一程式同时连线到 MySQL、SQLite、Oracle 及 PostgreSQL 资料库，让管理不同类型的资料库更加的方便。</p>\n<h4 id=\"数据库设计部分\"><a href=\"#数据库设计部分\" class=\"headerlink\" title=\"数据库设计部分\"></a>数据库设计部分</h4><p>使用 MYSQL，创建数据库 todo，创建 sys_user 用户表及创建 sys_task 任务表</p>\n<p>-创建数据库–</p>\n<p><code>CREATE DATABASE </code>todo<code> DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</code><br>–创建用户表–</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP TABLE IF EXISTS <span class=\"string\">`sys_user`</span>;</span><br><span class=\"line\">CREATE TABLE <span class=\"string\">`sys_user`</span> (</span><br><span class=\"line\"><span class=\"string\">`id`</span> BIGINT(<span class=\"number\">20</span>) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT <span class=\"string\">&#x27;唯一标识&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`username`</span> VARCHAR(<span class=\"number\">50</span>) NOT NULL COMMENT <span class=\"string\">&#x27;登录帐号&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`password`</span> VARCHAR(<span class=\"number\">64</span>) NOT NULL  COMMENT <span class=\"string\">&#x27;登录密码&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`nickname`</span> VARCHAR(<span class=\"number\">50</span>) NULL DEFAULT <span class=\"string\">&#x27;&#x27;</span> COMMENT <span class=\"string\">&#x27;昵称&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`avator`</span> VARCHAR(<span class=\"number\">50</span>) NULL DEFAULT <span class=\"string\">&#x27;&#x27;</span> COMMENT <span class=\"string\">&#x27;用户头像&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`sex`</span> int(<span class=\"number\">3</span>) NULL DEFAULT <span class=\"number\">0</span> COMMENT <span class=\"string\">&#x27;性别：0:未知, 1:男, 2:女&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`gmt_create`</span> BIGINT(<span class=\"number\">13</span>) NOT NULL COMMENT <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`gmt_modify`</span> BIGINT(<span class=\"number\">13</span>) NOT NULL COMMENT <span class=\"string\">&#x27;修改时间&#x27;</span>,</span><br><span class=\"line\"> PRIMARY KEY (<span class=\"string\">`id`</span>) USING BTREE,</span><br><span class=\"line\"> UNIQUE KEY <span class=\"string\">`username_UNIQUE`</span> (<span class=\"string\">`username`</span>)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=<span class=\"number\">1</span> COMMENT=<span class=\"string\">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>–创建任务表–</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP TABLE IF EXISTS <span class=\"string\">`sys_task`</span>;</span><br><span class=\"line\">CREATE TABLE <span class=\"string\">`sys_task`</span> (</span><br><span class=\"line\"><span class=\"string\">`id`</span> bigint(<span class=\"number\">20</span>) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT <span class=\"string\">&#x27;唯一标识&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`title`</span> varchar(<span class=\"number\">100</span>) NOT NULL COMMENT <span class=\"string\">&#x27;任务名称&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`description`</span> varchar(<span class=\"number\">255</span>) NOT NULL COMMENT <span class=\"string\">&#x27;任务内容&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`status`</span> int(<span class=\"number\">3</span>) NULL DEFAULT <span class=\"number\">0</span> COMMENT <span class=\"string\">&#x27;任务状态：0:待办 1:完成 2:删除&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`gmt_create`</span> bigint(<span class=\"number\">13</span>) NOT NULL COMMENT <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`gmt_expire`</span> bigint(<span class=\"number\">13</span>) NOT NULL COMMENT <span class=\"string\">&#x27;截止日期&#x27;</span>,</span><br><span class=\"line\">PRIMARY KEY (<span class=\"string\">`id`</span>) USING BTREE</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=<span class=\"number\">1</span> COMMENT=<span class=\"string\">&#x27;任务表&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"后端部分\"><a href=\"#后端部分\" class=\"headerlink\" title=\"后端部分\"></a>后端部分</h3><p>使用 Node.js + Express + MySQL，搭建的后端服务器。</p>\n<h4 id=\"目录结构-1\"><a href=\"#目录结构-1\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h4><figure class=\"highlight m\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">│  app.js                             // 入口文件</span><br><span class=\"line\">│  package.json                       // npm包管理所需模块及配置信息</span><br><span class=\"line\">│  bin</span><br><span class=\"line\">│      www                            // start程序运行文件</span><br><span class=\"line\">│  config</span><br><span class=\"line\">│      db.js                          // mysql数据库基础配置</span><br><span class=\"line\">├─db</span><br><span class=\"line\">│      mysql.js                       // 封装连接mysql模块</span><br><span class=\"line\">├─routes</span><br><span class=\"line\">│      index.js                       // 初始化路由信息，引入auth中间件</span><br><span class=\"line\">│      tasks.js                       // 任务路由模块</span><br><span class=\"line\">│      users.js                       // 用户路由模块</span><br><span class=\"line\">├─controllers</span><br><span class=\"line\">│      index.js                 \t\t\t // 业务逻辑处理 - 入口</span><br><span class=\"line\">│      tasks.js                 \t\t\t // 业务逻辑处理 - 任务相关接口</span><br><span class=\"line\">│      users.js                 \t\t\t // 业务逻辑处理 - 用户相关接口</span><br><span class=\"line\">└─utils</span><br><span class=\"line\">        constant.js                   // 自定义常量</span><br><span class=\"line\">        crypto.js                     // 加密标准实现方法</span><br><span class=\"line\">        jwtAuth.js                    // jwt-token验证和解析函数</span><br><span class=\"line\">        resHandler.js                 // 包装统一返回格式</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"技术栈\"><a href=\"#技术栈\" class=\"headerlink\" title=\"技术栈\"></a>技术栈</h4><p>后端登录注册功能使用了 jwt-token 认证模式来实现。使用 express、express-validator、jsonwebtoken、express-jwt、mySQL 组件库来简化开发。</p>\n<ul>\n<li>express：提供了创建 Web 服务器的最简单但功能最强大的方法之一。</li>\n<li>express-validator：一个基于 Express 的数据验证中间件，可以方便的判断传入的表单数据是否合法。</li>\n<li>jsonwebtoken：基于 jwt 的概念实现安全的加密方案库，实现加密 token 和解析 token 的功能。</li>\n<li>express-jwt：express-jwt 是在 jsonwebtoken 的基础上做了上层封装，基于 Express 框架下认证 jwt 的中间件，来实现 jwt 的认证功能。</li>\n<li>http-errors：轻松创建 Express，Koa，Connect 等的 HTTP 错误。</li>\n<li>mysql：Node.js 连接 MySQL 数据库。</li>\n<li>nodemon：实现实时热更新，自动重启项目。</li>\n</ul>\n<h4 id=\"功能模块\"><a href=\"#功能模块\" class=\"headerlink\" title=\"功能模块\"></a>功能模块</h4><ul>\n<li>用户模块：登录、注册</li>\n<li>任务模块：todoList 增删改查</li>\n</ul>\n<h4 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h4><ul>\n<li><strong>安装全局依赖</strong></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install express -g or yarn <span class=\"built_in\">global</span> add express</span><br><span class=\"line\">npm install express-generator -g or yarn <span class=\"built_in\">global</span> express-generator</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>使用 express-generator 生成 todo_api 项目</strong></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir todo_api</span><br><span class=\"line\">cd todo_api</span><br><span class=\"line\">express</span><br><span class=\"line\">npm install or yarn install</span><br><span class=\"line\">npm start or yarn start</span><br></pre></td></tr></table></figure>\n\n<p>然后访问 localhost:3000，最简单的服务器就 👌 了</p>\n<ul>\n<li><p><strong>添加自动重启服务</strong></p>\n<p>每次修改 js 文件，我们都需要重启服务器，这样修改的内容才会生效，但是每次重启比较麻烦，影响开发效果。所以我们在开发环境中引入 nodemon 插件，实现实时热更新，自动重启项目。</p>\n</li>\n</ul>\n<p><code>yarn add nodemon -D</code><br>修改 package.json 文件中配置的 start 命令：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;scripts&quot;</span>: &#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;start&quot;</span>: <span class=\"string\">&quot;nodemon ./bin/www&quot;</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><strong>安装相关依赖库</strong><br><code>yarn add express-validator jsonwebtoken express-jwt mysql</code><br>** 修改目录结构**</p>\n</li>\n<li><p><strong>项目配置模块（Config）</strong><br>在根目录下 config 文件夹，并新增 db.js 文件，用于 mysql 数据库基础配置</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 配置</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> MYSQL_CONF = &#123;</span><br><span class=\"line\">  host: <span class=\"string\">&#x27;localhost&#x27;</span>,</span><br><span class=\"line\">  user: <span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">  password: <span class=\"string\">&#x27;xzh123456&#x27;</span>,</span><br><span class=\"line\">  port: <span class=\"string\">&#x27;3306&#x27;</span>,</span><br><span class=\"line\">  database: <span class=\"string\">&#x27;todo&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  MYSQL_CONF</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>数据库模块（DB）</strong><br>在根目录下创建 db 文件夹，并创建 mysql.js 文件，用于封装连接 mysql 模块</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mysql = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mysql&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; MYSQL_CONF &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../config/db&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> connection = <span class=\"function\">() =&gt;</span> mysql.createConnection(MYSQL_CONF)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> querySql = <span class=\"function\">(<span class=\"params\">sql</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> conn = connection()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      conn.query(sql, <span class=\"function\">(<span class=\"params\">err, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">          reject(err)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          resolve(res)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      reject(e)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 释放连接</span></span><br><span class=\"line\">      conn.end()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  querySql</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>工具模块（Utils）</strong><br>在根目录下创建 utils 文件夹</li>\n</ul>\n<p>创建 constant.js 文件，用于自定义常量</p>\n<p>代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  CODE_ERROR: <span class=\"string\">&quot;9999&quot;</span>, <span class=\"comment\">// 请求响应失败code码</span></span><br><span class=\"line\">  CODE_SUCCESS: <span class=\"string\">&quot;0000&quot;</span>, <span class=\"comment\">// 请求响应成功code码</span></span><br><span class=\"line\">  PRIVATE_KEY: <span class=\"string\">&quot;todo&quot;</span>, <span class=\"comment\">// 自定义jwt加密的私钥</span></span><br><span class=\"line\">  JWT_EXPIRED: <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">24</span>, <span class=\"comment\">// 过期时间24小时</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">创建crypto.js文件，用于加密标准实现方法</span><br></pre></td></tr></table></figure>\n\n<p>代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;crypto&#x27;</span>) <span class=\"comment\">// 引入crypto加密模块</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> md5 = <span class=\"function\">(<span class=\"params\">v</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> crypto</span><br><span class=\"line\">    .createHash(<span class=\"string\">&#x27;md5&#x27;</span>)</span><br><span class=\"line\">    .update(<span class=\"string\">&#x27;&#x27;</span> + v)</span><br><span class=\"line\">    .digest(<span class=\"string\">&#x27;hex&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  md5</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;crypto&#x27;</span>) <span class=\"comment\">// 引入crypto加密模块</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> md5 = <span class=\"function\">(<span class=\"params\">v</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> crypto</span><br><span class=\"line\">    .createHash(<span class=\"string\">&#x27;md5&#x27;</span>)</span><br><span class=\"line\">    .update(<span class=\"string\">&#x27;&#x27;</span> + v)</span><br><span class=\"line\">    .digest(<span class=\"string\">&#x27;hex&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  md5</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建 jwtAuth.js 文件，用于 jwt-token 验证和解析函数<br>代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> expressJwt = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-jwt&#x27;</span>) <span class=\"comment\">// 引入express-jwt模块</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; PRIVATE_KEY &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./constant&#x27;</span>) <span class=\"comment\">// 引入自定义的jwt密钥</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 验证token是否过期</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> jwtAuth = expressJwt(&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 设置密钥</span></span><br><span class=\"line\">  secret: PRIVATE_KEY,</span><br><span class=\"line\">  <span class=\"comment\">// 设置为true表示校验，false表示不校验</span></span><br><span class=\"line\">  credentialsRequired: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  algorithms: [<span class=\"string\">&#x27;HS256&#x27;</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 自定义获取token的函数</span></span><br><span class=\"line\">  getToken: <span class=\"function\">(<span class=\"params\">req</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(req.headers[<span class=\"string\">&#x27;access-token&#x27;</span>])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (req.headers[<span class=\"string\">&#x27;access-token&#x27;</span>]) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> req.headers[<span class=\"string\">&#x27;access-token&#x27;</span>]</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (req.query &amp;&amp; req.query.token) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> req.query.token</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 设置jwt认证白名单，比如/api/user/login登录接口不需要拦截</span></span><br><span class=\"line\">&#125;).unless(&#123;</span><br><span class=\"line\">  path: [<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"string\">&#x27;/api/user/login&#x27;</span>, <span class=\"string\">&#x27;/api/user/register&#x27;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  jwtAuth</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>路由控制层（Routes）</strong><br>创建 index.js 文件，代码如下</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = express.Router()</span><br><span class=\"line\"><span class=\"keyword\">const</span> userRouter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./users&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> taskRouter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./tasks&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">router.use(<span class=\"string\">&#x27;/api/user&#x27;</span>, userRouter)</span><br><span class=\"line\">router.use(<span class=\"string\">&#x27;/api/task&#x27;</span>, taskRouter)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = router</span><br></pre></td></tr></table></figure>\n\n<p>创建 users.js 文件，代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = express.Router()</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; userController &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; checkSchema &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-validator&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> rules = &#123;</span><br><span class=\"line\">  loginValidator: checkSchema(&#123;</span><br><span class=\"line\">    username: &#123;</span><br><span class=\"line\">      isLength: &#123;</span><br><span class=\"line\">        errorMessage: <span class=\"string\">&#x27;username长度至少5位&#x27;</span>,</span><br><span class=\"line\">        options: &#123; <span class=\"attr\">min</span>: <span class=\"number\">5</span> &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    password: &#123;</span><br><span class=\"line\">      isLength: &#123;</span><br><span class=\"line\">        errorMessage: <span class=\"string\">&#x27;password长度至少5位&#x27;</span>,</span><br><span class=\"line\">        options: &#123; <span class=\"attr\">min</span>: <span class=\"number\">5</span> &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 登录</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/login&#x27;</span>, rules.loginValidator, userController.login)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 注册</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/register&#x27;</span>, rules.loginValidator, userController.register)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = router</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>创建 tasks.js 文件，代码如下</strong></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = express.Router()</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; taskController &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任务列表</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/list&#x27;</span>, taskController.getTaskList)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任务添加</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/add&#x27;</span>, taskController.addTask)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任务编辑</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/update&#x27;</span>, taskController.updateTask)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任务删除</span></span><br><span class=\"line\">router.get(<span class=\"string\">&#x27;/delete&#x27;</span>, taskController.deleteTask)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = router</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><strong>业务逻辑层（Controllers）</strong><br>在写业务逻辑层之前，我们先来看一下，sql 语句的一些返回值 数据库操作( CURD)</p>\n<p>在根目录下创建 controlles 文件夹</p>\n<p>创建 index.js 文件，代码如下</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> userController = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./users&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> taskController = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./tasks&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  userController,</span><br><span class=\"line\">  taskController</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建 users.js 文件，代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> jwt = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; validationResult &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-validator&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; querySql &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../db/mysql&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; md5 &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../utils/crypto&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; PRIVATE_KEY, JWT_EXPIRED &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../utils/constant&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; getErrorRes, getSuccessRes &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../utils/resHandler&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">login</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; username, password &#125; = req.body</span><br><span class=\"line\">      password = md5(password)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`select * from sys_user where username=&#x27;<span class=\"subst\">$&#123;username&#125;</span>&#x27; and password=&#x27;<span class=\"subst\">$&#123;password&#125;</span>&#x27;`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> findRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--查询登录账号数据--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (findRes.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;用户名或密码错误&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 登录成功，签发一个token并返回给前端</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> token = jwt.sign(</span><br><span class=\"line\">            <span class=\"comment\">// payload：签发的 token 里面要包含的一些数据。</span></span><br><span class=\"line\">            &#123; username &#125;,</span><br><span class=\"line\">            <span class=\"comment\">// 私钥</span></span><br><span class=\"line\">            PRIVATE_KEY,</span><br><span class=\"line\">            &#123; <span class=\"attr\">algorithm</span>: <span class=\"string\">&#x27;HS256&#x27;</span>, <span class=\"attr\">expiresIn</span>: JWT_EXPIRED &#125;</span><br><span class=\"line\">          )</span><br><span class=\"line\">          <span class=\"keyword\">let</span> userData = &#123;</span><br><span class=\"line\">            id: findRes[<span class=\"number\">0</span>].id,</span><br><span class=\"line\">            username: findRes[<span class=\"number\">0</span>].username,</span><br><span class=\"line\">            nickname: findRes[<span class=\"number\">0</span>].nickname</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = getSuccessRes(&#123;</span><br><span class=\"line\">            message: <span class=\"string\">&#x27;登录成功&#x27;</span>,</span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\">              token,</span><br><span class=\"line\">              userData</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          res.json(result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">register</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; username, password &#125; = req.body</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`select id, username from sys_user where username=&#x27;<span class=\"subst\">$&#123;username&#125;</span>&#x27;`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> findRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--查询用户是否已存在--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (findRes &amp;&amp; findRes.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;用户已存在&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          password = md5(password)</span><br><span class=\"line\">          <span class=\"keyword\">const</span> sql = <span class=\"string\">`insert into sys_user(username, password, gmt_create, gmt_modify) values(&#x27;<span class=\"subst\">$&#123;username&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;password&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()&#125;</span>&#x27;)`</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> insertRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--注册用户--&#x27;</span>, insertRes)</span><br><span class=\"line\">          res.json(getSuccessRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;注册成功&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"keyword\">new</span> UserController()</span><br></pre></td></tr></table></figure>\n\n<p>创建 tasks.js 文件，代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; querySql &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../db/mysql&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; validationResult &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-validator&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; getErrorRes, getSuccessRes &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../utils/resHandler&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TaskController</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">getTaskList</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; pageNum, pageSize = <span class=\"number\">10</span> &#125; = req.body</span><br><span class=\"line\">      <span class=\"keyword\">let</span> query = <span class=\"string\">`select d.id, d.title, d.description, d.status, d.gmt_create, d.gmt_expire from sys_task d where status != &#x27;2&#x27;`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> findRes = <span class=\"keyword\">await</span> querySql(query)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--查询任务列表--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> isLimit = findRes.length &gt; pageSize</span><br><span class=\"line\">        <span class=\"keyword\">let</span> limitRes = []</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isLimit) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> n = (pageNum - <span class=\"number\">1</span>) * pageSize</span><br><span class=\"line\">          limitRes = <span class=\"keyword\">await</span> querySql(query + <span class=\"string\">` limit <span class=\"subst\">$&#123;n&#125;</span> , <span class=\"subst\">$&#123;pageSize&#125;</span>`</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        res.json(</span><br><span class=\"line\">          getSuccessRes(&#123;</span><br><span class=\"line\">            message: <span class=\"string\">&#x27;查询数据成功&#x27;</span>,</span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\">              total: findRes.length,</span><br><span class=\"line\">              list: isLimit ? limitRes : findRes,</span><br><span class=\"line\">              pageNum,</span><br><span class=\"line\">              pageSize</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">addTask</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; title, description, gmt_expire &#125; = req.body</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`select id, title from sys_task where title=&#x27;<span class=\"subst\">$&#123;title&#125;</span>&#x27; and status != 2`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> findRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--addTask先查找同名任务--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (findRes &amp;&amp; findRes.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;任务已存在&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> sql = <span class=\"string\">`insert into sys_task(title, description, gmt_create, gmt_expire) values(&#x27;<span class=\"subst\">$&#123;title&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;description&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()&#125;</span>&#x27;, <span class=\"subst\">$&#123;gmt_expire&#125;</span>)`</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> insertRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--添加task数据--&#x27;</span>, insertRes)</span><br><span class=\"line\">          res.json(getSuccessRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;添加数据成功&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">updateTask</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"comment\">// 如果验证错误，empty不为空</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; id, title, description, status, gmt_expire &#125; = req.body</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`select id, title from sys_task where id != <span class=\"subst\">$&#123;id&#125;</span> and title=&#x27;<span class=\"subst\">$&#123;title&#125;</span>&#x27; and status != 2 `</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> findRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--查询不等于当前id的任务是否存在--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (findRes &amp;&amp; findRes.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;任务已存在&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> sql = <span class=\"string\">`update sys_task set title=&#x27;<span class=\"subst\">$&#123;title&#125;</span>&#x27;, description=&#x27;<span class=\"subst\">$&#123;description&#125;</span>&#x27;,status=&#x27;<span class=\"subst\">$&#123;status&#125;</span>&#x27;, gmt_expire=&#x27;<span class=\"subst\">$&#123;gmt_expire&#125;</span>&#x27; where id=&#x27;<span class=\"subst\">$&#123;id&#125;</span>&#x27;`</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> updateRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">`--更新当前<span class=\"subst\">$&#123;id&#125;</span>的任务数据--`</span>, updateRes)</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (updateRes &amp;&amp; updateRes.affectedRows &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            res.json(getSuccessRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;更新数据成功&#x27;</span> &#125;))</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;更新数据失败&#x27;</span> &#125;))</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">deleteTask</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; id, status &#125; = req.query</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`update sys_task set status=&#x27;<span class=\"subst\">$&#123;status&#125;</span>&#x27; where id=&#x27;<span class=\"subst\">$&#123;id&#125;</span>&#x27;`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> deleteRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`--删除<span class=\"subst\">$&#123;id&#125;</span>的任务数据--`</span>, deleteRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (deleteRes &amp;&amp; deleteRes.affectedRows &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getSuccessRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;删除数据成功&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;删除数据失败&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"keyword\">new</span> TaskController()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>入口文件配置</strong><br>在根目录 app.js 程序入口文件中，导入 Express 模块，再引入常用的中间件和自定义 routes 路由的中间件，代码如下：</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createError = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http-errors&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> cookieParser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cookie-parser&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;morgan&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; getErrorRes &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./utils/resHandler&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> routes = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes/index&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = express()</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(logger(<span class=\"string\">&#x27;dev&#x27;</span>))</span><br><span class=\"line\">app.use(express.json())</span><br><span class=\"line\">app.use(express.urlencoded(&#123; <span class=\"attr\">extended</span>: <span class=\"literal\">false</span> &#125;))</span><br><span class=\"line\">app.use(cookieParser())</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"string\">&#x27;/&#x27;</span>, routes)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// catch 404 and forward to error handler</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  next(createError(<span class=\"number\">404</span>))</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// error handler</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// set locals, only providing error in development</span></span><br><span class=\"line\">  res.locals.message = err.message</span><br><span class=\"line\">  res.locals.error = req.app.get(<span class=\"string\">&#x27;env&#x27;</span>) === <span class=\"string\">&#x27;development&#x27;</span> ? err : &#123;&#125;</span><br><span class=\"line\">  res.status(err.status || <span class=\"number\">500</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (err.status == <span class=\"number\">401</span>) &#123;</span><br><span class=\"line\">    res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;用户未登录&#x27;</span> &#125;))</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: err.message || <span class=\"string\">&#x27;服务器出错&#x27;</span> &#125;))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = app</span><br></pre></td></tr></table></figure>\n\n<p>到此基于 Vue + antdv + Express + Node.js + MySQL 实现的前后端功能已基本完成，此章节暂告一段落。</p>\n<h2 id=\"什么是-BFF\"><a href=\"#什么是-BFF\" class=\"headerlink\" title=\"什么是 BFF\"></a>什么是 BFF</h2><p>BFF，即 Backends For Frontends（服务于前端的后端）。在 2015 年，Sam Newman 对此提出了，Pattern: Backends For Frontends ，国内也俗称为粘合层。</p>\n<p>在 BFF 理念中，最重要的一点是： 服务自治，谁使用谁开发，即它应该由前端同学去维护。</p>\n<ul>\n<li>服务自治减少了沟通成本，带来了灵活和高效。</li>\n<li>BFF 并不限制具体技术，团队根据自己的技术栈来选型： Java/Node/PHP/Python/Ruby…<br>PS：Serverless For Frontend</li>\n</ul>\n<h3 id=\"为什么选择-Node-作为中间层\"><a href=\"#为什么选择-Node-作为中间层\" class=\"headerlink\" title=\"为什么选择 Node 作为中间层\"></a>为什么选择 Node 作为中间层</h3><p><img src=\"/images/common/bff.png\" alt=\"network\"></p>\n<h4 id=\"业务驱动\"><a href=\"#业务驱动\" class=\"headerlink\" title=\"业务驱动\"></a>业务驱动</h4><p>Node 有个突出的优势，他的开发者可以是前端，都会倾向于选择生态更优，语法更熟悉的 Node.js。</p>\n<p>前端对于页面所需要的数据有更好的理解，每个页面要用到哪些接口，每个接口要用到哪些字段前端是最清楚的。再加上实际业务开发中，前端页面需求经常会发生变化，需要修改字段或者数据结构，所以对接页面的这部分接口由前端直接开发非常合适，可以显著的减少沟通成本。</p>\n<h4 id=\"架构需要\"><a href=\"#架构需要\" class=\"headerlink\" title=\"架构需要\"></a>架构需要</h4><p>面向用户的接口由 Node 中间层负责以后，真正的服务端可以专注于提供基于领域模型的对内接口，做微服务。</p>\n<p>比如可以基于 Goods 模型，提供所有商品相关的接口；基于 Users 模型，提供所有用户相关接口。当一个接口需要商品+用户信息时，由 Node 分别查询组装。从整体业务代码维护角度来说，变得更容易，不会因为业务发展使得每个接口都异常繁杂。</p>\n<h4 id=\"性能满足\"><a href=\"#性能满足\" class=\"headerlink\" title=\"性能满足\"></a>性能满足</h4><p>如果仅仅是架构层面的需求，需要有一个中间层来沉淀业务，那用 Java，PHP 也可以做到，为什么说 Node 更适合做呢？</p>\n<p>因为 Node 天生异步！</p>\n<p>众所周知，js 是一门单线程语言，所以 Node 在实现的时候，需要借助 libuv 来实现异步。libuv 为 Node 提供了线程池，事件池，异步 I/O 等能力。正是因为其中网络 I/O 的异步能力，可以让 Node 做接口聚合时，能够更高效的异步并发处理。</p>\n<h4 id=\"成本较低\"><a href=\"#成本较低\" class=\"headerlink\" title=\"成本较低\"></a>成本较低</h4><p>Node 使用 js 开发，只需要学习简单的 api，前端开发者就可以无障碍使用，学习成本很低。</p>\n<p>而且，Node 具有活跃的社区和丰富的模块池，拥有很多现成的功能实现。框架方面，也有成熟的 koa，express 等基本框架和 egg 等二次封装框架，可根据需求选择上手也比较方便。</p>\n<p><strong>中间层能为我们做些什么？</strong><br><img src=\"/images/common/bff-1.jpeg\" alt=\"network\"></p>\n<ul>\n<li>代理：在开发环境下，我们可以利用代理来，解决最常见的跨域问题；在线上环境下，我们可以利用代理，转发请求到多个服务端。</li>\n<li>缓存：缓存其实是更靠近前端的需求，用户的动作触发数据的更新，node 中间层可以直接处理一部分缓存需求。</li>\n<li>限流：node 中间层，可以针对接口或者路由做响应的限流。</li>\n<li>日志：相比其他服务端语言，node 中间层的日志记录，能更方便快捷的定位问题（是在浏览器端还是服务端）。</li>\n<li>监控：擅长高并发的请求处理，做监控也是合适的选项。</li>\n<li>鉴权：有一个中间层去鉴权，也是一种单一职责的实现。</li>\n<li>路由：前端更需要掌握页面路由的权限和逻辑。</li>\n<li><strong>服务端渲染：</strong>node 中间层的解决方案更灵活，比如 SSR、模板直出、利用一些 JS 库做预渲染等等。<br>更多的可能性</li>\n</ul>\n<p><strong>中间层业务接口实践思路</strong><br>非标准，只是一种参考<br><img src=\"/images/common/bff-2.jpeg\" alt=\"network\"></p>\n","site":{"data":{}},"excerpt":"<p>Node.js 对前端来说无疑具有里程碑意义，尤其是在越来越流行的今天，掌握 Node.js 技术已经不仅仅是加分项，而是前端攻城师们需要去掌握的一项技能。</p>","more":"<h2 id=\"Node-js-是什么\"><a href=\"#Node-js-是什么\" class=\"headerlink\" title=\"Node.js 是什么\"></a>Node.js 是什么</h2><p>简单的说 Node.js 就是一个 javascript 运行环境。它让 javascript 可以开发后端程序，实现几乎其他后端语言实现的所有功能，可以与 PHP、Java、Python、.NET、Ruby 等后端语言一较高下。</p>\n<p>Node.js 是一个基于 Chrome JavaScript 运行时建立的一个平台。</p>\n<p>Node.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。<br><code>Node.js = Runtime Environment + JavaScript Library</code></p>\n<h2 id=\"Node-js-优势\"><a href=\"#Node-js-优势\" class=\"headerlink\" title=\"Node.js 优势\"></a>Node.js 优势</h2><ul>\n<li><p><strong>Nodejs 语法完全是 js 语法</strong><br>只要你懂 js 基础就可以学会 Nodejs 后端开发，对前端开发者友好。</p>\n</li>\n<li><p><strong>NodeJs 超强的高并发能力</strong><br>放弃了“为每一个用户连接创建一个新线程”的思想，通过非阻塞 I/O、事件驱动机制，让 Node.js 程序宏观上也是并行的。</p>\n</li>\n<li><p><strong>实现高性能服务器</strong><br>严格地说，Node.js 是一个用于开发各种 web 服务器的开发工具。在 Node.js 服务器中，运行的是高性能 V8 JavaScript 脚本语言，该语言是一种可以运行在服务器端的脚本语言。</p>\n<p>Node.js 自身哲学，是话最小的硬件成本，追求更高的并发，更高的处理性能。</p>\n</li>\n</ul>\n<h2 id=\"Node-js-特点\"><a href=\"#Node-js-特点\" class=\"headerlink\" title=\"Node.js 特点\"></a>Node.js 特点</h2><p>异步事件驱动、非堵塞 I/O</p>\n<ul>\n<li><p><strong>Node.js 使用事件驱动模型，当 web server 接收到请求，就把它关闭然后进行处理，然后去服务下一个 web 请求。</strong><br>当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。<br>这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。这个模型非常高效可扩展性非常强，因为 webserver 一直接受请求而不等待任何读写操作。（这也被称之为非阻塞式 IO 或者事件驱动 IO）</p>\n<p>在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数</p>\n</li>\n<li><p><strong>单线程</strong></p>\n<p>Nodejs 跟 Nginx 一样都是单线程为基础的，这里的单线程指主线程为单线程，所有的阻塞的全部放入一个线程池中，然后主线程通过队列的方式跟线程池来协作。我们写 js 部分不需要关心线程的问题，简单了解就可以了，主要由一堆 callback 回调构成的，然后主线程在循环过在适当场合调用。</p>\n</li>\n<li><p><strong>性能出众</strong></p>\n<p>底层选择用 c++和 v8 来实现的，上面第一点讲到过，nodejs 的事件驱动机制，这意味着面对大规模的 http 请求，nodejs 是凭借事件驱动来完成的，性能部分是不用担心的，并且很出色。</p>\n</li>\n</ul>\n<h2 id=\"Node-js-应用实例\"><a href=\"#Node-js-应用实例\" class=\"headerlink\" title=\"Node.js 应用实例\"></a>Node.js 应用实例</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hostname = <span class=\"string\">&#x27;127.0.0.1&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = <span class=\"number\">3000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.createServer(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  res.statusCode = <span class=\"number\">200</span>;</span><br><span class=\"line\">  res.setHeader(<span class=\"string\">&#x27;Content-Type&#x27;</span>, <span class=\"string\">&#x27;text/plain&#x27;</span>);</span><br><span class=\"line\">  res.end(<span class=\"string\">&#x27;Hello World&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(port, hostname, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">`Server running at http://<span class=\"subst\">$&#123;hostname&#125;</span>:<span class=\"subst\">$&#123;port&#125;</span>/`</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Express-简介\"><a href=\"#Express-简介\" class=\"headerlink\" title=\"Express 简介\"></a>Express 简介</h2><p>Express 是一个简洁而灵活的 node.js Web 应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。</p>\n<p>使用 Express 可以快速地搭建一个完整功能的网站。</p>\n<p>Express 框架核心特性：</p>\n<ul>\n<li>可以设置中间件来响应 HTTP 请求。</li>\n<li>定义了路由表用于执行不同的 HTTP 请求动作。</li>\n<li>可以通过向模板传递参数来动态渲染 HTML 页面。</li>\n<li>介绍就先告一段落了，接下来通过一个项目实例来进行 node 搭建服务的讲解</li>\n</ul>\n<h2 id=\"Node-简单的-api-编写\"><a href=\"#Node-简单的-api-编写\" class=\"headerlink\" title=\"Node 简单的 api 编写\"></a>Node 简单的 api 编写</h2><h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>此章节采用项目实例直接演示如何实现简单 API 的编写。前端项目采用的技术栈是基于 Vue + Antdv，用 vue-cli 构建前端界面，后端项目采用的技术栈是基于 Node.js + Express + MySQL，用 Express 搭建的后端服务器。</p>\n<h3 id=\"前端部分\"><a href=\"#前端部分\" class=\"headerlink\" title=\"前端部分\"></a>前端部分</h3><p>使用 Vue + antdv，用 vue-cli 构建前端项目</p>\n<h4 id=\"目录结构\"><a href=\"#目录结构\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h4><figure class=\"highlight m\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">│ package.json // npm 包管理所需模块及配置信息</span><br><span class=\"line\">│ vue.config.js // webpack 配置</span><br><span class=\"line\">├─public</span><br><span class=\"line\">│ favicon.ico // 图标</span><br><span class=\"line\">│ index.html // 入口 html 文件</span><br><span class=\"line\">└─src</span><br><span class=\"line\">│ App.vue // 根组件</span><br><span class=\"line\">│ main.js // 程序入口文件</span><br><span class=\"line\">│ permission.js // 权限拦截</span><br><span class=\"line\">│ globla.less // 全局样式</span><br><span class=\"line\">├─api</span><br><span class=\"line\">│ task.js // 任务模块接口</span><br><span class=\"line\">│ user.js // 用户模块接口</span><br><span class=\"line\">├─assets // 存放公共图片文件夹</span><br><span class=\"line\">├─components</span><br><span class=\"line\">│ ProLayout // Pro 布局组建</span><br><span class=\"line\">├─layouts</span><br><span class=\"line\">│ index.js // 布局整合</span><br><span class=\"line\">│ UserLayout.vue // 用户布局</span><br><span class=\"line\">│ BasicLayout.vue // 基本布局</span><br><span class=\"line\">├─core</span><br><span class=\"line\">│ lazy_use.js // 懒加载使用的 antd 等</span><br><span class=\"line\">├─router</span><br><span class=\"line\">│ index.js // 单页面路由注册组件</span><br><span class=\"line\">├─store</span><br><span class=\"line\">│ │ index.js // 状态管理仓库入口文件</span><br><span class=\"line\">│ │ getters.js // getter</span><br><span class=\"line\">│ │ mutation-types.js // store 使用的常量</span><br><span class=\"line\">│ └─modules</span><br><span class=\"line\">│ user.js // 用户模块状态管理文件</span><br><span class=\"line\">├─utils</span><br><span class=\"line\">│ axios.js // 安装 axios 插件</span><br><span class=\"line\">│ domUtils.js // 操作页签 title</span><br><span class=\"line\">│ request.js // axios 封装与拦截器配置</span><br><span class=\"line\">└─views</span><br><span class=\"line\">user // 用户模块页面</span><br><span class=\"line\">task // 任务模块页面</span><br><span class=\"line\"><span class=\"number\">404</span>.vue // <span class=\"number\">404</span> 页面</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"MySQL-与-Navicat\"><a href=\"#MySQL-与-Navicat\" class=\"headerlink\" title=\"MySQL 与 Navicat\"></a>MySQL 与 Navicat</h3><p>MySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 是最好的 RDBMS(Relational Database Management System：关系数据库管理系统)应用软件之一。</p>\n<p>Navicat premium 是一款数据库管理工具,是一个可多重连线资料库的管理工具，它可以让你以单一程式同时连线到 MySQL、SQLite、Oracle 及 PostgreSQL 资料库，让管理不同类型的资料库更加的方便。</p>\n<h4 id=\"数据库设计部分\"><a href=\"#数据库设计部分\" class=\"headerlink\" title=\"数据库设计部分\"></a>数据库设计部分</h4><p>使用 MYSQL，创建数据库 todo，创建 sys_user 用户表及创建 sys_task 任务表</p>\n<p>-创建数据库–</p>\n<p><code>CREATE DATABASE </code>todo<code> DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</code><br>–创建用户表–</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP TABLE IF EXISTS <span class=\"string\">`sys_user`</span>;</span><br><span class=\"line\">CREATE TABLE <span class=\"string\">`sys_user`</span> (</span><br><span class=\"line\"><span class=\"string\">`id`</span> BIGINT(<span class=\"number\">20</span>) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT <span class=\"string\">&#x27;唯一标识&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`username`</span> VARCHAR(<span class=\"number\">50</span>) NOT NULL COMMENT <span class=\"string\">&#x27;登录帐号&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`password`</span> VARCHAR(<span class=\"number\">64</span>) NOT NULL  COMMENT <span class=\"string\">&#x27;登录密码&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`nickname`</span> VARCHAR(<span class=\"number\">50</span>) NULL DEFAULT <span class=\"string\">&#x27;&#x27;</span> COMMENT <span class=\"string\">&#x27;昵称&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`avator`</span> VARCHAR(<span class=\"number\">50</span>) NULL DEFAULT <span class=\"string\">&#x27;&#x27;</span> COMMENT <span class=\"string\">&#x27;用户头像&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`sex`</span> int(<span class=\"number\">3</span>) NULL DEFAULT <span class=\"number\">0</span> COMMENT <span class=\"string\">&#x27;性别：0:未知, 1:男, 2:女&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`gmt_create`</span> BIGINT(<span class=\"number\">13</span>) NOT NULL COMMENT <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`gmt_modify`</span> BIGINT(<span class=\"number\">13</span>) NOT NULL COMMENT <span class=\"string\">&#x27;修改时间&#x27;</span>,</span><br><span class=\"line\"> PRIMARY KEY (<span class=\"string\">`id`</span>) USING BTREE,</span><br><span class=\"line\"> UNIQUE KEY <span class=\"string\">`username_UNIQUE`</span> (<span class=\"string\">`username`</span>)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=<span class=\"number\">1</span> COMMENT=<span class=\"string\">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>–创建任务表–</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP TABLE IF EXISTS <span class=\"string\">`sys_task`</span>;</span><br><span class=\"line\">CREATE TABLE <span class=\"string\">`sys_task`</span> (</span><br><span class=\"line\"><span class=\"string\">`id`</span> bigint(<span class=\"number\">20</span>) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT <span class=\"string\">&#x27;唯一标识&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`title`</span> varchar(<span class=\"number\">100</span>) NOT NULL COMMENT <span class=\"string\">&#x27;任务名称&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`description`</span> varchar(<span class=\"number\">255</span>) NOT NULL COMMENT <span class=\"string\">&#x27;任务内容&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`status`</span> int(<span class=\"number\">3</span>) NULL DEFAULT <span class=\"number\">0</span> COMMENT <span class=\"string\">&#x27;任务状态：0:待办 1:完成 2:删除&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`gmt_create`</span> bigint(<span class=\"number\">13</span>) NOT NULL COMMENT <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\"><span class=\"string\">`gmt_expire`</span> bigint(<span class=\"number\">13</span>) NOT NULL COMMENT <span class=\"string\">&#x27;截止日期&#x27;</span>,</span><br><span class=\"line\">PRIMARY KEY (<span class=\"string\">`id`</span>) USING BTREE</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=<span class=\"number\">1</span> COMMENT=<span class=\"string\">&#x27;任务表&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"后端部分\"><a href=\"#后端部分\" class=\"headerlink\" title=\"后端部分\"></a>后端部分</h3><p>使用 Node.js + Express + MySQL，搭建的后端服务器。</p>\n<h4 id=\"目录结构-1\"><a href=\"#目录结构-1\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h4><figure class=\"highlight m\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">│  app.js                             // 入口文件</span><br><span class=\"line\">│  package.json                       // npm包管理所需模块及配置信息</span><br><span class=\"line\">│  bin</span><br><span class=\"line\">│      www                            // start程序运行文件</span><br><span class=\"line\">│  config</span><br><span class=\"line\">│      db.js                          // mysql数据库基础配置</span><br><span class=\"line\">├─db</span><br><span class=\"line\">│      mysql.js                       // 封装连接mysql模块</span><br><span class=\"line\">├─routes</span><br><span class=\"line\">│      index.js                       // 初始化路由信息，引入auth中间件</span><br><span class=\"line\">│      tasks.js                       // 任务路由模块</span><br><span class=\"line\">│      users.js                       // 用户路由模块</span><br><span class=\"line\">├─controllers</span><br><span class=\"line\">│      index.js                 \t\t\t // 业务逻辑处理 - 入口</span><br><span class=\"line\">│      tasks.js                 \t\t\t // 业务逻辑处理 - 任务相关接口</span><br><span class=\"line\">│      users.js                 \t\t\t // 业务逻辑处理 - 用户相关接口</span><br><span class=\"line\">└─utils</span><br><span class=\"line\">        constant.js                   // 自定义常量</span><br><span class=\"line\">        crypto.js                     // 加密标准实现方法</span><br><span class=\"line\">        jwtAuth.js                    // jwt-token验证和解析函数</span><br><span class=\"line\">        resHandler.js                 // 包装统一返回格式</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"技术栈\"><a href=\"#技术栈\" class=\"headerlink\" title=\"技术栈\"></a>技术栈</h4><p>后端登录注册功能使用了 jwt-token 认证模式来实现。使用 express、express-validator、jsonwebtoken、express-jwt、mySQL 组件库来简化开发。</p>\n<ul>\n<li>express：提供了创建 Web 服务器的最简单但功能最强大的方法之一。</li>\n<li>express-validator：一个基于 Express 的数据验证中间件，可以方便的判断传入的表单数据是否合法。</li>\n<li>jsonwebtoken：基于 jwt 的概念实现安全的加密方案库，实现加密 token 和解析 token 的功能。</li>\n<li>express-jwt：express-jwt 是在 jsonwebtoken 的基础上做了上层封装，基于 Express 框架下认证 jwt 的中间件，来实现 jwt 的认证功能。</li>\n<li>http-errors：轻松创建 Express，Koa，Connect 等的 HTTP 错误。</li>\n<li>mysql：Node.js 连接 MySQL 数据库。</li>\n<li>nodemon：实现实时热更新，自动重启项目。</li>\n</ul>\n<h4 id=\"功能模块\"><a href=\"#功能模块\" class=\"headerlink\" title=\"功能模块\"></a>功能模块</h4><ul>\n<li>用户模块：登录、注册</li>\n<li>任务模块：todoList 增删改查</li>\n</ul>\n<h4 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h4><ul>\n<li><strong>安装全局依赖</strong></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install express -g or yarn <span class=\"built_in\">global</span> add express</span><br><span class=\"line\">npm install express-generator -g or yarn <span class=\"built_in\">global</span> express-generator</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>使用 express-generator 生成 todo_api 项目</strong></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir todo_api</span><br><span class=\"line\">cd todo_api</span><br><span class=\"line\">express</span><br><span class=\"line\">npm install or yarn install</span><br><span class=\"line\">npm start or yarn start</span><br></pre></td></tr></table></figure>\n\n<p>然后访问 localhost:3000，最简单的服务器就 👌 了</p>\n<ul>\n<li><p><strong>添加自动重启服务</strong></p>\n<p>每次修改 js 文件，我们都需要重启服务器，这样修改的内容才会生效，但是每次重启比较麻烦，影响开发效果。所以我们在开发环境中引入 nodemon 插件，实现实时热更新，自动重启项目。</p>\n</li>\n</ul>\n<p><code>yarn add nodemon -D</code><br>修改 package.json 文件中配置的 start 命令：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;scripts&quot;</span>: &#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;start&quot;</span>: <span class=\"string\">&quot;nodemon ./bin/www&quot;</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><strong>安装相关依赖库</strong><br><code>yarn add express-validator jsonwebtoken express-jwt mysql</code><br>** 修改目录结构**</p>\n</li>\n<li><p><strong>项目配置模块（Config）</strong><br>在根目录下 config 文件夹，并新增 db.js 文件，用于 mysql 数据库基础配置</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 配置</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> MYSQL_CONF = &#123;</span><br><span class=\"line\">  host: <span class=\"string\">&#x27;localhost&#x27;</span>,</span><br><span class=\"line\">  user: <span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">  password: <span class=\"string\">&#x27;xzh123456&#x27;</span>,</span><br><span class=\"line\">  port: <span class=\"string\">&#x27;3306&#x27;</span>,</span><br><span class=\"line\">  database: <span class=\"string\">&#x27;todo&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  MYSQL_CONF</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>数据库模块（DB）</strong><br>在根目录下创建 db 文件夹，并创建 mysql.js 文件，用于封装连接 mysql 模块</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mysql = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mysql&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; MYSQL_CONF &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../config/db&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> connection = <span class=\"function\">() =&gt;</span> mysql.createConnection(MYSQL_CONF)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> querySql = <span class=\"function\">(<span class=\"params\">sql</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> conn = connection()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      conn.query(sql, <span class=\"function\">(<span class=\"params\">err, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">          reject(err)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          resolve(res)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      reject(e)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 释放连接</span></span><br><span class=\"line\">      conn.end()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  querySql</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>工具模块（Utils）</strong><br>在根目录下创建 utils 文件夹</li>\n</ul>\n<p>创建 constant.js 文件，用于自定义常量</p>\n<p>代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  CODE_ERROR: <span class=\"string\">&quot;9999&quot;</span>, <span class=\"comment\">// 请求响应失败code码</span></span><br><span class=\"line\">  CODE_SUCCESS: <span class=\"string\">&quot;0000&quot;</span>, <span class=\"comment\">// 请求响应成功code码</span></span><br><span class=\"line\">  PRIVATE_KEY: <span class=\"string\">&quot;todo&quot;</span>, <span class=\"comment\">// 自定义jwt加密的私钥</span></span><br><span class=\"line\">  JWT_EXPIRED: <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">24</span>, <span class=\"comment\">// 过期时间24小时</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">创建crypto.js文件，用于加密标准实现方法</span><br></pre></td></tr></table></figure>\n\n<p>代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;crypto&#x27;</span>) <span class=\"comment\">// 引入crypto加密模块</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> md5 = <span class=\"function\">(<span class=\"params\">v</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> crypto</span><br><span class=\"line\">    .createHash(<span class=\"string\">&#x27;md5&#x27;</span>)</span><br><span class=\"line\">    .update(<span class=\"string\">&#x27;&#x27;</span> + v)</span><br><span class=\"line\">    .digest(<span class=\"string\">&#x27;hex&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  md5</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;crypto&#x27;</span>) <span class=\"comment\">// 引入crypto加密模块</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> md5 = <span class=\"function\">(<span class=\"params\">v</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> crypto</span><br><span class=\"line\">    .createHash(<span class=\"string\">&#x27;md5&#x27;</span>)</span><br><span class=\"line\">    .update(<span class=\"string\">&#x27;&#x27;</span> + v)</span><br><span class=\"line\">    .digest(<span class=\"string\">&#x27;hex&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  md5</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建 jwtAuth.js 文件，用于 jwt-token 验证和解析函数<br>代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> expressJwt = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-jwt&#x27;</span>) <span class=\"comment\">// 引入express-jwt模块</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; PRIVATE_KEY &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./constant&#x27;</span>) <span class=\"comment\">// 引入自定义的jwt密钥</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 验证token是否过期</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> jwtAuth = expressJwt(&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 设置密钥</span></span><br><span class=\"line\">  secret: PRIVATE_KEY,</span><br><span class=\"line\">  <span class=\"comment\">// 设置为true表示校验，false表示不校验</span></span><br><span class=\"line\">  credentialsRequired: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  algorithms: [<span class=\"string\">&#x27;HS256&#x27;</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 自定义获取token的函数</span></span><br><span class=\"line\">  getToken: <span class=\"function\">(<span class=\"params\">req</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(req.headers[<span class=\"string\">&#x27;access-token&#x27;</span>])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (req.headers[<span class=\"string\">&#x27;access-token&#x27;</span>]) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> req.headers[<span class=\"string\">&#x27;access-token&#x27;</span>]</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (req.query &amp;&amp; req.query.token) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> req.query.token</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 设置jwt认证白名单，比如/api/user/login登录接口不需要拦截</span></span><br><span class=\"line\">&#125;).unless(&#123;</span><br><span class=\"line\">  path: [<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"string\">&#x27;/api/user/login&#x27;</span>, <span class=\"string\">&#x27;/api/user/register&#x27;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  jwtAuth</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>路由控制层（Routes）</strong><br>创建 index.js 文件，代码如下</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = express.Router()</span><br><span class=\"line\"><span class=\"keyword\">const</span> userRouter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./users&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> taskRouter = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./tasks&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">router.use(<span class=\"string\">&#x27;/api/user&#x27;</span>, userRouter)</span><br><span class=\"line\">router.use(<span class=\"string\">&#x27;/api/task&#x27;</span>, taskRouter)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = router</span><br></pre></td></tr></table></figure>\n\n<p>创建 users.js 文件，代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = express.Router()</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; userController &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; checkSchema &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-validator&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> rules = &#123;</span><br><span class=\"line\">  loginValidator: checkSchema(&#123;</span><br><span class=\"line\">    username: &#123;</span><br><span class=\"line\">      isLength: &#123;</span><br><span class=\"line\">        errorMessage: <span class=\"string\">&#x27;username长度至少5位&#x27;</span>,</span><br><span class=\"line\">        options: &#123; <span class=\"attr\">min</span>: <span class=\"number\">5</span> &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    password: &#123;</span><br><span class=\"line\">      isLength: &#123;</span><br><span class=\"line\">        errorMessage: <span class=\"string\">&#x27;password长度至少5位&#x27;</span>,</span><br><span class=\"line\">        options: &#123; <span class=\"attr\">min</span>: <span class=\"number\">5</span> &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 登录</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/login&#x27;</span>, rules.loginValidator, userController.login)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 注册</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/register&#x27;</span>, rules.loginValidator, userController.register)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = router</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>创建 tasks.js 文件，代码如下</strong></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = express.Router()</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; taskController &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../controllers&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任务列表</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/list&#x27;</span>, taskController.getTaskList)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任务添加</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/add&#x27;</span>, taskController.addTask)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任务编辑</span></span><br><span class=\"line\">router.post(<span class=\"string\">&#x27;/update&#x27;</span>, taskController.updateTask)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 任务删除</span></span><br><span class=\"line\">router.get(<span class=\"string\">&#x27;/delete&#x27;</span>, taskController.deleteTask)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = router</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><strong>业务逻辑层（Controllers）</strong><br>在写业务逻辑层之前，我们先来看一下，sql 语句的一些返回值 数据库操作( CURD)</p>\n<p>在根目录下创建 controlles 文件夹</p>\n<p>创建 index.js 文件，代码如下</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> userController = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./users&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> taskController = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./tasks&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  userController,</span><br><span class=\"line\">  taskController</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建 users.js 文件，代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> jwt = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; validationResult &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-validator&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; querySql &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../db/mysql&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; md5 &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../utils/crypto&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; PRIVATE_KEY, JWT_EXPIRED &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../utils/constant&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; getErrorRes, getSuccessRes &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../utils/resHandler&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">login</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; username, password &#125; = req.body</span><br><span class=\"line\">      password = md5(password)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`select * from sys_user where username=&#x27;<span class=\"subst\">$&#123;username&#125;</span>&#x27; and password=&#x27;<span class=\"subst\">$&#123;password&#125;</span>&#x27;`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> findRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--查询登录账号数据--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (findRes.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;用户名或密码错误&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 登录成功，签发一个token并返回给前端</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> token = jwt.sign(</span><br><span class=\"line\">            <span class=\"comment\">// payload：签发的 token 里面要包含的一些数据。</span></span><br><span class=\"line\">            &#123; username &#125;,</span><br><span class=\"line\">            <span class=\"comment\">// 私钥</span></span><br><span class=\"line\">            PRIVATE_KEY,</span><br><span class=\"line\">            &#123; <span class=\"attr\">algorithm</span>: <span class=\"string\">&#x27;HS256&#x27;</span>, <span class=\"attr\">expiresIn</span>: JWT_EXPIRED &#125;</span><br><span class=\"line\">          )</span><br><span class=\"line\">          <span class=\"keyword\">let</span> userData = &#123;</span><br><span class=\"line\">            id: findRes[<span class=\"number\">0</span>].id,</span><br><span class=\"line\">            username: findRes[<span class=\"number\">0</span>].username,</span><br><span class=\"line\">            nickname: findRes[<span class=\"number\">0</span>].nickname</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = getSuccessRes(&#123;</span><br><span class=\"line\">            message: <span class=\"string\">&#x27;登录成功&#x27;</span>,</span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\">              token,</span><br><span class=\"line\">              userData</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          res.json(result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">register</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; username, password &#125; = req.body</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`select id, username from sys_user where username=&#x27;<span class=\"subst\">$&#123;username&#125;</span>&#x27;`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> findRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--查询用户是否已存在--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (findRes &amp;&amp; findRes.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;用户已存在&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          password = md5(password)</span><br><span class=\"line\">          <span class=\"keyword\">const</span> sql = <span class=\"string\">`insert into sys_user(username, password, gmt_create, gmt_modify) values(&#x27;<span class=\"subst\">$&#123;username&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;password&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()&#125;</span>&#x27;)`</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> insertRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--注册用户--&#x27;</span>, insertRes)</span><br><span class=\"line\">          res.json(getSuccessRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;注册成功&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"keyword\">new</span> UserController()</span><br></pre></td></tr></table></figure>\n\n<p>创建 tasks.js 文件，代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; querySql &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../db/mysql&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; validationResult &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express-validator&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; getErrorRes, getSuccessRes &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../utils/resHandler&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TaskController</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">getTaskList</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; pageNum, pageSize = <span class=\"number\">10</span> &#125; = req.body</span><br><span class=\"line\">      <span class=\"keyword\">let</span> query = <span class=\"string\">`select d.id, d.title, d.description, d.status, d.gmt_create, d.gmt_expire from sys_task d where status != &#x27;2&#x27;`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> findRes = <span class=\"keyword\">await</span> querySql(query)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--查询任务列表--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> isLimit = findRes.length &gt; pageSize</span><br><span class=\"line\">        <span class=\"keyword\">let</span> limitRes = []</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isLimit) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> n = (pageNum - <span class=\"number\">1</span>) * pageSize</span><br><span class=\"line\">          limitRes = <span class=\"keyword\">await</span> querySql(query + <span class=\"string\">` limit <span class=\"subst\">$&#123;n&#125;</span> , <span class=\"subst\">$&#123;pageSize&#125;</span>`</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        res.json(</span><br><span class=\"line\">          getSuccessRes(&#123;</span><br><span class=\"line\">            message: <span class=\"string\">&#x27;查询数据成功&#x27;</span>,</span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\">              total: findRes.length,</span><br><span class=\"line\">              list: isLimit ? limitRes : findRes,</span><br><span class=\"line\">              pageNum,</span><br><span class=\"line\">              pageSize</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">addTask</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; title, description, gmt_expire &#125; = req.body</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`select id, title from sys_task where title=&#x27;<span class=\"subst\">$&#123;title&#125;</span>&#x27; and status != 2`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> findRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--addTask先查找同名任务--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (findRes &amp;&amp; findRes.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;任务已存在&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> sql = <span class=\"string\">`insert into sys_task(title, description, gmt_create, gmt_expire) values(&#x27;<span class=\"subst\">$&#123;title&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;description&#125;</span>&#x27;, &#x27;<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()&#125;</span>&#x27;, <span class=\"subst\">$&#123;gmt_expire&#125;</span>)`</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> insertRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--添加task数据--&#x27;</span>, insertRes)</span><br><span class=\"line\">          res.json(getSuccessRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;添加数据成功&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">updateTask</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"comment\">// 如果验证错误，empty不为空</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; id, title, description, status, gmt_expire &#125; = req.body</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`select id, title from sys_task where id != <span class=\"subst\">$&#123;id&#125;</span> and title=&#x27;<span class=\"subst\">$&#123;title&#125;</span>&#x27; and status != 2 `</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> findRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;--查询不等于当前id的任务是否存在--&#x27;</span>, findRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (findRes &amp;&amp; findRes.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;任务已存在&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> sql = <span class=\"string\">`update sys_task set title=&#x27;<span class=\"subst\">$&#123;title&#125;</span>&#x27;, description=&#x27;<span class=\"subst\">$&#123;description&#125;</span>&#x27;,status=&#x27;<span class=\"subst\">$&#123;status&#125;</span>&#x27;, gmt_expire=&#x27;<span class=\"subst\">$&#123;gmt_expire&#125;</span>&#x27; where id=&#x27;<span class=\"subst\">$&#123;id&#125;</span>&#x27;`</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> updateRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">`--更新当前<span class=\"subst\">$&#123;id&#125;</span>的任务数据--`</span>, updateRes)</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (updateRes &amp;&amp; updateRes.affectedRows &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            res.json(getSuccessRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;更新数据成功&#x27;</span> &#125;))</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;更新数据失败&#x27;</span> &#125;))</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"title\">deleteTask</span>(<span class=\"params\">req, res, next</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> err = validationResult(req)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err.isEmpty()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> [&#123; msg &#125;] = err.errors</span><br><span class=\"line\">      res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: msg &#125;))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; id, status &#125; = req.query</span><br><span class=\"line\">      <span class=\"keyword\">const</span> sql = <span class=\"string\">`update sys_task set status=&#x27;<span class=\"subst\">$&#123;status&#125;</span>&#x27; where id=&#x27;<span class=\"subst\">$&#123;id&#125;</span>&#x27;`</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> deleteRes = <span class=\"keyword\">await</span> querySql(sql)</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`--删除<span class=\"subst\">$&#123;id&#125;</span>的任务数据--`</span>, deleteRes)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (deleteRes &amp;&amp; deleteRes.affectedRows &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res.json(getSuccessRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;删除数据成功&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;删除数据失败&#x27;</span> &#125;))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> next(&#123; <span class=\"attr\">message</span>: error &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"keyword\">new</span> TaskController()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>入口文件配置</strong><br>在根目录 app.js 程序入口文件中，导入 Express 模块，再引入常用的中间件和自定义 routes 路由的中间件，代码如下：</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createError = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http-errors&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> cookieParser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cookie-parser&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;morgan&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; getErrorRes &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./utils/resHandler&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> routes = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./routes/index&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = express()</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(logger(<span class=\"string\">&#x27;dev&#x27;</span>))</span><br><span class=\"line\">app.use(express.json())</span><br><span class=\"line\">app.use(express.urlencoded(&#123; <span class=\"attr\">extended</span>: <span class=\"literal\">false</span> &#125;))</span><br><span class=\"line\">app.use(cookieParser())</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"string\">&#x27;/&#x27;</span>, routes)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// catch 404 and forward to error handler</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  next(createError(<span class=\"number\">404</span>))</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// error handler</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// set locals, only providing error in development</span></span><br><span class=\"line\">  res.locals.message = err.message</span><br><span class=\"line\">  res.locals.error = req.app.get(<span class=\"string\">&#x27;env&#x27;</span>) === <span class=\"string\">&#x27;development&#x27;</span> ? err : &#123;&#125;</span><br><span class=\"line\">  res.status(err.status || <span class=\"number\">500</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (err.status == <span class=\"number\">401</span>) &#123;</span><br><span class=\"line\">    res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;用户未登录&#x27;</span> &#125;))</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    res.json(getErrorRes(&#123; <span class=\"attr\">message</span>: err.message || <span class=\"string\">&#x27;服务器出错&#x27;</span> &#125;))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = app</span><br></pre></td></tr></table></figure>\n\n<p>到此基于 Vue + antdv + Express + Node.js + MySQL 实现的前后端功能已基本完成，此章节暂告一段落。</p>\n<h2 id=\"什么是-BFF\"><a href=\"#什么是-BFF\" class=\"headerlink\" title=\"什么是 BFF\"></a>什么是 BFF</h2><p>BFF，即 Backends For Frontends（服务于前端的后端）。在 2015 年，Sam Newman 对此提出了，Pattern: Backends For Frontends ，国内也俗称为粘合层。</p>\n<p>在 BFF 理念中，最重要的一点是： 服务自治，谁使用谁开发，即它应该由前端同学去维护。</p>\n<ul>\n<li>服务自治减少了沟通成本，带来了灵活和高效。</li>\n<li>BFF 并不限制具体技术，团队根据自己的技术栈来选型： Java/Node/PHP/Python/Ruby…<br>PS：Serverless For Frontend</li>\n</ul>\n<h3 id=\"为什么选择-Node-作为中间层\"><a href=\"#为什么选择-Node-作为中间层\" class=\"headerlink\" title=\"为什么选择 Node 作为中间层\"></a>为什么选择 Node 作为中间层</h3><p><img src=\"/images/common/bff.png\" alt=\"network\"></p>\n<h4 id=\"业务驱动\"><a href=\"#业务驱动\" class=\"headerlink\" title=\"业务驱动\"></a>业务驱动</h4><p>Node 有个突出的优势，他的开发者可以是前端，都会倾向于选择生态更优，语法更熟悉的 Node.js。</p>\n<p>前端对于页面所需要的数据有更好的理解，每个页面要用到哪些接口，每个接口要用到哪些字段前端是最清楚的。再加上实际业务开发中，前端页面需求经常会发生变化，需要修改字段或者数据结构，所以对接页面的这部分接口由前端直接开发非常合适，可以显著的减少沟通成本。</p>\n<h4 id=\"架构需要\"><a href=\"#架构需要\" class=\"headerlink\" title=\"架构需要\"></a>架构需要</h4><p>面向用户的接口由 Node 中间层负责以后，真正的服务端可以专注于提供基于领域模型的对内接口，做微服务。</p>\n<p>比如可以基于 Goods 模型，提供所有商品相关的接口；基于 Users 模型，提供所有用户相关接口。当一个接口需要商品+用户信息时，由 Node 分别查询组装。从整体业务代码维护角度来说，变得更容易，不会因为业务发展使得每个接口都异常繁杂。</p>\n<h4 id=\"性能满足\"><a href=\"#性能满足\" class=\"headerlink\" title=\"性能满足\"></a>性能满足</h4><p>如果仅仅是架构层面的需求，需要有一个中间层来沉淀业务，那用 Java，PHP 也可以做到，为什么说 Node 更适合做呢？</p>\n<p>因为 Node 天生异步！</p>\n<p>众所周知，js 是一门单线程语言，所以 Node 在实现的时候，需要借助 libuv 来实现异步。libuv 为 Node 提供了线程池，事件池，异步 I/O 等能力。正是因为其中网络 I/O 的异步能力，可以让 Node 做接口聚合时，能够更高效的异步并发处理。</p>\n<h4 id=\"成本较低\"><a href=\"#成本较低\" class=\"headerlink\" title=\"成本较低\"></a>成本较低</h4><p>Node 使用 js 开发，只需要学习简单的 api，前端开发者就可以无障碍使用，学习成本很低。</p>\n<p>而且，Node 具有活跃的社区和丰富的模块池，拥有很多现成的功能实现。框架方面，也有成熟的 koa，express 等基本框架和 egg 等二次封装框架，可根据需求选择上手也比较方便。</p>\n<p><strong>中间层能为我们做些什么？</strong><br><img src=\"/images/common/bff-1.jpeg\" alt=\"network\"></p>\n<ul>\n<li>代理：在开发环境下，我们可以利用代理来，解决最常见的跨域问题；在线上环境下，我们可以利用代理，转发请求到多个服务端。</li>\n<li>缓存：缓存其实是更靠近前端的需求，用户的动作触发数据的更新，node 中间层可以直接处理一部分缓存需求。</li>\n<li>限流：node 中间层，可以针对接口或者路由做响应的限流。</li>\n<li>日志：相比其他服务端语言，node 中间层的日志记录，能更方便快捷的定位问题（是在浏览器端还是服务端）。</li>\n<li>监控：擅长高并发的请求处理，做监控也是合适的选项。</li>\n<li>鉴权：有一个中间层去鉴权，也是一种单一职责的实现。</li>\n<li>路由：前端更需要掌握页面路由的权限和逻辑。</li>\n<li><strong>服务端渲染：</strong>node 中间层的解决方案更灵活，比如 SSR、模板直出、利用一些 JS 库做预渲染等等。<br>更多的可能性</li>\n</ul>\n<p><strong>中间层业务接口实践思路</strong><br>非标准，只是一种参考<br><img src=\"/images/common/bff-2.jpeg\" alt=\"network\"></p>"},{"title":"this指向","date":"2018-01-23T03:39:32.000Z","_content":"\n[文献参考链接](http://mp.weixin.qq.com/s/2PnWD8bIFgEJxYONoPZs6w)\n\n1. js 函数中 this 指向并不是在函数定义的时候确定的，而是在函数调用的时候确定的，所以函数的调用方式决定 this 的 指向。**this 永远指向最后调用它的那个对象**。\n2. 普通的函数有 3 种调用方式：直接调用，方法调用和 new 调用。除此之外还有通过 bind() 将函数绑定到对象之后再调用，通过 call()、apply() 进行调用等。es6 引入箭头函数之后，其 this 指向又有所不同。\n3. this 既不是指向函数自身也不指向函数作用域，this 实际上是在函数被调用是发生绑定的，它的指向完全取决于函数在哪里调用。\n\n<!--more-->\n\n## 用代码解释：this 永远指向最后调用它的那个对象\n\n```javascript\nvar a = {\n  name: 'A',\n  fn: function () {\n    console.log(this.name)\n  }\n}\n\na.fn() //this===a;\na.fn.call({ name: 'B' }) //this==={name:'B'}\nvar fn1 = a.fn\nfn1() //this===window\n```\n\nthis 执行会有不同，主要是几种在这几个场景中：\n\n- 作为构造函数执行，构造函数中\n- 作为对象属性上执行，上述代码中的 a.fn()\n- 作为普通函数执行，上述代码中的 fn1()\n- 用于 bind,call,apply 上述代码中 a.fn.call({name:'B'})\n\n## 默认绑定\n\n在 JavaScript 中，最常用的函数调用类型就是独立函数调用。如果在调用函数的时候，函数不带任何修饰，也就是光秃秃的调用，那就会应用默认绑定规则，默认绑定的指向的是全局作用域。\n\n```javascript\n<script type=\"text/javascript\" charset=\"utf-8\">\n  var name = \"g\";\n  function a() {\n      console.log(this.name);        //g\n      a.name = 'inside';\n      function b() {\n          console.log(this.name);  //g\n\n\n      }\n      b();\n  }\n  a();\n</script>\n```\n\n`a()` 函数在全局作用域中被调用，因此第 1 句中的 `this` 就绑定在了全局对象上。`b()` 函数在 `a()` 函数里面调用，即使这样第二句中的 `this` 指代的仍然是全局对象，即使 `a()` 函数设置了 `name` 属性。这就是默认绑定规则，它是 `js` 中最常见的一种函数调用模式，`this` 的绑定规则也是最简单的一种，就是绑定在全局作用域上\n\n** 但是如果使用了严格模式，则 `this` 不能绑定到全局对象，在严格模式下，把 `this` 绑定到全局对象上时，实际上绑定的是 `underfined`，因此上面的代码会报错 **\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(this.name) //g\n  var c = this\n  c.name = 'inside'\n  function b() {\n    console.log(this.name) //inside\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(this.name) //g\n  name = 'inside'\n  function b() {\n    console.log(this.name) //inside\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(this.name) //g\n  var name = 'inside'\n  function b() {\n    console.log(this.name) //g\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(this.name) //g\n  var name = 'inside'\n  function b() {\n    console.log(name) //inside\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(name) //underfined\n  var name = 'inside'\n  function b() {\n    console.log(name) //inside\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(name) //underfined\n  var name = 'inside'\n  function b() {\n    console.log(this.name) //g\n  }\n  b()\n}\na()\n```\n\n所以通过上面的实验可以充分的得出一个结论，this 确实不是指向的当前作用域的，this 和词法作用域是完全不同的。\n\n---\n\n## 隐式绑定\n\n当函数在调用时，如果函数有所谓的 “ 落脚点 ”, 即有上下文对象时，隐式绑定规则会把函数中的 this 绑定到这个上下文对象。如果觉得上面这段话不够直白的话，还是来看代码。\n\n```javascript\nfunction say() {\n  console.log(this.name)\n}\nvar obj1 = {\n  name: 'zxt',\n  say: say\n}\nvar obj2 = {\n  name: 'zxt1',\n  say: say\n}\nobj1.say() // zxt\nobj2.say() // zxt1\n```\n\nobj1 ， obj2 就是所谓 say 函数的落脚点，专业一点的说法就是上下文对象，给函数指定了这个上下文对象的时，函数内部的 this 自然指向了这个上下文对象。这是很常见的函数调用模式\n\n** 对象属性引用链中只有最顶层或者说是最后一层会影响调用位置 **\n\n```javascript\nfunction foo() {\n  console.log(this.a)\n}\nvar obj2 = {\n  a: 42,\n  foo: foo\n}\nvar obj1 = {\n  a: 2,\n  obj2: obj2\n}\nobj1.obj2.foo()\n```\n\n### 隐式绑定上下文的时丢失上下文\n\n```javascript\nfunction say() {\n  console.log(this.name)\n}\nvar name = 'global'\nvar obj = {\n  name: 'inside',\n  say: say\n}\nvar alias = obj.say // 设置一个简写   (1)\nalias() // 函数调用 输出\"global\"  (2)\n```\n\n由于在 js 中，函数是对象，对象之间是引用传递，而不是值传递，因此第一句代码只是 alias = obj.say= say, 也就是 alias = say，obj.say 只是起了一个桥梁的作用，alias 最终引用的是 say 函数的地址，而与 obj 这个对象无关了，这就是所谓的 “ 丢失上下文 ”。最终执行 alias 函数只不过简单的执行了 say 函数\n\n```javascript\nfunction foo() {\n  console.log(this.a)\n}\nfunction doFoo(fn) {\n  // fn其实引用的是foo\n  fn() // <-- 调用位置！\n}\nvar obj = {\n  a: 2,\n  foo: foo\n}\nvar a = 'oops, global' // a是全局对象的属性\ndoFoo(obj.foo)\n```\n\n参数传递其实就是一种隐式赋值，因此我们传入函数时也会被隐式赋值。回调函数丢失 this 是很常见的情况，除此之外回调函数的函数可能会修改 this，实际上你无法控制回调函数的执行方式，因此就没办法控制会影响绑定的调用位置\n\n---\n\n## 显示绑定\n\n显示绑定，显示的将 this 绑定到一个上下文，js 中，提供了三种显示绑定的方法，apply,call ， bind。apply 和 call 的用法基本相似，他们之间的区别是：\n\n- apply(obj,[arg1.arg2,...]); 被调用函数的参数以数组的形式给出\n\n- call(obj,arg1,arg2,arg3,...); 被调用函数的参数依次给出\n\n- bind 函数执行后，返回的是一个新函数。\n\n** 硬性绑定的应用场景：**\n\n```javascript\nfunction foo(something) {\nconsole.log( this.a, something );\nreturn this.a + something;\n} v\nar obj = {\na:2\n};\nvar bar = function() {\nreturn foo.apply( obj, arguments );\n};\nvar b = bar( 3 ); // 2 3\nconsole.log( b ); // 5\n```\n\n另一种使用方法是创建一个\n\n```javascript\nfunction speak() {\n  console.log(this.name)\n}\nvar name = 'global'\nvar obj1 = {\n  name: 'obj1'\n}\nvar obj2 = {\n  name: 'obj2'\n}\nspeak() // global 等价于speak.call(window)\nspeak.call(window)\nspeak.call(obj1) // obj1\nspeak.call(obj2) // obj2\n```\n\n带参数：\n\n```javascript\n// 带参数\nfunction count(num1, num2) {\n  console.log(this.a * num1 + num2)\n}\nvar obj1 = {\n  a: 2\n}\nvar obj2 = {\n  a: 3\n}\ncount.call(obj1, 1, 2) // 4\ncount.apply(obj1, [1, 2]) // 4\ncount.call(obj2, 1, 2) // 5\ncount.apply(obj2, [1, 2]) // 5\n```\n\n因此可以看出，apply ， call 的作用就是给函数绑定一个执行上下文，且是显示绑定的。因此函数内的 this 自然而然就绑定在了 call 或者 apply 所调用的对象上。而 bind 函数，则返回一个绑定了制定的执行上下文的新函数：\n\n```javascript\n// 带参数\nfunction count(num1, num2) {\n  console.log(this.a * num1 + num2)\n}\nvar obj1 = {\n  a: 2\n}\nvar bound1 = count.bind(obj1) // 未指定参数\nbound1(1, 2) // 4\nvar bound2 = count.bind(obj1, 1) // 指定了一个参数\nbound2(2) // 4\nvar bound3 = count.bind(obj1, 1, 2) // 指定了两个参数\nbound3() //4\nvar bound4 = count.bind(obj1, 1, 2, 3) // 指定了多余的参数,多余的参数会被忽略\nbound4() // 4\n```\n\n所以 bind 方法只是返回了一个新的函数，这个函数内的 this 指定了执行上下文，而返回这个新函数可以接受参数。\n\n---\n\nnew 绑定最后要将的一种 this 绑定规则，是指通过 new 操作符调用构造函数时发生的 this 绑定。构造函数也仅仅是普通函数而已，只不过构造函数以答谢字母开头，也只不过它可以通过 new 操作符调用而已。\n\n```javascript\nfunction Person(name, age) {\n  this.name = name\n  this.age = age\n  console.log('我也只不过是个普通函数')\n  console.log(this) //window、window、Person\n}\nPerson('zxt', 22) // \"我也只不过是个普通函数\"\nconsole.log(this.name) // \"zxt\"\nconsole.log(age) // 22\nPerson('yh', 122)\nconsole.log(this.name) //yu\nvar zxt = new Person('zxt', 22) // \"我也只不过是个普通函数\"\nconsole.log(zxt.name) // \"zxt\"\nconsole.log(zxt.age) // 22\nconsole.log(this.name) //yu\n```\n\n定义的 Person 函数，既可以普通调用，也可以构造函数的形式上的调用，当普通函数调用时，则按正常的函数执行，输出一个字符串。如果通过一个 new 操作符，则构造了一个新的对象。\n\n两种调用方式的不同之处：\n\n- ** 普通函数调用时，应用启用默认绑定规则 **，this 绑定在全局上，此时全局对象上回分别增加 name 和 age 两个属性。\n- 当通过 new 操作符时，会产生一个新对象，并且会把构造函数内的 this 绑定到这个对象上，事实上，在 js 中，使用 new 来调用函数，会自动执行下面的操作\n  1. 创建一个全新的对象。\n  2. 这个新对象或被执行原型链连接\n  3. 这个新对象会绑定到函数调用的 this\n  4. 如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象\n\n---\n\n## 四种绑定的优先级\n\n这四种绑定规则基本上涵盖了所有函数调用情况。但是同时应用了这四种规则中的两种甚至更多，又该是怎么样的一个情况，或者说这四种绑定的优先级顺序又是怎么样的。** 默认优先级最低 < 隐式绑定第二 < 显示绑定第三 < new 绑定最高 **\n\n---\n\n## 箭头函数中的 this\n\n箭头函数的 this 是根据外层的 ( 函数或则全局 ) 作用于来决定的，函数体内的 this 对象指的是定义时所在的对象，而不是之前介绍的调用时绑定的对象。箭头函数的 this 始终指向函数定义时的 this，而非执行时。箭头函数中没有 this 绑定，必须通过查找作用域链来决定其值，如果箭头函数被非箭头函数包含，则 this 绑定的是最近一层非箭头函数的 this，否则，this 为 undefined。\n\n```javascript\nvar a = 1\nvar foo = () => {\n  console.log(this.a) // 定义在全局对象中，因此this绑定在全局作用域\n}\nvar obj = {\n  a: 2\n}\nfoo() // 1 ,在全局对象中调用\nfoo.call(obj) // 1,显示绑定，由obj对象来调用，但根本不影响结果\n```\n\n箭头函数的 this 强制性的绑定在了箭头函数定义时所在的作用域，而且无法通过显示绑定，如 apply，call 方法来修改\n\n```javascript\nfunction Person(name, age) {\n  this.name = name\n  this.age = age\n  this.speak = function () {\n    console.log(this.name)\n    // 普通函数（非箭头函数),this绑定在调用时的作用域\n  }\n  this.bornYear = () => {\n    // 本文写于2016年，因此new Date().getFullYear()得到的是2016\n    // 箭头函数，this绑定在实例内部\n    console.log(new Date().getFullYear() - this.age)\n  }\n}\nvar zxt = new Person('zxt', 22)\nzxt.speak() // \"zxt\"\nzxt.bornYear() // 1994\n// 到这里应该大家应该都没什么问题\nvar xiaoMing = {\n  name: 'xiaoming',\n  age: 18 // 小明永远18岁\n}\nzxt.speak.call(xiaoMing)\n// \"xiaoming\" this绑定的是xiaoMing这个对象\nzxt.bornYear.call(xiaoMing)\n```\n\n以上就是 javascript 中所有 this 绑定的情况，在 es6 之前，前面所说的四种绑定规则可以涵盖任何的函数调用情况，es6 标准实施以后，对于函数的扩展新增了箭头函数，与之不同的是，箭头函数的作用于位于箭头函数定义时所在的作用域。\n\n---\n\n```javascript\nvar obj = {\n  id: 'awesome',\n  cool: function coolFn() {\n    var _this = this\n    console.log(_this.id)\n  }\n}\nvar id = 'not awesome'\nobj.cool() // 酷,object\nsetTimeout(obj.cool, 100) //window\n```\n\ncool() 函数丢失了同 this 之间的绑定， var self = this 这种方案可以圆满解决了理解和正确使用 this 绑定的问题。\n\n```javascript\nfunction Obj(name) {\n  var _this = this //_this = object{}\n  _this.id = name\n  _this.cool = function () {\n    console.log(_this.id)\n  }\n}\nvar id = 'not awesome'\nvar test = new Obj('yaya') //yaya\ntest.cool() //yaya\nvar xiaohong = {\n  id: xiaohong,\n  age: 18\n}\ntest.cool.call(xiaohong) //根本不执行\n```\n\n---\n\n```javascript\nfunction identify() {\n  return this.name.toUpperCase()\n}\nfunction speak() {\n  var greeting = \"Hello, I'm \" + identify.call(this)\n  console.log(greeting)\n}\nvar me = {\n  name: 'Kyle'\n}\nvar you = {\n  name: 'Reader'\n}\nidentify.call(me) // KYLE\nidentify.call(you) // READER\nspeak.call(me) // Hello, 我是KYLE\nspeak.call(you) // Hello, 我是READER\n```\n\n---\n\n```javascript\nfunction foo(num) {\n  console.log('foo: ' + num)\n  // 记录foo被调用的次数\n\n  this.count++\n}\nfoo.count = 0\nvar i\nfor (i = 0; i < 10; i++) {\n  if (i > 5) {\n    foo(i)\n  }\n}\n// foo: 6\n// foo: 7\n// foo: 8\n// foo: 9\n// foo被调用了多少次？\nconsole.log(foo.count) // 0 -- WTF?\n```\n\n执行 foo.count = 0 时，的确向函数对象 foo 添加了一个属性 count。但是函数内部代码 this.count 中的 this 并不指向那个函数，所以虽然属性名相同，跟对象却并不相同。这段代码在五一中创建了一个全局变量 count。\n\n** 匿名函数无法指向自身 **，arguments.callee 是唯一一种从匿名函数对象中引用自身的方法，已被弃用。，然而更好的是避免使用匿名函数，至少在需要自引用时使用时使用具名函数\n\n**this 在任何情况下都不指向函数的词法作用域 **，作用域 “ 对象 ” 无法通过 js 代码来访问，它存在于 js 引擎内部 \\*\\*\n\n```javascript\nfunction foo() {\n  var a = 2\n  this.bar()\n}\nfunction bar() {\n  console.log(this.a)\n}\nfoo()\n```\n\n试图用 this 联通 foo() 和 bar() 的词法作用域，从而让 bar 可以 i 访问 foo() 变量的 a，这是不可能实现的，** 不能使用 this 来引用一个词法作用域内部的东西 **，每当想要把 this 和此法作用域混用的时候，一定要提醒自己，这是无法实现的\n\n---\n\n## 综合题\n\n### 1\n\n```javascript\nvar names = '宋伟老师'\nvar obj = {\n  names: '张健老师',\n  showName: function () {\n    console.log(this.name)\n  },\n  returnName: function () {\n    return this.name\n  },\n  returnFunctionName: function () {\n    return function () {\n      console.log(this.name)\n    }\n  }\n}\nobj.showName() //输出什么？   \"张健老师\"\nobj.returnName() //输出什么？   \"张健老师\"\nobj.returnFunctionName()() //输出什么？   \"宋伟老师\"\nobj.showName.call(names) //输出什么？   undefined\nobj.returnName.call(names) //输出什么？   undefined\nobj.returnFunctionName().call(names) //输出什么？   undefined\nvar newObj = obj.returnFunctionName().bind(window)\nnewObj.call(obj) //输出什么？   \"宋伟老师\"\n//为什么最后一个输出\"宋伟老师\"？因为bind指向this对象后  再一次调用的话  this指向不会被改变\n```\n\n### 2\n\n```javascript\nvar big = '万达老师'\n\nvar obj = {\n  big: '宋伟老师',\n  showBig: function () {\n    return this.big\n  }\n}\nobj.showBig.call(big) //ƒ big() { [native code] }  //精通String的操作方法的同学就把为什么回复出来吧\n```\n\n### 3\n\n```javascript\nfunction a(a,b,c){\n    console.log(this.length);                 //4\n    console.log(this.callee.length);          //1\n}\n\nfunction fn(d){\n    arguments[0](10,20,30,40,50);\n}\n\nfn(a,10,20,30);\n\n\n//第一个输出结果:因为this当前指向的是arguments 。 arguments是一个伪数组具备length属性。arguments又是保存函数的实参。\nfn调用的时候传入4个实参。所以arguments长度为4。这个时候arguments[0] 等同于 arguments.a调用这个函数。所以this指向的是arguments这个伪数组也是(对象)(听到这还有疑惑小伙伴留言问我)\n\n//第二个输出结果：callee是arguments的一个属性,主要返回当前arguments直属的函数体。所以this.callees是返回fn 。每一个函数有一个length属性主要用来返回函数的形参的所以就是1。\n```\n","source":"_posts/this指向.md","raw":"---\ntitle: this指向\ndate: 2018-01-23 11:39:32\ncategories: JavaScript\n---\n\n[文献参考链接](http://mp.weixin.qq.com/s/2PnWD8bIFgEJxYONoPZs6w)\n\n1. js 函数中 this 指向并不是在函数定义的时候确定的，而是在函数调用的时候确定的，所以函数的调用方式决定 this 的 指向。**this 永远指向最后调用它的那个对象**。\n2. 普通的函数有 3 种调用方式：直接调用，方法调用和 new 调用。除此之外还有通过 bind() 将函数绑定到对象之后再调用，通过 call()、apply() 进行调用等。es6 引入箭头函数之后，其 this 指向又有所不同。\n3. this 既不是指向函数自身也不指向函数作用域，this 实际上是在函数被调用是发生绑定的，它的指向完全取决于函数在哪里调用。\n\n<!--more-->\n\n## 用代码解释：this 永远指向最后调用它的那个对象\n\n```javascript\nvar a = {\n  name: 'A',\n  fn: function () {\n    console.log(this.name)\n  }\n}\n\na.fn() //this===a;\na.fn.call({ name: 'B' }) //this==={name:'B'}\nvar fn1 = a.fn\nfn1() //this===window\n```\n\nthis 执行会有不同，主要是几种在这几个场景中：\n\n- 作为构造函数执行，构造函数中\n- 作为对象属性上执行，上述代码中的 a.fn()\n- 作为普通函数执行，上述代码中的 fn1()\n- 用于 bind,call,apply 上述代码中 a.fn.call({name:'B'})\n\n## 默认绑定\n\n在 JavaScript 中，最常用的函数调用类型就是独立函数调用。如果在调用函数的时候，函数不带任何修饰，也就是光秃秃的调用，那就会应用默认绑定规则，默认绑定的指向的是全局作用域。\n\n```javascript\n<script type=\"text/javascript\" charset=\"utf-8\">\n  var name = \"g\";\n  function a() {\n      console.log(this.name);        //g\n      a.name = 'inside';\n      function b() {\n          console.log(this.name);  //g\n\n\n      }\n      b();\n  }\n  a();\n</script>\n```\n\n`a()` 函数在全局作用域中被调用，因此第 1 句中的 `this` 就绑定在了全局对象上。`b()` 函数在 `a()` 函数里面调用，即使这样第二句中的 `this` 指代的仍然是全局对象，即使 `a()` 函数设置了 `name` 属性。这就是默认绑定规则，它是 `js` 中最常见的一种函数调用模式，`this` 的绑定规则也是最简单的一种，就是绑定在全局作用域上\n\n** 但是如果使用了严格模式，则 `this` 不能绑定到全局对象，在严格模式下，把 `this` 绑定到全局对象上时，实际上绑定的是 `underfined`，因此上面的代码会报错 **\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(this.name) //g\n  var c = this\n  c.name = 'inside'\n  function b() {\n    console.log(this.name) //inside\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(this.name) //g\n  name = 'inside'\n  function b() {\n    console.log(this.name) //inside\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(this.name) //g\n  var name = 'inside'\n  function b() {\n    console.log(this.name) //g\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(this.name) //g\n  var name = 'inside'\n  function b() {\n    console.log(name) //inside\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(name) //underfined\n  var name = 'inside'\n  function b() {\n    console.log(name) //inside\n  }\n  b()\n}\na()\n```\n\n---\n\n```javascript\nvar name = 'g'\nfunction a() {\n  console.log(name) //underfined\n  var name = 'inside'\n  function b() {\n    console.log(this.name) //g\n  }\n  b()\n}\na()\n```\n\n所以通过上面的实验可以充分的得出一个结论，this 确实不是指向的当前作用域的，this 和词法作用域是完全不同的。\n\n---\n\n## 隐式绑定\n\n当函数在调用时，如果函数有所谓的 “ 落脚点 ”, 即有上下文对象时，隐式绑定规则会把函数中的 this 绑定到这个上下文对象。如果觉得上面这段话不够直白的话，还是来看代码。\n\n```javascript\nfunction say() {\n  console.log(this.name)\n}\nvar obj1 = {\n  name: 'zxt',\n  say: say\n}\nvar obj2 = {\n  name: 'zxt1',\n  say: say\n}\nobj1.say() // zxt\nobj2.say() // zxt1\n```\n\nobj1 ， obj2 就是所谓 say 函数的落脚点，专业一点的说法就是上下文对象，给函数指定了这个上下文对象的时，函数内部的 this 自然指向了这个上下文对象。这是很常见的函数调用模式\n\n** 对象属性引用链中只有最顶层或者说是最后一层会影响调用位置 **\n\n```javascript\nfunction foo() {\n  console.log(this.a)\n}\nvar obj2 = {\n  a: 42,\n  foo: foo\n}\nvar obj1 = {\n  a: 2,\n  obj2: obj2\n}\nobj1.obj2.foo()\n```\n\n### 隐式绑定上下文的时丢失上下文\n\n```javascript\nfunction say() {\n  console.log(this.name)\n}\nvar name = 'global'\nvar obj = {\n  name: 'inside',\n  say: say\n}\nvar alias = obj.say // 设置一个简写   (1)\nalias() // 函数调用 输出\"global\"  (2)\n```\n\n由于在 js 中，函数是对象，对象之间是引用传递，而不是值传递，因此第一句代码只是 alias = obj.say= say, 也就是 alias = say，obj.say 只是起了一个桥梁的作用，alias 最终引用的是 say 函数的地址，而与 obj 这个对象无关了，这就是所谓的 “ 丢失上下文 ”。最终执行 alias 函数只不过简单的执行了 say 函数\n\n```javascript\nfunction foo() {\n  console.log(this.a)\n}\nfunction doFoo(fn) {\n  // fn其实引用的是foo\n  fn() // <-- 调用位置！\n}\nvar obj = {\n  a: 2,\n  foo: foo\n}\nvar a = 'oops, global' // a是全局对象的属性\ndoFoo(obj.foo)\n```\n\n参数传递其实就是一种隐式赋值，因此我们传入函数时也会被隐式赋值。回调函数丢失 this 是很常见的情况，除此之外回调函数的函数可能会修改 this，实际上你无法控制回调函数的执行方式，因此就没办法控制会影响绑定的调用位置\n\n---\n\n## 显示绑定\n\n显示绑定，显示的将 this 绑定到一个上下文，js 中，提供了三种显示绑定的方法，apply,call ， bind。apply 和 call 的用法基本相似，他们之间的区别是：\n\n- apply(obj,[arg1.arg2,...]); 被调用函数的参数以数组的形式给出\n\n- call(obj,arg1,arg2,arg3,...); 被调用函数的参数依次给出\n\n- bind 函数执行后，返回的是一个新函数。\n\n** 硬性绑定的应用场景：**\n\n```javascript\nfunction foo(something) {\nconsole.log( this.a, something );\nreturn this.a + something;\n} v\nar obj = {\na:2\n};\nvar bar = function() {\nreturn foo.apply( obj, arguments );\n};\nvar b = bar( 3 ); // 2 3\nconsole.log( b ); // 5\n```\n\n另一种使用方法是创建一个\n\n```javascript\nfunction speak() {\n  console.log(this.name)\n}\nvar name = 'global'\nvar obj1 = {\n  name: 'obj1'\n}\nvar obj2 = {\n  name: 'obj2'\n}\nspeak() // global 等价于speak.call(window)\nspeak.call(window)\nspeak.call(obj1) // obj1\nspeak.call(obj2) // obj2\n```\n\n带参数：\n\n```javascript\n// 带参数\nfunction count(num1, num2) {\n  console.log(this.a * num1 + num2)\n}\nvar obj1 = {\n  a: 2\n}\nvar obj2 = {\n  a: 3\n}\ncount.call(obj1, 1, 2) // 4\ncount.apply(obj1, [1, 2]) // 4\ncount.call(obj2, 1, 2) // 5\ncount.apply(obj2, [1, 2]) // 5\n```\n\n因此可以看出，apply ， call 的作用就是给函数绑定一个执行上下文，且是显示绑定的。因此函数内的 this 自然而然就绑定在了 call 或者 apply 所调用的对象上。而 bind 函数，则返回一个绑定了制定的执行上下文的新函数：\n\n```javascript\n// 带参数\nfunction count(num1, num2) {\n  console.log(this.a * num1 + num2)\n}\nvar obj1 = {\n  a: 2\n}\nvar bound1 = count.bind(obj1) // 未指定参数\nbound1(1, 2) // 4\nvar bound2 = count.bind(obj1, 1) // 指定了一个参数\nbound2(2) // 4\nvar bound3 = count.bind(obj1, 1, 2) // 指定了两个参数\nbound3() //4\nvar bound4 = count.bind(obj1, 1, 2, 3) // 指定了多余的参数,多余的参数会被忽略\nbound4() // 4\n```\n\n所以 bind 方法只是返回了一个新的函数，这个函数内的 this 指定了执行上下文，而返回这个新函数可以接受参数。\n\n---\n\nnew 绑定最后要将的一种 this 绑定规则，是指通过 new 操作符调用构造函数时发生的 this 绑定。构造函数也仅仅是普通函数而已，只不过构造函数以答谢字母开头，也只不过它可以通过 new 操作符调用而已。\n\n```javascript\nfunction Person(name, age) {\n  this.name = name\n  this.age = age\n  console.log('我也只不过是个普通函数')\n  console.log(this) //window、window、Person\n}\nPerson('zxt', 22) // \"我也只不过是个普通函数\"\nconsole.log(this.name) // \"zxt\"\nconsole.log(age) // 22\nPerson('yh', 122)\nconsole.log(this.name) //yu\nvar zxt = new Person('zxt', 22) // \"我也只不过是个普通函数\"\nconsole.log(zxt.name) // \"zxt\"\nconsole.log(zxt.age) // 22\nconsole.log(this.name) //yu\n```\n\n定义的 Person 函数，既可以普通调用，也可以构造函数的形式上的调用，当普通函数调用时，则按正常的函数执行，输出一个字符串。如果通过一个 new 操作符，则构造了一个新的对象。\n\n两种调用方式的不同之处：\n\n- ** 普通函数调用时，应用启用默认绑定规则 **，this 绑定在全局上，此时全局对象上回分别增加 name 和 age 两个属性。\n- 当通过 new 操作符时，会产生一个新对象，并且会把构造函数内的 this 绑定到这个对象上，事实上，在 js 中，使用 new 来调用函数，会自动执行下面的操作\n  1. 创建一个全新的对象。\n  2. 这个新对象或被执行原型链连接\n  3. 这个新对象会绑定到函数调用的 this\n  4. 如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象\n\n---\n\n## 四种绑定的优先级\n\n这四种绑定规则基本上涵盖了所有函数调用情况。但是同时应用了这四种规则中的两种甚至更多，又该是怎么样的一个情况，或者说这四种绑定的优先级顺序又是怎么样的。** 默认优先级最低 < 隐式绑定第二 < 显示绑定第三 < new 绑定最高 **\n\n---\n\n## 箭头函数中的 this\n\n箭头函数的 this 是根据外层的 ( 函数或则全局 ) 作用于来决定的，函数体内的 this 对象指的是定义时所在的对象，而不是之前介绍的调用时绑定的对象。箭头函数的 this 始终指向函数定义时的 this，而非执行时。箭头函数中没有 this 绑定，必须通过查找作用域链来决定其值，如果箭头函数被非箭头函数包含，则 this 绑定的是最近一层非箭头函数的 this，否则，this 为 undefined。\n\n```javascript\nvar a = 1\nvar foo = () => {\n  console.log(this.a) // 定义在全局对象中，因此this绑定在全局作用域\n}\nvar obj = {\n  a: 2\n}\nfoo() // 1 ,在全局对象中调用\nfoo.call(obj) // 1,显示绑定，由obj对象来调用，但根本不影响结果\n```\n\n箭头函数的 this 强制性的绑定在了箭头函数定义时所在的作用域，而且无法通过显示绑定，如 apply，call 方法来修改\n\n```javascript\nfunction Person(name, age) {\n  this.name = name\n  this.age = age\n  this.speak = function () {\n    console.log(this.name)\n    // 普通函数（非箭头函数),this绑定在调用时的作用域\n  }\n  this.bornYear = () => {\n    // 本文写于2016年，因此new Date().getFullYear()得到的是2016\n    // 箭头函数，this绑定在实例内部\n    console.log(new Date().getFullYear() - this.age)\n  }\n}\nvar zxt = new Person('zxt', 22)\nzxt.speak() // \"zxt\"\nzxt.bornYear() // 1994\n// 到这里应该大家应该都没什么问题\nvar xiaoMing = {\n  name: 'xiaoming',\n  age: 18 // 小明永远18岁\n}\nzxt.speak.call(xiaoMing)\n// \"xiaoming\" this绑定的是xiaoMing这个对象\nzxt.bornYear.call(xiaoMing)\n```\n\n以上就是 javascript 中所有 this 绑定的情况，在 es6 之前，前面所说的四种绑定规则可以涵盖任何的函数调用情况，es6 标准实施以后，对于函数的扩展新增了箭头函数，与之不同的是，箭头函数的作用于位于箭头函数定义时所在的作用域。\n\n---\n\n```javascript\nvar obj = {\n  id: 'awesome',\n  cool: function coolFn() {\n    var _this = this\n    console.log(_this.id)\n  }\n}\nvar id = 'not awesome'\nobj.cool() // 酷,object\nsetTimeout(obj.cool, 100) //window\n```\n\ncool() 函数丢失了同 this 之间的绑定， var self = this 这种方案可以圆满解决了理解和正确使用 this 绑定的问题。\n\n```javascript\nfunction Obj(name) {\n  var _this = this //_this = object{}\n  _this.id = name\n  _this.cool = function () {\n    console.log(_this.id)\n  }\n}\nvar id = 'not awesome'\nvar test = new Obj('yaya') //yaya\ntest.cool() //yaya\nvar xiaohong = {\n  id: xiaohong,\n  age: 18\n}\ntest.cool.call(xiaohong) //根本不执行\n```\n\n---\n\n```javascript\nfunction identify() {\n  return this.name.toUpperCase()\n}\nfunction speak() {\n  var greeting = \"Hello, I'm \" + identify.call(this)\n  console.log(greeting)\n}\nvar me = {\n  name: 'Kyle'\n}\nvar you = {\n  name: 'Reader'\n}\nidentify.call(me) // KYLE\nidentify.call(you) // READER\nspeak.call(me) // Hello, 我是KYLE\nspeak.call(you) // Hello, 我是READER\n```\n\n---\n\n```javascript\nfunction foo(num) {\n  console.log('foo: ' + num)\n  // 记录foo被调用的次数\n\n  this.count++\n}\nfoo.count = 0\nvar i\nfor (i = 0; i < 10; i++) {\n  if (i > 5) {\n    foo(i)\n  }\n}\n// foo: 6\n// foo: 7\n// foo: 8\n// foo: 9\n// foo被调用了多少次？\nconsole.log(foo.count) // 0 -- WTF?\n```\n\n执行 foo.count = 0 时，的确向函数对象 foo 添加了一个属性 count。但是函数内部代码 this.count 中的 this 并不指向那个函数，所以虽然属性名相同，跟对象却并不相同。这段代码在五一中创建了一个全局变量 count。\n\n** 匿名函数无法指向自身 **，arguments.callee 是唯一一种从匿名函数对象中引用自身的方法，已被弃用。，然而更好的是避免使用匿名函数，至少在需要自引用时使用时使用具名函数\n\n**this 在任何情况下都不指向函数的词法作用域 **，作用域 “ 对象 ” 无法通过 js 代码来访问，它存在于 js 引擎内部 \\*\\*\n\n```javascript\nfunction foo() {\n  var a = 2\n  this.bar()\n}\nfunction bar() {\n  console.log(this.a)\n}\nfoo()\n```\n\n试图用 this 联通 foo() 和 bar() 的词法作用域，从而让 bar 可以 i 访问 foo() 变量的 a，这是不可能实现的，** 不能使用 this 来引用一个词法作用域内部的东西 **，每当想要把 this 和此法作用域混用的时候，一定要提醒自己，这是无法实现的\n\n---\n\n## 综合题\n\n### 1\n\n```javascript\nvar names = '宋伟老师'\nvar obj = {\n  names: '张健老师',\n  showName: function () {\n    console.log(this.name)\n  },\n  returnName: function () {\n    return this.name\n  },\n  returnFunctionName: function () {\n    return function () {\n      console.log(this.name)\n    }\n  }\n}\nobj.showName() //输出什么？   \"张健老师\"\nobj.returnName() //输出什么？   \"张健老师\"\nobj.returnFunctionName()() //输出什么？   \"宋伟老师\"\nobj.showName.call(names) //输出什么？   undefined\nobj.returnName.call(names) //输出什么？   undefined\nobj.returnFunctionName().call(names) //输出什么？   undefined\nvar newObj = obj.returnFunctionName().bind(window)\nnewObj.call(obj) //输出什么？   \"宋伟老师\"\n//为什么最后一个输出\"宋伟老师\"？因为bind指向this对象后  再一次调用的话  this指向不会被改变\n```\n\n### 2\n\n```javascript\nvar big = '万达老师'\n\nvar obj = {\n  big: '宋伟老师',\n  showBig: function () {\n    return this.big\n  }\n}\nobj.showBig.call(big) //ƒ big() { [native code] }  //精通String的操作方法的同学就把为什么回复出来吧\n```\n\n### 3\n\n```javascript\nfunction a(a,b,c){\n    console.log(this.length);                 //4\n    console.log(this.callee.length);          //1\n}\n\nfunction fn(d){\n    arguments[0](10,20,30,40,50);\n}\n\nfn(a,10,20,30);\n\n\n//第一个输出结果:因为this当前指向的是arguments 。 arguments是一个伪数组具备length属性。arguments又是保存函数的实参。\nfn调用的时候传入4个实参。所以arguments长度为4。这个时候arguments[0] 等同于 arguments.a调用这个函数。所以this指向的是arguments这个伪数组也是(对象)(听到这还有疑惑小伙伴留言问我)\n\n//第二个输出结果：callee是arguments的一个属性,主要返回当前arguments直属的函数体。所以this.callees是返回fn 。每一个函数有一个length属性主要用来返回函数的形参的所以就是1。\n```\n","slug":"this指向","published":1,"updated":"2021-05-06T12:22:09.895Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xr003el5v00ryhaxco","content":"<p><a href=\"http://mp.weixin.qq.com/s/2PnWD8bIFgEJxYONoPZs6w\">文献参考链接</a></p>\n<ol>\n<li>js 函数中 this 指向并不是在函数定义的时候确定的，而是在函数调用的时候确定的，所以函数的调用方式决定 this 的 指向。<strong>this 永远指向最后调用它的那个对象</strong>。</li>\n<li>普通的函数有 3 种调用方式：直接调用，方法调用和 new 调用。除此之外还有通过 bind() 将函数绑定到对象之后再调用，通过 call()、apply() 进行调用等。es6 引入箭头函数之后，其 this 指向又有所不同。</li>\n<li>this 既不是指向函数自身也不指向函数作用域，this 实际上是在函数被调用是发生绑定的，它的指向完全取决于函数在哪里调用。</li>\n</ol>\n<span id=\"more\"></span>\n\n<h2 id=\"用代码解释：this-永远指向最后调用它的那个对象\"><a href=\"#用代码解释：this-永远指向最后调用它的那个对象\" class=\"headerlink\" title=\"用代码解释：this 永远指向最后调用它的那个对象\"></a>用代码解释：this 永远指向最后调用它的那个对象</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;A&#x27;</span>,</span><br><span class=\"line\">  fn: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">a.fn() <span class=\"comment\">//this===a;</span></span><br><span class=\"line\">a.fn.call(&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;B&#x27;</span> &#125;) <span class=\"comment\">//this===&#123;name:&#x27;B&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fn1 = a.fn</span><br><span class=\"line\">fn1() <span class=\"comment\">//this===window</span></span><br></pre></td></tr></table></figure>\n\n<p>this 执行会有不同，主要是几种在这几个场景中：</p>\n<ul>\n<li>作为构造函数执行，构造函数中</li>\n<li>作为对象属性上执行，上述代码中的 a.fn()</li>\n<li>作为普通函数执行，上述代码中的 fn1()</li>\n<li>用于 bind,call,apply 上述代码中 a.fn.call({name:’B’})</li>\n</ul>\n<h2 id=\"默认绑定\"><a href=\"#默认绑定\" class=\"headerlink\" title=\"默认绑定\"></a>默认绑定</h2><p>在 JavaScript 中，最常用的函数调用类型就是独立函数调用。如果在调用函数的时候，函数不带任何修饰，也就是光秃秃的调用，那就会应用默认绑定规则，默认绑定的指向的是全局作用域。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> charset=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&quot;g&quot;</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);        <span class=\"comment\">//g</span></span><br><span class=\"line\">      a.name = <span class=\"string\">&#x27;inside&#x27;</span>;</span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);  <span class=\"comment\">//g</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      b();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  a();</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>a()</code> 函数在全局作用域中被调用，因此第 1 句中的 <code>this</code> 就绑定在了全局对象上。<code>b()</code> 函数在 <code>a()</code> 函数里面调用，即使这样第二句中的 <code>this</code> 指代的仍然是全局对象，即使 <code>a()</code> 函数设置了 <code>name</code> 属性。这就是默认绑定规则，它是 <code>js</code> 中最常见的一种函数调用模式，<code>this</code> 的绑定规则也是最简单的一种，就是绑定在全局作用域上</p>\n<p>** 但是如果使用了严格模式，则 <code>this</code> 不能绑定到全局对象，在严格模式下，把 <code>this</code> 绑定到全局对象上时，实际上绑定的是 <code>underfined</code>，因此上面的代码会报错 **</p>\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> c = <span class=\"built_in\">this</span></span><br><span class=\"line\">  c.name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//inside</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//inside</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//inside</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//underfined</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//inside</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//underfined</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<p>所以通过上面的实验可以充分的得出一个结论，this 确实不是指向的当前作用域的，this 和词法作用域是完全不同的。</p>\n<hr>\n<h2 id=\"隐式绑定\"><a href=\"#隐式绑定\" class=\"headerlink\" title=\"隐式绑定\"></a>隐式绑定</h2><p>当函数在调用时，如果函数有所谓的 “ 落脚点 ”, 即有上下文对象时，隐式绑定规则会把函数中的 this 绑定到这个上下文对象。如果觉得上面这段话不够直白的话，还是来看代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;zxt&#x27;</span>,</span><br><span class=\"line\">  say: say</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;zxt1&#x27;</span>,</span><br><span class=\"line\">  say: say</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj1.say() <span class=\"comment\">// zxt</span></span><br><span class=\"line\">obj2.say() <span class=\"comment\">// zxt1</span></span><br></pre></td></tr></table></figure>\n\n<p>obj1 ， obj2 就是所谓 say 函数的落脚点，专业一点的说法就是上下文对象，给函数指定了这个上下文对象的时，函数内部的 this 自然指向了这个上下文对象。这是很常见的函数调用模式</p>\n<p>** 对象属性引用链中只有最顶层或者说是最后一层会影响调用位置 **</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">42</span>,</span><br><span class=\"line\">  foo: foo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span>,</span><br><span class=\"line\">  obj2: obj2</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj1.obj2.foo()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"隐式绑定上下文的时丢失上下文\"><a href=\"#隐式绑定上下文的时丢失上下文\" class=\"headerlink\" title=\"隐式绑定上下文的时丢失上下文\"></a>隐式绑定上下文的时丢失上下文</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;global&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;inside&#x27;</span>,</span><br><span class=\"line\">  say: say</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> alias = obj.say <span class=\"comment\">// 设置一个简写   (1)</span></span><br><span class=\"line\">alias() <span class=\"comment\">// 函数调用 输出&quot;global&quot;  (2)</span></span><br></pre></td></tr></table></figure>\n\n<p>由于在 js 中，函数是对象，对象之间是引用传递，而不是值传递，因此第一句代码只是 alias = obj.say= say, 也就是 alias = say，obj.say 只是起了一个桥梁的作用，alias 最终引用的是 say 函数的地址，而与 obj 这个对象无关了，这就是所谓的 “ 丢失上下文 ”。最终执行 alias 函数只不过简单的执行了 say 函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doFoo</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// fn其实引用的是foo</span></span><br><span class=\"line\">  fn() <span class=\"comment\">// &lt;-- 调用位置！</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span>,</span><br><span class=\"line\">  foo: foo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&#x27;oops, global&#x27;</span> <span class=\"comment\">// a是全局对象的属性</span></span><br><span class=\"line\">doFoo(obj.foo)</span><br></pre></td></tr></table></figure>\n\n<p>参数传递其实就是一种隐式赋值，因此我们传入函数时也会被隐式赋值。回调函数丢失 this 是很常见的情况，除此之外回调函数的函数可能会修改 this，实际上你无法控制回调函数的执行方式，因此就没办法控制会影响绑定的调用位置</p>\n<hr>\n<h2 id=\"显示绑定\"><a href=\"#显示绑定\" class=\"headerlink\" title=\"显示绑定\"></a>显示绑定</h2><p>显示绑定，显示的将 this 绑定到一个上下文，js 中，提供了三种显示绑定的方法，apply,call ， bind。apply 和 call 的用法基本相似，他们之间的区别是：</p>\n<ul>\n<li><p>apply(obj,[arg1.arg2,…]); 被调用函数的参数以数组的形式给出</p>\n</li>\n<li><p>call(obj,arg1,arg2,arg3,…); 被调用函数的参数依次给出</p>\n</li>\n<li><p>bind 函数执行后，返回的是一个新函数。</p>\n</li>\n</ul>\n<p>** 硬性绑定的应用场景：**</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( <span class=\"built_in\">this</span>.a, something );</span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.a + something;</span><br><span class=\"line\">&#125; v</span><br><span class=\"line\">ar obj = &#123;</span><br><span class=\"line\">a:<span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">return</span> foo.apply( obj, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = bar( <span class=\"number\">3</span> ); <span class=\"comment\">// 2 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( b ); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>另一种使用方法是创建一个</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">speak</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;global&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;obj1&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;obj2&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">speak() <span class=\"comment\">// global 等价于speak.call(window)</span></span><br><span class=\"line\">speak.call(<span class=\"built_in\">window</span>)</span><br><span class=\"line\">speak.call(obj1) <span class=\"comment\">// obj1</span></span><br><span class=\"line\">speak.call(obj2) <span class=\"comment\">// obj2</span></span><br></pre></td></tr></table></figure>\n\n<p>带参数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 带参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">num1, num2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a * num1 + num2)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">3</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">count.call(obj1, <span class=\"number\">1</span>, <span class=\"number\">2</span>) <span class=\"comment\">// 4</span></span><br><span class=\"line\">count.apply(obj1, [<span class=\"number\">1</span>, <span class=\"number\">2</span>]) <span class=\"comment\">// 4</span></span><br><span class=\"line\">count.call(obj2, <span class=\"number\">1</span>, <span class=\"number\">2</span>) <span class=\"comment\">// 5</span></span><br><span class=\"line\">count.apply(obj2, [<span class=\"number\">1</span>, <span class=\"number\">2</span>]) <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>因此可以看出，apply ， call 的作用就是给函数绑定一个执行上下文，且是显示绑定的。因此函数内的 this 自然而然就绑定在了 call 或者 apply 所调用的对象上。而 bind 函数，则返回一个绑定了制定的执行上下文的新函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 带参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">num1, num2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a * num1 + num2)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bound1 = count.bind(obj1) <span class=\"comment\">// 未指定参数</span></span><br><span class=\"line\">bound1(<span class=\"number\">1</span>, <span class=\"number\">2</span>) <span class=\"comment\">// 4</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bound2 = count.bind(obj1, <span class=\"number\">1</span>) <span class=\"comment\">// 指定了一个参数</span></span><br><span class=\"line\">bound2(<span class=\"number\">2</span>) <span class=\"comment\">// 4</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bound3 = count.bind(obj1, <span class=\"number\">1</span>, <span class=\"number\">2</span>) <span class=\"comment\">// 指定了两个参数</span></span><br><span class=\"line\">bound3() <span class=\"comment\">//4</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bound4 = count.bind(obj1, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">// 指定了多余的参数,多余的参数会被忽略</span></span><br><span class=\"line\">bound4() <span class=\"comment\">// 4</span></span><br></pre></td></tr></table></figure>\n\n<p>所以 bind 方法只是返回了一个新的函数，这个函数内的 this 指定了执行上下文，而返回这个新函数可以接受参数。</p>\n<hr>\n<p>new 绑定最后要将的一种 this 绑定规则，是指通过 new 操作符调用构造函数时发生的 this 绑定。构造函数也仅仅是普通函数而已，只不过构造函数以答谢字母开头，也只不过它可以通过 new 操作符调用而已。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;我也只不过是个普通函数&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>) <span class=\"comment\">//window、window、Person</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person(<span class=\"string\">&#x27;zxt&#x27;</span>, <span class=\"number\">22</span>) <span class=\"comment\">// &quot;我也只不过是个普通函数&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">// &quot;zxt&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(age) <span class=\"comment\">// 22</span></span><br><span class=\"line\">Person(<span class=\"string\">&#x27;yh&#x27;</span>, <span class=\"number\">122</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//yu</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> zxt = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;zxt&#x27;</span>, <span class=\"number\">22</span>) <span class=\"comment\">// &quot;我也只不过是个普通函数&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(zxt.name) <span class=\"comment\">// &quot;zxt&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(zxt.age) <span class=\"comment\">// 22</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//yu</span></span><br></pre></td></tr></table></figure>\n\n<p>定义的 Person 函数，既可以普通调用，也可以构造函数的形式上的调用，当普通函数调用时，则按正常的函数执行，输出一个字符串。如果通过一个 new 操作符，则构造了一个新的对象。</p>\n<p>两种调用方式的不同之处：</p>\n<ul>\n<li>** 普通函数调用时，应用启用默认绑定规则 **，this 绑定在全局上，此时全局对象上回分别增加 name 和 age 两个属性。</li>\n<li>当通过 new 操作符时，会产生一个新对象，并且会把构造函数内的 this 绑定到这个对象上，事实上，在 js 中，使用 new 来调用函数，会自动执行下面的操作<ol>\n<li>创建一个全新的对象。</li>\n<li>这个新对象或被执行原型链连接</li>\n<li>这个新对象会绑定到函数调用的 this</li>\n<li>如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h2 id=\"四种绑定的优先级\"><a href=\"#四种绑定的优先级\" class=\"headerlink\" title=\"四种绑定的优先级\"></a>四种绑定的优先级</h2><p>这四种绑定规则基本上涵盖了所有函数调用情况。但是同时应用了这四种规则中的两种甚至更多，又该是怎么样的一个情况，或者说这四种绑定的优先级顺序又是怎么样的。** 默认优先级最低 &lt; 隐式绑定第二 &lt; 显示绑定第三 &lt; new 绑定最高 **</p>\n<hr>\n<h2 id=\"箭头函数中的-this\"><a href=\"#箭头函数中的-this\" class=\"headerlink\" title=\"箭头函数中的 this\"></a>箭头函数中的 this</h2><p>箭头函数的 this 是根据外层的 ( 函数或则全局 ) 作用于来决定的，函数体内的 this 对象指的是定义时所在的对象，而不是之前介绍的调用时绑定的对象。箭头函数的 this 始终指向函数定义时的 this，而非执行时。箭头函数中没有 this 绑定，必须通过查找作用域链来决定其值，如果箭头函数被非箭头函数包含，则 this 绑定的是最近一层非箭头函数的 this，否则，this 为 undefined。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a) <span class=\"comment\">// 定义在全局对象中，因此this绑定在全局作用域</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo() <span class=\"comment\">// 1 ,在全局对象中调用</span></span><br><span class=\"line\">foo.call(obj) <span class=\"comment\">// 1,显示绑定，由obj对象来调用，但根本不影响结果</span></span><br></pre></td></tr></table></figure>\n\n<p>箭头函数的 this 强制性的绑定在了箭头函数定义时所在的作用域，而且无法通过显示绑定，如 apply，call 方法来修改</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.speak = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">    <span class=\"comment\">// 普通函数（非箭头函数),this绑定在调用时的作用域</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.bornYear = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 本文写于2016年，因此new Date().getFullYear()得到的是2016</span></span><br><span class=\"line\">    <span class=\"comment\">// 箭头函数，this绑定在实例内部</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getFullYear() - <span class=\"built_in\">this</span>.age)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> zxt = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;zxt&#x27;</span>, <span class=\"number\">22</span>)</span><br><span class=\"line\">zxt.speak() <span class=\"comment\">// &quot;zxt&quot;</span></span><br><span class=\"line\">zxt.bornYear() <span class=\"comment\">// 1994</span></span><br><span class=\"line\"><span class=\"comment\">// 到这里应该大家应该都没什么问题</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> xiaoMing = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;xiaoming&#x27;</span>,</span><br><span class=\"line\">  age: <span class=\"number\">18</span> <span class=\"comment\">// 小明永远18岁</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">zxt.speak.call(xiaoMing)</span><br><span class=\"line\"><span class=\"comment\">// &quot;xiaoming&quot; this绑定的是xiaoMing这个对象</span></span><br><span class=\"line\">zxt.bornYear.call(xiaoMing)</span><br></pre></td></tr></table></figure>\n\n<p>以上就是 javascript 中所有 this 绑定的情况，在 es6 之前，前面所说的四种绑定规则可以涵盖任何的函数调用情况，es6 标准实施以后，对于函数的扩展新增了箭头函数，与之不同的是，箭头函数的作用于位于箭头函数定义时所在的作用域。</p>\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  id: <span class=\"string\">&#x27;awesome&#x27;</span>,</span><br><span class=\"line\">  cool: <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">coolFn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _this = <span class=\"built_in\">this</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(_this.id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> id = <span class=\"string\">&#x27;not awesome&#x27;</span></span><br><span class=\"line\">obj.cool() <span class=\"comment\">// 酷,object</span></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(obj.cool, <span class=\"number\">100</span>) <span class=\"comment\">//window</span></span><br></pre></td></tr></table></figure>\n\n<p>cool() 函数丢失了同 this 之间的绑定， var self = this 这种方案可以圆满解决了理解和正确使用 this 绑定的问题。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Obj</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> _this = <span class=\"built_in\">this</span> <span class=\"comment\">//_this = object&#123;&#125;</span></span><br><span class=\"line\">  _this.id = name</span><br><span class=\"line\">  _this.cool = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(_this.id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> id = <span class=\"string\">&#x27;not awesome&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> test = <span class=\"keyword\">new</span> Obj(<span class=\"string\">&#x27;yaya&#x27;</span>) <span class=\"comment\">//yaya</span></span><br><span class=\"line\">test.cool() <span class=\"comment\">//yaya</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> xiaohong = &#123;</span><br><span class=\"line\">  id: xiaohong,</span><br><span class=\"line\">  age: <span class=\"number\">18</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test.cool.call(xiaohong) <span class=\"comment\">//根本不执行</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">identify</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name.toUpperCase()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">speak</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> greeting = <span class=\"string\">&quot;Hello, I&#x27;m &quot;</span> + identify.call(<span class=\"built_in\">this</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(greeting)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> me = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;Kyle&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> you = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;Reader&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">identify.call(me) <span class=\"comment\">// KYLE</span></span><br><span class=\"line\">identify.call(you) <span class=\"comment\">// READER</span></span><br><span class=\"line\">speak.call(me) <span class=\"comment\">// Hello, 我是KYLE</span></span><br><span class=\"line\">speak.call(you) <span class=\"comment\">// Hello, 我是READER</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;foo: &#x27;</span> + num)</span><br><span class=\"line\">  <span class=\"comment\">// 记录foo被调用的次数</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.count++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo.count = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> i</span><br><span class=\"line\"><span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i &gt; <span class=\"number\">5</span>) &#123;</span><br><span class=\"line\">    foo(i)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// foo: 6</span></span><br><span class=\"line\"><span class=\"comment\">// foo: 7</span></span><br><span class=\"line\"><span class=\"comment\">// foo: 8</span></span><br><span class=\"line\"><span class=\"comment\">// foo: 9</span></span><br><span class=\"line\"><span class=\"comment\">// foo被调用了多少次？</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(foo.count) <span class=\"comment\">// 0 -- WTF?</span></span><br></pre></td></tr></table></figure>\n\n<p>执行 foo.count = 0 时，的确向函数对象 foo 添加了一个属性 count。但是函数内部代码 this.count 中的 this 并不指向那个函数，所以虽然属性名相同，跟对象却并不相同。这段代码在五一中创建了一个全局变量 count。</p>\n<p>** 匿名函数无法指向自身 **，arguments.callee 是唯一一种从匿名函数对象中引用自身的方法，已被弃用。，然而更好的是避免使用匿名函数，至少在需要自引用时使用时使用具名函数</p>\n<p>*<em>this 在任何情况下都不指向函数的词法作用域 **，作用域 “ 对象 ” 无法通过 js 代码来访问，它存在于 js 引擎内部 \\</em>*</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.bar()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo()</span><br></pre></td></tr></table></figure>\n\n<p>试图用 this 联通 foo() 和 bar() 的词法作用域，从而让 bar 可以 i 访问 foo() 变量的 a，这是不可能实现的，** 不能使用 this 来引用一个词法作用域内部的东西 **，每当想要把 this 和此法作用域混用的时候，一定要提醒自己，这是无法实现的</p>\n<hr>\n<h2 id=\"综合题\"><a href=\"#综合题\" class=\"headerlink\" title=\"综合题\"></a>综合题</h2><h3 id=\"1\"><a href=\"#1\" class=\"headerlink\" title=\"1\"></a>1</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> names = <span class=\"string\">&#x27;宋伟老师&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  names: <span class=\"string\">&#x27;张健老师&#x27;</span>,</span><br><span class=\"line\">  showName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  returnName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  returnFunctionName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.showName() <span class=\"comment\">//输出什么？   &quot;张健老师&quot;</span></span><br><span class=\"line\">obj.returnName() <span class=\"comment\">//输出什么？   &quot;张健老师&quot;</span></span><br><span class=\"line\">obj.returnFunctionName()() <span class=\"comment\">//输出什么？   &quot;宋伟老师&quot;</span></span><br><span class=\"line\">obj.showName.call(names) <span class=\"comment\">//输出什么？   undefined</span></span><br><span class=\"line\">obj.returnName.call(names) <span class=\"comment\">//输出什么？   undefined</span></span><br><span class=\"line\">obj.returnFunctionName().call(names) <span class=\"comment\">//输出什么？   undefined</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> newObj = obj.returnFunctionName().bind(<span class=\"built_in\">window</span>)</span><br><span class=\"line\">newObj.call(obj) <span class=\"comment\">//输出什么？   &quot;宋伟老师&quot;</span></span><br><span class=\"line\"><span class=\"comment\">//为什么最后一个输出&quot;宋伟老师&quot;？因为bind指向this对象后  再一次调用的话  this指向不会被改变</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2\"><a href=\"#2\" class=\"headerlink\" title=\"2\"></a>2</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> big = <span class=\"string\">&#x27;万达老师&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  big: <span class=\"string\">&#x27;宋伟老师&#x27;</span>,</span><br><span class=\"line\">  showBig: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.big</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.showBig.call(big) <span class=\"comment\">//ƒ big() &#123; [native code] &#125;  //精通String的操作方法的同学就把为什么回复出来吧</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3\"><a href=\"#3\" class=\"headerlink\" title=\"3\"></a>3</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\">a,b,c</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.length);                 <span class=\"comment\">//4</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.callee.length);          <span class=\"comment\">//1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">d</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>](<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">30</span>,<span class=\"number\">40</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fn(a,<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">30</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//第一个输出结果:因为this当前指向的是arguments 。 arguments是一个伪数组具备length属性。arguments又是保存函数的实参。</span></span><br><span class=\"line\">fn调用的时候传入<span class=\"number\">4</span>个实参。所以<span class=\"built_in\">arguments</span>长度为<span class=\"number\">4</span>。这个时候<span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>] 等同于 <span class=\"built_in\">arguments</span>.a调用这个函数。所以<span class=\"built_in\">this</span>指向的是<span class=\"built_in\">arguments</span>这个伪数组也是(对象)(听到这还有疑惑小伙伴留言问我)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//第二个输出结果：callee是arguments的一个属性,主要返回当前arguments直属的函数体。所以this.callees是返回fn 。每一个函数有一个length属性主要用来返回函数的形参的所以就是1。</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p><a href=\"http://mp.weixin.qq.com/s/2PnWD8bIFgEJxYONoPZs6w\">文献参考链接</a></p>\n<ol>\n<li>js 函数中 this 指向并不是在函数定义的时候确定的，而是在函数调用的时候确定的，所以函数的调用方式决定 this 的 指向。<strong>this 永远指向最后调用它的那个对象</strong>。</li>\n<li>普通的函数有 3 种调用方式：直接调用，方法调用和 new 调用。除此之外还有通过 bind() 将函数绑定到对象之后再调用，通过 call()、apply() 进行调用等。es6 引入箭头函数之后，其 this 指向又有所不同。</li>\n<li>this 既不是指向函数自身也不指向函数作用域，this 实际上是在函数被调用是发生绑定的，它的指向完全取决于函数在哪里调用。</li>\n</ol>","more":"<h2 id=\"用代码解释：this-永远指向最后调用它的那个对象\"><a href=\"#用代码解释：this-永远指向最后调用它的那个对象\" class=\"headerlink\" title=\"用代码解释：this 永远指向最后调用它的那个对象\"></a>用代码解释：this 永远指向最后调用它的那个对象</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;A&#x27;</span>,</span><br><span class=\"line\">  fn: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">a.fn() <span class=\"comment\">//this===a;</span></span><br><span class=\"line\">a.fn.call(&#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;B&#x27;</span> &#125;) <span class=\"comment\">//this===&#123;name:&#x27;B&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fn1 = a.fn</span><br><span class=\"line\">fn1() <span class=\"comment\">//this===window</span></span><br></pre></td></tr></table></figure>\n\n<p>this 执行会有不同，主要是几种在这几个场景中：</p>\n<ul>\n<li>作为构造函数执行，构造函数中</li>\n<li>作为对象属性上执行，上述代码中的 a.fn()</li>\n<li>作为普通函数执行，上述代码中的 fn1()</li>\n<li>用于 bind,call,apply 上述代码中 a.fn.call({name:’B’})</li>\n</ul>\n<h2 id=\"默认绑定\"><a href=\"#默认绑定\" class=\"headerlink\" title=\"默认绑定\"></a>默认绑定</h2><p>在 JavaScript 中，最常用的函数调用类型就是独立函数调用。如果在调用函数的时候，函数不带任何修饰，也就是光秃秃的调用，那就会应用默认绑定规则，默认绑定的指向的是全局作用域。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> charset=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&quot;g&quot;</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);        <span class=\"comment\">//g</span></span><br><span class=\"line\">      a.name = <span class=\"string\">&#x27;inside&#x27;</span>;</span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);  <span class=\"comment\">//g</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      b();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  a();</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p><code>a()</code> 函数在全局作用域中被调用，因此第 1 句中的 <code>this</code> 就绑定在了全局对象上。<code>b()</code> 函数在 <code>a()</code> 函数里面调用，即使这样第二句中的 <code>this</code> 指代的仍然是全局对象，即使 <code>a()</code> 函数设置了 <code>name</code> 属性。这就是默认绑定规则，它是 <code>js</code> 中最常见的一种函数调用模式，<code>this</code> 的绑定规则也是最简单的一种，就是绑定在全局作用域上</p>\n<p>** 但是如果使用了严格模式，则 <code>this</code> 不能绑定到全局对象，在严格模式下，把 <code>this</code> 绑定到全局对象上时，实际上绑定的是 <code>underfined</code>，因此上面的代码会报错 **</p>\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> c = <span class=\"built_in\">this</span></span><br><span class=\"line\">  c.name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//inside</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//inside</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//inside</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//underfined</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//inside</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;g&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(name) <span class=\"comment\">//underfined</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;inside&#x27;</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">b</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//g</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  b()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">a()</span><br></pre></td></tr></table></figure>\n\n<p>所以通过上面的实验可以充分的得出一个结论，this 确实不是指向的当前作用域的，this 和词法作用域是完全不同的。</p>\n<hr>\n<h2 id=\"隐式绑定\"><a href=\"#隐式绑定\" class=\"headerlink\" title=\"隐式绑定\"></a>隐式绑定</h2><p>当函数在调用时，如果函数有所谓的 “ 落脚点 ”, 即有上下文对象时，隐式绑定规则会把函数中的 this 绑定到这个上下文对象。如果觉得上面这段话不够直白的话，还是来看代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;zxt&#x27;</span>,</span><br><span class=\"line\">  say: say</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;zxt1&#x27;</span>,</span><br><span class=\"line\">  say: say</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj1.say() <span class=\"comment\">// zxt</span></span><br><span class=\"line\">obj2.say() <span class=\"comment\">// zxt1</span></span><br></pre></td></tr></table></figure>\n\n<p>obj1 ， obj2 就是所谓 say 函数的落脚点，专业一点的说法就是上下文对象，给函数指定了这个上下文对象的时，函数内部的 this 自然指向了这个上下文对象。这是很常见的函数调用模式</p>\n<p>** 对象属性引用链中只有最顶层或者说是最后一层会影响调用位置 **</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">42</span>,</span><br><span class=\"line\">  foo: foo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span>,</span><br><span class=\"line\">  obj2: obj2</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj1.obj2.foo()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"隐式绑定上下文的时丢失上下文\"><a href=\"#隐式绑定上下文的时丢失上下文\" class=\"headerlink\" title=\"隐式绑定上下文的时丢失上下文\"></a>隐式绑定上下文的时丢失上下文</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;global&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;inside&#x27;</span>,</span><br><span class=\"line\">  say: say</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> alias = obj.say <span class=\"comment\">// 设置一个简写   (1)</span></span><br><span class=\"line\">alias() <span class=\"comment\">// 函数调用 输出&quot;global&quot;  (2)</span></span><br></pre></td></tr></table></figure>\n\n<p>由于在 js 中，函数是对象，对象之间是引用传递，而不是值传递，因此第一句代码只是 alias = obj.say= say, 也就是 alias = say，obj.say 只是起了一个桥梁的作用，alias 最终引用的是 say 函数的地址，而与 obj 这个对象无关了，这就是所谓的 “ 丢失上下文 ”。最终执行 alias 函数只不过简单的执行了 say 函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doFoo</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// fn其实引用的是foo</span></span><br><span class=\"line\">  fn() <span class=\"comment\">// &lt;-- 调用位置！</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span>,</span><br><span class=\"line\">  foo: foo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&#x27;oops, global&#x27;</span> <span class=\"comment\">// a是全局对象的属性</span></span><br><span class=\"line\">doFoo(obj.foo)</span><br></pre></td></tr></table></figure>\n\n<p>参数传递其实就是一种隐式赋值，因此我们传入函数时也会被隐式赋值。回调函数丢失 this 是很常见的情况，除此之外回调函数的函数可能会修改 this，实际上你无法控制回调函数的执行方式，因此就没办法控制会影响绑定的调用位置</p>\n<hr>\n<h2 id=\"显示绑定\"><a href=\"#显示绑定\" class=\"headerlink\" title=\"显示绑定\"></a>显示绑定</h2><p>显示绑定，显示的将 this 绑定到一个上下文，js 中，提供了三种显示绑定的方法，apply,call ， bind。apply 和 call 的用法基本相似，他们之间的区别是：</p>\n<ul>\n<li><p>apply(obj,[arg1.arg2,…]); 被调用函数的参数以数组的形式给出</p>\n</li>\n<li><p>call(obj,arg1,arg2,arg3,…); 被调用函数的参数依次给出</p>\n</li>\n<li><p>bind 函数执行后，返回的是一个新函数。</p>\n</li>\n</ul>\n<p>** 硬性绑定的应用场景：**</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( <span class=\"built_in\">this</span>.a, something );</span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.a + something;</span><br><span class=\"line\">&#125; v</span><br><span class=\"line\">ar obj = &#123;</span><br><span class=\"line\">a:<span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">return</span> foo.apply( obj, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = bar( <span class=\"number\">3</span> ); <span class=\"comment\">// 2 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( b ); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>另一种使用方法是创建一个</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">speak</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;global&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;obj1&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;obj2&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">speak() <span class=\"comment\">// global 等价于speak.call(window)</span></span><br><span class=\"line\">speak.call(<span class=\"built_in\">window</span>)</span><br><span class=\"line\">speak.call(obj1) <span class=\"comment\">// obj1</span></span><br><span class=\"line\">speak.call(obj2) <span class=\"comment\">// obj2</span></span><br></pre></td></tr></table></figure>\n\n<p>带参数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 带参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">num1, num2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a * num1 + num2)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">3</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">count.call(obj1, <span class=\"number\">1</span>, <span class=\"number\">2</span>) <span class=\"comment\">// 4</span></span><br><span class=\"line\">count.apply(obj1, [<span class=\"number\">1</span>, <span class=\"number\">2</span>]) <span class=\"comment\">// 4</span></span><br><span class=\"line\">count.call(obj2, <span class=\"number\">1</span>, <span class=\"number\">2</span>) <span class=\"comment\">// 5</span></span><br><span class=\"line\">count.apply(obj2, [<span class=\"number\">1</span>, <span class=\"number\">2</span>]) <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>因此可以看出，apply ， call 的作用就是给函数绑定一个执行上下文，且是显示绑定的。因此函数内的 this 自然而然就绑定在了 call 或者 apply 所调用的对象上。而 bind 函数，则返回一个绑定了制定的执行上下文的新函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 带参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">num1, num2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a * num1 + num2)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bound1 = count.bind(obj1) <span class=\"comment\">// 未指定参数</span></span><br><span class=\"line\">bound1(<span class=\"number\">1</span>, <span class=\"number\">2</span>) <span class=\"comment\">// 4</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bound2 = count.bind(obj1, <span class=\"number\">1</span>) <span class=\"comment\">// 指定了一个参数</span></span><br><span class=\"line\">bound2(<span class=\"number\">2</span>) <span class=\"comment\">// 4</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bound3 = count.bind(obj1, <span class=\"number\">1</span>, <span class=\"number\">2</span>) <span class=\"comment\">// 指定了两个参数</span></span><br><span class=\"line\">bound3() <span class=\"comment\">//4</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bound4 = count.bind(obj1, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">// 指定了多余的参数,多余的参数会被忽略</span></span><br><span class=\"line\">bound4() <span class=\"comment\">// 4</span></span><br></pre></td></tr></table></figure>\n\n<p>所以 bind 方法只是返回了一个新的函数，这个函数内的 this 指定了执行上下文，而返回这个新函数可以接受参数。</p>\n<hr>\n<p>new 绑定最后要将的一种 this 绑定规则，是指通过 new 操作符调用构造函数时发生的 this 绑定。构造函数也仅仅是普通函数而已，只不过构造函数以答谢字母开头，也只不过它可以通过 new 操作符调用而已。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;我也只不过是个普通函数&#x27;</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>) <span class=\"comment\">//window、window、Person</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person(<span class=\"string\">&#x27;zxt&#x27;</span>, <span class=\"number\">22</span>) <span class=\"comment\">// &quot;我也只不过是个普通函数&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">// &quot;zxt&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(age) <span class=\"comment\">// 22</span></span><br><span class=\"line\">Person(<span class=\"string\">&#x27;yh&#x27;</span>, <span class=\"number\">122</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//yu</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> zxt = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;zxt&#x27;</span>, <span class=\"number\">22</span>) <span class=\"comment\">// &quot;我也只不过是个普通函数&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(zxt.name) <span class=\"comment\">// &quot;zxt&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(zxt.age) <span class=\"comment\">// 22</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name) <span class=\"comment\">//yu</span></span><br></pre></td></tr></table></figure>\n\n<p>定义的 Person 函数，既可以普通调用，也可以构造函数的形式上的调用，当普通函数调用时，则按正常的函数执行，输出一个字符串。如果通过一个 new 操作符，则构造了一个新的对象。</p>\n<p>两种调用方式的不同之处：</p>\n<ul>\n<li>** 普通函数调用时，应用启用默认绑定规则 **，this 绑定在全局上，此时全局对象上回分别增加 name 和 age 两个属性。</li>\n<li>当通过 new 操作符时，会产生一个新对象，并且会把构造函数内的 this 绑定到这个对象上，事实上，在 js 中，使用 new 来调用函数，会自动执行下面的操作<ol>\n<li>创建一个全新的对象。</li>\n<li>这个新对象或被执行原型链连接</li>\n<li>这个新对象会绑定到函数调用的 this</li>\n<li>如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h2 id=\"四种绑定的优先级\"><a href=\"#四种绑定的优先级\" class=\"headerlink\" title=\"四种绑定的优先级\"></a>四种绑定的优先级</h2><p>这四种绑定规则基本上涵盖了所有函数调用情况。但是同时应用了这四种规则中的两种甚至更多，又该是怎么样的一个情况，或者说这四种绑定的优先级顺序又是怎么样的。** 默认优先级最低 &lt; 隐式绑定第二 &lt; 显示绑定第三 &lt; new 绑定最高 **</p>\n<hr>\n<h2 id=\"箭头函数中的-this\"><a href=\"#箭头函数中的-this\" class=\"headerlink\" title=\"箭头函数中的 this\"></a>箭头函数中的 this</h2><p>箭头函数的 this 是根据外层的 ( 函数或则全局 ) 作用于来决定的，函数体内的 this 对象指的是定义时所在的对象，而不是之前介绍的调用时绑定的对象。箭头函数的 this 始终指向函数定义时的 this，而非执行时。箭头函数中没有 this 绑定，必须通过查找作用域链来决定其值，如果箭头函数被非箭头函数包含，则 this 绑定的是最近一层非箭头函数的 this，否则，this 为 undefined。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a) <span class=\"comment\">// 定义在全局对象中，因此this绑定在全局作用域</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo() <span class=\"comment\">// 1 ,在全局对象中调用</span></span><br><span class=\"line\">foo.call(obj) <span class=\"comment\">// 1,显示绑定，由obj对象来调用，但根本不影响结果</span></span><br></pre></td></tr></table></figure>\n\n<p>箭头函数的 this 强制性的绑定在了箭头函数定义时所在的作用域，而且无法通过显示绑定，如 apply，call 方法来修改</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.speak = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">    <span class=\"comment\">// 普通函数（非箭头函数),this绑定在调用时的作用域</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.bornYear = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 本文写于2016年，因此new Date().getFullYear()得到的是2016</span></span><br><span class=\"line\">    <span class=\"comment\">// 箭头函数，this绑定在实例内部</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getFullYear() - <span class=\"built_in\">this</span>.age)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> zxt = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;zxt&#x27;</span>, <span class=\"number\">22</span>)</span><br><span class=\"line\">zxt.speak() <span class=\"comment\">// &quot;zxt&quot;</span></span><br><span class=\"line\">zxt.bornYear() <span class=\"comment\">// 1994</span></span><br><span class=\"line\"><span class=\"comment\">// 到这里应该大家应该都没什么问题</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> xiaoMing = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;xiaoming&#x27;</span>,</span><br><span class=\"line\">  age: <span class=\"number\">18</span> <span class=\"comment\">// 小明永远18岁</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">zxt.speak.call(xiaoMing)</span><br><span class=\"line\"><span class=\"comment\">// &quot;xiaoming&quot; this绑定的是xiaoMing这个对象</span></span><br><span class=\"line\">zxt.bornYear.call(xiaoMing)</span><br></pre></td></tr></table></figure>\n\n<p>以上就是 javascript 中所有 this 绑定的情况，在 es6 之前，前面所说的四种绑定规则可以涵盖任何的函数调用情况，es6 标准实施以后，对于函数的扩展新增了箭头函数，与之不同的是，箭头函数的作用于位于箭头函数定义时所在的作用域。</p>\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  id: <span class=\"string\">&#x27;awesome&#x27;</span>,</span><br><span class=\"line\">  cool: <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">coolFn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _this = <span class=\"built_in\">this</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(_this.id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> id = <span class=\"string\">&#x27;not awesome&#x27;</span></span><br><span class=\"line\">obj.cool() <span class=\"comment\">// 酷,object</span></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(obj.cool, <span class=\"number\">100</span>) <span class=\"comment\">//window</span></span><br></pre></td></tr></table></figure>\n\n<p>cool() 函数丢失了同 this 之间的绑定， var self = this 这种方案可以圆满解决了理解和正确使用 this 绑定的问题。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Obj</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> _this = <span class=\"built_in\">this</span> <span class=\"comment\">//_this = object&#123;&#125;</span></span><br><span class=\"line\">  _this.id = name</span><br><span class=\"line\">  _this.cool = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(_this.id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> id = <span class=\"string\">&#x27;not awesome&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> test = <span class=\"keyword\">new</span> Obj(<span class=\"string\">&#x27;yaya&#x27;</span>) <span class=\"comment\">//yaya</span></span><br><span class=\"line\">test.cool() <span class=\"comment\">//yaya</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> xiaohong = &#123;</span><br><span class=\"line\">  id: xiaohong,</span><br><span class=\"line\">  age: <span class=\"number\">18</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">test.cool.call(xiaohong) <span class=\"comment\">//根本不执行</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">identify</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name.toUpperCase()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">speak</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> greeting = <span class=\"string\">&quot;Hello, I&#x27;m &quot;</span> + identify.call(<span class=\"built_in\">this</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(greeting)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> me = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;Kyle&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> you = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;Reader&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">identify.call(me) <span class=\"comment\">// KYLE</span></span><br><span class=\"line\">identify.call(you) <span class=\"comment\">// READER</span></span><br><span class=\"line\">speak.call(me) <span class=\"comment\">// Hello, 我是KYLE</span></span><br><span class=\"line\">speak.call(you) <span class=\"comment\">// Hello, 我是READER</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;foo: &#x27;</span> + num)</span><br><span class=\"line\">  <span class=\"comment\">// 记录foo被调用的次数</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.count++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo.count = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> i</span><br><span class=\"line\"><span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i &gt; <span class=\"number\">5</span>) &#123;</span><br><span class=\"line\">    foo(i)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// foo: 6</span></span><br><span class=\"line\"><span class=\"comment\">// foo: 7</span></span><br><span class=\"line\"><span class=\"comment\">// foo: 8</span></span><br><span class=\"line\"><span class=\"comment\">// foo: 9</span></span><br><span class=\"line\"><span class=\"comment\">// foo被调用了多少次？</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(foo.count) <span class=\"comment\">// 0 -- WTF?</span></span><br></pre></td></tr></table></figure>\n\n<p>执行 foo.count = 0 时，的确向函数对象 foo 添加了一个属性 count。但是函数内部代码 this.count 中的 this 并不指向那个函数，所以虽然属性名相同，跟对象却并不相同。这段代码在五一中创建了一个全局变量 count。</p>\n<p>** 匿名函数无法指向自身 **，arguments.callee 是唯一一种从匿名函数对象中引用自身的方法，已被弃用。，然而更好的是避免使用匿名函数，至少在需要自引用时使用时使用具名函数</p>\n<p>*<em>this 在任何情况下都不指向函数的词法作用域 **，作用域 “ 对象 ” 无法通过 js 代码来访问，它存在于 js 引擎内部 \\</em>*</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"built_in\">this</span>.bar()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo()</span><br></pre></td></tr></table></figure>\n\n<p>试图用 this 联通 foo() 和 bar() 的词法作用域，从而让 bar 可以 i 访问 foo() 变量的 a，这是不可能实现的，** 不能使用 this 来引用一个词法作用域内部的东西 **，每当想要把 this 和此法作用域混用的时候，一定要提醒自己，这是无法实现的</p>\n<hr>\n<h2 id=\"综合题\"><a href=\"#综合题\" class=\"headerlink\" title=\"综合题\"></a>综合题</h2><h3 id=\"1\"><a href=\"#1\" class=\"headerlink\" title=\"1\"></a>1</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> names = <span class=\"string\">&#x27;宋伟老师&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  names: <span class=\"string\">&#x27;张健老师&#x27;</span>,</span><br><span class=\"line\">  showName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  returnName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  returnFunctionName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.showName() <span class=\"comment\">//输出什么？   &quot;张健老师&quot;</span></span><br><span class=\"line\">obj.returnName() <span class=\"comment\">//输出什么？   &quot;张健老师&quot;</span></span><br><span class=\"line\">obj.returnFunctionName()() <span class=\"comment\">//输出什么？   &quot;宋伟老师&quot;</span></span><br><span class=\"line\">obj.showName.call(names) <span class=\"comment\">//输出什么？   undefined</span></span><br><span class=\"line\">obj.returnName.call(names) <span class=\"comment\">//输出什么？   undefined</span></span><br><span class=\"line\">obj.returnFunctionName().call(names) <span class=\"comment\">//输出什么？   undefined</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> newObj = obj.returnFunctionName().bind(<span class=\"built_in\">window</span>)</span><br><span class=\"line\">newObj.call(obj) <span class=\"comment\">//输出什么？   &quot;宋伟老师&quot;</span></span><br><span class=\"line\"><span class=\"comment\">//为什么最后一个输出&quot;宋伟老师&quot;？因为bind指向this对象后  再一次调用的话  this指向不会被改变</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2\"><a href=\"#2\" class=\"headerlink\" title=\"2\"></a>2</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> big = <span class=\"string\">&#x27;万达老师&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  big: <span class=\"string\">&#x27;宋伟老师&#x27;</span>,</span><br><span class=\"line\">  showBig: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.big</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.showBig.call(big) <span class=\"comment\">//ƒ big() &#123; [native code] &#125;  //精通String的操作方法的同学就把为什么回复出来吧</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3\"><a href=\"#3\" class=\"headerlink\" title=\"3\"></a>3</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\">a,b,c</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.length);                 <span class=\"comment\">//4</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.callee.length);          <span class=\"comment\">//1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">d</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>](<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">30</span>,<span class=\"number\">40</span>,<span class=\"number\">50</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fn(a,<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">30</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//第一个输出结果:因为this当前指向的是arguments 。 arguments是一个伪数组具备length属性。arguments又是保存函数的实参。</span></span><br><span class=\"line\">fn调用的时候传入<span class=\"number\">4</span>个实参。所以<span class=\"built_in\">arguments</span>长度为<span class=\"number\">4</span>。这个时候<span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>] 等同于 <span class=\"built_in\">arguments</span>.a调用这个函数。所以<span class=\"built_in\">this</span>指向的是<span class=\"built_in\">arguments</span>这个伪数组也是(对象)(听到这还有疑惑小伙伴留言问我)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//第二个输出结果：callee是arguments的一个属性,主要返回当前arguments直属的函数体。所以this.callees是返回fn 。每一个函数有一个length属性主要用来返回函数的形参的所以就是1。</span></span><br></pre></td></tr></table></figure>"},{"title":"webpack打包优化","date":"2019-07-22T07:37:14.000Z","_content":"\nwebpack 的使用及优化\n\n我们的目的\n\n- 减小打包后的文件大小\n- 首页按需引入文件\n- 优化 webpack 打包时间\n\n<!--more-->\n\n## 新建项目\n\n新建一个空文件夹，用于创建项目，使用 npm init 命令创建一个 package.json 文件。  \n输入这个命令后，终端会问你一系列诸如项目名称，项目描述，作者等信息，也可以使用 npm init -y 这个命令来一次生成 package.json 文件，这样终端不会询问你问题。\n\n## 安装 webpack\n\n安装 webapck 时把 webpack-cli 也装上是因为在 webpack4.x 版本后 webpack 模块把一些功能分到了 webpack-cli 模块，所以两者都需要安装，安装方法如下：\n\n```javascript\nnpm install webpack webpack-cli --global    //这是安装全局webpack及webpack-cli模块\nnpm install webpack webpack-cli --save-dev  //这是安装本地项目模块\n```\n\n## 新建文件\n\n在根目录件夹中新建两个文件夹，分别为 src 文件夹和 dist 文件夹，接下来再创建三个文件:此时，项目结构如下\n\n- index.html --放在 dist 文件夹中；\n- hello.js --放在 src 文件夹中；\n- index.js --放在 src 文件夹中；\n\n### index.html 中写下 html 代码，它的作用是为了引入我们打包后的 js 文件：\n\n```html\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <title>Webpack Project</title>\n  </head>\n  <body>\n    <div id=\"root\"></div>\n    <script src=\"bundle.js\"></script>\n    <!--这是打包之后的js文件，我们暂时命名为bundle.js-->\n  </body>\n</html>\n```\n\n### 在 hello.js 中导出一个模块：\n\n```js\n// hello.js\nmodule.exports = function () {\n  let hello = document.createElement('div')\n  hello.innerHTML = 'welcome to China!'\n  return hello\n}\n```\n\n### 在 index.js 中引入这个模块（hello.js）:\n\n```js\n//index.js\nconst hello = require('./hello.js')\ndocument.querySelector('#root').appendChild(hello())\n```\n\n上述操作就相当于我们把 hello.js 模块合并到了 index.js 模块，之后我们打包时就只需把 index.js 模块打包成 bundle.js 即可。\n\n### 进行最简单的 webpack 打包\n\n```javascript\n// 在终端中使用如下命令进行打包：\nwebpack src/index.js --output dist/bundle.js\n```\n\n上述就相当于把 src 文件夹下的 index.js 文件打包到 dist 文件下的 bundle.js，这时就生成了 bundle.js 供 index.html 文件引用。现在打开 index.html 就可以看到我们的页面了。\n\n## 配置 webpack.config.js\n\n上述打包方式太 low 了，我们可以在当前项目的根目录下新建一个配置文件 webpack.config.js 用来配置打包方式。\nwebpack.config.js 配置如下\n\n```js\nconst path = require('path') // 处理绝对路径\nmodule.exports = {\n  entry: path.join(__dirname, '/src/index.js'), // 入口文件\n  output: {\n    path: path.join(__dirname, '/dist'), //打包后的文件存放的地方\n    filename: 'bundle.js' //打包后输出文件的文件名\n  }\n}\n```\n\n有了这个配置文件，我们只需在终端中运行 webpack 命令就可进行打包，这条命令会自动引用 webpack.config.js 文件中的配置选项。\n\n## 构建本地服务器\n\n现在我们是通过打开本地文件来查看页面的，感觉还是有点 low。例如 vue, react 等脚手架都是在本地服务器运行的。所以我们再做进一步优化。\n\n### webpack-dev-server 配置本地服务器\n\nWebpack 提供了一个可选的本地开发服务器，这个本地服务器基于 node.js 构建，它是一个单独的组件，在 webpack 中进行配置之前需要单独安装它作为项目依赖：npm i webpack-dev-server -D\n\n以下是 devServer 的一些配置选项:\n\n- contentBase ：设置服务器所读取文件的目录，当前我们设置为\"./dist\"\n- port ：设置端口号，如果省略，默认为 8080\n- inline ：设置为 true，当源文件改变时会自动刷新页面\n- historyApiFallback ：设置为 true，所有的跳转将指向 index.html\n\n现在我们把这些配置加到 webpack.config.js 文件上，如下：\n\n```js\n// webpack.config.js\nconst path = require('path')\nmodule.exports = {\n  entry: path.join(__dirname, '/src/index.js'), // 入口文件\n  output: {\n    path: path.join(__dirname, '/dist'), //打包后的文件存放的地方\n    filename: 'bundle.js' //打包后输出文件的文件名\n  },\n  devServer: {\n    contentBase: './dist', // 本地服务器所加载文件的目录\n    port: '8088', // 设置端口号为8088\n    inline: true, // 文件修改后实时刷新\n    historyApiFallback: true //不跳转\n  }\n}\n```\n\n### package.json 文件中添加启动和打包命令\n\npackage.json 文件修改如下\n\n```javascript\n{\n  \"name\": \"webpack-project\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"build\": \"webpack\",\n    \"dev\": \"webpack-dev-server --open\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"webpack\": \"^4.23.1\",\n    \"webpack-cli\": \"^3.1.2\",\n    \"webpack-dev-server\": \"^3.1.10\"\n  }\n}\n```\n\n这样我们就可以用以下命令进行本地运行或者打包文件了\n\n- npm run dev 启动本地服务器，webpack-dev-server 就是启动服务器的命令，--open 是用于启动完服务器后自动打开浏览器。\n- npm run build 执行打包命令\n\n此时，我们只要输入 npm run dev 就可以在 http://localhost:8088/中查看页面了。\n\n## 配置常用 loader\n\nloader 可以让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。\n\nLoaders 的配置包括以下几方面：\n\n- test：一个用以匹配 loaders 所处理文件的拓展名的正则表达式（必须）\n- loader：loader 的名称（必须）\n- include/exclude：手动添加必须处理的文件（文件夹）或屏蔽不需要处理的文件（文件夹）（可选）；\n- options：为 loaders 提供额外的设置选项（可选）\n\n### 配置 css-loader 和 sass-loader\n\n如果我们要加载一个 css 文件，需要安装配置 style-loader 和 css-loader。  \n如果我们要使用 sass，就要配置 sass-loader 和 node-sass。\n\n- css-loader：加载.css 文件\n- style-loader：使用 style 标签将 css-loader 内部样式注入到我们的 HTML 页面\n\n```javascript\nconst path = require('path')\nmodule.exports = {\n  entry: path.join(__dirname, '/src/index.js'), // 入口文件\n  output: {\n    path: path.join(__dirname, '/dist'), //打包后的文件存放的地方\n    filename: 'bundle.js' //打包后输出文件的文件名\n  },\n  devServer: {\n    contentBase: './dist', // 本地服务器所加载文件的目录\n    port: '8088', // 设置端口号为8088\n    inline: true, // 文件修改后实时刷新\n    historyApiFallback: true //不跳转\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // 正则匹配以.css结尾的文件\n        use: ['style-loader', 'css-loader']\n      {\n        test: /\\.(scss|sass)$/, // 正则匹配以.scss和.sass结尾的文件\n        use: ['style-loader', 'css-loader', 'sass-loader']\n      }\n    ]\n  }\n}\n```\n\n#### css 压缩\n\ncss 代码也可以像 Javascript 那样被压缩，以达到提升加速度和代码混淆的作用。目前比较成熟可靠的 CSS 压缩工具是 cssnano，基于 postcss。\n\ncssnano 能理解 CSS 代码的含义，而不仅仅是删除空格，例如：\n\n- margin:10px 20px 10px 20px 被压缩成 margin：10px 20px\n- color：#ff0000 被压缩成 color:red\n\n通常压缩率能达到 60%，cssnano 介入到 webpack 中很简单，因为 css-loader 已经内置了，只需要开启 css-loader 的 minimize 选项，相关配置如下：\n\n```javascript\nconst path = require('path')\nconst { WebPlugin } = require('web-webpack-plugin')\nconst ExtractTextPlugin = require('extract-text-webpack-plugin')\n\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // 增加对 CSS 文件的支持\n        // 提取出 Chunk 中的 CSS 代码到单独的文件中\n        use: ExtractTextPlugin.extract({\n          // 通过 minimize 选项压缩 CSS 代码\n          use: ['css-loader?minimize']\n        })\n      }\n    ]\n  },\n  plugins: [\n    // 用 WebPlugin 生成对应的 HTML 文件\n    new WebPlugin({\n      template: './template.html', // HTML 模版文件所在的文件路径\n      filename: 'index.html' // 输出的 HTML 的文件名称\n    }),\n    new ExtractTextPlugin({\n      filename: `[name]_[contenthash:8].css` // 给输出的 CSS 文件名称加上 Hash 值\n    })\n  ]\n}\n```\n\n### 配置 Babel-loader\n\nBabel 其实是一个编译 JavaScript 的平台，它可以编译代码帮你达到以下目的：\n\n- 让你能使用最新的 JavaScript 代码（ES6，ES7...）；\n- 让你能使用基于 JavaScript 进行了拓展的语言，比如 React 的 JSX；\n\n```javascript\nmodule: {\n  ...\n  rules: [\n    {\n      test: /\\.js$/,\n      loader: 'babel-loader',\n      include: [resolve('src')]\n    }\n  ]\n}\n```\n\n由于 loader 对文件的转换操作很耗时，需要让尽可能少的文件被 loader 处理，可以通过 test、include、exclude 三个配置来命中 loader 要应用规则的文件。为了尽可能少的让文件被 loader 处理，可以通过 include 去命中只有哪些文件被处理\n\n### 处理图片\n\n处理图片资源时，我们常用的两种 loader 是 file-loader 或者 url-loader。\n当使用 url-loader 加载图片，图片小于上限值，则将图片转 base64 字符串，否则使用 file-loader 加载图片。\n\n```javascript\nmodule: {\n  ...\n  rules: [\n    {\n      test: /\\.(png|jpe?g|gif|svg)(\\?.*)?$/,\n      loader: 'url-loader',\n      options: {\n        limit: 10000,\n        name: utils.assetsPath('img/[name].[hash:7].[ext]')\n      }\n    }\n  ]\n}\n```\n\n### cache-loader\n\n一些性能开销较大的 loader 之前添加 cache-loader，将结果缓存在磁盘中，默认保存在 node_modueles/.cache/cache-loader 目录下。\n首先安装依赖\n\n```javascript\nnpm install cache-loader -D\n```\n\n`cache-loader `的配置要放在其他的 loader 之前，webpack 的配置如下：\n\n```javascript\nmodule.exports = {\n  //...\n\n  module: {\n    //我的项目中,babel-loader耗时比较长，所以我给它配置了`cache-loader`\n    rules: [\n      {\n        test: /\\.jsx?$/,\n        use: ['cache-loader', 'babel-loader']\n      }\n    ]\n  }\n}\n```\n\n若是只想给 babel-loader 配置 cache 的话，也可以不使用 cache-loader，给 babel-loader 增加选项 CacheDirectory。\ncacheDirectory：默认值为 false。当有设置时，指定的目录将用来缓存 loader 的执行结果。之后的 Webpack 构建，将会尝试读取缓存，来避免在每次执行时，可能产生的、高性能消耗的 Babel 重新编译过程。设置空值或者 true 的话，使用默认缓存目录：node_modules/.cache/babel-loader。开启 babel-loader 的缓存和配置 cache-loader，我比对了下，构建时间很接近。\n\n## 7、配置常用插件\n\nloader 被用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。\n\n### 7.1、自动生成 html 文件(HtmlWebpackPlugin)\n\n现在我们都是使用一开始建好的 index.html 文件，然后手动引入 bundle.js，如果以后我们引入不止一个 js 文件，那就得更改 index.html 中的 js 文件名，所以能不能自动生成 index.html 且自动引用打包后的 js 呢？  \nHtmlWebpackPlugin 插件就是用来解决这个问题的：\n\n1. 安装插件 npm i html-webpack-plugin -D\n2. 把 dist 文件夹清空\n3. 在根目录新建 index.html,内容和原来的 html 一致，只是不引入 js 文件。\n4. webpack.config.js 中我们引入了 HtmlWebpackPlugin 插件\n\n```javascript\nplugins: [\n  new HtmlWebpackPlugin({\n    filename: 'index.html',\n    template: 'index.html',\n    inject: true,\n    minify: {\n      removeComments: true,\n      collapseWhitespace: true,\n      removeAttributeQuotes: true\n    }\n  })\n]\n```\n\n此时我们使用 npm run build 进行打包，你会发现，dist 文件夹和 html 文件都会自动生成。\n\n### 7.2、清理/dist 文件夹(CleanWebpackPlugin)\n\n在每次构建前清理/dist 文件夹，生产最新的打包文件，这时候就用到 CleanWebpackPlugin 插件了。\n\n1. 安装 npm i clean-webpack-plugin -D\n2. 配置 webpack.config.js\n\n```javascript\nplugins: [\n  new HtmlWebpackPlugin({\n    filename: 'index.html',\n    template: 'index.html',\n    inject: true,\n    minify: {\n      removeComments: true,\n      collapseWhitespace: true,\n      removeAttributeQuotes: true\n    }\n  }),\n  new CleanWebpackPlugin(['dist'])\n]\n```\n\n### 7.3、热更新(HotModuleReplacementPlugin)\n\n我们要在修改代码后自动更新页面，这就需要 HotModuleReplacementPlugin（HMR）插件\n\n1. devServer 配置项中添加 hot: true 参数。\n2. 因为 HotModuleReplacementPlugin 是 webpack 模块自带的，所以引入 webpack 后，在 plugins 配置项中直接使用即可。\n\n```javascript\nplugins: [\n  new HtmlWebpackPlugin({\n    filename: 'index.html',\n    template: 'index.html',\n    inject: true,\n    minify: {\n      removeComments: true,\n      collapseWhitespace: true,\n      removeAttributeQuotes: true\n    }\n  }),\n  new CleanWebpackPlugin(['dist'])\n  new webpack.HotModuleReplacementPlugin()\n]\n```\n\n### 7.4、增加 css 前缀\n\n平时我们写 css 时，一些属性需要手动加上前缀，比如-webkit-border-radius: 10px;，在 webpack 中我们可以让他自动加上\n\n1. 安装 npm i postcss-loader autoprefixer -D\n2. 在项目根目录下新建 postcss.config.js 文件\n\n```javascript\nmodule.exports = {\n  plugins: [\n    require('autoprefixer') // 引用autoprefixer模块\n  ]\n}\n```\n\n3. 修改 webpack.config.js 文件中的 css-loader 配置\n\n```javascript\nmodule.exports = {\n   ...\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // 正则匹配以.css结尾的文件\n        use: [\n          { loader: 'style-loader' }, // 这里采用的是对象配置loader的写法\n          { loader: 'css-loader' },\n          { loader: 'postcss-loader' } // 使用postcss-loader\n        ]\n      }\n       ...\n    ]\n  }\n   ...\n}\n```\n\n### 7.5、css 分离 ExtractTextPlugin\n\n将 css 成生文件，而非内联。该插件的主要是为了抽离 css 样式,防止将样式打包在 js 中引起页面样式加载错乱的现象。\n\n1. 安装 npm i extract-text-webpack-plugin@next -D\n2. 在 webpack.config.js 文件中引入并使用该插件：\n\n```javascript\nconst ExtractTextPlugin = require('extract-text-webpack-plugin') //引入分离插件\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // 正则匹配以.css结尾的文件\n        use: ExtractTextPlugin.extract({\n          // 相当于回滚，经postcss-loader和css-loader处理过的css最终再经过style-loader处理\n          fallback: 'style-loader',\n          use: ['css-loader', 'postcss-loader']\n        })\n      }\n    ]\n  },\n  plugins: [\n    new ExtractTextPlugin('css/index.css') // 将css分离到/dist文件夹下的css文件夹中的index.css\n  ]\n}\n```\n\n此时运行 npm run build 后会发现/dist 文件夹内多出了/css 文件夹及 index.css 文件。\n\n### 7.6、消除冗余 css\n\n有时候我们 css 写得多了，可能会不自觉的写重复了一些样式，这就造成了多余的代码，以下方法可以优化\n\n1. 安装 npm i purifycss-webpack purify-css glob -D\n2. 引入 clean-webpack-plugin 及 glob 插件并使用\n\n```javascript\nconst PurifyCssWebpack = require('purifycss-webpack') // 引入PurifyCssWebpack插件\nconst glob = require('glob') // 引入glob模块,用于扫描全部html文件中所引用的css\n\nplugins: [\n  new PurifyCssWebpack({\n    paths: glob.sync(path.join(__dirname, 'src/*.html')) // 同步扫描所有html文件中所引用的css\n  })\n]\n```\n\n### 至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。\n\n#### 下面将讲述 webpack 的优化方法。以下的例子是由 vue-cli 脚手架搭建的项目，跟上述例子无关。\n\n————————————————————————————————————————————\n\n## webpack 打包优化\n\n### 为什么要优化打包？\n\n- 项目越做越大，依赖包越来越多，打包文件太大\n- 单页面应用首页白屏时间长，用户体验差\n\n### 我们的目的\n\n- 减小打包后的文件大小\n- 首页按需引入文件\n- 优化 webpack 打包时间\n\n### 按需加载\n\n1.1 路由组件按需加载\n\n```javascript\nconst router = [\n  {\n    path: '/index',\n    component: (resolve) =>\n      require.ensure([], () => resolve(require('@/components/index')))\n  },\n  {\n    path: '/about',\n    component: (resolve) =>\n      require.ensure([], () => resolve(require('@/components/about')))\n  }\n]\n```\n\n1.2 第三方组件和插件。按需加载需引入第三方组件\n\n```javascript\n// 引入全部组件\nimport ElementUI from 'element-ui'\nimport 'element-ui/lib/theme-chalk/index.css'\nVue.use(ElementUI)\n\n// 按需引入组件\nimport { Button } from 'element-ui'\nVue.component(Button.name, Button)\n```\n\n1.3 对于一些插件，如果只是在个别组件中用的到，也可以不要在 main.js 里面引入，而是在组件中按需引入\n\n```javascript\n// 在main.js引入\nimport Vue from vue\nimport Vuelidate from 'vuelidate'\nVue.use(Vuelidate)\n\n// 按组件按需引入\nimport { Vuelidate } from 'vuelidate'\n```\n\n### 优化 loader 配置\n\n- 优化正则匹配\n- 通过 cacheDirectory 选项开启缓存\n- 通过 include、exclude 来减少被处理的文件。\n\n```javascript\nmodule: {\n  rules: [\n    {\n      test: /\\.js$/,\n      loader: 'babel-loader?cacheDirectory',\n      include: [resolve('src')]\n    }\n  ]\n}\n```\n\n### 优化文件路径——省下搜索文件的时间\n\n- extension 配置之后可以不用在 require 或是 import 的时候加文件扩展名,会依次尝试添加扩展名进行匹配。\n- alias 通过配置别名可以加快 webpack 查找模块的速度。\n\n```javascript\n  resolve: {\n    extensions: ['.js', '.vue', '.json'],\n    alias: {\n      'vue$': 'vue/dist/vue.esm.js',\n      '@': resolve('src'),\n    }\n  },\n```\n\n### 生产环境关闭 sourceMap\n\n- sourceMap 本质上是一种映射关系，打包出来的 js 文件中的代码可以映射到代码文件的具体位置,这种映射关系会帮助我们直接找到在源代码中的错误。\n- 打包速度减慢，生产文件变大，所以开发环境使用 sourceMap，生产环境则关闭。\n\n### 代码压缩\n\n- UglifyJS: vue-cli 默认使用的压缩代码方式，它使用的是单线程压缩代码，打包时间较慢\n- ParallelUglifyPlugin: 开启多个子进程，把对多个文件压缩的工作分别给多个子进程去完成\n\n两种方法使用如下：\n\n```javascript\nplugins: [\n  new UglifyJsPlugin({\n    uglifyOptions: {\n      compress: {\n        warnings: false\n      }\n    },\n    sourceMap: true,\n    parallel: true\n  }),\n\n  new ParallelUglifyPlugin({\n    //缓存压缩后的结果，下次遇到一样的输入时直接从缓存中获取压缩后的结果并返回，\n    //cacheDir 用于配置缓存存放的目录路径。\n    cacheDir: '.cache/',\n    sourceMap: true,\n    uglifyJS: {\n      output: {\n        comments: false\n      },\n      compress: {\n        warnings: false\n      }\n    }\n  })\n]\n```\n\n打包速度和打包后的文件大小啊对比\n| 方法 | 文件大小 | 打包速度 |\n|---------------------|:---------|:---------|\n| 不用插件 | 14.6M | 32s |\n| UglifyJsPlugin | 12.9M | 33s |\n| ParallelUglifyPlugi | 7.98M | 17s |\n\n### 提取公共代码\n\n- 相同资源重复被加载，浪费用户流量，增加服务器成本。\n- 每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。\n\nwebpack3 使用 CommonsChunkPlugin 的实现：\n\n```javascript\nplugins: [\n  new webpack.optimize.CommonsChunkPlugin({\n    name: 'vendor',\n    minChunks: function (module, count) {\n      console.log(module.resource, `引用次数${count}`)\n      //\"有正在处理文件\" + \"这个文件是 .js 后缀\" + \"这个文件是在 node_modules 中\"\n      return (\n        module.resource &&\n        /\\.js$/.test(module.resource) &&\n        module.resource.indexOf(path.join(__dirname, './node_modules')) === 0\n      )\n    }\n  }),\n  new webpack.optimize.CommonsChunkPlugin({\n    name: 'common',\n    chunks: 'initial',\n    minChunks: 2\n  })\n]\n```\n\n#### webpack4 使用 splitChunks 的实现：\n\n```javascript\nmodule.exports = {\n  optimization: {\n    splitChunks: {\n       chunks: 'all',\n      ccacheGroups: {\n        vendors: {\n          name: 'chunk-vendors',\n          test: /[\\\\/]node_modules[\\\\/]/,\n          priority: 10,\n          chunks: 'initial'\n        },\n        iview: {\n          name: 'chunk-iview',\n          priority: 20,\n          test: /[\\\\/]node_modules[\\\\/]_?iview(.*)/\n        },\n        echarts: {\n          name: 'chunk-echarts',\n          priority: 20,\n          test: /[\\\\/]node_modules[\\\\/]_?echarts(.*)/\n        },\n        commons: {\n          name: 'chunk-commons',\n          minChunks: 2,\n          priority: 5,\n          chunks: 'initial',\n          reuseExistingChunk: true\n        }\n      }\n    }\n  }\n}\n```\n\n### CDN 优化\n\nCDN 又叫内容分发网络，通过把资源部署到世界各地，用户在访问时按照就近原则从离用户最近的服务器获取资源，从而加速资源的获取速度。\n\n- 随着项目越做越大，依赖的第三方 npm 包越来越多，构建之后的文件也会越来越大。\n- 再加上又是单页应用，这就会导致在网速较慢或者服务器带宽有限的情况出现长时间的白屏。\n\n1、将 vue、vue-router、vuex、element-ui 和 axios 这五个库，全部改为通过 CDN 链接获取，在 index.html 里插入 相应链接。\n\n```html\n<head>\n  <link\n    rel=\"stylesheet\"\n    href=\"https://cdn.bootcss.com/element-ui/2.0.7/theme-chalk/index.css\"\n  />\n</head>\n<body>\n  <div id=\"app\"></div>\n  <script src=\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"></script>\n  <script src=\"https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js\"></script>\n  <script src=\"https://cdn.bootcss.com/vuex/3.1.0/vuex.min.js\"></script>\n  <script src=\"https://cdn.bootcss.com/vue-router/3.0.2/vue-router.min.js\"></script>\n  <script src=\"https://cdn.bootcss.com/element-ui/2.6.1/index.js\"></script>\n  <!-- built files will be auto injected -->\n</body>\n```\n\n**问题**：开发环境也接入 vue.min.js 的 cdn 时无法使用 chrome 的 Vue.js devtools 插件，所以要分环境加载不同的资源。\n\n2、在 webpack.config.js 配置文件\n\n```javascript\nmodule.exports = {\n ···\n    externals: {\n      'vue': 'Vue',\n      'vuex': 'Vuex',\n      'vue-router': 'VueRouter',\n      'element-ui': 'ELEMENT',\n      'Axios':'axios'\n    }\n  },\n```\n\n3、卸载依赖的 npm 包，npm uninstall axios element-ui vue vue-router vuex\n\n4、修改 main.js 文件里之前的引包方式\n\n```javascript\n// import Vue from 'vue'\n// import ElementUI from 'element-ui'\n// import 'element-ui/lib/theme-chalk/index.css'\n// import VueRouter from 'vue-router'\n\nimport App from './App.vue'\nimport routes from './router'\nimport utils from './utils/Utils'\n\nVue.use(ELEMENT)\nVue.use(VueRouter)\n\nconst router = new VueRouter({\n  mode: 'hash', //路由的模式\n  routes\n})\n\nnew Vue({\n  router,\n  el: '#app',\n  render: (h) => h(App)\n})\n```\n\n### 使用 HappyPack 多进程解析和处理文件\n\n- 由于运行在 Node.js 之上的 Webpack 是单线程模型的，所以 Webpack 需要处理的事情需要一件一件的做，不能多件事一起做。\n- HappyPack 就能让 Webpack 把任务分解给多个子进程去并发的执行，子进程处理完后再把结果发送给主进程。\n- HappyPack 对 file-loader、url-loader 支持的不友好，所以不建议对该 loader 使用。\n\n使用方法如下：\n\n1. HappyPack 插件安装： npm i -D happypack\n2. webpack.base.conf.js 文件对 module.rules 进行配置\n\n```javascript\nmodule: {\n  rules: [\n    {\n      test: /\\.js$/,\n      use: ['happypack/loader?id=babel'],\n      include: [resolve('src'), resolve('test')],\n      exclude: path.resolve(__dirname, 'node_modules')\n    },\n    {\n      test: /\\.vue$/,\n      use: ['happypack/loader?id=vue']\n    }\n  ]\n}\n```\n\n3. 在生产环境 webpack.prod.conf.js 文件进行配置\n\n```javascript\nconst HappyPack = require('happypack')\n// 构造出共享进程池，在进程池中包含5个子进程\nconst HappyPackThreadPool = HappyPack.ThreadPool({ size: 5 })\nplugins: [\n  new HappyPack({\n    // 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件\n    id: 'babel',\n    // 如何处理.js文件，用法和Loader配置中一样\n    loaders: ['babel-loader?cacheDirectory'],\n    threadPool: HappyPackThreadPool\n  }),\n  new HappyPack({\n    id: 'vue', // 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件\n    loaders: [\n      {\n        loader: 'vue-loader',\n        options: vueLoaderConfig\n      }\n    ],\n    threadPool: HappyPackThreadPool\n  })\n]\n```\n\n### 使用 DLLPlugin 提高打包编译速度\n\n[DLLPlugin](https://webpack.docschina.org/plugins/dll-plugin/) 代码一般简单区分为业务代码和第三方库。如果不做处理，每次构建时都需要把所有的代码重新构建一次，耗费大量的时间，在大部分情况下，很多第三方库的代码不会变更（除非是版本升级），这时就可以使用到 dll：将复用性较高的第三方模块打包到动态链接库中，再不升级这些库的情况下，动态库不需要重新打包，每次构建只需要重新打包业务代码。\n\nDllPlugin 是 webpack 内置的插件，不需要额外安装，直接配置 webpack.dll.config.js 文件，Webpack 已经内置了对动态链接库的支持，需要通过 2 个内置的插件接入，它们分别是：\n\nDllPlugin 插件：用于打包出一个个单独的动态链接库文件。\nDllReferencePlugin 插件：用于在主要配置文件中去引入 DllPlugin 插件打包好的动态链接库文件。\n\n相关链接：\n\n- [webpack 使用-详解 DllPlugin](https://segmentfault.com/a/1190000016567986)\n- [webpack 编译速度提升之 DllPlugin](https://juejin.cn/post/6844903635072057358)\n- [4-2 使用 DllPlugin](http://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-2%E4%BD%BF%E7%94%A8DllPlugin.html)\n\n### tree shaking\n\n通过 tree-shaking，将没有使用的模块摇掉，这样来达到删除无用代码的目的。\n思路： 基于 ES6 提供的模块系统对代码进行静态分析,并将代码中的死代码（dead code）移除的一种技术。因此，利用 Tree Shaking 技术可以很方便地实现我们代码上的优化，减少代码体积。\n\n摇树删除代码的原理：\nwebpack 基于 ES6 提供的模块系统，对代码的依赖树进行静态分析，把 import & export 标记为 3 类：\n\n- 所有 import 标记为/_ harmony import _/\n- 被使用过的 export 标记为/harmony export([type])/，其中[type]和 webpack 内部有关，可能是 binding，immutable 等；\n- 没有被使用的 export 标记为/_ unused harmony export [FuncName] _/，其中[FuncName]为 export 的方法名，之后使用 Uglifyjs（或者其他类似的工具）进行代码精简，把没用的都删除。\n\n为何基于 es6 模块实现（ES6 module 特点：）：\n\n- 只能作为模块顶层的语句出现\n- import 的模块名只能是字符串常量\n- import binding 是 immutable 的\n\n条件：\n\n1. 首先源码必须遵循 ES6 的模块规范 (import & export)，如果是 CommonJS 规范 (require) 则无法使用。\n2. 编写的模块代码不能有副作用，如果在代码内部改变了外部的变量则不会被移除。\n\n配置方法：\n在 package.json 里添加一个属性：\n\n```javascript\n{\n    // sideEffects如果设为false，webpack就会认为所有没用到的函数都是没副作用的，即删了也没关系。\n    \"sideEffects\": false,\n    // 设置黑名单，用于防止误删代码\n    \"sideEffects\": [\n        // 数组里列出黑名单，禁止shaking下列代码\n        \"@babel/polly-fill\",\n        \"*.less\",\n        // 其它有副作用的模块\n        \"./src/some-side-effectful-file.js\"\n    ],\n}\n```\n\ntree-shaking 摇掉代码中未使用的代码 在生产模式下自动开启\n\ntree-shaking 并不是 webpack 中的某一个配置选项，是一组功能搭配使用后的优化效果，会在生产模式下自动启动\n\n```javascript\n// 在开发模式下，设置 usedExports: true ，打包时只会标记出哪些模块没有被使用，不会删除，因为可能会影响 source-map的标记位置的准确性。\n{\n    mode: 'develpoment',\n    optimization: {\n        // 优化导出的模块\n        usedExports: true\n    },\n}\n// 在生产模式下默认开启 usedExports: true ，打包压缩时就会将没用到的代码移除\n{\n    mode: 'production',\n    //  这个属性的作用就是集中配置webpack内部的优化功能\n    optimizition: {\n        // 只导出外部使用的模块成员 负责标记枯树叶\n        usedExports: true,\n        minimize: true, // 自动压缩代码 负责摇掉枯树叶\n        /**\n         * webpack打包默认会将一个模块单独打包到一个闭包中\n         * webpack3中新增的API 将所有模块都放在一个函数中 ，尽可能将所有模块合并在一起，\n         * 提升效率，减少体积  达到作用域提升的效果\n         */\n        concatenateModules: true,\n    },\n\n}\n```\n\n使用摇树的注意事项：\n\n- 使用 ES6 模块语法编写代码\n- 工具类函数尽量以单独的形式输出，不要集中成一个对象或者类\n- 声明 sideEffects\n- 自己在重构代码时也要注意副作用\n\ntree-shaking & babel 使用 babel-loader 处理 js 代码会导致 tree-shaking 失效的原因：\ntreeshaking 使用的前提必须是 ES module 组织的代码，也就是说交给 ESMOdule 处理的代码必须是 ESM。当我们使用 babel-loader 处理 js 代码之后就有可能将 ESM 转换 成 commonjs 规范（preset-env 插件工作的时候就会将 esm => coommonjs）\n\n解决办法：\n收到配置 preset-env 的 modules： false,确保不会开启自动转换的插件(在最新版本的 babel-loader 中自动帮我们关闭了转换成 commonjs 规范的功能)\n\n```javascripts\npresets: [\n    ['@babel/preset-env', {module: 'commonjs'}]\n]\n```\n\n## 总结\n\n1. 比较实用的方法: 按需加载，优化 loader 配置，关闭生产环境的 sourceMap，CDN 优化。\n2. vue-cli 已做的优化： 代码压缩，提取公共代码，再优化空间不大。\n3. 根据项目实际需要和自身开发水平选择优化方法，必须避免因为优化产生 bug。\n","source":"_posts/webpack打包优化.md","raw":"---\ntitle: webpack打包优化\ndate: 2019-07-22 15:37:14\ncategories: webpack\ntags:\n---\n\nwebpack 的使用及优化\n\n我们的目的\n\n- 减小打包后的文件大小\n- 首页按需引入文件\n- 优化 webpack 打包时间\n\n<!--more-->\n\n## 新建项目\n\n新建一个空文件夹，用于创建项目，使用 npm init 命令创建一个 package.json 文件。  \n输入这个命令后，终端会问你一系列诸如项目名称，项目描述，作者等信息，也可以使用 npm init -y 这个命令来一次生成 package.json 文件，这样终端不会询问你问题。\n\n## 安装 webpack\n\n安装 webapck 时把 webpack-cli 也装上是因为在 webpack4.x 版本后 webpack 模块把一些功能分到了 webpack-cli 模块，所以两者都需要安装，安装方法如下：\n\n```javascript\nnpm install webpack webpack-cli --global    //这是安装全局webpack及webpack-cli模块\nnpm install webpack webpack-cli --save-dev  //这是安装本地项目模块\n```\n\n## 新建文件\n\n在根目录件夹中新建两个文件夹，分别为 src 文件夹和 dist 文件夹，接下来再创建三个文件:此时，项目结构如下\n\n- index.html --放在 dist 文件夹中；\n- hello.js --放在 src 文件夹中；\n- index.js --放在 src 文件夹中；\n\n### index.html 中写下 html 代码，它的作用是为了引入我们打包后的 js 文件：\n\n```html\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <title>Webpack Project</title>\n  </head>\n  <body>\n    <div id=\"root\"></div>\n    <script src=\"bundle.js\"></script>\n    <!--这是打包之后的js文件，我们暂时命名为bundle.js-->\n  </body>\n</html>\n```\n\n### 在 hello.js 中导出一个模块：\n\n```js\n// hello.js\nmodule.exports = function () {\n  let hello = document.createElement('div')\n  hello.innerHTML = 'welcome to China!'\n  return hello\n}\n```\n\n### 在 index.js 中引入这个模块（hello.js）:\n\n```js\n//index.js\nconst hello = require('./hello.js')\ndocument.querySelector('#root').appendChild(hello())\n```\n\n上述操作就相当于我们把 hello.js 模块合并到了 index.js 模块，之后我们打包时就只需把 index.js 模块打包成 bundle.js 即可。\n\n### 进行最简单的 webpack 打包\n\n```javascript\n// 在终端中使用如下命令进行打包：\nwebpack src/index.js --output dist/bundle.js\n```\n\n上述就相当于把 src 文件夹下的 index.js 文件打包到 dist 文件下的 bundle.js，这时就生成了 bundle.js 供 index.html 文件引用。现在打开 index.html 就可以看到我们的页面了。\n\n## 配置 webpack.config.js\n\n上述打包方式太 low 了，我们可以在当前项目的根目录下新建一个配置文件 webpack.config.js 用来配置打包方式。\nwebpack.config.js 配置如下\n\n```js\nconst path = require('path') // 处理绝对路径\nmodule.exports = {\n  entry: path.join(__dirname, '/src/index.js'), // 入口文件\n  output: {\n    path: path.join(__dirname, '/dist'), //打包后的文件存放的地方\n    filename: 'bundle.js' //打包后输出文件的文件名\n  }\n}\n```\n\n有了这个配置文件，我们只需在终端中运行 webpack 命令就可进行打包，这条命令会自动引用 webpack.config.js 文件中的配置选项。\n\n## 构建本地服务器\n\n现在我们是通过打开本地文件来查看页面的，感觉还是有点 low。例如 vue, react 等脚手架都是在本地服务器运行的。所以我们再做进一步优化。\n\n### webpack-dev-server 配置本地服务器\n\nWebpack 提供了一个可选的本地开发服务器，这个本地服务器基于 node.js 构建，它是一个单独的组件，在 webpack 中进行配置之前需要单独安装它作为项目依赖：npm i webpack-dev-server -D\n\n以下是 devServer 的一些配置选项:\n\n- contentBase ：设置服务器所读取文件的目录，当前我们设置为\"./dist\"\n- port ：设置端口号，如果省略，默认为 8080\n- inline ：设置为 true，当源文件改变时会自动刷新页面\n- historyApiFallback ：设置为 true，所有的跳转将指向 index.html\n\n现在我们把这些配置加到 webpack.config.js 文件上，如下：\n\n```js\n// webpack.config.js\nconst path = require('path')\nmodule.exports = {\n  entry: path.join(__dirname, '/src/index.js'), // 入口文件\n  output: {\n    path: path.join(__dirname, '/dist'), //打包后的文件存放的地方\n    filename: 'bundle.js' //打包后输出文件的文件名\n  },\n  devServer: {\n    contentBase: './dist', // 本地服务器所加载文件的目录\n    port: '8088', // 设置端口号为8088\n    inline: true, // 文件修改后实时刷新\n    historyApiFallback: true //不跳转\n  }\n}\n```\n\n### package.json 文件中添加启动和打包命令\n\npackage.json 文件修改如下\n\n```javascript\n{\n  \"name\": \"webpack-project\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"build\": \"webpack\",\n    \"dev\": \"webpack-dev-server --open\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"webpack\": \"^4.23.1\",\n    \"webpack-cli\": \"^3.1.2\",\n    \"webpack-dev-server\": \"^3.1.10\"\n  }\n}\n```\n\n这样我们就可以用以下命令进行本地运行或者打包文件了\n\n- npm run dev 启动本地服务器，webpack-dev-server 就是启动服务器的命令，--open 是用于启动完服务器后自动打开浏览器。\n- npm run build 执行打包命令\n\n此时，我们只要输入 npm run dev 就可以在 http://localhost:8088/中查看页面了。\n\n## 配置常用 loader\n\nloader 可以让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。\n\nLoaders 的配置包括以下几方面：\n\n- test：一个用以匹配 loaders 所处理文件的拓展名的正则表达式（必须）\n- loader：loader 的名称（必须）\n- include/exclude：手动添加必须处理的文件（文件夹）或屏蔽不需要处理的文件（文件夹）（可选）；\n- options：为 loaders 提供额外的设置选项（可选）\n\n### 配置 css-loader 和 sass-loader\n\n如果我们要加载一个 css 文件，需要安装配置 style-loader 和 css-loader。  \n如果我们要使用 sass，就要配置 sass-loader 和 node-sass。\n\n- css-loader：加载.css 文件\n- style-loader：使用 style 标签将 css-loader 内部样式注入到我们的 HTML 页面\n\n```javascript\nconst path = require('path')\nmodule.exports = {\n  entry: path.join(__dirname, '/src/index.js'), // 入口文件\n  output: {\n    path: path.join(__dirname, '/dist'), //打包后的文件存放的地方\n    filename: 'bundle.js' //打包后输出文件的文件名\n  },\n  devServer: {\n    contentBase: './dist', // 本地服务器所加载文件的目录\n    port: '8088', // 设置端口号为8088\n    inline: true, // 文件修改后实时刷新\n    historyApiFallback: true //不跳转\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // 正则匹配以.css结尾的文件\n        use: ['style-loader', 'css-loader']\n      {\n        test: /\\.(scss|sass)$/, // 正则匹配以.scss和.sass结尾的文件\n        use: ['style-loader', 'css-loader', 'sass-loader']\n      }\n    ]\n  }\n}\n```\n\n#### css 压缩\n\ncss 代码也可以像 Javascript 那样被压缩，以达到提升加速度和代码混淆的作用。目前比较成熟可靠的 CSS 压缩工具是 cssnano，基于 postcss。\n\ncssnano 能理解 CSS 代码的含义，而不仅仅是删除空格，例如：\n\n- margin:10px 20px 10px 20px 被压缩成 margin：10px 20px\n- color：#ff0000 被压缩成 color:red\n\n通常压缩率能达到 60%，cssnano 介入到 webpack 中很简单，因为 css-loader 已经内置了，只需要开启 css-loader 的 minimize 选项，相关配置如下：\n\n```javascript\nconst path = require('path')\nconst { WebPlugin } = require('web-webpack-plugin')\nconst ExtractTextPlugin = require('extract-text-webpack-plugin')\n\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // 增加对 CSS 文件的支持\n        // 提取出 Chunk 中的 CSS 代码到单独的文件中\n        use: ExtractTextPlugin.extract({\n          // 通过 minimize 选项压缩 CSS 代码\n          use: ['css-loader?minimize']\n        })\n      }\n    ]\n  },\n  plugins: [\n    // 用 WebPlugin 生成对应的 HTML 文件\n    new WebPlugin({\n      template: './template.html', // HTML 模版文件所在的文件路径\n      filename: 'index.html' // 输出的 HTML 的文件名称\n    }),\n    new ExtractTextPlugin({\n      filename: `[name]_[contenthash:8].css` // 给输出的 CSS 文件名称加上 Hash 值\n    })\n  ]\n}\n```\n\n### 配置 Babel-loader\n\nBabel 其实是一个编译 JavaScript 的平台，它可以编译代码帮你达到以下目的：\n\n- 让你能使用最新的 JavaScript 代码（ES6，ES7...）；\n- 让你能使用基于 JavaScript 进行了拓展的语言，比如 React 的 JSX；\n\n```javascript\nmodule: {\n  ...\n  rules: [\n    {\n      test: /\\.js$/,\n      loader: 'babel-loader',\n      include: [resolve('src')]\n    }\n  ]\n}\n```\n\n由于 loader 对文件的转换操作很耗时，需要让尽可能少的文件被 loader 处理，可以通过 test、include、exclude 三个配置来命中 loader 要应用规则的文件。为了尽可能少的让文件被 loader 处理，可以通过 include 去命中只有哪些文件被处理\n\n### 处理图片\n\n处理图片资源时，我们常用的两种 loader 是 file-loader 或者 url-loader。\n当使用 url-loader 加载图片，图片小于上限值，则将图片转 base64 字符串，否则使用 file-loader 加载图片。\n\n```javascript\nmodule: {\n  ...\n  rules: [\n    {\n      test: /\\.(png|jpe?g|gif|svg)(\\?.*)?$/,\n      loader: 'url-loader',\n      options: {\n        limit: 10000,\n        name: utils.assetsPath('img/[name].[hash:7].[ext]')\n      }\n    }\n  ]\n}\n```\n\n### cache-loader\n\n一些性能开销较大的 loader 之前添加 cache-loader，将结果缓存在磁盘中，默认保存在 node_modueles/.cache/cache-loader 目录下。\n首先安装依赖\n\n```javascript\nnpm install cache-loader -D\n```\n\n`cache-loader `的配置要放在其他的 loader 之前，webpack 的配置如下：\n\n```javascript\nmodule.exports = {\n  //...\n\n  module: {\n    //我的项目中,babel-loader耗时比较长，所以我给它配置了`cache-loader`\n    rules: [\n      {\n        test: /\\.jsx?$/,\n        use: ['cache-loader', 'babel-loader']\n      }\n    ]\n  }\n}\n```\n\n若是只想给 babel-loader 配置 cache 的话，也可以不使用 cache-loader，给 babel-loader 增加选项 CacheDirectory。\ncacheDirectory：默认值为 false。当有设置时，指定的目录将用来缓存 loader 的执行结果。之后的 Webpack 构建，将会尝试读取缓存，来避免在每次执行时，可能产生的、高性能消耗的 Babel 重新编译过程。设置空值或者 true 的话，使用默认缓存目录：node_modules/.cache/babel-loader。开启 babel-loader 的缓存和配置 cache-loader，我比对了下，构建时间很接近。\n\n## 7、配置常用插件\n\nloader 被用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。\n\n### 7.1、自动生成 html 文件(HtmlWebpackPlugin)\n\n现在我们都是使用一开始建好的 index.html 文件，然后手动引入 bundle.js，如果以后我们引入不止一个 js 文件，那就得更改 index.html 中的 js 文件名，所以能不能自动生成 index.html 且自动引用打包后的 js 呢？  \nHtmlWebpackPlugin 插件就是用来解决这个问题的：\n\n1. 安装插件 npm i html-webpack-plugin -D\n2. 把 dist 文件夹清空\n3. 在根目录新建 index.html,内容和原来的 html 一致，只是不引入 js 文件。\n4. webpack.config.js 中我们引入了 HtmlWebpackPlugin 插件\n\n```javascript\nplugins: [\n  new HtmlWebpackPlugin({\n    filename: 'index.html',\n    template: 'index.html',\n    inject: true,\n    minify: {\n      removeComments: true,\n      collapseWhitespace: true,\n      removeAttributeQuotes: true\n    }\n  })\n]\n```\n\n此时我们使用 npm run build 进行打包，你会发现，dist 文件夹和 html 文件都会自动生成。\n\n### 7.2、清理/dist 文件夹(CleanWebpackPlugin)\n\n在每次构建前清理/dist 文件夹，生产最新的打包文件，这时候就用到 CleanWebpackPlugin 插件了。\n\n1. 安装 npm i clean-webpack-plugin -D\n2. 配置 webpack.config.js\n\n```javascript\nplugins: [\n  new HtmlWebpackPlugin({\n    filename: 'index.html',\n    template: 'index.html',\n    inject: true,\n    minify: {\n      removeComments: true,\n      collapseWhitespace: true,\n      removeAttributeQuotes: true\n    }\n  }),\n  new CleanWebpackPlugin(['dist'])\n]\n```\n\n### 7.3、热更新(HotModuleReplacementPlugin)\n\n我们要在修改代码后自动更新页面，这就需要 HotModuleReplacementPlugin（HMR）插件\n\n1. devServer 配置项中添加 hot: true 参数。\n2. 因为 HotModuleReplacementPlugin 是 webpack 模块自带的，所以引入 webpack 后，在 plugins 配置项中直接使用即可。\n\n```javascript\nplugins: [\n  new HtmlWebpackPlugin({\n    filename: 'index.html',\n    template: 'index.html',\n    inject: true,\n    minify: {\n      removeComments: true,\n      collapseWhitespace: true,\n      removeAttributeQuotes: true\n    }\n  }),\n  new CleanWebpackPlugin(['dist'])\n  new webpack.HotModuleReplacementPlugin()\n]\n```\n\n### 7.4、增加 css 前缀\n\n平时我们写 css 时，一些属性需要手动加上前缀，比如-webkit-border-radius: 10px;，在 webpack 中我们可以让他自动加上\n\n1. 安装 npm i postcss-loader autoprefixer -D\n2. 在项目根目录下新建 postcss.config.js 文件\n\n```javascript\nmodule.exports = {\n  plugins: [\n    require('autoprefixer') // 引用autoprefixer模块\n  ]\n}\n```\n\n3. 修改 webpack.config.js 文件中的 css-loader 配置\n\n```javascript\nmodule.exports = {\n   ...\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // 正则匹配以.css结尾的文件\n        use: [\n          { loader: 'style-loader' }, // 这里采用的是对象配置loader的写法\n          { loader: 'css-loader' },\n          { loader: 'postcss-loader' } // 使用postcss-loader\n        ]\n      }\n       ...\n    ]\n  }\n   ...\n}\n```\n\n### 7.5、css 分离 ExtractTextPlugin\n\n将 css 成生文件，而非内联。该插件的主要是为了抽离 css 样式,防止将样式打包在 js 中引起页面样式加载错乱的现象。\n\n1. 安装 npm i extract-text-webpack-plugin@next -D\n2. 在 webpack.config.js 文件中引入并使用该插件：\n\n```javascript\nconst ExtractTextPlugin = require('extract-text-webpack-plugin') //引入分离插件\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.css$/, // 正则匹配以.css结尾的文件\n        use: ExtractTextPlugin.extract({\n          // 相当于回滚，经postcss-loader和css-loader处理过的css最终再经过style-loader处理\n          fallback: 'style-loader',\n          use: ['css-loader', 'postcss-loader']\n        })\n      }\n    ]\n  },\n  plugins: [\n    new ExtractTextPlugin('css/index.css') // 将css分离到/dist文件夹下的css文件夹中的index.css\n  ]\n}\n```\n\n此时运行 npm run build 后会发现/dist 文件夹内多出了/css 文件夹及 index.css 文件。\n\n### 7.6、消除冗余 css\n\n有时候我们 css 写得多了，可能会不自觉的写重复了一些样式，这就造成了多余的代码，以下方法可以优化\n\n1. 安装 npm i purifycss-webpack purify-css glob -D\n2. 引入 clean-webpack-plugin 及 glob 插件并使用\n\n```javascript\nconst PurifyCssWebpack = require('purifycss-webpack') // 引入PurifyCssWebpack插件\nconst glob = require('glob') // 引入glob模块,用于扫描全部html文件中所引用的css\n\nplugins: [\n  new PurifyCssWebpack({\n    paths: glob.sync(path.join(__dirname, 'src/*.html')) // 同步扫描所有html文件中所引用的css\n  })\n]\n```\n\n### 至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。\n\n#### 下面将讲述 webpack 的优化方法。以下的例子是由 vue-cli 脚手架搭建的项目，跟上述例子无关。\n\n————————————————————————————————————————————\n\n## webpack 打包优化\n\n### 为什么要优化打包？\n\n- 项目越做越大，依赖包越来越多，打包文件太大\n- 单页面应用首页白屏时间长，用户体验差\n\n### 我们的目的\n\n- 减小打包后的文件大小\n- 首页按需引入文件\n- 优化 webpack 打包时间\n\n### 按需加载\n\n1.1 路由组件按需加载\n\n```javascript\nconst router = [\n  {\n    path: '/index',\n    component: (resolve) =>\n      require.ensure([], () => resolve(require('@/components/index')))\n  },\n  {\n    path: '/about',\n    component: (resolve) =>\n      require.ensure([], () => resolve(require('@/components/about')))\n  }\n]\n```\n\n1.2 第三方组件和插件。按需加载需引入第三方组件\n\n```javascript\n// 引入全部组件\nimport ElementUI from 'element-ui'\nimport 'element-ui/lib/theme-chalk/index.css'\nVue.use(ElementUI)\n\n// 按需引入组件\nimport { Button } from 'element-ui'\nVue.component(Button.name, Button)\n```\n\n1.3 对于一些插件，如果只是在个别组件中用的到，也可以不要在 main.js 里面引入，而是在组件中按需引入\n\n```javascript\n// 在main.js引入\nimport Vue from vue\nimport Vuelidate from 'vuelidate'\nVue.use(Vuelidate)\n\n// 按组件按需引入\nimport { Vuelidate } from 'vuelidate'\n```\n\n### 优化 loader 配置\n\n- 优化正则匹配\n- 通过 cacheDirectory 选项开启缓存\n- 通过 include、exclude 来减少被处理的文件。\n\n```javascript\nmodule: {\n  rules: [\n    {\n      test: /\\.js$/,\n      loader: 'babel-loader?cacheDirectory',\n      include: [resolve('src')]\n    }\n  ]\n}\n```\n\n### 优化文件路径——省下搜索文件的时间\n\n- extension 配置之后可以不用在 require 或是 import 的时候加文件扩展名,会依次尝试添加扩展名进行匹配。\n- alias 通过配置别名可以加快 webpack 查找模块的速度。\n\n```javascript\n  resolve: {\n    extensions: ['.js', '.vue', '.json'],\n    alias: {\n      'vue$': 'vue/dist/vue.esm.js',\n      '@': resolve('src'),\n    }\n  },\n```\n\n### 生产环境关闭 sourceMap\n\n- sourceMap 本质上是一种映射关系，打包出来的 js 文件中的代码可以映射到代码文件的具体位置,这种映射关系会帮助我们直接找到在源代码中的错误。\n- 打包速度减慢，生产文件变大，所以开发环境使用 sourceMap，生产环境则关闭。\n\n### 代码压缩\n\n- UglifyJS: vue-cli 默认使用的压缩代码方式，它使用的是单线程压缩代码，打包时间较慢\n- ParallelUglifyPlugin: 开启多个子进程，把对多个文件压缩的工作分别给多个子进程去完成\n\n两种方法使用如下：\n\n```javascript\nplugins: [\n  new UglifyJsPlugin({\n    uglifyOptions: {\n      compress: {\n        warnings: false\n      }\n    },\n    sourceMap: true,\n    parallel: true\n  }),\n\n  new ParallelUglifyPlugin({\n    //缓存压缩后的结果，下次遇到一样的输入时直接从缓存中获取压缩后的结果并返回，\n    //cacheDir 用于配置缓存存放的目录路径。\n    cacheDir: '.cache/',\n    sourceMap: true,\n    uglifyJS: {\n      output: {\n        comments: false\n      },\n      compress: {\n        warnings: false\n      }\n    }\n  })\n]\n```\n\n打包速度和打包后的文件大小啊对比\n| 方法 | 文件大小 | 打包速度 |\n|---------------------|:---------|:---------|\n| 不用插件 | 14.6M | 32s |\n| UglifyJsPlugin | 12.9M | 33s |\n| ParallelUglifyPlugi | 7.98M | 17s |\n\n### 提取公共代码\n\n- 相同资源重复被加载，浪费用户流量，增加服务器成本。\n- 每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。\n\nwebpack3 使用 CommonsChunkPlugin 的实现：\n\n```javascript\nplugins: [\n  new webpack.optimize.CommonsChunkPlugin({\n    name: 'vendor',\n    minChunks: function (module, count) {\n      console.log(module.resource, `引用次数${count}`)\n      //\"有正在处理文件\" + \"这个文件是 .js 后缀\" + \"这个文件是在 node_modules 中\"\n      return (\n        module.resource &&\n        /\\.js$/.test(module.resource) &&\n        module.resource.indexOf(path.join(__dirname, './node_modules')) === 0\n      )\n    }\n  }),\n  new webpack.optimize.CommonsChunkPlugin({\n    name: 'common',\n    chunks: 'initial',\n    minChunks: 2\n  })\n]\n```\n\n#### webpack4 使用 splitChunks 的实现：\n\n```javascript\nmodule.exports = {\n  optimization: {\n    splitChunks: {\n       chunks: 'all',\n      ccacheGroups: {\n        vendors: {\n          name: 'chunk-vendors',\n          test: /[\\\\/]node_modules[\\\\/]/,\n          priority: 10,\n          chunks: 'initial'\n        },\n        iview: {\n          name: 'chunk-iview',\n          priority: 20,\n          test: /[\\\\/]node_modules[\\\\/]_?iview(.*)/\n        },\n        echarts: {\n          name: 'chunk-echarts',\n          priority: 20,\n          test: /[\\\\/]node_modules[\\\\/]_?echarts(.*)/\n        },\n        commons: {\n          name: 'chunk-commons',\n          minChunks: 2,\n          priority: 5,\n          chunks: 'initial',\n          reuseExistingChunk: true\n        }\n      }\n    }\n  }\n}\n```\n\n### CDN 优化\n\nCDN 又叫内容分发网络，通过把资源部署到世界各地，用户在访问时按照就近原则从离用户最近的服务器获取资源，从而加速资源的获取速度。\n\n- 随着项目越做越大，依赖的第三方 npm 包越来越多，构建之后的文件也会越来越大。\n- 再加上又是单页应用，这就会导致在网速较慢或者服务器带宽有限的情况出现长时间的白屏。\n\n1、将 vue、vue-router、vuex、element-ui 和 axios 这五个库，全部改为通过 CDN 链接获取，在 index.html 里插入 相应链接。\n\n```html\n<head>\n  <link\n    rel=\"stylesheet\"\n    href=\"https://cdn.bootcss.com/element-ui/2.0.7/theme-chalk/index.css\"\n  />\n</head>\n<body>\n  <div id=\"app\"></div>\n  <script src=\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"></script>\n  <script src=\"https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js\"></script>\n  <script src=\"https://cdn.bootcss.com/vuex/3.1.0/vuex.min.js\"></script>\n  <script src=\"https://cdn.bootcss.com/vue-router/3.0.2/vue-router.min.js\"></script>\n  <script src=\"https://cdn.bootcss.com/element-ui/2.6.1/index.js\"></script>\n  <!-- built files will be auto injected -->\n</body>\n```\n\n**问题**：开发环境也接入 vue.min.js 的 cdn 时无法使用 chrome 的 Vue.js devtools 插件，所以要分环境加载不同的资源。\n\n2、在 webpack.config.js 配置文件\n\n```javascript\nmodule.exports = {\n ···\n    externals: {\n      'vue': 'Vue',\n      'vuex': 'Vuex',\n      'vue-router': 'VueRouter',\n      'element-ui': 'ELEMENT',\n      'Axios':'axios'\n    }\n  },\n```\n\n3、卸载依赖的 npm 包，npm uninstall axios element-ui vue vue-router vuex\n\n4、修改 main.js 文件里之前的引包方式\n\n```javascript\n// import Vue from 'vue'\n// import ElementUI from 'element-ui'\n// import 'element-ui/lib/theme-chalk/index.css'\n// import VueRouter from 'vue-router'\n\nimport App from './App.vue'\nimport routes from './router'\nimport utils from './utils/Utils'\n\nVue.use(ELEMENT)\nVue.use(VueRouter)\n\nconst router = new VueRouter({\n  mode: 'hash', //路由的模式\n  routes\n})\n\nnew Vue({\n  router,\n  el: '#app',\n  render: (h) => h(App)\n})\n```\n\n### 使用 HappyPack 多进程解析和处理文件\n\n- 由于运行在 Node.js 之上的 Webpack 是单线程模型的，所以 Webpack 需要处理的事情需要一件一件的做，不能多件事一起做。\n- HappyPack 就能让 Webpack 把任务分解给多个子进程去并发的执行，子进程处理完后再把结果发送给主进程。\n- HappyPack 对 file-loader、url-loader 支持的不友好，所以不建议对该 loader 使用。\n\n使用方法如下：\n\n1. HappyPack 插件安装： npm i -D happypack\n2. webpack.base.conf.js 文件对 module.rules 进行配置\n\n```javascript\nmodule: {\n  rules: [\n    {\n      test: /\\.js$/,\n      use: ['happypack/loader?id=babel'],\n      include: [resolve('src'), resolve('test')],\n      exclude: path.resolve(__dirname, 'node_modules')\n    },\n    {\n      test: /\\.vue$/,\n      use: ['happypack/loader?id=vue']\n    }\n  ]\n}\n```\n\n3. 在生产环境 webpack.prod.conf.js 文件进行配置\n\n```javascript\nconst HappyPack = require('happypack')\n// 构造出共享进程池，在进程池中包含5个子进程\nconst HappyPackThreadPool = HappyPack.ThreadPool({ size: 5 })\nplugins: [\n  new HappyPack({\n    // 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件\n    id: 'babel',\n    // 如何处理.js文件，用法和Loader配置中一样\n    loaders: ['babel-loader?cacheDirectory'],\n    threadPool: HappyPackThreadPool\n  }),\n  new HappyPack({\n    id: 'vue', // 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件\n    loaders: [\n      {\n        loader: 'vue-loader',\n        options: vueLoaderConfig\n      }\n    ],\n    threadPool: HappyPackThreadPool\n  })\n]\n```\n\n### 使用 DLLPlugin 提高打包编译速度\n\n[DLLPlugin](https://webpack.docschina.org/plugins/dll-plugin/) 代码一般简单区分为业务代码和第三方库。如果不做处理，每次构建时都需要把所有的代码重新构建一次，耗费大量的时间，在大部分情况下，很多第三方库的代码不会变更（除非是版本升级），这时就可以使用到 dll：将复用性较高的第三方模块打包到动态链接库中，再不升级这些库的情况下，动态库不需要重新打包，每次构建只需要重新打包业务代码。\n\nDllPlugin 是 webpack 内置的插件，不需要额外安装，直接配置 webpack.dll.config.js 文件，Webpack 已经内置了对动态链接库的支持，需要通过 2 个内置的插件接入，它们分别是：\n\nDllPlugin 插件：用于打包出一个个单独的动态链接库文件。\nDllReferencePlugin 插件：用于在主要配置文件中去引入 DllPlugin 插件打包好的动态链接库文件。\n\n相关链接：\n\n- [webpack 使用-详解 DllPlugin](https://segmentfault.com/a/1190000016567986)\n- [webpack 编译速度提升之 DllPlugin](https://juejin.cn/post/6844903635072057358)\n- [4-2 使用 DllPlugin](http://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-2%E4%BD%BF%E7%94%A8DllPlugin.html)\n\n### tree shaking\n\n通过 tree-shaking，将没有使用的模块摇掉，这样来达到删除无用代码的目的。\n思路： 基于 ES6 提供的模块系统对代码进行静态分析,并将代码中的死代码（dead code）移除的一种技术。因此，利用 Tree Shaking 技术可以很方便地实现我们代码上的优化，减少代码体积。\n\n摇树删除代码的原理：\nwebpack 基于 ES6 提供的模块系统，对代码的依赖树进行静态分析，把 import & export 标记为 3 类：\n\n- 所有 import 标记为/_ harmony import _/\n- 被使用过的 export 标记为/harmony export([type])/，其中[type]和 webpack 内部有关，可能是 binding，immutable 等；\n- 没有被使用的 export 标记为/_ unused harmony export [FuncName] _/，其中[FuncName]为 export 的方法名，之后使用 Uglifyjs（或者其他类似的工具）进行代码精简，把没用的都删除。\n\n为何基于 es6 模块实现（ES6 module 特点：）：\n\n- 只能作为模块顶层的语句出现\n- import 的模块名只能是字符串常量\n- import binding 是 immutable 的\n\n条件：\n\n1. 首先源码必须遵循 ES6 的模块规范 (import & export)，如果是 CommonJS 规范 (require) 则无法使用。\n2. 编写的模块代码不能有副作用，如果在代码内部改变了外部的变量则不会被移除。\n\n配置方法：\n在 package.json 里添加一个属性：\n\n```javascript\n{\n    // sideEffects如果设为false，webpack就会认为所有没用到的函数都是没副作用的，即删了也没关系。\n    \"sideEffects\": false,\n    // 设置黑名单，用于防止误删代码\n    \"sideEffects\": [\n        // 数组里列出黑名单，禁止shaking下列代码\n        \"@babel/polly-fill\",\n        \"*.less\",\n        // 其它有副作用的模块\n        \"./src/some-side-effectful-file.js\"\n    ],\n}\n```\n\ntree-shaking 摇掉代码中未使用的代码 在生产模式下自动开启\n\ntree-shaking 并不是 webpack 中的某一个配置选项，是一组功能搭配使用后的优化效果，会在生产模式下自动启动\n\n```javascript\n// 在开发模式下，设置 usedExports: true ，打包时只会标记出哪些模块没有被使用，不会删除，因为可能会影响 source-map的标记位置的准确性。\n{\n    mode: 'develpoment',\n    optimization: {\n        // 优化导出的模块\n        usedExports: true\n    },\n}\n// 在生产模式下默认开启 usedExports: true ，打包压缩时就会将没用到的代码移除\n{\n    mode: 'production',\n    //  这个属性的作用就是集中配置webpack内部的优化功能\n    optimizition: {\n        // 只导出外部使用的模块成员 负责标记枯树叶\n        usedExports: true,\n        minimize: true, // 自动压缩代码 负责摇掉枯树叶\n        /**\n         * webpack打包默认会将一个模块单独打包到一个闭包中\n         * webpack3中新增的API 将所有模块都放在一个函数中 ，尽可能将所有模块合并在一起，\n         * 提升效率，减少体积  达到作用域提升的效果\n         */\n        concatenateModules: true,\n    },\n\n}\n```\n\n使用摇树的注意事项：\n\n- 使用 ES6 模块语法编写代码\n- 工具类函数尽量以单独的形式输出，不要集中成一个对象或者类\n- 声明 sideEffects\n- 自己在重构代码时也要注意副作用\n\ntree-shaking & babel 使用 babel-loader 处理 js 代码会导致 tree-shaking 失效的原因：\ntreeshaking 使用的前提必须是 ES module 组织的代码，也就是说交给 ESMOdule 处理的代码必须是 ESM。当我们使用 babel-loader 处理 js 代码之后就有可能将 ESM 转换 成 commonjs 规范（preset-env 插件工作的时候就会将 esm => coommonjs）\n\n解决办法：\n收到配置 preset-env 的 modules： false,确保不会开启自动转换的插件(在最新版本的 babel-loader 中自动帮我们关闭了转换成 commonjs 规范的功能)\n\n```javascripts\npresets: [\n    ['@babel/preset-env', {module: 'commonjs'}]\n]\n```\n\n## 总结\n\n1. 比较实用的方法: 按需加载，优化 loader 配置，关闭生产环境的 sourceMap，CDN 优化。\n2. vue-cli 已做的优化： 代码压缩，提取公共代码，再优化空间不大。\n3. 根据项目实际需要和自身开发水平选择优化方法，必须避免因为优化产生 bug。\n","slug":"webpack打包优化","published":1,"updated":"2021-04-13T12:53:02.916Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xs003gl5v001ipca9l","content":"<p>webpack 的使用及优化</p>\n<p>我们的目的</p>\n<ul>\n<li>减小打包后的文件大小</li>\n<li>首页按需引入文件</li>\n<li>优化 webpack 打包时间</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h2><p>新建一个空文件夹，用于创建项目，使用 npm init 命令创建一个 package.json 文件。<br>输入这个命令后，终端会问你一系列诸如项目名称，项目描述，作者等信息，也可以使用 npm init -y 这个命令来一次生成 package.json 文件，这样终端不会询问你问题。</p>\n<h2 id=\"安装-webpack\"><a href=\"#安装-webpack\" class=\"headerlink\" title=\"安装 webpack\"></a>安装 webpack</h2><p>安装 webapck 时把 webpack-cli 也装上是因为在 webpack4.x 版本后 webpack 模块把一些功能分到了 webpack-cli 模块，所以两者都需要安装，安装方法如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install webpack webpack-cli --<span class=\"built_in\">global</span>    <span class=\"comment\">//这是安装全局webpack及webpack-cli模块</span></span><br><span class=\"line\">npm install webpack webpack-cli --save-dev  <span class=\"comment\">//这是安装本地项目模块</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"新建文件\"><a href=\"#新建文件\" class=\"headerlink\" title=\"新建文件\"></a>新建文件</h2><p>在根目录件夹中新建两个文件夹，分别为 src 文件夹和 dist 文件夹，接下来再创建三个文件:此时，项目结构如下</p>\n<ul>\n<li>index.html –放在 dist 文件夹中；</li>\n<li>hello.js –放在 src 文件夹中；</li>\n<li>index.js –放在 src 文件夹中；</li>\n</ul>\n<h3 id=\"index-html-中写下-html-代码，它的作用是为了引入我们打包后的-js-文件：\"><a href=\"#index-html-中写下-html-代码，它的作用是为了引入我们打包后的-js-文件：\" class=\"headerlink\" title=\"index.html 中写下 html 代码，它的作用是为了引入我们打包后的 js 文件：\"></a>index.html 中写下 html 代码，它的作用是为了引入我们打包后的 js 文件：</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Webpack Project<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;root&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;bundle.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--这是打包之后的js文件，我们暂时命名为bundle.js--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在-hello-js-中导出一个模块：\"><a href=\"#在-hello-js-中导出一个模块：\" class=\"headerlink\" title=\"在 hello.js 中导出一个模块：\"></a>在 hello.js 中导出一个模块：</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// hello.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> hello = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;div&#x27;</span>)</span><br><span class=\"line\">  hello.innerHTML = <span class=\"string\">&#x27;welcome to China!&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> hello</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在-index-js-中引入这个模块（hello-js）\"><a href=\"#在-index-js-中引入这个模块（hello-js）\" class=\"headerlink\" title=\"在 index.js 中引入这个模块（hello.js）:\"></a>在 index.js 中引入这个模块（hello.js）:</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//index.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> hello = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./hello.js&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;#root&#x27;</span>).appendChild(hello())</span><br></pre></td></tr></table></figure>\n\n<p>上述操作就相当于我们把 hello.js 模块合并到了 index.js 模块，之后我们打包时就只需把 index.js 模块打包成 bundle.js 即可。</p>\n<h3 id=\"进行最简单的-webpack-打包\"><a href=\"#进行最简单的-webpack-打包\" class=\"headerlink\" title=\"进行最简单的 webpack 打包\"></a>进行最简单的 webpack 打包</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在终端中使用如下命令进行打包：</span></span><br><span class=\"line\">webpack src/index.js --output dist/bundle.js</span><br></pre></td></tr></table></figure>\n\n<p>上述就相当于把 src 文件夹下的 index.js 文件打包到 dist 文件下的 bundle.js，这时就生成了 bundle.js 供 index.html 文件引用。现在打开 index.html 就可以看到我们的页面了。</p>\n<h2 id=\"配置-webpack-config-js\"><a href=\"#配置-webpack-config-js\" class=\"headerlink\" title=\"配置 webpack.config.js\"></a>配置 webpack.config.js</h2><p>上述打包方式太 low 了，我们可以在当前项目的根目录下新建一个配置文件 webpack.config.js 用来配置打包方式。<br>webpack.config.js 配置如下</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>) <span class=\"comment\">// 处理绝对路径</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: path.join(__dirname, <span class=\"string\">&#x27;/src/index.js&#x27;</span>), <span class=\"comment\">// 入口文件</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.join(__dirname, <span class=\"string\">&#x27;/dist&#x27;</span>), <span class=\"comment\">//打包后的文件存放的地方</span></span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;bundle.js&#x27;</span> <span class=\"comment\">//打包后输出文件的文件名</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有了这个配置文件，我们只需在终端中运行 webpack 命令就可进行打包，这条命令会自动引用 webpack.config.js 文件中的配置选项。</p>\n<h2 id=\"构建本地服务器\"><a href=\"#构建本地服务器\" class=\"headerlink\" title=\"构建本地服务器\"></a>构建本地服务器</h2><p>现在我们是通过打开本地文件来查看页面的，感觉还是有点 low。例如 vue, react 等脚手架都是在本地服务器运行的。所以我们再做进一步优化。</p>\n<h3 id=\"webpack-dev-server-配置本地服务器\"><a href=\"#webpack-dev-server-配置本地服务器\" class=\"headerlink\" title=\"webpack-dev-server 配置本地服务器\"></a>webpack-dev-server 配置本地服务器</h3><p>Webpack 提供了一个可选的本地开发服务器，这个本地服务器基于 node.js 构建，它是一个单独的组件，在 webpack 中进行配置之前需要单独安装它作为项目依赖：npm i webpack-dev-server -D</p>\n<p>以下是 devServer 的一些配置选项:</p>\n<ul>\n<li>contentBase ：设置服务器所读取文件的目录，当前我们设置为”./dist”</li>\n<li>port ：设置端口号，如果省略，默认为 8080</li>\n<li>inline ：设置为 true，当源文件改变时会自动刷新页面</li>\n<li>historyApiFallback ：设置为 true，所有的跳转将指向 index.html</li>\n</ul>\n<p>现在我们把这些配置加到 webpack.config.js 文件上，如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// webpack.config.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: path.join(__dirname, <span class=\"string\">&#x27;/src/index.js&#x27;</span>), <span class=\"comment\">// 入口文件</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.join(__dirname, <span class=\"string\">&#x27;/dist&#x27;</span>), <span class=\"comment\">//打包后的文件存放的地方</span></span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;bundle.js&#x27;</span> <span class=\"comment\">//打包后输出文件的文件名</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    contentBase: <span class=\"string\">&#x27;./dist&#x27;</span>, <span class=\"comment\">// 本地服务器所加载文件的目录</span></span><br><span class=\"line\">    port: <span class=\"string\">&#x27;8088&#x27;</span>, <span class=\"comment\">// 设置端口号为8088</span></span><br><span class=\"line\">    inline: <span class=\"literal\">true</span>, <span class=\"comment\">// 文件修改后实时刷新</span></span><br><span class=\"line\">    historyApiFallback: <span class=\"literal\">true</span> <span class=\"comment\">//不跳转</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"package-json-文件中添加启动和打包命令\"><a href=\"#package-json-文件中添加启动和打包命令\" class=\"headerlink\" title=\"package.json 文件中添加启动和打包命令\"></a>package.json 文件中添加启动和打包命令</h3><p>package.json 文件修改如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;webpack-project&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span>: <span class=\"string\">&quot;1.0.0&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;description&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;main&quot;</span>: <span class=\"string\">&quot;index.js&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;scripts&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;build&quot;</span>: <span class=\"string\">&quot;webpack&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;dev&quot;</span>: <span class=\"string\">&quot;webpack-dev-server --open&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;keywords&quot;</span>: [],</span><br><span class=\"line\">  <span class=\"string\">&quot;author&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;license&quot;</span>: <span class=\"string\">&quot;ISC&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;devDependencies&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;webpack&quot;</span>: <span class=\"string\">&quot;^4.23.1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;webpack-cli&quot;</span>: <span class=\"string\">&quot;^3.1.2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;webpack-dev-server&quot;</span>: <span class=\"string\">&quot;^3.1.10&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样我们就可以用以下命令进行本地运行或者打包文件了</p>\n<ul>\n<li>npm run dev 启动本地服务器，webpack-dev-server 就是启动服务器的命令，–open 是用于启动完服务器后自动打开浏览器。</li>\n<li>npm run build 执行打包命令</li>\n</ul>\n<p>此时，我们只要输入 npm run dev 就可以在 <a href=\"http://localhost:8088/%E4%B8%AD%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E4%BA%86%E3%80%82\">http://localhost:8088/中查看页面了。</a></p>\n<h2 id=\"配置常用-loader\"><a href=\"#配置常用-loader\" class=\"headerlink\" title=\"配置常用 loader\"></a>配置常用 loader</h2><p>loader 可以让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。</p>\n<p>Loaders 的配置包括以下几方面：</p>\n<ul>\n<li>test：一个用以匹配 loaders 所处理文件的拓展名的正则表达式（必须）</li>\n<li>loader：loader 的名称（必须）</li>\n<li>include/exclude：手动添加必须处理的文件（文件夹）或屏蔽不需要处理的文件（文件夹）（可选）；</li>\n<li>options：为 loaders 提供额外的设置选项（可选）</li>\n</ul>\n<h3 id=\"配置-css-loader-和-sass-loader\"><a href=\"#配置-css-loader-和-sass-loader\" class=\"headerlink\" title=\"配置 css-loader 和 sass-loader\"></a>配置 css-loader 和 sass-loader</h3><p>如果我们要加载一个 css 文件，需要安装配置 style-loader 和 css-loader。<br>如果我们要使用 sass，就要配置 sass-loader 和 node-sass。</p>\n<ul>\n<li>css-loader：加载.css 文件</li>\n<li>style-loader：使用 style 标签将 css-loader 内部样式注入到我们的 HTML 页面</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: path.join(__dirname, <span class=\"string\">&#x27;/src/index.js&#x27;</span>), <span class=\"comment\">// 入口文件</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.join(__dirname, <span class=\"string\">&#x27;/dist&#x27;</span>), <span class=\"comment\">//打包后的文件存放的地方</span></span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;bundle.js&#x27;</span> <span class=\"comment\">//打包后输出文件的文件名</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    contentBase: <span class=\"string\">&#x27;./dist&#x27;</span>, <span class=\"comment\">// 本地服务器所加载文件的目录</span></span><br><span class=\"line\">    port: <span class=\"string\">&#x27;8088&#x27;</span>, <span class=\"comment\">// 设置端口号为8088</span></span><br><span class=\"line\">    inline: <span class=\"literal\">true</span>, <span class=\"comment\">// 文件修改后实时刷新</span></span><br><span class=\"line\">    historyApiFallback: <span class=\"literal\">true</span> <span class=\"comment\">//不跳转</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>, <span class=\"comment\">// 正则匹配以.css结尾的文件</span></span><br><span class=\"line\">        use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>]</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.(scss|sass)$/</span>, <span class=\"comment\">// 正则匹配以.scss和.sass结尾的文件</span></span><br><span class=\"line\">        use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>, <span class=\"string\">&#x27;sass-loader&#x27;</span>]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"css-压缩\"><a href=\"#css-压缩\" class=\"headerlink\" title=\"css 压缩\"></a>css 压缩</h4><p>css 代码也可以像 Javascript 那样被压缩，以达到提升加速度和代码混淆的作用。目前比较成熟可靠的 CSS 压缩工具是 cssnano，基于 postcss。</p>\n<p>cssnano 能理解 CSS 代码的含义，而不仅仅是删除空格，例如：</p>\n<ul>\n<li>margin:10px 20px 10px 20px 被压缩成 margin：10px 20px</li>\n<li>color：#ff0000 被压缩成 color:red</li>\n</ul>\n<p>通常压缩率能达到 60%，cssnano 介入到 webpack 中很简单，因为 css-loader 已经内置了，只需要开启 css-loader 的 minimize 选项，相关配置如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; WebPlugin &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;web-webpack-plugin&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;extract-text-webpack-plugin&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>, <span class=\"comment\">// 增加对 CSS 文件的支持</span></span><br><span class=\"line\">        <span class=\"comment\">// 提取出 Chunk 中的 CSS 代码到单独的文件中</span></span><br><span class=\"line\">        use: ExtractTextPlugin.extract(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 通过 minimize 选项压缩 CSS 代码</span></span><br><span class=\"line\">          use: [<span class=\"string\">&#x27;css-loader?minimize&#x27;</span>]</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// 用 WebPlugin 生成对应的 HTML 文件</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> WebPlugin(&#123;</span><br><span class=\"line\">      template: <span class=\"string\">&#x27;./template.html&#x27;</span>, <span class=\"comment\">// HTML 模版文件所在的文件路径</span></span><br><span class=\"line\">      filename: <span class=\"string\">&#x27;index.html&#x27;</span> <span class=\"comment\">// 输出的 HTML 的文件名称</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">`[name]_[contenthash:8].css`</span> <span class=\"comment\">// 给输出的 CSS 文件名称加上 Hash 值</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-Babel-loader\"><a href=\"#配置-Babel-loader\" class=\"headerlink\" title=\"配置 Babel-loader\"></a>配置 Babel-loader</h3><p>Babel 其实是一个编译 JavaScript 的平台，它可以编译代码帮你达到以下目的：</p>\n<ul>\n<li>让你能使用最新的 JavaScript 代码（ES6，ES7…）；</li>\n<li>让你能使用基于 JavaScript 进行了拓展的语言，比如 React 的 JSX；</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">      loader: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">      include: [resolve(<span class=\"string\">&#x27;src&#x27;</span>)]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>由于 loader 对文件的转换操作很耗时，需要让尽可能少的文件被 loader 处理，可以通过 test、include、exclude 三个配置来命中 loader 要应用规则的文件。为了尽可能少的让文件被 loader 处理，可以通过 include 去命中只有哪些文件被处理</p>\n<h3 id=\"处理图片\"><a href=\"#处理图片\" class=\"headerlink\" title=\"处理图片\"></a>处理图片</h3><p>处理图片资源时，我们常用的两种 loader 是 file-loader 或者 url-loader。<br>当使用 url-loader 加载图片，图片小于上限值，则将图片转 base64 字符串，否则使用 file-loader 加载图片。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.(png|jpe?g|gif|svg)(\\?.*)?$/</span>,</span><br><span class=\"line\">      loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">      options: &#123;</span><br><span class=\"line\">        limit: <span class=\"number\">10000</span>,</span><br><span class=\"line\">        name: utils.assetsPath(<span class=\"string\">&#x27;img/[name].[hash:7].[ext]&#x27;</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"cache-loader\"><a href=\"#cache-loader\" class=\"headerlink\" title=\"cache-loader\"></a>cache-loader</h3><p>一些性能开销较大的 loader 之前添加 cache-loader，将结果缓存在磁盘中，默认保存在 node_modueles/.cache/cache-loader 目录下。<br>首先安装依赖</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install cache-loader -D</span><br></pre></td></tr></table></figure>\n\n<p><code>cache-loader </code>的配置要放在其他的 loader 之前，webpack 的配置如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">//我的项目中,babel-loader耗时比较长，所以我给它配置了`cache-loader`</span></span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.jsx?$/</span>,</span><br><span class=\"line\">        use: [<span class=\"string\">&#x27;cache-loader&#x27;</span>, <span class=\"string\">&#x27;babel-loader&#x27;</span>]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>若是只想给 babel-loader 配置 cache 的话，也可以不使用 cache-loader，给 babel-loader 增加选项 CacheDirectory。<br>cacheDirectory：默认值为 false。当有设置时，指定的目录将用来缓存 loader 的执行结果。之后的 Webpack 构建，将会尝试读取缓存，来避免在每次执行时，可能产生的、高性能消耗的 Babel 重新编译过程。设置空值或者 true 的话，使用默认缓存目录：node_modules/.cache/babel-loader。开启 babel-loader 的缓存和配置 cache-loader，我比对了下，构建时间很接近。</p>\n<h2 id=\"7、配置常用插件\"><a href=\"#7、配置常用插件\" class=\"headerlink\" title=\"7、配置常用插件\"></a>7、配置常用插件</h2><p>loader 被用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。</p>\n<h3 id=\"7-1、自动生成-html-文件-HtmlWebpackPlugin\"><a href=\"#7-1、自动生成-html-文件-HtmlWebpackPlugin\" class=\"headerlink\" title=\"7.1、自动生成 html 文件(HtmlWebpackPlugin)\"></a>7.1、自动生成 html 文件(HtmlWebpackPlugin)</h3><p>现在我们都是使用一开始建好的 index.html 文件，然后手动引入 bundle.js，如果以后我们引入不止一个 js 文件，那就得更改 index.html 中的 js 文件名，所以能不能自动生成 index.html 且自动引用打包后的 js 呢？<br>HtmlWebpackPlugin 插件就是用来解决这个问题的：</p>\n<ol>\n<li>安装插件 npm i html-webpack-plugin -D</li>\n<li>把 dist 文件夹清空</li>\n<li>在根目录新建 index.html,内容和原来的 html 一致，只是不引入 js 文件。</li>\n<li>webpack.config.js 中我们引入了 HtmlWebpackPlugin 插件</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    template: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    inject: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    minify: &#123;</span><br><span class=\"line\">      removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      collapseWhitespace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      removeAttributeQuotes: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>此时我们使用 npm run build 进行打包，你会发现，dist 文件夹和 html 文件都会自动生成。</p>\n<h3 id=\"7-2、清理-dist-文件夹-CleanWebpackPlugin\"><a href=\"#7-2、清理-dist-文件夹-CleanWebpackPlugin\" class=\"headerlink\" title=\"7.2、清理/dist 文件夹(CleanWebpackPlugin)\"></a>7.2、清理/dist 文件夹(CleanWebpackPlugin)</h3><p>在每次构建前清理/dist 文件夹，生产最新的打包文件，这时候就用到 CleanWebpackPlugin 插件了。</p>\n<ol>\n<li>安装 npm i clean-webpack-plugin -D</li>\n<li>配置 webpack.config.js</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    template: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    inject: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    minify: &#123;</span><br><span class=\"line\">      removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      collapseWhitespace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      removeAttributeQuotes: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">new</span> CleanWebpackPlugin([<span class=\"string\">&#x27;dist&#x27;</span>])</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-3、热更新-HotModuleReplacementPlugin\"><a href=\"#7-3、热更新-HotModuleReplacementPlugin\" class=\"headerlink\" title=\"7.3、热更新(HotModuleReplacementPlugin)\"></a>7.3、热更新(HotModuleReplacementPlugin)</h3><p>我们要在修改代码后自动更新页面，这就需要 HotModuleReplacementPlugin（HMR）插件</p>\n<ol>\n<li>devServer 配置项中添加 hot: true 参数。</li>\n<li>因为 HotModuleReplacementPlugin 是 webpack 模块自带的，所以引入 webpack 后，在 plugins 配置项中直接使用即可。</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    template: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    inject: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    minify: &#123;</span><br><span class=\"line\">      removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      collapseWhitespace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      removeAttributeQuotes: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">new</span> CleanWebpackPlugin([<span class=\"string\">&#x27;dist&#x27;</span>])</span><br><span class=\"line\">  <span class=\"keyword\">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-4、增加-css-前缀\"><a href=\"#7-4、增加-css-前缀\" class=\"headerlink\" title=\"7.4、增加 css 前缀\"></a>7.4、增加 css 前缀</h3><p>平时我们写 css 时，一些属性需要手动加上前缀，比如-webkit-border-radius: 10px;，在 webpack 中我们可以让他自动加上</p>\n<ol>\n<li>安装 npm i postcss-loader autoprefixer -D</li>\n<li>在项目根目录下新建 postcss.config.js 文件</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;autoprefixer&#x27;</span>) <span class=\"comment\">// 引用autoprefixer模块</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>修改 webpack.config.js 文件中的 css-loader 配置</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>, <span class=\"comment\">// 正则匹配以.css结尾的文件</span></span><br><span class=\"line\">        use: [</span><br><span class=\"line\">          &#123; <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;style-loader&#x27;</span> &#125;, <span class=\"comment\">// 这里采用的是对象配置loader的写法</span></span><br><span class=\"line\">          &#123; <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;css-loader&#x27;</span> &#125;,</span><br><span class=\"line\">          &#123; <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span> &#125; <span class=\"comment\">// 使用postcss-loader</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">       ...</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-5、css-分离-ExtractTextPlugin\"><a href=\"#7-5、css-分离-ExtractTextPlugin\" class=\"headerlink\" title=\"7.5、css 分离 ExtractTextPlugin\"></a>7.5、css 分离 ExtractTextPlugin</h3><p>将 css 成生文件，而非内联。该插件的主要是为了抽离 css 样式,防止将样式打包在 js 中引起页面样式加载错乱的现象。</p>\n<ol>\n<li>安装 npm i extract-text-webpack-plugin@next -D</li>\n<li>在 webpack.config.js 文件中引入并使用该插件：</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;extract-text-webpack-plugin&#x27;</span>) <span class=\"comment\">//引入分离插件</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>, <span class=\"comment\">// 正则匹配以.css结尾的文件</span></span><br><span class=\"line\">        use: ExtractTextPlugin.extract(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 相当于回滚，经postcss-loader和css-loader处理过的css最终再经过style-loader处理</span></span><br><span class=\"line\">          fallback: <span class=\"string\">&#x27;style-loader&#x27;</span>,</span><br><span class=\"line\">          use: [<span class=\"string\">&#x27;css-loader&#x27;</span>, <span class=\"string\">&#x27;postcss-loader&#x27;</span>]</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> ExtractTextPlugin(<span class=\"string\">&#x27;css/index.css&#x27;</span>) <span class=\"comment\">// 将css分离到/dist文件夹下的css文件夹中的index.css</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>此时运行 npm run build 后会发现/dist 文件夹内多出了/css 文件夹及 index.css 文件。</p>\n<h3 id=\"7-6、消除冗余-css\"><a href=\"#7-6、消除冗余-css\" class=\"headerlink\" title=\"7.6、消除冗余 css\"></a>7.6、消除冗余 css</h3><p>有时候我们 css 写得多了，可能会不自觉的写重复了一些样式，这就造成了多余的代码，以下方法可以优化</p>\n<ol>\n<li>安装 npm i purifycss-webpack purify-css glob -D</li>\n<li>引入 clean-webpack-plugin 及 glob 插件并使用</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PurifyCssWebpack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;purifycss-webpack&#x27;</span>) <span class=\"comment\">// 引入PurifyCssWebpack插件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> glob = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;glob&#x27;</span>) <span class=\"comment\">// 引入glob模块,用于扫描全部html文件中所引用的css</span></span><br><span class=\"line\"></span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> PurifyCssWebpack(&#123;</span><br><span class=\"line\">    paths: glob.sync(path.join(__dirname, <span class=\"string\">&#x27;src/*.html&#x27;</span>)) <span class=\"comment\">// 同步扫描所有html文件中所引用的css</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。\"><a href=\"#至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。\" class=\"headerlink\" title=\"至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。\"></a>至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。</h3><h4 id=\"下面将讲述-webpack-的优化方法。以下的例子是由-vue-cli-脚手架搭建的项目，跟上述例子无关。\"><a href=\"#下面将讲述-webpack-的优化方法。以下的例子是由-vue-cli-脚手架搭建的项目，跟上述例子无关。\" class=\"headerlink\" title=\"下面将讲述 webpack 的优化方法。以下的例子是由 vue-cli 脚手架搭建的项目，跟上述例子无关。\"></a>下面将讲述 webpack 的优化方法。以下的例子是由 vue-cli 脚手架搭建的项目，跟上述例子无关。</h4><p>————————————————————————————————————————————</p>\n<h2 id=\"webpack-打包优化\"><a href=\"#webpack-打包优化\" class=\"headerlink\" title=\"webpack 打包优化\"></a>webpack 打包优化</h2><h3 id=\"为什么要优化打包？\"><a href=\"#为什么要优化打包？\" class=\"headerlink\" title=\"为什么要优化打包？\"></a>为什么要优化打包？</h3><ul>\n<li>项目越做越大，依赖包越来越多，打包文件太大</li>\n<li>单页面应用首页白屏时间长，用户体验差</li>\n</ul>\n<h3 id=\"我们的目的\"><a href=\"#我们的目的\" class=\"headerlink\" title=\"我们的目的\"></a>我们的目的</h3><ul>\n<li>减小打包后的文件大小</li>\n<li>首页按需引入文件</li>\n<li>优化 webpack 打包时间</li>\n</ul>\n<h3 id=\"按需加载\"><a href=\"#按需加载\" class=\"headerlink\" title=\"按需加载\"></a>按需加载</h3><p>1.1 路由组件按需加载</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> router = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">&#x27;/index&#x27;</span>,</span><br><span class=\"line\">    component: <span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span></span><br><span class=\"line\">      <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> resolve(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;@/components/index&#x27;</span>)))</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">&#x27;/about&#x27;</span>,</span><br><span class=\"line\">    component: <span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span></span><br><span class=\"line\">      <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> resolve(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;@/components/about&#x27;</span>)))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>1.2 第三方组件和插件。按需加载需引入第三方组件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引入全部组件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> ElementUI <span class=\"keyword\">from</span> <span class=\"string\">&#x27;element-ui&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span></span><br><span class=\"line\">Vue.use(ElementUI)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 按需引入组件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Button &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;element-ui&#x27;</span></span><br><span class=\"line\">Vue.component(Button.name, Button)</span><br></pre></td></tr></table></figure>\n\n<p>1.3 对于一些插件，如果只是在个别组件中用的到，也可以不要在 main.js 里面引入，而是在组件中按需引入</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在main.js引入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> vue</span><br><span class=\"line\"><span class=\"keyword\">import</span> Vuelidate <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuelidate&#x27;</span></span><br><span class=\"line\">Vue.use(Vuelidate)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 按组件按需引入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Vuelidate &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuelidate&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"优化-loader-配置\"><a href=\"#优化-loader-配置\" class=\"headerlink\" title=\"优化 loader 配置\"></a>优化 loader 配置</h3><ul>\n<li>优化正则匹配</li>\n<li>通过 cacheDirectory 选项开启缓存</li>\n<li>通过 include、exclude 来减少被处理的文件。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">      loader: <span class=\"string\">&#x27;babel-loader?cacheDirectory&#x27;</span>,</span><br><span class=\"line\">      include: [resolve(<span class=\"string\">&#x27;src&#x27;</span>)]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"优化文件路径——省下搜索文件的时间\"><a href=\"#优化文件路径——省下搜索文件的时间\" class=\"headerlink\" title=\"优化文件路径——省下搜索文件的时间\"></a>优化文件路径——省下搜索文件的时间</h3><ul>\n<li>extension 配置之后可以不用在 require 或是 import 的时候加文件扩展名,会依次尝试添加扩展名进行匹配。</li>\n<li>alias 通过配置别名可以加快 webpack 查找模块的速度。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">resolve: &#123;</span><br><span class=\"line\">  extensions: [<span class=\"string\">&#x27;.js&#x27;</span>, <span class=\"string\">&#x27;.vue&#x27;</span>, <span class=\"string\">&#x27;.json&#x27;</span>],</span><br><span class=\"line\">  alias: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;vue$&#x27;</span>: <span class=\"string\">&#x27;vue/dist/vue.esm.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;@&#x27;</span>: resolve(<span class=\"string\">&#x27;src&#x27;</span>),</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"生产环境关闭-sourceMap\"><a href=\"#生产环境关闭-sourceMap\" class=\"headerlink\" title=\"生产环境关闭 sourceMap\"></a>生产环境关闭 sourceMap</h3><ul>\n<li>sourceMap 本质上是一种映射关系，打包出来的 js 文件中的代码可以映射到代码文件的具体位置,这种映射关系会帮助我们直接找到在源代码中的错误。</li>\n<li>打包速度减慢，生产文件变大，所以开发环境使用 sourceMap，生产环境则关闭。</li>\n</ul>\n<h3 id=\"代码压缩\"><a href=\"#代码压缩\" class=\"headerlink\" title=\"代码压缩\"></a>代码压缩</h3><ul>\n<li>UglifyJS: vue-cli 默认使用的压缩代码方式，它使用的是单线程压缩代码，打包时间较慢</li>\n<li>ParallelUglifyPlugin: 开启多个子进程，把对多个文件压缩的工作分别给多个子进程去完成</li>\n</ul>\n<p>两种方法使用如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> UglifyJsPlugin(&#123;</span><br><span class=\"line\">    uglifyOptions: &#123;</span><br><span class=\"line\">      compress: &#123;</span><br><span class=\"line\">        warnings: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    sourceMap: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    parallel: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">new</span> ParallelUglifyPlugin(&#123;</span><br><span class=\"line\">    <span class=\"comment\">//缓存压缩后的结果，下次遇到一样的输入时直接从缓存中获取压缩后的结果并返回，</span></span><br><span class=\"line\">    <span class=\"comment\">//cacheDir 用于配置缓存存放的目录路径。</span></span><br><span class=\"line\">    cacheDir: <span class=\"string\">&#x27;.cache/&#x27;</span>,</span><br><span class=\"line\">    sourceMap: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    uglifyJS: &#123;</span><br><span class=\"line\">      output: &#123;</span><br><span class=\"line\">        comments: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      compress: &#123;</span><br><span class=\"line\">        warnings: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>打包速度和打包后的文件大小啊对比<br>| 方法 | 文件大小 | 打包速度 |<br>|———————|:———|:———|<br>| 不用插件 | 14.6M | 32s |<br>| UglifyJsPlugin | 12.9M | 33s |<br>| ParallelUglifyPlugi | 7.98M | 17s |</p>\n<h3 id=\"提取公共代码\"><a href=\"#提取公共代码\" class=\"headerlink\" title=\"提取公共代码\"></a>提取公共代码</h3><ul>\n<li>相同资源重复被加载，浪费用户流量，增加服务器成本。</li>\n<li>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。</li>\n</ul>\n<p>webpack3 使用 CommonsChunkPlugin 的实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;vendor&#x27;</span>,</span><br><span class=\"line\">    minChunks: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"built_in\">module</span>, count</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">module</span>.resource, <span class=\"string\">`引用次数<span class=\"subst\">$&#123;count&#125;</span>`</span>)</span><br><span class=\"line\">      <span class=\"comment\">//&quot;有正在处理文件&quot; + &quot;这个文件是 .js 后缀&quot; + &quot;这个文件是在 node_modules 中&quot;</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"built_in\">module</span>.resource &amp;&amp;</span><br><span class=\"line\">        /\\.js$/.test(<span class=\"built_in\">module</span>.resource) &amp;&amp;</span><br><span class=\"line\">        <span class=\"built_in\">module</span>.resource.indexOf(path.join(__dirname, <span class=\"string\">&#x27;./node_modules&#x27;</span>)) === <span class=\"number\">0</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;common&#x27;</span>,</span><br><span class=\"line\">    chunks: <span class=\"string\">&#x27;initial&#x27;</span>,</span><br><span class=\"line\">    minChunks: <span class=\"number\">2</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"webpack4-使用-splitChunks-的实现：\"><a href=\"#webpack4-使用-splitChunks-的实现：\" class=\"headerlink\" title=\"webpack4 使用 splitChunks 的实现：\"></a>webpack4 使用 splitChunks 的实现：</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    splitChunks: &#123;</span><br><span class=\"line\">       chunks: <span class=\"string\">&#x27;all&#x27;</span>,</span><br><span class=\"line\">      ccacheGroups: &#123;</span><br><span class=\"line\">        vendors: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;chunk-vendors&#x27;</span>,</span><br><span class=\"line\">          test: <span class=\"regexp\">/[\\\\/]node_modules[\\\\/]/</span>,</span><br><span class=\"line\">          priority: <span class=\"number\">10</span>,</span><br><span class=\"line\">          chunks: <span class=\"string\">&#x27;initial&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        iview: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;chunk-iview&#x27;</span>,</span><br><span class=\"line\">          priority: <span class=\"number\">20</span>,</span><br><span class=\"line\">          test: <span class=\"regexp\">/[\\\\/]node_modules[\\\\/]_?iview(.*)/</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        echarts: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;chunk-echarts&#x27;</span>,</span><br><span class=\"line\">          priority: <span class=\"number\">20</span>,</span><br><span class=\"line\">          test: <span class=\"regexp\">/[\\\\/]node_modules[\\\\/]_?echarts(.*)/</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        commons: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;chunk-commons&#x27;</span>,</span><br><span class=\"line\">          minChunks: <span class=\"number\">2</span>,</span><br><span class=\"line\">          priority: <span class=\"number\">5</span>,</span><br><span class=\"line\">          chunks: <span class=\"string\">&#x27;initial&#x27;</span>,</span><br><span class=\"line\">          reuseExistingChunk: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"CDN-优化\"><a href=\"#CDN-优化\" class=\"headerlink\" title=\"CDN 优化\"></a>CDN 优化</h3><p>CDN 又叫内容分发网络，通过把资源部署到世界各地，用户在访问时按照就近原则从离用户最近的服务器获取资源，从而加速资源的获取速度。</p>\n<ul>\n<li>随着项目越做越大，依赖的第三方 npm 包越来越多，构建之后的文件也会越来越大。</li>\n<li>再加上又是单页应用，这就会导致在网速较慢或者服务器带宽有限的情况出现长时间的白屏。</li>\n</ul>\n<p>1、将 vue、vue-router、vuex、element-ui 和 axios 这五个库，全部改为通过 CDN 链接获取，在 index.html 里插入 相应链接。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  &lt;link</span><br><span class=\"line\">    rel=&quot;stylesheet&quot;</span><br><span class=\"line\">    href=&quot;https://cdn.bootcss.com/element-ui/2.0.7/theme-chalk/index.css&quot;</span><br><span class=\"line\">  /&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/vuex/3.1.0/vuex.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/vue-router/3.0.2/vue-router.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/element-ui/2.6.1/index.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>问题</strong>：开发环境也接入 vue.min.js 的 cdn 时无法使用 chrome 的 Vue.js devtools 插件，所以要分环境加载不同的资源。</p>\n<p>2、在 webpack.config.js 配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\"> ···</span><br><span class=\"line\">    externals: &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;vue&#x27;</span>: <span class=\"string\">&#x27;Vue&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;vuex&#x27;</span>: <span class=\"string\">&#x27;Vuex&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;vue-router&#x27;</span>: <span class=\"string\">&#x27;VueRouter&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;element-ui&#x27;</span>: <span class=\"string\">&#x27;ELEMENT&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;Axios&#x27;</span>:<span class=\"string\">&#x27;axios&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>3、卸载依赖的 npm 包，npm uninstall axios element-ui vue vue-router vuex</p>\n<p>4、修改 main.js 文件里之前的引包方式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// import Vue from &#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// import ElementUI from &#x27;element-ui&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// import &#x27;element-ui/lib/theme-chalk/index.css&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// import VueRouter from &#x27;vue-router&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./App.vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> routes <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./router&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> utils <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./utils/Utils&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(ELEMENT)</span><br><span class=\"line\">Vue.use(VueRouter)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  mode: <span class=\"string\">&#x27;hash&#x27;</span>, <span class=\"comment\">//路由的模式</span></span><br><span class=\"line\">  routes</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">  router,</span><br><span class=\"line\">  el: <span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\">  render: <span class=\"function\">(<span class=\"params\">h</span>) =&gt;</span> h(App)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-HappyPack-多进程解析和处理文件\"><a href=\"#使用-HappyPack-多进程解析和处理文件\" class=\"headerlink\" title=\"使用 HappyPack 多进程解析和处理文件\"></a>使用 HappyPack 多进程解析和处理文件</h3><ul>\n<li>由于运行在 Node.js 之上的 Webpack 是单线程模型的，所以 Webpack 需要处理的事情需要一件一件的做，不能多件事一起做。</li>\n<li>HappyPack 就能让 Webpack 把任务分解给多个子进程去并发的执行，子进程处理完后再把结果发送给主进程。</li>\n<li>HappyPack 对 file-loader、url-loader 支持的不友好，所以不建议对该 loader 使用。</li>\n</ul>\n<p>使用方法如下：</p>\n<ol>\n<li>HappyPack 插件安装： npm i -D happypack</li>\n<li>webpack.base.conf.js 文件对 module.rules 进行配置</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">      use: [<span class=\"string\">&#x27;happypack/loader?id=babel&#x27;</span>],</span><br><span class=\"line\">      include: [resolve(<span class=\"string\">&#x27;src&#x27;</span>), resolve(<span class=\"string\">&#x27;test&#x27;</span>)],</span><br><span class=\"line\">      exclude: path.resolve(__dirname, <span class=\"string\">&#x27;node_modules&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.vue$/</span>,</span><br><span class=\"line\">      use: [<span class=\"string\">&#x27;happypack/loader?id=vue&#x27;</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>在生产环境 webpack.prod.conf.js 文件进行配置</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> HappyPack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;happypack&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 构造出共享进程池，在进程池中包含5个子进程</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> HappyPackThreadPool = HappyPack.ThreadPool(&#123; <span class=\"attr\">size</span>: <span class=\"number\">5</span> &#125;)</span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HappyPack(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件</span></span><br><span class=\"line\">    id: <span class=\"string\">&#x27;babel&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 如何处理.js文件，用法和Loader配置中一样</span></span><br><span class=\"line\">    loaders: [<span class=\"string\">&#x27;babel-loader?cacheDirectory&#x27;</span>],</span><br><span class=\"line\">    threadPool: HappyPackThreadPool</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HappyPack(&#123;</span><br><span class=\"line\">    id: <span class=\"string\">&#x27;vue&#x27;</span>, <span class=\"comment\">// 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件</span></span><br><span class=\"line\">    loaders: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        loader: <span class=\"string\">&#x27;vue-loader&#x27;</span>,</span><br><span class=\"line\">        options: vueLoaderConfig</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    threadPool: HappyPackThreadPool</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-DLLPlugin-提高打包编译速度\"><a href=\"#使用-DLLPlugin-提高打包编译速度\" class=\"headerlink\" title=\"使用 DLLPlugin 提高打包编译速度\"></a>使用 DLLPlugin 提高打包编译速度</h3><p><a href=\"https://webpack.docschina.org/plugins/dll-plugin/\">DLLPlugin</a> 代码一般简单区分为业务代码和第三方库。如果不做处理，每次构建时都需要把所有的代码重新构建一次，耗费大量的时间，在大部分情况下，很多第三方库的代码不会变更（除非是版本升级），这时就可以使用到 dll：将复用性较高的第三方模块打包到动态链接库中，再不升级这些库的情况下，动态库不需要重新打包，每次构建只需要重新打包业务代码。</p>\n<p>DllPlugin 是 webpack 内置的插件，不需要额外安装，直接配置 webpack.dll.config.js 文件，Webpack 已经内置了对动态链接库的支持，需要通过 2 个内置的插件接入，它们分别是：</p>\n<p>DllPlugin 插件：用于打包出一个个单独的动态链接库文件。<br>DllReferencePlugin 插件：用于在主要配置文件中去引入 DllPlugin 插件打包好的动态链接库文件。</p>\n<p>相关链接：</p>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000016567986\">webpack 使用-详解 DllPlugin</a></li>\n<li><a href=\"https://juejin.cn/post/6844903635072057358\">webpack 编译速度提升之 DllPlugin</a></li>\n<li><a href=\"http://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-2%E4%BD%BF%E7%94%A8DllPlugin.html\">4-2 使用 DllPlugin</a></li>\n</ul>\n<h3 id=\"tree-shaking\"><a href=\"#tree-shaking\" class=\"headerlink\" title=\"tree shaking\"></a>tree shaking</h3><p>通过 tree-shaking，将没有使用的模块摇掉，这样来达到删除无用代码的目的。<br>思路： 基于 ES6 提供的模块系统对代码进行静态分析,并将代码中的死代码（dead code）移除的一种技术。因此，利用 Tree Shaking 技术可以很方便地实现我们代码上的优化，减少代码体积。</p>\n<p>摇树删除代码的原理：<br>webpack 基于 ES6 提供的模块系统，对代码的依赖树进行静态分析，把 import &amp; export 标记为 3 类：</p>\n<ul>\n<li>所有 import 标记为/_ harmony import _/</li>\n<li>被使用过的 export 标记为/harmony export([type])/，其中[type]和 webpack 内部有关，可能是 binding，immutable 等；</li>\n<li>没有被使用的 export 标记为/_ unused harmony export [FuncName] _/，其中[FuncName]为 export 的方法名，之后使用 Uglifyjs（或者其他类似的工具）进行代码精简，把没用的都删除。</li>\n</ul>\n<p>为何基于 es6 模块实现（ES6 module 特点：）：</p>\n<ul>\n<li>只能作为模块顶层的语句出现</li>\n<li>import 的模块名只能是字符串常量</li>\n<li>import binding 是 immutable 的</li>\n</ul>\n<p>条件：</p>\n<ol>\n<li>首先源码必须遵循 ES6 的模块规范 (import &amp; export)，如果是 CommonJS 规范 (require) 则无法使用。</li>\n<li>编写的模块代码不能有副作用，如果在代码内部改变了外部的变量则不会被移除。</li>\n</ol>\n<p>配置方法：<br>在 package.json 里添加一个属性：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// sideEffects如果设为false，webpack就会认为所有没用到的函数都是没副作用的，即删了也没关系。</span></span><br><span class=\"line\">    <span class=\"string\">&quot;sideEffects&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 设置黑名单，用于防止误删代码</span></span><br><span class=\"line\">    <span class=\"string\">&quot;sideEffects&quot;</span>: [</span><br><span class=\"line\">        <span class=\"comment\">// 数组里列出黑名单，禁止shaking下列代码</span></span><br><span class=\"line\">        <span class=\"string\">&quot;@babel/polly-fill&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;*.less&quot;</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 其它有副作用的模块</span></span><br><span class=\"line\">        <span class=\"string\">&quot;./src/some-side-effectful-file.js&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>tree-shaking 摇掉代码中未使用的代码 在生产模式下自动开启</p>\n<p>tree-shaking 并不是 webpack 中的某一个配置选项，是一组功能搭配使用后的优化效果，会在生产模式下自动启动</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在开发模式下，设置 usedExports: true ，打包时只会标记出哪些模块没有被使用，不会删除，因为可能会影响 source-map的标记位置的准确性。</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    mode: <span class=\"string\">&#x27;develpoment&#x27;</span>,</span><br><span class=\"line\">    optimization: &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 优化导出的模块</span></span><br><span class=\"line\">        usedExports: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 在生产模式下默认开启 usedExports: true ，打包压缩时就会将没用到的代码移除</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    mode: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">//  这个属性的作用就是集中配置webpack内部的优化功能</span></span><br><span class=\"line\">    optimizition: &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 只导出外部使用的模块成员 负责标记枯树叶</span></span><br><span class=\"line\">        usedExports: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        minimize: <span class=\"literal\">true</span>, <span class=\"comment\">// 自动压缩代码 负责摇掉枯树叶</span></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * webpack打包默认会将一个模块单独打包到一个闭包中</span></span><br><span class=\"line\"><span class=\"comment\">         * webpack3中新增的API 将所有模块都放在一个函数中 ，尽可能将所有模块合并在一起，</span></span><br><span class=\"line\"><span class=\"comment\">         * 提升效率，减少体积  达到作用域提升的效果</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        concatenateModules: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用摇树的注意事项：</p>\n<ul>\n<li>使用 ES6 模块语法编写代码</li>\n<li>工具类函数尽量以单独的形式输出，不要集中成一个对象或者类</li>\n<li>声明 sideEffects</li>\n<li>自己在重构代码时也要注意副作用</li>\n</ul>\n<p>tree-shaking &amp; babel 使用 babel-loader 处理 js 代码会导致 tree-shaking 失效的原因：<br>treeshaking 使用的前提必须是 ES module 组织的代码，也就是说交给 ESMOdule 处理的代码必须是 ESM。当我们使用 babel-loader 处理 js 代码之后就有可能将 ESM 转换 成 commonjs 规范（preset-env 插件工作的时候就会将 esm =&gt; coommonjs）</p>\n<p>解决办法：<br>收到配置 preset-env 的 modules： false,确保不会开启自动转换的插件(在最新版本的 babel-loader 中自动帮我们关闭了转换成 commonjs 规范的功能)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">presets: [</span><br><span class=\"line\">    [&#39;@babel&#x2F;preset-env&#39;, &#123;module: &#39;commonjs&#39;&#125;]</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ol>\n<li>比较实用的方法: 按需加载，优化 loader 配置，关闭生产环境的 sourceMap，CDN 优化。</li>\n<li>vue-cli 已做的优化： 代码压缩，提取公共代码，再优化空间不大。</li>\n<li>根据项目实际需要和自身开发水平选择优化方法，必须避免因为优化产生 bug。</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>webpack 的使用及优化</p>\n<p>我们的目的</p>\n<ul>\n<li>减小打包后的文件大小</li>\n<li>首页按需引入文件</li>\n<li>优化 webpack 打包时间</li>\n</ul>","more":"<h2 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h2><p>新建一个空文件夹，用于创建项目，使用 npm init 命令创建一个 package.json 文件。<br>输入这个命令后，终端会问你一系列诸如项目名称，项目描述，作者等信息，也可以使用 npm init -y 这个命令来一次生成 package.json 文件，这样终端不会询问你问题。</p>\n<h2 id=\"安装-webpack\"><a href=\"#安装-webpack\" class=\"headerlink\" title=\"安装 webpack\"></a>安装 webpack</h2><p>安装 webapck 时把 webpack-cli 也装上是因为在 webpack4.x 版本后 webpack 模块把一些功能分到了 webpack-cli 模块，所以两者都需要安装，安装方法如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install webpack webpack-cli --<span class=\"built_in\">global</span>    <span class=\"comment\">//这是安装全局webpack及webpack-cli模块</span></span><br><span class=\"line\">npm install webpack webpack-cli --save-dev  <span class=\"comment\">//这是安装本地项目模块</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"新建文件\"><a href=\"#新建文件\" class=\"headerlink\" title=\"新建文件\"></a>新建文件</h2><p>在根目录件夹中新建两个文件夹，分别为 src 文件夹和 dist 文件夹，接下来再创建三个文件:此时，项目结构如下</p>\n<ul>\n<li>index.html –放在 dist 文件夹中；</li>\n<li>hello.js –放在 src 文件夹中；</li>\n<li>index.js –放在 src 文件夹中；</li>\n</ul>\n<h3 id=\"index-html-中写下-html-代码，它的作用是为了引入我们打包后的-js-文件：\"><a href=\"#index-html-中写下-html-代码，它的作用是为了引入我们打包后的-js-文件：\" class=\"headerlink\" title=\"index.html 中写下 html 代码，它的作用是为了引入我们打包后的 js 文件：\"></a>index.html 中写下 html 代码，它的作用是为了引入我们打包后的 js 文件：</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Webpack Project<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;root&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;bundle.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--这是打包之后的js文件，我们暂时命名为bundle.js--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在-hello-js-中导出一个模块：\"><a href=\"#在-hello-js-中导出一个模块：\" class=\"headerlink\" title=\"在 hello.js 中导出一个模块：\"></a>在 hello.js 中导出一个模块：</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// hello.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> hello = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;div&#x27;</span>)</span><br><span class=\"line\">  hello.innerHTML = <span class=\"string\">&#x27;welcome to China!&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> hello</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在-index-js-中引入这个模块（hello-js）\"><a href=\"#在-index-js-中引入这个模块（hello-js）\" class=\"headerlink\" title=\"在 index.js 中引入这个模块（hello.js）:\"></a>在 index.js 中引入这个模块（hello.js）:</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//index.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> hello = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./hello.js&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;#root&#x27;</span>).appendChild(hello())</span><br></pre></td></tr></table></figure>\n\n<p>上述操作就相当于我们把 hello.js 模块合并到了 index.js 模块，之后我们打包时就只需把 index.js 模块打包成 bundle.js 即可。</p>\n<h3 id=\"进行最简单的-webpack-打包\"><a href=\"#进行最简单的-webpack-打包\" class=\"headerlink\" title=\"进行最简单的 webpack 打包\"></a>进行最简单的 webpack 打包</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在终端中使用如下命令进行打包：</span></span><br><span class=\"line\">webpack src/index.js --output dist/bundle.js</span><br></pre></td></tr></table></figure>\n\n<p>上述就相当于把 src 文件夹下的 index.js 文件打包到 dist 文件下的 bundle.js，这时就生成了 bundle.js 供 index.html 文件引用。现在打开 index.html 就可以看到我们的页面了。</p>\n<h2 id=\"配置-webpack-config-js\"><a href=\"#配置-webpack-config-js\" class=\"headerlink\" title=\"配置 webpack.config.js\"></a>配置 webpack.config.js</h2><p>上述打包方式太 low 了，我们可以在当前项目的根目录下新建一个配置文件 webpack.config.js 用来配置打包方式。<br>webpack.config.js 配置如下</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>) <span class=\"comment\">// 处理绝对路径</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: path.join(__dirname, <span class=\"string\">&#x27;/src/index.js&#x27;</span>), <span class=\"comment\">// 入口文件</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.join(__dirname, <span class=\"string\">&#x27;/dist&#x27;</span>), <span class=\"comment\">//打包后的文件存放的地方</span></span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;bundle.js&#x27;</span> <span class=\"comment\">//打包后输出文件的文件名</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有了这个配置文件，我们只需在终端中运行 webpack 命令就可进行打包，这条命令会自动引用 webpack.config.js 文件中的配置选项。</p>\n<h2 id=\"构建本地服务器\"><a href=\"#构建本地服务器\" class=\"headerlink\" title=\"构建本地服务器\"></a>构建本地服务器</h2><p>现在我们是通过打开本地文件来查看页面的，感觉还是有点 low。例如 vue, react 等脚手架都是在本地服务器运行的。所以我们再做进一步优化。</p>\n<h3 id=\"webpack-dev-server-配置本地服务器\"><a href=\"#webpack-dev-server-配置本地服务器\" class=\"headerlink\" title=\"webpack-dev-server 配置本地服务器\"></a>webpack-dev-server 配置本地服务器</h3><p>Webpack 提供了一个可选的本地开发服务器，这个本地服务器基于 node.js 构建，它是一个单独的组件，在 webpack 中进行配置之前需要单独安装它作为项目依赖：npm i webpack-dev-server -D</p>\n<p>以下是 devServer 的一些配置选项:</p>\n<ul>\n<li>contentBase ：设置服务器所读取文件的目录，当前我们设置为”./dist”</li>\n<li>port ：设置端口号，如果省略，默认为 8080</li>\n<li>inline ：设置为 true，当源文件改变时会自动刷新页面</li>\n<li>historyApiFallback ：设置为 true，所有的跳转将指向 index.html</li>\n</ul>\n<p>现在我们把这些配置加到 webpack.config.js 文件上，如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// webpack.config.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: path.join(__dirname, <span class=\"string\">&#x27;/src/index.js&#x27;</span>), <span class=\"comment\">// 入口文件</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.join(__dirname, <span class=\"string\">&#x27;/dist&#x27;</span>), <span class=\"comment\">//打包后的文件存放的地方</span></span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;bundle.js&#x27;</span> <span class=\"comment\">//打包后输出文件的文件名</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    contentBase: <span class=\"string\">&#x27;./dist&#x27;</span>, <span class=\"comment\">// 本地服务器所加载文件的目录</span></span><br><span class=\"line\">    port: <span class=\"string\">&#x27;8088&#x27;</span>, <span class=\"comment\">// 设置端口号为8088</span></span><br><span class=\"line\">    inline: <span class=\"literal\">true</span>, <span class=\"comment\">// 文件修改后实时刷新</span></span><br><span class=\"line\">    historyApiFallback: <span class=\"literal\">true</span> <span class=\"comment\">//不跳转</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"package-json-文件中添加启动和打包命令\"><a href=\"#package-json-文件中添加启动和打包命令\" class=\"headerlink\" title=\"package.json 文件中添加启动和打包命令\"></a>package.json 文件中添加启动和打包命令</h3><p>package.json 文件修改如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;webpack-project&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span>: <span class=\"string\">&quot;1.0.0&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;description&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;main&quot;</span>: <span class=\"string\">&quot;index.js&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;scripts&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;build&quot;</span>: <span class=\"string\">&quot;webpack&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;dev&quot;</span>: <span class=\"string\">&quot;webpack-dev-server --open&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;keywords&quot;</span>: [],</span><br><span class=\"line\">  <span class=\"string\">&quot;author&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;license&quot;</span>: <span class=\"string\">&quot;ISC&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;devDependencies&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;webpack&quot;</span>: <span class=\"string\">&quot;^4.23.1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;webpack-cli&quot;</span>: <span class=\"string\">&quot;^3.1.2&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;webpack-dev-server&quot;</span>: <span class=\"string\">&quot;^3.1.10&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样我们就可以用以下命令进行本地运行或者打包文件了</p>\n<ul>\n<li>npm run dev 启动本地服务器，webpack-dev-server 就是启动服务器的命令，–open 是用于启动完服务器后自动打开浏览器。</li>\n<li>npm run build 执行打包命令</li>\n</ul>\n<p>此时，我们只要输入 npm run dev 就可以在 <a href=\"http://localhost:8088/%E4%B8%AD%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E4%BA%86%E3%80%82\">http://localhost:8088/中查看页面了。</a></p>\n<h2 id=\"配置常用-loader\"><a href=\"#配置常用-loader\" class=\"headerlink\" title=\"配置常用 loader\"></a>配置常用 loader</h2><p>loader 可以让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。</p>\n<p>Loaders 的配置包括以下几方面：</p>\n<ul>\n<li>test：一个用以匹配 loaders 所处理文件的拓展名的正则表达式（必须）</li>\n<li>loader：loader 的名称（必须）</li>\n<li>include/exclude：手动添加必须处理的文件（文件夹）或屏蔽不需要处理的文件（文件夹）（可选）；</li>\n<li>options：为 loaders 提供额外的设置选项（可选）</li>\n</ul>\n<h3 id=\"配置-css-loader-和-sass-loader\"><a href=\"#配置-css-loader-和-sass-loader\" class=\"headerlink\" title=\"配置 css-loader 和 sass-loader\"></a>配置 css-loader 和 sass-loader</h3><p>如果我们要加载一个 css 文件，需要安装配置 style-loader 和 css-loader。<br>如果我们要使用 sass，就要配置 sass-loader 和 node-sass。</p>\n<ul>\n<li>css-loader：加载.css 文件</li>\n<li>style-loader：使用 style 标签将 css-loader 内部样式注入到我们的 HTML 页面</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: path.join(__dirname, <span class=\"string\">&#x27;/src/index.js&#x27;</span>), <span class=\"comment\">// 入口文件</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.join(__dirname, <span class=\"string\">&#x27;/dist&#x27;</span>), <span class=\"comment\">//打包后的文件存放的地方</span></span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;bundle.js&#x27;</span> <span class=\"comment\">//打包后输出文件的文件名</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    contentBase: <span class=\"string\">&#x27;./dist&#x27;</span>, <span class=\"comment\">// 本地服务器所加载文件的目录</span></span><br><span class=\"line\">    port: <span class=\"string\">&#x27;8088&#x27;</span>, <span class=\"comment\">// 设置端口号为8088</span></span><br><span class=\"line\">    inline: <span class=\"literal\">true</span>, <span class=\"comment\">// 文件修改后实时刷新</span></span><br><span class=\"line\">    historyApiFallback: <span class=\"literal\">true</span> <span class=\"comment\">//不跳转</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>, <span class=\"comment\">// 正则匹配以.css结尾的文件</span></span><br><span class=\"line\">        use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>]</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.(scss|sass)$/</span>, <span class=\"comment\">// 正则匹配以.scss和.sass结尾的文件</span></span><br><span class=\"line\">        use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>, <span class=\"string\">&#x27;sass-loader&#x27;</span>]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"css-压缩\"><a href=\"#css-压缩\" class=\"headerlink\" title=\"css 压缩\"></a>css 压缩</h4><p>css 代码也可以像 Javascript 那样被压缩，以达到提升加速度和代码混淆的作用。目前比较成熟可靠的 CSS 压缩工具是 cssnano，基于 postcss。</p>\n<p>cssnano 能理解 CSS 代码的含义，而不仅仅是删除空格，例如：</p>\n<ul>\n<li>margin:10px 20px 10px 20px 被压缩成 margin：10px 20px</li>\n<li>color：#ff0000 被压缩成 color:red</li>\n</ul>\n<p>通常压缩率能达到 60%，cssnano 介入到 webpack 中很简单，因为 css-loader 已经内置了，只需要开启 css-loader 的 minimize 选项，相关配置如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; WebPlugin &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;web-webpack-plugin&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;extract-text-webpack-plugin&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>, <span class=\"comment\">// 增加对 CSS 文件的支持</span></span><br><span class=\"line\">        <span class=\"comment\">// 提取出 Chunk 中的 CSS 代码到单独的文件中</span></span><br><span class=\"line\">        use: ExtractTextPlugin.extract(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 通过 minimize 选项压缩 CSS 代码</span></span><br><span class=\"line\">          use: [<span class=\"string\">&#x27;css-loader?minimize&#x27;</span>]</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// 用 WebPlugin 生成对应的 HTML 文件</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> WebPlugin(&#123;</span><br><span class=\"line\">      template: <span class=\"string\">&#x27;./template.html&#x27;</span>, <span class=\"comment\">// HTML 模版文件所在的文件路径</span></span><br><span class=\"line\">      filename: <span class=\"string\">&#x27;index.html&#x27;</span> <span class=\"comment\">// 输出的 HTML 的文件名称</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> ExtractTextPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">`[name]_[contenthash:8].css`</span> <span class=\"comment\">// 给输出的 CSS 文件名称加上 Hash 值</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-Babel-loader\"><a href=\"#配置-Babel-loader\" class=\"headerlink\" title=\"配置 Babel-loader\"></a>配置 Babel-loader</h3><p>Babel 其实是一个编译 JavaScript 的平台，它可以编译代码帮你达到以下目的：</p>\n<ul>\n<li>让你能使用最新的 JavaScript 代码（ES6，ES7…）；</li>\n<li>让你能使用基于 JavaScript 进行了拓展的语言，比如 React 的 JSX；</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">      loader: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">      include: [resolve(<span class=\"string\">&#x27;src&#x27;</span>)]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>由于 loader 对文件的转换操作很耗时，需要让尽可能少的文件被 loader 处理，可以通过 test、include、exclude 三个配置来命中 loader 要应用规则的文件。为了尽可能少的让文件被 loader 处理，可以通过 include 去命中只有哪些文件被处理</p>\n<h3 id=\"处理图片\"><a href=\"#处理图片\" class=\"headerlink\" title=\"处理图片\"></a>处理图片</h3><p>处理图片资源时，我们常用的两种 loader 是 file-loader 或者 url-loader。<br>当使用 url-loader 加载图片，图片小于上限值，则将图片转 base64 字符串，否则使用 file-loader 加载图片。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.(png|jpe?g|gif|svg)(\\?.*)?$/</span>,</span><br><span class=\"line\">      loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">      options: &#123;</span><br><span class=\"line\">        limit: <span class=\"number\">10000</span>,</span><br><span class=\"line\">        name: utils.assetsPath(<span class=\"string\">&#x27;img/[name].[hash:7].[ext]&#x27;</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"cache-loader\"><a href=\"#cache-loader\" class=\"headerlink\" title=\"cache-loader\"></a>cache-loader</h3><p>一些性能开销较大的 loader 之前添加 cache-loader，将结果缓存在磁盘中，默认保存在 node_modueles/.cache/cache-loader 目录下。<br>首先安装依赖</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install cache-loader -D</span><br></pre></td></tr></table></figure>\n\n<p><code>cache-loader </code>的配置要放在其他的 loader 之前，webpack 的配置如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">//我的项目中,babel-loader耗时比较长，所以我给它配置了`cache-loader`</span></span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.jsx?$/</span>,</span><br><span class=\"line\">        use: [<span class=\"string\">&#x27;cache-loader&#x27;</span>, <span class=\"string\">&#x27;babel-loader&#x27;</span>]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>若是只想给 babel-loader 配置 cache 的话，也可以不使用 cache-loader，给 babel-loader 增加选项 CacheDirectory。<br>cacheDirectory：默认值为 false。当有设置时，指定的目录将用来缓存 loader 的执行结果。之后的 Webpack 构建，将会尝试读取缓存，来避免在每次执行时，可能产生的、高性能消耗的 Babel 重新编译过程。设置空值或者 true 的话，使用默认缓存目录：node_modules/.cache/babel-loader。开启 babel-loader 的缓存和配置 cache-loader，我比对了下，构建时间很接近。</p>\n<h2 id=\"7、配置常用插件\"><a href=\"#7、配置常用插件\" class=\"headerlink\" title=\"7、配置常用插件\"></a>7、配置常用插件</h2><p>loader 被用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。</p>\n<h3 id=\"7-1、自动生成-html-文件-HtmlWebpackPlugin\"><a href=\"#7-1、自动生成-html-文件-HtmlWebpackPlugin\" class=\"headerlink\" title=\"7.1、自动生成 html 文件(HtmlWebpackPlugin)\"></a>7.1、自动生成 html 文件(HtmlWebpackPlugin)</h3><p>现在我们都是使用一开始建好的 index.html 文件，然后手动引入 bundle.js，如果以后我们引入不止一个 js 文件，那就得更改 index.html 中的 js 文件名，所以能不能自动生成 index.html 且自动引用打包后的 js 呢？<br>HtmlWebpackPlugin 插件就是用来解决这个问题的：</p>\n<ol>\n<li>安装插件 npm i html-webpack-plugin -D</li>\n<li>把 dist 文件夹清空</li>\n<li>在根目录新建 index.html,内容和原来的 html 一致，只是不引入 js 文件。</li>\n<li>webpack.config.js 中我们引入了 HtmlWebpackPlugin 插件</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    template: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    inject: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    minify: &#123;</span><br><span class=\"line\">      removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      collapseWhitespace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      removeAttributeQuotes: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>此时我们使用 npm run build 进行打包，你会发现，dist 文件夹和 html 文件都会自动生成。</p>\n<h3 id=\"7-2、清理-dist-文件夹-CleanWebpackPlugin\"><a href=\"#7-2、清理-dist-文件夹-CleanWebpackPlugin\" class=\"headerlink\" title=\"7.2、清理/dist 文件夹(CleanWebpackPlugin)\"></a>7.2、清理/dist 文件夹(CleanWebpackPlugin)</h3><p>在每次构建前清理/dist 文件夹，生产最新的打包文件，这时候就用到 CleanWebpackPlugin 插件了。</p>\n<ol>\n<li>安装 npm i clean-webpack-plugin -D</li>\n<li>配置 webpack.config.js</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    template: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    inject: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    minify: &#123;</span><br><span class=\"line\">      removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      collapseWhitespace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      removeAttributeQuotes: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">new</span> CleanWebpackPlugin([<span class=\"string\">&#x27;dist&#x27;</span>])</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-3、热更新-HotModuleReplacementPlugin\"><a href=\"#7-3、热更新-HotModuleReplacementPlugin\" class=\"headerlink\" title=\"7.3、热更新(HotModuleReplacementPlugin)\"></a>7.3、热更新(HotModuleReplacementPlugin)</h3><p>我们要在修改代码后自动更新页面，这就需要 HotModuleReplacementPlugin（HMR）插件</p>\n<ol>\n<li>devServer 配置项中添加 hot: true 参数。</li>\n<li>因为 HotModuleReplacementPlugin 是 webpack 模块自带的，所以引入 webpack 后，在 plugins 配置项中直接使用即可。</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">    filename: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    template: <span class=\"string\">&#x27;index.html&#x27;</span>,</span><br><span class=\"line\">    inject: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    minify: &#123;</span><br><span class=\"line\">      removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      collapseWhitespace: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      removeAttributeQuotes: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">new</span> CleanWebpackPlugin([<span class=\"string\">&#x27;dist&#x27;</span>])</span><br><span class=\"line\">  <span class=\"keyword\">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-4、增加-css-前缀\"><a href=\"#7-4、增加-css-前缀\" class=\"headerlink\" title=\"7.4、增加 css 前缀\"></a>7.4、增加 css 前缀</h3><p>平时我们写 css 时，一些属性需要手动加上前缀，比如-webkit-border-radius: 10px;，在 webpack 中我们可以让他自动加上</p>\n<ol>\n<li>安装 npm i postcss-loader autoprefixer -D</li>\n<li>在项目根目录下新建 postcss.config.js 文件</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;autoprefixer&#x27;</span>) <span class=\"comment\">// 引用autoprefixer模块</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>修改 webpack.config.js 文件中的 css-loader 配置</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>, <span class=\"comment\">// 正则匹配以.css结尾的文件</span></span><br><span class=\"line\">        use: [</span><br><span class=\"line\">          &#123; <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;style-loader&#x27;</span> &#125;, <span class=\"comment\">// 这里采用的是对象配置loader的写法</span></span><br><span class=\"line\">          &#123; <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;css-loader&#x27;</span> &#125;,</span><br><span class=\"line\">          &#123; <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span> &#125; <span class=\"comment\">// 使用postcss-loader</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">       ...</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-5、css-分离-ExtractTextPlugin\"><a href=\"#7-5、css-分离-ExtractTextPlugin\" class=\"headerlink\" title=\"7.5、css 分离 ExtractTextPlugin\"></a>7.5、css 分离 ExtractTextPlugin</h3><p>将 css 成生文件，而非内联。该插件的主要是为了抽离 css 样式,防止将样式打包在 js 中引起页面样式加载错乱的现象。</p>\n<ol>\n<li>安装 npm i extract-text-webpack-plugin@next -D</li>\n<li>在 webpack.config.js 文件中引入并使用该插件：</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ExtractTextPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;extract-text-webpack-plugin&#x27;</span>) <span class=\"comment\">//引入分离插件</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.css$/</span>, <span class=\"comment\">// 正则匹配以.css结尾的文件</span></span><br><span class=\"line\">        use: ExtractTextPlugin.extract(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 相当于回滚，经postcss-loader和css-loader处理过的css最终再经过style-loader处理</span></span><br><span class=\"line\">          fallback: <span class=\"string\">&#x27;style-loader&#x27;</span>,</span><br><span class=\"line\">          use: [<span class=\"string\">&#x27;css-loader&#x27;</span>, <span class=\"string\">&#x27;postcss-loader&#x27;</span>]</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> ExtractTextPlugin(<span class=\"string\">&#x27;css/index.css&#x27;</span>) <span class=\"comment\">// 将css分离到/dist文件夹下的css文件夹中的index.css</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>此时运行 npm run build 后会发现/dist 文件夹内多出了/css 文件夹及 index.css 文件。</p>\n<h3 id=\"7-6、消除冗余-css\"><a href=\"#7-6、消除冗余-css\" class=\"headerlink\" title=\"7.6、消除冗余 css\"></a>7.6、消除冗余 css</h3><p>有时候我们 css 写得多了，可能会不自觉的写重复了一些样式，这就造成了多余的代码，以下方法可以优化</p>\n<ol>\n<li>安装 npm i purifycss-webpack purify-css glob -D</li>\n<li>引入 clean-webpack-plugin 及 glob 插件并使用</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PurifyCssWebpack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;purifycss-webpack&#x27;</span>) <span class=\"comment\">// 引入PurifyCssWebpack插件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> glob = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;glob&#x27;</span>) <span class=\"comment\">// 引入glob模块,用于扫描全部html文件中所引用的css</span></span><br><span class=\"line\"></span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> PurifyCssWebpack(&#123;</span><br><span class=\"line\">    paths: glob.sync(path.join(__dirname, <span class=\"string\">&#x27;src/*.html&#x27;</span>)) <span class=\"comment\">// 同步扫描所有html文件中所引用的css</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。\"><a href=\"#至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。\" class=\"headerlink\" title=\"至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。\"></a>至此，一些常用的配置以及弄好了，现在就开始愉快地写代码了。</h3><h4 id=\"下面将讲述-webpack-的优化方法。以下的例子是由-vue-cli-脚手架搭建的项目，跟上述例子无关。\"><a href=\"#下面将讲述-webpack-的优化方法。以下的例子是由-vue-cli-脚手架搭建的项目，跟上述例子无关。\" class=\"headerlink\" title=\"下面将讲述 webpack 的优化方法。以下的例子是由 vue-cli 脚手架搭建的项目，跟上述例子无关。\"></a>下面将讲述 webpack 的优化方法。以下的例子是由 vue-cli 脚手架搭建的项目，跟上述例子无关。</h4><p>————————————————————————————————————————————</p>\n<h2 id=\"webpack-打包优化\"><a href=\"#webpack-打包优化\" class=\"headerlink\" title=\"webpack 打包优化\"></a>webpack 打包优化</h2><h3 id=\"为什么要优化打包？\"><a href=\"#为什么要优化打包？\" class=\"headerlink\" title=\"为什么要优化打包？\"></a>为什么要优化打包？</h3><ul>\n<li>项目越做越大，依赖包越来越多，打包文件太大</li>\n<li>单页面应用首页白屏时间长，用户体验差</li>\n</ul>\n<h3 id=\"我们的目的\"><a href=\"#我们的目的\" class=\"headerlink\" title=\"我们的目的\"></a>我们的目的</h3><ul>\n<li>减小打包后的文件大小</li>\n<li>首页按需引入文件</li>\n<li>优化 webpack 打包时间</li>\n</ul>\n<h3 id=\"按需加载\"><a href=\"#按需加载\" class=\"headerlink\" title=\"按需加载\"></a>按需加载</h3><p>1.1 路由组件按需加载</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> router = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">&#x27;/index&#x27;</span>,</span><br><span class=\"line\">    component: <span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span></span><br><span class=\"line\">      <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> resolve(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;@/components/index&#x27;</span>)))</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">&#x27;/about&#x27;</span>,</span><br><span class=\"line\">    component: <span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span></span><br><span class=\"line\">      <span class=\"built_in\">require</span>.ensure([], <span class=\"function\">() =&gt;</span> resolve(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;@/components/about&#x27;</span>)))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>1.2 第三方组件和插件。按需加载需引入第三方组件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引入全部组件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> ElementUI <span class=\"keyword\">from</span> <span class=\"string\">&#x27;element-ui&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span></span><br><span class=\"line\">Vue.use(ElementUI)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 按需引入组件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Button &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;element-ui&#x27;</span></span><br><span class=\"line\">Vue.component(Button.name, Button)</span><br></pre></td></tr></table></figure>\n\n<p>1.3 对于一些插件，如果只是在个别组件中用的到，也可以不要在 main.js 里面引入，而是在组件中按需引入</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在main.js引入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> vue</span><br><span class=\"line\"><span class=\"keyword\">import</span> Vuelidate <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuelidate&#x27;</span></span><br><span class=\"line\">Vue.use(Vuelidate)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 按组件按需引入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Vuelidate &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuelidate&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"优化-loader-配置\"><a href=\"#优化-loader-配置\" class=\"headerlink\" title=\"优化 loader 配置\"></a>优化 loader 配置</h3><ul>\n<li>优化正则匹配</li>\n<li>通过 cacheDirectory 选项开启缓存</li>\n<li>通过 include、exclude 来减少被处理的文件。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">      loader: <span class=\"string\">&#x27;babel-loader?cacheDirectory&#x27;</span>,</span><br><span class=\"line\">      include: [resolve(<span class=\"string\">&#x27;src&#x27;</span>)]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"优化文件路径——省下搜索文件的时间\"><a href=\"#优化文件路径——省下搜索文件的时间\" class=\"headerlink\" title=\"优化文件路径——省下搜索文件的时间\"></a>优化文件路径——省下搜索文件的时间</h3><ul>\n<li>extension 配置之后可以不用在 require 或是 import 的时候加文件扩展名,会依次尝试添加扩展名进行匹配。</li>\n<li>alias 通过配置别名可以加快 webpack 查找模块的速度。</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">resolve: &#123;</span><br><span class=\"line\">  extensions: [<span class=\"string\">&#x27;.js&#x27;</span>, <span class=\"string\">&#x27;.vue&#x27;</span>, <span class=\"string\">&#x27;.json&#x27;</span>],</span><br><span class=\"line\">  alias: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;vue$&#x27;</span>: <span class=\"string\">&#x27;vue/dist/vue.esm.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;@&#x27;</span>: resolve(<span class=\"string\">&#x27;src&#x27;</span>),</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"生产环境关闭-sourceMap\"><a href=\"#生产环境关闭-sourceMap\" class=\"headerlink\" title=\"生产环境关闭 sourceMap\"></a>生产环境关闭 sourceMap</h3><ul>\n<li>sourceMap 本质上是一种映射关系，打包出来的 js 文件中的代码可以映射到代码文件的具体位置,这种映射关系会帮助我们直接找到在源代码中的错误。</li>\n<li>打包速度减慢，生产文件变大，所以开发环境使用 sourceMap，生产环境则关闭。</li>\n</ul>\n<h3 id=\"代码压缩\"><a href=\"#代码压缩\" class=\"headerlink\" title=\"代码压缩\"></a>代码压缩</h3><ul>\n<li>UglifyJS: vue-cli 默认使用的压缩代码方式，它使用的是单线程压缩代码，打包时间较慢</li>\n<li>ParallelUglifyPlugin: 开启多个子进程，把对多个文件压缩的工作分别给多个子进程去完成</li>\n</ul>\n<p>两种方法使用如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> UglifyJsPlugin(&#123;</span><br><span class=\"line\">    uglifyOptions: &#123;</span><br><span class=\"line\">      compress: &#123;</span><br><span class=\"line\">        warnings: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    sourceMap: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    parallel: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">new</span> ParallelUglifyPlugin(&#123;</span><br><span class=\"line\">    <span class=\"comment\">//缓存压缩后的结果，下次遇到一样的输入时直接从缓存中获取压缩后的结果并返回，</span></span><br><span class=\"line\">    <span class=\"comment\">//cacheDir 用于配置缓存存放的目录路径。</span></span><br><span class=\"line\">    cacheDir: <span class=\"string\">&#x27;.cache/&#x27;</span>,</span><br><span class=\"line\">    sourceMap: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    uglifyJS: &#123;</span><br><span class=\"line\">      output: &#123;</span><br><span class=\"line\">        comments: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      compress: &#123;</span><br><span class=\"line\">        warnings: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>打包速度和打包后的文件大小啊对比<br>| 方法 | 文件大小 | 打包速度 |<br>|———————|:———|:———|<br>| 不用插件 | 14.6M | 32s |<br>| UglifyJsPlugin | 12.9M | 33s |<br>| ParallelUglifyPlugi | 7.98M | 17s |</p>\n<h3 id=\"提取公共代码\"><a href=\"#提取公共代码\" class=\"headerlink\" title=\"提取公共代码\"></a>提取公共代码</h3><ul>\n<li>相同资源重复被加载，浪费用户流量，增加服务器成本。</li>\n<li>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。</li>\n</ul>\n<p>webpack3 使用 CommonsChunkPlugin 的实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;vendor&#x27;</span>,</span><br><span class=\"line\">    minChunks: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"built_in\">module</span>, count</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"built_in\">module</span>.resource, <span class=\"string\">`引用次数<span class=\"subst\">$&#123;count&#125;</span>`</span>)</span><br><span class=\"line\">      <span class=\"comment\">//&quot;有正在处理文件&quot; + &quot;这个文件是 .js 后缀&quot; + &quot;这个文件是在 node_modules 中&quot;</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"built_in\">module</span>.resource &amp;&amp;</span><br><span class=\"line\">        /\\.js$/.test(<span class=\"built_in\">module</span>.resource) &amp;&amp;</span><br><span class=\"line\">        <span class=\"built_in\">module</span>.resource.indexOf(path.join(__dirname, <span class=\"string\">&#x27;./node_modules&#x27;</span>)) === <span class=\"number\">0</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;common&#x27;</span>,</span><br><span class=\"line\">    chunks: <span class=\"string\">&#x27;initial&#x27;</span>,</span><br><span class=\"line\">    minChunks: <span class=\"number\">2</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"webpack4-使用-splitChunks-的实现：\"><a href=\"#webpack4-使用-splitChunks-的实现：\" class=\"headerlink\" title=\"webpack4 使用 splitChunks 的实现：\"></a>webpack4 使用 splitChunks 的实现：</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    splitChunks: &#123;</span><br><span class=\"line\">       chunks: <span class=\"string\">&#x27;all&#x27;</span>,</span><br><span class=\"line\">      ccacheGroups: &#123;</span><br><span class=\"line\">        vendors: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;chunk-vendors&#x27;</span>,</span><br><span class=\"line\">          test: <span class=\"regexp\">/[\\\\/]node_modules[\\\\/]/</span>,</span><br><span class=\"line\">          priority: <span class=\"number\">10</span>,</span><br><span class=\"line\">          chunks: <span class=\"string\">&#x27;initial&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        iview: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;chunk-iview&#x27;</span>,</span><br><span class=\"line\">          priority: <span class=\"number\">20</span>,</span><br><span class=\"line\">          test: <span class=\"regexp\">/[\\\\/]node_modules[\\\\/]_?iview(.*)/</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        echarts: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;chunk-echarts&#x27;</span>,</span><br><span class=\"line\">          priority: <span class=\"number\">20</span>,</span><br><span class=\"line\">          test: <span class=\"regexp\">/[\\\\/]node_modules[\\\\/]_?echarts(.*)/</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        commons: &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;chunk-commons&#x27;</span>,</span><br><span class=\"line\">          minChunks: <span class=\"number\">2</span>,</span><br><span class=\"line\">          priority: <span class=\"number\">5</span>,</span><br><span class=\"line\">          chunks: <span class=\"string\">&#x27;initial&#x27;</span>,</span><br><span class=\"line\">          reuseExistingChunk: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"CDN-优化\"><a href=\"#CDN-优化\" class=\"headerlink\" title=\"CDN 优化\"></a>CDN 优化</h3><p>CDN 又叫内容分发网络，通过把资源部署到世界各地，用户在访问时按照就近原则从离用户最近的服务器获取资源，从而加速资源的获取速度。</p>\n<ul>\n<li>随着项目越做越大，依赖的第三方 npm 包越来越多，构建之后的文件也会越来越大。</li>\n<li>再加上又是单页应用，这就会导致在网速较慢或者服务器带宽有限的情况出现长时间的白屏。</li>\n</ul>\n<p>1、将 vue、vue-router、vuex、element-ui 和 axios 这五个库，全部改为通过 CDN 链接获取，在 index.html 里插入 相应链接。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  &lt;link</span><br><span class=\"line\">    rel=&quot;stylesheet&quot;</span><br><span class=\"line\">    href=&quot;https://cdn.bootcss.com/element-ui/2.0.7/theme-chalk/index.css&quot;</span><br><span class=\"line\">  /&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/vuex/3.1.0/vuex.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/vue-router/3.0.2/vue-router.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.bootcss.com/element-ui/2.6.1/index.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>问题</strong>：开发环境也接入 vue.min.js 的 cdn 时无法使用 chrome 的 Vue.js devtools 插件，所以要分环境加载不同的资源。</p>\n<p>2、在 webpack.config.js 配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\"> ···</span><br><span class=\"line\">    externals: &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;vue&#x27;</span>: <span class=\"string\">&#x27;Vue&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;vuex&#x27;</span>: <span class=\"string\">&#x27;Vuex&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;vue-router&#x27;</span>: <span class=\"string\">&#x27;VueRouter&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;element-ui&#x27;</span>: <span class=\"string\">&#x27;ELEMENT&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;Axios&#x27;</span>:<span class=\"string\">&#x27;axios&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>3、卸载依赖的 npm 包，npm uninstall axios element-ui vue vue-router vuex</p>\n<p>4、修改 main.js 文件里之前的引包方式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// import Vue from &#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// import ElementUI from &#x27;element-ui&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// import &#x27;element-ui/lib/theme-chalk/index.css&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// import VueRouter from &#x27;vue-router&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./App.vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> routes <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./router&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> utils <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./utils/Utils&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(ELEMENT)</span><br><span class=\"line\">Vue.use(VueRouter)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  mode: <span class=\"string\">&#x27;hash&#x27;</span>, <span class=\"comment\">//路由的模式</span></span><br><span class=\"line\">  routes</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">  router,</span><br><span class=\"line\">  el: <span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\">  render: <span class=\"function\">(<span class=\"params\">h</span>) =&gt;</span> h(App)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-HappyPack-多进程解析和处理文件\"><a href=\"#使用-HappyPack-多进程解析和处理文件\" class=\"headerlink\" title=\"使用 HappyPack 多进程解析和处理文件\"></a>使用 HappyPack 多进程解析和处理文件</h3><ul>\n<li>由于运行在 Node.js 之上的 Webpack 是单线程模型的，所以 Webpack 需要处理的事情需要一件一件的做，不能多件事一起做。</li>\n<li>HappyPack 就能让 Webpack 把任务分解给多个子进程去并发的执行，子进程处理完后再把结果发送给主进程。</li>\n<li>HappyPack 对 file-loader、url-loader 支持的不友好，所以不建议对该 loader 使用。</li>\n</ul>\n<p>使用方法如下：</p>\n<ol>\n<li>HappyPack 插件安装： npm i -D happypack</li>\n<li>webpack.base.conf.js 文件对 module.rules 进行配置</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">      use: [<span class=\"string\">&#x27;happypack/loader?id=babel&#x27;</span>],</span><br><span class=\"line\">      include: [resolve(<span class=\"string\">&#x27;src&#x27;</span>), resolve(<span class=\"string\">&#x27;test&#x27;</span>)],</span><br><span class=\"line\">      exclude: path.resolve(__dirname, <span class=\"string\">&#x27;node_modules&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      test: <span class=\"regexp\">/\\.vue$/</span>,</span><br><span class=\"line\">      use: [<span class=\"string\">&#x27;happypack/loader?id=vue&#x27;</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>在生产环境 webpack.prod.conf.js 文件进行配置</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> HappyPack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;happypack&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 构造出共享进程池，在进程池中包含5个子进程</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> HappyPackThreadPool = HappyPack.ThreadPool(&#123; <span class=\"attr\">size</span>: <span class=\"number\">5</span> &#125;)</span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HappyPack(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件</span></span><br><span class=\"line\">    id: <span class=\"string\">&#x27;babel&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 如何处理.js文件，用法和Loader配置中一样</span></span><br><span class=\"line\">    loaders: [<span class=\"string\">&#x27;babel-loader?cacheDirectory&#x27;</span>],</span><br><span class=\"line\">    threadPool: HappyPackThreadPool</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"keyword\">new</span> HappyPack(&#123;</span><br><span class=\"line\">    id: <span class=\"string\">&#x27;vue&#x27;</span>, <span class=\"comment\">// 用唯一的标识符id，来代表当前的HappyPack是用来处理一类特定的文件</span></span><br><span class=\"line\">    loaders: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        loader: <span class=\"string\">&#x27;vue-loader&#x27;</span>,</span><br><span class=\"line\">        options: vueLoaderConfig</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    threadPool: HappyPackThreadPool</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-DLLPlugin-提高打包编译速度\"><a href=\"#使用-DLLPlugin-提高打包编译速度\" class=\"headerlink\" title=\"使用 DLLPlugin 提高打包编译速度\"></a>使用 DLLPlugin 提高打包编译速度</h3><p><a href=\"https://webpack.docschina.org/plugins/dll-plugin/\">DLLPlugin</a> 代码一般简单区分为业务代码和第三方库。如果不做处理，每次构建时都需要把所有的代码重新构建一次，耗费大量的时间，在大部分情况下，很多第三方库的代码不会变更（除非是版本升级），这时就可以使用到 dll：将复用性较高的第三方模块打包到动态链接库中，再不升级这些库的情况下，动态库不需要重新打包，每次构建只需要重新打包业务代码。</p>\n<p>DllPlugin 是 webpack 内置的插件，不需要额外安装，直接配置 webpack.dll.config.js 文件，Webpack 已经内置了对动态链接库的支持，需要通过 2 个内置的插件接入，它们分别是：</p>\n<p>DllPlugin 插件：用于打包出一个个单独的动态链接库文件。<br>DllReferencePlugin 插件：用于在主要配置文件中去引入 DllPlugin 插件打包好的动态链接库文件。</p>\n<p>相关链接：</p>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000016567986\">webpack 使用-详解 DllPlugin</a></li>\n<li><a href=\"https://juejin.cn/post/6844903635072057358\">webpack 编译速度提升之 DllPlugin</a></li>\n<li><a href=\"http://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-2%E4%BD%BF%E7%94%A8DllPlugin.html\">4-2 使用 DllPlugin</a></li>\n</ul>\n<h3 id=\"tree-shaking\"><a href=\"#tree-shaking\" class=\"headerlink\" title=\"tree shaking\"></a>tree shaking</h3><p>通过 tree-shaking，将没有使用的模块摇掉，这样来达到删除无用代码的目的。<br>思路： 基于 ES6 提供的模块系统对代码进行静态分析,并将代码中的死代码（dead code）移除的一种技术。因此，利用 Tree Shaking 技术可以很方便地实现我们代码上的优化，减少代码体积。</p>\n<p>摇树删除代码的原理：<br>webpack 基于 ES6 提供的模块系统，对代码的依赖树进行静态分析，把 import &amp; export 标记为 3 类：</p>\n<ul>\n<li>所有 import 标记为/_ harmony import _/</li>\n<li>被使用过的 export 标记为/harmony export([type])/，其中[type]和 webpack 内部有关，可能是 binding，immutable 等；</li>\n<li>没有被使用的 export 标记为/_ unused harmony export [FuncName] _/，其中[FuncName]为 export 的方法名，之后使用 Uglifyjs（或者其他类似的工具）进行代码精简，把没用的都删除。</li>\n</ul>\n<p>为何基于 es6 模块实现（ES6 module 特点：）：</p>\n<ul>\n<li>只能作为模块顶层的语句出现</li>\n<li>import 的模块名只能是字符串常量</li>\n<li>import binding 是 immutable 的</li>\n</ul>\n<p>条件：</p>\n<ol>\n<li>首先源码必须遵循 ES6 的模块规范 (import &amp; export)，如果是 CommonJS 规范 (require) 则无法使用。</li>\n<li>编写的模块代码不能有副作用，如果在代码内部改变了外部的变量则不会被移除。</li>\n</ol>\n<p>配置方法：<br>在 package.json 里添加一个属性：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// sideEffects如果设为false，webpack就会认为所有没用到的函数都是没副作用的，即删了也没关系。</span></span><br><span class=\"line\">    <span class=\"string\">&quot;sideEffects&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 设置黑名单，用于防止误删代码</span></span><br><span class=\"line\">    <span class=\"string\">&quot;sideEffects&quot;</span>: [</span><br><span class=\"line\">        <span class=\"comment\">// 数组里列出黑名单，禁止shaking下列代码</span></span><br><span class=\"line\">        <span class=\"string\">&quot;@babel/polly-fill&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;*.less&quot;</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 其它有副作用的模块</span></span><br><span class=\"line\">        <span class=\"string\">&quot;./src/some-side-effectful-file.js&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>tree-shaking 摇掉代码中未使用的代码 在生产模式下自动开启</p>\n<p>tree-shaking 并不是 webpack 中的某一个配置选项，是一组功能搭配使用后的优化效果，会在生产模式下自动启动</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在开发模式下，设置 usedExports: true ，打包时只会标记出哪些模块没有被使用，不会删除，因为可能会影响 source-map的标记位置的准确性。</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    mode: <span class=\"string\">&#x27;develpoment&#x27;</span>,</span><br><span class=\"line\">    optimization: &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 优化导出的模块</span></span><br><span class=\"line\">        usedExports: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 在生产模式下默认开启 usedExports: true ，打包压缩时就会将没用到的代码移除</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    mode: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">//  这个属性的作用就是集中配置webpack内部的优化功能</span></span><br><span class=\"line\">    optimizition: &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 只导出外部使用的模块成员 负责标记枯树叶</span></span><br><span class=\"line\">        usedExports: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        minimize: <span class=\"literal\">true</span>, <span class=\"comment\">// 自动压缩代码 负责摇掉枯树叶</span></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * webpack打包默认会将一个模块单独打包到一个闭包中</span></span><br><span class=\"line\"><span class=\"comment\">         * webpack3中新增的API 将所有模块都放在一个函数中 ，尽可能将所有模块合并在一起，</span></span><br><span class=\"line\"><span class=\"comment\">         * 提升效率，减少体积  达到作用域提升的效果</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        concatenateModules: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用摇树的注意事项：</p>\n<ul>\n<li>使用 ES6 模块语法编写代码</li>\n<li>工具类函数尽量以单独的形式输出，不要集中成一个对象或者类</li>\n<li>声明 sideEffects</li>\n<li>自己在重构代码时也要注意副作用</li>\n</ul>\n<p>tree-shaking &amp; babel 使用 babel-loader 处理 js 代码会导致 tree-shaking 失效的原因：<br>treeshaking 使用的前提必须是 ES module 组织的代码，也就是说交给 ESMOdule 处理的代码必须是 ESM。当我们使用 babel-loader 处理 js 代码之后就有可能将 ESM 转换 成 commonjs 规范（preset-env 插件工作的时候就会将 esm =&gt; coommonjs）</p>\n<p>解决办法：<br>收到配置 preset-env 的 modules： false,确保不会开启自动转换的插件(在最新版本的 babel-loader 中自动帮我们关闭了转换成 commonjs 规范的功能)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">presets: [</span><br><span class=\"line\">    [&#39;@babel&#x2F;preset-env&#39;, &#123;module: &#39;commonjs&#39;&#125;]</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ol>\n<li>比较实用的方法: 按需加载，优化 loader 配置，关闭生产环境的 sourceMap，CDN 优化。</li>\n<li>vue-cli 已做的优化： 代码压缩，提取公共代码，再优化空间不大。</li>\n<li>根据项目实际需要和自身开发水平选择优化方法，必须避免因为优化产生 bug。</li>\n</ol>"},{"title":"脚手架集成","date":"2019-08-08T06:33:47.000Z","_content":"\n## 为什么需要脚手架？\n\n1、减少重复性的工作，不再需要复制其他项目再删除无关代码，或者从零创建一个项目和文件 。\n2、根据交互动态生成项目结构和配置文件,具备更高的灵活性和人性化定制的能力 。\n3、多人协作更为方便，避免了人工传递文件的繁琐。\n4、集成互联网上的模板，方便自己与他人使用。\n\n<!--more-->\n\n## 思路\n\n开发脚手架可以借鉴 vue-cli 的基本思路。vue-cli 是将项目模板放在 git 上，运行的时候再根据用户交互下载不同的模板，经过模板引擎渲染出来，生成项目。这样讲脚手架和模板分离，就可以各自维护，即使模板有所变动，只需要上传最新的模板即可，而不需要用户去更新脚手架就可以生成最新的项目。\n\n## 脚手架工作流\n\n![network](https://image-static.segmentfault.com/409/200/409200816-5ab3668b4996f_articlex)\n\n## 脚手架问答流\n\n    PS D:\\test> vue create demo1\n\n```\n? Please pick a preset: Manually select features\n? Check the features needed for your project: Babel, Router, Vuex, CSS Pre-processors, Linter\n? Use history mode for router? (Requires proper server setup for index fallback in production) Yes\n? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Less\n? Pick a linter / formatter config: Basic\n? Pick additional lint features: (Press <space> to select, <a> to toggle all, <i> to invert selection)Lint on save\n? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In package.json\n? Save this as a preset for future projects? Yes\n? Save preset as: preset1\n\n📄  Generating README.md...\n\n\n🎉  Successfully created project demo1.\n👉  Get started with the following commands:\n```\n\n## 如何搭建一个脚手架？\n\n![network](/images/cli/脚手架构建流程.png)\n\n## 第三方库的支持\n\n![network](/images/cli/第三方库支持.png)\n\n会使用到的第三方库\n\n- commander.js:可以自动解析命令和参数，用于处理用户输入的命令\n- download-git-repo:下载并提取 git 仓库，用于下载项目模板\n- inquirer.js:通过命令行用户界面集合，用于和用户进行交互\n- handlebars.js:模板引擎，将用户提交的信息动态填充到文件中\n- ora:下载过程久的话，可以用于显示下载中的动画效果\n- chalk:可以给终端的字体加上颜色\n- log-symbols:可以在终端上显示 √ 或 × 等图标\n\n## 搭建步骤：\n\n### 初始化项目\n\n首先创建一个空项目，命名为 mbs-cli，然后新建一个 bin/mbs 文件，再执行 npm init 生成一个 package.json 文件。最后安装上面需要用到的依赖。\n\n```\nnpm install commander download-git-repo inquirer handlebars ora chalk log-symbols cli-table -S\n\n```\n\n### 处理命令行\n\nnode.js 内置了对命令行操作的支持，在 package.json 中的 bin 字段可以定义命令名和关联的执行文件。\n\n在 package.json 中加上 bin 的内容：\n\n```javascript\n{\n\t\"name\": “mbs-cli\",\n\t\"version\": \"1.0.0\",\n    \"description\": \"中后台系统脚手架\",\n\t\"bin\": {\n\t\t\"mbs\": \"bin/mbs\"\n     }\n }\n```\n\n首先在 mbs 文件 中引入相关依赖模块：\n\n```javascript\n#!/usr/bin/env node\n\nconst { existsSync } = require('fs') //系统内置模块 主要用来操作文件\nconst program = require('commander') //自动的解析命令和参数，用于处理用户输入的命令。\nconst chalk = require('chalk') //给终端的字体加上颜色。\nconst symbols = require('log-symbols') //在终端上显示出 √ 或 × 等的图标。\n\nconst res = (command) => resolve(__dirname, '../commands/', command)\n```\n\n### 配置 !/usr/bin/env node 的作用\n\n指定用 node 执行脚本文件 ,usr/bin/env 解决了不同的用户 node 路径不同的问题，可以让系统动态的去查找 node 来执行你的脚本文件。\n\n## nodejs 依赖模块介绍与用法\n\n### commander（指挥官）\n\n自动地解析命令和参数，用于处理用户输入的命令。\n\n- usage(): 设置 usage 值\n\n- command(): 定义一个命令名字\n\n- description(): 设置 description 值\n\n- option(): 定义参数，需要设置“关键字”和“描述”，关键字包括“简写”和“全写”两部分，以”,”,”|”,”空格”做分隔。\n\n- parse(): 解析命令行参数 argv\n\n- action(): 注册一个 callback 函数\n\n- version() : 终端输出版本号\n\n```javascript\nPS D:\\yameiproject\\mbs-cli> mbs --help\nUsage: mbs <command>\n\nOptions:\n  -V, --version  output the version number\n  -h, --help     output usage information\n\nCommands:\n  add|a          Add a new template\n  init|i         Generate a new project\n  init|ins       Generate a simple project\n  create|c       Generate a new project\n  list|l         List all the templates\n```\n\n定义常规命令：\n\n```javascript\nconst program = require('commander') //自动的解析命令和参数，用于处理用户输入的命令。\n\nprogram.usage('<command>')\n\nprogram.version(require('../package').version)\n```\n\ninit 命令逻辑：\n\n```javascript\nprogram\n  .command('init <name>')\n  .description('Generate a new project')\n  .alias('i')\n  .action((name) => {\n    if (!existsSync(name)) {\n      require(res('init'))\n    } else {\n      // 错误提示项目已存在，避免覆盖原有项目\n      console.log(symbols.error, chalk.red('Project already exists'))\n    }\n  })\n```\n\n处理用户输入命令：\n\n```javascript\nprogram\n  .command('init <name>')\n  .description('Generate a new project')\n  .alias('i')\n  .action((name) => {\n    if (!existsSync(name)) {\n      require(res('init'))\n    } else {\n      // 错误提示项目已存在，避免覆盖原有项目\n      console.log(symbols.error, chalk.red('Project already exists'))\n    }\n  })\n```\n\n最后处理解析命令行参数 ：\n\n```javascript\nprogram.parse(process.argv)\n\n//process:一个全局对象,控制有关信息，控制node.js的进程\n//program.parse:解析命令之中的参数，根据上面定义好的规则执行相关命令\n//process.argv:该属性返回一个数组,这个数组包含了启动node.js进程时的命令行参数\n\nif (!program.args.length) {\n  program.help()\n}\n```\n\n### inquirer（询问者）\n\n通用的命令行用户界面集合，用于和用户进行交互。由于交互的问题种类不同，inquirer 为每个问题提供很多参数：\n\n```\ntype：表示提问的类型，包括：input, confirm, list, rawlist, expand, checkbox, password, editor；\nname: 存储当前问题回答的变量；\nmessage：问题的描述；\ndefault：默认值；\nchoices：列表选项，在某些type下可用，并且包含一个分隔符(separator)；\nvalidate：对用户的回答进行校验；\nfilter：对用户的回答进行过滤处理，返回处理后的值；\nwhen：根据前面问题的回答，判断当前问题是否需要被回答；\nprefix：修改message默认前缀；\nsuffix：修改message默认后缀。\n```\n\n语法结构\n\n```javascript\nconst inquirer = require('inquirer')\n\nconst promptList = [\n  // 具体交互内容\n]\n\ninquirer.prompt(promptList).then((answers) => {\n  console.log(answers) // 返回的结果\n})\n```\n\ninput 类型\n\n```javascript\nconst inquirer = require('inquirer');\ninquirer.prompt([\n    {\n        type: 'input',\n        name: 'author',\n        message: '请输入作者名称'\n    }\n]).then((answers) => {\n    console.log(answers.author);\n})\n\n效果：\n\n```\n\n效果：\n\nconfirm 类型\n\n```javascript\nconst promptList = [\n  {\n    type: 'confirm',\n    message: '是否使用监听？',\n    name: 'watch',\n    prefix: '前缀'\n  },\n  {\n    type: 'confirm',\n    message: '是否进行文件过滤？',\n    name: 'filter',\n    suffix: '后缀',\n    when: function (answers) {\n      // 当watch为true的时候才会提问当前问题\n      return answers.watch\n    }\n  }\n]\n```\n\n效果：\n\nlist 类型\n\n```javascript\nconst promptList = [\n  {\n    type: 'list',\n    message: '请选择一种水果:',\n    name: 'fruit',\n    choices: ['Apple', 'Pear', 'Banana'],\n    filter: function (val) {\n      // 使用filter将回答变为小写\n      return val.toLowerCase()\n    }\n  }\n]\n```\n\n效果：\n\n### download-git-repo\n\ndownload-git-repo 支持从 Github、Gitlab 和 Bitbucket 下载仓库，\n\n```\ndownload(repository, destination, options, callback)\n```\n\nrepository\n\n```\n- GitHub - github:owner/name or simply owner/name\n- GitLab - gitlab:owner/name\n- Bitbucket - bitbucket:owner/name\n- Direct - direct:url:branch\n```\n\ndestination\n\n```\n The file path to download the repository to. xxxxxxxxxx \n```\n\noptions\n\n```\n boolean default false - If true use git clone instead of an http download. While this can be a bit slower, it does allow private repositories to be used if the appropriate SSH keys are setup.\n```\n\ncallback\n\n```\n The callback function as function (err).\n```\n\nexample:\n\n```\ndownload('direct:https://gitlab.com/flipxfx/download-git-repo-fixture/repository/archive.zip', 'test/tmp', function (err) {\n  console.log(err ? 'Error' : 'Success')\n})\n```\n\n### ora （loading 动效）\n\n用于显示下载中的动画效果\n\n```javascript\nconst ora = require('ora')\n// 开始下载\nconst spinner = ora('正在下载模板...')\nspinner.start()\n// 下载失败调用\nspinner.fail()\n// 下载成功调用\nspinner.succeed()\n```\n\n```\n\\ Downloading template...\n```\n\n### chalk（字体颜色）\n\n通过 chalk 来为打印信息加上样式，比如成功信息为绿色，失败信息为红色，这样子会让用户更加容易分辨，同时也让终端的显示更加的好看：\n\n```javascript\nconst chalk = require('chalk')\nconsole.log(chalk.green('项目创建成功'))\nconsole.log(chalk.red('项目创建失败'))\nconst ora = require('ora')\n// 开始下载\nconst spinner = ora('正在下载模板...')\nspinner.start()\n// 下载失败调用\nspinner.fail()\n// 下载成功调用\nspinner.succeed()\n```\n\n### log-symbols（日志符号）\n\n使用 log-symbols 在信息前面加上 √ 或 × 等的图标，优化视觉体验：\n\n```javascript\nconsole.log(\n  symbols.success,\n  chalk.green('New project has been initialize successfully!')\n)\n```\n\n## handlebars\n\nhandlebars 可以对仓库的模板中的 package.json 文件做一些动态修改 :\n\n```javascript\n{\n  \"name\": \"{{name}}\",\n  \"version\": \"1.0.0\",\n  \"description\": \"{{description}}\",\n  \"scripts\": {\n    \"dev\": \"webpack-dev-server  --config build/webpack.dev.conf.js\",\n    \"start\": \"npm run dev\",\n    \"build\": \"node build/build.js\"\n  },\n  \"author\": \"{{author}}\",\n  \"license\": \"ISC\",\n  ...\n```\n\n并在下载模板完成之后将用户输入的答案渲染到 package.json 中\n\n```javascript\nconst fileName = './package.json;'\nconst meta = {\n  name,\n  description: answers.description,\n  author: answers.author\n}\nconst content = readFileSync(fileName).toString()\nconst result = handlebars.compile(content)(meta)\nwriteFileSync(fileName, result)\n```\n\n### cli-table\n\n表格\n\n```javascript\nconst table = new Table({\n  head: ['Template Name', 'Branch', 'Url'],\n  style: {\n    head: ['green']\n  }\n})\n```\n\n### 配置下载模板\n\n```javascript\ndownload('http://git.ym/g-web/mbs-cli.git#master', jay/${name}, {clone: true}, (err) => {\n          if(err){\n            spinner.fail();\n            console.log(symbols.error, chalk.red(err));\n          }else{\n            spinner.succeed();\n            const fileName = `${name}/package.json`;\n            const meta = {\n              name,\n              description: answers.description,\n              author: answers.author\n            }\n            if(fs.existsSync(fileName)){\n              const content = fs.readFileSync(fileName).toString();\n              const result = handlebars.compile(content)(meta);\n              fs.writeFileSync(fileName, result);\n            }\n            console.log(symbols.success, chalk.green('Project initialization completed'));\n          }\n})\n```\n\n### 命令行交互\n\n命令行交互功能可以在用户执行 init 命令后，向用户提出问题，接收用户的输入并作出相应的处理。使用 inquirer.js 实现。\n\n```javascript\nlet tplList = require(`${__dirname}/../templates`)\n\nconst questions = [\n  {\n    type: 'input',\n    name: 'project',\n    message: 'Project name:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'Project name is required!'\n    }\n  },\n  {\n    type: 'input',\n    name: 'author',\n    message: 'Please enter the author name:'\n  },\n  {\n    type: 'input',\n    name: 'description',\n    message: 'Please enter a description of the project:',\n    default: 'a project do for you'\n  },\n  {\n    type: 'input',\n    name: 'place',\n    message: 'Where to init the project:',\n    default: './'\n  }\n]\n\nmodule.exports = prompt(questions).then((answers) => {\n  const spinner = ora('Downloading template...')\n  spinner.start()\n  download(\n    `direct:${tplList['template1']['url']}#${tplList['template1']['branch']}`,\n    `${answers.place}/${answers.project}`,\n    { clone: false },\n    (err) => {\n      if (err) {\n        spinner.fail()\n        console.log(symbols.error, chalk.red(err))\n      } else {\n        spinner.succeed()\n        const fileName = `${answers.project}/package.json`\n        const meta = {\n          name: answers.project,\n          description: answers.description,\n          author: answers.author\n        }\n        console.log(meta)\n        if (existsSync(fileName)) {\n          const content = readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          writeFileSync(fileName, result)\n        }\n        console.log(\n          symbols.success,\n          chalk.green('New project has been initialize successfully!')\n        )\n      }\n    }\n  )\n})\n```\n\n### 渲染模板\n\n用 handlebars 的语法对 模板中的 package.json 文件做一些修改 ：\n\n```javascript\n{\n  \"name\": \"{{name}}\",\n  \"version\": \"1.0.0\",\n  \"description\": \"{{description}}\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"author\": \"{{author}}\",\n  \"license\": \"ISC\"\n}\n```\n\n并在下载模板完成之后将用户输入的答案渲染到 package.json 中\n\n```javascript\nprogram\n  .version('1.0.0', '-v, --version')\n  .command('init <name>')\n  .action((name) => {\n    inquirer\n      .prompt([\n        {\n          name: 'description',\n          message: '请输入项目描述'\n        },\n        {\n          name: 'author',\n          message: '请输入作者名称'\n        }\n      ])\n      .then((answers) => {\n        download('xxxxx#master', name, { clone: true }, (err) => {\n          const meta = {\n            name,\n            description: answers.description,\n            author: answers.author\n          }\n          const fileName = `${name}/package.json`\n          const content = fs.readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          fs.writeFileSync(fileName, result)\n        })\n      })\n  })\n```\n\n这里使用了 node.js 的文件模块 fs，将 handlebars 渲染完后的模板重新写入到文件中。\n\n### 视觉美化\n\n在用户输入答案之后，开始下载模板，这时候使用 ora 来提示用户正在下载中：\n\n```\nconst ora = require('ora');\n// 开始下载\nconst spinner = ora('正在下载模板...');\nspinner.start();\n// 下载失败调用\nspinner.fail();\n// 下载成功调用\nspinner.succeed();\n```\n\n## 简单版脚手架完整示例\n\n```javascript\n#!/usr/bin/env node\nconst fs = require('fs');//系统内置模块 主要用来操作文件\nconst program = require('commander');//自动的解析命令和参数，用于处理用户输入的命令。\nconst download = require('download-git-repo');//下载并提取 git 仓库，用于下载项目模板。\nconst handlebars = require('handlebars');//模板引擎，将用户提交的信息动态填充到文件中。\nconst inquirer = require('inquirer');//通用的命令行用户界面集合，用于和用户进行交互。\nconst ora = require('ora');//下载过程久的话，可以用于显示下载中的动画效果。\nconst chalk = require('chalk');//给终端的字体加上颜色。\nconst symbols = require('log-symbols');//在终端上显示出 √ 或 × 等的图标。\n\nprogram.version('1.0.4', '-v, --version')\n  .command('init <name>')\n  .action((name) => {\n    if(!fs.existsSync(name)){\n      inquirer.prompt([//prompt 提示\n        {\n          name: 'description',\n          message: 'Please enter a description of the project:'\n        },\n        {\n          name: 'author',\n          message: 'Please enter the author name:'\n        }\n      ]).then((answers) => {\n        const spinner = ora('Downloading template...');\n        spinner.start();\n        /**\n         * 一级目录  name\n         * 二级目录 jay/${name}\n         */\n        download('http://git.ym/g-web/mbs-cli.git#master', jay/${name}, {clone: true}, (err) => {\n          if(err){\n            spinner.fail();\n            console.log(symbols.error, chalk.red(err));\n          }else{\n            spinner.succeed();\n            const fileName = `${name}/package.json`;\n            const meta = {\n              name,\n              description: answers.description,\n              author: answers.author\n            }\n            if(fs.existsSync(fileName)){\n              const content = fs.readFileSync(fileName).toString();\n              const result = handlebars.compile(content)(meta);\n              fs.writeFileSync(fileName, result);\n            }\n            console.log(symbols.success, chalk.green('Project initialization completed'));\n          }\n        })\n      })\n    }else{\n      // 错误提示项目已存在，避免覆盖原有项目\n      console.log(symbols.error, chalk.red('Project already exists'));\n    }\n  })\nprogram.parse(process.argv);\n```\n\n### mbs-cli 核心命令\n\n```javascript\n  Commands:\n\n    add|a             Add a new template\n    list|l            List all the templates\n    init|i            Generate a new project\n    create|c          Generate a new project by choose a template\n    init simple|ins   Generate a simple project\n\n  Options:\n\n    -h, --help     output usage information\n    -V, --version  output the version number\n```\n\n### 入口文件 mbs\n\n```javascript\n#!/usr/bin/env node\n\nprocess.env.NODE_PATH = __dirname + '/../node_modules/'\n\nconst { resolve } = require('path')\nconst chalk = require('chalk')\nconst { existsSync } = require('fs')\nconst symbols = require('log-symbols')\nconst program = require('commander')\n\nconst res = (command) => resolve(__dirname, '../commands/', command)\n\nprogram.usage('<command>')\n\nprogram.version(require('../package').version)\n\nprogram\n  .command('add')\n  .description('Add a new template')\n  .alias('a')\n  .action(() => {\n    require(res('add'))\n  })\n\nprogram\n  .command('init')\n  .description('Generate a new project')\n  .alias('i')\n  .action(() => {\n    require(res('init'))\n  })\n\nprogram\n  .command('create')\n  .description('Generate a new project')\n  .alias('c')\n  .action(() => {\n    require(res('create'))\n  })\n\nprogram\n  .command('list')\n  .description('List all the templates')\n  .alias('l')\n  .action(() => {\n    require(res('list'))\n  })\n\nprogram.parse(process.argv)\n\nif (!program.args.length) {\n  program.help() //如果没有输入参数，终端显示帮助\n}\n```\n\n### init 命令\n\n```javascript\nlet tplList = require(`${__dirname}/../templates`)\n\nconst questions = [\n  {\n    type: 'input',\n    name: 'project',\n    message: 'Project name:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'Project name is required!'\n    }\n  },\n  {\n    type: 'input',\n    name: 'author',\n    message: 'author name:'\n  },\n  {\n    type: 'input',\n    name: 'description',\n    message: 'description of the project:',\n    default: 'a simple spa project'\n  },\n  {\n    type: 'input',\n    name: 'place',\n    message: 'Where to init the project:',\n    default: './'\n  }\n]\n\nmodule.exports = prompt(questions).then((answers) => {\n  const spinner = ora('Downloading template...')\n  spinner.start()\n  download(\n    `direct:${tplList['template1']['url']}#${tplList['template1']['branch']}`,\n    `${answers.place}/${answers.project}`,\n    { clone: true },\n    (err) => {\n      if (err) {\n        spinner.fail()\n        console.log(symbols.error, chalk.red(err))\n      } else {\n        spinner.succeed()\n        const fileName = `${answers.project}/package.json`\n        const meta = {\n          name: answers.project,\n          description: answers.description,\n          author: answers.author\n        }\n        console.log(meta)\n        if (existsSync(fileName)) {\n          console.log('come in...')\n          const content = readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          writeFileSync(fileName, result)\n        }\n        console.log(\n          symbols.success,\n          chalk.green('New project has been initialize successfully!')\n        )\n      }\n    }\n  )\n})\n```\n\n### init simple 命令\n\n```javascript\nlet tplList = require(`${__dirname}/../templates`)\n\nconst question = [\n  {\n    name: 'description',\n    message: 'Please enter a description of the project:'\n  },\n  {\n    name: 'author',\n    message: 'Please enter the author name:'\n  }\n]\n\nmodule.exports = prompt(question).then((answers) => {\n  const spinner = ora('Downloading template...')\n  spinner.start()\n  download(\n    `direct:${tplList['template2']['url']}#${tplList['template2']['branch']}`,\n    `./${name}`,\n    { clone: true },\n    (err) => {\n      if (err) {\n        spinner.fail()\n        console.log(symbols.error, chalk.red(err))\n      } else {\n        spinner.succeed()\n        const fileName = `${name}/package.json`\n        const meta = {\n          name,\n          description: answers.description,\n          author: answers.author\n        }\n        if (existsSync(fileName)) {\n          const content = readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          writeFileSync(fileName, result)\n        }\n        console.log(\n          symbols.success,\n          chalk.green('Project initialization completed')\n        )\n      }\n    }\n  )\n})\n```\n\n### create 命令\n\n```javascript\nlet templateList = require(`${__dirname}/../templates`)\nlet rmTempList = require(`${__dirname}/../config/remote-templates`)\n\nconst choices = rmTempList.map((template) => {\n  return {\n    name: `${template.name} - ${template.description}`,\n    value: template.name\n  }\n})\n\nconst questions = [\n  {\n    type: 'input',\n    name: 'project',\n    message: 'Project name:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'Project name is required!'\n    }\n  },\n  {\n    type: 'list',\n    name: 'template',\n    choices,\n    message: 'Choose template you want:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'template name is required!'\n    }\n  },\n  {\n    type: 'input',\n    name: 'author',\n    message: 'author name:'\n  },\n  {\n    type: 'input',\n    name: 'description',\n    message: 'description of the project:',\n    default: ''\n  },\n  {\n    type: 'input',\n    name: 'place',\n    message: 'Where to init the project:',\n    default: './'\n  }\n]\n\nmodule.exports = prompt(questions).then((answers) => {\n  const spinner = ora('Downloading template...')\n  spinner.start()\n  const template = rmTempList.filter((item) => {\n    return answers.template.includes(item.name) && item\n  })[0]\n  download(\n    `direct:${template.url}#${template.branch}`,\n    `${answers.place}/${answers.project}`,\n    { clone: true },\n    (err) => {\n      if (err) {\n        spinner.fail()\n        console.log(symbols.error, chalk.red(err))\n      } else {\n        spinner.succeed()\n        const fileName = `${answers.project}/package.json`\n        const meta = {\n          name: answers.project,\n          description: answers.description,\n          author: answers.author\n        }\n        console.log(meta)\n        if (existsSync(fileName)) {\n          const content = readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          writeFileSync(fileName, result)\n        }\n        console.log(\n          symbols.success,\n          chalk.green('New project has been initialize successfully!')\n        )\n      }\n    }\n  )\n})\n```\n\n效果\n\n```\n$ mbs create\n\n? Project name: demo\n? Choose template you want: (Use arrow keys)\n> vue-webpack-pc - 基于webpack构建的vue项目模板\n  react-webpack-pc - 基于webpack构建的react项目模板\n  angular-webpack-pc - 基于webpack构建的angular项目模板\n  discover your template - 更多海量模板等你发掘与收藏.\n? Choose template you want: vue-webpack-pc - 基于webpack构建的vue项目模板\n? Please enter the author name: jay\n? Please enter a description of the project: a simple spa project\n? Where to init the project: ./\n√ Downloading template...\n√ New project has been initialize successfully!\n```\n\n### add 命令\n\n```javascript\nconst { prompt } = require('inquirer')\nconst { writeFile } = require('fs')\nconst { showTable } = require(`${__dirname}/../utils`)\n\nlet tempList = require(`${__dirname}/../templates`)\n\nconst question = [\n  {\n    type: 'input',\n    name: 'name',\n    message: 'Set the custom name of the template:',\n    validate(val) {\n      if (tempList[val]) {\n        return 'Template is existed!'\n      } else if (val === '') {\n        return 'Name is required!'\n      } else {\n        return true\n      }\n    }\n  },\n  {\n    type: 'input',\n    name: 'branch',\n    message: 'branch of the template:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'branch is required!'\n    }\n  },\n  {\n    type: 'input',\n    name: 'url',\n    message: 'Url of the template:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'Url is required!'\n    }\n  }\n]\n\nmodule.exports = prompt(question).then(({ name, branch, url }) => {\n  tempList[name] = {}\n  tempList[name]['branch'] = branch\n  tempList[name]['url'] = url\n\n  writeFile(\n    `${__dirname}/../templates.json`,\n    JSON.stringify(tempList),\n    'utf-8',\n    (err) => {\n      if (err) {\n        console.log(err)\n      }\n      showTable(tempList, 'New template has been added successfully!')\n    }\n  )\n})\n```\n\n效果\n\n```\n$ mbs add\n\n? Set the custom name of the template: template1\n? branch of the template: master\n? Url of the template: http://git.ym/Chenmh/bs-init-template.git\n┌───────────────┬────────┬───────────────────────────────────────────┐\n│ Template Name │ Branch │ Url                                       │\n├───────────────┼────────┼───────────────────────────────────────────┤\n│ template1     │ master │ http://git.ym/Chenmh/bs-init-template.git │\n└───────────────┴────────┴───────────────────────────────────────────┘\n✔ New template has been added successfully!\n```\n\n`mbs` use [download-git-repo](https://github.com/flipxfx/download-git-repo) to down load git repos. After answering 3 questions, you'll add a new template to `mbs`.\n\n### list 命令\n\n```javascript\nconst { showTable } = require(`${__dirname}/../utils`)\n\nlet tempList = require(`${__dirname}/../templates`)\n\nmodule.exports = showTable(tempList)\n```\n\n```javascript\nfunction showTable(tempList) {\n  const list = Object.keys(tempList)\n  if (list.length) {\n    list.forEach((key) => {\n      table.push([key, tempList[key]['branch'], tempList[key]['url']])\n      if (table.length === list.length) {\n        process.exit()\n      }\n    })\n  } else {\n    console.log(table.toString())\n    process.exit()\n  }\n}\n```\n\n效果\n\n```\n$ mbs list\n\n┌───────────────┬──────────┬───────────────────────────────────────────┐\n│ Template Name │ Branch   │ Url                                       │\n├───────────────┼──────────┼───────────────────────────────────────────┤\n│ template1     │ standard │ http://git.ym/Chenmh/bs-init-template.git │\n├───────────────┼──────────┼───────────────────────────────────────────┤\n│ template2     │ simple   │ http://git.ym/Chenmh/bs-init-template.git │\n└───────────────┴──────────┴───────────────────────────────────────────┘\n```\n\nutils.js\n\n```javascript\nconst Table = require('cli-table')\nconst chalk = require('chalk')\n\nconst table = new Table({\n  head: ['Template Name', 'Branch', 'Url'],\n  style: {\n    head: ['green']\n  }\n})\n\nfunction showTable(tempList, Exp) {\n  const list = Object.keys(tempList)\n  if (list.length) {\n    list.forEach((key) => {\n      table.push([key, tempList[key]['branch'], tempList[key]['url']])\n      if (table.length === list.length) {\n        console.log(table.toString())\n        if (Exp) {\n          console.log(chalk.green(`\\u2714 ${Exp}`))\n        }\n        process.exit()\n      }\n    })\n  } else {\n    console.log(table.toString())\n    if (Exp) {\n      console.log(chalk.green(`\\u2714 ${Exp}`))\n    }\n    process.exit()\n  }\n}\n\nexports.showTable = showTable\n```\n\n#脚手架发布\n\n### npm 登录\n\n```\nPS D:\\yameiproject\\mbs-cli> npm login\nUsername: chenyumen\nPassword:\nEmail: (this IS public) 13172050157@126.com\nLogged in as chenyumen on https://registry.npmjs.org/.\n```\n\n### npm 发布\n\n```\nPS D:\\yameiproject\\mbs-cli> npm publish\nnpm notice\nnpm notice package: mbs-cli@1.0.4\nnpm notice === Tarball Contents ===\nnpm notice 573B  package.json\nnpm notice 2.5kB index.js\nnpm notice 193B  脚手架.md\nnpm notice === Tarball Details ===\nnpm notice name:          mbs-cli\nnpm notice version:       1.0.4\nnpm notice package size:  1.8 kB\nnpm notice total files:   3\nnpm notice\n+ mbs-cli@1.0.4\n```\n\n## 本地 npm 模块调试\n\n### 开启调试模式\n\n`npm link`命令可以将一个任意位置的`npm包`链接到全局执行环境，从而在任意位置使用命令行都可以直接运行该 npm 包。\n\n```\nC:\\Users\\yamei\\AppData\\Roaming\\npm\\mbs -> C:\\Users\\yamei\\AppData\\Roaming\\npm\\node_modules\\mbs-cli\\bin\\mbs\nC:\\Users\\yamei\\AppData\\Roaming\\npm\\node_modules\\mbs-cli -> D:\\yameiproject\\mbs-cli\n```\n\n### 关闭调试模式\n\n如果你的项目不再需要该模块，可以在项目目录内使用 npm unlink 命令，删除符号链接\n\n## 延申\n\n1、丰富命令行交互，以适应更多变的需求。\n\n2、webpack 配置文件隐藏优化。\n\n## 模板集成常用功能\n\n- 登录、注销\n- DashBord\n- 表格\n- Tab 选项卡\n- 图表\n- 富文本编辑器\n- 三级菜单\n- 国际化\n- 图片拖拽、裁剪上传\n- 列表拖拽排序\n- 权限管理\n- 404/403/500\n\n## 模板项目结构\n\n├── build 构建服务和 webpack 配置\n|—— build.js webpack 打包服务\n|—— webpack.base.conf.js webpack 基本通用配置\n|—— webpack.dev.conf.js webpack 开发环境配置\n|—— webpack.prod.conf.js webpack 生产环境配置\n├── config 构建项目不同环境的配置\n├── public 项目打包文件存放目录\n├── index.html 项目入口文件\n├── package.json 项目配置文件\n├── .babelrc babel 配置文件\n├── .gitignore git 忽略文件\n├── postcss.config.js postcss 配置文件\n├── src 项目目录\n├── assets 静态资源  \n ├── components 集成组件目录  \n |—— json json 目录\n|—— lang 中英文目录\n|—— router vue 路由配置\n|—— service ajax 请求配置\n|—— store vuex 配置\n|—— styles 公共样式\n|—— utils 工具类\n|—— views 页面组件目录\n|—— App.vue vue 实例入口\n|—— main.js 项目构建入口\n","source":"_posts/脚手架集成.md","raw":"---\ntitle: 脚手架集成\ndate: 2019-08-08 14:33:47\ncategories: 工具\n---\n\n## 为什么需要脚手架？\n\n1、减少重复性的工作，不再需要复制其他项目再删除无关代码，或者从零创建一个项目和文件 。\n2、根据交互动态生成项目结构和配置文件,具备更高的灵活性和人性化定制的能力 。\n3、多人协作更为方便，避免了人工传递文件的繁琐。\n4、集成互联网上的模板，方便自己与他人使用。\n\n<!--more-->\n\n## 思路\n\n开发脚手架可以借鉴 vue-cli 的基本思路。vue-cli 是将项目模板放在 git 上，运行的时候再根据用户交互下载不同的模板，经过模板引擎渲染出来，生成项目。这样讲脚手架和模板分离，就可以各自维护，即使模板有所变动，只需要上传最新的模板即可，而不需要用户去更新脚手架就可以生成最新的项目。\n\n## 脚手架工作流\n\n![network](https://image-static.segmentfault.com/409/200/409200816-5ab3668b4996f_articlex)\n\n## 脚手架问答流\n\n    PS D:\\test> vue create demo1\n\n```\n? Please pick a preset: Manually select features\n? Check the features needed for your project: Babel, Router, Vuex, CSS Pre-processors, Linter\n? Use history mode for router? (Requires proper server setup for index fallback in production) Yes\n? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Less\n? Pick a linter / formatter config: Basic\n? Pick additional lint features: (Press <space> to select, <a> to toggle all, <i> to invert selection)Lint on save\n? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In package.json\n? Save this as a preset for future projects? Yes\n? Save preset as: preset1\n\n📄  Generating README.md...\n\n\n🎉  Successfully created project demo1.\n👉  Get started with the following commands:\n```\n\n## 如何搭建一个脚手架？\n\n![network](/images/cli/脚手架构建流程.png)\n\n## 第三方库的支持\n\n![network](/images/cli/第三方库支持.png)\n\n会使用到的第三方库\n\n- commander.js:可以自动解析命令和参数，用于处理用户输入的命令\n- download-git-repo:下载并提取 git 仓库，用于下载项目模板\n- inquirer.js:通过命令行用户界面集合，用于和用户进行交互\n- handlebars.js:模板引擎，将用户提交的信息动态填充到文件中\n- ora:下载过程久的话，可以用于显示下载中的动画效果\n- chalk:可以给终端的字体加上颜色\n- log-symbols:可以在终端上显示 √ 或 × 等图标\n\n## 搭建步骤：\n\n### 初始化项目\n\n首先创建一个空项目，命名为 mbs-cli，然后新建一个 bin/mbs 文件，再执行 npm init 生成一个 package.json 文件。最后安装上面需要用到的依赖。\n\n```\nnpm install commander download-git-repo inquirer handlebars ora chalk log-symbols cli-table -S\n\n```\n\n### 处理命令行\n\nnode.js 内置了对命令行操作的支持，在 package.json 中的 bin 字段可以定义命令名和关联的执行文件。\n\n在 package.json 中加上 bin 的内容：\n\n```javascript\n{\n\t\"name\": “mbs-cli\",\n\t\"version\": \"1.0.0\",\n    \"description\": \"中后台系统脚手架\",\n\t\"bin\": {\n\t\t\"mbs\": \"bin/mbs\"\n     }\n }\n```\n\n首先在 mbs 文件 中引入相关依赖模块：\n\n```javascript\n#!/usr/bin/env node\n\nconst { existsSync } = require('fs') //系统内置模块 主要用来操作文件\nconst program = require('commander') //自动的解析命令和参数，用于处理用户输入的命令。\nconst chalk = require('chalk') //给终端的字体加上颜色。\nconst symbols = require('log-symbols') //在终端上显示出 √ 或 × 等的图标。\n\nconst res = (command) => resolve(__dirname, '../commands/', command)\n```\n\n### 配置 !/usr/bin/env node 的作用\n\n指定用 node 执行脚本文件 ,usr/bin/env 解决了不同的用户 node 路径不同的问题，可以让系统动态的去查找 node 来执行你的脚本文件。\n\n## nodejs 依赖模块介绍与用法\n\n### commander（指挥官）\n\n自动地解析命令和参数，用于处理用户输入的命令。\n\n- usage(): 设置 usage 值\n\n- command(): 定义一个命令名字\n\n- description(): 设置 description 值\n\n- option(): 定义参数，需要设置“关键字”和“描述”，关键字包括“简写”和“全写”两部分，以”,”,”|”,”空格”做分隔。\n\n- parse(): 解析命令行参数 argv\n\n- action(): 注册一个 callback 函数\n\n- version() : 终端输出版本号\n\n```javascript\nPS D:\\yameiproject\\mbs-cli> mbs --help\nUsage: mbs <command>\n\nOptions:\n  -V, --version  output the version number\n  -h, --help     output usage information\n\nCommands:\n  add|a          Add a new template\n  init|i         Generate a new project\n  init|ins       Generate a simple project\n  create|c       Generate a new project\n  list|l         List all the templates\n```\n\n定义常规命令：\n\n```javascript\nconst program = require('commander') //自动的解析命令和参数，用于处理用户输入的命令。\n\nprogram.usage('<command>')\n\nprogram.version(require('../package').version)\n```\n\ninit 命令逻辑：\n\n```javascript\nprogram\n  .command('init <name>')\n  .description('Generate a new project')\n  .alias('i')\n  .action((name) => {\n    if (!existsSync(name)) {\n      require(res('init'))\n    } else {\n      // 错误提示项目已存在，避免覆盖原有项目\n      console.log(symbols.error, chalk.red('Project already exists'))\n    }\n  })\n```\n\n处理用户输入命令：\n\n```javascript\nprogram\n  .command('init <name>')\n  .description('Generate a new project')\n  .alias('i')\n  .action((name) => {\n    if (!existsSync(name)) {\n      require(res('init'))\n    } else {\n      // 错误提示项目已存在，避免覆盖原有项目\n      console.log(symbols.error, chalk.red('Project already exists'))\n    }\n  })\n```\n\n最后处理解析命令行参数 ：\n\n```javascript\nprogram.parse(process.argv)\n\n//process:一个全局对象,控制有关信息，控制node.js的进程\n//program.parse:解析命令之中的参数，根据上面定义好的规则执行相关命令\n//process.argv:该属性返回一个数组,这个数组包含了启动node.js进程时的命令行参数\n\nif (!program.args.length) {\n  program.help()\n}\n```\n\n### inquirer（询问者）\n\n通用的命令行用户界面集合，用于和用户进行交互。由于交互的问题种类不同，inquirer 为每个问题提供很多参数：\n\n```\ntype：表示提问的类型，包括：input, confirm, list, rawlist, expand, checkbox, password, editor；\nname: 存储当前问题回答的变量；\nmessage：问题的描述；\ndefault：默认值；\nchoices：列表选项，在某些type下可用，并且包含一个分隔符(separator)；\nvalidate：对用户的回答进行校验；\nfilter：对用户的回答进行过滤处理，返回处理后的值；\nwhen：根据前面问题的回答，判断当前问题是否需要被回答；\nprefix：修改message默认前缀；\nsuffix：修改message默认后缀。\n```\n\n语法结构\n\n```javascript\nconst inquirer = require('inquirer')\n\nconst promptList = [\n  // 具体交互内容\n]\n\ninquirer.prompt(promptList).then((answers) => {\n  console.log(answers) // 返回的结果\n})\n```\n\ninput 类型\n\n```javascript\nconst inquirer = require('inquirer');\ninquirer.prompt([\n    {\n        type: 'input',\n        name: 'author',\n        message: '请输入作者名称'\n    }\n]).then((answers) => {\n    console.log(answers.author);\n})\n\n效果：\n\n```\n\n效果：\n\nconfirm 类型\n\n```javascript\nconst promptList = [\n  {\n    type: 'confirm',\n    message: '是否使用监听？',\n    name: 'watch',\n    prefix: '前缀'\n  },\n  {\n    type: 'confirm',\n    message: '是否进行文件过滤？',\n    name: 'filter',\n    suffix: '后缀',\n    when: function (answers) {\n      // 当watch为true的时候才会提问当前问题\n      return answers.watch\n    }\n  }\n]\n```\n\n效果：\n\nlist 类型\n\n```javascript\nconst promptList = [\n  {\n    type: 'list',\n    message: '请选择一种水果:',\n    name: 'fruit',\n    choices: ['Apple', 'Pear', 'Banana'],\n    filter: function (val) {\n      // 使用filter将回答变为小写\n      return val.toLowerCase()\n    }\n  }\n]\n```\n\n效果：\n\n### download-git-repo\n\ndownload-git-repo 支持从 Github、Gitlab 和 Bitbucket 下载仓库，\n\n```\ndownload(repository, destination, options, callback)\n```\n\nrepository\n\n```\n- GitHub - github:owner/name or simply owner/name\n- GitLab - gitlab:owner/name\n- Bitbucket - bitbucket:owner/name\n- Direct - direct:url:branch\n```\n\ndestination\n\n```\n The file path to download the repository to. xxxxxxxxxx \n```\n\noptions\n\n```\n boolean default false - If true use git clone instead of an http download. While this can be a bit slower, it does allow private repositories to be used if the appropriate SSH keys are setup.\n```\n\ncallback\n\n```\n The callback function as function (err).\n```\n\nexample:\n\n```\ndownload('direct:https://gitlab.com/flipxfx/download-git-repo-fixture/repository/archive.zip', 'test/tmp', function (err) {\n  console.log(err ? 'Error' : 'Success')\n})\n```\n\n### ora （loading 动效）\n\n用于显示下载中的动画效果\n\n```javascript\nconst ora = require('ora')\n// 开始下载\nconst spinner = ora('正在下载模板...')\nspinner.start()\n// 下载失败调用\nspinner.fail()\n// 下载成功调用\nspinner.succeed()\n```\n\n```\n\\ Downloading template...\n```\n\n### chalk（字体颜色）\n\n通过 chalk 来为打印信息加上样式，比如成功信息为绿色，失败信息为红色，这样子会让用户更加容易分辨，同时也让终端的显示更加的好看：\n\n```javascript\nconst chalk = require('chalk')\nconsole.log(chalk.green('项目创建成功'))\nconsole.log(chalk.red('项目创建失败'))\nconst ora = require('ora')\n// 开始下载\nconst spinner = ora('正在下载模板...')\nspinner.start()\n// 下载失败调用\nspinner.fail()\n// 下载成功调用\nspinner.succeed()\n```\n\n### log-symbols（日志符号）\n\n使用 log-symbols 在信息前面加上 √ 或 × 等的图标，优化视觉体验：\n\n```javascript\nconsole.log(\n  symbols.success,\n  chalk.green('New project has been initialize successfully!')\n)\n```\n\n## handlebars\n\nhandlebars 可以对仓库的模板中的 package.json 文件做一些动态修改 :\n\n```javascript\n{\n  \"name\": \"{{name}}\",\n  \"version\": \"1.0.0\",\n  \"description\": \"{{description}}\",\n  \"scripts\": {\n    \"dev\": \"webpack-dev-server  --config build/webpack.dev.conf.js\",\n    \"start\": \"npm run dev\",\n    \"build\": \"node build/build.js\"\n  },\n  \"author\": \"{{author}}\",\n  \"license\": \"ISC\",\n  ...\n```\n\n并在下载模板完成之后将用户输入的答案渲染到 package.json 中\n\n```javascript\nconst fileName = './package.json;'\nconst meta = {\n  name,\n  description: answers.description,\n  author: answers.author\n}\nconst content = readFileSync(fileName).toString()\nconst result = handlebars.compile(content)(meta)\nwriteFileSync(fileName, result)\n```\n\n### cli-table\n\n表格\n\n```javascript\nconst table = new Table({\n  head: ['Template Name', 'Branch', 'Url'],\n  style: {\n    head: ['green']\n  }\n})\n```\n\n### 配置下载模板\n\n```javascript\ndownload('http://git.ym/g-web/mbs-cli.git#master', jay/${name}, {clone: true}, (err) => {\n          if(err){\n            spinner.fail();\n            console.log(symbols.error, chalk.red(err));\n          }else{\n            spinner.succeed();\n            const fileName = `${name}/package.json`;\n            const meta = {\n              name,\n              description: answers.description,\n              author: answers.author\n            }\n            if(fs.existsSync(fileName)){\n              const content = fs.readFileSync(fileName).toString();\n              const result = handlebars.compile(content)(meta);\n              fs.writeFileSync(fileName, result);\n            }\n            console.log(symbols.success, chalk.green('Project initialization completed'));\n          }\n})\n```\n\n### 命令行交互\n\n命令行交互功能可以在用户执行 init 命令后，向用户提出问题，接收用户的输入并作出相应的处理。使用 inquirer.js 实现。\n\n```javascript\nlet tplList = require(`${__dirname}/../templates`)\n\nconst questions = [\n  {\n    type: 'input',\n    name: 'project',\n    message: 'Project name:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'Project name is required!'\n    }\n  },\n  {\n    type: 'input',\n    name: 'author',\n    message: 'Please enter the author name:'\n  },\n  {\n    type: 'input',\n    name: 'description',\n    message: 'Please enter a description of the project:',\n    default: 'a project do for you'\n  },\n  {\n    type: 'input',\n    name: 'place',\n    message: 'Where to init the project:',\n    default: './'\n  }\n]\n\nmodule.exports = prompt(questions).then((answers) => {\n  const spinner = ora('Downloading template...')\n  spinner.start()\n  download(\n    `direct:${tplList['template1']['url']}#${tplList['template1']['branch']}`,\n    `${answers.place}/${answers.project}`,\n    { clone: false },\n    (err) => {\n      if (err) {\n        spinner.fail()\n        console.log(symbols.error, chalk.red(err))\n      } else {\n        spinner.succeed()\n        const fileName = `${answers.project}/package.json`\n        const meta = {\n          name: answers.project,\n          description: answers.description,\n          author: answers.author\n        }\n        console.log(meta)\n        if (existsSync(fileName)) {\n          const content = readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          writeFileSync(fileName, result)\n        }\n        console.log(\n          symbols.success,\n          chalk.green('New project has been initialize successfully!')\n        )\n      }\n    }\n  )\n})\n```\n\n### 渲染模板\n\n用 handlebars 的语法对 模板中的 package.json 文件做一些修改 ：\n\n```javascript\n{\n  \"name\": \"{{name}}\",\n  \"version\": \"1.0.0\",\n  \"description\": \"{{description}}\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"author\": \"{{author}}\",\n  \"license\": \"ISC\"\n}\n```\n\n并在下载模板完成之后将用户输入的答案渲染到 package.json 中\n\n```javascript\nprogram\n  .version('1.0.0', '-v, --version')\n  .command('init <name>')\n  .action((name) => {\n    inquirer\n      .prompt([\n        {\n          name: 'description',\n          message: '请输入项目描述'\n        },\n        {\n          name: 'author',\n          message: '请输入作者名称'\n        }\n      ])\n      .then((answers) => {\n        download('xxxxx#master', name, { clone: true }, (err) => {\n          const meta = {\n            name,\n            description: answers.description,\n            author: answers.author\n          }\n          const fileName = `${name}/package.json`\n          const content = fs.readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          fs.writeFileSync(fileName, result)\n        })\n      })\n  })\n```\n\n这里使用了 node.js 的文件模块 fs，将 handlebars 渲染完后的模板重新写入到文件中。\n\n### 视觉美化\n\n在用户输入答案之后，开始下载模板，这时候使用 ora 来提示用户正在下载中：\n\n```\nconst ora = require('ora');\n// 开始下载\nconst spinner = ora('正在下载模板...');\nspinner.start();\n// 下载失败调用\nspinner.fail();\n// 下载成功调用\nspinner.succeed();\n```\n\n## 简单版脚手架完整示例\n\n```javascript\n#!/usr/bin/env node\nconst fs = require('fs');//系统内置模块 主要用来操作文件\nconst program = require('commander');//自动的解析命令和参数，用于处理用户输入的命令。\nconst download = require('download-git-repo');//下载并提取 git 仓库，用于下载项目模板。\nconst handlebars = require('handlebars');//模板引擎，将用户提交的信息动态填充到文件中。\nconst inquirer = require('inquirer');//通用的命令行用户界面集合，用于和用户进行交互。\nconst ora = require('ora');//下载过程久的话，可以用于显示下载中的动画效果。\nconst chalk = require('chalk');//给终端的字体加上颜色。\nconst symbols = require('log-symbols');//在终端上显示出 √ 或 × 等的图标。\n\nprogram.version('1.0.4', '-v, --version')\n  .command('init <name>')\n  .action((name) => {\n    if(!fs.existsSync(name)){\n      inquirer.prompt([//prompt 提示\n        {\n          name: 'description',\n          message: 'Please enter a description of the project:'\n        },\n        {\n          name: 'author',\n          message: 'Please enter the author name:'\n        }\n      ]).then((answers) => {\n        const spinner = ora('Downloading template...');\n        spinner.start();\n        /**\n         * 一级目录  name\n         * 二级目录 jay/${name}\n         */\n        download('http://git.ym/g-web/mbs-cli.git#master', jay/${name}, {clone: true}, (err) => {\n          if(err){\n            spinner.fail();\n            console.log(symbols.error, chalk.red(err));\n          }else{\n            spinner.succeed();\n            const fileName = `${name}/package.json`;\n            const meta = {\n              name,\n              description: answers.description,\n              author: answers.author\n            }\n            if(fs.existsSync(fileName)){\n              const content = fs.readFileSync(fileName).toString();\n              const result = handlebars.compile(content)(meta);\n              fs.writeFileSync(fileName, result);\n            }\n            console.log(symbols.success, chalk.green('Project initialization completed'));\n          }\n        })\n      })\n    }else{\n      // 错误提示项目已存在，避免覆盖原有项目\n      console.log(symbols.error, chalk.red('Project already exists'));\n    }\n  })\nprogram.parse(process.argv);\n```\n\n### mbs-cli 核心命令\n\n```javascript\n  Commands:\n\n    add|a             Add a new template\n    list|l            List all the templates\n    init|i            Generate a new project\n    create|c          Generate a new project by choose a template\n    init simple|ins   Generate a simple project\n\n  Options:\n\n    -h, --help     output usage information\n    -V, --version  output the version number\n```\n\n### 入口文件 mbs\n\n```javascript\n#!/usr/bin/env node\n\nprocess.env.NODE_PATH = __dirname + '/../node_modules/'\n\nconst { resolve } = require('path')\nconst chalk = require('chalk')\nconst { existsSync } = require('fs')\nconst symbols = require('log-symbols')\nconst program = require('commander')\n\nconst res = (command) => resolve(__dirname, '../commands/', command)\n\nprogram.usage('<command>')\n\nprogram.version(require('../package').version)\n\nprogram\n  .command('add')\n  .description('Add a new template')\n  .alias('a')\n  .action(() => {\n    require(res('add'))\n  })\n\nprogram\n  .command('init')\n  .description('Generate a new project')\n  .alias('i')\n  .action(() => {\n    require(res('init'))\n  })\n\nprogram\n  .command('create')\n  .description('Generate a new project')\n  .alias('c')\n  .action(() => {\n    require(res('create'))\n  })\n\nprogram\n  .command('list')\n  .description('List all the templates')\n  .alias('l')\n  .action(() => {\n    require(res('list'))\n  })\n\nprogram.parse(process.argv)\n\nif (!program.args.length) {\n  program.help() //如果没有输入参数，终端显示帮助\n}\n```\n\n### init 命令\n\n```javascript\nlet tplList = require(`${__dirname}/../templates`)\n\nconst questions = [\n  {\n    type: 'input',\n    name: 'project',\n    message: 'Project name:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'Project name is required!'\n    }\n  },\n  {\n    type: 'input',\n    name: 'author',\n    message: 'author name:'\n  },\n  {\n    type: 'input',\n    name: 'description',\n    message: 'description of the project:',\n    default: 'a simple spa project'\n  },\n  {\n    type: 'input',\n    name: 'place',\n    message: 'Where to init the project:',\n    default: './'\n  }\n]\n\nmodule.exports = prompt(questions).then((answers) => {\n  const spinner = ora('Downloading template...')\n  spinner.start()\n  download(\n    `direct:${tplList['template1']['url']}#${tplList['template1']['branch']}`,\n    `${answers.place}/${answers.project}`,\n    { clone: true },\n    (err) => {\n      if (err) {\n        spinner.fail()\n        console.log(symbols.error, chalk.red(err))\n      } else {\n        spinner.succeed()\n        const fileName = `${answers.project}/package.json`\n        const meta = {\n          name: answers.project,\n          description: answers.description,\n          author: answers.author\n        }\n        console.log(meta)\n        if (existsSync(fileName)) {\n          console.log('come in...')\n          const content = readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          writeFileSync(fileName, result)\n        }\n        console.log(\n          symbols.success,\n          chalk.green('New project has been initialize successfully!')\n        )\n      }\n    }\n  )\n})\n```\n\n### init simple 命令\n\n```javascript\nlet tplList = require(`${__dirname}/../templates`)\n\nconst question = [\n  {\n    name: 'description',\n    message: 'Please enter a description of the project:'\n  },\n  {\n    name: 'author',\n    message: 'Please enter the author name:'\n  }\n]\n\nmodule.exports = prompt(question).then((answers) => {\n  const spinner = ora('Downloading template...')\n  spinner.start()\n  download(\n    `direct:${tplList['template2']['url']}#${tplList['template2']['branch']}`,\n    `./${name}`,\n    { clone: true },\n    (err) => {\n      if (err) {\n        spinner.fail()\n        console.log(symbols.error, chalk.red(err))\n      } else {\n        spinner.succeed()\n        const fileName = `${name}/package.json`\n        const meta = {\n          name,\n          description: answers.description,\n          author: answers.author\n        }\n        if (existsSync(fileName)) {\n          const content = readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          writeFileSync(fileName, result)\n        }\n        console.log(\n          symbols.success,\n          chalk.green('Project initialization completed')\n        )\n      }\n    }\n  )\n})\n```\n\n### create 命令\n\n```javascript\nlet templateList = require(`${__dirname}/../templates`)\nlet rmTempList = require(`${__dirname}/../config/remote-templates`)\n\nconst choices = rmTempList.map((template) => {\n  return {\n    name: `${template.name} - ${template.description}`,\n    value: template.name\n  }\n})\n\nconst questions = [\n  {\n    type: 'input',\n    name: 'project',\n    message: 'Project name:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'Project name is required!'\n    }\n  },\n  {\n    type: 'list',\n    name: 'template',\n    choices,\n    message: 'Choose template you want:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'template name is required!'\n    }\n  },\n  {\n    type: 'input',\n    name: 'author',\n    message: 'author name:'\n  },\n  {\n    type: 'input',\n    name: 'description',\n    message: 'description of the project:',\n    default: ''\n  },\n  {\n    type: 'input',\n    name: 'place',\n    message: 'Where to init the project:',\n    default: './'\n  }\n]\n\nmodule.exports = prompt(questions).then((answers) => {\n  const spinner = ora('Downloading template...')\n  spinner.start()\n  const template = rmTempList.filter((item) => {\n    return answers.template.includes(item.name) && item\n  })[0]\n  download(\n    `direct:${template.url}#${template.branch}`,\n    `${answers.place}/${answers.project}`,\n    { clone: true },\n    (err) => {\n      if (err) {\n        spinner.fail()\n        console.log(symbols.error, chalk.red(err))\n      } else {\n        spinner.succeed()\n        const fileName = `${answers.project}/package.json`\n        const meta = {\n          name: answers.project,\n          description: answers.description,\n          author: answers.author\n        }\n        console.log(meta)\n        if (existsSync(fileName)) {\n          const content = readFileSync(fileName).toString()\n          const result = handlebars.compile(content)(meta)\n          writeFileSync(fileName, result)\n        }\n        console.log(\n          symbols.success,\n          chalk.green('New project has been initialize successfully!')\n        )\n      }\n    }\n  )\n})\n```\n\n效果\n\n```\n$ mbs create\n\n? Project name: demo\n? Choose template you want: (Use arrow keys)\n> vue-webpack-pc - 基于webpack构建的vue项目模板\n  react-webpack-pc - 基于webpack构建的react项目模板\n  angular-webpack-pc - 基于webpack构建的angular项目模板\n  discover your template - 更多海量模板等你发掘与收藏.\n? Choose template you want: vue-webpack-pc - 基于webpack构建的vue项目模板\n? Please enter the author name: jay\n? Please enter a description of the project: a simple spa project\n? Where to init the project: ./\n√ Downloading template...\n√ New project has been initialize successfully!\n```\n\n### add 命令\n\n```javascript\nconst { prompt } = require('inquirer')\nconst { writeFile } = require('fs')\nconst { showTable } = require(`${__dirname}/../utils`)\n\nlet tempList = require(`${__dirname}/../templates`)\n\nconst question = [\n  {\n    type: 'input',\n    name: 'name',\n    message: 'Set the custom name of the template:',\n    validate(val) {\n      if (tempList[val]) {\n        return 'Template is existed!'\n      } else if (val === '') {\n        return 'Name is required!'\n      } else {\n        return true\n      }\n    }\n  },\n  {\n    type: 'input',\n    name: 'branch',\n    message: 'branch of the template:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'branch is required!'\n    }\n  },\n  {\n    type: 'input',\n    name: 'url',\n    message: 'Url of the template:',\n    validate(val) {\n      if (val !== '') {\n        return true\n      }\n      return 'Url is required!'\n    }\n  }\n]\n\nmodule.exports = prompt(question).then(({ name, branch, url }) => {\n  tempList[name] = {}\n  tempList[name]['branch'] = branch\n  tempList[name]['url'] = url\n\n  writeFile(\n    `${__dirname}/../templates.json`,\n    JSON.stringify(tempList),\n    'utf-8',\n    (err) => {\n      if (err) {\n        console.log(err)\n      }\n      showTable(tempList, 'New template has been added successfully!')\n    }\n  )\n})\n```\n\n效果\n\n```\n$ mbs add\n\n? Set the custom name of the template: template1\n? branch of the template: master\n? Url of the template: http://git.ym/Chenmh/bs-init-template.git\n┌───────────────┬────────┬───────────────────────────────────────────┐\n│ Template Name │ Branch │ Url                                       │\n├───────────────┼────────┼───────────────────────────────────────────┤\n│ template1     │ master │ http://git.ym/Chenmh/bs-init-template.git │\n└───────────────┴────────┴───────────────────────────────────────────┘\n✔ New template has been added successfully!\n```\n\n`mbs` use [download-git-repo](https://github.com/flipxfx/download-git-repo) to down load git repos. After answering 3 questions, you'll add a new template to `mbs`.\n\n### list 命令\n\n```javascript\nconst { showTable } = require(`${__dirname}/../utils`)\n\nlet tempList = require(`${__dirname}/../templates`)\n\nmodule.exports = showTable(tempList)\n```\n\n```javascript\nfunction showTable(tempList) {\n  const list = Object.keys(tempList)\n  if (list.length) {\n    list.forEach((key) => {\n      table.push([key, tempList[key]['branch'], tempList[key]['url']])\n      if (table.length === list.length) {\n        process.exit()\n      }\n    })\n  } else {\n    console.log(table.toString())\n    process.exit()\n  }\n}\n```\n\n效果\n\n```\n$ mbs list\n\n┌───────────────┬──────────┬───────────────────────────────────────────┐\n│ Template Name │ Branch   │ Url                                       │\n├───────────────┼──────────┼───────────────────────────────────────────┤\n│ template1     │ standard │ http://git.ym/Chenmh/bs-init-template.git │\n├───────────────┼──────────┼───────────────────────────────────────────┤\n│ template2     │ simple   │ http://git.ym/Chenmh/bs-init-template.git │\n└───────────────┴──────────┴───────────────────────────────────────────┘\n```\n\nutils.js\n\n```javascript\nconst Table = require('cli-table')\nconst chalk = require('chalk')\n\nconst table = new Table({\n  head: ['Template Name', 'Branch', 'Url'],\n  style: {\n    head: ['green']\n  }\n})\n\nfunction showTable(tempList, Exp) {\n  const list = Object.keys(tempList)\n  if (list.length) {\n    list.forEach((key) => {\n      table.push([key, tempList[key]['branch'], tempList[key]['url']])\n      if (table.length === list.length) {\n        console.log(table.toString())\n        if (Exp) {\n          console.log(chalk.green(`\\u2714 ${Exp}`))\n        }\n        process.exit()\n      }\n    })\n  } else {\n    console.log(table.toString())\n    if (Exp) {\n      console.log(chalk.green(`\\u2714 ${Exp}`))\n    }\n    process.exit()\n  }\n}\n\nexports.showTable = showTable\n```\n\n#脚手架发布\n\n### npm 登录\n\n```\nPS D:\\yameiproject\\mbs-cli> npm login\nUsername: chenyumen\nPassword:\nEmail: (this IS public) 13172050157@126.com\nLogged in as chenyumen on https://registry.npmjs.org/.\n```\n\n### npm 发布\n\n```\nPS D:\\yameiproject\\mbs-cli> npm publish\nnpm notice\nnpm notice package: mbs-cli@1.0.4\nnpm notice === Tarball Contents ===\nnpm notice 573B  package.json\nnpm notice 2.5kB index.js\nnpm notice 193B  脚手架.md\nnpm notice === Tarball Details ===\nnpm notice name:          mbs-cli\nnpm notice version:       1.0.4\nnpm notice package size:  1.8 kB\nnpm notice total files:   3\nnpm notice\n+ mbs-cli@1.0.4\n```\n\n## 本地 npm 模块调试\n\n### 开启调试模式\n\n`npm link`命令可以将一个任意位置的`npm包`链接到全局执行环境，从而在任意位置使用命令行都可以直接运行该 npm 包。\n\n```\nC:\\Users\\yamei\\AppData\\Roaming\\npm\\mbs -> C:\\Users\\yamei\\AppData\\Roaming\\npm\\node_modules\\mbs-cli\\bin\\mbs\nC:\\Users\\yamei\\AppData\\Roaming\\npm\\node_modules\\mbs-cli -> D:\\yameiproject\\mbs-cli\n```\n\n### 关闭调试模式\n\n如果你的项目不再需要该模块，可以在项目目录内使用 npm unlink 命令，删除符号链接\n\n## 延申\n\n1、丰富命令行交互，以适应更多变的需求。\n\n2、webpack 配置文件隐藏优化。\n\n## 模板集成常用功能\n\n- 登录、注销\n- DashBord\n- 表格\n- Tab 选项卡\n- 图表\n- 富文本编辑器\n- 三级菜单\n- 国际化\n- 图片拖拽、裁剪上传\n- 列表拖拽排序\n- 权限管理\n- 404/403/500\n\n## 模板项目结构\n\n├── build 构建服务和 webpack 配置\n|—— build.js webpack 打包服务\n|—— webpack.base.conf.js webpack 基本通用配置\n|—— webpack.dev.conf.js webpack 开发环境配置\n|—— webpack.prod.conf.js webpack 生产环境配置\n├── config 构建项目不同环境的配置\n├── public 项目打包文件存放目录\n├── index.html 项目入口文件\n├── package.json 项目配置文件\n├── .babelrc babel 配置文件\n├── .gitignore git 忽略文件\n├── postcss.config.js postcss 配置文件\n├── src 项目目录\n├── assets 静态资源  \n ├── components 集成组件目录  \n |—— json json 目录\n|—— lang 中英文目录\n|—— router vue 路由配置\n|—— service ajax 请求配置\n|—— store vuex 配置\n|—— styles 公共样式\n|—— utils 工具类\n|—— views 页面组件目录\n|—— App.vue vue 实例入口\n|—— main.js 项目构建入口\n","slug":"脚手架集成","published":1,"updated":"2021-05-13T14:06:04.234Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckon1h1xt003il5v0fa0u4v24","content":"<h2 id=\"为什么需要脚手架？\"><a href=\"#为什么需要脚手架？\" class=\"headerlink\" title=\"为什么需要脚手架？\"></a>为什么需要脚手架？</h2><p>1、减少重复性的工作，不再需要复制其他项目再删除无关代码，或者从零创建一个项目和文件 。<br>2、根据交互动态生成项目结构和配置文件,具备更高的灵活性和人性化定制的能力 。<br>3、多人协作更为方便，避免了人工传递文件的繁琐。<br>4、集成互联网上的模板，方便自己与他人使用。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>开发脚手架可以借鉴 vue-cli 的基本思路。vue-cli 是将项目模板放在 git 上，运行的时候再根据用户交互下载不同的模板，经过模板引擎渲染出来，生成项目。这样讲脚手架和模板分离，就可以各自维护，即使模板有所变动，只需要上传最新的模板即可，而不需要用户去更新脚手架就可以生成最新的项目。</p>\n<h2 id=\"脚手架工作流\"><a href=\"#脚手架工作流\" class=\"headerlink\" title=\"脚手架工作流\"></a>脚手架工作流</h2><p><img src=\"https://image-static.segmentfault.com/409/200/409200816-5ab3668b4996f_articlex\" alt=\"network\"></p>\n<h2 id=\"脚手架问答流\"><a href=\"#脚手架问答流\" class=\"headerlink\" title=\"脚手架问答流\"></a>脚手架问答流</h2><pre><code>PS D:\\test&gt; vue create demo1\n</code></pre>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">? Please pick a preset: Manually select features</span><br><span class=\"line\">? Check the features needed for your project: Babel, Router, Vuex, CSS Pre-processors, Linter</span><br><span class=\"line\">? Use history mode for router? (Requires proper server setup for index fallback in production) Yes</span><br><span class=\"line\">? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Less</span><br><span class=\"line\">? Pick a linter &#x2F; formatter config: Basic</span><br><span class=\"line\">? Pick additional lint features: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Lint on save</span><br><span class=\"line\">? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In package.json</span><br><span class=\"line\">? Save this as a preset for future projects? Yes</span><br><span class=\"line\">? Save preset as: preset1</span><br><span class=\"line\"></span><br><span class=\"line\">📄  Generating README.md...</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">🎉  Successfully created project demo1.</span><br><span class=\"line\">👉  Get started with the following commands:</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"如何搭建一个脚手架？\"><a href=\"#如何搭建一个脚手架？\" class=\"headerlink\" title=\"如何搭建一个脚手架？\"></a>如何搭建一个脚手架？</h2><p><img src=\"/images/cli/%E8%84%9A%E6%89%8B%E6%9E%B6%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B.png\" alt=\"network\"></p>\n<h2 id=\"第三方库的支持\"><a href=\"#第三方库的支持\" class=\"headerlink\" title=\"第三方库的支持\"></a>第三方库的支持</h2><p><img src=\"/images/cli/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%94%AF%E6%8C%81.png\" alt=\"network\"></p>\n<p>会使用到的第三方库</p>\n<ul>\n<li>commander.js:可以自动解析命令和参数，用于处理用户输入的命令</li>\n<li>download-git-repo:下载并提取 git 仓库，用于下载项目模板</li>\n<li>inquirer.js:通过命令行用户界面集合，用于和用户进行交互</li>\n<li>handlebars.js:模板引擎，将用户提交的信息动态填充到文件中</li>\n<li>ora:下载过程久的话，可以用于显示下载中的动画效果</li>\n<li>chalk:可以给终端的字体加上颜色</li>\n<li>log-symbols:可以在终端上显示 √ 或 × 等图标</li>\n</ul>\n<h2 id=\"搭建步骤：\"><a href=\"#搭建步骤：\" class=\"headerlink\" title=\"搭建步骤：\"></a>搭建步骤：</h2><h3 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h3><p>首先创建一个空项目，命名为 mbs-cli，然后新建一个 bin/mbs 文件，再执行 npm init 生成一个 package.json 文件。最后安装上面需要用到的依赖。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install commander download-git-repo inquirer handlebars ora chalk log-symbols cli-table -S</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"处理命令行\"><a href=\"#处理命令行\" class=\"headerlink\" title=\"处理命令行\"></a>处理命令行</h3><p>node.js 内置了对命令行操作的支持，在 package.json 中的 bin 字段可以定义命令名和关联的执行文件。</p>\n<p>在 package.json 中加上 bin 的内容：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"string\">&quot;name&quot;</span>: “mbs-cli<span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">\t&quot;</span>version<span class=\"string\">&quot;: &quot;</span><span class=\"number\">1.0</span><span class=\"number\">.0</span><span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;</span>description<span class=\"string\">&quot;: &quot;</span>中后台系统脚手架<span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">\t&quot;</span>bin<span class=\"string\">&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">\t\t&quot;</span>mbs<span class=\"string\">&quot;: &quot;</span>bin/mbs<span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">     &#125;</span></span><br><span class=\"line\"><span class=\"string\"> &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>首先在 mbs 文件 中引入相关依赖模块：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env node</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; existsSync &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>) <span class=\"comment\">//系统内置模块 主要用来操作文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> program = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;commander&#x27;</span>) <span class=\"comment\">//自动的解析命令和参数，用于处理用户输入的命令。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>) <span class=\"comment\">//给终端的字体加上颜色。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> symbols = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;log-symbols&#x27;</span>) <span class=\"comment\">//在终端上显示出 √ 或 × 等的图标。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"function\">(<span class=\"params\">command</span>) =&gt;</span> resolve(__dirname, <span class=\"string\">&#x27;../commands/&#x27;</span>, command)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-usr-bin-env-node-的作用\"><a href=\"#配置-usr-bin-env-node-的作用\" class=\"headerlink\" title=\"配置 !/usr/bin/env node 的作用\"></a>配置 !/usr/bin/env node 的作用</h3><p>指定用 node 执行脚本文件 ,usr/bin/env 解决了不同的用户 node 路径不同的问题，可以让系统动态的去查找 node 来执行你的脚本文件。</p>\n<h2 id=\"nodejs-依赖模块介绍与用法\"><a href=\"#nodejs-依赖模块介绍与用法\" class=\"headerlink\" title=\"nodejs 依赖模块介绍与用法\"></a>nodejs 依赖模块介绍与用法</h2><h3 id=\"commander（指挥官）\"><a href=\"#commander（指挥官）\" class=\"headerlink\" title=\"commander（指挥官）\"></a>commander（指挥官）</h3><p>自动地解析命令和参数，用于处理用户输入的命令。</p>\n<ul>\n<li><p>usage(): 设置 usage 值</p>\n</li>\n<li><p>command(): 定义一个命令名字</p>\n</li>\n<li><p>description(): 设置 description 值</p>\n</li>\n<li><p>option(): 定义参数，需要设置“关键字”和“描述”，关键字包括“简写”和“全写”两部分，以”,”,”|”,”空格”做分隔。</p>\n</li>\n<li><p>parse(): 解析命令行参数 argv</p>\n</li>\n<li><p>action(): 注册一个 callback 函数</p>\n</li>\n<li><p>version() : 终端输出版本号</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\yameiproject\\mbs-cli&gt; mbs --help</span><br><span class=\"line\">Usage: mbs &lt;command&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  -V, --version  output the version number</span><br><span class=\"line\">  -h, --help     output usage information</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\">  add|a          Add a <span class=\"keyword\">new</span> template</span><br><span class=\"line\">  init|i         Generate a <span class=\"keyword\">new</span> project</span><br><span class=\"line\">  init|ins       Generate a simple project</span><br><span class=\"line\">  create|c       Generate a <span class=\"keyword\">new</span> project</span><br><span class=\"line\">  list|l         List all the templates</span><br></pre></td></tr></table></figure>\n\n<p>定义常规命令：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> program = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;commander&#x27;</span>) <span class=\"comment\">//自动的解析命令和参数，用于处理用户输入的命令。</span></span><br><span class=\"line\"></span><br><span class=\"line\">program.usage(<span class=\"string\">&#x27;&lt;command&gt;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">program.version(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../package&#x27;</span>).version)</span><br></pre></td></tr></table></figure>\n\n<p>init 命令逻辑：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init &lt;name&gt;&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Generate a new project&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;i&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!existsSync(name)) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;init&#x27;</span>))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 错误提示项目已存在，避免覆盖原有项目</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(<span class=\"string\">&#x27;Project already exists&#x27;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>处理用户输入命令：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init &lt;name&gt;&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Generate a new project&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;i&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!existsSync(name)) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;init&#x27;</span>))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 错误提示项目已存在，避免覆盖原有项目</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(<span class=\"string\">&#x27;Project already exists&#x27;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>最后处理解析命令行参数 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">program.parse(process.argv)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//process:一个全局对象,控制有关信息，控制node.js的进程</span></span><br><span class=\"line\"><span class=\"comment\">//program.parse:解析命令之中的参数，根据上面定义好的规则执行相关命令</span></span><br><span class=\"line\"><span class=\"comment\">//process.argv:该属性返回一个数组,这个数组包含了启动node.js进程时的命令行参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!program.args.length) &#123;</span><br><span class=\"line\">  program.help()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"inquirer（询问者）\"><a href=\"#inquirer（询问者）\" class=\"headerlink\" title=\"inquirer（询问者）\"></a>inquirer（询问者）</h3><p>通用的命令行用户界面集合，用于和用户进行交互。由于交互的问题种类不同，inquirer 为每个问题提供很多参数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type：表示提问的类型，包括：input, confirm, list, rawlist, expand, checkbox, password, editor；</span><br><span class=\"line\">name: 存储当前问题回答的变量；</span><br><span class=\"line\">message：问题的描述；</span><br><span class=\"line\">default：默认值；</span><br><span class=\"line\">choices：列表选项，在某些type下可用，并且包含一个分隔符(separator)；</span><br><span class=\"line\">validate：对用户的回答进行校验；</span><br><span class=\"line\">filter：对用户的回答进行过滤处理，返回处理后的值；</span><br><span class=\"line\">when：根据前面问题的回答，判断当前问题是否需要被回答；</span><br><span class=\"line\">prefix：修改message默认前缀；</span><br><span class=\"line\">suffix：修改message默认后缀。</span><br></pre></td></tr></table></figure>\n\n<p>语法结构</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> inquirer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;inquirer&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> promptList = [</span><br><span class=\"line\">  <span class=\"comment\">// 具体交互内容</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">inquirer.prompt(promptList).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(answers) <span class=\"comment\">// 返回的结果</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>input 类型</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> inquirer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;inquirer&#x27;</span>);</span><br><span class=\"line\">inquirer.prompt([</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">        message: <span class=\"string\">&#x27;请输入作者名称&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(answers.author);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">效果：</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<p>confirm 类型</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> promptList = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;confirm&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;是否使用监听？&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;watch&#x27;</span>,</span><br><span class=\"line\">    prefix: <span class=\"string\">&#x27;前缀&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;confirm&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;是否进行文件过滤？&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;filter&#x27;</span>,</span><br><span class=\"line\">    suffix: <span class=\"string\">&#x27;后缀&#x27;</span>,</span><br><span class=\"line\">    when: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">answers</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 当watch为true的时候才会提问当前问题</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> answers.watch</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<p>list 类型</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> promptList = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;list&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;请选择一种水果:&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;fruit&#x27;</span>,</span><br><span class=\"line\">    choices: [<span class=\"string\">&#x27;Apple&#x27;</span>, <span class=\"string\">&#x27;Pear&#x27;</span>, <span class=\"string\">&#x27;Banana&#x27;</span>],</span><br><span class=\"line\">    filter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 使用filter将回答变为小写</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> val.toLowerCase()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<h3 id=\"download-git-repo\"><a href=\"#download-git-repo\" class=\"headerlink\" title=\"download-git-repo\"></a>download-git-repo</h3><p>download-git-repo 支持从 Github、Gitlab 和 Bitbucket 下载仓库，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">download(repository, destination, options, callback)</span><br></pre></td></tr></table></figure>\n\n<p>repository</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- GitHub - github:owner&#x2F;name or simply owner&#x2F;name</span><br><span class=\"line\">- GitLab - gitlab:owner&#x2F;name</span><br><span class=\"line\">- Bitbucket - bitbucket:owner&#x2F;name</span><br><span class=\"line\">- Direct - direct:url:branch</span><br></pre></td></tr></table></figure>\n\n<p>destination</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The file path to download the repository to. xxxxxxxxxx </span><br></pre></td></tr></table></figure>\n\n<p>options</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">boolean default false - If true use git clone instead of an http download. While this can be a bit slower, it does allow private repositories to be used if the appropriate SSH keys are setup.</span><br></pre></td></tr></table></figure>\n\n<p>callback</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The callback function as function (err).</span><br></pre></td></tr></table></figure>\n\n<p>example:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">download(&#39;direct:https:&#x2F;&#x2F;gitlab.com&#x2F;flipxfx&#x2F;download-git-repo-fixture&#x2F;repository&#x2F;archive.zip&#39;, &#39;test&#x2F;tmp&#39;, function (err) &#123;</span><br><span class=\"line\">  console.log(err ? &#39;Error&#39; : &#39;Success&#39;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ora-（loading-动效）\"><a href=\"#ora-（loading-动效）\" class=\"headerlink\" title=\"ora （loading 动效）\"></a>ora （loading 动效）</h3><p>用于显示下载中的动画效果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ora = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ora&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 开始下载</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;正在下载模板...&#x27;</span>)</span><br><span class=\"line\">spinner.start()</span><br><span class=\"line\"><span class=\"comment\">// 下载失败调用</span></span><br><span class=\"line\">spinner.fail()</span><br><span class=\"line\"><span class=\"comment\">// 下载成功调用</span></span><br><span class=\"line\">spinner.succeed()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\ Downloading template...</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"chalk（字体颜色）\"><a href=\"#chalk（字体颜色）\" class=\"headerlink\" title=\"chalk（字体颜色）\"></a>chalk（字体颜色）</h3><p>通过 chalk 来为打印信息加上样式，比如成功信息为绿色，失败信息为红色，这样子会让用户更加容易分辨，同时也让终端的显示更加的好看：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(chalk.green(<span class=\"string\">&#x27;项目创建成功&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(chalk.red(<span class=\"string\">&#x27;项目创建失败&#x27;</span>))</span><br><span class=\"line\"><span class=\"keyword\">const</span> ora = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ora&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 开始下载</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;正在下载模板...&#x27;</span>)</span><br><span class=\"line\">spinner.start()</span><br><span class=\"line\"><span class=\"comment\">// 下载失败调用</span></span><br><span class=\"line\">spinner.fail()</span><br><span class=\"line\"><span class=\"comment\">// 下载成功调用</span></span><br><span class=\"line\">spinner.succeed()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"log-symbols（日志符号）\"><a href=\"#log-symbols（日志符号）\" class=\"headerlink\" title=\"log-symbols（日志符号）\"></a>log-symbols（日志符号）</h3><p>使用 log-symbols 在信息前面加上 √ 或 × 等的图标，优化视觉体验：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">  symbols.success,</span><br><span class=\"line\">  chalk.green(<span class=\"string\">&#x27;New project has been initialize successfully!&#x27;</span>)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"handlebars\"><a href=\"#handlebars\" class=\"headerlink\" title=\"handlebars\"></a>handlebars</h2><p>handlebars 可以对仓库的模板中的 package.json 文件做一些动态修改 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;&#123;&#123;name&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span>: <span class=\"string\">&quot;1.0.0&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;description&quot;</span>: <span class=\"string\">&quot;&#123;&#123;description&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;scripts&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;dev&quot;</span>: <span class=\"string\">&quot;webpack-dev-server  --config build/webpack.dev.conf.js&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;start&quot;</span>: <span class=\"string\">&quot;npm run dev&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build&quot;</span>: <span class=\"string\">&quot;node build/build.js&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;author&quot;</span>: <span class=\"string\">&quot;&#123;&#123;author&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;license&quot;</span>: <span class=\"string\">&quot;ISC&quot;</span>,</span><br><span class=\"line\">  ...</span><br></pre></td></tr></table></figure>\n\n<p>并在下载模板完成之后将用户输入的答案渲染到 package.json 中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fileName = <span class=\"string\">&#x27;./package.json;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">  name,</span><br><span class=\"line\">  description: answers.description,</span><br><span class=\"line\">  author: answers.author</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\"><span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">writeFileSync(fileName, result)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"cli-table\"><a href=\"#cli-table\" class=\"headerlink\" title=\"cli-table\"></a>cli-table</h3><p>表格</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> table = <span class=\"keyword\">new</span> Table(&#123;</span><br><span class=\"line\">  head: [<span class=\"string\">&#x27;Template Name&#x27;</span>, <span class=\"string\">&#x27;Branch&#x27;</span>, <span class=\"string\">&#x27;Url&#x27;</span>],</span><br><span class=\"line\">  style: &#123;</span><br><span class=\"line\">    head: [<span class=\"string\">&#x27;green&#x27;</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置下载模板\"><a href=\"#配置下载模板\" class=\"headerlink\" title=\"配置下载模板\"></a>配置下载模板</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">download(<span class=\"string\">&#x27;http://git.ym/g-web/mbs-cli.git#master&#x27;</span>, jay/$&#123;name&#125;, &#123;<span class=\"attr\">clone</span>: <span class=\"literal\">true</span>&#125;, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">            spinner.fail();</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err));</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            spinner.succeed();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>/package.json`</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">              name,</span><br><span class=\"line\">              description: answers.description,</span><br><span class=\"line\">              author: answers.author</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(fs.existsSync(fileName))&#123;</span><br><span class=\"line\">              <span class=\"keyword\">const</span> content = fs.readFileSync(fileName).toString();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta);</span><br><span class=\"line\">              fs.writeFileSync(fileName, result);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(symbols.success, chalk.green(<span class=\"string\">&#x27;Project initialization completed&#x27;</span>));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"命令行交互\"><a href=\"#命令行交互\" class=\"headerlink\" title=\"命令行交互\"></a>命令行交互</h3><p>命令行交互功能可以在用户执行 init 命令后，向用户提出问题，接收用户的输入并作出相应的处理。使用 inquirer.js 实现。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> tplList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> questions = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;project&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Project name:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Project name is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Please enter the author name:&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Please enter a description of the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;a project do for you&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;place&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Where to init the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;./&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(questions).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>)</span><br><span class=\"line\">  spinner.start()</span><br><span class=\"line\">  download(</span><br><span class=\"line\">    <span class=\"string\">`direct:<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template1&#x27;</span>][<span class=\"string\">&#x27;url&#x27;</span>]&#125;</span>#<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template1&#x27;</span>][<span class=\"string\">&#x27;branch&#x27;</span>]&#125;</span>`</span>,</span><br><span class=\"line\">    <span class=\"string\">`<span class=\"subst\">$&#123;answers.place&#125;</span>/<span class=\"subst\">$&#123;answers.project&#125;</span>`</span>,</span><br><span class=\"line\">    &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        spinner.fail()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err))</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        spinner.succeed()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;answers.project&#125;</span>/package.json`</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">          name: answers.project,</span><br><span class=\"line\">          description: answers.description,</span><br><span class=\"line\">          author: answers.author</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(meta)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existsSync(fileName)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">          symbols.success,</span><br><span class=\"line\">          chalk.green(<span class=\"string\">&#x27;New project has been initialize successfully!&#x27;</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"渲染模板\"><a href=\"#渲染模板\" class=\"headerlink\" title=\"渲染模板\"></a>渲染模板</h3><p>用 handlebars 的语法对 模板中的 package.json 文件做一些修改 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;&#123;&#123;name&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span>: <span class=\"string\">&quot;1.0.0&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;description&quot;</span>: <span class=\"string\">&quot;&#123;&#123;description&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;scripts&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;test&quot;</span>: <span class=\"string\">&quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;author&quot;</span>: <span class=\"string\">&quot;&#123;&#123;author&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;license&quot;</span>: <span class=\"string\">&quot;ISC&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>并在下载模板完成之后将用户输入的答案渲染到 package.json 中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">program</span><br><span class=\"line\">  .version(<span class=\"string\">&#x27;1.0.0&#x27;</span>, <span class=\"string\">&#x27;-v, --version&#x27;</span>)</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init &lt;name&gt;&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    inquirer</span><br><span class=\"line\">      .prompt([</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">          message: <span class=\"string\">&#x27;请输入项目描述&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">          message: <span class=\"string\">&#x27;请输入作者名称&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ])</span><br><span class=\"line\">      .then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        download(<span class=\"string\">&#x27;xxxxx#master&#x27;</span>, name, &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">true</span> &#125;, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">            name,</span><br><span class=\"line\">            description: answers.description,</span><br><span class=\"line\">            author: answers.author</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>/package.json`</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = fs.readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          fs.writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这里使用了 node.js 的文件模块 fs，将 handlebars 渲染完后的模板重新写入到文件中。</p>\n<h3 id=\"视觉美化\"><a href=\"#视觉美化\" class=\"headerlink\" title=\"视觉美化\"></a>视觉美化</h3><p>在用户输入答案之后，开始下载模板，这时候使用 ora 来提示用户正在下载中：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const ora &#x3D; require(&#39;ora&#39;);</span><br><span class=\"line\">&#x2F;&#x2F; 开始下载</span><br><span class=\"line\">const spinner &#x3D; ora(&#39;正在下载模板...&#39;);</span><br><span class=\"line\">spinner.start();</span><br><span class=\"line\">&#x2F;&#x2F; 下载失败调用</span><br><span class=\"line\">spinner.fail();</span><br><span class=\"line\">&#x2F;&#x2F; 下载成功调用</span><br><span class=\"line\">spinner.succeed();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"简单版脚手架完整示例\"><a href=\"#简单版脚手架完整示例\" class=\"headerlink\" title=\"简单版脚手架完整示例\"></a>简单版脚手架完整示例</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env node</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);<span class=\"comment\">//系统内置模块 主要用来操作文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> program = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;commander&#x27;</span>);<span class=\"comment\">//自动的解析命令和参数，用于处理用户输入的命令。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> download = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;download-git-repo&#x27;</span>);<span class=\"comment\">//下载并提取 git 仓库，用于下载项目模板。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> handlebars = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;handlebars&#x27;</span>);<span class=\"comment\">//模板引擎，将用户提交的信息动态填充到文件中。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> inquirer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;inquirer&#x27;</span>);<span class=\"comment\">//通用的命令行用户界面集合，用于和用户进行交互。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> ora = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ora&#x27;</span>);<span class=\"comment\">//下载过程久的话，可以用于显示下载中的动画效果。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>);<span class=\"comment\">//给终端的字体加上颜色。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> symbols = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;log-symbols&#x27;</span>);<span class=\"comment\">//在终端上显示出 √ 或 × 等的图标。</span></span><br><span class=\"line\"></span><br><span class=\"line\">program.version(<span class=\"string\">&#x27;1.0.4&#x27;</span>, <span class=\"string\">&#x27;-v, --version&#x27;</span>)</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init &lt;name&gt;&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!fs.existsSync(name))&#123;</span><br><span class=\"line\">      inquirer.prompt([<span class=\"comment\">//prompt 提示</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">          message: <span class=\"string\">&#x27;Please enter a description of the project:&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">          message: <span class=\"string\">&#x27;Please enter the author name:&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>);</span><br><span class=\"line\">        spinner.start();</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * 一级目录  name</span></span><br><span class=\"line\"><span class=\"comment\">         * 二级目录 jay/$&#123;name&#125;</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        download(<span class=\"string\">&#x27;http://git.ym/g-web/mbs-cli.git#master&#x27;</span>, jay/$&#123;name&#125;, &#123;<span class=\"attr\">clone</span>: <span class=\"literal\">true</span>&#125;, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">            spinner.fail();</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err));</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            spinner.succeed();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>/package.json`</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">              name,</span><br><span class=\"line\">              description: answers.description,</span><br><span class=\"line\">              author: answers.author</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(fs.existsSync(fileName))&#123;</span><br><span class=\"line\">              <span class=\"keyword\">const</span> content = fs.readFileSync(fileName).toString();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta);</span><br><span class=\"line\">              fs.writeFileSync(fileName, result);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(symbols.success, chalk.green(<span class=\"string\">&#x27;Project initialization completed&#x27;</span>));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 错误提示项目已存在，避免覆盖原有项目</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(<span class=\"string\">&#x27;Project already exists&#x27;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">program.parse(process.argv);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"mbs-cli-核心命令\"><a href=\"#mbs-cli-核心命令\" class=\"headerlink\" title=\"mbs-cli 核心命令\"></a>mbs-cli 核心命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Commands:</span><br><span class=\"line\"></span><br><span class=\"line\">  add|a             Add a <span class=\"keyword\">new</span> template</span><br><span class=\"line\">  list|l            List all the templates</span><br><span class=\"line\">  init|i            Generate a <span class=\"keyword\">new</span> project</span><br><span class=\"line\">  create|c          Generate a <span class=\"keyword\">new</span> project by choose a template</span><br><span class=\"line\">  init simple|ins   Generate a simple project</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\"></span><br><span class=\"line\">  -h, --help     output usage information</span><br><span class=\"line\">  -V, --version  output the version number</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"入口文件-mbs\"><a href=\"#入口文件-mbs\" class=\"headerlink\" title=\"入口文件 mbs\"></a>入口文件 mbs</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env node</span></span><br><span class=\"line\"></span><br><span class=\"line\">process.env.NODE_PATH = __dirname + <span class=\"string\">&#x27;/../node_modules/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; existsSync &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> symbols = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;log-symbols&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> program = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;commander&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"function\">(<span class=\"params\">command</span>) =&gt;</span> resolve(__dirname, <span class=\"string\">&#x27;../commands/&#x27;</span>, command)</span><br><span class=\"line\"></span><br><span class=\"line\">program.usage(<span class=\"string\">&#x27;&lt;command&gt;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">program.version(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../package&#x27;</span>).version)</span><br><span class=\"line\"></span><br><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;add&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Add a new template&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;add&#x27;</span>))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Generate a new project&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;i&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;init&#x27;</span>))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;create&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Generate a new project&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;c&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;create&#x27;</span>))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;list&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;List all the templates&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;l&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;list&#x27;</span>))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">program.parse(process.argv)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!program.args.length) &#123;</span><br><span class=\"line\">  program.help() <span class=\"comment\">//如果没有输入参数，终端显示帮助</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"init-命令\"><a href=\"#init-命令\" class=\"headerlink\" title=\"init 命令\"></a>init 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> tplList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> questions = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;project&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Project name:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Project name is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;author name:&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;description of the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;a simple spa project&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;place&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Where to init the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;./&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(questions).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>)</span><br><span class=\"line\">  spinner.start()</span><br><span class=\"line\">  download(</span><br><span class=\"line\">    <span class=\"string\">`direct:<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template1&#x27;</span>][<span class=\"string\">&#x27;url&#x27;</span>]&#125;</span>#<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template1&#x27;</span>][<span class=\"string\">&#x27;branch&#x27;</span>]&#125;</span>`</span>,</span><br><span class=\"line\">    <span class=\"string\">`<span class=\"subst\">$&#123;answers.place&#125;</span>/<span class=\"subst\">$&#123;answers.project&#125;</span>`</span>,</span><br><span class=\"line\">    &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        spinner.fail()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err))</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        spinner.succeed()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;answers.project&#125;</span>/package.json`</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">          name: answers.project,</span><br><span class=\"line\">          description: answers.description,</span><br><span class=\"line\">          author: answers.author</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(meta)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existsSync(fileName)) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;come in...&#x27;</span>)</span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">          symbols.success,</span><br><span class=\"line\">          chalk.green(<span class=\"string\">&#x27;New project has been initialize successfully!&#x27;</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"init-simple-命令\"><a href=\"#init-simple-命令\" class=\"headerlink\" title=\"init simple 命令\"></a>init simple 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> tplList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> question = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Please enter a description of the project:&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Please enter the author name:&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(question).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>)</span><br><span class=\"line\">  spinner.start()</span><br><span class=\"line\">  download(</span><br><span class=\"line\">    <span class=\"string\">`direct:<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template2&#x27;</span>][<span class=\"string\">&#x27;url&#x27;</span>]&#125;</span>#<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template2&#x27;</span>][<span class=\"string\">&#x27;branch&#x27;</span>]&#125;</span>`</span>,</span><br><span class=\"line\">    <span class=\"string\">`./<span class=\"subst\">$&#123;name&#125;</span>`</span>,</span><br><span class=\"line\">    &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        spinner.fail()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err))</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        spinner.succeed()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>/package.json`</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">          name,</span><br><span class=\"line\">          description: answers.description,</span><br><span class=\"line\">          author: answers.author</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existsSync(fileName)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">          symbols.success,</span><br><span class=\"line\">          chalk.green(<span class=\"string\">&#x27;Project initialization completed&#x27;</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"create-命令\"><a href=\"#create-命令\" class=\"headerlink\" title=\"create 命令\"></a>create 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> templateList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> rmTempList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../config/remote-templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> choices = rmTempList.map(<span class=\"function\">(<span class=\"params\">template</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    name: <span class=\"string\">`<span class=\"subst\">$&#123;template.name&#125;</span> - <span class=\"subst\">$&#123;template.description&#125;</span>`</span>,</span><br><span class=\"line\">    value: template.name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> questions = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;project&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Project name:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Project name is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;list&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;template&#x27;</span>,</span><br><span class=\"line\">    choices,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Choose template you want:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;template name is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;author name:&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;description of the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;place&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Where to init the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;./&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(questions).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>)</span><br><span class=\"line\">  spinner.start()</span><br><span class=\"line\">  <span class=\"keyword\">const</span> template = rmTempList.filter(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> answers.template.includes(item.name) &amp;&amp; item</span><br><span class=\"line\">  &#125;)[<span class=\"number\">0</span>]</span><br><span class=\"line\">  download(</span><br><span class=\"line\">    <span class=\"string\">`direct:<span class=\"subst\">$&#123;template.url&#125;</span>#<span class=\"subst\">$&#123;template.branch&#125;</span>`</span>,</span><br><span class=\"line\">    <span class=\"string\">`<span class=\"subst\">$&#123;answers.place&#125;</span>/<span class=\"subst\">$&#123;answers.project&#125;</span>`</span>,</span><br><span class=\"line\">    &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        spinner.fail()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err))</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        spinner.succeed()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;answers.project&#125;</span>/package.json`</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">          name: answers.project,</span><br><span class=\"line\">          description: answers.description,</span><br><span class=\"line\">          author: answers.author</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(meta)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existsSync(fileName)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">          symbols.success,</span><br><span class=\"line\">          chalk.green(<span class=\"string\">&#x27;New project has been initialize successfully!&#x27;</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>效果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mbs create</span><br><span class=\"line\"></span><br><span class=\"line\">? Project name: demo</span><br><span class=\"line\">? Choose template you want: (Use arrow keys)</span><br><span class=\"line\">&gt; vue-webpack-pc - 基于webpack构建的vue项目模板</span><br><span class=\"line\">  react-webpack-pc - 基于webpack构建的react项目模板</span><br><span class=\"line\">  angular-webpack-pc - 基于webpack构建的angular项目模板</span><br><span class=\"line\">  discover your template - 更多海量模板等你发掘与收藏.</span><br><span class=\"line\">? Choose template you want: vue-webpack-pc - 基于webpack构建的vue项目模板</span><br><span class=\"line\">? Please enter the author name: jay</span><br><span class=\"line\">? Please enter a description of the project: a simple spa project</span><br><span class=\"line\">? Where to init the project: .&#x2F;</span><br><span class=\"line\">√ Downloading template...</span><br><span class=\"line\">√ New project has been initialize successfully!</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"add-命令\"><a href=\"#add-命令\" class=\"headerlink\" title=\"add 命令\"></a>add 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; prompt &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;inquirer&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; writeFile &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; showTable &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../utils`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> tempList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> question = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;name&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Set the custom name of the template:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (tempList[val]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Template is existed!&#x27;</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val === <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Name is required!&#x27;</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;branch&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;branch of the template:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;branch is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;url&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Url of the template:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Url is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(question).then(<span class=\"function\">(<span class=\"params\">&#123; name, branch, url &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  tempList[name] = &#123;&#125;</span><br><span class=\"line\">  tempList[name][<span class=\"string\">&#x27;branch&#x27;</span>] = branch</span><br><span class=\"line\">  tempList[name][<span class=\"string\">&#x27;url&#x27;</span>] = url</span><br><span class=\"line\"></span><br><span class=\"line\">  writeFile(</span><br><span class=\"line\">    <span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates.json`</span>,</span><br><span class=\"line\">    <span class=\"built_in\">JSON</span>.stringify(tempList),</span><br><span class=\"line\">    <span class=\"string\">&#x27;utf-8&#x27;</span>,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      showTable(tempList, <span class=\"string\">&#x27;New template has been added successfully!&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>效果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mbs add</span><br><span class=\"line\"></span><br><span class=\"line\">? Set the custom name of the template: template1</span><br><span class=\"line\">? branch of the template: master</span><br><span class=\"line\">? Url of the template: http:&#x2F;&#x2F;git.ym&#x2F;Chenmh&#x2F;bs-init-template.git</span><br><span class=\"line\">┌───────────────┬────────┬───────────────────────────────────────────┐</span><br><span class=\"line\">│ Template Name │ Branch │ Url                                       │</span><br><span class=\"line\">├───────────────┼────────┼───────────────────────────────────────────┤</span><br><span class=\"line\">│ template1     │ master │ http:&#x2F;&#x2F;git.ym&#x2F;Chenmh&#x2F;bs-init-template.git │</span><br><span class=\"line\">└───────────────┴────────┴───────────────────────────────────────────┘</span><br><span class=\"line\">✔ New template has been added successfully!</span><br></pre></td></tr></table></figure>\n\n<p><code>mbs</code> use <a href=\"https://github.com/flipxfx/download-git-repo\">download-git-repo</a> to down load git repos. After answering 3 questions, you’ll add a new template to <code>mbs</code>.</p>\n<h3 id=\"list-命令\"><a href=\"#list-命令\" class=\"headerlink\" title=\"list 命令\"></a>list 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; showTable &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../utils`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> tempList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = showTable(tempList)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">showTable</span>(<span class=\"params\">tempList</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = <span class=\"built_in\">Object</span>.keys(tempList)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (list.length) &#123;</span><br><span class=\"line\">    list.forEach(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      table.push([key, tempList[key][<span class=\"string\">&#x27;branch&#x27;</span>], tempList[key][<span class=\"string\">&#x27;url&#x27;</span>]])</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (table.length === list.length) &#123;</span><br><span class=\"line\">        process.exit()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(table.toString())</span><br><span class=\"line\">    process.exit()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>效果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mbs list</span><br><span class=\"line\"></span><br><span class=\"line\">┌───────────────┬──────────┬───────────────────────────────────────────┐</span><br><span class=\"line\">│ Template Name │ Branch   │ Url                                       │</span><br><span class=\"line\">├───────────────┼──────────┼───────────────────────────────────────────┤</span><br><span class=\"line\">│ template1     │ standard │ http:&#x2F;&#x2F;git.ym&#x2F;Chenmh&#x2F;bs-init-template.git │</span><br><span class=\"line\">├───────────────┼──────────┼───────────────────────────────────────────┤</span><br><span class=\"line\">│ template2     │ simple   │ http:&#x2F;&#x2F;git.ym&#x2F;Chenmh&#x2F;bs-init-template.git │</span><br><span class=\"line\">└───────────────┴──────────┴───────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<p>utils.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Table = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cli-table&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> table = <span class=\"keyword\">new</span> Table(&#123;</span><br><span class=\"line\">  head: [<span class=\"string\">&#x27;Template Name&#x27;</span>, <span class=\"string\">&#x27;Branch&#x27;</span>, <span class=\"string\">&#x27;Url&#x27;</span>],</span><br><span class=\"line\">  style: &#123;</span><br><span class=\"line\">    head: [<span class=\"string\">&#x27;green&#x27;</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">showTable</span>(<span class=\"params\">tempList, Exp</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = <span class=\"built_in\">Object</span>.keys(tempList)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (list.length) &#123;</span><br><span class=\"line\">    list.forEach(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      table.push([key, tempList[key][<span class=\"string\">&#x27;branch&#x27;</span>], tempList[key][<span class=\"string\">&#x27;url&#x27;</span>]])</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (table.length === list.length) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(table.toString())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Exp) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(chalk.green(<span class=\"string\">`\\u2714 <span class=\"subst\">$&#123;Exp&#125;</span>`</span>))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        process.exit()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(table.toString())</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Exp) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(chalk.green(<span class=\"string\">`\\u2714 <span class=\"subst\">$&#123;Exp&#125;</span>`</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    process.exit()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">exports</span>.showTable = showTable</span><br></pre></td></tr></table></figure>\n\n<p>#脚手架发布</p>\n<h3 id=\"npm-登录\"><a href=\"#npm-登录\" class=\"headerlink\" title=\"npm 登录\"></a>npm 登录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\yameiproject\\mbs-cli&gt; npm login</span><br><span class=\"line\">Username: chenyumen</span><br><span class=\"line\">Password:</span><br><span class=\"line\">Email: (this IS public) 13172050157@126.com</span><br><span class=\"line\">Logged in as chenyumen on https:&#x2F;&#x2F;registry.npmjs.org&#x2F;.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"npm-发布\"><a href=\"#npm-发布\" class=\"headerlink\" title=\"npm 发布\"></a>npm 发布</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\yameiproject\\mbs-cli&gt; npm publish</span><br><span class=\"line\">npm notice</span><br><span class=\"line\">npm notice package: mbs-cli@1.0.4</span><br><span class=\"line\">npm notice &#x3D;&#x3D;&#x3D; Tarball Contents &#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">npm notice 573B  package.json</span><br><span class=\"line\">npm notice 2.5kB index.js</span><br><span class=\"line\">npm notice 193B  脚手架.md</span><br><span class=\"line\">npm notice &#x3D;&#x3D;&#x3D; Tarball Details &#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">npm notice name:          mbs-cli</span><br><span class=\"line\">npm notice version:       1.0.4</span><br><span class=\"line\">npm notice package size:  1.8 kB</span><br><span class=\"line\">npm notice total files:   3</span><br><span class=\"line\">npm notice</span><br><span class=\"line\">+ mbs-cli@1.0.4</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"本地-npm-模块调试\"><a href=\"#本地-npm-模块调试\" class=\"headerlink\" title=\"本地 npm 模块调试\"></a>本地 npm 模块调试</h2><h3 id=\"开启调试模式\"><a href=\"#开启调试模式\" class=\"headerlink\" title=\"开启调试模式\"></a>开启调试模式</h3><p><code>npm link</code>命令可以将一个任意位置的<code>npm包</code>链接到全局执行环境，从而在任意位置使用命令行都可以直接运行该 npm 包。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\yamei\\AppData\\Roaming\\npm\\mbs -&gt; C:\\Users\\yamei\\AppData\\Roaming\\npm\\node_modules\\mbs-cli\\bin\\mbs</span><br><span class=\"line\">C:\\Users\\yamei\\AppData\\Roaming\\npm\\node_modules\\mbs-cli -&gt; D:\\yameiproject\\mbs-cli</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关闭调试模式\"><a href=\"#关闭调试模式\" class=\"headerlink\" title=\"关闭调试模式\"></a>关闭调试模式</h3><p>如果你的项目不再需要该模块，可以在项目目录内使用 npm unlink 命令，删除符号链接</p>\n<h2 id=\"延申\"><a href=\"#延申\" class=\"headerlink\" title=\"延申\"></a>延申</h2><p>1、丰富命令行交互，以适应更多变的需求。</p>\n<p>2、webpack 配置文件隐藏优化。</p>\n<h2 id=\"模板集成常用功能\"><a href=\"#模板集成常用功能\" class=\"headerlink\" title=\"模板集成常用功能\"></a>模板集成常用功能</h2><ul>\n<li>登录、注销</li>\n<li>DashBord</li>\n<li>表格</li>\n<li>Tab 选项卡</li>\n<li>图表</li>\n<li>富文本编辑器</li>\n<li>三级菜单</li>\n<li>国际化</li>\n<li>图片拖拽、裁剪上传</li>\n<li>列表拖拽排序</li>\n<li>权限管理</li>\n<li>404/403/500</li>\n</ul>\n<h2 id=\"模板项目结构\"><a href=\"#模板项目结构\" class=\"headerlink\" title=\"模板项目结构\"></a>模板项目结构</h2><p>├── build 构建服务和 webpack 配置<br>|—— build.js webpack 打包服务<br>|—— webpack.base.conf.js webpack 基本通用配置<br>|—— webpack.dev.conf.js webpack 开发环境配置<br>|—— webpack.prod.conf.js webpack 生产环境配置<br>├── config 构建项目不同环境的配置<br>├── public 项目打包文件存放目录<br>├── index.html 项目入口文件<br>├── package.json 项目配置文件<br>├── .babelrc babel 配置文件<br>├── .gitignore git 忽略文件<br>├── postcss.config.js postcss 配置文件<br>├── src 项目目录<br>├── assets 静态资源<br> ├── components 集成组件目录<br> |—— json json 目录<br>|—— lang 中英文目录<br>|—— router vue 路由配置<br>|—— service ajax 请求配置<br>|—— store vuex 配置<br>|—— styles 公共样式<br>|—— utils 工具类<br>|—— views 页面组件目录<br>|—— App.vue vue 实例入口<br>|—— main.js 项目构建入口</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"为什么需要脚手架？\"><a href=\"#为什么需要脚手架？\" class=\"headerlink\" title=\"为什么需要脚手架？\"></a>为什么需要脚手架？</h2><p>1、减少重复性的工作，不再需要复制其他项目再删除无关代码，或者从零创建一个项目和文件 。<br>2、根据交互动态生成项目结构和配置文件,具备更高的灵活性和人性化定制的能力 。<br>3、多人协作更为方便，避免了人工传递文件的繁琐。<br>4、集成互联网上的模板，方便自己与他人使用。</p>","more":"<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>开发脚手架可以借鉴 vue-cli 的基本思路。vue-cli 是将项目模板放在 git 上，运行的时候再根据用户交互下载不同的模板，经过模板引擎渲染出来，生成项目。这样讲脚手架和模板分离，就可以各自维护，即使模板有所变动，只需要上传最新的模板即可，而不需要用户去更新脚手架就可以生成最新的项目。</p>\n<h2 id=\"脚手架工作流\"><a href=\"#脚手架工作流\" class=\"headerlink\" title=\"脚手架工作流\"></a>脚手架工作流</h2><p><img src=\"https://image-static.segmentfault.com/409/200/409200816-5ab3668b4996f_articlex\" alt=\"network\"></p>\n<h2 id=\"脚手架问答流\"><a href=\"#脚手架问答流\" class=\"headerlink\" title=\"脚手架问答流\"></a>脚手架问答流</h2><pre><code>PS D:\\test&gt; vue create demo1\n</code></pre>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">? Please pick a preset: Manually select features</span><br><span class=\"line\">? Check the features needed for your project: Babel, Router, Vuex, CSS Pre-processors, Linter</span><br><span class=\"line\">? Use history mode for router? (Requires proper server setup for index fallback in production) Yes</span><br><span class=\"line\">? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Less</span><br><span class=\"line\">? Pick a linter &#x2F; formatter config: Basic</span><br><span class=\"line\">? Pick additional lint features: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Lint on save</span><br><span class=\"line\">? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In package.json</span><br><span class=\"line\">? Save this as a preset for future projects? Yes</span><br><span class=\"line\">? Save preset as: preset1</span><br><span class=\"line\"></span><br><span class=\"line\">📄  Generating README.md...</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">🎉  Successfully created project demo1.</span><br><span class=\"line\">👉  Get started with the following commands:</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"如何搭建一个脚手架？\"><a href=\"#如何搭建一个脚手架？\" class=\"headerlink\" title=\"如何搭建一个脚手架？\"></a>如何搭建一个脚手架？</h2><p><img src=\"/images/cli/%E8%84%9A%E6%89%8B%E6%9E%B6%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B.png\" alt=\"network\"></p>\n<h2 id=\"第三方库的支持\"><a href=\"#第三方库的支持\" class=\"headerlink\" title=\"第三方库的支持\"></a>第三方库的支持</h2><p><img src=\"/images/cli/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%94%AF%E6%8C%81.png\" alt=\"network\"></p>\n<p>会使用到的第三方库</p>\n<ul>\n<li>commander.js:可以自动解析命令和参数，用于处理用户输入的命令</li>\n<li>download-git-repo:下载并提取 git 仓库，用于下载项目模板</li>\n<li>inquirer.js:通过命令行用户界面集合，用于和用户进行交互</li>\n<li>handlebars.js:模板引擎，将用户提交的信息动态填充到文件中</li>\n<li>ora:下载过程久的话，可以用于显示下载中的动画效果</li>\n<li>chalk:可以给终端的字体加上颜色</li>\n<li>log-symbols:可以在终端上显示 √ 或 × 等图标</li>\n</ul>\n<h2 id=\"搭建步骤：\"><a href=\"#搭建步骤：\" class=\"headerlink\" title=\"搭建步骤：\"></a>搭建步骤：</h2><h3 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h3><p>首先创建一个空项目，命名为 mbs-cli，然后新建一个 bin/mbs 文件，再执行 npm init 生成一个 package.json 文件。最后安装上面需要用到的依赖。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install commander download-git-repo inquirer handlebars ora chalk log-symbols cli-table -S</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"处理命令行\"><a href=\"#处理命令行\" class=\"headerlink\" title=\"处理命令行\"></a>处理命令行</h3><p>node.js 内置了对命令行操作的支持，在 package.json 中的 bin 字段可以定义命令名和关联的执行文件。</p>\n<p>在 package.json 中加上 bin 的内容：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"string\">&quot;name&quot;</span>: “mbs-cli<span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">\t&quot;</span>version<span class=\"string\">&quot;: &quot;</span><span class=\"number\">1.0</span><span class=\"number\">.0</span><span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;</span>description<span class=\"string\">&quot;: &quot;</span>中后台系统脚手架<span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">\t&quot;</span>bin<span class=\"string\">&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">\t\t&quot;</span>mbs<span class=\"string\">&quot;: &quot;</span>bin/mbs<span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">     &#125;</span></span><br><span class=\"line\"><span class=\"string\"> &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>首先在 mbs 文件 中引入相关依赖模块：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env node</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; existsSync &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>) <span class=\"comment\">//系统内置模块 主要用来操作文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> program = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;commander&#x27;</span>) <span class=\"comment\">//自动的解析命令和参数，用于处理用户输入的命令。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>) <span class=\"comment\">//给终端的字体加上颜色。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> symbols = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;log-symbols&#x27;</span>) <span class=\"comment\">//在终端上显示出 √ 或 × 等的图标。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"function\">(<span class=\"params\">command</span>) =&gt;</span> resolve(__dirname, <span class=\"string\">&#x27;../commands/&#x27;</span>, command)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-usr-bin-env-node-的作用\"><a href=\"#配置-usr-bin-env-node-的作用\" class=\"headerlink\" title=\"配置 !/usr/bin/env node 的作用\"></a>配置 !/usr/bin/env node 的作用</h3><p>指定用 node 执行脚本文件 ,usr/bin/env 解决了不同的用户 node 路径不同的问题，可以让系统动态的去查找 node 来执行你的脚本文件。</p>\n<h2 id=\"nodejs-依赖模块介绍与用法\"><a href=\"#nodejs-依赖模块介绍与用法\" class=\"headerlink\" title=\"nodejs 依赖模块介绍与用法\"></a>nodejs 依赖模块介绍与用法</h2><h3 id=\"commander（指挥官）\"><a href=\"#commander（指挥官）\" class=\"headerlink\" title=\"commander（指挥官）\"></a>commander（指挥官）</h3><p>自动地解析命令和参数，用于处理用户输入的命令。</p>\n<ul>\n<li><p>usage(): 设置 usage 值</p>\n</li>\n<li><p>command(): 定义一个命令名字</p>\n</li>\n<li><p>description(): 设置 description 值</p>\n</li>\n<li><p>option(): 定义参数，需要设置“关键字”和“描述”，关键字包括“简写”和“全写”两部分，以”,”,”|”,”空格”做分隔。</p>\n</li>\n<li><p>parse(): 解析命令行参数 argv</p>\n</li>\n<li><p>action(): 注册一个 callback 函数</p>\n</li>\n<li><p>version() : 终端输出版本号</p>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\yameiproject\\mbs-cli&gt; mbs --help</span><br><span class=\"line\">Usage: mbs &lt;command&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  -V, --version  output the version number</span><br><span class=\"line\">  -h, --help     output usage information</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\">  add|a          Add a <span class=\"keyword\">new</span> template</span><br><span class=\"line\">  init|i         Generate a <span class=\"keyword\">new</span> project</span><br><span class=\"line\">  init|ins       Generate a simple project</span><br><span class=\"line\">  create|c       Generate a <span class=\"keyword\">new</span> project</span><br><span class=\"line\">  list|l         List all the templates</span><br></pre></td></tr></table></figure>\n\n<p>定义常规命令：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> program = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;commander&#x27;</span>) <span class=\"comment\">//自动的解析命令和参数，用于处理用户输入的命令。</span></span><br><span class=\"line\"></span><br><span class=\"line\">program.usage(<span class=\"string\">&#x27;&lt;command&gt;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">program.version(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../package&#x27;</span>).version)</span><br></pre></td></tr></table></figure>\n\n<p>init 命令逻辑：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init &lt;name&gt;&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Generate a new project&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;i&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!existsSync(name)) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;init&#x27;</span>))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 错误提示项目已存在，避免覆盖原有项目</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(<span class=\"string\">&#x27;Project already exists&#x27;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>处理用户输入命令：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init &lt;name&gt;&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Generate a new project&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;i&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!existsSync(name)) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;init&#x27;</span>))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 错误提示项目已存在，避免覆盖原有项目</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(<span class=\"string\">&#x27;Project already exists&#x27;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>最后处理解析命令行参数 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">program.parse(process.argv)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//process:一个全局对象,控制有关信息，控制node.js的进程</span></span><br><span class=\"line\"><span class=\"comment\">//program.parse:解析命令之中的参数，根据上面定义好的规则执行相关命令</span></span><br><span class=\"line\"><span class=\"comment\">//process.argv:该属性返回一个数组,这个数组包含了启动node.js进程时的命令行参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!program.args.length) &#123;</span><br><span class=\"line\">  program.help()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"inquirer（询问者）\"><a href=\"#inquirer（询问者）\" class=\"headerlink\" title=\"inquirer（询问者）\"></a>inquirer（询问者）</h3><p>通用的命令行用户界面集合，用于和用户进行交互。由于交互的问题种类不同，inquirer 为每个问题提供很多参数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type：表示提问的类型，包括：input, confirm, list, rawlist, expand, checkbox, password, editor；</span><br><span class=\"line\">name: 存储当前问题回答的变量；</span><br><span class=\"line\">message：问题的描述；</span><br><span class=\"line\">default：默认值；</span><br><span class=\"line\">choices：列表选项，在某些type下可用，并且包含一个分隔符(separator)；</span><br><span class=\"line\">validate：对用户的回答进行校验；</span><br><span class=\"line\">filter：对用户的回答进行过滤处理，返回处理后的值；</span><br><span class=\"line\">when：根据前面问题的回答，判断当前问题是否需要被回答；</span><br><span class=\"line\">prefix：修改message默认前缀；</span><br><span class=\"line\">suffix：修改message默认后缀。</span><br></pre></td></tr></table></figure>\n\n<p>语法结构</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> inquirer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;inquirer&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> promptList = [</span><br><span class=\"line\">  <span class=\"comment\">// 具体交互内容</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">inquirer.prompt(promptList).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(answers) <span class=\"comment\">// 返回的结果</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>input 类型</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> inquirer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;inquirer&#x27;</span>);</span><br><span class=\"line\">inquirer.prompt([</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">        name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">        message: <span class=\"string\">&#x27;请输入作者名称&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(answers.author);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">效果：</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<p>confirm 类型</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> promptList = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;confirm&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;是否使用监听？&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;watch&#x27;</span>,</span><br><span class=\"line\">    prefix: <span class=\"string\">&#x27;前缀&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;confirm&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;是否进行文件过滤？&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;filter&#x27;</span>,</span><br><span class=\"line\">    suffix: <span class=\"string\">&#x27;后缀&#x27;</span>,</span><br><span class=\"line\">    when: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">answers</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 当watch为true的时候才会提问当前问题</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> answers.watch</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<p>list 类型</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> promptList = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;list&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;请选择一种水果:&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;fruit&#x27;</span>,</span><br><span class=\"line\">    choices: [<span class=\"string\">&#x27;Apple&#x27;</span>, <span class=\"string\">&#x27;Pear&#x27;</span>, <span class=\"string\">&#x27;Banana&#x27;</span>],</span><br><span class=\"line\">    filter: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 使用filter将回答变为小写</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> val.toLowerCase()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<h3 id=\"download-git-repo\"><a href=\"#download-git-repo\" class=\"headerlink\" title=\"download-git-repo\"></a>download-git-repo</h3><p>download-git-repo 支持从 Github、Gitlab 和 Bitbucket 下载仓库，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">download(repository, destination, options, callback)</span><br></pre></td></tr></table></figure>\n\n<p>repository</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- GitHub - github:owner&#x2F;name or simply owner&#x2F;name</span><br><span class=\"line\">- GitLab - gitlab:owner&#x2F;name</span><br><span class=\"line\">- Bitbucket - bitbucket:owner&#x2F;name</span><br><span class=\"line\">- Direct - direct:url:branch</span><br></pre></td></tr></table></figure>\n\n<p>destination</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The file path to download the repository to. xxxxxxxxxx </span><br></pre></td></tr></table></figure>\n\n<p>options</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">boolean default false - If true use git clone instead of an http download. While this can be a bit slower, it does allow private repositories to be used if the appropriate SSH keys are setup.</span><br></pre></td></tr></table></figure>\n\n<p>callback</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The callback function as function (err).</span><br></pre></td></tr></table></figure>\n\n<p>example:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">download(&#39;direct:https:&#x2F;&#x2F;gitlab.com&#x2F;flipxfx&#x2F;download-git-repo-fixture&#x2F;repository&#x2F;archive.zip&#39;, &#39;test&#x2F;tmp&#39;, function (err) &#123;</span><br><span class=\"line\">  console.log(err ? &#39;Error&#39; : &#39;Success&#39;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ora-（loading-动效）\"><a href=\"#ora-（loading-动效）\" class=\"headerlink\" title=\"ora （loading 动效）\"></a>ora （loading 动效）</h3><p>用于显示下载中的动画效果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ora = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ora&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 开始下载</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;正在下载模板...&#x27;</span>)</span><br><span class=\"line\">spinner.start()</span><br><span class=\"line\"><span class=\"comment\">// 下载失败调用</span></span><br><span class=\"line\">spinner.fail()</span><br><span class=\"line\"><span class=\"comment\">// 下载成功调用</span></span><br><span class=\"line\">spinner.succeed()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\ Downloading template...</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"chalk（字体颜色）\"><a href=\"#chalk（字体颜色）\" class=\"headerlink\" title=\"chalk（字体颜色）\"></a>chalk（字体颜色）</h3><p>通过 chalk 来为打印信息加上样式，比如成功信息为绿色，失败信息为红色，这样子会让用户更加容易分辨，同时也让终端的显示更加的好看：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(chalk.green(<span class=\"string\">&#x27;项目创建成功&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(chalk.red(<span class=\"string\">&#x27;项目创建失败&#x27;</span>))</span><br><span class=\"line\"><span class=\"keyword\">const</span> ora = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ora&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// 开始下载</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;正在下载模板...&#x27;</span>)</span><br><span class=\"line\">spinner.start()</span><br><span class=\"line\"><span class=\"comment\">// 下载失败调用</span></span><br><span class=\"line\">spinner.fail()</span><br><span class=\"line\"><span class=\"comment\">// 下载成功调用</span></span><br><span class=\"line\">spinner.succeed()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"log-symbols（日志符号）\"><a href=\"#log-symbols（日志符号）\" class=\"headerlink\" title=\"log-symbols（日志符号）\"></a>log-symbols（日志符号）</h3><p>使用 log-symbols 在信息前面加上 √ 或 × 等的图标，优化视觉体验：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">  symbols.success,</span><br><span class=\"line\">  chalk.green(<span class=\"string\">&#x27;New project has been initialize successfully!&#x27;</span>)</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"handlebars\"><a href=\"#handlebars\" class=\"headerlink\" title=\"handlebars\"></a>handlebars</h2><p>handlebars 可以对仓库的模板中的 package.json 文件做一些动态修改 :</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;&#123;&#123;name&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span>: <span class=\"string\">&quot;1.0.0&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;description&quot;</span>: <span class=\"string\">&quot;&#123;&#123;description&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;scripts&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;dev&quot;</span>: <span class=\"string\">&quot;webpack-dev-server  --config build/webpack.dev.conf.js&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;start&quot;</span>: <span class=\"string\">&quot;npm run dev&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;build&quot;</span>: <span class=\"string\">&quot;node build/build.js&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;author&quot;</span>: <span class=\"string\">&quot;&#123;&#123;author&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;license&quot;</span>: <span class=\"string\">&quot;ISC&quot;</span>,</span><br><span class=\"line\">  ...</span><br></pre></td></tr></table></figure>\n\n<p>并在下载模板完成之后将用户输入的答案渲染到 package.json 中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fileName = <span class=\"string\">&#x27;./package.json;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">  name,</span><br><span class=\"line\">  description: answers.description,</span><br><span class=\"line\">  author: answers.author</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\"><span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">writeFileSync(fileName, result)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"cli-table\"><a href=\"#cli-table\" class=\"headerlink\" title=\"cli-table\"></a>cli-table</h3><p>表格</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> table = <span class=\"keyword\">new</span> Table(&#123;</span><br><span class=\"line\">  head: [<span class=\"string\">&#x27;Template Name&#x27;</span>, <span class=\"string\">&#x27;Branch&#x27;</span>, <span class=\"string\">&#x27;Url&#x27;</span>],</span><br><span class=\"line\">  style: &#123;</span><br><span class=\"line\">    head: [<span class=\"string\">&#x27;green&#x27;</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置下载模板\"><a href=\"#配置下载模板\" class=\"headerlink\" title=\"配置下载模板\"></a>配置下载模板</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">download(<span class=\"string\">&#x27;http://git.ym/g-web/mbs-cli.git#master&#x27;</span>, jay/$&#123;name&#125;, &#123;<span class=\"attr\">clone</span>: <span class=\"literal\">true</span>&#125;, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">            spinner.fail();</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err));</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            spinner.succeed();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>/package.json`</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">              name,</span><br><span class=\"line\">              description: answers.description,</span><br><span class=\"line\">              author: answers.author</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(fs.existsSync(fileName))&#123;</span><br><span class=\"line\">              <span class=\"keyword\">const</span> content = fs.readFileSync(fileName).toString();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta);</span><br><span class=\"line\">              fs.writeFileSync(fileName, result);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(symbols.success, chalk.green(<span class=\"string\">&#x27;Project initialization completed&#x27;</span>));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"命令行交互\"><a href=\"#命令行交互\" class=\"headerlink\" title=\"命令行交互\"></a>命令行交互</h3><p>命令行交互功能可以在用户执行 init 命令后，向用户提出问题，接收用户的输入并作出相应的处理。使用 inquirer.js 实现。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> tplList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> questions = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;project&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Project name:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Project name is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Please enter the author name:&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Please enter a description of the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;a project do for you&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;place&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Where to init the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;./&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(questions).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>)</span><br><span class=\"line\">  spinner.start()</span><br><span class=\"line\">  download(</span><br><span class=\"line\">    <span class=\"string\">`direct:<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template1&#x27;</span>][<span class=\"string\">&#x27;url&#x27;</span>]&#125;</span>#<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template1&#x27;</span>][<span class=\"string\">&#x27;branch&#x27;</span>]&#125;</span>`</span>,</span><br><span class=\"line\">    <span class=\"string\">`<span class=\"subst\">$&#123;answers.place&#125;</span>/<span class=\"subst\">$&#123;answers.project&#125;</span>`</span>,</span><br><span class=\"line\">    &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        spinner.fail()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err))</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        spinner.succeed()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;answers.project&#125;</span>/package.json`</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">          name: answers.project,</span><br><span class=\"line\">          description: answers.description,</span><br><span class=\"line\">          author: answers.author</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(meta)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existsSync(fileName)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">          symbols.success,</span><br><span class=\"line\">          chalk.green(<span class=\"string\">&#x27;New project has been initialize successfully!&#x27;</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"渲染模板\"><a href=\"#渲染模板\" class=\"headerlink\" title=\"渲染模板\"></a>渲染模板</h3><p>用 handlebars 的语法对 模板中的 package.json 文件做一些修改 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;&#123;&#123;name&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;version&quot;</span>: <span class=\"string\">&quot;1.0.0&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;description&quot;</span>: <span class=\"string\">&quot;&#123;&#123;description&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;scripts&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;test&quot;</span>: <span class=\"string\">&quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;author&quot;</span>: <span class=\"string\">&quot;&#123;&#123;author&#125;&#125;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;license&quot;</span>: <span class=\"string\">&quot;ISC&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>并在下载模板完成之后将用户输入的答案渲染到 package.json 中</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">program</span><br><span class=\"line\">  .version(<span class=\"string\">&#x27;1.0.0&#x27;</span>, <span class=\"string\">&#x27;-v, --version&#x27;</span>)</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init &lt;name&gt;&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    inquirer</span><br><span class=\"line\">      .prompt([</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">          message: <span class=\"string\">&#x27;请输入项目描述&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">          message: <span class=\"string\">&#x27;请输入作者名称&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ])</span><br><span class=\"line\">      .then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        download(<span class=\"string\">&#x27;xxxxx#master&#x27;</span>, name, &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">true</span> &#125;, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">            name,</span><br><span class=\"line\">            description: answers.description,</span><br><span class=\"line\">            author: answers.author</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>/package.json`</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = fs.readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          fs.writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>这里使用了 node.js 的文件模块 fs，将 handlebars 渲染完后的模板重新写入到文件中。</p>\n<h3 id=\"视觉美化\"><a href=\"#视觉美化\" class=\"headerlink\" title=\"视觉美化\"></a>视觉美化</h3><p>在用户输入答案之后，开始下载模板，这时候使用 ora 来提示用户正在下载中：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const ora &#x3D; require(&#39;ora&#39;);</span><br><span class=\"line\">&#x2F;&#x2F; 开始下载</span><br><span class=\"line\">const spinner &#x3D; ora(&#39;正在下载模板...&#39;);</span><br><span class=\"line\">spinner.start();</span><br><span class=\"line\">&#x2F;&#x2F; 下载失败调用</span><br><span class=\"line\">spinner.fail();</span><br><span class=\"line\">&#x2F;&#x2F; 下载成功调用</span><br><span class=\"line\">spinner.succeed();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"简单版脚手架完整示例\"><a href=\"#简单版脚手架完整示例\" class=\"headerlink\" title=\"简单版脚手架完整示例\"></a>简单版脚手架完整示例</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env node</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);<span class=\"comment\">//系统内置模块 主要用来操作文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> program = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;commander&#x27;</span>);<span class=\"comment\">//自动的解析命令和参数，用于处理用户输入的命令。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> download = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;download-git-repo&#x27;</span>);<span class=\"comment\">//下载并提取 git 仓库，用于下载项目模板。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> handlebars = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;handlebars&#x27;</span>);<span class=\"comment\">//模板引擎，将用户提交的信息动态填充到文件中。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> inquirer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;inquirer&#x27;</span>);<span class=\"comment\">//通用的命令行用户界面集合，用于和用户进行交互。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> ora = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ora&#x27;</span>);<span class=\"comment\">//下载过程久的话，可以用于显示下载中的动画效果。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>);<span class=\"comment\">//给终端的字体加上颜色。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> symbols = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;log-symbols&#x27;</span>);<span class=\"comment\">//在终端上显示出 √ 或 × 等的图标。</span></span><br><span class=\"line\"></span><br><span class=\"line\">program.version(<span class=\"string\">&#x27;1.0.4&#x27;</span>, <span class=\"string\">&#x27;-v, --version&#x27;</span>)</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init &lt;name&gt;&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!fs.existsSync(name))&#123;</span><br><span class=\"line\">      inquirer.prompt([<span class=\"comment\">//prompt 提示</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">          message: <span class=\"string\">&#x27;Please enter a description of the project:&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">          message: <span class=\"string\">&#x27;Please enter the author name:&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>);</span><br><span class=\"line\">        spinner.start();</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * 一级目录  name</span></span><br><span class=\"line\"><span class=\"comment\">         * 二级目录 jay/$&#123;name&#125;</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        download(<span class=\"string\">&#x27;http://git.ym/g-web/mbs-cli.git#master&#x27;</span>, jay/$&#123;name&#125;, &#123;<span class=\"attr\">clone</span>: <span class=\"literal\">true</span>&#125;, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(err)&#123;</span><br><span class=\"line\">            spinner.fail();</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err));</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            spinner.succeed();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>/package.json`</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">              name,</span><br><span class=\"line\">              description: answers.description,</span><br><span class=\"line\">              author: answers.author</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(fs.existsSync(fileName))&#123;</span><br><span class=\"line\">              <span class=\"keyword\">const</span> content = fs.readFileSync(fileName).toString();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta);</span><br><span class=\"line\">              fs.writeFileSync(fileName, result);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(symbols.success, chalk.green(<span class=\"string\">&#x27;Project initialization completed&#x27;</span>));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 错误提示项目已存在，避免覆盖原有项目</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(<span class=\"string\">&#x27;Project already exists&#x27;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">program.parse(process.argv);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"mbs-cli-核心命令\"><a href=\"#mbs-cli-核心命令\" class=\"headerlink\" title=\"mbs-cli 核心命令\"></a>mbs-cli 核心命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Commands:</span><br><span class=\"line\"></span><br><span class=\"line\">  add|a             Add a <span class=\"keyword\">new</span> template</span><br><span class=\"line\">  list|l            List all the templates</span><br><span class=\"line\">  init|i            Generate a <span class=\"keyword\">new</span> project</span><br><span class=\"line\">  create|c          Generate a <span class=\"keyword\">new</span> project by choose a template</span><br><span class=\"line\">  init simple|ins   Generate a simple project</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\"></span><br><span class=\"line\">  -h, --help     output usage information</span><br><span class=\"line\">  -V, --version  output the version number</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"入口文件-mbs\"><a href=\"#入口文件-mbs\" class=\"headerlink\" title=\"入口文件 mbs\"></a>入口文件 mbs</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env node</span></span><br><span class=\"line\"></span><br><span class=\"line\">process.env.NODE_PATH = __dirname + <span class=\"string\">&#x27;/../node_modules/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; existsSync &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> symbols = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;log-symbols&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> program = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;commander&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> res = <span class=\"function\">(<span class=\"params\">command</span>) =&gt;</span> resolve(__dirname, <span class=\"string\">&#x27;../commands/&#x27;</span>, command)</span><br><span class=\"line\"></span><br><span class=\"line\">program.usage(<span class=\"string\">&#x27;&lt;command&gt;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">program.version(<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../package&#x27;</span>).version)</span><br><span class=\"line\"></span><br><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;add&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Add a new template&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;add&#x27;</span>))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;init&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Generate a new project&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;i&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;init&#x27;</span>))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;create&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;Generate a new project&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;c&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;create&#x27;</span>))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">program</span><br><span class=\"line\">  .command(<span class=\"string\">&#x27;list&#x27;</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">&#x27;List all the templates&#x27;</span>)</span><br><span class=\"line\">  .alias(<span class=\"string\">&#x27;l&#x27;</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">require</span>(res(<span class=\"string\">&#x27;list&#x27;</span>))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">program.parse(process.argv)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!program.args.length) &#123;</span><br><span class=\"line\">  program.help() <span class=\"comment\">//如果没有输入参数，终端显示帮助</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"init-命令\"><a href=\"#init-命令\" class=\"headerlink\" title=\"init 命令\"></a>init 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> tplList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> questions = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;project&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Project name:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Project name is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;author name:&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;description of the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;a simple spa project&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;place&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Where to init the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;./&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(questions).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>)</span><br><span class=\"line\">  spinner.start()</span><br><span class=\"line\">  download(</span><br><span class=\"line\">    <span class=\"string\">`direct:<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template1&#x27;</span>][<span class=\"string\">&#x27;url&#x27;</span>]&#125;</span>#<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template1&#x27;</span>][<span class=\"string\">&#x27;branch&#x27;</span>]&#125;</span>`</span>,</span><br><span class=\"line\">    <span class=\"string\">`<span class=\"subst\">$&#123;answers.place&#125;</span>/<span class=\"subst\">$&#123;answers.project&#125;</span>`</span>,</span><br><span class=\"line\">    &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        spinner.fail()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err))</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        spinner.succeed()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;answers.project&#125;</span>/package.json`</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">          name: answers.project,</span><br><span class=\"line\">          description: answers.description,</span><br><span class=\"line\">          author: answers.author</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(meta)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existsSync(fileName)) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;come in...&#x27;</span>)</span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">          symbols.success,</span><br><span class=\"line\">          chalk.green(<span class=\"string\">&#x27;New project has been initialize successfully!&#x27;</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"init-simple-命令\"><a href=\"#init-simple-命令\" class=\"headerlink\" title=\"init simple 命令\"></a>init simple 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> tplList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> question = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Please enter a description of the project:&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Please enter the author name:&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(question).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>)</span><br><span class=\"line\">  spinner.start()</span><br><span class=\"line\">  download(</span><br><span class=\"line\">    <span class=\"string\">`direct:<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template2&#x27;</span>][<span class=\"string\">&#x27;url&#x27;</span>]&#125;</span>#<span class=\"subst\">$&#123;tplList[<span class=\"string\">&#x27;template2&#x27;</span>][<span class=\"string\">&#x27;branch&#x27;</span>]&#125;</span>`</span>,</span><br><span class=\"line\">    <span class=\"string\">`./<span class=\"subst\">$&#123;name&#125;</span>`</span>,</span><br><span class=\"line\">    &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        spinner.fail()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err))</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        spinner.succeed()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>/package.json`</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">          name,</span><br><span class=\"line\">          description: answers.description,</span><br><span class=\"line\">          author: answers.author</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existsSync(fileName)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">          symbols.success,</span><br><span class=\"line\">          chalk.green(<span class=\"string\">&#x27;Project initialization completed&#x27;</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"create-命令\"><a href=\"#create-命令\" class=\"headerlink\" title=\"create 命令\"></a>create 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> templateList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> rmTempList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../config/remote-templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> choices = rmTempList.map(<span class=\"function\">(<span class=\"params\">template</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    name: <span class=\"string\">`<span class=\"subst\">$&#123;template.name&#125;</span> - <span class=\"subst\">$&#123;template.description&#125;</span>`</span>,</span><br><span class=\"line\">    value: template.name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> questions = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;project&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Project name:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Project name is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;list&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;template&#x27;</span>,</span><br><span class=\"line\">    choices,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Choose template you want:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;template name is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;author&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;author name:&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;description&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;description of the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;place&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Where to init the project:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: <span class=\"string\">&#x27;./&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(questions).then(<span class=\"function\">(<span class=\"params\">answers</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> spinner = ora(<span class=\"string\">&#x27;Downloading template...&#x27;</span>)</span><br><span class=\"line\">  spinner.start()</span><br><span class=\"line\">  <span class=\"keyword\">const</span> template = rmTempList.filter(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> answers.template.includes(item.name) &amp;&amp; item</span><br><span class=\"line\">  &#125;)[<span class=\"number\">0</span>]</span><br><span class=\"line\">  download(</span><br><span class=\"line\">    <span class=\"string\">`direct:<span class=\"subst\">$&#123;template.url&#125;</span>#<span class=\"subst\">$&#123;template.branch&#125;</span>`</span>,</span><br><span class=\"line\">    <span class=\"string\">`<span class=\"subst\">$&#123;answers.place&#125;</span>/<span class=\"subst\">$&#123;answers.project&#125;</span>`</span>,</span><br><span class=\"line\">    &#123; <span class=\"attr\">clone</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        spinner.fail()</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(symbols.error, chalk.red(err))</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        spinner.succeed()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fileName = <span class=\"string\">`<span class=\"subst\">$&#123;answers.project&#125;</span>/package.json`</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> meta = &#123;</span><br><span class=\"line\">          name: answers.project,</span><br><span class=\"line\">          description: answers.description,</span><br><span class=\"line\">          author: answers.author</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(meta)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (existsSync(fileName)) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> content = readFileSync(fileName).toString()</span><br><span class=\"line\">          <span class=\"keyword\">const</span> result = handlebars.compile(content)(meta)</span><br><span class=\"line\">          writeFileSync(fileName, result)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">          symbols.success,</span><br><span class=\"line\">          chalk.green(<span class=\"string\">&#x27;New project has been initialize successfully!&#x27;</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>效果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mbs create</span><br><span class=\"line\"></span><br><span class=\"line\">? Project name: demo</span><br><span class=\"line\">? Choose template you want: (Use arrow keys)</span><br><span class=\"line\">&gt; vue-webpack-pc - 基于webpack构建的vue项目模板</span><br><span class=\"line\">  react-webpack-pc - 基于webpack构建的react项目模板</span><br><span class=\"line\">  angular-webpack-pc - 基于webpack构建的angular项目模板</span><br><span class=\"line\">  discover your template - 更多海量模板等你发掘与收藏.</span><br><span class=\"line\">? Choose template you want: vue-webpack-pc - 基于webpack构建的vue项目模板</span><br><span class=\"line\">? Please enter the author name: jay</span><br><span class=\"line\">? Please enter a description of the project: a simple spa project</span><br><span class=\"line\">? Where to init the project: .&#x2F;</span><br><span class=\"line\">√ Downloading template...</span><br><span class=\"line\">√ New project has been initialize successfully!</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"add-命令\"><a href=\"#add-命令\" class=\"headerlink\" title=\"add 命令\"></a>add 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; prompt &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;inquirer&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; writeFile &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; showTable &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../utils`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> tempList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> question = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;name&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Set the custom name of the template:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (tempList[val]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Template is existed!&#x27;</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val === <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Name is required!&#x27;</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;branch&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;branch of the template:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;branch is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    type: <span class=\"string\">&#x27;input&#x27;</span>,</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;url&#x27;</span>,</span><br><span class=\"line\">    message: <span class=\"string\">&#x27;Url of the template:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">validate</span>(<span class=\"params\">val</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (val !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Url is required!&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = prompt(question).then(<span class=\"function\">(<span class=\"params\">&#123; name, branch, url &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  tempList[name] = &#123;&#125;</span><br><span class=\"line\">  tempList[name][<span class=\"string\">&#x27;branch&#x27;</span>] = branch</span><br><span class=\"line\">  tempList[name][<span class=\"string\">&#x27;url&#x27;</span>] = url</span><br><span class=\"line\"></span><br><span class=\"line\">  writeFile(</span><br><span class=\"line\">    <span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates.json`</span>,</span><br><span class=\"line\">    <span class=\"built_in\">JSON</span>.stringify(tempList),</span><br><span class=\"line\">    <span class=\"string\">&#x27;utf-8&#x27;</span>,</span><br><span class=\"line\">    (err) =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      showTable(tempList, <span class=\"string\">&#x27;New template has been added successfully!&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>效果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mbs add</span><br><span class=\"line\"></span><br><span class=\"line\">? Set the custom name of the template: template1</span><br><span class=\"line\">? branch of the template: master</span><br><span class=\"line\">? Url of the template: http:&#x2F;&#x2F;git.ym&#x2F;Chenmh&#x2F;bs-init-template.git</span><br><span class=\"line\">┌───────────────┬────────┬───────────────────────────────────────────┐</span><br><span class=\"line\">│ Template Name │ Branch │ Url                                       │</span><br><span class=\"line\">├───────────────┼────────┼───────────────────────────────────────────┤</span><br><span class=\"line\">│ template1     │ master │ http:&#x2F;&#x2F;git.ym&#x2F;Chenmh&#x2F;bs-init-template.git │</span><br><span class=\"line\">└───────────────┴────────┴───────────────────────────────────────────┘</span><br><span class=\"line\">✔ New template has been added successfully!</span><br></pre></td></tr></table></figure>\n\n<p><code>mbs</code> use <a href=\"https://github.com/flipxfx/download-git-repo\">download-git-repo</a> to down load git repos. After answering 3 questions, you’ll add a new template to <code>mbs</code>.</p>\n<h3 id=\"list-命令\"><a href=\"#list-命令\" class=\"headerlink\" title=\"list 命令\"></a>list 命令</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; showTable &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../utils`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> tempList = <span class=\"built_in\">require</span>(<span class=\"string\">`<span class=\"subst\">$&#123;__dirname&#125;</span>/../templates`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = showTable(tempList)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">showTable</span>(<span class=\"params\">tempList</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = <span class=\"built_in\">Object</span>.keys(tempList)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (list.length) &#123;</span><br><span class=\"line\">    list.forEach(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      table.push([key, tempList[key][<span class=\"string\">&#x27;branch&#x27;</span>], tempList[key][<span class=\"string\">&#x27;url&#x27;</span>]])</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (table.length === list.length) &#123;</span><br><span class=\"line\">        process.exit()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(table.toString())</span><br><span class=\"line\">    process.exit()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>效果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mbs list</span><br><span class=\"line\"></span><br><span class=\"line\">┌───────────────┬──────────┬───────────────────────────────────────────┐</span><br><span class=\"line\">│ Template Name │ Branch   │ Url                                       │</span><br><span class=\"line\">├───────────────┼──────────┼───────────────────────────────────────────┤</span><br><span class=\"line\">│ template1     │ standard │ http:&#x2F;&#x2F;git.ym&#x2F;Chenmh&#x2F;bs-init-template.git │</span><br><span class=\"line\">├───────────────┼──────────┼───────────────────────────────────────────┤</span><br><span class=\"line\">│ template2     │ simple   │ http:&#x2F;&#x2F;git.ym&#x2F;Chenmh&#x2F;bs-init-template.git │</span><br><span class=\"line\">└───────────────┴──────────┴───────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<p>utils.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Table = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cli-table&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> chalk = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chalk&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> table = <span class=\"keyword\">new</span> Table(&#123;</span><br><span class=\"line\">  head: [<span class=\"string\">&#x27;Template Name&#x27;</span>, <span class=\"string\">&#x27;Branch&#x27;</span>, <span class=\"string\">&#x27;Url&#x27;</span>],</span><br><span class=\"line\">  style: &#123;</span><br><span class=\"line\">    head: [<span class=\"string\">&#x27;green&#x27;</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">showTable</span>(<span class=\"params\">tempList, Exp</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = <span class=\"built_in\">Object</span>.keys(tempList)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (list.length) &#123;</span><br><span class=\"line\">    list.forEach(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      table.push([key, tempList[key][<span class=\"string\">&#x27;branch&#x27;</span>], tempList[key][<span class=\"string\">&#x27;url&#x27;</span>]])</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (table.length === list.length) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(table.toString())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Exp) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(chalk.green(<span class=\"string\">`\\u2714 <span class=\"subst\">$&#123;Exp&#125;</span>`</span>))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        process.exit()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(table.toString())</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Exp) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(chalk.green(<span class=\"string\">`\\u2714 <span class=\"subst\">$&#123;Exp&#125;</span>`</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    process.exit()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">exports</span>.showTable = showTable</span><br></pre></td></tr></table></figure>\n\n<p>#脚手架发布</p>\n<h3 id=\"npm-登录\"><a href=\"#npm-登录\" class=\"headerlink\" title=\"npm 登录\"></a>npm 登录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\yameiproject\\mbs-cli&gt; npm login</span><br><span class=\"line\">Username: chenyumen</span><br><span class=\"line\">Password:</span><br><span class=\"line\">Email: (this IS public) 13172050157@126.com</span><br><span class=\"line\">Logged in as chenyumen on https:&#x2F;&#x2F;registry.npmjs.org&#x2F;.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"npm-发布\"><a href=\"#npm-发布\" class=\"headerlink\" title=\"npm 发布\"></a>npm 发布</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\yameiproject\\mbs-cli&gt; npm publish</span><br><span class=\"line\">npm notice</span><br><span class=\"line\">npm notice package: mbs-cli@1.0.4</span><br><span class=\"line\">npm notice &#x3D;&#x3D;&#x3D; Tarball Contents &#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">npm notice 573B  package.json</span><br><span class=\"line\">npm notice 2.5kB index.js</span><br><span class=\"line\">npm notice 193B  脚手架.md</span><br><span class=\"line\">npm notice &#x3D;&#x3D;&#x3D; Tarball Details &#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">npm notice name:          mbs-cli</span><br><span class=\"line\">npm notice version:       1.0.4</span><br><span class=\"line\">npm notice package size:  1.8 kB</span><br><span class=\"line\">npm notice total files:   3</span><br><span class=\"line\">npm notice</span><br><span class=\"line\">+ mbs-cli@1.0.4</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"本地-npm-模块调试\"><a href=\"#本地-npm-模块调试\" class=\"headerlink\" title=\"本地 npm 模块调试\"></a>本地 npm 模块调试</h2><h3 id=\"开启调试模式\"><a href=\"#开启调试模式\" class=\"headerlink\" title=\"开启调试模式\"></a>开启调试模式</h3><p><code>npm link</code>命令可以将一个任意位置的<code>npm包</code>链接到全局执行环境，从而在任意位置使用命令行都可以直接运行该 npm 包。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\yamei\\AppData\\Roaming\\npm\\mbs -&gt; C:\\Users\\yamei\\AppData\\Roaming\\npm\\node_modules\\mbs-cli\\bin\\mbs</span><br><span class=\"line\">C:\\Users\\yamei\\AppData\\Roaming\\npm\\node_modules\\mbs-cli -&gt; D:\\yameiproject\\mbs-cli</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关闭调试模式\"><a href=\"#关闭调试模式\" class=\"headerlink\" title=\"关闭调试模式\"></a>关闭调试模式</h3><p>如果你的项目不再需要该模块，可以在项目目录内使用 npm unlink 命令，删除符号链接</p>\n<h2 id=\"延申\"><a href=\"#延申\" class=\"headerlink\" title=\"延申\"></a>延申</h2><p>1、丰富命令行交互，以适应更多变的需求。</p>\n<p>2、webpack 配置文件隐藏优化。</p>\n<h2 id=\"模板集成常用功能\"><a href=\"#模板集成常用功能\" class=\"headerlink\" title=\"模板集成常用功能\"></a>模板集成常用功能</h2><ul>\n<li>登录、注销</li>\n<li>DashBord</li>\n<li>表格</li>\n<li>Tab 选项卡</li>\n<li>图表</li>\n<li>富文本编辑器</li>\n<li>三级菜单</li>\n<li>国际化</li>\n<li>图片拖拽、裁剪上传</li>\n<li>列表拖拽排序</li>\n<li>权限管理</li>\n<li>404/403/500</li>\n</ul>\n<h2 id=\"模板项目结构\"><a href=\"#模板项目结构\" class=\"headerlink\" title=\"模板项目结构\"></a>模板项目结构</h2><p>├── build 构建服务和 webpack 配置<br>|—— build.js webpack 打包服务<br>|—— webpack.base.conf.js webpack 基本通用配置<br>|—— webpack.dev.conf.js webpack 开发环境配置<br>|—— webpack.prod.conf.js webpack 生产环境配置<br>├── config 构建项目不同环境的配置<br>├── public 项目打包文件存放目录<br>├── index.html 项目入口文件<br>├── package.json 项目配置文件<br>├── .babelrc babel 配置文件<br>├── .gitignore git 忽略文件<br>├── postcss.config.js postcss 配置文件<br>├── src 项目目录<br>├── assets 静态资源<br> ├── components 集成组件目录<br> |—— json json 目录<br>|—— lang 中英文目录<br>|—— router vue 路由配置<br>|—— service ajax 请求配置<br>|—— store vuex 配置<br>|—— styles 公共样式<br>|—— utils 工具类<br>|—— views 页面组件目录<br>|—— App.vue vue 实例入口<br>|—— main.js 项目构建入口</p>"},{"title":"CommonJS、AMD、CMD、ES6","date":"2018-04-04T08:24:01.000Z","_content":"\n以前没有深究的问题，仔细思考之后发现自己并不清楚，然后记个笔记。\n\n<!--more-->\n\n## CommonJS\n\nNode.js 是 commonJS 规范的主要实践者，它有四个重要的环境为模块化的实现提供支持:module、exports、require、global。实际使用时，用 module.exports 定义当前模块对外输出的接口（不推荐直接使用 exports）用 require 加载模块。\n\n```javascript\nvar basicNum = 0\nfunction add(a, b) {\n  return a + b\n}\nmodule.export = {\n  add:add,\n  basicNum:basicNum\n}\n//引用自定义模块时，参数包含路径，可以省略js\nvar math = require('./math')\nmath.add(2,5)\n//引用核心模块时，不需要路径\nvar http = require('http')\nhttp.createService(...)listen(3000)\n```\n\ncommonJS 用同步的方式加载模块，在服务端，模块文件都存在本地磁盘，读取非常快，所以这样做不会有问题，但是在浏览器端，咸鱼网路原因，更合理的方式是使用异步加载。\n\n## AMD 和 require.js\n\nAMD 规范采用异步方式加载模块，模块加载不影响它后面语句的运行，所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会执行。这里介绍 require.js 实现 AMD 规范的模块化；用 require.config()制定引用路径等，用 define()定义模块，用 require()加载模块。\n\n```javascript\n// 网页中引用require.js及main.js\n;<script src=\"js/require.js\" data-main=\"js/main\"></script>\n//main.js入口文件/主模块\n//首先用config()指定各模块路径和引用名\nrequire.config({\n  baseUrl: 'js/lib',\n  path: {\n    jquery: 'jquery.min',\n    underscore: 'underscore.min'\n  }\n})\n\n//执行基本操作\nrequire(['jquery', 'underscore', function ($, _) {}])\n```\n\n引用模块的时候，我们将模块名放在[]中作为 require()的第一参数；如果我们定义的模块本身也依赖其他模块，那就需要将他们放在[]中作为 define()的第一参数。\n\n```javascript\ndefine(function () {\n  var basicNum = 0\n  var add = function (x, y) {\n    return x + y\n  }\n  return {\n    add: add,\n    basicNum: basicNum\n  }\n})\n//定义一个依赖underscore.js的模块\ndefine(['underscore'], function (_) {\n  var classfiy = function (list) {\n    _.countBy(list, function (num) {\n      return num > 30 ? 'old' : 'young'\n    })\n  }\n  return {\n    classify: classify\n  }\n})\n\n//引用模块，将模块放在[]内\nrequire(['jquery', 'math'], function ($, math) {\n  var sum = math.add(10, 20)\n  $('#sum').html(sum)\n})\n```\n\n## CMD 和 sea.js\n\nrequire.js 在申明依赖的模块时会在第一时间加载并执行模块内的代码：\n\n```javascript\ndefine(['a', 'b', 'c', 'd'], function (a, b, c, d) {\n  if (false) {\n    //即便没有用到某个某块b，但是b还是提前执行\n    b.foo()\n  }\n})\n```\n\nCMD 是另一种 js 模块化方案，它与 AMD 很类似，不同点在于：AMD 退从依赖前置、提前执行，CMD 推荐依赖将近、延迟执行。此规范其实是在 sea.js 推广过程中产生的。\n\n```javascript\n//AMD写法\ndefine(['a', 'b', 'c', 'd'], function (a, b, c, d) {\n  //等于在最前面声明并初始化了要用到的所有模块\n  a.doSomething()\n  if (false) {\n    //即使没有用到某个模块b，但b还是提前执行了\n    b.doSomething()\n  }\n})\n\n//CMD写法\ndefine(function (require, exports, module) {\n  var a = require('./a') //z在需要时声明\n  a.doSomething()\n  if (false) {\n    var b = require('./b')\n    b.doSomething()\n  }\n})\n\n//sea.js\n//定义模块math.js\ndefine(function (require, exports, module) {\n  var $ = require('jquire.js')\n  var add = function (a, b) {\n    return a + b\n  }\n  exports.add = add\n})\n\nseajs.use(['math.js'], function (math) {\n  var sum = math.add(1 + 2)\n})\n```\n\n## ES6 Module\n\nES6 在语言标准的层面上，实现了某块功能，而且实现得相当简单，只在成为浏览器和服务器通用的模块解决方案。其模块功能主要由两个命令构成：export 和 import。export 命令用于规定模块的对外接口，import 命令用于输入其他模块提供功能。\n\n```javascript\n//定义模块math.js\nvar basicNum = 0\nvar add = function (a, b) {\n  return a + b\n}\nexport { basicNum, add }\n//引用模块\nimport { basicNum, add } from './main'\nfunction test(ele) {\n  ele.textContent = add(99 + basicNum)\n}\n```\n\n如上例所示，使用 import 命令的时候，用户需要知道索要加载的变量名或函数名，其实 ES6 还提供了 export default 命令，为模块指定默认输出，对应的 import 语句不需要使用大括号，这也更趋近于 AMD 的引用写法。\n\n```javascript\nexport default { basicNum, add }\nimport math from './math'\nfunction test(ele) {\n  ele.textCount = math.add(99 + math.basicNum)\n}\n```\n\nES6 的模块不是对象，import 命令会被 JavaScript 引擎静态分析，在编译时就引入模块代码，而不是在代码运行时加载，所以无法实现按条件加载。也正是因为这个，使得静态分析成为可能。\n\n## ES6 模块与 commonJS 模块的差异\n\n### CommonJS 模块输出是一个值得拷贝，ES6 模块输出的是一个值的引用\n\n- CommonJS 模块输出的是值得拷贝，也就是说，一旦输出一个值，模块内部的变化就影响不到这个值\n- ES6 模块的运行机制与 CommonJS 不一样，js 引擎对脚本静态分析的时候，遇到模块加载命令 import，就会生成一个只读的引用，因此，es6 模块时动态引用，并且不会缓存值，模块里面的变量绑定在其所在的模块\n\n### CommonJS 模块是运行时加载，ES6 模块时编译时输出接口\n\n- 编译时加载：ES6 模块不是对象，而是通过 export 命令显示指令输出的代码，import 时采用静态命令的形式，既在 import 时可以指定加载摸个输出值，而不是加载整个模块，这种加载称为编译加载\n\n[参考](https://juejin.cn/post/6844903576309858318)\n\n### 遵循的模块化规范不一样\n\n模块化规范：即为 JavaScript 提供一种模块化编写、模块依赖和模块运行的方案。最初的 JavaScript 没有模块化规范，所以很多都是全局变量。\n\n### require 和 import/export 形式不一样\n\nrequire/exports 的用法只有以下 3 种简单的写法。\n\n```javascript\nconst fs = require('fs')\nexports.fs = fs\nmodule.exports = fs\n```\n\n而 import/export 的写法是：\n\n```javascript\nimport fs from 'fs'\nimport {default as fs} from 'fs'\nimport * as fs from 'fs'\nimport {readFile} from 'fs'\nimport {readFile as read} from 'fs'\nimport fs, {readFile} from 'fs'\n\nexport default fs\nexport const fs\nexport function readFile\nexport {readFile, read}\nexport * from 'fs'\n```\n\n### 其他\n\n- CommonJS 加载的是一个对象（既 module.exports 属性），该对象只会在脚本运行玩才会生成，而 ES6 模块不是对象，他的对外接口只是一种静态定义，在代码静态解析阶段就会生成\n- CommonJS 支持动态引入（require(${path}/xx.js)），后者目前不支持，但是已有提案\n- CommonJS 是同步导入，因为用于服务端，文件都在本地，同步导入及时卡住主线程影响也不大，而 ES6 是异步导入，因为用于浏览器，需要下载文件，如果也同步导入会对渲染有很大的影响\n- **从规范与实现定义来讲，require 是动态加载，import 是静态加载**，从底层的运行来讲，require 是在程序运行时去解析而 import 是在编译 的时候去做解析请求包，require 是请求整个包对象而 import 是只请求模块中需要的请求的部分。**现在 import 应该还只算是 ES6 的语法规范，babel 打包的还是 require**\n","source":"_posts/CommonJS、AMD、CMD、ES6.md","raw":"---\ntitle: CommonJS、AMD、CMD、ES6\ndate: 2018-04-04 16:24:01\ncategories: JavaScript\n---\n\n以前没有深究的问题，仔细思考之后发现自己并不清楚，然后记个笔记。\n\n<!--more-->\n\n## CommonJS\n\nNode.js 是 commonJS 规范的主要实践者，它有四个重要的环境为模块化的实现提供支持:module、exports、require、global。实际使用时，用 module.exports 定义当前模块对外输出的接口（不推荐直接使用 exports）用 require 加载模块。\n\n```javascript\nvar basicNum = 0\nfunction add(a, b) {\n  return a + b\n}\nmodule.export = {\n  add:add,\n  basicNum:basicNum\n}\n//引用自定义模块时，参数包含路径，可以省略js\nvar math = require('./math')\nmath.add(2,5)\n//引用核心模块时，不需要路径\nvar http = require('http')\nhttp.createService(...)listen(3000)\n```\n\ncommonJS 用同步的方式加载模块，在服务端，模块文件都存在本地磁盘，读取非常快，所以这样做不会有问题，但是在浏览器端，咸鱼网路原因，更合理的方式是使用异步加载。\n\n## AMD 和 require.js\n\nAMD 规范采用异步方式加载模块，模块加载不影响它后面语句的运行，所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会执行。这里介绍 require.js 实现 AMD 规范的模块化；用 require.config()制定引用路径等，用 define()定义模块，用 require()加载模块。\n\n```javascript\n// 网页中引用require.js及main.js\n;<script src=\"js/require.js\" data-main=\"js/main\"></script>\n//main.js入口文件/主模块\n//首先用config()指定各模块路径和引用名\nrequire.config({\n  baseUrl: 'js/lib',\n  path: {\n    jquery: 'jquery.min',\n    underscore: 'underscore.min'\n  }\n})\n\n//执行基本操作\nrequire(['jquery', 'underscore', function ($, _) {}])\n```\n\n引用模块的时候，我们将模块名放在[]中作为 require()的第一参数；如果我们定义的模块本身也依赖其他模块，那就需要将他们放在[]中作为 define()的第一参数。\n\n```javascript\ndefine(function () {\n  var basicNum = 0\n  var add = function (x, y) {\n    return x + y\n  }\n  return {\n    add: add,\n    basicNum: basicNum\n  }\n})\n//定义一个依赖underscore.js的模块\ndefine(['underscore'], function (_) {\n  var classfiy = function (list) {\n    _.countBy(list, function (num) {\n      return num > 30 ? 'old' : 'young'\n    })\n  }\n  return {\n    classify: classify\n  }\n})\n\n//引用模块，将模块放在[]内\nrequire(['jquery', 'math'], function ($, math) {\n  var sum = math.add(10, 20)\n  $('#sum').html(sum)\n})\n```\n\n## CMD 和 sea.js\n\nrequire.js 在申明依赖的模块时会在第一时间加载并执行模块内的代码：\n\n```javascript\ndefine(['a', 'b', 'c', 'd'], function (a, b, c, d) {\n  if (false) {\n    //即便没有用到某个某块b，但是b还是提前执行\n    b.foo()\n  }\n})\n```\n\nCMD 是另一种 js 模块化方案，它与 AMD 很类似，不同点在于：AMD 退从依赖前置、提前执行，CMD 推荐依赖将近、延迟执行。此规范其实是在 sea.js 推广过程中产生的。\n\n```javascript\n//AMD写法\ndefine(['a', 'b', 'c', 'd'], function (a, b, c, d) {\n  //等于在最前面声明并初始化了要用到的所有模块\n  a.doSomething()\n  if (false) {\n    //即使没有用到某个模块b，但b还是提前执行了\n    b.doSomething()\n  }\n})\n\n//CMD写法\ndefine(function (require, exports, module) {\n  var a = require('./a') //z在需要时声明\n  a.doSomething()\n  if (false) {\n    var b = require('./b')\n    b.doSomething()\n  }\n})\n\n//sea.js\n//定义模块math.js\ndefine(function (require, exports, module) {\n  var $ = require('jquire.js')\n  var add = function (a, b) {\n    return a + b\n  }\n  exports.add = add\n})\n\nseajs.use(['math.js'], function (math) {\n  var sum = math.add(1 + 2)\n})\n```\n\n## ES6 Module\n\nES6 在语言标准的层面上，实现了某块功能，而且实现得相当简单，只在成为浏览器和服务器通用的模块解决方案。其模块功能主要由两个命令构成：export 和 import。export 命令用于规定模块的对外接口，import 命令用于输入其他模块提供功能。\n\n```javascript\n//定义模块math.js\nvar basicNum = 0\nvar add = function (a, b) {\n  return a + b\n}\nexport { basicNum, add }\n//引用模块\nimport { basicNum, add } from './main'\nfunction test(ele) {\n  ele.textContent = add(99 + basicNum)\n}\n```\n\n如上例所示，使用 import 命令的时候，用户需要知道索要加载的变量名或函数名，其实 ES6 还提供了 export default 命令，为模块指定默认输出，对应的 import 语句不需要使用大括号，这也更趋近于 AMD 的引用写法。\n\n```javascript\nexport default { basicNum, add }\nimport math from './math'\nfunction test(ele) {\n  ele.textCount = math.add(99 + math.basicNum)\n}\n```\n\nES6 的模块不是对象，import 命令会被 JavaScript 引擎静态分析，在编译时就引入模块代码，而不是在代码运行时加载，所以无法实现按条件加载。也正是因为这个，使得静态分析成为可能。\n\n## ES6 模块与 commonJS 模块的差异\n\n### CommonJS 模块输出是一个值得拷贝，ES6 模块输出的是一个值的引用\n\n- CommonJS 模块输出的是值得拷贝，也就是说，一旦输出一个值，模块内部的变化就影响不到这个值\n- ES6 模块的运行机制与 CommonJS 不一样，js 引擎对脚本静态分析的时候，遇到模块加载命令 import，就会生成一个只读的引用，因此，es6 模块时动态引用，并且不会缓存值，模块里面的变量绑定在其所在的模块\n\n### CommonJS 模块是运行时加载，ES6 模块时编译时输出接口\n\n- 编译时加载：ES6 模块不是对象，而是通过 export 命令显示指令输出的代码，import 时采用静态命令的形式，既在 import 时可以指定加载摸个输出值，而不是加载整个模块，这种加载称为编译加载\n\n[参考](https://juejin.cn/post/6844903576309858318)\n\n### 遵循的模块化规范不一样\n\n模块化规范：即为 JavaScript 提供一种模块化编写、模块依赖和模块运行的方案。最初的 JavaScript 没有模块化规范，所以很多都是全局变量。\n\n### require 和 import/export 形式不一样\n\nrequire/exports 的用法只有以下 3 种简单的写法。\n\n```javascript\nconst fs = require('fs')\nexports.fs = fs\nmodule.exports = fs\n```\n\n而 import/export 的写法是：\n\n```javascript\nimport fs from 'fs'\nimport {default as fs} from 'fs'\nimport * as fs from 'fs'\nimport {readFile} from 'fs'\nimport {readFile as read} from 'fs'\nimport fs, {readFile} from 'fs'\n\nexport default fs\nexport const fs\nexport function readFile\nexport {readFile, read}\nexport * from 'fs'\n```\n\n### 其他\n\n- CommonJS 加载的是一个对象（既 module.exports 属性），该对象只会在脚本运行玩才会生成，而 ES6 模块不是对象，他的对外接口只是一种静态定义，在代码静态解析阶段就会生成\n- CommonJS 支持动态引入（require(${path}/xx.js)），后者目前不支持，但是已有提案\n- CommonJS 是同步导入，因为用于服务端，文件都在本地，同步导入及时卡住主线程影响也不大，而 ES6 是异步导入，因为用于浏览器，需要下载文件，如果也同步导入会对渲染有很大的影响\n- **从规范与实现定义来讲，require 是动态加载，import 是静态加载**，从底层的运行来讲，require 是在程序运行时去解析而 import 是在编译 的时候去做解析请求包，require 是请求整个包对象而 import 是只请求模块中需要的请求的部分。**现在 import 应该还只算是 ES6 的语法规范，babel 打包的还是 require**\n","slug":"CommonJS、AMD、CMD、ES6","published":1,"updated":"2021-05-23T11:47:12.125Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckp148wwn000047v00t2b21o6","content":"<p>以前没有深究的问题，仔细思考之后发现自己并不清楚，然后记个笔记。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"CommonJS\"><a href=\"#CommonJS\" class=\"headerlink\" title=\"CommonJS\"></a>CommonJS</h2><p>Node.js 是 commonJS 规范的主要实践者，它有四个重要的环境为模块化的实现提供支持:module、exports、require、global。实际使用时，用 module.exports 定义当前模块对外输出的接口（不推荐直接使用 exports）用 require 加载模块。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> basicNum = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.export = &#123;</span><br><span class=\"line\">  add:add,</span><br><span class=\"line\">  basicNum:basicNum</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//引用自定义模块时，参数包含路径，可以省略js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> math = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./math&#x27;</span>)</span><br><span class=\"line\">math.add(<span class=\"number\">2</span>,<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"comment\">//引用核心模块时，不需要路径</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\">http.createService(...)listen(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<p>commonJS 用同步的方式加载模块，在服务端，模块文件都存在本地磁盘，读取非常快，所以这样做不会有问题，但是在浏览器端，咸鱼网路原因，更合理的方式是使用异步加载。</p>\n<h2 id=\"AMD-和-require-js\"><a href=\"#AMD-和-require-js\" class=\"headerlink\" title=\"AMD 和 require.js\"></a>AMD 和 require.js</h2><p>AMD 规范采用异步方式加载模块，模块加载不影响它后面语句的运行，所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会执行。这里介绍 require.js 实现 AMD 规范的模块化；用 require.config()制定引用路径等，用 define()定义模块，用 require()加载模块。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 网页中引用require.js及main.js</span></span><br><span class=\"line\">;<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/require.js&quot;</span> <span class=\"attr\">data-main</span>=<span class=\"string\">&quot;js/main&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\">//main.js入口文件/主模块</span></span><br><span class=\"line\"><span class=\"comment\">//首先用config()指定各模块路径和引用名</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>.config(&#123;</span><br><span class=\"line\">  baseUrl: <span class=\"string\">&#x27;js/lib&#x27;</span>,</span><br><span class=\"line\">  path: &#123;</span><br><span class=\"line\">    jquery: <span class=\"string\">&#x27;jquery.min&#x27;</span>,</span><br><span class=\"line\">    underscore: <span class=\"string\">&#x27;underscore.min&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//执行基本操作</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">&#x27;jquery&#x27;</span>, <span class=\"string\">&#x27;underscore&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$, _</span>) </span>&#123;&#125;])</span><br></pre></td></tr></table></figure>\n\n<p>引用模块的时候，我们将模块名放在[]中作为 require()的第一参数；如果我们定义的模块本身也依赖其他模块，那就需要将他们放在[]中作为 define()的第一参数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> basicNum = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> add = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    add: add,</span><br><span class=\"line\">    basicNum: basicNum</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">//定义一个依赖underscore.js的模块</span></span><br><span class=\"line\">define([<span class=\"string\">&#x27;underscore&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">_</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> classfiy = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">list</span>) </span>&#123;</span><br><span class=\"line\">    _.countBy(list, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> num &gt; <span class=\"number\">30</span> ? <span class=\"string\">&#x27;old&#x27;</span> : <span class=\"string\">&#x27;young&#x27;</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    classify: classify</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//引用模块，将模块放在[]内</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">&#x27;jquery&#x27;</span>, <span class=\"string\">&#x27;math&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$, math</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> sum = math.add(<span class=\"number\">10</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">  $(<span class=\"string\">&#x27;#sum&#x27;</span>).html(sum)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"CMD-和-sea-js\"><a href=\"#CMD-和-sea-js\" class=\"headerlink\" title=\"CMD 和 sea.js\"></a>CMD 和 sea.js</h2><p>require.js 在申明依赖的模块时会在第一时间加载并执行模块内的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define([<span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;d&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b, c, d</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//即便没有用到某个某块b，但是b还是提前执行</span></span><br><span class=\"line\">    b.foo()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>CMD 是另一种 js 模块化方案，它与 AMD 很类似，不同点在于：AMD 退从依赖前置、提前执行，CMD 推荐依赖将近、延迟执行。此规范其实是在 sea.js 推广过程中产生的。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//AMD写法</span></span><br><span class=\"line\">define([<span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;d&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b, c, d</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//等于在最前面声明并初始化了要用到的所有模块</span></span><br><span class=\"line\">  a.doSomething()</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//即使没有用到某个模块b，但b还是提前执行了</span></span><br><span class=\"line\">    b.doSomething()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//CMD写法</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"built_in\">require</span>, <span class=\"built_in\">exports</span>, <span class=\"built_in\">module</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./a&#x27;</span>) <span class=\"comment\">//z在需要时声明</span></span><br><span class=\"line\">  a.doSomething()</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> b = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./b&#x27;</span>)</span><br><span class=\"line\">    b.doSomething()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//sea.js</span></span><br><span class=\"line\"><span class=\"comment\">//定义模块math.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"built_in\">require</span>, <span class=\"built_in\">exports</span>, <span class=\"built_in\">module</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $ = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;jquire.js&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> add = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">exports</span>.add = add</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">seajs.use([<span class=\"string\">&#x27;math.js&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">math</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> sum = math.add(<span class=\"number\">1</span> + <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ES6-Module\"><a href=\"#ES6-Module\" class=\"headerlink\" title=\"ES6 Module\"></a>ES6 Module</h2><p>ES6 在语言标准的层面上，实现了某块功能，而且实现得相当简单，只在成为浏览器和服务器通用的模块解决方案。其模块功能主要由两个命令构成：export 和 import。export 命令用于规定模块的对外接口，import 命令用于输入其他模块提供功能。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义模块math.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> basicNum = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> add = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; basicNum, add &#125;</span><br><span class=\"line\"><span class=\"comment\">//引用模块</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; basicNum, add &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./main&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">ele</span>) </span>&#123;</span><br><span class=\"line\">  ele.textContent = add(<span class=\"number\">99</span> + basicNum)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如上例所示，使用 import 命令的时候，用户需要知道索要加载的变量名或函数名，其实 ES6 还提供了 export default 命令，为模块指定默认输出，对应的 import 语句不需要使用大括号，这也更趋近于 AMD 的引用写法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123; basicNum, add &#125;</span><br><span class=\"line\"><span class=\"keyword\">import</span> math <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./math&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">ele</span>) </span>&#123;</span><br><span class=\"line\">  ele.textCount = math.add(<span class=\"number\">99</span> + math.basicNum)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ES6 的模块不是对象，import 命令会被 JavaScript 引擎静态分析，在编译时就引入模块代码，而不是在代码运行时加载，所以无法实现按条件加载。也正是因为这个，使得静态分析成为可能。</p>\n<h2 id=\"ES6-模块与-commonJS-模块的差异\"><a href=\"#ES6-模块与-commonJS-模块的差异\" class=\"headerlink\" title=\"ES6 模块与 commonJS 模块的差异\"></a>ES6 模块与 commonJS 模块的差异</h2><h3 id=\"CommonJS-模块输出是一个值得拷贝，ES6-模块输出的是一个值的引用\"><a href=\"#CommonJS-模块输出是一个值得拷贝，ES6-模块输出的是一个值的引用\" class=\"headerlink\" title=\"CommonJS 模块输出是一个值得拷贝，ES6 模块输出的是一个值的引用\"></a>CommonJS 模块输出是一个值得拷贝，ES6 模块输出的是一个值的引用</h3><ul>\n<li>CommonJS 模块输出的是值得拷贝，也就是说，一旦输出一个值，模块内部的变化就影响不到这个值</li>\n<li>ES6 模块的运行机制与 CommonJS 不一样，js 引擎对脚本静态分析的时候，遇到模块加载命令 import，就会生成一个只读的引用，因此，es6 模块时动态引用，并且不会缓存值，模块里面的变量绑定在其所在的模块</li>\n</ul>\n<h3 id=\"CommonJS-模块是运行时加载，ES6-模块时编译时输出接口\"><a href=\"#CommonJS-模块是运行时加载，ES6-模块时编译时输出接口\" class=\"headerlink\" title=\"CommonJS 模块是运行时加载，ES6 模块时编译时输出接口\"></a>CommonJS 模块是运行时加载，ES6 模块时编译时输出接口</h3><ul>\n<li>编译时加载：ES6 模块不是对象，而是通过 export 命令显示指令输出的代码，import 时采用静态命令的形式，既在 import 时可以指定加载摸个输出值，而不是加载整个模块，这种加载称为编译加载</li>\n</ul>\n<p><a href=\"https://juejin.cn/post/6844903576309858318\">参考</a></p>\n<h3 id=\"遵循的模块化规范不一样\"><a href=\"#遵循的模块化规范不一样\" class=\"headerlink\" title=\"遵循的模块化规范不一样\"></a>遵循的模块化规范不一样</h3><p>模块化规范：即为 JavaScript 提供一种模块化编写、模块依赖和模块运行的方案。最初的 JavaScript 没有模块化规范，所以很多都是全局变量。</p>\n<h3 id=\"require-和-import-export-形式不一样\"><a href=\"#require-和-import-export-形式不一样\" class=\"headerlink\" title=\"require 和 import/export 形式不一样\"></a>require 和 import/export 形式不一样</h3><p>require/exports 的用法只有以下 3 种简单的写法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">exports</span>.fs = fs</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = fs</span><br></pre></td></tr></table></figure>\n\n<p>而 import/export 的写法是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> fs <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"keyword\">default</span> <span class=\"keyword\">as</span> fs&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> fs <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;readFile&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;readFile <span class=\"keyword\">as</span> read&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> fs, &#123;readFile&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> fs</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> fs</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readFile</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">export</span> </span>&#123;readFile, read&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> * <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><ul>\n<li>CommonJS 加载的是一个对象（既 module.exports 属性），该对象只会在脚本运行玩才会生成，而 ES6 模块不是对象，他的对外接口只是一种静态定义，在代码静态解析阶段就会生成</li>\n<li>CommonJS 支持动态引入（require(${path}/xx.js)），后者目前不支持，但是已有提案</li>\n<li>CommonJS 是同步导入，因为用于服务端，文件都在本地，同步导入及时卡住主线程影响也不大，而 ES6 是异步导入，因为用于浏览器，需要下载文件，如果也同步导入会对渲染有很大的影响</li>\n<li><strong>从规范与实现定义来讲，require 是动态加载，import 是静态加载</strong>，从底层的运行来讲，require 是在程序运行时去解析而 import 是在编译 的时候去做解析请求包，require 是请求整个包对象而 import 是只请求模块中需要的请求的部分。<strong>现在 import 应该还只算是 ES6 的语法规范，babel 打包的还是 require</strong></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>以前没有深究的问题，仔细思考之后发现自己并不清楚，然后记个笔记。</p>","more":"<h2 id=\"CommonJS\"><a href=\"#CommonJS\" class=\"headerlink\" title=\"CommonJS\"></a>CommonJS</h2><p>Node.js 是 commonJS 规范的主要实践者，它有四个重要的环境为模块化的实现提供支持:module、exports、require、global。实际使用时，用 module.exports 定义当前模块对外输出的接口（不推荐直接使用 exports）用 require 加载模块。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> basicNum = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.export = &#123;</span><br><span class=\"line\">  add:add,</span><br><span class=\"line\">  basicNum:basicNum</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//引用自定义模块时，参数包含路径，可以省略js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> math = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./math&#x27;</span>)</span><br><span class=\"line\">math.add(<span class=\"number\">2</span>,<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"comment\">//引用核心模块时，不需要路径</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\">http.createService(...)listen(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<p>commonJS 用同步的方式加载模块，在服务端，模块文件都存在本地磁盘，读取非常快，所以这样做不会有问题，但是在浏览器端，咸鱼网路原因，更合理的方式是使用异步加载。</p>\n<h2 id=\"AMD-和-require-js\"><a href=\"#AMD-和-require-js\" class=\"headerlink\" title=\"AMD 和 require.js\"></a>AMD 和 require.js</h2><p>AMD 规范采用异步方式加载模块，模块加载不影响它后面语句的运行，所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会执行。这里介绍 require.js 实现 AMD 规范的模块化；用 require.config()制定引用路径等，用 define()定义模块，用 require()加载模块。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 网页中引用require.js及main.js</span></span><br><span class=\"line\">;<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/require.js&quot;</span> <span class=\"attr\">data-main</span>=<span class=\"string\">&quot;js/main&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\">//main.js入口文件/主模块</span></span><br><span class=\"line\"><span class=\"comment\">//首先用config()指定各模块路径和引用名</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>.config(&#123;</span><br><span class=\"line\">  baseUrl: <span class=\"string\">&#x27;js/lib&#x27;</span>,</span><br><span class=\"line\">  path: &#123;</span><br><span class=\"line\">    jquery: <span class=\"string\">&#x27;jquery.min&#x27;</span>,</span><br><span class=\"line\">    underscore: <span class=\"string\">&#x27;underscore.min&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//执行基本操作</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">&#x27;jquery&#x27;</span>, <span class=\"string\">&#x27;underscore&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$, _</span>) </span>&#123;&#125;])</span><br></pre></td></tr></table></figure>\n\n<p>引用模块的时候，我们将模块名放在[]中作为 require()的第一参数；如果我们定义的模块本身也依赖其他模块，那就需要将他们放在[]中作为 define()的第一参数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> basicNum = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> add = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    add: add,</span><br><span class=\"line\">    basicNum: basicNum</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">//定义一个依赖underscore.js的模块</span></span><br><span class=\"line\">define([<span class=\"string\">&#x27;underscore&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">_</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> classfiy = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">list</span>) </span>&#123;</span><br><span class=\"line\">    _.countBy(list, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> num &gt; <span class=\"number\">30</span> ? <span class=\"string\">&#x27;old&#x27;</span> : <span class=\"string\">&#x27;young&#x27;</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    classify: classify</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//引用模块，将模块放在[]内</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">&#x27;jquery&#x27;</span>, <span class=\"string\">&#x27;math&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$, math</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> sum = math.add(<span class=\"number\">10</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">  $(<span class=\"string\">&#x27;#sum&#x27;</span>).html(sum)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"CMD-和-sea-js\"><a href=\"#CMD-和-sea-js\" class=\"headerlink\" title=\"CMD 和 sea.js\"></a>CMD 和 sea.js</h2><p>require.js 在申明依赖的模块时会在第一时间加载并执行模块内的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define([<span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;d&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b, c, d</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//即便没有用到某个某块b，但是b还是提前执行</span></span><br><span class=\"line\">    b.foo()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>CMD 是另一种 js 模块化方案，它与 AMD 很类似，不同点在于：AMD 退从依赖前置、提前执行，CMD 推荐依赖将近、延迟执行。此规范其实是在 sea.js 推广过程中产生的。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//AMD写法</span></span><br><span class=\"line\">define([<span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;d&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b, c, d</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//等于在最前面声明并初始化了要用到的所有模块</span></span><br><span class=\"line\">  a.doSomething()</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//即使没有用到某个模块b，但b还是提前执行了</span></span><br><span class=\"line\">    b.doSomething()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//CMD写法</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"built_in\">require</span>, <span class=\"built_in\">exports</span>, <span class=\"built_in\">module</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./a&#x27;</span>) <span class=\"comment\">//z在需要时声明</span></span><br><span class=\"line\">  a.doSomething()</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> b = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./b&#x27;</span>)</span><br><span class=\"line\">    b.doSomething()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//sea.js</span></span><br><span class=\"line\"><span class=\"comment\">//定义模块math.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"><span class=\"built_in\">require</span>, <span class=\"built_in\">exports</span>, <span class=\"built_in\">module</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $ = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;jquire.js&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> add = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">exports</span>.add = add</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">seajs.use([<span class=\"string\">&#x27;math.js&#x27;</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">math</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> sum = math.add(<span class=\"number\">1</span> + <span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ES6-Module\"><a href=\"#ES6-Module\" class=\"headerlink\" title=\"ES6 Module\"></a>ES6 Module</h2><p>ES6 在语言标准的层面上，实现了某块功能，而且实现得相当简单，只在成为浏览器和服务器通用的模块解决方案。其模块功能主要由两个命令构成：export 和 import。export 命令用于规定模块的对外接口，import 命令用于输入其他模块提供功能。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义模块math.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> basicNum = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> add = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; basicNum, add &#125;</span><br><span class=\"line\"><span class=\"comment\">//引用模块</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; basicNum, add &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./main&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">ele</span>) </span>&#123;</span><br><span class=\"line\">  ele.textContent = add(<span class=\"number\">99</span> + basicNum)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如上例所示，使用 import 命令的时候，用户需要知道索要加载的变量名或函数名，其实 ES6 还提供了 export default 命令，为模块指定默认输出，对应的 import 语句不需要使用大括号，这也更趋近于 AMD 的引用写法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123; basicNum, add &#125;</span><br><span class=\"line\"><span class=\"keyword\">import</span> math <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./math&#x27;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">ele</span>) </span>&#123;</span><br><span class=\"line\">  ele.textCount = math.add(<span class=\"number\">99</span> + math.basicNum)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ES6 的模块不是对象，import 命令会被 JavaScript 引擎静态分析，在编译时就引入模块代码，而不是在代码运行时加载，所以无法实现按条件加载。也正是因为这个，使得静态分析成为可能。</p>\n<h2 id=\"ES6-模块与-commonJS-模块的差异\"><a href=\"#ES6-模块与-commonJS-模块的差异\" class=\"headerlink\" title=\"ES6 模块与 commonJS 模块的差异\"></a>ES6 模块与 commonJS 模块的差异</h2><h3 id=\"CommonJS-模块输出是一个值得拷贝，ES6-模块输出的是一个值的引用\"><a href=\"#CommonJS-模块输出是一个值得拷贝，ES6-模块输出的是一个值的引用\" class=\"headerlink\" title=\"CommonJS 模块输出是一个值得拷贝，ES6 模块输出的是一个值的引用\"></a>CommonJS 模块输出是一个值得拷贝，ES6 模块输出的是一个值的引用</h3><ul>\n<li>CommonJS 模块输出的是值得拷贝，也就是说，一旦输出一个值，模块内部的变化就影响不到这个值</li>\n<li>ES6 模块的运行机制与 CommonJS 不一样，js 引擎对脚本静态分析的时候，遇到模块加载命令 import，就会生成一个只读的引用，因此，es6 模块时动态引用，并且不会缓存值，模块里面的变量绑定在其所在的模块</li>\n</ul>\n<h3 id=\"CommonJS-模块是运行时加载，ES6-模块时编译时输出接口\"><a href=\"#CommonJS-模块是运行时加载，ES6-模块时编译时输出接口\" class=\"headerlink\" title=\"CommonJS 模块是运行时加载，ES6 模块时编译时输出接口\"></a>CommonJS 模块是运行时加载，ES6 模块时编译时输出接口</h3><ul>\n<li>编译时加载：ES6 模块不是对象，而是通过 export 命令显示指令输出的代码，import 时采用静态命令的形式，既在 import 时可以指定加载摸个输出值，而不是加载整个模块，这种加载称为编译加载</li>\n</ul>\n<p><a href=\"https://juejin.cn/post/6844903576309858318\">参考</a></p>\n<h3 id=\"遵循的模块化规范不一样\"><a href=\"#遵循的模块化规范不一样\" class=\"headerlink\" title=\"遵循的模块化规范不一样\"></a>遵循的模块化规范不一样</h3><p>模块化规范：即为 JavaScript 提供一种模块化编写、模块依赖和模块运行的方案。最初的 JavaScript 没有模块化规范，所以很多都是全局变量。</p>\n<h3 id=\"require-和-import-export-形式不一样\"><a href=\"#require-和-import-export-形式不一样\" class=\"headerlink\" title=\"require 和 import/export 形式不一样\"></a>require 和 import/export 形式不一样</h3><p>require/exports 的用法只有以下 3 种简单的写法。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">exports</span>.fs = fs</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = fs</span><br></pre></td></tr></table></figure>\n\n<p>而 import/export 的写法是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> fs <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"keyword\">default</span> <span class=\"keyword\">as</span> fs&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> fs <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;readFile&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;readFile <span class=\"keyword\">as</span> read&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> fs, &#123;readFile&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> fs</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> fs</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readFile</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">export</span> </span>&#123;readFile, read&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> * <span class=\"keyword\">from</span> <span class=\"string\">&#x27;fs&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><ul>\n<li>CommonJS 加载的是一个对象（既 module.exports 属性），该对象只会在脚本运行玩才会生成，而 ES6 模块不是对象，他的对外接口只是一种静态定义，在代码静态解析阶段就会生成</li>\n<li>CommonJS 支持动态引入（require(${path}/xx.js)），后者目前不支持，但是已有提案</li>\n<li>CommonJS 是同步导入，因为用于服务端，文件都在本地，同步导入及时卡住主线程影响也不大，而 ES6 是异步导入，因为用于浏览器，需要下载文件，如果也同步导入会对渲染有很大的影响</li>\n<li><strong>从规范与实现定义来讲，require 是动态加载，import 是静态加载</strong>，从底层的运行来讲，require 是在程序运行时去解析而 import 是在编译 的时候去做解析请求包，require 是请求整个包对象而 import 是只请求模块中需要的请求的部分。<strong>现在 import 应该还只算是 ES6 的语法规范，babel 打包的还是 require</strong></li>\n</ul>"},{"title":"运营商劫持","date":"2021-05-23T11:45:57.000Z","_content":"\n什么是运营商劫持?有什么预防措施？\n\n<!--more-->\n\n## 什么是运营商\n\n运营商是指那些提供宽带服务的 ISP，包括三大运营商中国电信、中国移动、中国联通，还有一些小运营商，比如长城宽带等。运营商提供最基础的网络服务，掌握着通往用户武力大门的钥匙，目前运营商劫持很普遍。\n\n## 劫持方式\n\n常见的方式有三种，分别是 DNS 劫持、HTTP 劫持（HTTP 是明文传输）、HTTPS 劫持\n\n## DNS 劫持\n\n这种劫持会将页面链接重定向到其他网站，所熟知的钓鱼网站就是如此，但是因为它的违法性， 现在被严厉监管起来。DNS 是域名和 IP 地址相互映射的一个分布式数据库，DNS 使用 TCP 和 UDP 端口。DNS 劫持是通过某种技术手段，篡改正确域名和 IP 地址的映射关系，使得域名映射到了错误的 IP 地址，因此可以认为 DNS 劫持是一种 DNS 重定向攻击。\n\n### 本地 DNS 劫持\n\n客户端侧发生的 DNS 劫持统称为本地 DNS 劫持。本地 DNS 劫持可能是：\n\n1. 黑客通过木马病毒或者恶意程序入侵 PC，篡改 DNS 配置（host 文件，DNS 服务器地址，DNS 缓存等）\n2. 黑客利用路由器漏洞或者攻击路由器管理账号入侵路由器并且篡改 DNS 配置。\n3. 一些企业配置设备（如 Cisco Umbrella intelligent proxy）针对切页内部场景对一些特定的域名做 DNS 劫持解析为指定的结果。\n\n### DNS 解析路径劫持\n\nDNS 解析过程中发生在哭护短和 DNS 服务器网络通信时的 DNS 劫持统一归类为 DNS 解析路径劫持。通过对 DNS 解析报文在查询阶段的劫持路径进行划分，又可以将 DNS 解析路径劫持划分为以下 3 类\n\n- DNS 请求转发：通过技术手段（中间盒子，软件等）将 DNS 流量重定向到其他 DNS 服务器。\n- DNS 请求复制：利用分光设备将 DNS 查询复制到网络设备，并先于正常应答返回 DNS 劫持结果（一个 DNS 查询抓包返回两个不同的应答）\n- DNS 请求代答：网络设备或软件直接代替 DNS 服务器对 DNS 查询进行应答\n\n### 篡改 DNS 权威记录\n\n串改 DNS 权威记录是指黑客非法入侵 DNS 权威记录管理账号，直接修改 DNS 记录的行为（黑客黑入域名的管理账户，篡改 DNS 权威记录指向自己的恶意服务器以实现 DNS 劫持。\n\n### DNS 劫持应对策略\n\n- 安装杀毒软件，防御木马病毒和恶意软件；定期修改路由器管理账号密码和更新固件\n- 选择支持 DNSSEC 域名解析服务商，并且给自己的域名实施 DNSSEC。DNSSEC 能够保证递归 DNS 服务器和权威 DNS 服务器之间的通信不被篡改。（阿里云 DNS）\n- 在客户端和递归 DNS 服务器通信的使用 DNS 加密技术，例如 DNS-over-TLS,DNS-over-HTTPS 等\n\n## HTTP 劫持\n\n有时页脚会出现一些小广告，有时这些广告不是站点的，而是第三方运营商提供的\n\nHTTP 劫持的步骤：\n\n- 标识 HTTP 连接，在总舵的 TCP 链接中，找到应用层采用了 HTTP 协议的链接，进行标识\n- 篡改 HTTP 的响应体，可以通过网关来获取数据包进行内容的篡改\n- 抢先回包，将篡改后的数据包强心正常点返回的数据包先到达用户侧，这样后面正常的数据包在达到之后会被直接丢弃\n\n### HTTP 劫持的防范\n\n一般都是插入静态脚本或者是 HTML Contenet，或者是将整体替换成 iframe，然后在顶层的 iframe 上进行内容的植入。（script、iframe 注入型劫持）\n\nHTTP 劫持的防范主要分为\n\n- 事前加密\n  - https,TLS 握手会有 2 次 RTT 延迟\n  - 加密代理：加密代理是在用户侧和目标 web 服务器之间增加一个代理服务器，在用户和代理之间使用 HTTP 请求，只需确认代理与 web 服务之间不会被 HTTP 劫持就可以避开 HTTP 劫持\n- 事中规避\n  拆分 HTTP 请求数据包\n- 事后屏蔽\n  通过浏览器 Api，根据若干规则去匹配 DOM 中的节点，对匹配到的节点作拦截和隐藏\n\nCSP（内容安全策略），DOM 事件监听等。\n\n## HTTPS 劫持\n\nHTTPS 劫持有两种：\n\n- 伪造证书，通过病毒或者其他方式将伪造证书的根证书安装在用户系统中\n- 代理也有客户的证书与私钥，或者客户端与代理认证的时候不校验合法性，即可通过代理来与我们服务端进行数据交互（较多）\n\n### MITM\n\n中间人攻击(man-in-the-middle attack, abbreviated to MITM),简单的讲，就是黑客悄悄的躲在通信双方之间，窃听甚至篡改通信信息。而通信双方并不知道消息已经被截获甚至篡改了。\n\n也有一些人通过代理服务器浏览外网，这里的代理服务器其实就是充当中间人的角色，所以要当心使用免费 vpn。\n\n在通信过程中，客户端或者操作系统内置了权威 CA 的根证书，而服务器在通信之初，会先返回在 CA 那里获取的签名证书，然后客户端用根证书验证证书有效性，最后使用验证通过的证书提供公钥加密数据\n\n早年 12306 使用了自己签名的证书，但是主流浏览器不认可，导致用户需要在首次下载证书并安装，不发纷争完全可以利用这个机制把非法、书安装到用户设备上，但如今 12306 已经采用 digiCert 颁布的证书了\n\n除了 CA 数字证书，还有一些专用的秘钥交互协议，比如 ZRTP、HPKP、DNSSEC 等，他们都能在一定程度上保证通信安全\n\n## 参考与扩展\n\n- [聊一聊 DNS 劫持那些事](https://zhuanlan.zhihu.com/p/86538629)\n- [DNS 攻击防范科普系列一](https://developer.aliyun.com/article/711961)\n- [DNS 服务器怎么防 DDoS 攻击](https://www.aliyun.com/?spm=a2c6h.12873639.J_8058803260.1.17a82993X6QmeG)\n- [如何保障 DNS 操作安全](https://developer.aliyun.com/article/716777)\n- [遭遇 DNS 缓存投毒该怎么办](https://developer.aliyun.com/article/718497)\n- [HTTP 劫持](https://zhuanlan.zhihu.com/p/31344484)\n- [中间人攻击，HTTPS 也可以被碾压](https://segmentfault.com/a/1190000020405407)\n- [12306 的证书问题](https://weibo.com/p/230418639769c30102vx8d?mod=zwenzhang&sudaref=www.google.com)\n- [防运营商劫持](https://juejin.cn/post/6844903713669283847)\n- [SSLStrip 的未来 —— HTTPS 前端劫持](https://fex.baidu.com/blog/2014/08/ssl-frontend-hijack/)\n- [如何劫持 https 的请求](https://github.com/airuikun/Weekly-FE-Interview/issues/11)\n- [HTTPS 劫持漫谈：代理劫持与透明劫持](https://blog.xray.cool/post/HTTPS-hijacking/)\n- [安全背后: 浏览器是如何校验证书的](https://cjting.me/2021/03/02/how-to-validate-tls-certificate/)\n- [运营商 DNS 劫持的那些事儿](https://blogs.360.cn/post/%E8%BF%90%E8%90%A5%E5%95%86dns%E5%8A%AB%E6%8C%81%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF-%E4%BD%9C%E8%80%85%EF%BC%9Airideas.html)\n","source":"_posts/运营商劫持.md","raw":"---\ntitle: 运营商劫持\ndate: 2021-05-23 19:45:57\ncategories: 网络&安全\n---\n\n什么是运营商劫持?有什么预防措施？\n\n<!--more-->\n\n## 什么是运营商\n\n运营商是指那些提供宽带服务的 ISP，包括三大运营商中国电信、中国移动、中国联通，还有一些小运营商，比如长城宽带等。运营商提供最基础的网络服务，掌握着通往用户武力大门的钥匙，目前运营商劫持很普遍。\n\n## 劫持方式\n\n常见的方式有三种，分别是 DNS 劫持、HTTP 劫持（HTTP 是明文传输）、HTTPS 劫持\n\n## DNS 劫持\n\n这种劫持会将页面链接重定向到其他网站，所熟知的钓鱼网站就是如此，但是因为它的违法性， 现在被严厉监管起来。DNS 是域名和 IP 地址相互映射的一个分布式数据库，DNS 使用 TCP 和 UDP 端口。DNS 劫持是通过某种技术手段，篡改正确域名和 IP 地址的映射关系，使得域名映射到了错误的 IP 地址，因此可以认为 DNS 劫持是一种 DNS 重定向攻击。\n\n### 本地 DNS 劫持\n\n客户端侧发生的 DNS 劫持统称为本地 DNS 劫持。本地 DNS 劫持可能是：\n\n1. 黑客通过木马病毒或者恶意程序入侵 PC，篡改 DNS 配置（host 文件，DNS 服务器地址，DNS 缓存等）\n2. 黑客利用路由器漏洞或者攻击路由器管理账号入侵路由器并且篡改 DNS 配置。\n3. 一些企业配置设备（如 Cisco Umbrella intelligent proxy）针对切页内部场景对一些特定的域名做 DNS 劫持解析为指定的结果。\n\n### DNS 解析路径劫持\n\nDNS 解析过程中发生在哭护短和 DNS 服务器网络通信时的 DNS 劫持统一归类为 DNS 解析路径劫持。通过对 DNS 解析报文在查询阶段的劫持路径进行划分，又可以将 DNS 解析路径劫持划分为以下 3 类\n\n- DNS 请求转发：通过技术手段（中间盒子，软件等）将 DNS 流量重定向到其他 DNS 服务器。\n- DNS 请求复制：利用分光设备将 DNS 查询复制到网络设备，并先于正常应答返回 DNS 劫持结果（一个 DNS 查询抓包返回两个不同的应答）\n- DNS 请求代答：网络设备或软件直接代替 DNS 服务器对 DNS 查询进行应答\n\n### 篡改 DNS 权威记录\n\n串改 DNS 权威记录是指黑客非法入侵 DNS 权威记录管理账号，直接修改 DNS 记录的行为（黑客黑入域名的管理账户，篡改 DNS 权威记录指向自己的恶意服务器以实现 DNS 劫持。\n\n### DNS 劫持应对策略\n\n- 安装杀毒软件，防御木马病毒和恶意软件；定期修改路由器管理账号密码和更新固件\n- 选择支持 DNSSEC 域名解析服务商，并且给自己的域名实施 DNSSEC。DNSSEC 能够保证递归 DNS 服务器和权威 DNS 服务器之间的通信不被篡改。（阿里云 DNS）\n- 在客户端和递归 DNS 服务器通信的使用 DNS 加密技术，例如 DNS-over-TLS,DNS-over-HTTPS 等\n\n## HTTP 劫持\n\n有时页脚会出现一些小广告，有时这些广告不是站点的，而是第三方运营商提供的\n\nHTTP 劫持的步骤：\n\n- 标识 HTTP 连接，在总舵的 TCP 链接中，找到应用层采用了 HTTP 协议的链接，进行标识\n- 篡改 HTTP 的响应体，可以通过网关来获取数据包进行内容的篡改\n- 抢先回包，将篡改后的数据包强心正常点返回的数据包先到达用户侧，这样后面正常的数据包在达到之后会被直接丢弃\n\n### HTTP 劫持的防范\n\n一般都是插入静态脚本或者是 HTML Contenet，或者是将整体替换成 iframe，然后在顶层的 iframe 上进行内容的植入。（script、iframe 注入型劫持）\n\nHTTP 劫持的防范主要分为\n\n- 事前加密\n  - https,TLS 握手会有 2 次 RTT 延迟\n  - 加密代理：加密代理是在用户侧和目标 web 服务器之间增加一个代理服务器，在用户和代理之间使用 HTTP 请求，只需确认代理与 web 服务之间不会被 HTTP 劫持就可以避开 HTTP 劫持\n- 事中规避\n  拆分 HTTP 请求数据包\n- 事后屏蔽\n  通过浏览器 Api，根据若干规则去匹配 DOM 中的节点，对匹配到的节点作拦截和隐藏\n\nCSP（内容安全策略），DOM 事件监听等。\n\n## HTTPS 劫持\n\nHTTPS 劫持有两种：\n\n- 伪造证书，通过病毒或者其他方式将伪造证书的根证书安装在用户系统中\n- 代理也有客户的证书与私钥，或者客户端与代理认证的时候不校验合法性，即可通过代理来与我们服务端进行数据交互（较多）\n\n### MITM\n\n中间人攻击(man-in-the-middle attack, abbreviated to MITM),简单的讲，就是黑客悄悄的躲在通信双方之间，窃听甚至篡改通信信息。而通信双方并不知道消息已经被截获甚至篡改了。\n\n也有一些人通过代理服务器浏览外网，这里的代理服务器其实就是充当中间人的角色，所以要当心使用免费 vpn。\n\n在通信过程中，客户端或者操作系统内置了权威 CA 的根证书，而服务器在通信之初，会先返回在 CA 那里获取的签名证书，然后客户端用根证书验证证书有效性，最后使用验证通过的证书提供公钥加密数据\n\n早年 12306 使用了自己签名的证书，但是主流浏览器不认可，导致用户需要在首次下载证书并安装，不发纷争完全可以利用这个机制把非法、书安装到用户设备上，但如今 12306 已经采用 digiCert 颁布的证书了\n\n除了 CA 数字证书，还有一些专用的秘钥交互协议，比如 ZRTP、HPKP、DNSSEC 等，他们都能在一定程度上保证通信安全\n\n## 参考与扩展\n\n- [聊一聊 DNS 劫持那些事](https://zhuanlan.zhihu.com/p/86538629)\n- [DNS 攻击防范科普系列一](https://developer.aliyun.com/article/711961)\n- [DNS 服务器怎么防 DDoS 攻击](https://www.aliyun.com/?spm=a2c6h.12873639.J_8058803260.1.17a82993X6QmeG)\n- [如何保障 DNS 操作安全](https://developer.aliyun.com/article/716777)\n- [遭遇 DNS 缓存投毒该怎么办](https://developer.aliyun.com/article/718497)\n- [HTTP 劫持](https://zhuanlan.zhihu.com/p/31344484)\n- [中间人攻击，HTTPS 也可以被碾压](https://segmentfault.com/a/1190000020405407)\n- [12306 的证书问题](https://weibo.com/p/230418639769c30102vx8d?mod=zwenzhang&sudaref=www.google.com)\n- [防运营商劫持](https://juejin.cn/post/6844903713669283847)\n- [SSLStrip 的未来 —— HTTPS 前端劫持](https://fex.baidu.com/blog/2014/08/ssl-frontend-hijack/)\n- [如何劫持 https 的请求](https://github.com/airuikun/Weekly-FE-Interview/issues/11)\n- [HTTPS 劫持漫谈：代理劫持与透明劫持](https://blog.xray.cool/post/HTTPS-hijacking/)\n- [安全背后: 浏览器是如何校验证书的](https://cjting.me/2021/03/02/how-to-validate-tls-certificate/)\n- [运营商 DNS 劫持的那些事儿](https://blogs.360.cn/post/%E8%BF%90%E8%90%A5%E5%95%86dns%E5%8A%AB%E6%8C%81%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF-%E4%BD%9C%E8%80%85%EF%BC%9Airideas.html)\n","slug":"运营商劫持","published":1,"updated":"2021-05-23T15:21:47.740Z","_id":"ckp148wwq000147v09qejd98n","comments":1,"layout":"post","photos":[],"link":"","content":"<p>什么是运营商劫持?有什么预防措施？</p>\n<span id=\"more\"></span>\n\n<h2 id=\"什么是运营商\"><a href=\"#什么是运营商\" class=\"headerlink\" title=\"什么是运营商\"></a>什么是运营商</h2><p>运营商是指那些提供宽带服务的 ISP，包括三大运营商中国电信、中国移动、中国联通，还有一些小运营商，比如长城宽带等。运营商提供最基础的网络服务，掌握着通往用户武力大门的钥匙，目前运营商劫持很普遍。</p>\n<h2 id=\"劫持方式\"><a href=\"#劫持方式\" class=\"headerlink\" title=\"劫持方式\"></a>劫持方式</h2><p>常见的方式有三种，分别是 DNS 劫持、HTTP 劫持（HTTP 是明文传输）、HTTPS 劫持</p>\n<h2 id=\"DNS-劫持\"><a href=\"#DNS-劫持\" class=\"headerlink\" title=\"DNS 劫持\"></a>DNS 劫持</h2><p>这种劫持会将页面链接重定向到其他网站，所熟知的钓鱼网站就是如此，但是因为它的违法性， 现在被严厉监管起来。DNS 是域名和 IP 地址相互映射的一个分布式数据库，DNS 使用 TCP 和 UDP 端口。DNS 劫持是通过某种技术手段，篡改正确域名和 IP 地址的映射关系，使得域名映射到了错误的 IP 地址，因此可以认为 DNS 劫持是一种 DNS 重定向攻击。</p>\n<h3 id=\"本地-DNS-劫持\"><a href=\"#本地-DNS-劫持\" class=\"headerlink\" title=\"本地 DNS 劫持\"></a>本地 DNS 劫持</h3><p>客户端侧发生的 DNS 劫持统称为本地 DNS 劫持。本地 DNS 劫持可能是：</p>\n<ol>\n<li>黑客通过木马病毒或者恶意程序入侵 PC，篡改 DNS 配置（host 文件，DNS 服务器地址，DNS 缓存等）</li>\n<li>黑客利用路由器漏洞或者攻击路由器管理账号入侵路由器并且篡改 DNS 配置。</li>\n<li>一些企业配置设备（如 Cisco Umbrella intelligent proxy）针对切页内部场景对一些特定的域名做 DNS 劫持解析为指定的结果。</li>\n</ol>\n<h3 id=\"DNS-解析路径劫持\"><a href=\"#DNS-解析路径劫持\" class=\"headerlink\" title=\"DNS 解析路径劫持\"></a>DNS 解析路径劫持</h3><p>DNS 解析过程中发生在哭护短和 DNS 服务器网络通信时的 DNS 劫持统一归类为 DNS 解析路径劫持。通过对 DNS 解析报文在查询阶段的劫持路径进行划分，又可以将 DNS 解析路径劫持划分为以下 3 类</p>\n<ul>\n<li>DNS 请求转发：通过技术手段（中间盒子，软件等）将 DNS 流量重定向到其他 DNS 服务器。</li>\n<li>DNS 请求复制：利用分光设备将 DNS 查询复制到网络设备，并先于正常应答返回 DNS 劫持结果（一个 DNS 查询抓包返回两个不同的应答）</li>\n<li>DNS 请求代答：网络设备或软件直接代替 DNS 服务器对 DNS 查询进行应答</li>\n</ul>\n<h3 id=\"篡改-DNS-权威记录\"><a href=\"#篡改-DNS-权威记录\" class=\"headerlink\" title=\"篡改 DNS 权威记录\"></a>篡改 DNS 权威记录</h3><p>串改 DNS 权威记录是指黑客非法入侵 DNS 权威记录管理账号，直接修改 DNS 记录的行为（黑客黑入域名的管理账户，篡改 DNS 权威记录指向自己的恶意服务器以实现 DNS 劫持。</p>\n<h3 id=\"DNS-劫持应对策略\"><a href=\"#DNS-劫持应对策略\" class=\"headerlink\" title=\"DNS 劫持应对策略\"></a>DNS 劫持应对策略</h3><ul>\n<li>安装杀毒软件，防御木马病毒和恶意软件；定期修改路由器管理账号密码和更新固件</li>\n<li>选择支持 DNSSEC 域名解析服务商，并且给自己的域名实施 DNSSEC。DNSSEC 能够保证递归 DNS 服务器和权威 DNS 服务器之间的通信不被篡改。（阿里云 DNS）</li>\n<li>在客户端和递归 DNS 服务器通信的使用 DNS 加密技术，例如 DNS-over-TLS,DNS-over-HTTPS 等</li>\n</ul>\n<h2 id=\"HTTP-劫持\"><a href=\"#HTTP-劫持\" class=\"headerlink\" title=\"HTTP 劫持\"></a>HTTP 劫持</h2><p>有时页脚会出现一些小广告，有时这些广告不是站点的，而是第三方运营商提供的</p>\n<p>HTTP 劫持的步骤：</p>\n<ul>\n<li>标识 HTTP 连接，在总舵的 TCP 链接中，找到应用层采用了 HTTP 协议的链接，进行标识</li>\n<li>篡改 HTTP 的响应体，可以通过网关来获取数据包进行内容的篡改</li>\n<li>抢先回包，将篡改后的数据包强心正常点返回的数据包先到达用户侧，这样后面正常的数据包在达到之后会被直接丢弃</li>\n</ul>\n<h3 id=\"HTTP-劫持的防范\"><a href=\"#HTTP-劫持的防范\" class=\"headerlink\" title=\"HTTP 劫持的防范\"></a>HTTP 劫持的防范</h3><p>一般都是插入静态脚本或者是 HTML Contenet，或者是将整体替换成 iframe，然后在顶层的 iframe 上进行内容的植入。（script、iframe 注入型劫持）</p>\n<p>HTTP 劫持的防范主要分为</p>\n<ul>\n<li>事前加密<ul>\n<li>https,TLS 握手会有 2 次 RTT 延迟</li>\n<li>加密代理：加密代理是在用户侧和目标 web 服务器之间增加一个代理服务器，在用户和代理之间使用 HTTP 请求，只需确认代理与 web 服务之间不会被 HTTP 劫持就可以避开 HTTP 劫持</li>\n</ul>\n</li>\n<li>事中规避<br>拆分 HTTP 请求数据包</li>\n<li>事后屏蔽<br>通过浏览器 Api，根据若干规则去匹配 DOM 中的节点，对匹配到的节点作拦截和隐藏</li>\n</ul>\n<p>CSP（内容安全策略），DOM 事件监听等。</p>\n<h2 id=\"HTTPS-劫持\"><a href=\"#HTTPS-劫持\" class=\"headerlink\" title=\"HTTPS 劫持\"></a>HTTPS 劫持</h2><p>HTTPS 劫持有两种：</p>\n<ul>\n<li>伪造证书，通过病毒或者其他方式将伪造证书的根证书安装在用户系统中</li>\n<li>代理也有客户的证书与私钥，或者客户端与代理认证的时候不校验合法性，即可通过代理来与我们服务端进行数据交互（较多）</li>\n</ul>\n<h3 id=\"MITM\"><a href=\"#MITM\" class=\"headerlink\" title=\"MITM\"></a>MITM</h3><p>中间人攻击(man-in-the-middle attack, abbreviated to MITM),简单的讲，就是黑客悄悄的躲在通信双方之间，窃听甚至篡改通信信息。而通信双方并不知道消息已经被截获甚至篡改了。</p>\n<p>也有一些人通过代理服务器浏览外网，这里的代理服务器其实就是充当中间人的角色，所以要当心使用免费 vpn。</p>\n<p>在通信过程中，客户端或者操作系统内置了权威 CA 的根证书，而服务器在通信之初，会先返回在 CA 那里获取的签名证书，然后客户端用根证书验证证书有效性，最后使用验证通过的证书提供公钥加密数据</p>\n<p>早年 12306 使用了自己签名的证书，但是主流浏览器不认可，导致用户需要在首次下载证书并安装，不发纷争完全可以利用这个机制把非法、书安装到用户设备上，但如今 12306 已经采用 digiCert 颁布的证书了</p>\n<p>除了 CA 数字证书，还有一些专用的秘钥交互协议，比如 ZRTP、HPKP、DNSSEC 等，他们都能在一定程度上保证通信安全</p>\n<h2 id=\"参考与扩展\"><a href=\"#参考与扩展\" class=\"headerlink\" title=\"参考与扩展\"></a>参考与扩展</h2><ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/86538629\">聊一聊 DNS 劫持那些事</a></li>\n<li><a href=\"https://developer.aliyun.com/article/711961\">DNS 攻击防范科普系列一</a></li>\n<li><a href=\"https://www.aliyun.com/?spm=a2c6h.12873639.J_8058803260.1.17a82993X6QmeG\">DNS 服务器怎么防 DDoS 攻击</a></li>\n<li><a href=\"https://developer.aliyun.com/article/716777\">如何保障 DNS 操作安全</a></li>\n<li><a href=\"https://developer.aliyun.com/article/718497\">遭遇 DNS 缓存投毒该怎么办</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/31344484\">HTTP 劫持</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000020405407\">中间人攻击，HTTPS 也可以被碾压</a></li>\n<li><a href=\"https://weibo.com/p/230418639769c30102vx8d?mod=zwenzhang&sudaref=www.google.com\">12306 的证书问题</a></li>\n<li><a href=\"https://juejin.cn/post/6844903713669283847\">防运营商劫持</a></li>\n<li><a href=\"https://fex.baidu.com/blog/2014/08/ssl-frontend-hijack/\">SSLStrip 的未来 —— HTTPS 前端劫持</a></li>\n<li><a href=\"https://github.com/airuikun/Weekly-FE-Interview/issues/11\">如何劫持 https 的请求</a></li>\n<li><a href=\"https://blog.xray.cool/post/HTTPS-hijacking/\">HTTPS 劫持漫谈：代理劫持与透明劫持</a></li>\n<li><a href=\"https://cjting.me/2021/03/02/how-to-validate-tls-certificate/\">安全背后: 浏览器是如何校验证书的</a></li>\n<li><a href=\"https://blogs.360.cn/post/%E8%BF%90%E8%90%A5%E5%95%86dns%E5%8A%AB%E6%8C%81%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF-%E4%BD%9C%E8%80%85%EF%BC%9Airideas.html\">运营商 DNS 劫持的那些事儿</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>什么是运营商劫持?有什么预防措施？</p>","more":"<h2 id=\"什么是运营商\"><a href=\"#什么是运营商\" class=\"headerlink\" title=\"什么是运营商\"></a>什么是运营商</h2><p>运营商是指那些提供宽带服务的 ISP，包括三大运营商中国电信、中国移动、中国联通，还有一些小运营商，比如长城宽带等。运营商提供最基础的网络服务，掌握着通往用户武力大门的钥匙，目前运营商劫持很普遍。</p>\n<h2 id=\"劫持方式\"><a href=\"#劫持方式\" class=\"headerlink\" title=\"劫持方式\"></a>劫持方式</h2><p>常见的方式有三种，分别是 DNS 劫持、HTTP 劫持（HTTP 是明文传输）、HTTPS 劫持</p>\n<h2 id=\"DNS-劫持\"><a href=\"#DNS-劫持\" class=\"headerlink\" title=\"DNS 劫持\"></a>DNS 劫持</h2><p>这种劫持会将页面链接重定向到其他网站，所熟知的钓鱼网站就是如此，但是因为它的违法性， 现在被严厉监管起来。DNS 是域名和 IP 地址相互映射的一个分布式数据库，DNS 使用 TCP 和 UDP 端口。DNS 劫持是通过某种技术手段，篡改正确域名和 IP 地址的映射关系，使得域名映射到了错误的 IP 地址，因此可以认为 DNS 劫持是一种 DNS 重定向攻击。</p>\n<h3 id=\"本地-DNS-劫持\"><a href=\"#本地-DNS-劫持\" class=\"headerlink\" title=\"本地 DNS 劫持\"></a>本地 DNS 劫持</h3><p>客户端侧发生的 DNS 劫持统称为本地 DNS 劫持。本地 DNS 劫持可能是：</p>\n<ol>\n<li>黑客通过木马病毒或者恶意程序入侵 PC，篡改 DNS 配置（host 文件，DNS 服务器地址，DNS 缓存等）</li>\n<li>黑客利用路由器漏洞或者攻击路由器管理账号入侵路由器并且篡改 DNS 配置。</li>\n<li>一些企业配置设备（如 Cisco Umbrella intelligent proxy）针对切页内部场景对一些特定的域名做 DNS 劫持解析为指定的结果。</li>\n</ol>\n<h3 id=\"DNS-解析路径劫持\"><a href=\"#DNS-解析路径劫持\" class=\"headerlink\" title=\"DNS 解析路径劫持\"></a>DNS 解析路径劫持</h3><p>DNS 解析过程中发生在哭护短和 DNS 服务器网络通信时的 DNS 劫持统一归类为 DNS 解析路径劫持。通过对 DNS 解析报文在查询阶段的劫持路径进行划分，又可以将 DNS 解析路径劫持划分为以下 3 类</p>\n<ul>\n<li>DNS 请求转发：通过技术手段（中间盒子，软件等）将 DNS 流量重定向到其他 DNS 服务器。</li>\n<li>DNS 请求复制：利用分光设备将 DNS 查询复制到网络设备，并先于正常应答返回 DNS 劫持结果（一个 DNS 查询抓包返回两个不同的应答）</li>\n<li>DNS 请求代答：网络设备或软件直接代替 DNS 服务器对 DNS 查询进行应答</li>\n</ul>\n<h3 id=\"篡改-DNS-权威记录\"><a href=\"#篡改-DNS-权威记录\" class=\"headerlink\" title=\"篡改 DNS 权威记录\"></a>篡改 DNS 权威记录</h3><p>串改 DNS 权威记录是指黑客非法入侵 DNS 权威记录管理账号，直接修改 DNS 记录的行为（黑客黑入域名的管理账户，篡改 DNS 权威记录指向自己的恶意服务器以实现 DNS 劫持。</p>\n<h3 id=\"DNS-劫持应对策略\"><a href=\"#DNS-劫持应对策略\" class=\"headerlink\" title=\"DNS 劫持应对策略\"></a>DNS 劫持应对策略</h3><ul>\n<li>安装杀毒软件，防御木马病毒和恶意软件；定期修改路由器管理账号密码和更新固件</li>\n<li>选择支持 DNSSEC 域名解析服务商，并且给自己的域名实施 DNSSEC。DNSSEC 能够保证递归 DNS 服务器和权威 DNS 服务器之间的通信不被篡改。（阿里云 DNS）</li>\n<li>在客户端和递归 DNS 服务器通信的使用 DNS 加密技术，例如 DNS-over-TLS,DNS-over-HTTPS 等</li>\n</ul>\n<h2 id=\"HTTP-劫持\"><a href=\"#HTTP-劫持\" class=\"headerlink\" title=\"HTTP 劫持\"></a>HTTP 劫持</h2><p>有时页脚会出现一些小广告，有时这些广告不是站点的，而是第三方运营商提供的</p>\n<p>HTTP 劫持的步骤：</p>\n<ul>\n<li>标识 HTTP 连接，在总舵的 TCP 链接中，找到应用层采用了 HTTP 协议的链接，进行标识</li>\n<li>篡改 HTTP 的响应体，可以通过网关来获取数据包进行内容的篡改</li>\n<li>抢先回包，将篡改后的数据包强心正常点返回的数据包先到达用户侧，这样后面正常的数据包在达到之后会被直接丢弃</li>\n</ul>\n<h3 id=\"HTTP-劫持的防范\"><a href=\"#HTTP-劫持的防范\" class=\"headerlink\" title=\"HTTP 劫持的防范\"></a>HTTP 劫持的防范</h3><p>一般都是插入静态脚本或者是 HTML Contenet，或者是将整体替换成 iframe，然后在顶层的 iframe 上进行内容的植入。（script、iframe 注入型劫持）</p>\n<p>HTTP 劫持的防范主要分为</p>\n<ul>\n<li>事前加密<ul>\n<li>https,TLS 握手会有 2 次 RTT 延迟</li>\n<li>加密代理：加密代理是在用户侧和目标 web 服务器之间增加一个代理服务器，在用户和代理之间使用 HTTP 请求，只需确认代理与 web 服务之间不会被 HTTP 劫持就可以避开 HTTP 劫持</li>\n</ul>\n</li>\n<li>事中规避<br>拆分 HTTP 请求数据包</li>\n<li>事后屏蔽<br>通过浏览器 Api，根据若干规则去匹配 DOM 中的节点，对匹配到的节点作拦截和隐藏</li>\n</ul>\n<p>CSP（内容安全策略），DOM 事件监听等。</p>\n<h2 id=\"HTTPS-劫持\"><a href=\"#HTTPS-劫持\" class=\"headerlink\" title=\"HTTPS 劫持\"></a>HTTPS 劫持</h2><p>HTTPS 劫持有两种：</p>\n<ul>\n<li>伪造证书，通过病毒或者其他方式将伪造证书的根证书安装在用户系统中</li>\n<li>代理也有客户的证书与私钥，或者客户端与代理认证的时候不校验合法性，即可通过代理来与我们服务端进行数据交互（较多）</li>\n</ul>\n<h3 id=\"MITM\"><a href=\"#MITM\" class=\"headerlink\" title=\"MITM\"></a>MITM</h3><p>中间人攻击(man-in-the-middle attack, abbreviated to MITM),简单的讲，就是黑客悄悄的躲在通信双方之间，窃听甚至篡改通信信息。而通信双方并不知道消息已经被截获甚至篡改了。</p>\n<p>也有一些人通过代理服务器浏览外网，这里的代理服务器其实就是充当中间人的角色，所以要当心使用免费 vpn。</p>\n<p>在通信过程中，客户端或者操作系统内置了权威 CA 的根证书，而服务器在通信之初，会先返回在 CA 那里获取的签名证书，然后客户端用根证书验证证书有效性，最后使用验证通过的证书提供公钥加密数据</p>\n<p>早年 12306 使用了自己签名的证书，但是主流浏览器不认可，导致用户需要在首次下载证书并安装，不发纷争完全可以利用这个机制把非法、书安装到用户设备上，但如今 12306 已经采用 digiCert 颁布的证书了</p>\n<p>除了 CA 数字证书，还有一些专用的秘钥交互协议，比如 ZRTP、HPKP、DNSSEC 等，他们都能在一定程度上保证通信安全</p>\n<h2 id=\"参考与扩展\"><a href=\"#参考与扩展\" class=\"headerlink\" title=\"参考与扩展\"></a>参考与扩展</h2><ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/86538629\">聊一聊 DNS 劫持那些事</a></li>\n<li><a href=\"https://developer.aliyun.com/article/711961\">DNS 攻击防范科普系列一</a></li>\n<li><a href=\"https://www.aliyun.com/?spm=a2c6h.12873639.J_8058803260.1.17a82993X6QmeG\">DNS 服务器怎么防 DDoS 攻击</a></li>\n<li><a href=\"https://developer.aliyun.com/article/716777\">如何保障 DNS 操作安全</a></li>\n<li><a href=\"https://developer.aliyun.com/article/718497\">遭遇 DNS 缓存投毒该怎么办</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/31344484\">HTTP 劫持</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000020405407\">中间人攻击，HTTPS 也可以被碾压</a></li>\n<li><a href=\"https://weibo.com/p/230418639769c30102vx8d?mod=zwenzhang&sudaref=www.google.com\">12306 的证书问题</a></li>\n<li><a href=\"https://juejin.cn/post/6844903713669283847\">防运营商劫持</a></li>\n<li><a href=\"https://fex.baidu.com/blog/2014/08/ssl-frontend-hijack/\">SSLStrip 的未来 —— HTTPS 前端劫持</a></li>\n<li><a href=\"https://github.com/airuikun/Weekly-FE-Interview/issues/11\">如何劫持 https 的请求</a></li>\n<li><a href=\"https://blog.xray.cool/post/HTTPS-hijacking/\">HTTPS 劫持漫谈：代理劫持与透明劫持</a></li>\n<li><a href=\"https://cjting.me/2021/03/02/how-to-validate-tls-certificate/\">安全背后: 浏览器是如何校验证书的</a></li>\n<li><a href=\"https://blogs.360.cn/post/%E8%BF%90%E8%90%A5%E5%95%86dns%E5%8A%AB%E6%8C%81%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF-%E4%BD%9C%E8%80%85%EF%BC%9Airideas.html\">运营商 DNS 劫持的那些事儿</a></li>\n</ul>"},{"title":"常用JS工具方法","date":"2021-05-26T08:03:02.000Z","_content":"\n搬运平时常用的工具函数\n\n<!--more-->\n\n## isStatic：检测数据是不是除了 symbol 外的原始数据\n\n```javascript\nfunction isStatic(value) {\n  return (\n    typeof value === 'string' ||\n    typeof value === 'number' ||\n    typeof value === 'boolean' ||\n    typeof value === 'undefined' ||\n    value === null\n  )\n}\n```\n\n## isPrimitive：检测数据是不是原始数据\n\n```javascript\nfunction isPrimitive(value) {\n  return isStatic(value) || typeof value === 'symbol'\n}\n```\n\n## isObject：判断数据是不是引用类型的数据\n\n例如： arrays, functions, objects, regexes, new Number(0),以及 new String('')\n\n```javascript\nfunction isObject(value) {\n  let type = typeof value\n  return value != null && (type == 'object' || type == 'function')\n}\n```\n\n## isObjectLike：检查 value 是否是 类对象。\n\n如果一个值是类对象，那么它不应该是 null，而且 typeof 后的结果是 \"object\"\n\n```javascript\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object'\n}\n```\n\n## getRawType：获取数据类型，返回结果为 Number、String、Object、Array 等\n\n```javascript\nfunction getRawType(value) {\n  return Object.prototype.toString.call(value).slice(8, -1)\n}\n```\n\n## isPlainObject：判断数据是不是 Object 类型的数据\n\n```javascript\nfunction isPlainObject(obj) {\n  return Object.prototype.toString.call(obj) === '[object Object]'\n}\n```\n\n## isArray：判断数据是不是数组类型的数据\n\n```javascript\nfunction isArray(arr) {\n  return Array.isArray(arr)\n}\n```\n\n## isArrayLike：检查 value 是否是类数组\n\n如果一个值被认为是类数组，那么它不是一个函数，并且 value.length 是个整数，大于等于 0，小于或等于 Number.MAX_SAFE_INTEGER。这里字符串也将被当作类数组。\n\n```javascript\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value)\n}\n```\n\n## isEmpty：检查 value 是否为空\n\n如果是 null，直接返回 true；如果是类数组，判断数据长度；如果是 Object 对象，判断是否具有属性；如果是其他数据，直接返回 false(也可改为返回 true)\n\n```javascript\nfunction isEmpty(value) {\n    if (value == null) {\n        return true;\n    }\n    if (isArrayLike(value)) {\n        return !value.length;\n    }else if(isPlainObject(value)){\n          for (let key in value) {\n            if (hasOwnProperty.call(value, key)) {\n              return false;\n            }\n        }\n    }\n    return false;\n\n```\n\n## cached：记忆函数：缓存函数的运算结果\n\n```js\nfunction cached(fn) {\n  let cache = Object.create(null)\n  return function cachedFn(str) {\n    let hit = cache[str]\n    return hit || (cache[str] = fn(str))\n  }\n}\n```\n\n## camelize：横线转驼峰命名\n\n```js\nlet camelizeRE = /-(\\w)/g\nfunction camelize(str) {\n  return str.replace(camelizeRE, function (_, c) {\n    return c ? c.toUpperCase() : ''\n  })\n}\n//ab-cd-ef ==> abCdEf\n//使用记忆函数\nlet _camelize = cached(camelize)\n```\n\n## hyphenate：驼峰命名转横线命名：拆分字符串，使用 - 相连，并且转换为小写\n\n```js\nlet hyphenateRE = /\\B([A-Z])/g\nfunction hyphenate(str) {\n  return str.replace(hyphenateRE, '-$1').toLowerCase()\n}\n//abCd ==> ab-cd\n//使用记忆函数\nlet _hyphenate = cached(hyphenate)\n```\n\n## capitalize：字符串首位大写\n\n```js\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n// abc ==> Abc\n//使用记忆函数\nlet _capitalize = cached(capitalize)\n```\n\n## extend：将属性混合到目标对象中\n\n```js\nfunction extend(to, _from) {\n  for (let key in _from) {\n    to[key] = _from[key]\n  }\n  return to\n}\n```\n\n## 识别各种浏览器及平台\n\n```javascript\n//运行环境是浏览器\nlet inBrowser = typeof window !== 'undefined'\n//运行环境是微信\nlet inWeex = typeof WXEnvironment !== 'undefined' && !!WXEnvironment.platform\nlet weexPlatform = inWeex && WXEnvironment.platform.toLowerCase()\n//浏览器 UA 判断\nlet UA = inBrowser && window.navigator.userAgent.toLowerCase()\nlet isIE = UA && /msie|trident/.test(UA)\nlet isIE9 = UA && UA.indexOf('msie 9.0') > 0\nlet isEdge = UA && UA.indexOf('edge/') > 0\nlet isAndroid = (UA && UA.indexOf('android') > 0) || weexPlatform === 'android'\nlet isIOS = (UA && /iphone|ipad|ipod|ios/.test(UA)) || weexPlatform === 'ios'\nlet isChrome = UA && /chrome\\/\\d+/.test(UA) && !isEdge\n```\n\n## getExplorerInfo：获取浏览器信息\n\n```js\nfunction getExplorerInfo() {\n  let t = navigator.userAgent.toLowerCase()\n  return 0 <= t.indexOf('msie')\n    ? {\n        //ie < 11\n        type: 'IE',\n        version: Number(t.match(/msie ([\\d]+)/)[1])\n      }\n    : !!t.match(/trident\\/.+?rv:(([\\d.]+))/)\n    ? {\n        // ie 11\n        type: 'IE',\n        version: 11\n      }\n    : 0 <= t.indexOf('edge')\n    ? {\n        type: 'Edge',\n        version: Number(t.match(/edge\\/([\\d]+)/)[1])\n      }\n    : 0 <= t.indexOf('firefox')\n    ? {\n        type: 'Firefox',\n        version: Number(t.match(/firefox\\/([\\d]+)/)[1])\n      }\n    : 0 <= t.indexOf('chrome')\n    ? {\n        type: 'Chrome',\n        version: Number(t.match(/chrome\\/([\\d]+)/)[1])\n      }\n    : 0 <= t.indexOf('opera')\n    ? {\n        type: 'Opera',\n        version: Number(t.match(/opera.([\\d]+)/)[1])\n      }\n    : 0 <= t.indexOf('Safari')\n    ? {\n        type: 'Safari',\n        version: Number(t.match(/version\\/([\\d]+)/)[1])\n      }\n    : {\n        type: t,\n        version: -1\n      }\n}\n```\n\n## isPCBroswer：检测是否为 PC 端浏览器模式\n\n```js\nfunction isPCBroswer() {\n  let e = navigator.userAgent.toLowerCase(),\n    t = 'ipad' == e.match(/ipad/i),\n    i = 'iphone' == e.match(/iphone/i),\n    r = 'midp' == e.match(/midp/i),\n    n = 'rv:1.2.3.4' == e.match(/rv:1.2.3.4/i),\n    a = 'ucweb' == e.match(/ucweb/i),\n    o = 'android' == e.match(/android/i),\n    s = 'windows ce' == e.match(/windows ce/i),\n    l = 'windows mobile' == e.match(/windows mobile/i)\n  return !(t || i || r || n || a || o || s || l)\n}\n```\n\n## dateFormater：格式化时间\n\n```js\nfunction dateFormater(formater, t) {\n  let date = t ? new Date(t) : new Date(),\n    Y = date.getFullYear() + '',\n    M = date.getMonth() + 1,\n    D = date.getDate(),\n    H = date.getHours(),\n    m = date.getMinutes(),\n    s = date.getSeconds()\n  return formater\n    .replace(/YYYY|yyyy/g, Y)\n    .replace(/YY|yy/g, Y.substr(2, 2))\n    .replace(/MM/g, (M < 10 ? '0' : '') + M)\n    .replace(/DD/g, (D < 10 ? '0' : '') + D)\n    .replace(/HH|hh/g, (H < 10 ? '0' : '') + H)\n    .replace(/mm/g, (m < 10 ? '0' : '') + m)\n    .replace(/ss/g, (s < 10 ? '0' : '') + s)\n}\n// dateFormater('YYYY-MM-DD HH:mm', t) ==> 2019-06-26 18:30\n// dateFormater('YYYYMMDDHHmm', t) ==> 201906261830\n```\n\n## dateStrForma：将指定字符串由一种时间格式转化为另一种\n\nfrom 的格式应对应 str 的位置\n\n```js\nfunction dateStrForma(str, from, to) {\n  //'20190626' 'YYYYMMDD' 'YYYY年MM月DD日'\n  str += ''\n  let Y = ''\n  if (~(Y = from.indexOf('YYYY'))) {\n    Y = str.substr(Y, 4)\n    to = to.replace(/YYYY|yyyy/g, Y)\n  } else if (~(Y = from.indexOf('YY'))) {\n    Y = str.substr(Y, 2)\n    to = to.replace(/YY|yy/g, Y)\n  }\n\n  let k, i\n  ;['M', 'D', 'H', 'h', 'm', 's'].forEach((s) => {\n    i = from.indexOf(s + s)\n    k = ~i ? str.substr(i, 2) : ''\n    to = to.replace(s + s, k)\n  })\n  return to\n}\n// dateStrForma('20190626', 'YYYYMMDD', 'YYYY年MM月DD日') ==> 2019年06月26日\n// dateStrForma('121220190626', '----YYYYMMDD', 'YYYY年MM月DD日') ==> 2019年06月26日\n// dateStrForma('2019年06月26日', 'YYYY年MM月DD日', 'YYYYMMDD') ==> 20190626\n\n// 一般的也可以使用正则来实现\n//'2019年06月26日'.replace(/(\\d{4})年(\\d{2})月(\\d{2})日/, '$1-$2-$3') ==> 2019-06-26\n```\n\n## GetUrlParam：获取 Url 参数，返回一个对象\n\n```js\nfunction GetUrlParam() {\n  let url = document.location.toString()\n  let arrObj = url.split('?')\n  let params = Object.create(null)\n  if (arrObj.length > 1) {\n    arrObj = arrObj[1].split('&')\n    arrObj.forEach((item) => {\n      item = item.split('=')\n      params[item[0]] = item[1]\n    })\n  }\n  return params\n}\n// ?a=1&b=2&c=3 ==> {a: \"1\", b: \"2\", c: \"3\"}\n```\n\n## downloadFile：base64 数据导出文件，文件下载\n\n```js\nfunction downloadFile(filename, data) {\n  let DownloadLink = document.createElement('a')\n\n  if (DownloadLink) {\n    document.body.appendChild(DownloadLink)\n    DownloadLink.style = 'display: none'\n    DownloadLink.download = filename\n    DownloadLink.href = data\n\n    if (document.createEvent) {\n      let DownloadEvt = document.createEvent('MouseEvents')\n\n      DownloadEvt.initEvent('click', true, false)\n      DownloadLink.dispatchEvent(DownloadEvt)\n    } else if (document.createEventObject) DownloadLink.fireEvent('onclick')\n    else if (typeof DownloadLink.onclick == 'function') DownloadLink.onclick()\n\n    document.body.removeChild(DownloadLink)\n  }\n}\n```\n\n## toFullScreen：全屏\n\n```js\nfunction toFullScreen() {\n  let elem = document.body\n  elem.webkitRequestFullScreen\n    ? elem.webkitRequestFullScreen()\n    : elem.mozRequestFullScreen\n    ? elem.mozRequestFullScreen()\n    : elem.msRequestFullscreen\n    ? elem.msRequestFullscreen()\n    : elem.requestFullScreen\n    ? elem.requestFullScreen()\n    : alert('浏览器不支持全屏')\n}\n```\n\n## exitFullscreen：退出全屏\n\n```js\nfunction exitFullscreen() {\n  let elem = parent.document\n  elem.webkitCancelFullScreen\n    ? elem.webkitCancelFullScreen()\n    : elem.mozCancelFullScreen\n    ? elem.mozCancelFullScreen()\n    : elem.cancelFullScreen\n    ? elem.cancelFullScreen()\n    : elem.msExitFullscreen\n    ? elem.msExitFullscreen()\n    : elem.exitFullscreen\n    ? elem.exitFullscreen()\n    : alert('切换失败,可尝试Esc退出')\n}\n```\n\n## requestAnimationFrame：window 动画\n\n```js\nwindow.requestAnimationFrame =\n  window.requestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.msRequestAnimationFrame ||\n  window.oRequestAnimationFrame ||\n  function (callback) {\n    //为了使setTimteout的尽可能的接近每秒60帧的效果\n    window.setTimeout(callback, 1000 / 60)\n  }\n\nwindow.cancelAnimationFrame =\n  window.cancelAnimationFrame ||\n  Window.webkitCancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.msCancelAnimationFrame ||\n  window.oCancelAnimationFrame ||\n  function (id) {\n    //为了使setTimteout的尽可能的接近每秒60帧的效果\n    window.clearTimeout(id)\n  }\n```\n\n## max：求取数组中非 NaN 数据中的最大值\n\n```js\nfunction max(arr) {\n  arr = arr.filter((item) => !_isNaN(item))\n  return arr.length ? Math.max.apply(null, arr) : undefined\n}\n//max([1, 2, '11', null, 'fdf', []]) ==> 11\n```\n\n## min：求取数组中非 NaN 数据中的最小值\n\n```js\nfunction min(arr) {\n  arr = arr.filter((item) => !_isNaN(item))\n  return arr.length ? Math.min.apply(null, arr) : undefined\n}\n//min([1, 2, '11', null, 'fdf', []]) ==> 1\n```\n\n## random：返回一个 lower - upper 之间的随机数\n\n```js\nfunction random(lower, upper) {\n  lower = +lower || 0\n  upper = +upper || 0\n  return Math.random() * (upper - lower) + lower\n}\n//random(0, 0.5) ==> 0.3567039135734613\n//random(2, 1) ===> 1.6718418553475423\n//random(-2, -1) ==> -1.4474325452361945\n```\n\n## performance.timing：利用 performance.timing 进行性能分析\n\n```js\nwindow.onload = function () {\n  setTimeout(function () {\n    let t = performance.timing\n    console.log(\n      'DNS查询耗时 ：' + (t.domainLookupEnd - t.domainLookupStart).toFixed(0)\n    )\n    console.log('TCP链接耗时 ：' + (t.connectEnd - t.connectStart).toFixed(0))\n    console.log(\n      'request请求耗时 ：' + (t.responseEnd - t.responseStart).toFixed(0)\n    )\n    console.log(\n      '解析dom树耗时 ：' + (t.domComplete - t.domInteractive).toFixed(0)\n    )\n    console.log(\n      '白屏时间 ：' + (t.responseStart - t.navigationStart).toFixed(0)\n    )\n    console.log(\n      'domready时间 ：' +\n        (t.domContentLoadedEventEnd - t.navigationStart).toFixed(0)\n    )\n    console.log(\n      'onload时间 ：' + (t.loadEventEnd - t.navigationStart).toFixed(0)\n    )\n\n    if ((t = performance.memory)) {\n      console.log(\n        'js内存使用占比 ：' +\n          ((t.usedJSHeapSize / t.totalJSHeapSize) * 100).toFixed(2) +\n          '%'\n      )\n    }\n  })\n}\n```\n\n## 禁止某些键盘事件\n\n```js\ndocument.addEventListener('keydown', function (event) {\n  return (\n    !(\n      (\n        112 == event.keyCode || //F1\n        123 == event.keyCode || //F12\n        (event.ctrlKey && 82 == event.keyCode) || //ctrl + R\n        (event.ctrlKey && 78 == event.keyCode) || //ctrl + N\n        (event.shiftKey && 121 == event.keyCode) || //shift + F10\n        (event.altKey && 115 == event.keyCode) || //alt + F4\n        ('A' == event.srcElement.tagName && event.shiftKey)\n      ) //shift + 点击a标签\n    ) || (event.returnValue = false)\n  )\n})\n```\n\n## 禁止右键、选择、复制\n\n```js\n;['contextmenu', 'selectstart', 'copy'].forEach(function (ev) {\n  document.addEventListener(ev, function (event) {\n    return (event.returnValue = false)\n  })\n})\n```\n","source":"_posts/常用JS工具方法.md","raw":"---\ntitle: 常用JS工具方法\ndate: 2021-05-26 16:03:02\ncategories: JavaScript\n---\n\n搬运平时常用的工具函数\n\n<!--more-->\n\n## isStatic：检测数据是不是除了 symbol 外的原始数据\n\n```javascript\nfunction isStatic(value) {\n  return (\n    typeof value === 'string' ||\n    typeof value === 'number' ||\n    typeof value === 'boolean' ||\n    typeof value === 'undefined' ||\n    value === null\n  )\n}\n```\n\n## isPrimitive：检测数据是不是原始数据\n\n```javascript\nfunction isPrimitive(value) {\n  return isStatic(value) || typeof value === 'symbol'\n}\n```\n\n## isObject：判断数据是不是引用类型的数据\n\n例如： arrays, functions, objects, regexes, new Number(0),以及 new String('')\n\n```javascript\nfunction isObject(value) {\n  let type = typeof value\n  return value != null && (type == 'object' || type == 'function')\n}\n```\n\n## isObjectLike：检查 value 是否是 类对象。\n\n如果一个值是类对象，那么它不应该是 null，而且 typeof 后的结果是 \"object\"\n\n```javascript\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object'\n}\n```\n\n## getRawType：获取数据类型，返回结果为 Number、String、Object、Array 等\n\n```javascript\nfunction getRawType(value) {\n  return Object.prototype.toString.call(value).slice(8, -1)\n}\n```\n\n## isPlainObject：判断数据是不是 Object 类型的数据\n\n```javascript\nfunction isPlainObject(obj) {\n  return Object.prototype.toString.call(obj) === '[object Object]'\n}\n```\n\n## isArray：判断数据是不是数组类型的数据\n\n```javascript\nfunction isArray(arr) {\n  return Array.isArray(arr)\n}\n```\n\n## isArrayLike：检查 value 是否是类数组\n\n如果一个值被认为是类数组，那么它不是一个函数，并且 value.length 是个整数，大于等于 0，小于或等于 Number.MAX_SAFE_INTEGER。这里字符串也将被当作类数组。\n\n```javascript\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value)\n}\n```\n\n## isEmpty：检查 value 是否为空\n\n如果是 null，直接返回 true；如果是类数组，判断数据长度；如果是 Object 对象，判断是否具有属性；如果是其他数据，直接返回 false(也可改为返回 true)\n\n```javascript\nfunction isEmpty(value) {\n    if (value == null) {\n        return true;\n    }\n    if (isArrayLike(value)) {\n        return !value.length;\n    }else if(isPlainObject(value)){\n          for (let key in value) {\n            if (hasOwnProperty.call(value, key)) {\n              return false;\n            }\n        }\n    }\n    return false;\n\n```\n\n## cached：记忆函数：缓存函数的运算结果\n\n```js\nfunction cached(fn) {\n  let cache = Object.create(null)\n  return function cachedFn(str) {\n    let hit = cache[str]\n    return hit || (cache[str] = fn(str))\n  }\n}\n```\n\n## camelize：横线转驼峰命名\n\n```js\nlet camelizeRE = /-(\\w)/g\nfunction camelize(str) {\n  return str.replace(camelizeRE, function (_, c) {\n    return c ? c.toUpperCase() : ''\n  })\n}\n//ab-cd-ef ==> abCdEf\n//使用记忆函数\nlet _camelize = cached(camelize)\n```\n\n## hyphenate：驼峰命名转横线命名：拆分字符串，使用 - 相连，并且转换为小写\n\n```js\nlet hyphenateRE = /\\B([A-Z])/g\nfunction hyphenate(str) {\n  return str.replace(hyphenateRE, '-$1').toLowerCase()\n}\n//abCd ==> ab-cd\n//使用记忆函数\nlet _hyphenate = cached(hyphenate)\n```\n\n## capitalize：字符串首位大写\n\n```js\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n// abc ==> Abc\n//使用记忆函数\nlet _capitalize = cached(capitalize)\n```\n\n## extend：将属性混合到目标对象中\n\n```js\nfunction extend(to, _from) {\n  for (let key in _from) {\n    to[key] = _from[key]\n  }\n  return to\n}\n```\n\n## 识别各种浏览器及平台\n\n```javascript\n//运行环境是浏览器\nlet inBrowser = typeof window !== 'undefined'\n//运行环境是微信\nlet inWeex = typeof WXEnvironment !== 'undefined' && !!WXEnvironment.platform\nlet weexPlatform = inWeex && WXEnvironment.platform.toLowerCase()\n//浏览器 UA 判断\nlet UA = inBrowser && window.navigator.userAgent.toLowerCase()\nlet isIE = UA && /msie|trident/.test(UA)\nlet isIE9 = UA && UA.indexOf('msie 9.0') > 0\nlet isEdge = UA && UA.indexOf('edge/') > 0\nlet isAndroid = (UA && UA.indexOf('android') > 0) || weexPlatform === 'android'\nlet isIOS = (UA && /iphone|ipad|ipod|ios/.test(UA)) || weexPlatform === 'ios'\nlet isChrome = UA && /chrome\\/\\d+/.test(UA) && !isEdge\n```\n\n## getExplorerInfo：获取浏览器信息\n\n```js\nfunction getExplorerInfo() {\n  let t = navigator.userAgent.toLowerCase()\n  return 0 <= t.indexOf('msie')\n    ? {\n        //ie < 11\n        type: 'IE',\n        version: Number(t.match(/msie ([\\d]+)/)[1])\n      }\n    : !!t.match(/trident\\/.+?rv:(([\\d.]+))/)\n    ? {\n        // ie 11\n        type: 'IE',\n        version: 11\n      }\n    : 0 <= t.indexOf('edge')\n    ? {\n        type: 'Edge',\n        version: Number(t.match(/edge\\/([\\d]+)/)[1])\n      }\n    : 0 <= t.indexOf('firefox')\n    ? {\n        type: 'Firefox',\n        version: Number(t.match(/firefox\\/([\\d]+)/)[1])\n      }\n    : 0 <= t.indexOf('chrome')\n    ? {\n        type: 'Chrome',\n        version: Number(t.match(/chrome\\/([\\d]+)/)[1])\n      }\n    : 0 <= t.indexOf('opera')\n    ? {\n        type: 'Opera',\n        version: Number(t.match(/opera.([\\d]+)/)[1])\n      }\n    : 0 <= t.indexOf('Safari')\n    ? {\n        type: 'Safari',\n        version: Number(t.match(/version\\/([\\d]+)/)[1])\n      }\n    : {\n        type: t,\n        version: -1\n      }\n}\n```\n\n## isPCBroswer：检测是否为 PC 端浏览器模式\n\n```js\nfunction isPCBroswer() {\n  let e = navigator.userAgent.toLowerCase(),\n    t = 'ipad' == e.match(/ipad/i),\n    i = 'iphone' == e.match(/iphone/i),\n    r = 'midp' == e.match(/midp/i),\n    n = 'rv:1.2.3.4' == e.match(/rv:1.2.3.4/i),\n    a = 'ucweb' == e.match(/ucweb/i),\n    o = 'android' == e.match(/android/i),\n    s = 'windows ce' == e.match(/windows ce/i),\n    l = 'windows mobile' == e.match(/windows mobile/i)\n  return !(t || i || r || n || a || o || s || l)\n}\n```\n\n## dateFormater：格式化时间\n\n```js\nfunction dateFormater(formater, t) {\n  let date = t ? new Date(t) : new Date(),\n    Y = date.getFullYear() + '',\n    M = date.getMonth() + 1,\n    D = date.getDate(),\n    H = date.getHours(),\n    m = date.getMinutes(),\n    s = date.getSeconds()\n  return formater\n    .replace(/YYYY|yyyy/g, Y)\n    .replace(/YY|yy/g, Y.substr(2, 2))\n    .replace(/MM/g, (M < 10 ? '0' : '') + M)\n    .replace(/DD/g, (D < 10 ? '0' : '') + D)\n    .replace(/HH|hh/g, (H < 10 ? '0' : '') + H)\n    .replace(/mm/g, (m < 10 ? '0' : '') + m)\n    .replace(/ss/g, (s < 10 ? '0' : '') + s)\n}\n// dateFormater('YYYY-MM-DD HH:mm', t) ==> 2019-06-26 18:30\n// dateFormater('YYYYMMDDHHmm', t) ==> 201906261830\n```\n\n## dateStrForma：将指定字符串由一种时间格式转化为另一种\n\nfrom 的格式应对应 str 的位置\n\n```js\nfunction dateStrForma(str, from, to) {\n  //'20190626' 'YYYYMMDD' 'YYYY年MM月DD日'\n  str += ''\n  let Y = ''\n  if (~(Y = from.indexOf('YYYY'))) {\n    Y = str.substr(Y, 4)\n    to = to.replace(/YYYY|yyyy/g, Y)\n  } else if (~(Y = from.indexOf('YY'))) {\n    Y = str.substr(Y, 2)\n    to = to.replace(/YY|yy/g, Y)\n  }\n\n  let k, i\n  ;['M', 'D', 'H', 'h', 'm', 's'].forEach((s) => {\n    i = from.indexOf(s + s)\n    k = ~i ? str.substr(i, 2) : ''\n    to = to.replace(s + s, k)\n  })\n  return to\n}\n// dateStrForma('20190626', 'YYYYMMDD', 'YYYY年MM月DD日') ==> 2019年06月26日\n// dateStrForma('121220190626', '----YYYYMMDD', 'YYYY年MM月DD日') ==> 2019年06月26日\n// dateStrForma('2019年06月26日', 'YYYY年MM月DD日', 'YYYYMMDD') ==> 20190626\n\n// 一般的也可以使用正则来实现\n//'2019年06月26日'.replace(/(\\d{4})年(\\d{2})月(\\d{2})日/, '$1-$2-$3') ==> 2019-06-26\n```\n\n## GetUrlParam：获取 Url 参数，返回一个对象\n\n```js\nfunction GetUrlParam() {\n  let url = document.location.toString()\n  let arrObj = url.split('?')\n  let params = Object.create(null)\n  if (arrObj.length > 1) {\n    arrObj = arrObj[1].split('&')\n    arrObj.forEach((item) => {\n      item = item.split('=')\n      params[item[0]] = item[1]\n    })\n  }\n  return params\n}\n// ?a=1&b=2&c=3 ==> {a: \"1\", b: \"2\", c: \"3\"}\n```\n\n## downloadFile：base64 数据导出文件，文件下载\n\n```js\nfunction downloadFile(filename, data) {\n  let DownloadLink = document.createElement('a')\n\n  if (DownloadLink) {\n    document.body.appendChild(DownloadLink)\n    DownloadLink.style = 'display: none'\n    DownloadLink.download = filename\n    DownloadLink.href = data\n\n    if (document.createEvent) {\n      let DownloadEvt = document.createEvent('MouseEvents')\n\n      DownloadEvt.initEvent('click', true, false)\n      DownloadLink.dispatchEvent(DownloadEvt)\n    } else if (document.createEventObject) DownloadLink.fireEvent('onclick')\n    else if (typeof DownloadLink.onclick == 'function') DownloadLink.onclick()\n\n    document.body.removeChild(DownloadLink)\n  }\n}\n```\n\n## toFullScreen：全屏\n\n```js\nfunction toFullScreen() {\n  let elem = document.body\n  elem.webkitRequestFullScreen\n    ? elem.webkitRequestFullScreen()\n    : elem.mozRequestFullScreen\n    ? elem.mozRequestFullScreen()\n    : elem.msRequestFullscreen\n    ? elem.msRequestFullscreen()\n    : elem.requestFullScreen\n    ? elem.requestFullScreen()\n    : alert('浏览器不支持全屏')\n}\n```\n\n## exitFullscreen：退出全屏\n\n```js\nfunction exitFullscreen() {\n  let elem = parent.document\n  elem.webkitCancelFullScreen\n    ? elem.webkitCancelFullScreen()\n    : elem.mozCancelFullScreen\n    ? elem.mozCancelFullScreen()\n    : elem.cancelFullScreen\n    ? elem.cancelFullScreen()\n    : elem.msExitFullscreen\n    ? elem.msExitFullscreen()\n    : elem.exitFullscreen\n    ? elem.exitFullscreen()\n    : alert('切换失败,可尝试Esc退出')\n}\n```\n\n## requestAnimationFrame：window 动画\n\n```js\nwindow.requestAnimationFrame =\n  window.requestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.msRequestAnimationFrame ||\n  window.oRequestAnimationFrame ||\n  function (callback) {\n    //为了使setTimteout的尽可能的接近每秒60帧的效果\n    window.setTimeout(callback, 1000 / 60)\n  }\n\nwindow.cancelAnimationFrame =\n  window.cancelAnimationFrame ||\n  Window.webkitCancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.msCancelAnimationFrame ||\n  window.oCancelAnimationFrame ||\n  function (id) {\n    //为了使setTimteout的尽可能的接近每秒60帧的效果\n    window.clearTimeout(id)\n  }\n```\n\n## max：求取数组中非 NaN 数据中的最大值\n\n```js\nfunction max(arr) {\n  arr = arr.filter((item) => !_isNaN(item))\n  return arr.length ? Math.max.apply(null, arr) : undefined\n}\n//max([1, 2, '11', null, 'fdf', []]) ==> 11\n```\n\n## min：求取数组中非 NaN 数据中的最小值\n\n```js\nfunction min(arr) {\n  arr = arr.filter((item) => !_isNaN(item))\n  return arr.length ? Math.min.apply(null, arr) : undefined\n}\n//min([1, 2, '11', null, 'fdf', []]) ==> 1\n```\n\n## random：返回一个 lower - upper 之间的随机数\n\n```js\nfunction random(lower, upper) {\n  lower = +lower || 0\n  upper = +upper || 0\n  return Math.random() * (upper - lower) + lower\n}\n//random(0, 0.5) ==> 0.3567039135734613\n//random(2, 1) ===> 1.6718418553475423\n//random(-2, -1) ==> -1.4474325452361945\n```\n\n## performance.timing：利用 performance.timing 进行性能分析\n\n```js\nwindow.onload = function () {\n  setTimeout(function () {\n    let t = performance.timing\n    console.log(\n      'DNS查询耗时 ：' + (t.domainLookupEnd - t.domainLookupStart).toFixed(0)\n    )\n    console.log('TCP链接耗时 ：' + (t.connectEnd - t.connectStart).toFixed(0))\n    console.log(\n      'request请求耗时 ：' + (t.responseEnd - t.responseStart).toFixed(0)\n    )\n    console.log(\n      '解析dom树耗时 ：' + (t.domComplete - t.domInteractive).toFixed(0)\n    )\n    console.log(\n      '白屏时间 ：' + (t.responseStart - t.navigationStart).toFixed(0)\n    )\n    console.log(\n      'domready时间 ：' +\n        (t.domContentLoadedEventEnd - t.navigationStart).toFixed(0)\n    )\n    console.log(\n      'onload时间 ：' + (t.loadEventEnd - t.navigationStart).toFixed(0)\n    )\n\n    if ((t = performance.memory)) {\n      console.log(\n        'js内存使用占比 ：' +\n          ((t.usedJSHeapSize / t.totalJSHeapSize) * 100).toFixed(2) +\n          '%'\n      )\n    }\n  })\n}\n```\n\n## 禁止某些键盘事件\n\n```js\ndocument.addEventListener('keydown', function (event) {\n  return (\n    !(\n      (\n        112 == event.keyCode || //F1\n        123 == event.keyCode || //F12\n        (event.ctrlKey && 82 == event.keyCode) || //ctrl + R\n        (event.ctrlKey && 78 == event.keyCode) || //ctrl + N\n        (event.shiftKey && 121 == event.keyCode) || //shift + F10\n        (event.altKey && 115 == event.keyCode) || //alt + F4\n        ('A' == event.srcElement.tagName && event.shiftKey)\n      ) //shift + 点击a标签\n    ) || (event.returnValue = false)\n  )\n})\n```\n\n## 禁止右键、选择、复制\n\n```js\n;['contextmenu', 'selectstart', 'copy'].forEach(function (ev) {\n  document.addEventListener(ev, function (event) {\n    return (event.returnValue = false)\n  })\n})\n```\n","slug":"常用JS工具方法","published":1,"updated":"2021-05-26T13:53:09.329Z","_id":"ckp5j29no0000sbv02pp1cskv","comments":1,"layout":"post","photos":[],"link":"","content":"<p>搬运平时常用的工具函数</p>\n<span id=\"more\"></span>\n\n<h2 id=\"isStatic：检测数据是不是除了-symbol-外的原始数据\"><a href=\"#isStatic：检测数据是不是除了-symbol-外的原始数据\" class=\"headerlink\" title=\"isStatic：检测数据是不是除了 symbol 外的原始数据\"></a>isStatic：检测数据是不是除了 symbol 外的原始数据</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isStatic</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;string&#x27;</span> ||</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;number&#x27;</span> ||</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;boolean&#x27;</span> ||</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;undefined&#x27;</span> ||</span><br><span class=\"line\">    value === <span class=\"literal\">null</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isPrimitive：检测数据是不是原始数据\"><a href=\"#isPrimitive：检测数据是不是原始数据\" class=\"headerlink\" title=\"isPrimitive：检测数据是不是原始数据\"></a>isPrimitive：检测数据是不是原始数据</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isPrimitive</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> isStatic(value) || <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;symbol&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isObject：判断数据是不是引用类型的数据\"><a href=\"#isObject：判断数据是不是引用类型的数据\" class=\"headerlink\" title=\"isObject：判断数据是不是引用类型的数据\"></a>isObject：判断数据是不是引用类型的数据</h2><p>例如： arrays, functions, objects, regexes, new Number(0),以及 new String(‘’)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isObject</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> type = <span class=\"keyword\">typeof</span> value</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value != <span class=\"literal\">null</span> &amp;&amp; (type == <span class=\"string\">&#x27;object&#x27;</span> || type == <span class=\"string\">&#x27;function&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isObjectLike：检查-value-是否是-类对象。\"><a href=\"#isObjectLike：检查-value-是否是-类对象。\" class=\"headerlink\" title=\"isObjectLike：检查 value 是否是 类对象。\"></a>isObjectLike：检查 value 是否是 类对象。</h2><p>如果一个值是类对象，那么它不应该是 null，而且 typeof 后的结果是 “object”</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isObjectLike</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value != <span class=\"literal\">null</span> &amp;&amp; <span class=\"keyword\">typeof</span> value == <span class=\"string\">&#x27;object&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"getRawType：获取数据类型，返回结果为-Number、String、Object、Array-等\"><a href=\"#getRawType：获取数据类型，返回结果为-Number、String、Object、Array-等\" class=\"headerlink\" title=\"getRawType：获取数据类型，返回结果为 Number、String、Object、Array 等\"></a>getRawType：获取数据类型，返回结果为 Number、String、Object、Array 等</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRawType</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(value).slice(<span class=\"number\">8</span>, -<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isPlainObject：判断数据是不是-Object-类型的数据\"><a href=\"#isPlainObject：判断数据是不是-Object-类型的数据\" class=\"headerlink\" title=\"isPlainObject：判断数据是不是 Object 类型的数据\"></a>isPlainObject：判断数据是不是 Object 类型的数据</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isPlainObject</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(obj) === <span class=\"string\">&#x27;[object Object]&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isArray：判断数据是不是数组类型的数据\"><a href=\"#isArray：判断数据是不是数组类型的数据\" class=\"headerlink\" title=\"isArray：判断数据是不是数组类型的数据\"></a>isArray：判断数据是不是数组类型的数据</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isArray</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.isArray(arr)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isArrayLike：检查-value-是否是类数组\"><a href=\"#isArrayLike：检查-value-是否是类数组\" class=\"headerlink\" title=\"isArrayLike：检查 value 是否是类数组\"></a>isArrayLike：检查 value 是否是类数组</h2><p>如果一个值被认为是类数组，那么它不是一个函数，并且 value.length 是个整数，大于等于 0，小于或等于 Number.MAX_SAFE_INTEGER。这里字符串也将被当作类数组。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isArrayLike</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value != <span class=\"literal\">null</span> &amp;&amp; isLength(value.length) &amp;&amp; !isFunction(value)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isEmpty：检查-value-是否为空\"><a href=\"#isEmpty：检查-value-是否为空\" class=\"headerlink\" title=\"isEmpty：检查 value 是否为空\"></a>isEmpty：检查 value 是否为空</h2><p>如果是 null，直接返回 true；如果是类数组，判断数据长度；如果是 Object 对象，判断是否具有属性；如果是其他数据，直接返回 false(也可改为返回 true)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isEmpty</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (value == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isArrayLike(value)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> !value.length;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(isPlainObject(value))&#123;</span><br><span class=\"line\">          <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> value) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (hasOwnProperty.call(value, key)) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"cached：记忆函数：缓存函数的运算结果\"><a href=\"#cached：记忆函数：缓存函数的运算结果\" class=\"headerlink\" title=\"cached：记忆函数：缓存函数的运算结果\"></a>cached：记忆函数：缓存函数的运算结果</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cached</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> cache = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cachedFn</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> hit = cache[str]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hit || (cache[str] = fn(str))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"camelize：横线转驼峰命名\"><a href=\"#camelize：横线转驼峰命名\" class=\"headerlink\" title=\"camelize：横线转驼峰命名\"></a>camelize：横线转驼峰命名</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> camelizeRE = <span class=\"regexp\">/-(\\w)/g</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">camelize</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.replace(camelizeRE, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">_, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> c ? c.toUpperCase() : <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//ab-cd-ef ==&gt; abCdEf</span></span><br><span class=\"line\"><span class=\"comment\">//使用记忆函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> _camelize = cached(camelize)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"hyphenate：驼峰命名转横线命名：拆分字符串，使用-相连，并且转换为小写\"><a href=\"#hyphenate：驼峰命名转横线命名：拆分字符串，使用-相连，并且转换为小写\" class=\"headerlink\" title=\"hyphenate：驼峰命名转横线命名：拆分字符串，使用 - 相连，并且转换为小写\"></a>hyphenate：驼峰命名转横线命名：拆分字符串，使用 - 相连，并且转换为小写</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> hyphenateRE = <span class=\"regexp\">/\\B([A-Z])/g</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hyphenate</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.replace(hyphenateRE, <span class=\"string\">&#x27;-$1&#x27;</span>).toLowerCase()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//abCd ==&gt; ab-cd</span></span><br><span class=\"line\"><span class=\"comment\">//使用记忆函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> _hyphenate = cached(hyphenate)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"capitalize：字符串首位大写\"><a href=\"#capitalize：字符串首位大写\" class=\"headerlink\" title=\"capitalize：字符串首位大写\"></a>capitalize：字符串首位大写</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">capitalize</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.charAt(<span class=\"number\">0</span>).toUpperCase() + str.slice(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// abc ==&gt; Abc</span></span><br><span class=\"line\"><span class=\"comment\">//使用记忆函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> _capitalize = cached(capitalize)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"extend：将属性混合到目标对象中\"><a href=\"#extend：将属性混合到目标对象中\" class=\"headerlink\" title=\"extend：将属性混合到目标对象中\"></a>extend：将属性混合到目标对象中</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">extend</span>(<span class=\"params\">to, _from</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> _from) &#123;</span><br><span class=\"line\">    to[key] = _from[key]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> to</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"识别各种浏览器及平台\"><a href=\"#识别各种浏览器及平台\" class=\"headerlink\" title=\"识别各种浏览器及平台\"></a>识别各种浏览器及平台</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//运行环境是浏览器</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> inBrowser = <span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span> !== <span class=\"string\">&#x27;undefined&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//运行环境是微信</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> inWeex = <span class=\"keyword\">typeof</span> WXEnvironment !== <span class=\"string\">&#x27;undefined&#x27;</span> &amp;&amp; !!WXEnvironment.platform</span><br><span class=\"line\"><span class=\"keyword\">let</span> weexPlatform = inWeex &amp;&amp; WXEnvironment.platform.toLowerCase()</span><br><span class=\"line\"><span class=\"comment\">//浏览器 UA 判断</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> UA = inBrowser &amp;&amp; <span class=\"built_in\">window</span>.navigator.userAgent.toLowerCase()</span><br><span class=\"line\"><span class=\"keyword\">let</span> isIE = UA &amp;&amp; <span class=\"regexp\">/msie|trident/</span>.test(UA)</span><br><span class=\"line\"><span class=\"keyword\">let</span> isIE9 = UA &amp;&amp; UA.indexOf(<span class=\"string\">&#x27;msie 9.0&#x27;</span>) &gt; <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isEdge = UA &amp;&amp; UA.indexOf(<span class=\"string\">&#x27;edge/&#x27;</span>) &gt; <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isAndroid = (UA &amp;&amp; UA.indexOf(<span class=\"string\">&#x27;android&#x27;</span>) &gt; <span class=\"number\">0</span>) || weexPlatform === <span class=\"string\">&#x27;android&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isIOS = (UA &amp;&amp; <span class=\"regexp\">/iphone|ipad|ipod|ios/</span>.test(UA)) || weexPlatform === <span class=\"string\">&#x27;ios&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isChrome = UA &amp;&amp; <span class=\"regexp\">/chrome\\/\\d+/</span>.test(UA) &amp;&amp; !isEdge</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"getExplorerInfo：获取浏览器信息\"><a href=\"#getExplorerInfo：获取浏览器信息\" class=\"headerlink\" title=\"getExplorerInfo：获取浏览器信息\"></a>getExplorerInfo：获取浏览器信息</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getExplorerInfo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> t = navigator.userAgent.toLowerCase()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;msie&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        <span class=\"comment\">//ie &lt; 11</span></span><br><span class=\"line\">        type: <span class=\"string\">&#x27;IE&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/msie ([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : !!t.match(<span class=\"regexp\">/trident\\/.+?rv:(([\\d.]+))/</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ie 11</span></span><br><span class=\"line\">        type: <span class=\"string\">&#x27;IE&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"number\">11</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;edge&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Edge&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/edge\\/([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;firefox&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Firefox&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/firefox\\/([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;chrome&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Chrome&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/chrome\\/([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;opera&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Opera&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/opera.([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;Safari&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Safari&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/version\\/([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : &#123;</span><br><span class=\"line\">        type: t,</span><br><span class=\"line\">        version: -<span class=\"number\">1</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isPCBroswer：检测是否为-PC-端浏览器模式\"><a href=\"#isPCBroswer：检测是否为-PC-端浏览器模式\" class=\"headerlink\" title=\"isPCBroswer：检测是否为 PC 端浏览器模式\"></a>isPCBroswer：检测是否为 PC 端浏览器模式</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isPCBroswer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> e = navigator.userAgent.toLowerCase(),</span><br><span class=\"line\">    t = <span class=\"string\">&#x27;ipad&#x27;</span> == e.match(<span class=\"regexp\">/ipad/i</span>),</span><br><span class=\"line\">    i = <span class=\"string\">&#x27;iphone&#x27;</span> == e.match(<span class=\"regexp\">/iphone/i</span>),</span><br><span class=\"line\">    r = <span class=\"string\">&#x27;midp&#x27;</span> == e.match(<span class=\"regexp\">/midp/i</span>),</span><br><span class=\"line\">    n = <span class=\"string\">&#x27;rv:1.2.3.4&#x27;</span> == e.match(<span class=\"regexp\">/rv:1.2.3.4/i</span>),</span><br><span class=\"line\">    a = <span class=\"string\">&#x27;ucweb&#x27;</span> == e.match(<span class=\"regexp\">/ucweb/i</span>),</span><br><span class=\"line\">    o = <span class=\"string\">&#x27;android&#x27;</span> == e.match(<span class=\"regexp\">/android/i</span>),</span><br><span class=\"line\">    s = <span class=\"string\">&#x27;windows ce&#x27;</span> == e.match(<span class=\"regexp\">/windows ce/i</span>),</span><br><span class=\"line\">    l = <span class=\"string\">&#x27;windows mobile&#x27;</span> == e.match(<span class=\"regexp\">/windows mobile/i</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> !(t || i || r || n || a || o || s || l)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"dateFormater：格式化时间\"><a href=\"#dateFormater：格式化时间\" class=\"headerlink\" title=\"dateFormater：格式化时间\"></a>dateFormater：格式化时间</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dateFormater</span>(<span class=\"params\">formater, t</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> date = t ? <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(t) : <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(),</span><br><span class=\"line\">    Y = date.getFullYear() + <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    M = date.getMonth() + <span class=\"number\">1</span>,</span><br><span class=\"line\">    D = date.getDate(),</span><br><span class=\"line\">    H = date.getHours(),</span><br><span class=\"line\">    m = date.getMinutes(),</span><br><span class=\"line\">    s = date.getSeconds()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> formater</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/YYYY|yyyy/g</span>, Y)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/YY|yy/g</span>, Y.substr(<span class=\"number\">2</span>, <span class=\"number\">2</span>))</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/MM/g</span>, (M &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + M)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/DD/g</span>, (D &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + D)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/HH|hh/g</span>, (H &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + H)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/mm/g</span>, (m &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + m)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/ss/g</span>, (s &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + s)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// dateFormater(&#x27;YYYY-MM-DD HH:mm&#x27;, t) ==&gt; 2019-06-26 18:30</span></span><br><span class=\"line\"><span class=\"comment\">// dateFormater(&#x27;YYYYMMDDHHmm&#x27;, t) ==&gt; 201906261830</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"dateStrForma：将指定字符串由一种时间格式转化为另一种\"><a href=\"#dateStrForma：将指定字符串由一种时间格式转化为另一种\" class=\"headerlink\" title=\"dateStrForma：将指定字符串由一种时间格式转化为另一种\"></a>dateStrForma：将指定字符串由一种时间格式转化为另一种</h2><p>from 的格式应对应 str 的位置</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dateStrForma</span>(<span class=\"params\">str, <span class=\"keyword\">from</span>, to</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//&#x27;20190626&#x27; &#x27;YYYYMMDD&#x27; &#x27;YYYY年MM月DD日&#x27;</span></span><br><span class=\"line\">  str += <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> Y = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (~(Y = <span class=\"keyword\">from</span>.indexOf(<span class=\"string\">&#x27;YYYY&#x27;</span>))) &#123;</span><br><span class=\"line\">    Y = str.substr(Y, <span class=\"number\">4</span>)</span><br><span class=\"line\">    to = to.replace(<span class=\"regexp\">/YYYY|yyyy/g</span>, Y)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (~(Y = <span class=\"keyword\">from</span>.indexOf(<span class=\"string\">&#x27;YY&#x27;</span>))) &#123;</span><br><span class=\"line\">    Y = str.substr(Y, <span class=\"number\">2</span>)</span><br><span class=\"line\">    to = to.replace(<span class=\"regexp\">/YY|yy/g</span>, Y)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> k, i</span><br><span class=\"line\">  ;[<span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;D&#x27;</span>, <span class=\"string\">&#x27;H&#x27;</span>, <span class=\"string\">&#x27;h&#x27;</span>, <span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;s&#x27;</span>].forEach(<span class=\"function\">(<span class=\"params\">s</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    i = <span class=\"keyword\">from</span>.indexOf(s + s)</span><br><span class=\"line\">    k = ~i ? str.substr(i, <span class=\"number\">2</span>) : <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    to = to.replace(s + s, k)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> to</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// dateStrForma(&#x27;20190626&#x27;, &#x27;YYYYMMDD&#x27;, &#x27;YYYY年MM月DD日&#x27;) ==&gt; 2019年06月26日</span></span><br><span class=\"line\"><span class=\"comment\">// dateStrForma(&#x27;121220190626&#x27;, &#x27;----YYYYMMDD&#x27;, &#x27;YYYY年MM月DD日&#x27;) ==&gt; 2019年06月26日</span></span><br><span class=\"line\"><span class=\"comment\">// dateStrForma(&#x27;2019年06月26日&#x27;, &#x27;YYYY年MM月DD日&#x27;, &#x27;YYYYMMDD&#x27;) ==&gt; 20190626</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一般的也可以使用正则来实现</span></span><br><span class=\"line\"><span class=\"comment\">//&#x27;2019年06月26日&#x27;.replace(/(\\d&#123;4&#125;)年(\\d&#123;2&#125;)月(\\d&#123;2&#125;)日/, &#x27;$1-$2-$3&#x27;) ==&gt; 2019-06-26</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"GetUrlParam：获取-Url-参数，返回一个对象\"><a href=\"#GetUrlParam：获取-Url-参数，返回一个对象\" class=\"headerlink\" title=\"GetUrlParam：获取 Url 参数，返回一个对象\"></a>GetUrlParam：获取 Url 参数，返回一个对象</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">GetUrlParam</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = <span class=\"built_in\">document</span>.location.toString()</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arrObj = url.split(<span class=\"string\">&#x27;?&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> params = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (arrObj.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    arrObj = arrObj[<span class=\"number\">1</span>].split(<span class=\"string\">&#x27;&amp;&#x27;</span>)</span><br><span class=\"line\">    arrObj.forEach(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      item = item.split(<span class=\"string\">&#x27;=&#x27;</span>)</span><br><span class=\"line\">      params[item[<span class=\"number\">0</span>]] = item[<span class=\"number\">1</span>]</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> params</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// ?a=1&amp;b=2&amp;c=3 ==&gt; &#123;a: &quot;1&quot;, b: &quot;2&quot;, c: &quot;3&quot;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"downloadFile：base64-数据导出文件，文件下载\"><a href=\"#downloadFile：base64-数据导出文件，文件下载\" class=\"headerlink\" title=\"downloadFile：base64 数据导出文件，文件下载\"></a>downloadFile：base64 数据导出文件，文件下载</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadFile</span>(<span class=\"params\">filename, data</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> DownloadLink = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (DownloadLink) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(DownloadLink)</span><br><span class=\"line\">    DownloadLink.style = <span class=\"string\">&#x27;display: none&#x27;</span></span><br><span class=\"line\">    DownloadLink.download = filename</span><br><span class=\"line\">    DownloadLink.href = data</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.createEvent) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> DownloadEvt = <span class=\"built_in\">document</span>.createEvent(<span class=\"string\">&#x27;MouseEvents&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">      DownloadEvt.initEvent(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"literal\">true</span>, <span class=\"literal\">false</span>)</span><br><span class=\"line\">      DownloadLink.dispatchEvent(DownloadEvt)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.createEventObject) DownloadLink.fireEvent(<span class=\"string\">&#x27;onclick&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> DownloadLink.onclick == <span class=\"string\">&#x27;function&#x27;</span>) DownloadLink.onclick()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(DownloadLink)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"toFullScreen：全屏\"><a href=\"#toFullScreen：全屏\" class=\"headerlink\" title=\"toFullScreen：全屏\"></a>toFullScreen：全屏</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toFullScreen</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> elem = <span class=\"built_in\">document</span>.body</span><br><span class=\"line\">  elem.webkitRequestFullScreen</span><br><span class=\"line\">    ? elem.webkitRequestFullScreen()</span><br><span class=\"line\">    : elem.mozRequestFullScreen</span><br><span class=\"line\">    ? elem.mozRequestFullScreen()</span><br><span class=\"line\">    : elem.msRequestFullscreen</span><br><span class=\"line\">    ? elem.msRequestFullscreen()</span><br><span class=\"line\">    : elem.requestFullScreen</span><br><span class=\"line\">    ? elem.requestFullScreen()</span><br><span class=\"line\">    : alert(<span class=\"string\">&#x27;浏览器不支持全屏&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"exitFullscreen：退出全屏\"><a href=\"#exitFullscreen：退出全屏\" class=\"headerlink\" title=\"exitFullscreen：退出全屏\"></a>exitFullscreen：退出全屏</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">exitFullscreen</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> elem = parent.document</span><br><span class=\"line\">  elem.webkitCancelFullScreen</span><br><span class=\"line\">    ? elem.webkitCancelFullScreen()</span><br><span class=\"line\">    : elem.mozCancelFullScreen</span><br><span class=\"line\">    ? elem.mozCancelFullScreen()</span><br><span class=\"line\">    : elem.cancelFullScreen</span><br><span class=\"line\">    ? elem.cancelFullScreen()</span><br><span class=\"line\">    : elem.msExitFullscreen</span><br><span class=\"line\">    ? elem.msExitFullscreen()</span><br><span class=\"line\">    : elem.exitFullscreen</span><br><span class=\"line\">    ? elem.exitFullscreen()</span><br><span class=\"line\">    : alert(<span class=\"string\">&#x27;切换失败,可尝试Esc退出&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"requestAnimationFrame：window-动画\"><a href=\"#requestAnimationFrame：window-动画\" class=\"headerlink\" title=\"requestAnimationFrame：window 动画\"></a>requestAnimationFrame：window 动画</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.requestAnimationFrame =</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.requestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.webkitRequestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.mozRequestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.msRequestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.oRequestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//为了使setTimteout的尽可能的接近每秒60帧的效果</span></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.setTimeout(callback, <span class=\"number\">1000</span> / <span class=\"number\">60</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.cancelAnimationFrame =</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.cancelAnimationFrame ||</span><br><span class=\"line\">  Window.webkitCancelAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.mozCancelAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.msCancelAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.oCancelAnimationFrame ||</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">id</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//为了使setTimteout的尽可能的接近每秒60帧的效果</span></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.clearTimeout(id)</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"max：求取数组中非-NaN-数据中的最大值\"><a href=\"#max：求取数组中非-NaN-数据中的最大值\" class=\"headerlink\" title=\"max：求取数组中非 NaN 数据中的最大值\"></a>max：求取数组中非 NaN 数据中的最大值</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">max</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  arr = arr.filter(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> !_isNaN(item))</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.length ? <span class=\"built_in\">Math</span>.max.apply(<span class=\"literal\">null</span>, arr) : <span class=\"literal\">undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//max([1, 2, &#x27;11&#x27;, null, &#x27;fdf&#x27;, []]) ==&gt; 11</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"min：求取数组中非-NaN-数据中的最小值\"><a href=\"#min：求取数组中非-NaN-数据中的最小值\" class=\"headerlink\" title=\"min：求取数组中非 NaN 数据中的最小值\"></a>min：求取数组中非 NaN 数据中的最小值</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">min</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  arr = arr.filter(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> !_isNaN(item))</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.length ? <span class=\"built_in\">Math</span>.min.apply(<span class=\"literal\">null</span>, arr) : <span class=\"literal\">undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//min([1, 2, &#x27;11&#x27;, null, &#x27;fdf&#x27;, []]) ==&gt; 1</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"random：返回一个-lower-upper-之间的随机数\"><a href=\"#random：返回一个-lower-upper-之间的随机数\" class=\"headerlink\" title=\"random：返回一个 lower - upper 之间的随机数\"></a>random：返回一个 lower - upper 之间的随机数</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">random</span>(<span class=\"params\">lower, upper</span>) </span>&#123;</span><br><span class=\"line\">  lower = +lower || <span class=\"number\">0</span></span><br><span class=\"line\">  upper = +upper || <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.random() * (upper - lower) + lower</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//random(0, 0.5) ==&gt; 0.3567039135734613</span></span><br><span class=\"line\"><span class=\"comment\">//random(2, 1) ===&gt; 1.6718418553475423</span></span><br><span class=\"line\"><span class=\"comment\">//random(-2, -1) ==&gt; -1.4474325452361945</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"performance-timing：利用-performance-timing-进行性能分析\"><a href=\"#performance-timing：利用-performance-timing-进行性能分析\" class=\"headerlink\" title=\"performance.timing：利用 performance.timing 进行性能分析\"></a>performance.timing：利用 performance.timing 进行性能分析</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> t = performance.timing</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;DNS查询耗时 ：&#x27;</span> + (t.domainLookupEnd - t.domainLookupStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;TCP链接耗时 ：&#x27;</span> + (t.connectEnd - t.connectStart).toFixed(<span class=\"number\">0</span>))</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;request请求耗时 ：&#x27;</span> + (t.responseEnd - t.responseStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;解析dom树耗时 ：&#x27;</span> + (t.domComplete - t.domInteractive).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;白屏时间 ：&#x27;</span> + (t.responseStart - t.navigationStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;domready时间 ：&#x27;</span> +</span><br><span class=\"line\">        (t.domContentLoadedEventEnd - t.navigationStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;onload时间 ：&#x27;</span> + (t.loadEventEnd - t.navigationStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((t = performance.memory)) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">        <span class=\"string\">&#x27;js内存使用占比 ：&#x27;</span> +</span><br><span class=\"line\">          ((t.usedJSHeapSize / t.totalJSHeapSize) * <span class=\"number\">100</span>).toFixed(<span class=\"number\">2</span>) +</span><br><span class=\"line\">          <span class=\"string\">&#x27;%&#x27;</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"禁止某些键盘事件\"><a href=\"#禁止某些键盘事件\" class=\"headerlink\" title=\"禁止某些键盘事件\"></a>禁止某些键盘事件</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">&#x27;keydown&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    !(</span><br><span class=\"line\">      (</span><br><span class=\"line\">        <span class=\"number\">112</span> == event.keyCode || <span class=\"comment\">//F1</span></span><br><span class=\"line\">        <span class=\"number\">123</span> == event.keyCode || <span class=\"comment\">//F12</span></span><br><span class=\"line\">        (event.ctrlKey &amp;&amp; <span class=\"number\">82</span> == event.keyCode) || <span class=\"comment\">//ctrl + R</span></span><br><span class=\"line\">        (event.ctrlKey &amp;&amp; <span class=\"number\">78</span> == event.keyCode) || <span class=\"comment\">//ctrl + N</span></span><br><span class=\"line\">        (event.shiftKey &amp;&amp; <span class=\"number\">121</span> == event.keyCode) || <span class=\"comment\">//shift + F10</span></span><br><span class=\"line\">        (event.altKey &amp;&amp; <span class=\"number\">115</span> == event.keyCode) || <span class=\"comment\">//alt + F4</span></span><br><span class=\"line\">        (<span class=\"string\">&#x27;A&#x27;</span> == event.srcElement.tagName &amp;&amp; event.shiftKey)</span><br><span class=\"line\">      ) <span class=\"comment\">//shift + 点击a标签</span></span><br><span class=\"line\">    ) || (event.returnValue = <span class=\"literal\">false</span>)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"禁止右键、选择、复制\"><a href=\"#禁止右键、选择、复制\" class=\"headerlink\" title=\"禁止右键、选择、复制\"></a>禁止右键、选择、复制</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;[<span class=\"string\">&#x27;contextmenu&#x27;</span>, <span class=\"string\">&#x27;selectstart&#x27;</span>, <span class=\"string\">&#x27;copy&#x27;</span>].forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.addEventListener(ev, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (event.returnValue = <span class=\"literal\">false</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>搬运平时常用的工具函数</p>","more":"<h2 id=\"isStatic：检测数据是不是除了-symbol-外的原始数据\"><a href=\"#isStatic：检测数据是不是除了-symbol-外的原始数据\" class=\"headerlink\" title=\"isStatic：检测数据是不是除了 symbol 外的原始数据\"></a>isStatic：检测数据是不是除了 symbol 外的原始数据</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isStatic</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;string&#x27;</span> ||</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;number&#x27;</span> ||</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;boolean&#x27;</span> ||</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;undefined&#x27;</span> ||</span><br><span class=\"line\">    value === <span class=\"literal\">null</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isPrimitive：检测数据是不是原始数据\"><a href=\"#isPrimitive：检测数据是不是原始数据\" class=\"headerlink\" title=\"isPrimitive：检测数据是不是原始数据\"></a>isPrimitive：检测数据是不是原始数据</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isPrimitive</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> isStatic(value) || <span class=\"keyword\">typeof</span> value === <span class=\"string\">&#x27;symbol&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isObject：判断数据是不是引用类型的数据\"><a href=\"#isObject：判断数据是不是引用类型的数据\" class=\"headerlink\" title=\"isObject：判断数据是不是引用类型的数据\"></a>isObject：判断数据是不是引用类型的数据</h2><p>例如： arrays, functions, objects, regexes, new Number(0),以及 new String(‘’)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isObject</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> type = <span class=\"keyword\">typeof</span> value</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value != <span class=\"literal\">null</span> &amp;&amp; (type == <span class=\"string\">&#x27;object&#x27;</span> || type == <span class=\"string\">&#x27;function&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isObjectLike：检查-value-是否是-类对象。\"><a href=\"#isObjectLike：检查-value-是否是-类对象。\" class=\"headerlink\" title=\"isObjectLike：检查 value 是否是 类对象。\"></a>isObjectLike：检查 value 是否是 类对象。</h2><p>如果一个值是类对象，那么它不应该是 null，而且 typeof 后的结果是 “object”</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isObjectLike</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value != <span class=\"literal\">null</span> &amp;&amp; <span class=\"keyword\">typeof</span> value == <span class=\"string\">&#x27;object&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"getRawType：获取数据类型，返回结果为-Number、String、Object、Array-等\"><a href=\"#getRawType：获取数据类型，返回结果为-Number、String、Object、Array-等\" class=\"headerlink\" title=\"getRawType：获取数据类型，返回结果为 Number、String、Object、Array 等\"></a>getRawType：获取数据类型，返回结果为 Number、String、Object、Array 等</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRawType</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(value).slice(<span class=\"number\">8</span>, -<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isPlainObject：判断数据是不是-Object-类型的数据\"><a href=\"#isPlainObject：判断数据是不是-Object-类型的数据\" class=\"headerlink\" title=\"isPlainObject：判断数据是不是 Object 类型的数据\"></a>isPlainObject：判断数据是不是 Object 类型的数据</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isPlainObject</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(obj) === <span class=\"string\">&#x27;[object Object]&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isArray：判断数据是不是数组类型的数据\"><a href=\"#isArray：判断数据是不是数组类型的数据\" class=\"headerlink\" title=\"isArray：判断数据是不是数组类型的数据\"></a>isArray：判断数据是不是数组类型的数据</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isArray</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.isArray(arr)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isArrayLike：检查-value-是否是类数组\"><a href=\"#isArrayLike：检查-value-是否是类数组\" class=\"headerlink\" title=\"isArrayLike：检查 value 是否是类数组\"></a>isArrayLike：检查 value 是否是类数组</h2><p>如果一个值被认为是类数组，那么它不是一个函数，并且 value.length 是个整数，大于等于 0，小于或等于 Number.MAX_SAFE_INTEGER。这里字符串也将被当作类数组。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isArrayLike</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> value != <span class=\"literal\">null</span> &amp;&amp; isLength(value.length) &amp;&amp; !isFunction(value)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isEmpty：检查-value-是否为空\"><a href=\"#isEmpty：检查-value-是否为空\" class=\"headerlink\" title=\"isEmpty：检查 value 是否为空\"></a>isEmpty：检查 value 是否为空</h2><p>如果是 null，直接返回 true；如果是类数组，判断数据长度；如果是 Object 对象，判断是否具有属性；如果是其他数据，直接返回 false(也可改为返回 true)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isEmpty</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (value == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isArrayLike(value)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> !value.length;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(isPlainObject(value))&#123;</span><br><span class=\"line\">          <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> value) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (hasOwnProperty.call(value, key)) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"cached：记忆函数：缓存函数的运算结果\"><a href=\"#cached：记忆函数：缓存函数的运算结果\" class=\"headerlink\" title=\"cached：记忆函数：缓存函数的运算结果\"></a>cached：记忆函数：缓存函数的运算结果</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cached</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> cache = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cachedFn</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> hit = cache[str]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hit || (cache[str] = fn(str))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"camelize：横线转驼峰命名\"><a href=\"#camelize：横线转驼峰命名\" class=\"headerlink\" title=\"camelize：横线转驼峰命名\"></a>camelize：横线转驼峰命名</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> camelizeRE = <span class=\"regexp\">/-(\\w)/g</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">camelize</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.replace(camelizeRE, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">_, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> c ? c.toUpperCase() : <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//ab-cd-ef ==&gt; abCdEf</span></span><br><span class=\"line\"><span class=\"comment\">//使用记忆函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> _camelize = cached(camelize)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"hyphenate：驼峰命名转横线命名：拆分字符串，使用-相连，并且转换为小写\"><a href=\"#hyphenate：驼峰命名转横线命名：拆分字符串，使用-相连，并且转换为小写\" class=\"headerlink\" title=\"hyphenate：驼峰命名转横线命名：拆分字符串，使用 - 相连，并且转换为小写\"></a>hyphenate：驼峰命名转横线命名：拆分字符串，使用 - 相连，并且转换为小写</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> hyphenateRE = <span class=\"regexp\">/\\B([A-Z])/g</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hyphenate</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.replace(hyphenateRE, <span class=\"string\">&#x27;-$1&#x27;</span>).toLowerCase()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//abCd ==&gt; ab-cd</span></span><br><span class=\"line\"><span class=\"comment\">//使用记忆函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> _hyphenate = cached(hyphenate)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"capitalize：字符串首位大写\"><a href=\"#capitalize：字符串首位大写\" class=\"headerlink\" title=\"capitalize：字符串首位大写\"></a>capitalize：字符串首位大写</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">capitalize</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.charAt(<span class=\"number\">0</span>).toUpperCase() + str.slice(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// abc ==&gt; Abc</span></span><br><span class=\"line\"><span class=\"comment\">//使用记忆函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> _capitalize = cached(capitalize)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"extend：将属性混合到目标对象中\"><a href=\"#extend：将属性混合到目标对象中\" class=\"headerlink\" title=\"extend：将属性混合到目标对象中\"></a>extend：将属性混合到目标对象中</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">extend</span>(<span class=\"params\">to, _from</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> _from) &#123;</span><br><span class=\"line\">    to[key] = _from[key]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> to</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"识别各种浏览器及平台\"><a href=\"#识别各种浏览器及平台\" class=\"headerlink\" title=\"识别各种浏览器及平台\"></a>识别各种浏览器及平台</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//运行环境是浏览器</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> inBrowser = <span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span> !== <span class=\"string\">&#x27;undefined&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//运行环境是微信</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> inWeex = <span class=\"keyword\">typeof</span> WXEnvironment !== <span class=\"string\">&#x27;undefined&#x27;</span> &amp;&amp; !!WXEnvironment.platform</span><br><span class=\"line\"><span class=\"keyword\">let</span> weexPlatform = inWeex &amp;&amp; WXEnvironment.platform.toLowerCase()</span><br><span class=\"line\"><span class=\"comment\">//浏览器 UA 判断</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> UA = inBrowser &amp;&amp; <span class=\"built_in\">window</span>.navigator.userAgent.toLowerCase()</span><br><span class=\"line\"><span class=\"keyword\">let</span> isIE = UA &amp;&amp; <span class=\"regexp\">/msie|trident/</span>.test(UA)</span><br><span class=\"line\"><span class=\"keyword\">let</span> isIE9 = UA &amp;&amp; UA.indexOf(<span class=\"string\">&#x27;msie 9.0&#x27;</span>) &gt; <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isEdge = UA &amp;&amp; UA.indexOf(<span class=\"string\">&#x27;edge/&#x27;</span>) &gt; <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isAndroid = (UA &amp;&amp; UA.indexOf(<span class=\"string\">&#x27;android&#x27;</span>) &gt; <span class=\"number\">0</span>) || weexPlatform === <span class=\"string\">&#x27;android&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isIOS = (UA &amp;&amp; <span class=\"regexp\">/iphone|ipad|ipod|ios/</span>.test(UA)) || weexPlatform === <span class=\"string\">&#x27;ios&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isChrome = UA &amp;&amp; <span class=\"regexp\">/chrome\\/\\d+/</span>.test(UA) &amp;&amp; !isEdge</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"getExplorerInfo：获取浏览器信息\"><a href=\"#getExplorerInfo：获取浏览器信息\" class=\"headerlink\" title=\"getExplorerInfo：获取浏览器信息\"></a>getExplorerInfo：获取浏览器信息</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getExplorerInfo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> t = navigator.userAgent.toLowerCase()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;msie&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        <span class=\"comment\">//ie &lt; 11</span></span><br><span class=\"line\">        type: <span class=\"string\">&#x27;IE&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/msie ([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : !!t.match(<span class=\"regexp\">/trident\\/.+?rv:(([\\d.]+))/</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ie 11</span></span><br><span class=\"line\">        type: <span class=\"string\">&#x27;IE&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"number\">11</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;edge&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Edge&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/edge\\/([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;firefox&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Firefox&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/firefox\\/([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;chrome&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Chrome&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/chrome\\/([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;opera&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Opera&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/opera.([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : <span class=\"number\">0</span> &lt;= t.indexOf(<span class=\"string\">&#x27;Safari&#x27;</span>)</span><br><span class=\"line\">    ? &#123;</span><br><span class=\"line\">        type: <span class=\"string\">&#x27;Safari&#x27;</span>,</span><br><span class=\"line\">        version: <span class=\"built_in\">Number</span>(t.match(<span class=\"regexp\">/version\\/([\\d]+)/</span>)[<span class=\"number\">1</span>])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    : &#123;</span><br><span class=\"line\">        type: t,</span><br><span class=\"line\">        version: -<span class=\"number\">1</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isPCBroswer：检测是否为-PC-端浏览器模式\"><a href=\"#isPCBroswer：检测是否为-PC-端浏览器模式\" class=\"headerlink\" title=\"isPCBroswer：检测是否为 PC 端浏览器模式\"></a>isPCBroswer：检测是否为 PC 端浏览器模式</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isPCBroswer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> e = navigator.userAgent.toLowerCase(),</span><br><span class=\"line\">    t = <span class=\"string\">&#x27;ipad&#x27;</span> == e.match(<span class=\"regexp\">/ipad/i</span>),</span><br><span class=\"line\">    i = <span class=\"string\">&#x27;iphone&#x27;</span> == e.match(<span class=\"regexp\">/iphone/i</span>),</span><br><span class=\"line\">    r = <span class=\"string\">&#x27;midp&#x27;</span> == e.match(<span class=\"regexp\">/midp/i</span>),</span><br><span class=\"line\">    n = <span class=\"string\">&#x27;rv:1.2.3.4&#x27;</span> == e.match(<span class=\"regexp\">/rv:1.2.3.4/i</span>),</span><br><span class=\"line\">    a = <span class=\"string\">&#x27;ucweb&#x27;</span> == e.match(<span class=\"regexp\">/ucweb/i</span>),</span><br><span class=\"line\">    o = <span class=\"string\">&#x27;android&#x27;</span> == e.match(<span class=\"regexp\">/android/i</span>),</span><br><span class=\"line\">    s = <span class=\"string\">&#x27;windows ce&#x27;</span> == e.match(<span class=\"regexp\">/windows ce/i</span>),</span><br><span class=\"line\">    l = <span class=\"string\">&#x27;windows mobile&#x27;</span> == e.match(<span class=\"regexp\">/windows mobile/i</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> !(t || i || r || n || a || o || s || l)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"dateFormater：格式化时间\"><a href=\"#dateFormater：格式化时间\" class=\"headerlink\" title=\"dateFormater：格式化时间\"></a>dateFormater：格式化时间</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dateFormater</span>(<span class=\"params\">formater, t</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> date = t ? <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(t) : <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(),</span><br><span class=\"line\">    Y = date.getFullYear() + <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    M = date.getMonth() + <span class=\"number\">1</span>,</span><br><span class=\"line\">    D = date.getDate(),</span><br><span class=\"line\">    H = date.getHours(),</span><br><span class=\"line\">    m = date.getMinutes(),</span><br><span class=\"line\">    s = date.getSeconds()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> formater</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/YYYY|yyyy/g</span>, Y)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/YY|yy/g</span>, Y.substr(<span class=\"number\">2</span>, <span class=\"number\">2</span>))</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/MM/g</span>, (M &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + M)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/DD/g</span>, (D &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + D)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/HH|hh/g</span>, (H &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + H)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/mm/g</span>, (m &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + m)</span><br><span class=\"line\">    .replace(<span class=\"regexp\">/ss/g</span>, (s &lt; <span class=\"number\">10</span> ? <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>) + s)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// dateFormater(&#x27;YYYY-MM-DD HH:mm&#x27;, t) ==&gt; 2019-06-26 18:30</span></span><br><span class=\"line\"><span class=\"comment\">// dateFormater(&#x27;YYYYMMDDHHmm&#x27;, t) ==&gt; 201906261830</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"dateStrForma：将指定字符串由一种时间格式转化为另一种\"><a href=\"#dateStrForma：将指定字符串由一种时间格式转化为另一种\" class=\"headerlink\" title=\"dateStrForma：将指定字符串由一种时间格式转化为另一种\"></a>dateStrForma：将指定字符串由一种时间格式转化为另一种</h2><p>from 的格式应对应 str 的位置</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dateStrForma</span>(<span class=\"params\">str, <span class=\"keyword\">from</span>, to</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//&#x27;20190626&#x27; &#x27;YYYYMMDD&#x27; &#x27;YYYY年MM月DD日&#x27;</span></span><br><span class=\"line\">  str += <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> Y = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (~(Y = <span class=\"keyword\">from</span>.indexOf(<span class=\"string\">&#x27;YYYY&#x27;</span>))) &#123;</span><br><span class=\"line\">    Y = str.substr(Y, <span class=\"number\">4</span>)</span><br><span class=\"line\">    to = to.replace(<span class=\"regexp\">/YYYY|yyyy/g</span>, Y)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (~(Y = <span class=\"keyword\">from</span>.indexOf(<span class=\"string\">&#x27;YY&#x27;</span>))) &#123;</span><br><span class=\"line\">    Y = str.substr(Y, <span class=\"number\">2</span>)</span><br><span class=\"line\">    to = to.replace(<span class=\"regexp\">/YY|yy/g</span>, Y)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> k, i</span><br><span class=\"line\">  ;[<span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;D&#x27;</span>, <span class=\"string\">&#x27;H&#x27;</span>, <span class=\"string\">&#x27;h&#x27;</span>, <span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;s&#x27;</span>].forEach(<span class=\"function\">(<span class=\"params\">s</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    i = <span class=\"keyword\">from</span>.indexOf(s + s)</span><br><span class=\"line\">    k = ~i ? str.substr(i, <span class=\"number\">2</span>) : <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    to = to.replace(s + s, k)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> to</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// dateStrForma(&#x27;20190626&#x27;, &#x27;YYYYMMDD&#x27;, &#x27;YYYY年MM月DD日&#x27;) ==&gt; 2019年06月26日</span></span><br><span class=\"line\"><span class=\"comment\">// dateStrForma(&#x27;121220190626&#x27;, &#x27;----YYYYMMDD&#x27;, &#x27;YYYY年MM月DD日&#x27;) ==&gt; 2019年06月26日</span></span><br><span class=\"line\"><span class=\"comment\">// dateStrForma(&#x27;2019年06月26日&#x27;, &#x27;YYYY年MM月DD日&#x27;, &#x27;YYYYMMDD&#x27;) ==&gt; 20190626</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一般的也可以使用正则来实现</span></span><br><span class=\"line\"><span class=\"comment\">//&#x27;2019年06月26日&#x27;.replace(/(\\d&#123;4&#125;)年(\\d&#123;2&#125;)月(\\d&#123;2&#125;)日/, &#x27;$1-$2-$3&#x27;) ==&gt; 2019-06-26</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"GetUrlParam：获取-Url-参数，返回一个对象\"><a href=\"#GetUrlParam：获取-Url-参数，返回一个对象\" class=\"headerlink\" title=\"GetUrlParam：获取 Url 参数，返回一个对象\"></a>GetUrlParam：获取 Url 参数，返回一个对象</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">GetUrlParam</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = <span class=\"built_in\">document</span>.location.toString()</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arrObj = url.split(<span class=\"string\">&#x27;?&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> params = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (arrObj.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    arrObj = arrObj[<span class=\"number\">1</span>].split(<span class=\"string\">&#x27;&amp;&#x27;</span>)</span><br><span class=\"line\">    arrObj.forEach(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      item = item.split(<span class=\"string\">&#x27;=&#x27;</span>)</span><br><span class=\"line\">      params[item[<span class=\"number\">0</span>]] = item[<span class=\"number\">1</span>]</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> params</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// ?a=1&amp;b=2&amp;c=3 ==&gt; &#123;a: &quot;1&quot;, b: &quot;2&quot;, c: &quot;3&quot;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"downloadFile：base64-数据导出文件，文件下载\"><a href=\"#downloadFile：base64-数据导出文件，文件下载\" class=\"headerlink\" title=\"downloadFile：base64 数据导出文件，文件下载\"></a>downloadFile：base64 数据导出文件，文件下载</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadFile</span>(<span class=\"params\">filename, data</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> DownloadLink = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;a&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (DownloadLink) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(DownloadLink)</span><br><span class=\"line\">    DownloadLink.style = <span class=\"string\">&#x27;display: none&#x27;</span></span><br><span class=\"line\">    DownloadLink.download = filename</span><br><span class=\"line\">    DownloadLink.href = data</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.createEvent) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> DownloadEvt = <span class=\"built_in\">document</span>.createEvent(<span class=\"string\">&#x27;MouseEvents&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">      DownloadEvt.initEvent(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"literal\">true</span>, <span class=\"literal\">false</span>)</span><br><span class=\"line\">      DownloadLink.dispatchEvent(DownloadEvt)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.createEventObject) DownloadLink.fireEvent(<span class=\"string\">&#x27;onclick&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> DownloadLink.onclick == <span class=\"string\">&#x27;function&#x27;</span>) DownloadLink.onclick()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(DownloadLink)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"toFullScreen：全屏\"><a href=\"#toFullScreen：全屏\" class=\"headerlink\" title=\"toFullScreen：全屏\"></a>toFullScreen：全屏</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toFullScreen</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> elem = <span class=\"built_in\">document</span>.body</span><br><span class=\"line\">  elem.webkitRequestFullScreen</span><br><span class=\"line\">    ? elem.webkitRequestFullScreen()</span><br><span class=\"line\">    : elem.mozRequestFullScreen</span><br><span class=\"line\">    ? elem.mozRequestFullScreen()</span><br><span class=\"line\">    : elem.msRequestFullscreen</span><br><span class=\"line\">    ? elem.msRequestFullscreen()</span><br><span class=\"line\">    : elem.requestFullScreen</span><br><span class=\"line\">    ? elem.requestFullScreen()</span><br><span class=\"line\">    : alert(<span class=\"string\">&#x27;浏览器不支持全屏&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"exitFullscreen：退出全屏\"><a href=\"#exitFullscreen：退出全屏\" class=\"headerlink\" title=\"exitFullscreen：退出全屏\"></a>exitFullscreen：退出全屏</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">exitFullscreen</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> elem = parent.document</span><br><span class=\"line\">  elem.webkitCancelFullScreen</span><br><span class=\"line\">    ? elem.webkitCancelFullScreen()</span><br><span class=\"line\">    : elem.mozCancelFullScreen</span><br><span class=\"line\">    ? elem.mozCancelFullScreen()</span><br><span class=\"line\">    : elem.cancelFullScreen</span><br><span class=\"line\">    ? elem.cancelFullScreen()</span><br><span class=\"line\">    : elem.msExitFullscreen</span><br><span class=\"line\">    ? elem.msExitFullscreen()</span><br><span class=\"line\">    : elem.exitFullscreen</span><br><span class=\"line\">    ? elem.exitFullscreen()</span><br><span class=\"line\">    : alert(<span class=\"string\">&#x27;切换失败,可尝试Esc退出&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"requestAnimationFrame：window-动画\"><a href=\"#requestAnimationFrame：window-动画\" class=\"headerlink\" title=\"requestAnimationFrame：window 动画\"></a>requestAnimationFrame：window 动画</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.requestAnimationFrame =</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.requestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.webkitRequestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.mozRequestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.msRequestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.oRequestAnimationFrame ||</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//为了使setTimteout的尽可能的接近每秒60帧的效果</span></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.setTimeout(callback, <span class=\"number\">1000</span> / <span class=\"number\">60</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.cancelAnimationFrame =</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.cancelAnimationFrame ||</span><br><span class=\"line\">  Window.webkitCancelAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.mozCancelAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.msCancelAnimationFrame ||</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.oCancelAnimationFrame ||</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">id</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//为了使setTimteout的尽可能的接近每秒60帧的效果</span></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.clearTimeout(id)</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"max：求取数组中非-NaN-数据中的最大值\"><a href=\"#max：求取数组中非-NaN-数据中的最大值\" class=\"headerlink\" title=\"max：求取数组中非 NaN 数据中的最大值\"></a>max：求取数组中非 NaN 数据中的最大值</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">max</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  arr = arr.filter(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> !_isNaN(item))</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.length ? <span class=\"built_in\">Math</span>.max.apply(<span class=\"literal\">null</span>, arr) : <span class=\"literal\">undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//max([1, 2, &#x27;11&#x27;, null, &#x27;fdf&#x27;, []]) ==&gt; 11</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"min：求取数组中非-NaN-数据中的最小值\"><a href=\"#min：求取数组中非-NaN-数据中的最小值\" class=\"headerlink\" title=\"min：求取数组中非 NaN 数据中的最小值\"></a>min：求取数组中非 NaN 数据中的最小值</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">min</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  arr = arr.filter(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> !_isNaN(item))</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.length ? <span class=\"built_in\">Math</span>.min.apply(<span class=\"literal\">null</span>, arr) : <span class=\"literal\">undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//min([1, 2, &#x27;11&#x27;, null, &#x27;fdf&#x27;, []]) ==&gt; 1</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"random：返回一个-lower-upper-之间的随机数\"><a href=\"#random：返回一个-lower-upper-之间的随机数\" class=\"headerlink\" title=\"random：返回一个 lower - upper 之间的随机数\"></a>random：返回一个 lower - upper 之间的随机数</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">random</span>(<span class=\"params\">lower, upper</span>) </span>&#123;</span><br><span class=\"line\">  lower = +lower || <span class=\"number\">0</span></span><br><span class=\"line\">  upper = +upper || <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.random() * (upper - lower) + lower</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//random(0, 0.5) ==&gt; 0.3567039135734613</span></span><br><span class=\"line\"><span class=\"comment\">//random(2, 1) ===&gt; 1.6718418553475423</span></span><br><span class=\"line\"><span class=\"comment\">//random(-2, -1) ==&gt; -1.4474325452361945</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"performance-timing：利用-performance-timing-进行性能分析\"><a href=\"#performance-timing：利用-performance-timing-进行性能分析\" class=\"headerlink\" title=\"performance.timing：利用 performance.timing 进行性能分析\"></a>performance.timing：利用 performance.timing 进行性能分析</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> t = performance.timing</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;DNS查询耗时 ：&#x27;</span> + (t.domainLookupEnd - t.domainLookupStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;TCP链接耗时 ：&#x27;</span> + (t.connectEnd - t.connectStart).toFixed(<span class=\"number\">0</span>))</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;request请求耗时 ：&#x27;</span> + (t.responseEnd - t.responseStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;解析dom树耗时 ：&#x27;</span> + (t.domComplete - t.domInteractive).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;白屏时间 ：&#x27;</span> + (t.responseStart - t.navigationStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;domready时间 ：&#x27;</span> +</span><br><span class=\"line\">        (t.domContentLoadedEventEnd - t.navigationStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">      <span class=\"string\">&#x27;onload时间 ：&#x27;</span> + (t.loadEventEnd - t.navigationStart).toFixed(<span class=\"number\">0</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((t = performance.memory)) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">        <span class=\"string\">&#x27;js内存使用占比 ：&#x27;</span> +</span><br><span class=\"line\">          ((t.usedJSHeapSize / t.totalJSHeapSize) * <span class=\"number\">100</span>).toFixed(<span class=\"number\">2</span>) +</span><br><span class=\"line\">          <span class=\"string\">&#x27;%&#x27;</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"禁止某些键盘事件\"><a href=\"#禁止某些键盘事件\" class=\"headerlink\" title=\"禁止某些键盘事件\"></a>禁止某些键盘事件</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">&#x27;keydown&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    !(</span><br><span class=\"line\">      (</span><br><span class=\"line\">        <span class=\"number\">112</span> == event.keyCode || <span class=\"comment\">//F1</span></span><br><span class=\"line\">        <span class=\"number\">123</span> == event.keyCode || <span class=\"comment\">//F12</span></span><br><span class=\"line\">        (event.ctrlKey &amp;&amp; <span class=\"number\">82</span> == event.keyCode) || <span class=\"comment\">//ctrl + R</span></span><br><span class=\"line\">        (event.ctrlKey &amp;&amp; <span class=\"number\">78</span> == event.keyCode) || <span class=\"comment\">//ctrl + N</span></span><br><span class=\"line\">        (event.shiftKey &amp;&amp; <span class=\"number\">121</span> == event.keyCode) || <span class=\"comment\">//shift + F10</span></span><br><span class=\"line\">        (event.altKey &amp;&amp; <span class=\"number\">115</span> == event.keyCode) || <span class=\"comment\">//alt + F4</span></span><br><span class=\"line\">        (<span class=\"string\">&#x27;A&#x27;</span> == event.srcElement.tagName &amp;&amp; event.shiftKey)</span><br><span class=\"line\">      ) <span class=\"comment\">//shift + 点击a标签</span></span><br><span class=\"line\">    ) || (event.returnValue = <span class=\"literal\">false</span>)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"禁止右键、选择、复制\"><a href=\"#禁止右键、选择、复制\" class=\"headerlink\" title=\"禁止右键、选择、复制\"></a>禁止右键、选择、复制</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;[<span class=\"string\">&#x27;contextmenu&#x27;</span>, <span class=\"string\">&#x27;selectstart&#x27;</span>, <span class=\"string\">&#x27;copy&#x27;</span>].forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.addEventListener(ev, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (event.returnValue = <span class=\"literal\">false</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>"}],"PostAsset":[],"PostCategory":[{"post_id":"ckon1h1w80001l5v02vhy5mks","category_id":"ckon1h1wd0004l5v0f2ls94a8","_id":"ckon1h1wl000gl5v00ltc37vk"},{"post_id":"ckon1h1wj000dl5v03mt50irq","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1wn000ll5v0a0hg67zn"},{"post_id":"ckon1h1wb0003l5v07evddjob","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1wp000ol5v0ck8lh2li"},{"post_id":"ckon1h1wk000fl5v0fwlh6o2j","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1wq000ql5v0687f7kno"},{"post_id":"ckon1h1wm000jl5v0hrzaa33e","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1ws000tl5v0glbkdszl"},{"post_id":"ckon1h1wn000kl5v01u305y8v","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1wv000yl5v02gzl6c3u"},{"post_id":"ckon1h1wq000pl5v04ujr60v6","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1wx0013l5v0dtl016v9"},{"post_id":"ckon1h1wh000al5v0fjzpbdua","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1wz0016l5v0gapv9fnm"},{"post_id":"ckon1h1ws000ul5v0etvy6olf","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1wz0018l5v0ebhkdqvu"},{"post_id":"ckon1h1wt000xl5v09yjlajqb","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1x0001bl5v08yqd3czq"},{"post_id":"ckon1h1wp000nl5v093t9h5vi","category_id":"ckon1h1wt000wl5v08cwmfxjf","_id":"ckon1h1x1001el5v0g64ucowb"},{"post_id":"ckon1h1wr000sl5v06u9zhhsj","category_id":"ckon1h1ww0011l5v0dbf0by1x","_id":"ckon1h1x2001hl5v0fx4kc7on"},{"post_id":"ckon1h1wz0017l5v03u5i8cq5","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1x3001jl5v000mjhmfe"},{"post_id":"ckon1h1x0001al5v02a476mjz","category_id":"ckon1h1wd0004l5v0f2ls94a8","_id":"ckon1h1x4001ml5v0aj64ag9w"},{"post_id":"ckon1h1wx0012l5v06uxibppo","category_id":"ckon1h1wz0019l5v0d4n22tzu","_id":"ckon1h1x4001ol5v03wgs5p6b"},{"post_id":"ckon1h1x1001dl5v0g30cfze1","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1x6001rl5v07jgwhnqb"},{"post_id":"ckon1h1wy0015l5v0dq75g9qc","category_id":"ckon1h1x1001fl5v00xk8a7pw","_id":"ckon1h1x7001tl5v09lnb6pbo"},{"post_id":"ckon1h1x3001ll5v07wg8g8wa","category_id":"ckon1h1wz0019l5v0d4n22tzu","_id":"ckon1h1x7001vl5v012pa4tzr"},{"post_id":"ckon1h1x2001gl5v0bu2861yu","category_id":"ckon1h1x3001kl5v0ee3uejd3","_id":"ckon1h1x90020l5v0gv1w4xuf"},{"post_id":"ckon1h1x5001pl5v008tkg43s","category_id":"ckon1h1wz0019l5v0d4n22tzu","_id":"ckon1h1x90022l5v0alig4ujp"},{"post_id":"ckon1h1x6001sl5v05u0q4553","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1xa0025l5v08pog6if1"},{"post_id":"ckon1h1x2001il5v036jd7qyd","category_id":"ckon1h1x3001kl5v0ee3uejd3","_id":"ckon1h1xb0027l5v05wregxr7"},{"post_id":"ckon1h1x8001zl5v0g2117n26","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xb0029l5v05gn949mc"},{"post_id":"ckon1h1x90021l5v06qo0ezul","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1xc002bl5v0agildboe"},{"post_id":"ckon1h1x7001ul5v0bi455ulm","category_id":"ckon1h1x8001yl5v06lfoa8j9","_id":"ckon1h1xc002dl5v0grmmg00m"},{"post_id":"ckon1h1x90023l5v07tyehvyl","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1xd002fl5v07b5n9sea"},{"post_id":"ckon1h1xa0026l5v09hqndg2v","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xe002hl5v05jos7139"},{"post_id":"ckon1h1x7001wl5v0fqnpf8iw","category_id":"ckon1h1x8001yl5v06lfoa8j9","_id":"ckon1h1xe002jl5v08rideo64"},{"post_id":"ckon1h1xb0028l5v0fyty9oa0","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xf002ll5v0bdg2figi"},{"post_id":"ckon1h1xc002al5v01cm70sau","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xf002nl5v04a9peeuz"},{"post_id":"ckon1h1xc002cl5v02iejc0hq","category_id":"ckon1h1wz0019l5v0d4n22tzu","_id":"ckon1h1xg002pl5v0aqvk6s8h"},{"post_id":"ckon1h1xd002el5v0gd9f7cut","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xg002rl5v0cxao0bvv"},{"post_id":"ckon1h1xd002gl5v00sqn1mus","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1xh002tl5v0buc9f30w"},{"post_id":"ckon1h1xe002il5v02kbj4oyo","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xh002vl5v01jaycrtr"},{"post_id":"ckon1h1xe002kl5v03kto599g","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1xi002xl5v0bwt13q24"},{"post_id":"ckon1h1xf002ml5v0hd799706","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xi002zl5v02bzx0sb5"},{"post_id":"ckon1h1xf002ol5v0hasrfg1z","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xj0031l5v07skzchnw"},{"post_id":"ckon1h1xg002ql5v0cdq5crr4","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xk0033l5v0c3c5h27j"},{"post_id":"ckon1h1xg002sl5v0345k85z5","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xl0035l5v0fitj18s0"},{"post_id":"ckon1h1xh002ul5v0eugh5cg6","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1xl0036l5v04gpj2z1k"},{"post_id":"ckon1h1xi002wl5v0hnau0sug","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1xl0037l5v0f6al13y3"},{"post_id":"ckon1h1xi002yl5v03qh39x1k","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xl0038l5v0b75bd27a"},{"post_id":"ckon1h1xj0030l5v0a7tq9al2","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xm0039l5v04uqrdtxh"},{"post_id":"ckon1h1xj0032l5v04hg8ase5","category_id":"ckon1h1wl000hl5v0g9sa0j8d","_id":"ckon1h1xm003al5v0gzhsfui6"},{"post_id":"ckon1h1xk0034l5v003v39a91","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xm003bl5v0dlmkgckc"},{"post_id":"ckon1h1xq003cl5v0b824fzxp","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xt003hl5v089iefomu"},{"post_id":"ckon1h1xr003el5v00ryhaxco","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckon1h1xu003jl5v056i41wen"},{"post_id":"ckon1h1xs003gl5v001ipca9l","category_id":"ckon1h1x8001yl5v06lfoa8j9","_id":"ckon1h1xu003kl5v01a6cd2i8"},{"post_id":"ckon1h1xt003il5v0fa0u4v24","category_id":"ckon1h1wt000wl5v08cwmfxjf","_id":"ckon1h1xu003ll5v0c68935nc"},{"post_id":"ckon1h1xq003dl5v059dhe6lp","category_id":"ckon1h1xs003fl5v03oyudoft","_id":"ckon1h1xu003ml5v0avrj47ol"},{"post_id":"ckp148wwn000047v00t2b21o6","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckp148wws000247v06h6wgycb"},{"post_id":"ckon1h1wf0006l5v0fzooajl1","category_id":"ckp1d2qcn00009jv00brx42rt","_id":"ckp1d2qcv00019jv09x4l4ley"},{"post_id":"ckp148wwq000147v09qejd98n","category_id":"ckp1d2qcn00009jv00brx42rt","_id":"ckp1d2qd300029jv0aqx91kyy"},{"post_id":"ckon1h1wg0008l5v0as918m3m","category_id":"ckp1d2qcn00009jv00brx42rt","_id":"ckp1d2qd400039jv0c3h62atk"},{"post_id":"ckp5j29no0000sbv02pp1cskv","category_id":"ckon1h1wi000bl5v02bkog3fb","_id":"ckp5j29nt0001sbv07vwv7f4x"}],"PostTag":[{"post_id":"ckon1h1ww000zl5v08c9f8jg6","tag_id":"ckon1h1wy0014l5v0hjxehkyj","_id":"ckon1h1x1001cl5v0f0an7znl"}],"Tag":[{"name":"Vue","_id":"ckon1h1wy0014l5v0hjxehkyj"}]}}