---
title: http2
date: 2018-03-22 11:05:35
categories: http
---
http/2 的前身是由Google 与2009 年发布的实验性协议SPDY，其主要目标是**通过解决HTTP/1.1中广为人知的一些性能限制来减少页面的架子啊延迟**。

<!--more-->


HTTP/1.1的主要性能问题：
- HTTTP/1.x客户端需要使用多个连接才能实现并发和缩短延时。
- HTTP/1.x不会压缩请求和响应标头，从而导致不必要的网络流量。
- HTTP/1.x不支持有效的资源优先级，致使底层TCP连接的利用率低下。

这正是HTTP/2要致力于解决的：
HTTP/2通过支持**标头字段压缩和在同一连接上进行多个并发连接**，让应用更有效低利用网络资源，减少感知的延时时间。具体来说，它可以对同一链接上的请求和响应消息进行交错发送并未HTTP标头字段有效编码。**HTTP/2还允许为请求设置优先级，让更重要的请求更快速地完成**，从而进一步提升性能。

## 多路复用的单一长连接

### 单一长连接
在HTTP/2中，客户端向某个域名的服务器请求页面的过程中，**只会创建一条TCP连接**，即使这页面可能包含上百个资源。而之前的HTTP/1.x一般会创建6-8条TCP连接来请求这100多个资源。单一的连接应该是HTTP2的主要优势，单一的连接能减少TCP握手带来的延时（如果是建立在SSL、TLS上面，HTTP2能减少很多不必要的SSL握手。）

TCP协议有一个滑动窗口，有慢启动这件事，就是说每次建立连接后，数据先是慢慢的传，然后滑动窗口慢慢变大，才能较高效的传，但是http/1.x 会创建新连接受数据，因此像公交车一样走走停停（向大神致敬）。

### 多路复用
![img caption](/images/common/http2_1.jpg)

在http1.x中，在一条TCP连接上，多个请求只能串行执行。HTTP2把要传输的信息分割成一个个二进制帧，首部信息会被封装到HWADER Frame，相应的request body 就会放到 DATA Frame，这样就讲请求和响应区分开来了。进一步HTTP2还能对这些流（车道）制定优先级，优先级能动态的被改变。优先级能动态的被改变，例如把CSS和JavaScript文件设置得比图片的优先级要高，这样代码文件能更快的下载下来并得到执行。

## 头部压缩和二进制格式

HTTP2使用HPACK 要锁头部，减少报头的大小

## 服务端推送server push
这个功能通常被称为“缓存推送”。主要思想是：当用户请求资源X，而服务器知道它可能也需要资源Z 的情况下，服务器可以在客户端发送请求之前，主动将资源Z推送给客户端。