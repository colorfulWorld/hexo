---
title: è„šæ‰‹æ¶é›†æˆ
date: 2019-08-08 14:33:47
categories: å·¥å…·
---

## ä¸ºä»€ä¹ˆéœ€è¦è„šæ‰‹æ¶ï¼Ÿ

1ã€å‡å°‘é‡å¤æ€§çš„å·¥ä½œï¼Œä¸å†éœ€è¦å¤åˆ¶å…¶ä»–é¡¹ç›®å†åˆ é™¤æ— å…³ä»£ç ï¼Œæˆ–è€…ä»é›¶åˆ›å»ºä¸€ä¸ªé¡¹ç›®å’Œæ–‡ä»¶ ã€‚
2ã€æ ¹æ®äº¤äº’åŠ¨æ€ç”Ÿæˆé¡¹ç›®ç»“æ„å’Œé…ç½®æ–‡ä»¶,å…·å¤‡æ›´é«˜çš„çµæ´»æ€§å’Œäººæ€§åŒ–å®šåˆ¶çš„èƒ½åŠ› ã€‚
3ã€å¤šäººåä½œæ›´ä¸ºæ–¹ä¾¿ï¼Œé¿å…äº†äººå·¥ä¼ é€’æ–‡ä»¶çš„ç¹çã€‚
4ã€é›†æˆäº’è”ç½‘ä¸Šçš„æ¨¡æ¿ï¼Œæ–¹ä¾¿è‡ªå·±ä¸ä»–äººä½¿ç”¨ã€‚

<!--more-->

## æ€è·¯

å¼€å‘è„šæ‰‹æ¶å¯ä»¥å€Ÿé‰´ vue-cli çš„åŸºæœ¬æ€è·¯ã€‚vue-cli æ˜¯å°†é¡¹ç›®æ¨¡æ¿æ”¾åœ¨ git ä¸Šï¼Œè¿è¡Œçš„æ—¶å€™å†æ ¹æ®ç”¨æˆ·äº¤äº’ä¸‹è½½ä¸åŒçš„æ¨¡æ¿ï¼Œç»è¿‡æ¨¡æ¿å¼•æ“æ¸²æŸ“å‡ºæ¥ï¼Œç”Ÿæˆé¡¹ç›®ã€‚è¿™æ ·è®²è„šæ‰‹æ¶å’Œæ¨¡æ¿åˆ†ç¦»ï¼Œå°±å¯ä»¥å„è‡ªç»´æŠ¤ï¼Œå³ä½¿æ¨¡æ¿æœ‰æ‰€å˜åŠ¨ï¼Œåªéœ€è¦ä¸Šä¼ æœ€æ–°çš„æ¨¡æ¿å³å¯ï¼Œè€Œä¸éœ€è¦ç”¨æˆ·å»æ›´æ–°è„šæ‰‹æ¶å°±å¯ä»¥ç”Ÿæˆæœ€æ–°çš„é¡¹ç›®ã€‚

## è„šæ‰‹æ¶å·¥ä½œæµ

![network](https://image-static.segmentfault.com/409/200/409200816-5ab3668b4996f_articlex)

## è„šæ‰‹æ¶é—®ç­”æµ

    PS D:\test> vue create demo1

```
? Please pick a preset: Manually select features
? Check the features needed for your project: Babel, Router, Vuex, CSS Pre-processors, Linter
? Use history mode for router? (Requires proper server setup for index fallback in production) Yes
? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Less
? Pick a linter / formatter config: Basic
? Pick additional lint features: (Press <space> to select, <a> to toggle all, <i> to invert selection)Lint on save
? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In package.json
? Save this as a preset for future projects? Yes
? Save preset as: preset1

ğŸ“„  Generating README.md...


ğŸ‰  Successfully created project demo1.
ğŸ‘‰  Get started with the following commands:
```

## å¦‚ä½•æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶ï¼Ÿ

![network](/images/cli/è„šæ‰‹æ¶æ„å»ºæµç¨‹.png)

## ç¬¬ä¸‰æ–¹åº“çš„æ”¯æŒ

![network](/images/cli/ç¬¬ä¸‰æ–¹åº“æ”¯æŒ.png)

ä¼šä½¿ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“

- commander.js:å¯ä»¥è‡ªåŠ¨è§£æå‘½ä»¤å’Œå‚æ•°ï¼Œç”¨äºå¤„ç†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
- download-git-repo:ä¸‹è½½å¹¶æå– git ä»“åº“ï¼Œç”¨äºä¸‹è½½é¡¹ç›®æ¨¡æ¿
- inquirer.js:é€šè¿‡å‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢é›†åˆï¼Œç”¨äºå’Œç”¨æˆ·è¿›è¡Œäº¤äº’
- handlebars.js:æ¨¡æ¿å¼•æ“ï¼Œå°†ç”¨æˆ·æäº¤çš„ä¿¡æ¯åŠ¨æ€å¡«å……åˆ°æ–‡ä»¶ä¸­
- ora:ä¸‹è½½è¿‡ç¨‹ä¹…çš„è¯ï¼Œå¯ä»¥ç”¨äºæ˜¾ç¤ºä¸‹è½½ä¸­çš„åŠ¨ç”»æ•ˆæœ
- chalk:å¯ä»¥ç»™ç»ˆç«¯çš„å­—ä½“åŠ ä¸Šé¢œè‰²
- log-symbols:å¯ä»¥åœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤º âˆš æˆ– Ã— ç­‰å›¾æ ‡

## æ­å»ºæ­¥éª¤ï¼š

### åˆå§‹åŒ–é¡¹ç›®

é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œå‘½åä¸º mbs-cliï¼Œç„¶åæ–°å»ºä¸€ä¸ª bin/mbs æ–‡ä»¶ï¼Œå†æ‰§è¡Œ npm init ç”Ÿæˆä¸€ä¸ª package.json æ–‡ä»¶ã€‚æœ€åå®‰è£…ä¸Šé¢éœ€è¦ç”¨åˆ°çš„ä¾èµ–ã€‚

```
npm install commander download-git-repo inquirer handlebars ora chalk log-symbols cli-table -S

```

### å¤„ç†å‘½ä»¤è¡Œ

node.js å†…ç½®äº†å¯¹å‘½ä»¤è¡Œæ“ä½œçš„æ”¯æŒï¼Œåœ¨ package.json ä¸­çš„ bin å­—æ®µå¯ä»¥å®šä¹‰å‘½ä»¤åå’Œå…³è”çš„æ‰§è¡Œæ–‡ä»¶ã€‚

åœ¨ package.json ä¸­åŠ ä¸Š bin çš„å†…å®¹ï¼š

```javascript
{
	"name": â€œmbs-cli",
	"version": "1.0.0",
    "description": "ä¸­åå°ç³»ç»Ÿè„šæ‰‹æ¶",
	"bin": {
		"mbs": "bin/mbs"
     }
 }
```

é¦–å…ˆåœ¨ mbs æ–‡ä»¶ ä¸­å¼•å…¥ç›¸å…³ä¾èµ–æ¨¡å—ï¼š

```javascript
#!/usr/bin/env node

const { existsSync } = require('fs') //ç³»ç»Ÿå†…ç½®æ¨¡å— ä¸»è¦ç”¨æ¥æ“ä½œæ–‡ä»¶
const program = require('commander') //è‡ªåŠ¨çš„è§£æå‘½ä»¤å’Œå‚æ•°ï¼Œç”¨äºå¤„ç†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚
const chalk = require('chalk') //ç»™ç»ˆç«¯çš„å­—ä½“åŠ ä¸Šé¢œè‰²ã€‚
const symbols = require('log-symbols') //åœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºå‡º âˆš æˆ– Ã— ç­‰çš„å›¾æ ‡ã€‚

const res = (command) => resolve(__dirname, '../commands/', command)
```

### é…ç½® !/usr/bin/env node çš„ä½œç”¨

æŒ‡å®šç”¨ node æ‰§è¡Œè„šæœ¬æ–‡ä»¶ ,usr/bin/env è§£å†³äº†ä¸åŒçš„ç”¨æˆ· node è·¯å¾„ä¸åŒçš„é—®é¢˜ï¼Œå¯ä»¥è®©ç³»ç»ŸåŠ¨æ€çš„å»æŸ¥æ‰¾ node æ¥æ‰§è¡Œä½ çš„è„šæœ¬æ–‡ä»¶ã€‚

## nodejs ä¾èµ–æ¨¡å—ä»‹ç»ä¸ç”¨æ³•

### commanderï¼ˆæŒ‡æŒ¥å®˜ï¼‰

è‡ªåŠ¨åœ°è§£æå‘½ä»¤å’Œå‚æ•°ï¼Œç”¨äºå¤„ç†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚

- usage(): è®¾ç½® usage å€¼

- command(): å®šä¹‰ä¸€ä¸ªå‘½ä»¤åå­—

- description(): è®¾ç½® description å€¼

- option(): å®šä¹‰å‚æ•°ï¼Œéœ€è¦è®¾ç½®â€œå…³é”®å­—â€å’Œâ€œæè¿°â€ï¼Œå…³é”®å­—åŒ…æ‹¬â€œç®€å†™â€å’Œâ€œå…¨å†™â€ä¸¤éƒ¨åˆ†ï¼Œä»¥â€,â€,â€|â€,â€ç©ºæ ¼â€åšåˆ†éš”ã€‚

- parse(): è§£æå‘½ä»¤è¡Œå‚æ•° argv

- action(): æ³¨å†Œä¸€ä¸ª callback å‡½æ•°

- version() : ç»ˆç«¯è¾“å‡ºç‰ˆæœ¬å·

```javascript
PS D:\yameiproject\mbs-cli> mbs --help
Usage: mbs <command>

Options:
  -V, --version  output the version number
  -h, --help     output usage information

Commands:
  add|a          Add a new template
  init|i         Generate a new project
  init|ins       Generate a simple project
  create|c       Generate a new project
  list|l         List all the templates
```

å®šä¹‰å¸¸è§„å‘½ä»¤ï¼š

```javascript
const program = require('commander') //è‡ªåŠ¨çš„è§£æå‘½ä»¤å’Œå‚æ•°ï¼Œç”¨äºå¤„ç†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚

program.usage('<command>')

program.version(require('../package').version)
```

init å‘½ä»¤é€»è¾‘ï¼š

```javascript
program
  .command('init <name>')
  .description('Generate a new project')
  .alias('i')
  .action((name) => {
    if (!existsSync(name)) {
      require(res('init'))
    } else {
      // é”™è¯¯æç¤ºé¡¹ç›®å·²å­˜åœ¨ï¼Œé¿å…è¦†ç›–åŸæœ‰é¡¹ç›®
      console.log(symbols.error, chalk.red('Project already exists'))
    }
  })
```

å¤„ç†ç”¨æˆ·è¾“å…¥å‘½ä»¤ï¼š

```javascript
program
  .command('init <name>')
  .description('Generate a new project')
  .alias('i')
  .action((name) => {
    if (!existsSync(name)) {
      require(res('init'))
    } else {
      // é”™è¯¯æç¤ºé¡¹ç›®å·²å­˜åœ¨ï¼Œé¿å…è¦†ç›–åŸæœ‰é¡¹ç›®
      console.log(symbols.error, chalk.red('Project already exists'))
    }
  })
```

æœ€åå¤„ç†è§£æå‘½ä»¤è¡Œå‚æ•° ï¼š

```javascript
program.parse(process.argv)

//process:ä¸€ä¸ªå…¨å±€å¯¹è±¡,æ§åˆ¶æœ‰å…³ä¿¡æ¯ï¼Œæ§åˆ¶node.jsçš„è¿›ç¨‹
//program.parse:è§£æå‘½ä»¤ä¹‹ä¸­çš„å‚æ•°ï¼Œæ ¹æ®ä¸Šé¢å®šä¹‰å¥½çš„è§„åˆ™æ‰§è¡Œç›¸å…³å‘½ä»¤
//process.argv:è¯¥å±æ€§è¿”å›ä¸€ä¸ªæ•°ç»„,è¿™ä¸ªæ•°ç»„åŒ…å«äº†å¯åŠ¨node.jsè¿›ç¨‹æ—¶çš„å‘½ä»¤è¡Œå‚æ•°

if (!program.args.length) {
  program.help()
}
```

### inquirerï¼ˆè¯¢é—®è€…ï¼‰

é€šç”¨çš„å‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢é›†åˆï¼Œç”¨äºå’Œç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚ç”±äºäº¤äº’çš„é—®é¢˜ç§ç±»ä¸åŒï¼Œinquirer ä¸ºæ¯ä¸ªé—®é¢˜æä¾›å¾ˆå¤šå‚æ•°ï¼š

```
typeï¼šè¡¨ç¤ºæé—®çš„ç±»å‹ï¼ŒåŒ…æ‹¬ï¼šinput, confirm, list, rawlist, expand, checkbox, password, editorï¼›
name: å­˜å‚¨å½“å‰é—®é¢˜å›ç­”çš„å˜é‡ï¼›
messageï¼šé—®é¢˜çš„æè¿°ï¼›
defaultï¼šé»˜è®¤å€¼ï¼›
choicesï¼šåˆ—è¡¨é€‰é¡¹ï¼Œåœ¨æŸäº›typeä¸‹å¯ç”¨ï¼Œå¹¶ä¸”åŒ…å«ä¸€ä¸ªåˆ†éš”ç¬¦(separator)ï¼›
validateï¼šå¯¹ç”¨æˆ·çš„å›ç­”è¿›è¡Œæ ¡éªŒï¼›
filterï¼šå¯¹ç”¨æˆ·çš„å›ç­”è¿›è¡Œè¿‡æ»¤å¤„ç†ï¼Œè¿”å›å¤„ç†åçš„å€¼ï¼›
whenï¼šæ ¹æ®å‰é¢é—®é¢˜çš„å›ç­”ï¼Œåˆ¤æ–­å½“å‰é—®é¢˜æ˜¯å¦éœ€è¦è¢«å›ç­”ï¼›
prefixï¼šä¿®æ”¹messageé»˜è®¤å‰ç¼€ï¼›
suffixï¼šä¿®æ”¹messageé»˜è®¤åç¼€ã€‚
```

è¯­æ³•ç»“æ„

```javascript
const inquirer = require('inquirer')

const promptList = [
  // å…·ä½“äº¤äº’å†…å®¹
]

inquirer.prompt(promptList).then((answers) => {
  console.log(answers) // è¿”å›çš„ç»“æœ
})
```

input ç±»å‹

```javascript
const inquirer = require('inquirer');
inquirer.prompt([
    {
        type: 'input',
        name: 'author',
        message: 'è¯·è¾“å…¥ä½œè€…åç§°'
    }
]).then((answers) => {
    console.log(answers.author);
})

æ•ˆæœï¼š

```

æ•ˆæœï¼š

confirm ç±»å‹

```javascript
const promptList = [
  {
    type: 'confirm',
    message: 'æ˜¯å¦ä½¿ç”¨ç›‘å¬ï¼Ÿ',
    name: 'watch',
    prefix: 'å‰ç¼€'
  },
  {
    type: 'confirm',
    message: 'æ˜¯å¦è¿›è¡Œæ–‡ä»¶è¿‡æ»¤ï¼Ÿ',
    name: 'filter',
    suffix: 'åç¼€',
    when: function (answers) {
      // å½“watchä¸ºtrueçš„æ—¶å€™æ‰ä¼šæé—®å½“å‰é—®é¢˜
      return answers.watch
    }
  }
]
```

æ•ˆæœï¼š

list ç±»å‹

```javascript
const promptList = [
  {
    type: 'list',
    message: 'è¯·é€‰æ‹©ä¸€ç§æ°´æœ:',
    name: 'fruit',
    choices: ['Apple', 'Pear', 'Banana'],
    filter: function (val) {
      // ä½¿ç”¨filterå°†å›ç­”å˜ä¸ºå°å†™
      return val.toLowerCase()
    }
  }
]
```

æ•ˆæœï¼š

### download-git-repo

download-git-repo æ”¯æŒä» Githubã€Gitlab å’Œ Bitbucket ä¸‹è½½ä»“åº“ï¼Œ

```
download(repository, destination, options, callback)
```

repository

```
- GitHub - github:owner/name or simply owner/name
- GitLab - gitlab:owner/name
- Bitbucket - bitbucket:owner/name
- Direct - direct:url:branch
```

destination

```
 The file path to download the repository to. xxxxxxxxxxÂ 
```

options

```
 boolean default false - If true use git clone instead of an http download. While this can be a bit slower, it does allow private repositories to be used if the appropriate SSH keys are setup.
```

callback

```
 The callback function as function (err).
```

example:

```
download('direct:https://gitlab.com/flipxfx/download-git-repo-fixture/repository/archive.zip', 'test/tmp', function (err) {
  console.log(err ? 'Error' : 'Success')
})
```

### ora ï¼ˆloading åŠ¨æ•ˆï¼‰

ç”¨äºæ˜¾ç¤ºä¸‹è½½ä¸­çš„åŠ¨ç”»æ•ˆæœ

```javascript
const ora = require('ora')
// å¼€å§‹ä¸‹è½½
const spinner = ora('æ­£åœ¨ä¸‹è½½æ¨¡æ¿...')
spinner.start()
// ä¸‹è½½å¤±è´¥è°ƒç”¨
spinner.fail()
// ä¸‹è½½æˆåŠŸè°ƒç”¨
spinner.succeed()
```

```
\ Downloading template...
```

### chalkï¼ˆå­—ä½“é¢œè‰²ï¼‰

é€šè¿‡ chalk æ¥ä¸ºæ‰“å°ä¿¡æ¯åŠ ä¸Šæ ·å¼ï¼Œæ¯”å¦‚æˆåŠŸä¿¡æ¯ä¸ºç»¿è‰²ï¼Œå¤±è´¥ä¿¡æ¯ä¸ºçº¢è‰²ï¼Œè¿™æ ·å­ä¼šè®©ç”¨æˆ·æ›´åŠ å®¹æ˜“åˆ†è¾¨ï¼ŒåŒæ—¶ä¹Ÿè®©ç»ˆç«¯çš„æ˜¾ç¤ºæ›´åŠ çš„å¥½çœ‹ï¼š

```javascript
const chalk = require('chalk')
console.log(chalk.green('é¡¹ç›®åˆ›å»ºæˆåŠŸ'))
console.log(chalk.red('é¡¹ç›®åˆ›å»ºå¤±è´¥'))
const ora = require('ora')
// å¼€å§‹ä¸‹è½½
const spinner = ora('æ­£åœ¨ä¸‹è½½æ¨¡æ¿...')
spinner.start()
// ä¸‹è½½å¤±è´¥è°ƒç”¨
spinner.fail()
// ä¸‹è½½æˆåŠŸè°ƒç”¨
spinner.succeed()
```

### log-symbolsï¼ˆæ—¥å¿—ç¬¦å·ï¼‰

ä½¿ç”¨ log-symbols åœ¨ä¿¡æ¯å‰é¢åŠ ä¸Š âˆš æˆ– Ã— ç­‰çš„å›¾æ ‡ï¼Œä¼˜åŒ–è§†è§‰ä½“éªŒï¼š

```javascript
console.log(
  symbols.success,
  chalk.green('New project has been initialize successfully!')
)
```

## handlebars

handlebars å¯ä»¥å¯¹ä»“åº“çš„æ¨¡æ¿ä¸­çš„ package.json æ–‡ä»¶åšä¸€äº›åŠ¨æ€ä¿®æ”¹ :

```javascript
{
  "name": "{{name}}",
  "version": "1.0.0",
  "description": "{{description}}",
  "scripts": {
    "dev": "webpack-dev-server  --config build/webpack.dev.conf.js",
    "start": "npm run dev",
    "build": "node build/build.js"
  },
  "author": "{{author}}",
  "license": "ISC",
  ...
```

å¹¶åœ¨ä¸‹è½½æ¨¡æ¿å®Œæˆä¹‹åå°†ç”¨æˆ·è¾“å…¥çš„ç­”æ¡ˆæ¸²æŸ“åˆ° package.json ä¸­

```javascript
const fileName = './package.json;'
const meta = {
  name,
  description: answers.description,
  author: answers.author
}
const content = readFileSync(fileName).toString()
const result = handlebars.compile(content)(meta)
writeFileSync(fileName, result)
```

### cli-table

è¡¨æ ¼

```javascript
const table = new Table({
  head: ['Template Name', 'Branch', 'Url'],
  style: {
    head: ['green']
  }
})
```

### é…ç½®ä¸‹è½½æ¨¡æ¿

```javascript
download('http://git.ym/g-web/mbs-cli.git#master', jay/${name}, {clone: true}, (err) => {
          if(err){
            spinner.fail();
            console.log(symbols.error, chalk.red(err));
          }else{
            spinner.succeed();
            const fileName = `${name}/package.json`;
            const meta = {
              name,
              description: answers.description,
              author: answers.author
            }
            if(fs.existsSync(fileName)){
              const content = fs.readFileSync(fileName).toString();
              const result = handlebars.compile(content)(meta);
              fs.writeFileSync(fileName, result);
            }
            console.log(symbols.success, chalk.green('Project initialization completed'));
          }
})
```

### å‘½ä»¤è¡Œäº¤äº’

å‘½ä»¤è¡Œäº¤äº’åŠŸèƒ½å¯ä»¥åœ¨ç”¨æˆ·æ‰§è¡Œ init å‘½ä»¤åï¼Œå‘ç”¨æˆ·æå‡ºé—®é¢˜ï¼Œæ¥æ”¶ç”¨æˆ·çš„è¾“å…¥å¹¶ä½œå‡ºç›¸åº”çš„å¤„ç†ã€‚ä½¿ç”¨ inquirer.js å®ç°ã€‚

```javascript
let tplList = require(`${__dirname}/../templates`)

const questions = [
  {
    type: 'input',
    name: 'project',
    message: 'Project name:',
    validate(val) {
      if (val !== '') {
        return true
      }
      return 'Project name is required!'
    }
  },
  {
    type: 'input',
    name: 'author',
    message: 'Please enter the author name:'
  },
  {
    type: 'input',
    name: 'description',
    message: 'Please enter a description of the project:',
    default: 'a project do for you'
  },
  {
    type: 'input',
    name: 'place',
    message: 'Where to init the project:',
    default: './'
  }
]

module.exports = prompt(questions).then((answers) => {
  const spinner = ora('Downloading template...')
  spinner.start()
  download(
    `direct:${tplList['template1']['url']}#${tplList['template1']['branch']}`,
    `${answers.place}/${answers.project}`,
    { clone: false },
    (err) => {
      if (err) {
        spinner.fail()
        console.log(symbols.error, chalk.red(err))
      } else {
        spinner.succeed()
        const fileName = `${answers.project}/package.json`
        const meta = {
          name: answers.project,
          description: answers.description,
          author: answers.author
        }
        console.log(meta)
        if (existsSync(fileName)) {
          const content = readFileSync(fileName).toString()
          const result = handlebars.compile(content)(meta)
          writeFileSync(fileName, result)
        }
        console.log(
          symbols.success,
          chalk.green('New project has been initialize successfully!')
        )
      }
    }
  )
})
```

### æ¸²æŸ“æ¨¡æ¿

ç”¨ handlebars çš„è¯­æ³•å¯¹ æ¨¡æ¿ä¸­çš„ package.json æ–‡ä»¶åšä¸€äº›ä¿®æ”¹ ï¼š

```javascript
{
  "name": "{{name}}",
  "version": "1.0.0",
  "description": "{{description}}",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "{{author}}",
  "license": "ISC"
}
```

å¹¶åœ¨ä¸‹è½½æ¨¡æ¿å®Œæˆä¹‹åå°†ç”¨æˆ·è¾“å…¥çš„ç­”æ¡ˆæ¸²æŸ“åˆ° package.json ä¸­

```javascript
program
  .version('1.0.0', '-v, --version')
  .command('init <name>')
  .action((name) => {
    inquirer
      .prompt([
        {
          name: 'description',
          message: 'è¯·è¾“å…¥é¡¹ç›®æè¿°'
        },
        {
          name: 'author',
          message: 'è¯·è¾“å…¥ä½œè€…åç§°'
        }
      ])
      .then((answers) => {
        download('xxxxx#master', name, { clone: true }, (err) => {
          const meta = {
            name,
            description: answers.description,
            author: answers.author
          }
          const fileName = `${name}/package.json`
          const content = fs.readFileSync(fileName).toString()
          const result = handlebars.compile(content)(meta)
          fs.writeFileSync(fileName, result)
        })
      })
  })
```

è¿™é‡Œä½¿ç”¨äº† node.js çš„æ–‡ä»¶æ¨¡å— fsï¼Œå°† handlebars æ¸²æŸ“å®Œåçš„æ¨¡æ¿é‡æ–°å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚

### è§†è§‰ç¾åŒ–

åœ¨ç”¨æˆ·è¾“å…¥ç­”æ¡ˆä¹‹åï¼Œå¼€å§‹ä¸‹è½½æ¨¡æ¿ï¼Œè¿™æ—¶å€™ä½¿ç”¨ ora æ¥æç¤ºç”¨æˆ·æ­£åœ¨ä¸‹è½½ä¸­ï¼š

```
const ora = require('ora');
// å¼€å§‹ä¸‹è½½
const spinner = ora('æ­£åœ¨ä¸‹è½½æ¨¡æ¿...');
spinner.start();
// ä¸‹è½½å¤±è´¥è°ƒç”¨
spinner.fail();
// ä¸‹è½½æˆåŠŸè°ƒç”¨
spinner.succeed();
```

## ç®€å•ç‰ˆè„šæ‰‹æ¶å®Œæ•´ç¤ºä¾‹

```javascript
#!/usr/bin/env node
const fs = require('fs');//ç³»ç»Ÿå†…ç½®æ¨¡å— ä¸»è¦ç”¨æ¥æ“ä½œæ–‡ä»¶
const program = require('commander');//è‡ªåŠ¨çš„è§£æå‘½ä»¤å’Œå‚æ•°ï¼Œç”¨äºå¤„ç†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚
const download = require('download-git-repo');//ä¸‹è½½å¹¶æå– git ä»“åº“ï¼Œç”¨äºä¸‹è½½é¡¹ç›®æ¨¡æ¿ã€‚
const handlebars = require('handlebars');//æ¨¡æ¿å¼•æ“ï¼Œå°†ç”¨æˆ·æäº¤çš„ä¿¡æ¯åŠ¨æ€å¡«å……åˆ°æ–‡ä»¶ä¸­ã€‚
const inquirer = require('inquirer');//é€šç”¨çš„å‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢é›†åˆï¼Œç”¨äºå’Œç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚
const ora = require('ora');//ä¸‹è½½è¿‡ç¨‹ä¹…çš„è¯ï¼Œå¯ä»¥ç”¨äºæ˜¾ç¤ºä¸‹è½½ä¸­çš„åŠ¨ç”»æ•ˆæœã€‚
const chalk = require('chalk');//ç»™ç»ˆç«¯çš„å­—ä½“åŠ ä¸Šé¢œè‰²ã€‚
const symbols = require('log-symbols');//åœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºå‡º âˆš æˆ– Ã— ç­‰çš„å›¾æ ‡ã€‚

program.version('1.0.4', '-v, --version')
  .command('init <name>')
  .action((name) => {
    if(!fs.existsSync(name)){
      inquirer.prompt([//prompt æç¤º
        {
          name: 'description',
          message: 'Please enter a description of the project:'
        },
        {
          name: 'author',
          message: 'Please enter the author name:'
        }
      ]).then((answers) => {
        const spinner = ora('Downloading template...');
        spinner.start();
        /**
         * ä¸€çº§ç›®å½•  name
         * äºŒçº§ç›®å½• jay/${name}
         */
        download('http://git.ym/g-web/mbs-cli.git#master', jay/${name}, {clone: true}, (err) => {
          if(err){
            spinner.fail();
            console.log(symbols.error, chalk.red(err));
          }else{
            spinner.succeed();
            const fileName = `${name}/package.json`;
            const meta = {
              name,
              description: answers.description,
              author: answers.author
            }
            if(fs.existsSync(fileName)){
              const content = fs.readFileSync(fileName).toString();
              const result = handlebars.compile(content)(meta);
              fs.writeFileSync(fileName, result);
            }
            console.log(symbols.success, chalk.green('Project initialization completed'));
          }
        })
      })
    }else{
      // é”™è¯¯æç¤ºé¡¹ç›®å·²å­˜åœ¨ï¼Œé¿å…è¦†ç›–åŸæœ‰é¡¹ç›®
      console.log(symbols.error, chalk.red('Project already exists'));
    }
  })
program.parse(process.argv);
```

### mbs-cli æ ¸å¿ƒå‘½ä»¤

```javascript
  Commands:

    add|a             Add a new template
    list|l            List all the templates
    init|i            Generate a new project
    create|c          Generate a new project by choose a template
    init simple|ins   Generate a simple project

  Options:

    -h, --help     output usage information
    -V, --version  output the version number
```

### å…¥å£æ–‡ä»¶ mbs

```javascript
#!/usr/bin/env node

process.env.NODE_PATH = __dirname + '/../node_modules/'

const { resolve } = require('path')
const chalk = require('chalk')
const { existsSync } = require('fs')
const symbols = require('log-symbols')
const program = require('commander')

const res = (command) => resolve(__dirname, '../commands/', command)

program.usage('<command>')

program.version(require('../package').version)

program
  .command('add')
  .description('Add a new template')
  .alias('a')
  .action(() => {
    require(res('add'))
  })

program
  .command('init')
  .description('Generate a new project')
  .alias('i')
  .action(() => {
    require(res('init'))
  })

program
  .command('create')
  .description('Generate a new project')
  .alias('c')
  .action(() => {
    require(res('create'))
  })

program
  .command('list')
  .description('List all the templates')
  .alias('l')
  .action(() => {
    require(res('list'))
  })

program.parse(process.argv)

if (!program.args.length) {
  program.help() //å¦‚æœæ²¡æœ‰è¾“å…¥å‚æ•°ï¼Œç»ˆç«¯æ˜¾ç¤ºå¸®åŠ©
}
```

### init å‘½ä»¤

```javascript
let tplList = require(`${__dirname}/../templates`)

const questions = [
  {
    type: 'input',
    name: 'project',
    message: 'Project name:',
    validate(val) {
      if (val !== '') {
        return true
      }
      return 'Project name is required!'
    }
  },
  {
    type: 'input',
    name: 'author',
    message: 'author name:'
  },
  {
    type: 'input',
    name: 'description',
    message: 'description of the project:',
    default: 'a simple spa project'
  },
  {
    type: 'input',
    name: 'place',
    message: 'Where to init the project:',
    default: './'
  }
]

module.exports = prompt(questions).then((answers) => {
  const spinner = ora('Downloading template...')
  spinner.start()
  download(
    `direct:${tplList['template1']['url']}#${tplList['template1']['branch']}`,
    `${answers.place}/${answers.project}`,
    { clone: true },
    (err) => {
      if (err) {
        spinner.fail()
        console.log(symbols.error, chalk.red(err))
      } else {
        spinner.succeed()
        const fileName = `${answers.project}/package.json`
        const meta = {
          name: answers.project,
          description: answers.description,
          author: answers.author
        }
        console.log(meta)
        if (existsSync(fileName)) {
          console.log('come in...')
          const content = readFileSync(fileName).toString()
          const result = handlebars.compile(content)(meta)
          writeFileSync(fileName, result)
        }
        console.log(
          symbols.success,
          chalk.green('New project has been initialize successfully!')
        )
      }
    }
  )
})
```

### init simple å‘½ä»¤

```javascript
let tplList = require(`${__dirname}/../templates`)

const question = [
  {
    name: 'description',
    message: 'Please enter a description of the project:'
  },
  {
    name: 'author',
    message: 'Please enter the author name:'
  }
]

module.exports = prompt(question).then((answers) => {
  const spinner = ora('Downloading template...')
  spinner.start()
  download(
    `direct:${tplList['template2']['url']}#${tplList['template2']['branch']}`,
    `./${name}`,
    { clone: true },
    (err) => {
      if (err) {
        spinner.fail()
        console.log(symbols.error, chalk.red(err))
      } else {
        spinner.succeed()
        const fileName = `${name}/package.json`
        const meta = {
          name,
          description: answers.description,
          author: answers.author
        }
        if (existsSync(fileName)) {
          const content = readFileSync(fileName).toString()
          const result = handlebars.compile(content)(meta)
          writeFileSync(fileName, result)
        }
        console.log(
          symbols.success,
          chalk.green('Project initialization completed')
        )
      }
    }
  )
})
```

### create å‘½ä»¤

```javascript
let templateList = require(`${__dirname}/../templates`)
let rmTempList = require(`${__dirname}/../config/remote-templates`)

const choices = rmTempList.map((template) => {
  return {
    name: `${template.name} - ${template.description}`,
    value: template.name
  }
})

const questions = [
  {
    type: 'input',
    name: 'project',
    message: 'Project name:',
    validate(val) {
      if (val !== '') {
        return true
      }
      return 'Project name is required!'
    }
  },
  {
    type: 'list',
    name: 'template',
    choices,
    message: 'Choose template you want:',
    validate(val) {
      if (val !== '') {
        return true
      }
      return 'template name is required!'
    }
  },
  {
    type: 'input',
    name: 'author',
    message: 'author name:'
  },
  {
    type: 'input',
    name: 'description',
    message: 'description of the project:',
    default: ''
  },
  {
    type: 'input',
    name: 'place',
    message: 'Where to init the project:',
    default: './'
  }
]

module.exports = prompt(questions).then((answers) => {
  const spinner = ora('Downloading template...')
  spinner.start()
  const template = rmTempList.filter((item) => {
    return answers.template.includes(item.name) && item
  })[0]
  download(
    `direct:${template.url}#${template.branch}`,
    `${answers.place}/${answers.project}`,
    { clone: true },
    (err) => {
      if (err) {
        spinner.fail()
        console.log(symbols.error, chalk.red(err))
      } else {
        spinner.succeed()
        const fileName = `${answers.project}/package.json`
        const meta = {
          name: answers.project,
          description: answers.description,
          author: answers.author
        }
        console.log(meta)
        if (existsSync(fileName)) {
          const content = readFileSync(fileName).toString()
          const result = handlebars.compile(content)(meta)
          writeFileSync(fileName, result)
        }
        console.log(
          symbols.success,
          chalk.green('New project has been initialize successfully!')
        )
      }
    }
  )
})
```

æ•ˆæœ

```
$ mbs create

? Project name: demo
? Choose template you want: (Use arrow keys)
> vue-webpack-pc - åŸºäºwebpackæ„å»ºçš„vueé¡¹ç›®æ¨¡æ¿
  react-webpack-pc - åŸºäºwebpackæ„å»ºçš„reacté¡¹ç›®æ¨¡æ¿
  angular-webpack-pc - åŸºäºwebpackæ„å»ºçš„angularé¡¹ç›®æ¨¡æ¿
  discover your template - æ›´å¤šæµ·é‡æ¨¡æ¿ç­‰ä½ å‘æ˜ä¸æ”¶è—.
? Choose template you want: vue-webpack-pc - åŸºäºwebpackæ„å»ºçš„vueé¡¹ç›®æ¨¡æ¿
? Please enter the author name: jay
? Please enter a description of the project: a simple spa project
? Where to init the project: ./
âˆš Downloading template...
âˆš New project has been initialize successfully!
```

### add å‘½ä»¤

```javascript
const { prompt } = require('inquirer')
const { writeFile } = require('fs')
const { showTable } = require(`${__dirname}/../utils`)

let tempList = require(`${__dirname}/../templates`)

const question = [
  {
    type: 'input',
    name: 'name',
    message: 'Set the custom name of the template:',
    validate(val) {
      if (tempList[val]) {
        return 'Template is existed!'
      } else if (val === '') {
        return 'Name is required!'
      } else {
        return true
      }
    }
  },
  {
    type: 'input',
    name: 'branch',
    message: 'branch of the template:',
    validate(val) {
      if (val !== '') {
        return true
      }
      return 'branch is required!'
    }
  },
  {
    type: 'input',
    name: 'url',
    message: 'Url of the template:',
    validate(val) {
      if (val !== '') {
        return true
      }
      return 'Url is required!'
    }
  }
]

module.exports = prompt(question).then(({ name, branch, url }) => {
  tempList[name] = {}
  tempList[name]['branch'] = branch
  tempList[name]['url'] = url

  writeFile(
    `${__dirname}/../templates.json`,
    JSON.stringify(tempList),
    'utf-8',
    (err) => {
      if (err) {
        console.log(err)
      }
      showTable(tempList, 'New template has been added successfully!')
    }
  )
})
```

æ•ˆæœ

```
$ mbs add

? Set the custom name of the template: template1
? branch of the template: master
? Url of the template: http://git.ym/Chenmh/bs-init-template.git
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Template Name â”‚ Branch â”‚ Url                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ template1     â”‚ master â”‚ http://git.ym/Chenmh/bs-init-template.git â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ” New template has been added successfully!
```

`mbs` use [download-git-repo](https://github.com/flipxfx/download-git-repo) to down load git repos. After answering 3 questions, you'll add a new template to `mbs`.

### list å‘½ä»¤

```javascript
const { showTable } = require(`${__dirname}/../utils`)

let tempList = require(`${__dirname}/../templates`)

module.exports = showTable(tempList)
```

```javascript
function showTable(tempList) {
  const list = Object.keys(tempList)
  if (list.length) {
    list.forEach((key) => {
      table.push([key, tempList[key]['branch'], tempList[key]['url']])
      if (table.length === list.length) {
        process.exit()
      }
    })
  } else {
    console.log(table.toString())
    process.exit()
  }
}
```

æ•ˆæœ

```
$ mbs list

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Template Name â”‚ Branch   â”‚ Url                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ template1     â”‚ standard â”‚ http://git.ym/Chenmh/bs-init-template.git â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ template2     â”‚ simple   â”‚ http://git.ym/Chenmh/bs-init-template.git â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

utils.js

```javascript
const Table = require('cli-table')
const chalk = require('chalk')

const table = new Table({
  head: ['Template Name', 'Branch', 'Url'],
  style: {
    head: ['green']
  }
})

function showTable(tempList, Exp) {
  const list = Object.keys(tempList)
  if (list.length) {
    list.forEach((key) => {
      table.push([key, tempList[key]['branch'], tempList[key]['url']])
      if (table.length === list.length) {
        console.log(table.toString())
        if (Exp) {
          console.log(chalk.green(`\u2714 ${Exp}`))
        }
        process.exit()
      }
    })
  } else {
    console.log(table.toString())
    if (Exp) {
      console.log(chalk.green(`\u2714 ${Exp}`))
    }
    process.exit()
  }
}

exports.showTable = showTable
```

#è„šæ‰‹æ¶å‘å¸ƒ

### npm ç™»å½•

```
PS D:\yameiproject\mbs-cli> npm login
Username: chenyumen
Password:
Email: (this IS public) 13172050157@126.com
Logged in as chenyumen on https://registry.npmjs.org/.
```

### npm å‘å¸ƒ

```
PS D:\yameiproject\mbs-cli> npm publish
npm notice
npm notice package: mbs-cli@1.0.4
npm notice === Tarball Contents ===
npm notice 573B  package.json
npm notice 2.5kB index.js
npm notice 193B  è„šæ‰‹æ¶.md
npm notice === Tarball Details ===
npm notice name:          mbs-cli
npm notice version:       1.0.4
npm notice package size:  1.8 kB
npm notice total files:   3
npm notice
+ mbs-cli@1.0.4
```

## æœ¬åœ° npm æ¨¡å—è°ƒè¯•

### å¼€å¯è°ƒè¯•æ¨¡å¼

`npm link`å‘½ä»¤å¯ä»¥å°†ä¸€ä¸ªä»»æ„ä½ç½®çš„`npmåŒ…`é“¾æ¥åˆ°å…¨å±€æ‰§è¡Œç¯å¢ƒï¼Œä»è€Œåœ¨ä»»æ„ä½ç½®ä½¿ç”¨å‘½ä»¤è¡Œéƒ½å¯ä»¥ç›´æ¥è¿è¡Œè¯¥ npm åŒ…ã€‚

```
C:\Users\yamei\AppData\Roaming\npm\mbs -> C:\Users\yamei\AppData\Roaming\npm\node_modules\mbs-cli\bin\mbs
C:\Users\yamei\AppData\Roaming\npm\node_modules\mbs-cli -> D:\yameiproject\mbs-cli
```

### å…³é—­è°ƒè¯•æ¨¡å¼

å¦‚æœä½ çš„é¡¹ç›®ä¸å†éœ€è¦è¯¥æ¨¡å—ï¼Œå¯ä»¥åœ¨é¡¹ç›®ç›®å½•å†…ä½¿ç”¨ npm unlink å‘½ä»¤ï¼Œåˆ é™¤ç¬¦å·é“¾æ¥

## å»¶ç”³

1ã€ä¸°å¯Œå‘½ä»¤è¡Œäº¤äº’ï¼Œä»¥é€‚åº”æ›´å¤šå˜çš„éœ€æ±‚ã€‚

2ã€webpack é…ç½®æ–‡ä»¶éšè—ä¼˜åŒ–ã€‚

## æ¨¡æ¿é›†æˆå¸¸ç”¨åŠŸèƒ½

- ç™»å½•ã€æ³¨é”€
- DashBord
- è¡¨æ ¼
- Tab é€‰é¡¹å¡
- å›¾è¡¨
- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- ä¸‰çº§èœå•
- å›½é™…åŒ–
- å›¾ç‰‡æ‹–æ‹½ã€è£å‰ªä¸Šä¼ 
- åˆ—è¡¨æ‹–æ‹½æ’åº
- æƒé™ç®¡ç†
- 404/403/500

## æ¨¡æ¿é¡¹ç›®ç»“æ„

â”œâ”€â”€ build æ„å»ºæœåŠ¡å’Œ webpack é…ç½®
|â€”â€” build.js webpack æ‰“åŒ…æœåŠ¡
|â€”â€” webpack.base.conf.js webpack åŸºæœ¬é€šç”¨é…ç½®
|â€”â€” webpack.dev.conf.js webpack å¼€å‘ç¯å¢ƒé…ç½®
|â€”â€” webpack.prod.conf.js webpack ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ config æ„å»ºé¡¹ç›®ä¸åŒç¯å¢ƒçš„é…ç½®
â”œâ”€â”€ public é¡¹ç›®æ‰“åŒ…æ–‡ä»¶å­˜æ”¾ç›®å½•
â”œâ”€â”€ index.html é¡¹ç›®å…¥å£æ–‡ä»¶
â”œâ”€â”€ package.json é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ .babelrc babel é…ç½®æ–‡ä»¶
â”œâ”€â”€ .gitignore git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ postcss.config.js postcss é…ç½®æ–‡ä»¶
â”œâ”€â”€ src é¡¹ç›®ç›®å½•
â”œâ”€â”€ assets é™æ€èµ„æº  
 â”œâ”€â”€ components é›†æˆç»„ä»¶ç›®å½•  
 |â€”â€” json json ç›®å½•
|â€”â€” lang ä¸­è‹±æ–‡ç›®å½•
|â€”â€” router vue è·¯ç”±é…ç½®
|â€”â€” service ajax è¯·æ±‚é…ç½®
|â€”â€” store vuex é…ç½®
|â€”â€” styles å…¬å…±æ ·å¼
|â€”â€” utils å·¥å…·ç±»
|â€”â€” views é¡µé¢ç»„ä»¶ç›®å½•
|â€”â€” App.vue vue å®ä¾‹å…¥å£
|â€”â€” main.js é¡¹ç›®æ„å»ºå…¥å£
